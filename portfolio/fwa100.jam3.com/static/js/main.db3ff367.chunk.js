/*! For license information please see main.db3ff367.chunk.js.LICENSE.txt */
(this["webpackJsonpjam3-new-app"]=this["webpackJsonpjam3-new-app"]||[]).push([[4],[,function(e,t,n){"use strict";n.d(t,"q",(function(){return s})),n.d(t,"r",(function(){return c})),n.d(t,"J",(function(){return u})),n.d(t,"K",(function(){return h})),n.d(t,"p",(function(){return f})),n.d(t,"x",(function(){return m})),n.d(t,"B",(function(){return p})),n.d(t,"C",(function(){return v})),n.d(t,"w",(function(){return g})),n.d(t,"v",(function(){return b})),n.d(t,"A",(function(){return x})),n.d(t,"E",(function(){return y})),n.d(t,"F",(function(){return w})),n.d(t,"y",(function(){return A})),n.d(t,"D",(function(){return P})),n.d(t,"z",(function(){return T})),n.d(t,"s",(function(){return S})),n.d(t,"G",(function(){return F})),n.d(t,"H",(function(){return E})),n.d(t,"I",(function(){return _})),n.d(t,"h",(function(){return O})),n.d(t,"d",(function(){return C})),n.d(t,"e",(function(){return I})),n.d(t,"m",(function(){return M})),n.d(t,"b",(function(){return L})),n.d(t,"n",(function(){return N})),n.d(t,"o",(function(){return k})),n.d(t,"c",(function(){return j})),n.d(t,"f",(function(){return U})),n.d(t,"g",(function(){return R})),n.d(t,"a",(function(){return D})),n.d(t,"j",(function(){return X})),n.d(t,"k",(function(){return z})),n.d(t,"l",(function(){return Y})),n.d(t,"i",(function(){return B})),n.d(t,"u",(function(){return Q})),n.d(t,"t",(function(){return V}));var a=n(0),o=n(45),i=n(51),r=n(15),s="high",c="normal",l=[s,c],u=new a.Qb,d=c;d=l.includes(Object(o.a)("graphics"))?Object(o.a)("graphics"):Object(i.b)();switch(window.location.host){case"localhost:3000":!1}function h(){return d}var f="global",m="home",p=r.e,v=r.f,g=r.b,b=[m,p,v,g],x="SCENE_INTRO",y="SCENE_TRANSITION_IN",w="SCENE_TRANSITION_OUT",A="SCENE_INTERACTION",P="SCENE_STORY",T="SCENE_INTERACTION_COMPLETE",S=.01,F="STEP_INTERACTION_0",E="STEP_INTERACTION_1",_="STEP_INTERACTION_2",O=13932765,C=9411071,I=4742108,M=16742232,L=14801903,N=16562340,k=16777215,j=5531358,U=9411071,R=12896767,D=[I,M,L,N,k,j,U,R],X=8884437,z=7698582,Y=10780901,B=8884437,Q=.4,V=.75},,function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r})),n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"g",(function(){return d}));var a=n(0),o=2*Math.PI,i=Math.PI,r=Math.PI/2,s=(Math.PI,new a.Qb),c=new a.Qb(0,1,0);function l(e,t,n,a,o,i){var r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=2*Math.PI*a,c=Math.acos(2*o-1),l=e+i*Math.sin(c)*Math.cos(s),u=t+i*Math.sin(c)*Math.sin(s),d=n+i*Math.cos(c);return r?[l,u,d]:{x:l,y:u,z:d}}function u(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return l(e,t,n,Math.random(),Math.random(),a,o)}function d(e,t,n){return a.T.clamp(a.T.mapLinear(e,t,n,0,1),0,1)}t.f=a.T},,,function(e,t,n){"use strict";n.d(t,"e",(function(){return m})),n.d(t,"c",(function(){return x})),n.d(t,"f",(function(){return y})),n.d(t,"d",(function(){return w})),n.d(t,"a",(function(){return A})),n.d(t,"g",(function(){return P}));var a=n(0),o=n(70),i=n(1),r=n(7),s=n(51),c=o.a[Object(i.K)()],l=c.pixelRatio,u=c.antialias,d=c.maxFrameBufferSize,h=Math.sqrt(d.x*d.y),f=h*h;var m=new a.Pb,p=new a.Vb({antialias:u});p.debug.checkShaderErrors=r.a.isDevelopment,p.shadowMap.enabled=!0,p.shadowMap.type=a.kb,p.domElement.classList.add("renderer"),p.setPixelRatio(l),p.setScissorTest(!0),y(window.innerWidth,window.innerHeight);var v=p.getContext(),g=v.getExtension("WEBGL_debug_renderer_info"),b=v.getParameter(g.UNMASKED_RENDERER_WEBGL);function x(){return b}function y(e,t){var n=function(e,t){var n=e,a=t;if(e*t>f){var o=a/n,i=(n=h)*(a=Math.floor(h*o)),r=Math.sqrt(f/i);n=Math.floor(n*r),a=Math.floor(a*r)}return{width:n,height:a}}(e,t),a=n.width,o=n.height;m.x=a,m.y=o,p.setSize(a,o),p.domElement.style.width="".concat(e,"px"),p.domElement.style.height="".concat(t,"px")}function w(){return{width:m.x*l,height:m.y*l}}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o={minFilter:a.N,magFilter:a.eb,format:a.vb,type:a.Ob,stencilBuffer:!1};return new a.Ub(e,t,Object.assign({},o,n))}function P(e){e?p.domElement.classList.add("hover"):p.domElement.classList.remove("hover")}console.log("Graphics: ".concat(Object(i.K)(),"\nGPU: ").concat(b,"\nTier: ").concat(Object(s.c)())),t.b=p},function(e,t,n){"use strict";var a=n(22),o={};function i(){var e=window.navigator.userAgent;if(e.indexOf("iPad")>-1)return!0;if(e.indexOf("Macintosh")>-1)try{return document.createEvent("TouchEvent"),!0}catch(t){}return!1}o.resizeDebounceTime=50,o.isDevelopment=!1,o.datGui=!1,o.stats=!1,o.helpers=!1,o.soundsEnabled=!0,o.assetPath="".concat("","/assets/"),o.imagesPath="".concat("","/assets/images/"),o.jsonPath="".concat("","/assets/json/"),o.webglPath="".concat("","/assets/webgl/"),o.soundsPath="".concat("","/assets/sounds/"),o.preloadAllAssets=!0,o.preloadAllScenes=!0,o.apiDev=function(){switch(window.location.host){case"localhost:3000":case"dev.fwa100.jam3.com":case"stage.fwa100.jam3.com":return!0;default:return!1}}(),o.isDesktop=a.c.device.isDesktop,o.isDesktop&&i()&&(o.isDesktop=!1),o.ios=i()||a.c.os.isiOS&&a.c.browser.isSafari,o.operaTouch=!!navigator.userAgent.match(/OPT\//),o.inAppBrowser=a.c.inAppBrowser.isFacebook||a.c.inAppBrowser.isTwitter||a.c.inAppBrowser.isInstagram||a.c.inAppBrowser.isPinterest,t.a=o},,,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"j",(function(){return i})),n.d(t,"k",(function(){return r})),n.d(t,"l",(function(){return s})),n.d(t,"m",(function(){return c})),n.d(t,"n",(function(){return l})),n.d(t,"o",(function(){return u})),n.d(t,"p",(function(){return d})),n.d(t,"q",(function(){return h})),n.d(t,"r",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"d",(function(){return p})),n.d(t,"e",(function(){return v})),n.d(t,"g",(function(){return g})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return x})),n.d(t,"f",(function(){return y}));var a="button-click",o="button-rollover",i="home-background",r="past-background",s="past-orb-reveal",c="past-rock-interaction",l="past-rock-shatter",u="past-rock-shatter-crystals",d="present-background",h="present-bubbles",f=["present-click-0","present-click-1","present-click-2","present-click-3","present-click-4","present-click-5"],m="future-background",p="future-background-tone",v="future-camera",g="future-confetti-0",b="future-confetti-1",x="future-confetti-2",y=[g,b,x]},function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"g",(function(){return c})),n.d(t,"i",(function(){return l})),n.d(t,"h",(function(){return u})),n.d(t,"j",(function(){return d})),n.d(t,"a",(function(){return h})),n.d(t,"d",(function(){return f}));var a="/",o="past",i="present",r="future",s={Landing:a,Step:"/:value",Past:"/".concat(o),Present:"/".concat(i),Future:"/".concat(r),Credit:"/Credit",NotFound:"/notfound"};t.k=s;var c=[s.Landing,s.Past,s.Present,s.Future],l=[o,i,r],u="/rotatescreen",d="/unsupported",h="/credit",f="/notfound"},,function(e,t,n){"use strict";var a=n(4),o=n(9),i=n(30),r=n(8),s=n(19),c=n(1),l=n(7),u=function(){function e(){var t=this;Object(a.a)(this,e),this.handleVisibilityChange=function(){document.hidden?t.handleBlur():t.handleFocus()},this.handleBlur=function(){t.active&&(t.forcedMute=!0,i.Howler.volume(0))},this.handleFocus=function(){t.forcedMute&&(t.forcedMute=!1,i.Howler.volume(1))},this.volume=0,i.Howler.volume(this.volume),this.tweens={global:{volume:this.volume}},this.active=!0,this.forcedMute=!1,document.addEventListener("visibilitychange",this.handleVisibilityChange),window.addEventListener("blur",this.handleBlur),window.addEventListener("focus",this.handleFocus)}return Object(o.a)(e,[{key:"stop",value:function(e,t){if(l.a.soundsEnabled){var n=s.a.get(l.a.preloadAllAssets?c.p:e,t,!0),a=n.data,o=n.args;this.fade(a,a.volume(),0,o.fadeOutDuration||1,o.delay||0).then((function(){a.stop()}))}}},{key:"play",value:function(e,t){if(l.a.soundsEnabled){var n=s.a.get(l.a.preloadAllAssets?c.p:e,t,!0),a=n.data,o=n.args;a&&(a.playing()&&"running"===i.Howler.ctx.state&&!1===o.oneshot||(a.volume(0),a.stop(),a.seek(0),!1!==o.fade?this.fade(a,0,o.volume||1,o.fadeInDuration||1,o.delay||0):(a.volume(o.volume||1),a.play())))}}},{key:"fade",value:function(e,t,n,a){var o=this,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Promise((function(s,c){try{void 0===o.tweens[e._src]&&(o.tweens[e._src]={volume:0}),o.tweens[e._src].volume=t,r.g.to(o.tweens[e._src],a,{volume:n,delay:i,onUpdate:function(){e.volume(o.tweens[e._src].volume)},onComplete:function(){s()}}),e.playing()||e.play()}catch(l){c(l)}}))}},{key:"toggle",value:function(e){var t=this;l.a.soundsEnabled&&(this.active=e,r.g.killTweensOf(this.tweens.global),r.g.to(this.tweens.global,1,{volume:e?1:0,onUpdate:function(){i.Howler.volume(t.tweens.global.volume)}}))}}]),e}();t.a=new u},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(4),o=n(76),i=function e(t){Object(a.a)(this,e),o(this,t)}},function(e,t,n){"use strict";var a=n(23),o=n(4),i=n(9),r=n(61),s=n(18),c=n(7),l=n(1),u=function(){function e(){Object(o.a)(this,e),this.assets={}}return Object(i.a)(e,[{key:"add",value:function(e,t){var n;this.assets[e]=this.assets[e]||[],(n=this.assets[e]).push.apply(n,Object(a.a)(t))}},{key:"get",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this.assets[c.a.preloadAllAssets?l.p:e];if(void 0===o)return!1;var i=this.find(o,t);return i&&i instanceof s.a?n?i:i.data:(a&&Object(r.b)("AssetManager::get no assets found for ".concat(t)),!1)}},{key:"find",value:function(e,t){return e.find((function(e){return e.id===t}))||!1}},{key:"dispose",value:function(e){}}]),e}();t.a=new u},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return u}));var a=n(76),o=n.n(a),i=n(0);function r(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={position:e.position.toArray(),scale:e.scale.toArray(),rotation:e.rotation.toArray()};return t?JSON.stringify(n,null,2):n}function s(e,t){if(null!==e&&void 0!==e){if(t.remove(e),e.dispose&&e.dispose(),e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose(),e.children)for(var n=0,a=e.children.length;n<a;)s(e.children[0],e),n++;e=null}}function c(){return o.a.apply(void 0,[{}].concat(Array.prototype.slice.call(arguments)))}function l(){var e=new i.i,t=new i.h(new Float32Array([-1,-1,0,-1,4,0,4,-1,0]),3);return e.addAttribute("position",t),e.setIndex([0,2,1]),e}function u(e,t,n){var a=Math.tan(function(e){var t=e.elements[5],n=180/Math.PI;return 2*Math.atan(1/t)*n}(e)*Math.PI/180*.5)*(2*n);return{scaleX:a*t,scaleY:a}}},function(e,t,n){"use strict";t.a={SET_READY:"SET_READY",SET_PROGRESS:"SET_PROGRESS",BATCH_ACTIONS:"BATCH_ACTIONS",SET_WINDOW_SIZE:"SET_WINDOW_SIZE",SET_LAYOUT:"SET_LAYOUT",SET_IS_MOBILE_MENU_OPEN:"SET_IS_MOBILE_MENU_OPEN",SET_PREV_ROUTE:"SET_PREV_ROUTE",SET_AUDIO_CONTEXT_STATE:"SET_AUDIO_CONTEXT_STATE",LANDING_LOADED:"LANDING_LOADED",SET_COPY:"SET_COPY",SET_IS_MUTED:"SET_IS_MUTED",LOCATION_CHANGE:"@@router/LOCATION_CHANGE",SET_CAPTURE:"SET_CAPTURE",SET_STEP:"SET_STEP",SET_SCENE_STEP:"SET_SCENE_STEP",STEP_ASSETS_LOADED:"STEP_ASSETS_LOADED",SET_INTERACTION_STARTED:"SET_INTERACTION_STARTED",SET_MODAL_OPEN:"SET_MODAL_OPEN",SET_MODAL_CLOSE:"SET_MODAL_CLOSE"}},,,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var a=n(9),o=n(4),i=n(0),r=n(98),s=n(48),c=n(46),l=n(3),u=n(33),d=n(6),h=n(7),f=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:45,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.25,r=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;Object(o.a)(this,e),this.rotationAxis=new i.Pb(t,n),this.easing=a,this.radius=new i.Pb(r,s)},m=function(){function e(){var t=this;Object(o.a)(this,e),this.onScroll=function(e){if(!1!==t.lethargy.check(e)){var n=l.f.clamp(t.scrollMotionEase.value.x+Math.sign(e.deltaY)*t.scrollSpeed,0,1);isNaN(n)||t.scrollMotionEase.setValue(n,0,!0)}},this.onGUIChange=function(){t.setRadians()},this.onMotionUpdate=function(e){t.rotationMotionEase.setValue(e[0].normalX,e[0].normalY,!0)},this.gui=u.b.addFolder("camera movement"),this.rotationMotionEase=new c.a,this.rotationMotionEase.easing=.05,this.scrollMotionEase=new c.a,this.scrollMotionEase.easing=.15,this.rotationAxis=new i.Pb(45,25),this.rotationAxisRadians=new i.Pb,this.radius=new i.Pb(10,15),this.scrollSpeed=2,this.screenshotCache={rotationX:0,rotationY:0,scrollX:0,scrollY:0},this.lethargy=new r.Lethargy;["mousewheel","DOMMouseScroll","wheel","MozMousePixelScroll"].forEach((function(e){d.b.domElement.addEventListener(e,t.onScroll)})),s.a.on("update",this.onMotionUpdate),this.gui.add(this.rotationAxis,"x",0,180).onChange(this.onGUIChange).name("rotation x").listen(),this.gui.add(this.rotationAxis,"y",0,90).onChange(this.onGUIChange).name("rotation y").listen(),this.gui.add(this.rotationMotionEase,"easing",0,1).name("rotation easing").listen(),this.gui.add(this.scrollMotionEase,"easing",0,1).name("scroll easing").listen(),this.gui.add(this,"scrollSpeed",0,10).name("scroll speed").listen(),this.setRadians(),this.active=!1}return Object(a.a)(e,[{key:"setup",value:function(){s.a.setup()}},{key:"setActive",value:function(e){this.active=e,s.a.setActive(e)}},{key:"setConfig",value:function(e){this.rotationAxis.copy(e.rotationAxis),this.rotationMotionEase.easing=e.easing,this.rotationMotionEase.setValue(.5,.5,!1),this.scrollMotionEase.setValue(1,0,!1),this.radius=e.radius,this.setRadians()}},{key:"captureScreenShot",value:function(e){e?(this.screenshotCache.rotationX=this.rotationMotionEase.value.x,this.screenshotCache.rotationY=this.rotationMotionEase.value.y,this.screenshotCache.scrollX=this.scrollMotionEase.value.x,this.screenshotCache.scrollY=this.scrollMotionEase.value.y,this.rotationMotionEase.setValue(.5,.5,!1),this.scrollMotionEase.setValue(1,0,!1),this.update()):(this.rotationMotionEase.setValue(this.screenshotCache.rotationX,this.screenshotCache.rotationY,!1),this.scrollMotionEase.setValue(this.screenshotCache.scrollX,this.screenshotCache.scrollY,!1),this.update())}},{key:"setRadians",value:function(){this.rotationAxisRadians.x=l.f.degToRad(this.rotationAxis.x),this.rotationAxisRadians.y=l.f.degToRad(this.rotationAxis.y)}},{key:"setCamera",value:function(e){this.camera=e}},{key:"update",value:function(){if(this.active){s.a.update(),this.rotationMotionEase.update(),this.scrollMotionEase.update();var e=l.f.lerp(-this.rotationAxisRadians.x,this.rotationAxisRadians.x,1-this.rotationMotionEase.value.x),t=l.f.lerp(-this.rotationAxisRadians.y,this.rotationAxisRadians.y,this.rotationMotionEase.value.y),n=h.a.isDesktop?l.f.lerp(this.radius.x,this.radius.y,this.scrollMotionEase.value.x):this.radius.y;this.camera.position.x=Math.sin(e)*(Math.cos(t)*n),this.camera.position.y=Math.sin(t)*n,this.camera.position.z=Math.cos(e)*(Math.cos(t)*n),this.camera.lookAt(l.e)}}}]),e}();t.b=new m},,function(e,t,n){"use strict";function a(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,{ctx:n.getContext("2d"),canvas:n}}n.d(t,"a",(function(){return a}))},,,,function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return u})),n.d(t,"a",(function(){return s}));var a=n(4),o=n(9),i=n(7),r=(n(3),n(20),function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"add",value:function(){return this}},{key:"listen",value:function(){return this}},{key:"name",value:function(){return this}},{key:"open",value:function(){return this}},{key:"close",value:function(){return this}},{key:"onChange",value:function(){return this}},{key:"addFolder",value:function(){return this}},{key:"addColor",value:function(){return this}},{key:"removeFolder",value:function(){return this}},{key:"remove",value:function(){return this}},{key:"step",value:function(){return this}}]),e}()),s=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"add",value:function(){return this}},{key:"addFolder",value:function(){return new r}},{key:"removeFolder",value:function(){return this}},{key:"addColor",value:function(){return this}},{key:"listen",value:function(){return this}},{key:"name",value:function(){return this}},{key:"close",value:function(){return this}},{key:"step",value:function(){return this}},{key:"onChange",value:function(){return this}},{key:"setValue",value:function(){return this}},{key:"remove",value:function(){return this}},{key:"open",value:function(){return this}}],[{key:"toggleHide",value:function(){return this}}]),e}(),c=s;var l=new c,u=l.addFolder("flags");u.open(),i.a.isDesktop||c.toggleHide()},,,,,,,,,function(e,t,n){"use strict";var a=n(10),o=n(39);t.a={_emitChange:null,_reducers:{},get reducers(){return Object(o.a)({},this._reducers)},set reducers(e){this._reducers=e},register:function(e,t){this._reducers=Object(o.a)({},this._reducers,Object(a.a)({},e,t)),this._emitChange&&this._emitChange(this.reducers)},setChangeListener:function(e){this._emitChange=e}}},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var a=n(10),o=n(137);function i(e){var t=o.parse(window.location.search);return void 0!==t[e]&&t[e]}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=o.parse(window.location.search),r=Object.assign({},i,Object(a.a)({},e,t)),s=o.stringify(r);if(n)window.location.href="".concat(window.location.pathname,"?").concat(s);else{var c="".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname,"?").concat(s);window.history.pushState({path:c},"",c)}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var a=n(4),o=n(0),i=function e(){var t=this;Object(a.a)(this,e),this.setValue=function(e,n){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];t.newValue.x=e,t.newValue.y=n,a||(t.value.x=t.newValue.x,t.value.y=t.newValue.y)},this.update=function(){t.value.x+=(t.newValue.x-t.value.x)*t.easing,t.value.y+=(t.newValue.y-t.value.y)*t.easing,Math.abs(t.value.x-t.newValue.x)<1e-4&&(t.value.x=t.newValue.x),Math.abs(t.value.y-t.newValue.y)<1e-4&&(t.value.y=t.newValue.y)},this.value=new o.Pb,this.newValue=new o.Pb,this.easing=.025},r=function e(){var t=this;Object(a.a)(this,e),this.setValue=function(e,n,a){var o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];t.newValue.x=e,t.newValue.y=n,t.newValue.z=a,o||(t.value.x=t.newValue.x,t.value.y=t.newValue.y,t.value.z=t.newValue.z)},this.update=function(){t.value.x+=(t.newValue.x-t.value.x)*t.easing,t.value.y+=(t.newValue.y-t.value.y)*t.easing,t.value.z+=(t.newValue.z-t.value.z)*t.easing,Math.abs(t.value.x-t.newValue.x)<1e-4&&(t.value.x=t.newValue.x),Math.abs(t.value.y-t.newValue.y)<1e-4&&(t.value.y=t.newValue.y),Math.abs(t.value.z-t.newValue.z)<1e-4&&(t.value.z=t.newValue.z)},this.value=new o.Qb,this.newValue=new o.Qb,this.easing=.025}},,function(e,t,n){"use strict";var a=n(4),o=n(12),i=n(11),r=n(13),s=(n(161),n(16)),c=n.n(s),l=n(62),u=n(3),d=n(7),h=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(o.a)(this,Object(i.a)(t).call(this))).setup=function(){d.a.isDesktop||new window.FULLTILT.getDeviceOrientation({type:"world"}).then((function(t){e.registerfallbackController(!1),e.deviceMotion=t})).catch((function(){}))},e.onTouchMove=function(t){e.emit("update",t)},e.setActive=function(t){e.enabled=t},e.update=function(){if(e.enabled&&e.deviceMotion){var t=e.deviceMotion.getScreenAdjustedEuler();if(t.beta>85&&t.beta<95)return;var n=t.gamma;n=n>0?Math.min(n,10):Math.max(n,-10),e.initialBeta||(e.initialBeta=t.beta);var a=t.beta-e.initialBeta;a=a>0?Math.min(a,5):Math.max(a,-5);var o=Object(u.g)(n,-10,10),i=Object(u.g)(a,-5,5);e.emit("update",[{x:0,y:0,normalX:o,normalY:i}])}},e.registerfallbackController=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=d.a.isDesktop?"mousemove":"move";l.a[t?"on":"off"](n,e.onTouchMove)},e.enabled=!1,e.registerfallbackController(!0),e}return Object(r.a)(t,e),t}(c.a);t.a=new h},,,function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return c}));var a=n(96),o=n(1),i=Object(a.getGPUTier)();function r(){switch(i.tier){case"GPU_DESKTOP_TIER_3":case"GPU_DESKTOP_TIER_2":return o.q;default:return o.r}}function s(){return i.tier}function c(e){var t=document.createElement("div");Object.assign(t.style,{position:"fixed",bottom:"10px",right:"0",zIndex:"1000000",background:"rgba(0, 0, 0, 0.5)",color:"#ffffff",padding:"10px",fontSize:"12px"}),t.innerHTML="graphics: ".concat(e),document.body.appendChild(t)}},,function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(4),o=n(12),i=n(11),r=n(13),s=n(16),c=n.n(s),l=n(7),u=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this))).destroy=function(){l.a.isDesktop?(n.element.removeEventListener("mouseup",n.onTouchEnd),n.element.removeEventListener("mousemove",n.onTouchMove),n.element.removeEventListener("mouseout",n.onMouseOut),n.element.removeEventListener("mousedown",n.onTouchStart)):(n.element.removeEventListener("touchend",n.onTouchEnd),n.element.removeEventListener("touchmove",n.onTouchMove),n.element.removeEventListener("touchstart",n.onTouchStart))},n.setPointers=function(e){n.pointers=[],e.touches?Object.keys(e.touches).forEach((function(t){var a=e.touches[t];n.pointers.push({x:a.pageX,y:a.pageY,normalX:a.pageX/window.innerWidth,normalY:a.pageY/window.innerHeight})})):n.pointers.push({x:e.pageX,y:e.pageY,normalX:e.pageX/window.innerWidth,normalY:e.pageY/window.innerHeight})},n.onTouchStart=function(e){n.isDown=!0,n.setPointers(e),n.emit("start",n.pointers)},n.onTouchMove=function(e){n.onMouseMove(e),n.isDown&&(n.setPointers(e),n.emit("move",n.pointers))},n.onTouchEnd=function(e){n.isDown=!1,n.emit("end",n.pointers)},n.onMouseMove=function(e){n.setPointers(e),n.emit("mousemove",n.pointers)},n.onMouseOver=function(e){n.emit("hover",!0)},n.onMouseOut=function(e){n.emit("hover",!1)},n.element=e,n.pointers=[],n.isDown=!1,n.currentTime=0,n.tapLength=0,n.rect=e.getBoundingClientRect(),l.a.isDesktop?(n.element.addEventListener("mouseup",n.onTouchEnd),n.element.addEventListener("mousemove",n.onTouchMove),n.element.addEventListener("mouseover",n.onMouseOver),n.element.addEventListener("mouseout",n.onMouseOut),n.element.addEventListener("mousedown",n.onTouchStart),n.element.addEventListener("mouse",n.onTouchStart)):(n.element.addEventListener("touchend",n.onTouchEnd),n.element.addEventListener("touchmove",n.onTouchMove),n.element.addEventListener("touchstart",n.onTouchStart)),n}return Object(r.a)(t,e),t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return c}));var a=n(23),o=n(21),i=[];function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.a.SET_MODAL_OPEN:return e.includes(t.modal)?[].concat(Object(a.a)(e.filter((function(e){return e!==t.modal}))),[t.modal]):[].concat(Object(a.a)(e),[t.modal]);case o.a.SET_MODAL_CLOSE:var n=-1;return e.forEach((function(e,a){e===t.modal&&(n=a)})),-1===n?Object(a.a)(e):Object(a.a)(Object(a.a)(e).slice(n,-1));default:return e}}function s(e){return{type:o.a.SET_MODAL_OPEN,modal:e}}function c(e){return{type:o.a.SET_MODAL_CLOSE,modal:e}}},,function(e,t,n){"use strict";var a=n(10),o=n(39),i=n(2),r=n.n(i),s=n(175),c=n(34),l=n.n(c),u=(n(37),n(166),["children","download","target","rel","link"]),d=/^(https:\/\/|http:\/\/|www\.|tel:|mailto:)/,h=/^(https:\/\/|http:\/\/|www\.)/,f=r.a.memo(r.a.forwardRef((function(e,t){var n=d.test(e.link)||e.download?"a":s.a,i=Object.keys(e).reduce((function(t,n){return[].concat(u).indexOf(n)>-1?t:Object(o.a)({},t,Object(a.a)({},n,e[n]))}),{});return"a"===n?(i.href=e.link,i.download=e.download,h.test(e.link)&&!e.download&&(i.target=e.target,"_blank"===e.target&&(i.rel=e.rel||"noopener"))):i.to=e.link,r.a.createElement(n,Object.assign({ref:t,className:l()("BaseLink",e.className)},i),e.children)})));f.defaultProps={link:"",target:"_blank"},t.a=f},,,,,function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var a=n(28),o=n.n(a),i=n(7),r=window.console&&console.log&&i.a.isDevelopment?Function.prototype.bind.call(console.log,console):o.a,s=(window.console&&console.clear&&i.a.isDevelopment?Function.prototype.bind.call(console.clear,console):o.a,window.console&&console.debug&&i.a.isDevelopment?Function.prototype.bind.call(console.debug,console):o.a,window.console&&console.info&&i.a.isDevelopment?Function.prototype.bind.call(console.info,console):o.a,window.console&&console.warn&&i.a.isDevelopment?Function.prototype.bind.call(console.warn,console):o.a);window.console&&console.error&&i.a.isDevelopment?Function.prototype.bind.call(console.error,console):o.a},function(e,t,n){"use strict";var a=n(53),o=n(6);t.a=new a.a(o.b.domElement)},,,function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return d})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return f})),n.d(t,"c",(function(){return m}));var a=n(39),o=n(21),i=n(42),r=n(1),s=n(15),c=r.A,l={currentStep:"",sceneStep:c,interactionStarted:!1,assetsLoaded:!1},u=c;function d(e){return{type:o.a.STEP_ASSETS_LOADED,loaded:e}}function h(e){return{type:o.a.SET_STEP,step:e}}function f(e){return{type:o.a.SET_SCENE_STEP,step:e}}function m(){return{type:o.a.SET_INTERACTION_STARTED}}i.a.register("steps",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case o.a.SET_STEP:return Object(a.a)({},e,{currentStep:t.step});case o.a.SET_SCENE_STEP:return Object(a.a)({},e,{sceneStep:t.step});case o.a.STEP_ASSETS_LOADED:return Object(a.a)({},e,{assetsLoaded:t.loaded});case o.a.LOCATION_CHANGE:var n=e.currentStep,i=t.payload.pathname.substring(1);return s.i.includes(i)&&(n=i),Object(a.a)({},e,{sceneStep:c,currentStep:n,interactionStarted:!1});case o.a.SET_INTERACTION_STARTED:return Object(a.a)({},e,{interactionStarted:!0});default:return e}}))},,,,,function(e,t,n){"use strict";var a,o=n(10),i=n(0),r=n(1),s=n(3);t.a=(a={},Object(o.a)(a,r.q,{antialias:!1,pixelRatio:s.f.clamp(window.devicePixelRatio,1,1.5),maxFrameBufferSize:new i.Pb(1280,720)}),Object(o.a)(a,r.r,{antialias:!1,pixelRatio:s.f.clamp(window.devicePixelRatio,1,1.5),maxFrameBufferSize:new i.Pb(1280,720)}),a)},,function(e,t,n){"use strict";t.a={CREDIT:"credit"}},,,,,,function(e){e.exports=JSON.parse('{"chrome":30,"firefox":40,"safari":9,"internet explorer":10,"edge":12,"ios":9,"mac":10.1,"windows":7}')},,function(e){e.exports=JSON.parse('{"b":768,"a":1024}')},function(e,t){(function(){"use strict";var e=void 0,t=this;function n(n,a){var o,i=n.split("."),r=t;!(i[0]in r)&&r.execScript&&r.execScript("var "+i[0]);for(;i.length&&(o=i.shift());)i.length||a===e?r=r[o]?r[o]:r[o]={}:r[o]=a}var a="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function o(e){var t,n,o,i,r,s,c,l,u,d,h=e.length,f=0,m=Number.POSITIVE_INFINITY;for(l=0;l<h;++l)e[l]>f&&(f=e[l]),e[l]<m&&(m=e[l]);for(t=1<<f,n=new(a?Uint32Array:Array)(t),o=1,i=0,r=2;o<=f;){for(l=0;l<h;++l)if(e[l]===o){for(s=0,c=i,u=0;u<o;++u)s=s<<1|1&c,c>>=1;for(d=o<<16|l,u=s;u<t;u+=r)n[u]=d;++i}++o,i<<=1,r<<=1}return[n,f,m]}function i(e,t){switch(this.g=[],this.h=32768,this.d=this.f=this.a=this.l=0,this.input=a?new Uint8Array(e):e,this.m=!1,this.i=s,this.r=!1,!t&&(t={})||(t.index&&(this.a=t.index),t.bufferSize&&(this.h=t.bufferSize),t.bufferType&&(this.i=t.bufferType),t.resize&&(this.r=t.resize)),this.i){case r:this.b=32768,this.c=new(a?Uint8Array:Array)(32768+this.h+258);break;case s:this.b=0,this.c=new(a?Uint8Array:Array)(this.h),this.e=this.z,this.n=this.v,this.j=this.w;break;default:throw Error("invalid inflate mode")}}var r=0,s=1,c={t:r,s:s};i.prototype.k=function(){for(;!this.m;){var t=E(this,3);switch(1&t&&(this.m=!0),t>>>=1){case 0:var n=this.input,i=this.a,c=this.c,l=this.b,u=n.length,d=e,f=c.length,m=e;if(this.d=this.f=0,i+1>=u)throw Error("invalid uncompressed block header: LEN");if(d=n[i++]|n[i++]<<8,i+1>=u)throw Error("invalid uncompressed block header: NLEN");if(d===~(n[i++]|n[i++]<<8))throw Error("invalid uncompressed block header: length verify");if(i+d>n.length)throw Error("input buffer is broken");switch(this.i){case r:for(;l+d>c.length;){if(d-=m=f-l,a)c.set(n.subarray(i,i+m),l),l+=m,i+=m;else for(;m--;)c[l++]=n[i++];this.b=l,c=this.e(),l=this.b}break;case s:for(;l+d>c.length;)c=this.e({p:2});break;default:throw Error("invalid inflate mode")}if(a)c.set(n.subarray(i,i+d),l),l+=d,i+=d;else for(;d--;)c[l++]=n[i++];this.a=i,this.b=l,this.c=c;break;case 1:this.j(T,F);break;case 2:var p,v,g,b,x=E(this,5)+257,y=E(this,5)+1,w=E(this,4)+4,A=new(a?Uint8Array:Array)(h.length),P=e,S=e,O=e,C=e,I=e;for(I=0;I<w;++I)A[h[I]]=E(this,3);if(!a)for(I=w,w=A.length;I<w;++I)A[h[I]]=0;for(p=o(A),P=new(a?Uint8Array:Array)(x+y),I=0,b=x+y;I<b;)switch(S=_(this,p)){case 16:for(C=3+E(this,2);C--;)P[I++]=O;break;case 17:for(C=3+E(this,3);C--;)P[I++]=0;O=0;break;case 18:for(C=11+E(this,7);C--;)P[I++]=0;O=0;break;default:O=P[I++]=S}v=o(a?P.subarray(0,x):P.slice(0,x)),g=o(a?P.subarray(x):P.slice(x)),this.j(v,g);break;default:throw Error("unknown BTYPE: "+t)}}return this.n()};var l,u,d=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],h=a?new Uint16Array(d):d,f=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],m=a?new Uint16Array(f):f,p=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],v=a?new Uint8Array(p):p,g=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],b=a?new Uint16Array(g):g,x=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],y=a?new Uint8Array(x):x,w=new(a?Uint8Array:Array)(288);for(l=0,u=w.length;l<u;++l)w[l]=143>=l?8:255>=l?9:279>=l?7:8;var A,P,T=o(w),S=new(a?Uint8Array:Array)(30);for(A=0,P=S.length;A<P;++A)S[A]=5;var F=o(S);function E(e,t){for(var n,a=e.f,o=e.d,i=e.input,r=e.a,s=i.length;o<t;){if(r>=s)throw Error("input buffer is broken");a|=i[r++]<<o,o+=8}return n=a&(1<<t)-1,e.f=a>>>t,e.d=o-t,e.a=r,n}function _(e,t){for(var n,a,o=e.f,i=e.d,r=e.input,s=e.a,c=r.length,l=t[0],u=t[1];i<u&&!(s>=c);)o|=r[s++]<<i,i+=8;if((a=(n=l[o&(1<<u)-1])>>>16)>i)throw Error("invalid code length: "+a);return e.f=o>>a,e.d=i-a,e.a=s,65535&n}function O(e,t){var n,a;switch(this.input=e,this.a=0,!t&&(t={})||(t.index&&(this.a=t.index),t.verify&&(this.A=t.verify)),n=e[this.a++],a=e[this.a++],15&n){case C:this.method=C;break;default:throw Error("unsupported compression method")}if(0!==((n<<8)+a)%31)throw Error("invalid fcheck flag:"+((n<<8)+a)%31);if(32&a)throw Error("fdict flag is not supported");this.q=new i(e,{index:this.a,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}i.prototype.j=function(e,t){var n=this.c,a=this.b;this.o=e;for(var o,i,r,s,c=n.length-258;256!==(o=_(this,e));)if(256>o)a>=c&&(this.b=a,n=this.e(),a=this.b),n[a++]=o;else for(s=m[i=o-257],0<v[i]&&(s+=E(this,v[i])),o=_(this,t),r=b[o],0<y[o]&&(r+=E(this,y[o])),a>=c&&(this.b=a,n=this.e(),a=this.b);s--;)n[a]=n[a++-r];for(;8<=this.d;)this.d-=8,this.a--;this.b=a},i.prototype.w=function(e,t){var n=this.c,a=this.b;this.o=e;for(var o,i,r,s,c=n.length;256!==(o=_(this,e));)if(256>o)a>=c&&(c=(n=this.e()).length),n[a++]=o;else for(s=m[i=o-257],0<v[i]&&(s+=E(this,v[i])),o=_(this,t),r=b[o],0<y[o]&&(r+=E(this,y[o])),a+s>c&&(c=(n=this.e()).length);s--;)n[a]=n[a++-r];for(;8<=this.d;)this.d-=8,this.a--;this.b=a},i.prototype.e=function(){var e,t,n=new(a?Uint8Array:Array)(this.b-32768),o=this.b-32768,i=this.c;if(a)n.set(i.subarray(32768,n.length));else for(e=0,t=n.length;e<t;++e)n[e]=i[e+32768];if(this.g.push(n),this.l+=n.length,a)i.set(i.subarray(o,o+32768));else for(e=0;32768>e;++e)i[e]=i[o+e];return this.b=32768,i},i.prototype.z=function(e){var t,n,o,i=this.input.length/this.a+1|0,r=this.input,s=this.c;return e&&("number"===typeof e.p&&(i=e.p),"number"===typeof e.u&&(i+=e.u)),2>i?n=(o=(r.length-this.a)/this.o[2]/2*258|0)<s.length?s.length+o:s.length<<1:n=s.length*i,a?(t=new Uint8Array(n)).set(s):t=s,this.c=t},i.prototype.n=function(){var e,t,n,o,i,r=0,s=this.c,c=this.g,l=new(a?Uint8Array:Array)(this.l+(this.b-32768));if(0===c.length)return a?this.c.subarray(32768,this.b):this.c.slice(32768,this.b);for(t=0,n=c.length;t<n;++t)for(o=0,i=(e=c[t]).length;o<i;++o)l[r++]=e[o];for(t=32768,n=this.b;t<n;++t)l[r++]=s[t];return this.g=[],this.buffer=l},i.prototype.v=function(){var e,t=this.b;return a?this.r?(e=new Uint8Array(t)).set(this.c.subarray(0,t)):e=this.c.subarray(0,t):(this.c.length>t&&(this.c.length=t),e=this.c),this.buffer=e},O.prototype.k=function(){var e,t,n=this.input;if(e=this.q.k(),this.a=this.q.a,this.A){t=(n[this.a++]<<24|n[this.a++]<<16|n[this.a++]<<8|n[this.a++])>>>0;var a=e;if("string"===typeof a){var o,i,r=a.split("");for(o=0,i=r.length;o<i;o++)r[o]=(255&r[o].charCodeAt(0))>>>0;a=r}for(var s,c=1,l=0,u=a.length,d=0;0<u;){u-=s=1024<u?1024:u;do{l+=c+=a[d++]}while(--s);c%=65521,l%=65521}if(t!==(l<<16|c)>>>0)throw Error("invalid adler-32 checksum")}return e};var C=8;n("Zlib.Inflate",O),n("Zlib.Inflate.prototype.decompress",O.prototype.k);var I,M,L,N,k={ADAPTIVE:c.s,BLOCK:c.t};if(Object.keys)I=Object.keys(k);else for(M in I=[],L=0,k)I[L++]=M;for(L=0,N=I.length;L<N;++L)n("Zlib.Inflate.BufferType."+(M=I[L]),k[M])}).call(this)},function(e,t,n){"use strict";var a=n(74),o=n(2),i=n.n(o),r=n(34),s=n.n(r),c=(n(37),i.a.memo(i.a.forwardRef((function(e,t){var n=e.component,o=e.children,r=e.role,c=Object(a.a)(e,["component","children","role"]),l="button"===n?r:"button";return i.a.createElement(n,Object.assign({className:s()("BaseButton",e.className),ref:t,role:l},c),o)}))));c.defaultProps={component:"button"},t.a=c},,,function(e){e.exports=JSON.parse('{"global":{"copyright":"Made by Jam3","jam3link":"https://jam3.com","siteTitle":"100 FWA","shareButtonCopy":"Share","ctaStart":"Begin","fwaUrl":"http://thefwa.com/profiles/jam3","linkedinUrl":"https://www.linkedin.com/company/jam3","ctaCont":"Continue","instaUrl":"https://www.instagram.com/wearejam3","twitterUrl":"https://twitter.com/jam3","loading":"Loading"},"landing":{"description0":"Today we won our 100th FWA.","description1":"Let\u2019s reflect back on where we started, how we got here, and where we\u2019re going. ","description2":"Take a moment to celebrate our first \u201cFWA century\u201d with us."},"past":{"eyeBrow":"Past","description":"Jam3 was born out of curiosity and passion. We saw potential and started building."},"present":{"eyeBrow":"Present","description":"One is good, more is better. Ideas led us to more ideas, more people, more places."},"future":{"eyeBrow":"Future","description":"The future is an infinite canvas. We\'ve done a lot, but it feels like we\'re just getting started."},"instruction":{"past":"Draw on the rock","present":"Burst the circles","future":"Click and hold"},"notFound":{"description":"Oops! this page does not exist.","cta":"Back"},"credits":{"title":"100 thanks.","story0":"To the FWA for inspiring us from day one to challenge our limits.","madeBy":"Made with love by your friends at Jam3:","collaborators":"Amelie, Aaron, Charlotte, Victoire, Jacob, Bonnie, Tyrell, Adam V, Evan, Geoff, Jude, Francisco, Bruno, Arturo, Tomas, Cyrill, Katie, Pablo, Adrian.","musicBy":"Music by Adam Romano.","story1":"To everyone in the Jamfam, both past and present, for our first FWA in 2009 to our 100th in 2020.","story2":"To our families, friends, and clients for your trust and encouragement \u2014 without you, we wouldn\'t be here."}}')},,function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}));var a=n(58),o=n.n(a),i=o()(.33,0,0,1),r=(o()(.33,0,.22,1),o()(.33,0,.44,1),o()(.33,0,.67,1));o()(0,0,0,0)},,function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(2),o=n.n(a);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createElement("path",{fillRule:"evenodd",d:"M104.188501,13 L94.7405387,13 C94.0544245,13 93.3849257,13.2313964 92.8419265,13.6538294 C92.4723408,13.9202044 92.1608389,14.2685735 91.937021,14.6676403 L91.9250133,14.6890239 L91.9135641,14.7105492 L90.6069593,17.1693839 C90.6069593,17.1693839 89.0899405,14.1574069 88.6498445,13.7902032 C88.0828299,13.2939896 87.3622286,13.0216669 86.6117476,13.0216669 C86.1479154,13.0216669 85.6810116,13.1298596 85.2617196,13.3343494 C84.4489661,13.7307255 83.9993757,14.4572026 83.6159671,15.3128313 L82.629521,17.1692423 L81.432242,14.7856043 C81.1182268,14.1398469 80.5940769,13.6206919 79.9498501,13.3170726 C79.5273468,13.1094672 79.0586278,13 78.5907465,13 L70.9579012,13 C70.4393362,13 69.9249601,13.1324086 69.4702035,13.3829228 C68.4643496,13.9370564 67.8396701,15.0021313 67.8396701,16.1626537 L67.8396701,16.9888267 L67.118231,16.9888267 C65.3987569,16.9888267 64,18.4075105 64,20.1514804 C64,21.8953088 65.3987569,23.3141342 67.118231,23.3141342 L67.8396701,23.3141342 L67.8396701,24.045851 C67.8396701,25.7898209 69.2384271,27.2085047 70.9579012,27.2085047 C72.6772356,27.2085047 74.0761322,25.7898209 74.0761322,24.045851 L74.0761322,23.3141342 L76.8454419,23.3141342 C77.4447097,23.3141342 78.0051619,23.1417906 78.4808621,22.8432694 L79.7018772,25.2737814 C79.7628931,25.4128459 79.8342411,25.5478035 79.9148044,25.676955 C80.4777698,26.6157107 81.4933975,27.1964676 82.5793958,27.1964676 C83.0433676,27.1964676 83.5101319,27.0882749 83.9294239,26.883785 C84.6900974,26.5127577 85.3507999,25.8868262 85.688272,25.0843026 L86.5750264,23.0755155 L87.6797344,25.2746311 C87.740471,25.4128459 87.8114002,25.5470954 87.8915446,25.6756805 C88.4543704,26.6152859 89.4701377,27.1964676 90.5566945,27.1964676 C91.0206663,27.1964676 91.4874305,27.0882749 91.9067225,26.8839266 C92.6197842,26.5362655 93.1738137,25.920955 93.4590662,25.1817327 C93.9248531,26.3348912 95.0436632,27.1491687 96.3462189,27.1491687 L104.188501,27.1512929 C105.907835,27.1512929 107.306732,25.7898209 107.306732,24.045851 L107.306732,23.3141342 L108.028171,23.3141342 C109.747505,23.3141342 111.146402,21.8953088 111.146402,20.1514804 C111.146402,18.4075105 109.747505,16.9888267 108.028171,16.9888267 L107.306732,16.9888267 L107.306732,16.1626537 C107.306732,15.0022729 106.681913,13.9370564 105.676198,13.3829228 C105.221302,13.1324086 104.707066,13 104.188501,13 L104.188501,13 Z M97.3235895,22.9480633 L103.164635,22.9480633 L103.164635,21.1899321 L97.3235895,21.1899321 L97.3235895,22.9480633 Z M104.188501,15.1242021 C104.365265,15.1242021 104.531418,15.16966 104.676488,15.24953 C104.995669,15.425414 105.212366,15.7684018 105.212366,16.1626537 L105.212366,16.1626537 L105.212366,19.1130288 L108.028171,19.1130288 C108.59365,19.1130288 109.052036,19.5779459 109.052036,20.1514804 C109.052036,20.725015 108.59365,21.1899321 108.028171,21.1899321 L105.212366,21.1899321 L105.212366,23.9896304 C105.212366,24.563165 104.75398,25.028082 104.188501,25.028082 C104.069541,25.028082 96.3462189,25.0249665 96.3462189,25.0249665 C95.7806006,25.0249665 95.3222138,24.5599079 95.3222138,23.9863733 L95.3222138,20.1043232 L95.3245874,20.1043232 C95.3490217,19.5527387 95.7963782,19.1130288 96.3462189,19.1130288 L103.164635,19.1130288 L103.164635,17.2012469 L95.2947078,17.2012469 L91.5596163,24.230515 C91.4999967,24.5416398 91.3024282,24.8216096 90.9990245,24.9694541 C90.8561888,25.0391279 90.7053944,25.0722654 90.5566945,25.0722654 C90.2016297,25.0722654 89.8598293,24.8834947 89.6721741,24.556934 C89.6343359,24.4984477 89.6022223,24.4365626 89.5769503,24.37227 L86.6272459,18.4998425 L83.6430543,24.2412776 C83.5139017,24.548862 83.32499,24.821468 83.0215862,24.9694541 C82.8787505,25.0391279 82.7279562,25.0722654 82.5793958,25.0722654 C82.2241914,25.0722654 81.8825306,24.8836363 81.6947358,24.5570756 C81.656758,24.4984477 81.6246444,24.436421 81.5992328,24.3718452 L77.9974826,17.2012469 L71.9817666,17.2012469 L71.9817666,19.1130288 L76.8454419,19.1130288 C77.4109206,19.1130288 77.8693074,19.5779459 77.8693074,20.1514804 C77.8693074,20.725015 77.4109206,21.1899321 76.8454419,21.1899321 L71.9817666,21.1899321 L71.9817666,24.045851 C71.9817666,24.6193856 71.5233798,25.0843026 70.9579012,25.0843026 C70.3924225,25.0843026 69.9340357,24.6193856 69.9340357,24.045851 L69.9340357,21.1899321 L67.118231,21.1899321 C66.5527523,21.1899321 66.0943655,20.725015 66.0943655,20.1514804 C66.0943655,19.5779459 66.5527523,19.1130288 67.118231,19.1130288 L69.9340357,19.1130288 L69.9340357,16.1626537 L69.9340357,16.1626537 C69.9340357,15.7684018 70.1505931,15.425414 70.4697744,15.24953 C70.6148441,15.16966 70.7811367,15.1242021 70.9579012,15.1242021 L78.5907465,15.1242021 C78.7567599,15.1242021 78.9131392,15.16527 79.0517862,15.23636 C79.2659699,15.3329404 79.4488779,15.5035846 79.558483,15.7346978 L82.5773015,21.7450569 L85.605754,16.0047547 C85.7580842,15.690656 85.8424173,15.4081371 86.1695572,15.2485387 C86.3123929,15.1788649 86.4631873,15.145869 86.6117476,15.145869 C86.8650262,15.145869 87.1114632,15.2418829 87.300375,15.4152178 C87.4869131,15.5632039 87.573201,15.6633246 87.7012365,15.9148301 L90.5547398,21.7450569 L93.7571643,15.7184123 C93.84052,15.5698597 93.9548724,15.4509044 94.0866778,15.3635289 C94.2641404,15.2141267 94.4920073,15.1242021 94.7405387,15.1242021 L104.188501,15.1242021 L104.188501,15.1242021 Z",transform:"translate(-64 -13)"}),c=function(e){var t=e.svgRef,n=e.title,a=r(e,["svgRef","title"]);return o.a.createElement("svg",i({viewBox:"0 0 48 14",ref:t},a),o.a.createElement("title",null,n),s)},l=o.a.forwardRef((function(e,t){return o.a.createElement(c,i({svgRef:t},e))}));n.p},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(2),o=n.n(a);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createElement("path",{d:"M297.81 66.32c-9.52-16.12-31.88-28.94-54.5-28.94-50.66 0-91.72 40.92-91.72 91.39s41.06 91.39 91.72 91.39c21.87 0 44.37-13.1 54.5-28.59v28.59h36.55V37.38h-36.55zM243 183.6a54.83 54.83 0 1 1 54.83-54.83A54.83 54.83 0 0 1 243 183.6zM559.44 37.38c-23.07.17-45.19 12.74-54.36 33.49-9.17-20.15-31.56-33.49-54.83-33.49a50.81 50.81 0 0 0-45.7 29.7v-29.7H368v182.78h36.55v-109c0-20 15.77-36.79 35.76-37.22a36.57 36.57 0 0 1 37.35 36.55v109.67h36.56v-109c0-20 15.77-36.79 35.75-37.22a36.57 36.57 0 0 1 37.36 36.55v109.67h36.56V102.22c0-35.44-29-65.09-64.45-64.84zM52.84.93l.09 36.56h40.35v98.29a47.85 47.85 0 0 1-68.42 43.37L0 207.15a84.47 84.47 0 0 0 129.83-71V.93zM789.71 83.86L763 110.53a41.75 41.75 0 1 1-70.61 30.16h-37.7a79.48 79.48 0 1 0 135-56.83zM656.12 1.02h69.16v37.73h-69.16z"}),c=o.a.createElement("path",{d:"M697.666 88.631L786.295.002l26.68 26.68-88.63 88.628z"}),l=function(e){var t=e.svgRef,n=e.title,a=r(e,["svgRef","title"]);return o.a.createElement("svg",i({viewBox:"0 0 813.65 220.36",ref:t},a),o.a.createElement("title",null,n),s,c)},u=o.a.forwardRef((function(e,t){return o.a.createElement(l,i({svgRef:t},e))}));n.p},function(e,t,n){"use strict";var a=n(4),o=n(9),i=n(0),r=n(5),s=n(24),c=(n(29),n(53)),l=n(3),u=function(){function e(t,n,o,r,s,c,u,d,h,f,m,p,v){var g=this;Object(a.a)(this,e),this.smooth=function(e){return e<.5?2*e*e:(4-2*e)*e-1},this.computePoint=function(e,t,n,a){var o=e*(l.c/(g.totalPoints-1));g.point.x=g.center.x+g.radius*Math.cos(o-g.startAngle),g.point.y=g.center.y+g.radius*Math.sin(o-g.startAngle),g.normal.copy(g.point).sub(g.center).normalize();var i=Math.abs(g.offset.distanceTo(g.point)),r=l.f.clamp(l.f.mapLinear(i,0,g.distance2,1,0),0,1);r=g.smooth(r);var s=l.f.lerp(g.scalar,1.25*g.scalar,n);g.point.x=l.f.lerp(g.point.x,g.point.x+g.normal.x*s,r),g.point.y=l.f.lerp(g.point.y,g.point.y+g.normal.y*s,r),i=Math.abs(t.distanceTo(g.point)),r=l.f.clamp(l.f.mapLinear(i,0,g.distance,1,0),0,1),r=g.smooth(r),g.point.x=l.f.lerp(g.point.x,g.point.x+g.normal.x*s,r*n),g.point.y=l.f.lerp(g.point.y,g.point.y+g.normal.y*s,r*n)},this.radius=r,this.distance=s,this.distance2=c,this.totalPoints=u,this.center=new i.Pb(d,d),this.startAngle=h,this.lineWidth=p,this.transition=v,this.scalar=f,this.point=new i.Pb,this.normal=new i.Pb,this.centerInfluence=new i.Pb,this.offset=new i.Pb,this.offsetTheta=o*l.c,this.offsetRadius=.35*r,this.animateIn=!0,this.speed=1;var b=Math.cos(o*l.c)*m,x=Math.sin(o*l.c)*m,y=Math.cos(o*l.c+l.b)*m,w=Math.sin(o*l.c+l.b)*m;this.gradient=t.createLinearGradient(b,x,y,w),this.gradient.addColorStop(0,"rgba(255, 255, 255, 1"),this.gradient.addColorStop(.5,"rgba(255, 255, 255, ".concat(l.f.randFloat(.25,.35))),this.gradient.addColorStop(1,"rgba(255, 255, 255, 1")}return Object(o.a)(e,[{key:"draw",value:function(e,t,n,a){var o=t*this.speed;this.offset.x=this.center.x+Math.cos(this.offsetTheta+o)*this.offsetRadius,this.offset.y=this.center.y+Math.sin(this.offsetTheta+o)*this.offsetRadius,this.transition<1&&(e.save(),e.globalAlpha=this.transition),e.beginPath(),e.lineWidth=this.lineWidth,e.strokeStyle=this.gradient;for(var i=0;i<this.totalPoints;i++){var r=this.animateIn?i:this.totalPoints-i;this.computePoint(r,n,a,t),0===i?e.moveTo(this.point.x,this.point.y):this.transition>=i/this.totalPoints&&e.lineTo(this.point.x,this.point.y)}e.stroke(),e.closePath(),this.transition<1&&e.restore()}}]),e}(),d=n(70),h=n(1),f=n(17),m=n(14);n.d(t,"a",(function(){return p}));var p=function(){function e(t,n){var o,u,p=this;Object(a.a)(this,e),this.onConfigChange=function(){for(var e=0;e<p.rings.length;e++)p.rings[e].distance=p.canvasSize*p.config.distance,p.rings[e].totalPoints=p.config.points,p.rings[e].lineWidth=p.config.lineWidth,p.rings[e].scalar=l.f.lerp(p.config.scalarMin,p.config.scalarMax,p.layoutIndex),p.rings[e].distance2=p.config.distance2*p.canvasSize,p.rings[e].transition=p.config.transition},this.onMove=function(e){r.j.killTweensOf(p.mouse);var t=p.canvas.getBoundingClientRect(),n=(e[0].x-t.left)*p.pixelRatio,a=(e[0].y-t.top)*p.pixelRatio;r.j.to(p.mouse,.35,{x:n,y:a})},this.onHover=function(e){p.active&&(r.j.to(p,1,{ease:s.a.easeOut,strength:e?1:0}),e&&f.a.play(h.p,m.b))},this.animateIn=function(){p.config.animateIn=!0,p.animate()},this.animateOut=function(){p.config.animateIn=!1,p.animate()},this.animate=function(){r.j.killTweensOf(p.config),p.config.transition=0,r.j.to(p.config,2,{transition:1,onUpdate:function(){for(var e=0;e<p.rings.length;e++)p.rings[e].animateIn=p.config.animateIn,p.rings[e].transition=p.config.animateIn?p.config.transition:1-p.config.transition}})},this.render=function(e){p.isRendering!==e&&(p.isRendering=e,e?p.update():cancelAnimationFrame(p.rafId))},this.update=function(){p.rafId=requestAnimationFrame(p.update),p.draw()},this.draw=function(){p.ctx.clearRect(0,0,p.canvas.width,p.canvas.height),p.ctx.fillStyle="white",p.time+=p.clock.getDelta(),p.ctx.save(),p.ctx.globalCompositeOperation="lighten";for(var e=0;e<p.rings.length;e++)p.rings[e].draw(p.ctx,p.time,p.mouse,p.strength);p.ctx.restore(),p.config.debugMouse&&(p.ctx.beginPath(),p.ctx.fillStyle="blue",p.ctx.arc(p.mouse.x,p.mouse.y,10,0,l.c,!1),p.ctx.fill(),p.ctx.closePath(),p.ctx.beginPath(),p.ctx.strokeStyle="black",p.ctx.arc(p.mouse.x,p.mouse.y,p.config.distance,0,l.c,!1),p.ctx.stroke(),p.ctx.closePath())},this.pixelRatio=d.a[Object(h.K)()].pixelRatio,this.canvasSize=160*this.pixelRatio,this.canvasCenter=this.canvasSize/2,this.rafId=0,this.isRendering=!1,this.layoutIndex=1,(o=n).width=this.canvasSize,o.height=this.canvasSize,u=o.getContext("2d"),Object.assign(o.style,{width:"".concat(this.canvasSize/this.pixelRatio,"px"),height:"".concat(this.canvasSize/this.pixelRatio,"px")}),this.ctx=u,this.canvas=o,this.config={points:100,scalarMax:20,scalarMin:10,distance:.5,distance2:.75,totalRings:1,radiusScale:.011,showLine:!0,radius:.25,debugMouse:!1,easing:.25,lineWidth:3,transition:0,animateIn:!1},this.touchControls=new c.a(this.canvas),this.mouse=new i.Pb,this.clock=new i.n,this.time=0,this.strength=0,this.createRings()}return Object(o.a)(e,[{key:"bindEvents",value:function(e){this.active=e;var t=e?"on":"off";this.touchControls[t]("mousemove",this.onMove),this.touchControls[t]("hover",this.onHover)}},{key:"resize",value:function(e,t){e*this.pixelRatio!==this.canvasSize&&(this.layoutIndex=t,this.canvasSize=e*this.pixelRatio,this.canvasCenter=this.canvasSize/2,this.canvas.width=this.canvasSize,this.canvas.height=this.canvasSize,Object.assign(this.canvas.style,{width:"".concat(this.canvasSize/this.pixelRatio,"px"),height:"".concat(this.canvasSize/this.pixelRatio,"px")}),this.createRings())}},{key:"createRings",value:function(){this.rings=[];for(var e=0;e<this.config.totalRings;e++){var t=e/this.config.totalRings,n=this.canvasSize*this.config.radius*l.f.lerp(1-this.config.radiusScale,1+this.config.radiusScale,t),a=this.canvasSize*this.config.distance,o=this.canvasSize*this.config.distance2,i=this.config.points,r=Math.random()*l.c,s=this.config.lineWidth,c=l.f.lerp(this.config.scalarMin,this.config.scalarMax,this.layoutIndex),d=this.canvasSize,h=this.config.transition,f=new u(this.ctx,this.pixelRatio,t,n,a,o,i,this.canvasCenter,r,c,d,s,h);this.rings.push(f)}}}]),e}()},,,,,,,,,function(e,t,n){e.exports=n.p+"static/media/rotate.91da6633.svg"},,function(e,t,n){e.exports=n(174)},,function(e,t,n){},,,,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":30},{"x":0,"y":0,"z":20}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":20},{"x":0,"y":0,"z":15}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":15},{"x":0,"y":0,"z":3}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":8},{"x":0,"y":0,"z":10}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":10},{"x":0,"y":0,"z":30}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},function(e){e.exports=JSON.parse('{"origin":[{"x":0,"y":0,"z":-10},{"x":0,"y":0,"z":-20}],"lookat":[{"x":0,"y":0,"z":0},{"x":0,"y":0,"z":0}]}')},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t){!function(e){"use strict";var t,n=e.Uint8Array,a=e.HTMLCanvasElement,o=a&&a.prototype,i=/\s*;\s*base64\s*(?:;|$)/i,r="toDataURL",s=function(e){for(var a,o,i=e.length,r=new n(i/4*3|0),s=0,c=0,l=[0,0],u=0,d=0;i--;)o=e.charCodeAt(s++),255!==(a=t[o-43])&&void 0!==a&&(l[1]=l[0],l[0]=o,d=d<<6|a,4===++u&&(r[c++]=d>>>16,61!==l[1]&&(r[c++]=d>>>8),61!==l[0]&&(r[c++]=d),u=0));return r};n&&(t=new n([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),!a||o.toBlob&&o.toBlobHD||(o.toBlob||(o.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)e(this.mozGetAsFile("canvas",t));else if(this.msToBlob&&/^\s*image\/png\s*(?:$|;)/i.test(t))e(this.msToBlob());else{var a,o=Array.prototype.slice.call(arguments,1),c=this[r].apply(this,o),l=c.indexOf(","),u=c.substring(l+1),d=i.test(c.substring(0,l));Blob.fake?((a=new Blob).encoding=d?"base64":"URI",a.data=u,a.size=u.length):n&&(a=d?new Blob([s(u)],{type:t}):new Blob([decodeURIComponent(u)],{type:t})),e(a)}}),!o.toBlobHD&&o.toDataURLHD?o.toBlobHD=function(){r="toDataURLHD";var e=this.toBlob();return r="toDataURL",e}:o.toBlobHD=o.toBlob)}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content||this)},function(e,t,n){"use strict";n.r(t);n(103),n(104);var a=n(63),o=n(22),i=n(78),r=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}();function s(){var e=o.b.getName().toLowerCase(),t=parseFloat(o.b.getVersion()),n=o.e?o.e.getName().toLowerCase():"unknown",a="Unknown"===o.e.getVersion()?Number.MAX_SAFE_INTEGER:parseFloat(o.e.getVersion());if(o.a.isBot())return!0;var s=i[n],c=i[e];if(c||s){if(void 0!==s&&a<s)return!1;if(void 0!==c&&t<c)return!1}return!!r&&!!function(){var e=document.createElement("audio");return!(!e.canPlayType||!e.canPlayType("audio/mpeg;").replace(/no/,""))}()}var c=n(4),l=n(61),u=function e(t){Object(c.a)(this,e),this.event=t.event,this.action=t.action,this.label=t.label},d=function e(t){Object(c.a)(this,e),this.url=t.url};function h(e){Object(l.a)("trackEvent:",e),a.a.event({category:e.event,action:e.action,label:e.label})}function f(e){Object(l.a)("pageView:",e),a.a.pageview(e.url)}var m,p=n(10),v=n(15),g=new d({url:v.k.Landing}),b=new d({url:v.k.Past}),x=new d({url:v.k.Present}),y=new d({url:v.k.Future}),w=new d({url:v.h}),A=new d({url:v.a}),P=new d({url:v.d}),T=new d({url:v.j}),S=new u({event:"Back Button",action:"Click",label:"Browser-back"}),F=function(e){return new u({event:"ui",action:"Sound",label:"".concat(e?"off":"on")})},E=new u({event:"ui",action:"Click",label:"share"}),_=new u({event:"ui",action:"Click",label:"screenshot"}),O=(new u({event:"ui",action:"Click",label:"logo"}),m={},Object(p.a)(m,v.k.Landing,g),Object(p.a)(m,v.k.Past,b),Object(p.a)(m,v.k.Present,x),Object(p.a)(m,v.k.Future,y),Object(p.a)(m,v.k.Credit,A),Object(p.a)(m,v.k.NotFound,P),m);window.location.href.indexOf("unsupported")>=0?s()&&(window.location="/"):s()||(f(T),window.location="/unsupported.html");n(108);var C=n(23),I=n(2),M=n.n(I),L=n(66),N=n.n(L),k=n(36),j=n(73),U=n(60),R=n(52),D=n(21),X=n(42);var z=n(85);function Y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.a.SET_COPY:return t.copy;default:return e}}X.a.register("copy",Y);var B=n(54),Q=n(80),V="(min-width: ".concat(Q.b,"px)"),H="(min-width: ".concat(Q.a,"px)"),G=window.matchMedia(V),W=window.matchMedia(H),Z={get phone(){return!this.tablet},get tablet(){return G.matches},get desktop(){return W.matches},get all(){return{phone:this.phone,tablet:this.tablet,desktop:this.desktop}}},q={windowSize:{width:window.innerWidth,height:window.innerHeight},previousRoute:null,audioContextState:"",layout:Z.all};function K(e){return{type:D.a.SET_LAYOUT,layout:e}}function $(e){return{type:D.a.SET_AUDIO_CONTEXT_STATE,audioContextState:e}}var J,ee=n(7),te={},ne={windowSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.windowSize,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.windowSize;return n===D.a.SET_WINDOW_SIZE?a:e},audioContextState:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.audioContextState,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.audioContextState;return n===D.a.SET_AUDIO_CONTEXT_STATE?a:e},previousRoute:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.previousRoute,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.previousRoute;return n===D.a.SET_PREV_ROUTE?a:e},layout:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q.layout,t=arguments.length>1?arguments[1]:void 0,n=t.type,a=t.layout;return n===D.a.SET_LAYOUT&&Boolean(Object.keys(a).filter((function(t){return e[t]!==a[t]})).length)?a:e},isMobileMenuOpen:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.a.SET_IS_MOBILE_MENU_OPEN:return t.isOpen;default:return e}},routing:j.b,copy:Y,modals:B.a},ae=function(e){var t=Object.keys(e);return Object.keys(te).forEach((function(n){-1===t.indexOf(n)&&(e[n]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e})})),function(e){return function(t,n){switch(n.type){case D.a.BATCH_ACTIONS:return n.actions.reduce(e,t);default:return e(t,n)}}}(Object(R.c)(e))};X.a.setChangeListener((function(e){J.replaceReducer(ae(e))}));var oe=[function(){return function(e){return function(t){var n=e(t);switch(t.action&&t.action.type||t.type){case D.a.LOCATION_CHANGE:O[se.location.pathname]?f(O[se.location.pathname]):f(O[v.d])}return n}}}],ie=R.d.apply(void 0,[].concat([R.a.apply(void 0,oe)]));var re=ee.a.isDevelopment&&(o.c.device.isDesktop||ee.a.isBrowserSimulator)||ee.a.apiDev?"createBrowserHistory":"createMemoryHistory",se=(0,n(77)[re])(),ce=J=Object(R.e)((X.a.reducers=ne,ae(ne)),te,ie),le=n(9),ue=n(12),de=n(11),he=n(13),fe=n(30),me=n(178),pe=n(95),ve=n.n(pe),ge=(n(37),n(86),n(74)),be=n(177),xe=n(176),ye=n(34),we=n.n(ye),Ae=Object(I.lazy)((function(){return Promise.all([n.e(1),n.e(0),n.e(2)]).then(n.bind(null,201))})),Pe=Object(I.lazy)((function(){return Promise.all([n.e(1),n.e(0),n.e(3)]).then(n.bind(null,200))})),Te=Object(I.lazy)((function(){return Promise.all([n.e(1),n.e(0),n.e(7)]).then(n.bind(null,202))})),Se=function(e){var t=e.location,n=Object(ge.a)(e,["location"]);return M.a.createElement("main",{className:we()("Pages",n.className),role:"main"},M.a.createElement(I.Suspense,{fallback:M.a.createElement("div",{className:"loading"})},M.a.createElement(be.a,{location:t},M.a.createElement(xe.a,{exact:!0,path:v.k.Landing,render:function(){return M.a.createElement(Ae,null)}}),M.a.createElement(xe.a,{exact:!0,path:"".concat(v.k.Step),render:function(e){return function(e,t,n,a){return v.i.includes(e.params.value)?M.a.createElement(a,{match:e,location:t,history:n}):M.a.createElement(Te,null)}(e.match,e.location,e.history,Pe)}}),M.a.createElement(xe.a,{render:function(e){var t=e.history;return M.a.createElement(Te,{history:t})}}))))};Se.defaultProps={};var Fe=Object(me.a)(Se),Ee=n(5),_e=n(25),Oe=n(16),Ce=n.n(Oe),Ie=n(0),Me=n(6),Le=Le||{};Le.RendererStats=function(){var e=document.createElement("div");e.style.cssText="width:80px;opacity:0.9;cursor:pointer;z-index:100000;top:48px;position:absolute;";var t=document.createElement("div");t.style.cssText="padding:0 0 3px 3px;text-align:left;background-color:rgb(0, 0, 0);",e.appendChild(t);var n=document.createElement("div");n.style.cssText="color:rgb(255, 255, 255);font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",n.innerHTML="WebGLRenderer",t.appendChild(n);for(var a=[],o=0;o<9;o++)a[o]=document.createElement("div"),a[o].style.cssText="color:rgb(255, 255, 255);background-color:rgb(0, 0, 0);font-family:Helvetica,Arial,sans-serif;font-size:9px;font-weight:bold;line-height:15px",t.appendChild(a[o]),a[o].innerHTML="-";var i=Date.now();return{domElement:e,update:function(e){if(console.assert(e instanceof Ie.Vb),!(Date.now()-i<1e3/30)){i=Date.now();var t=0;a[t++].textContent="=== Memory ===",a[t++].textContent="Programs: "+e.info.programs.length,a[t++].textContent="Geometries: "+e.info.memory.geometries,a[t++].textContent="Textures: "+e.info.memory.textures,a[t++].textContent="=== Render ===",a[t++].textContent="Calls: "+e.info.render.calls,a[t++].textContent="Triangles: "+e.info.render.triangles,a[t++].textContent="Lines: "+e.info.render.lines,a[t++].textContent="Points: "+e.info.render.points}}}};var Ne,ke=new(0,Le.RendererStats),je=n(33),Ue=n(45),Re={devCamera:"true"===Object(Ue.a)("devCamera")&&ee.a.isDevelopment},De=n(1),Xe=n(8),ze=function(){function e(t){var n=this;Object(c.a)(this,e),this.onUpdate=function(){n.light.color.setHex(Number("".concat(n.settings.color).replace("#","0x")))},this.settings={color:13948116,intensity:.6},Object.assign(this.settings,t),this.light=new Ie.b(this.settings.color,this.settings.intensity)}return Object(le.a)(e,[{key:"gui",value:function(e){this.guiParent=e,this.gui=e.addFolder("ambient"),this.gui.add(this.light,"intensity",0,1),this.gui.addColor(this.settings,"color").onChange(this.onUpdate)}},{key:"dispose",value:function(){this.guiParent.removeFolder(this.gui.name)}}]),e}(),Ye=function(){function e(t,n){var a=this;Object(c.a)(this,e),this.onUpdate=function(){a.light.color.setHex(Number("".concat(a.settings.color).replace("#","0x")))},this.settings={color:13948116,intensity:.6},Object.assign(this.settings,t),this.light=new Ie.u(this.settings.color,this.settings.intensity),this.light.position.set(1,1,1)}return Object(le.a)(e,[{key:"gui",value:function(e){this.guiParent=e,this.gui=e.addFolder("directional"),this.gui.addColor(this.settings,"color").onChange(this.onUpdate),this.gui.add(this.light,"intensity",0,1);this.gui.add(this.light.position,"x",-100,100).step(De.s).name("direction x"),this.gui.add(this.light.position,"y",-100,100).step(De.s).name("direction y"),this.gui.add(this.light.position,"z",-100,100).step(De.s).name("direction z")}},{key:"dispose",value:function(){this.guiParent.removeFolder(this.gui.name)}}]),e}(),Be=function(){function e(){Object(c.a)(this,e),this.ambient=new ze({ambient:13490661,intensity:.7}),this.directional=new Ye({intensity:.6}),this.directional.light.position.set(0,0,1)}return Object(le.a)(e,[{key:"gui",value:function(e){var t=e.addFolder("lights");this.ambient.gui(t),this.directional.gui(t)}},{key:"get",value:function(){return[this.ambient.light,this.directional.light]}},{key:"dispose",value:function(e){this.get().forEach((function(e){e.dispose()}))}}]),e}(),Qe=n(43),Ve=n.n(Qe),He=n(50);((Ne=function(e,t){this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.target=new Ie.Qb,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:Ie.R.LEFT,MIDDLE:Ie.R.MIDDLE,RIGHT:Ie.R.RIGHT},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(a),n.update(),s=r.NONE},this.update=function(){var t=new Ie.Qb,o=(new Ie.rb).setFromUnitVectors(e.up,new Ie.Qb(0,1,0)),i=o.clone().inverse(),m=new Ie.Qb,p=new Ie.rb;return function(){var e=n.object.position;return t.copy(e).sub(n.target),t.applyQuaternion(o),l.setFromVector3(t),n.autoRotate&&s===r.NONE&&T(2*Math.PI/60/60*n.autoRotateSpeed),l.theta+=u.theta,l.phi+=u.phi,l.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,l.theta)),l.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,l.phi)),l.makeSafe(),l.radius*=d,l.radius=Math.max(n.minDistance,Math.min(n.maxDistance,l.radius)),n.target.add(h),t.setFromSpherical(l),t.applyQuaternion(i),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(u.theta*=1-n.dampingFactor,u.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(u.set(0,0,0),h.set(0,0,0)),d=1,!!(f||m.distanceToSquared(n.object.position)>c||8*(1-p.dot(n.object.quaternion))>c)&&(n.dispatchEvent(a),m.copy(n.object.position),p.copy(n.object.quaternion),f=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",X,!1),n.domElement.removeEventListener("mousedown",M,!1),n.domElement.removeEventListener("wheel",k,!1),n.domElement.removeEventListener("touchstart",U,!1),n.domElement.removeEventListener("touchend",D,!1),n.domElement.removeEventListener("touchmove",R,!1),document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",N,!1),window.removeEventListener("keydown",j,!1)};var n=this,a={type:"change"},o={type:"start"},i={type:"end"},r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY_PAN:4},s=r.NONE,c=1e-6,l=new Ie.Fb,u=new Ie.Fb,d=1,h=new Ie.Qb,f=!1,m=new Ie.Pb,p=new Ie.Pb,v=new Ie.Pb,g=new Ie.Pb,b=new Ie.Pb,x=new Ie.Pb,y=new Ie.Pb,w=new Ie.Pb,A=new Ie.Pb;function P(){return Math.pow(.95,n.zoomSpeed)}function T(e){u.theta-=e}function S(e){u.phi-=e}var F=function(){var e=new Ie.Qb;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),h.add(e)}}(),E=function(){var e=new Ie.Qb;return function(t,a){!0===n.screenSpacePanning?e.setFromMatrixColumn(a,1):(e.setFromMatrixColumn(a,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),h.add(e)}}(),_=function(){var e=new Ie.Qb;return function(t,a){var o=n.domElement===document?n.domElement.body:n.domElement;if(n.object.isPerspectiveCamera){var i=n.object.position;e.copy(i).sub(n.target);var r=e.length();r*=Math.tan(n.object.fov/2*Math.PI/180),F(2*t*r/o.clientHeight,n.object.matrix),E(2*a*r/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(F(t*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),E(a*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function O(e){n.object.isPerspectiveCamera?d/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function C(e){n.object.isPerspectiveCamera?d*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),f=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function I(e){g.set(e.clientX,e.clientY)}function M(e){if(!1!==n.enabled){switch(n.domElement.focus?n.domElement.focus():window.focus(),e.button){case n.mouseButtons.LEFT:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;I(e),s=r.PAN}else{if(!1===n.enableRotate)return;!function(e){m.set(e.clientX,e.clientY)}(e),s=r.ROTATE}break;case n.mouseButtons.MIDDLE:if(!1===n.enableZoom)return;!function(e){y.set(e.clientX,e.clientY)}(e),s=r.DOLLY;break;case n.mouseButtons.RIGHT:if(!1===n.enablePan)return;I(e),s=r.PAN}s!==r.NONE&&(document.addEventListener("mousemove",L,{passive:!1}),document.addEventListener("mouseup",N,{passive:!1}),n.dispatchEvent(o))}}function L(e){if(!1!==n.enabled)switch(s){case r.ROTATE:if(!1===n.enableRotate)return;!function(e){p.set(e.clientX,e.clientY),v.subVectors(p,m).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;T(2*Math.PI*v.x/t.clientHeight),S(2*Math.PI*v.y/t.clientHeight),m.copy(p),n.update()}(e);break;case r.DOLLY:if(!1===n.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),A.subVectors(w,y),A.y>0?O(P()):A.y<0&&C(P()),y.copy(w),n.update()}(e);break;case r.PAN:if(!1===n.enablePan)return;!function(e){b.set(e.clientX,e.clientY),x.subVectors(b,g).multiplyScalar(n.panSpeed),_(x.x,x.y),g.copy(b),n.update()}(e)}}function N(e){!1!==n.enabled&&(document.removeEventListener("mousemove",L,!1),document.removeEventListener("mouseup",N,!1),n.dispatchEvent(i),s=r.NONE)}function k(e){!1===n.enabled||!1===n.enableZoom||s!==r.NONE&&s!==r.ROTATE||(e.stopPropagation(),n.dispatchEvent(o),function(e){e.deltaY<0?C(P()):e.deltaY>0&&O(P()),n.update()}(e),n.dispatchEvent(i))}function j(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&function(e){var t=!1;switch(e.keyCode){case n.keys.UP:_(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:_(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:_(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:_(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function U(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:if(!1===n.enableRotate)return;!function(e){m.set(e.touches[0].pageX,e.touches[0].pageY)}(e),s=r.TOUCH_ROTATE;break;case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){if(n.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+a*a);y.set(0,o)}if(n.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(i,r)}}(e),s=r.TOUCH_DOLLY_PAN;break;default:s=r.NONE}s!==r.NONE&&n.dispatchEvent(o)}}function R(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===n.enableRotate)return;if(s!==r.TOUCH_ROTATE)return;!function(e){p.set(e.touches[0].pageX,e.touches[0].pageY),v.subVectors(p,m).multiplyScalar(n.rotateSpeed);var t=n.domElement===document?n.domElement.body:n.domElement;T(2*Math.PI*v.x/t.clientHeight),S(2*Math.PI*v.y/t.clientHeight),m.copy(p),n.update()}(e);break;case 2:if(!1===n.enableZoom&&!1===n.enablePan)return;if(s!==r.TOUCH_DOLLY_PAN)return;!function(e){if(n.enableZoom){var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+a*a);w.set(0,o),A.set(0,Math.pow(w.y/y.y,n.zoomSpeed)),O(A.y),y.copy(w)}if(n.enablePan){var i=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);b.set(i,r),x.subVectors(b,g).multiplyScalar(n.panSpeed),_(x.x,x.y),g.copy(b)}n.update()}(e);break;default:s=r.NONE}}function D(e){!1!==n.enabled&&(n.dispatchEvent(i),s=r.NONE)}function X(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",X,{passive:!1}),n.domElement.addEventListener("mousedown",M,{passive:!1}),n.domElement.addEventListener("wheel",k,{passive:!1}),n.domElement.addEventListener("touchstart",U,{passive:!1}),n.domElement.addEventListener("touchend",D,{passive:!1}),n.domElement.addEventListener("touchmove",R,{passive:!1}),window.addEventListener("keydown",j,{passive:!1}),this.update()}).prototype=Object.create(Ie.y.prototype)).constructor=Ne,Object.defineProperties(Ne.prototype,{center:{get:function(){return console.warn("OrbitControls: .center has been renamed to .target"),this.target}},noZoom:{get:function(){return console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),!this.enableZoom},set:function(e){console.warn("OrbitControls: .noZoom has been deprecated. Use .enableZoom instead."),this.enableZoom=!e}},noRotate:{get:function(){return console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),!this.enableRotate},set:function(e){console.warn("OrbitControls: .noRotate has been deprecated. Use .enableRotate instead."),this.enableRotate=!e}},noPan:{get:function(){return console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),!this.enablePan},set:function(e){console.warn("OrbitControls: .noPan has been deprecated. Use .enablePan instead."),this.enablePan=!e}},noKeys:{get:function(){return console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),!this.enableKeys},set:function(e){console.warn("OrbitControls: .noKeys has been deprecated. Use .enableKeys instead."),this.enableKeys=!e}},staticMoving:{get:function(){return console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),!this.enableDamping},set:function(e){console.warn("OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead."),this.enableDamping=!e}},dynamicDampingFactor:{get:function(){return console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor},set:function(e){console.warn("OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead."),this.dampingFactor=e}}});var Ge=Ne;function We(){return window.innerWidth/window.innerHeight}function Ze(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;e.position.set(1*t,1*t,1*t),e.lookAt(De.J)}function qe(){return new Ie.lb(65,We(),.01,1e4)}var Ke=qe(),$e={dev:Ke},Je=new Ge(Ke,Me.b.domElement);Ze(Ke,20);var et=n(18),tt=function(e){function t(){return Object(c.a)(this,t),Object(ue.a)(this,Object(de.a)(t).apply(this,arguments))}return Object(he.a)(t,e),t}(Ce.a);tt.json="json",tt.image="image",tt.texture="texture",tt.textureAtlas="textureAtlas",tt.cubeTexture="cubeTexture",tt.fbx="fbx",tt.obj="obj",tt.sound="sound";var nt=tt,at=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){var e=new Image;e.onload=function(){n.asset.data=e,n.emit("loaded",n.asset)},e.onerror=function(){n.emit("error","Failed to load ".concat(n.asset.src))},e.src=n.asset.src},n.asset=e,n}return Object(he.a)(t,e),t}(nt),ot=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===e.readyState&&(4===e.readyState&&200===e.status?(n.asset.data=JSON.parse(e.responseText),n.emit("loaded",n.asset)):n.emit("error","Failed to load ".concat(n.asset.src)))},e.open("GET",n.asset.src,!0),e.send()},n.asset=e,n}return Object(he.a)(t,e),t}(nt),it=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){(new Ie.Jb).load(n.asset.src,(function(e){n.asset.data=e,n.emit("loaded",n.asset)}),(function(){}),(function(){n.emit("error","Failed to load ".concat(n.asset.src))}))},n.asset=e,n}return Object(he.a)(t,e),t}(nt),rt=n(29);var st,ct=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){var e=new Image;e.onload=function(){n.asset.data=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=0;n<t.length;n++){var a=e.width*t[n].position[0],o=0,i=e.width*t[n].size[0],r=e.height*t[n].size[1],s=0,c=0,l=e.width*t[n].size[0],u=e.height*t[n].size[1],d=Object(rt.a)(i,r),h=d.canvas,f=d.ctx;f.drawImage(e,a,o,i,r,s,c,l,u),t[n].data=new Ie.k(h)}return t}(e,n.asset.args.atlas),n.emit("loaded",n.asset)},e.onerror=function(){n.emit("error","Failed to load ".concat(n.asset.src))},e.src=n.asset.src},n.asset=e,n}return Object(he.a)(t,e),t}(nt),lt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){var e=new Ie.r;e.format=Ie.vb,e.mapping=Ie.q,e.encoding=Ie.Wb;for(var t=[],a=["px","py","pz","nx","ny","nz"],o=0;o<a.length;o++)t.push("".concat(n.asset.src,"/").concat(a[o],"-").concat(n.asset.args.size,".").concat(n.asset.args.extension));e.load(t,(function(e){n.asset.data=e,n.emit("loaded",n.asset)}),(function(){}),(function(){n.emit("error","Failed to load ".concat(t))}))},n.asset=e,n}return Object(he.a)(t,e),t}(nt),ut=n(81),dt={findSpan:function(e,t,n){var a=n.length-e-1;if(t>=n[a])return a-1;if(t<=n[e])return e;for(var o=e,i=a,r=Math.floor((o+i)/2);t<n[r]||t>=n[r+1];)t<n[r]?i=r:o=r,r=Math.floor((o+i)/2);return r},calcBasisFunctions:function(e,t,n,a){var o=[],i=[],r=[];o[0]=1;for(var s=1;s<=n;++s){i[s]=t-a[e+1-s],r[s]=a[e+s]-t;for(var c=0,l=0;l<s;++l){var u=r[l+1],d=i[s-l],h=o[l]/(u+d);o[l]=c+u*h,c=d*h}o[s]=c}return o},calcBSplinePoint:function(e,t,n,a){for(var o=this.findSpan(e,a,t),i=this.calcBasisFunctions(o,a,e,t),r=new Ie.Rb(0,0,0,0),s=0;s<=e;++s){var c=n[o-e+s],l=i[s],u=c.w*l;r.x+=c.x*u,r.y+=c.y*u,r.z+=c.z*u,r.w+=c.w*l}return r},calcBasisFunctionDerivatives:function(e,t,n,a,o){for(var i=[],r=0;r<=n;++r)i[r]=0;var s=[];for(r=0;r<=a;++r)s[r]=i.slice(0);var c=[];for(r=0;r<=n;++r)c[r]=i.slice(0);c[0][0]=1;for(var l=i.slice(0),u=i.slice(0),d=1;d<=n;++d){l[d]=t-o[e+1-d],u[d]=o[e+d]-t;for(var h=0,f=0;f<d;++f){var m=u[f+1],p=l[d-f];c[d][f]=m+p;var v=c[f][d-1]/c[d][f];c[f][d]=h+m*v,h=p*v}c[d][d]=h}for(d=0;d<=n;++d)s[0][d]=c[d][n];for(f=0;f<=n;++f){var g=0,b=1,x=[];for(r=0;r<=n;++r)x[r]=i.slice(0);x[0][0]=1;for(var y=1;y<=a;++y){var w=0,A=f-y,P=n-y;f>=y&&(x[b][0]=x[g][0]/c[P+1][A],w=x[b][0]*c[A][P]);var T=f-1<=P?y-1:n-f;for(d=A>=-1?1:-A;d<=T;++d)x[b][d]=(x[g][d]-x[g][d-1])/c[P+1][A+d],w+=x[b][d]*c[A+d][P];f<=P&&(x[b][y]=-x[g][y-1]/c[P+1][f],w+=x[b][y]*c[f][P]),s[y][f]=w;d=g;g=b,b=d}}for(f=n,y=1;y<=a;++y){for(d=0;d<=n;++d)s[y][d]*=f;f*=n-y}return s},calcBSplineDerivatives:function(e,t,n,a,o){for(var i=o<e?o:e,r=[],s=this.findSpan(e,a,t),c=this.calcBasisFunctionDerivatives(s,a,e,i,t),l=[],u=0;u<n.length;++u){var d=(f=n[u].clone()).w;f.x*=d,f.y*=d,f.z*=d,l[u]=f}for(var h=0;h<=i;++h){for(var f=l[s-e].clone().multiplyScalar(c[h][0]),m=1;m<=e;++m)f.add(l[s-e+m].clone().multiplyScalar(c[h][m]));r[h]=f}for(h=i+1;h<=o+1;++h)r[h]=new Ie.Rb(0,0,0);return r},calcKoverI:function(e,t){for(var n=1,a=2;a<=e;++a)n*=a;var o=1;for(a=2;a<=t;++a)o*=a;for(a=2;a<=e-t;++a)o*=a;return n/o},calcRationalCurveDerivatives:function(e){for(var t=e.length,n=[],a=[],o=0;o<t;++o){var i=e[o];n[o]=new Ie.Qb(i.x,i.y,i.z),a[o]=i.w}for(var r=[],s=0;s<t;++s){var c=n[s].clone();for(o=1;o<=s;++o)c.sub(r[s-o].clone().multiplyScalar(this.calcKoverI(s,o)*a[o]));r[s]=c.divideScalar(a[0])}return r},calcNURBSDerivatives:function(e,t,n,a,o){var i=this.calcBSplineDerivatives(e,t,n,a,o);return this.calcRationalCurveDerivatives(i)},calcSurfacePoint:function(e,t,n,a,o,i,r,s){for(var c=this.findSpan(e,i,n),l=this.findSpan(t,r,a),u=this.calcBasisFunctions(c,i,e,n),d=this.calcBasisFunctions(l,r,t,a),h=[],f=0;f<=t;++f){h[f]=new Ie.Rb(0,0,0,0);for(var m=0;m<=e;++m){var p=o[c-e+m][l-t+f].clone(),v=p.w;p.x*=v,p.y*=v,p.z*=v,h[f].add(p.multiplyScalar(u[m]))}}var g=new Ie.Rb(0,0,0,0);for(f=0;f<=t;++f)g.add(h[f].multiplyScalar(d[f]));g.divideScalar(g.w),s.set(g.x,g.y,g.z)}};((st=function(e,t,n,a,o){Ie.s.call(this),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=a||0,this.endKnot=o||this.knots.length-1;for(var i=0;i<n.length;++i){var r=n[i];this.controlPoints[i]=new Ie.Rb(r.x,r.y,r.z,r.w)}}).prototype=Object.create(Ie.s.prototype)).constructor=st,st.prototype.getPoint=function(e){var t=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=dt.calcBSplinePoint(this.degree,this.knots,this.controlPoints,t);return 1!=n.w&&n.divideScalar(n.w),new Ie.Qb(n.x,n.y,n.z)},st.prototype.getTangent=function(e){var t=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),n=dt.calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,t,1)[1].clone();return n.normalize(),n};var ht,ft=st;(ht=function(e){this.manager=void 0!==e?e:Ie.t}).prototype={constructor:ht,load:function(e,t,n,a){var o=this,i=new Ie.Ib,r=new Ie.z(this.manager);return r.setResponseType("arraybuffer"),r.setPath(this.path),r.load(e,(function(e){i.image=o.parse(e),i.needsUpdate=!0,void 0!==t&&t(i)}),n,a),i},parse:function(e){var t=0,n=1,a=2,o=3,i=9,r=10,s=11,c=48,l=4,u=0,d=1,h=2,f=3;e.length<19&&console.error("TGALoader: Not enough data to contain header.");var m=new Uint8Array(e),p=0,v={id_length:m[p++],colormap_type:m[p++],image_type:m[p++],colormap_index:m[p++]|m[p++]<<8,colormap_length:m[p++]|m[p++]<<8,colormap_size:m[p++],origin:[m[p++]|m[p++]<<8,m[p++]|m[p++]<<8],width:m[p++]|m[p++]<<8,height:m[p++]|m[p++]<<8,pixel_size:m[p++],flags:m[p++]};!function(e){switch(e.image_type){case n:case i:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("TGALoader: Invalid type colormap data for indexed type.");break;case a:case o:case r:case s:e.colormap_type&&console.error("TGALoader: Invalid type colormap data for colormap type.");break;case t:console.error("TGALoader: No data.");default:console.error('TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('TGALoader: Invalid pixel size "%s".',e.pixel_size)}(v),v.id_length+p>e.length&&console.error("TGALoader: No data."),p+=v.id_length;var g=!1,b=!1,x=!1;switch(v.image_type){case i:g=!0,b=!0;break;case n:b=!0;break;case r:g=!0;break;case a:break;case s:g=!0,x=!0;break;case o:x=!0}var y="undefined"!==typeof OffscreenCanvas,w=y?new OffscreenCanvas(v.width,v.height):document.createElement("canvas");w.width=v.width,w.height=v.height;var A=w.getContext("2d"),P=A.createImageData(v.width,v.height),T=function(e,t,n,a,o){var i,r,s,c;if(r=n.pixel_size>>3,s=n.width*n.height*r,t&&(c=o.subarray(a,a+=n.colormap_length*(n.colormap_size>>3))),e){var l,u,d;i=new Uint8Array(s);for(var h=0,f=new Uint8Array(r);h<s;)if(u=1+(127&(l=o[a++])),128&l){for(d=0;d<r;++d)f[d]=o[a++];for(d=0;d<u;++d)i.set(f,h+d*r);h+=r*u}else{for(u*=r,d=0;d<u;++d)i[h+d]=o[a++];h+=u}}else i=o.subarray(a,a+=t?n.width*n.height:s);return{pixel_data:i,palettes:c}}(g,b,v,p,m);!function(e,t,n,a,o){var i,r,s,m,p,g;switch((v.flags&c)>>l){default:case h:i=0,s=1,p=t,r=0,m=1,g=n;break;case u:i=0,s=1,p=t,r=n-1,m=-1,g=-1;break;case f:i=t-1,s=-1,p=-1,r=0,m=1,g=n;break;case d:i=t-1,s=-1,p=-1,r=n-1,m=-1,g=-1}if(x)switch(v.pixel_size){case 8:!function(e,t,n,a,o,i,r,s){var c,l,u,d=0,h=v.width;for(u=t;u!==a;u+=n)for(l=o;l!==r;l+=i,d++)c=s[d],e[4*(l+h*u)+0]=c,e[4*(l+h*u)+1]=c,e[4*(l+h*u)+2]=c,e[4*(l+h*u)+3]=255}(e,r,m,g,i,s,p,a);break;case 16:!function(e,t,n,a,o,i,r,s){var c,l,u=0,d=v.width;for(l=t;l!==a;l+=n)for(c=o;c!==r;c+=i,u+=2)e[4*(c+d*l)+0]=s[u+0],e[4*(c+d*l)+1]=s[u+0],e[4*(c+d*l)+2]=s[u+0],e[4*(c+d*l)+3]=s[u+1]}(e,r,m,g,i,s,p,a);break;default:console.error("TGALoader: Format not supported.")}else switch(v.pixel_size){case 8:!function(e,t,n,a,o,i,r,s,c){var l,u,d,h=c,f=0,m=v.width;for(d=t;d!==a;d+=n)for(u=o;u!==r;u+=i,f++)l=s[f],e[4*(u+m*d)+3]=255,e[4*(u+m*d)+2]=h[3*l+0],e[4*(u+m*d)+1]=h[3*l+1],e[4*(u+m*d)+0]=h[3*l+2]}(e,r,m,g,i,s,p,a,o);break;case 16:!function(e,t,n,a,o,i,r,s){var c,l,u,d=0,h=v.width;for(u=t;u!==a;u+=n)for(l=o;l!==r;l+=i,d+=2)c=s[d+0]+(s[d+1]<<8),e[4*(l+h*u)+0]=(31744&c)>>7,e[4*(l+h*u)+1]=(992&c)>>2,e[4*(l+h*u)+2]=(31&c)>>3,e[4*(l+h*u)+3]=32768&c?0:255}(e,r,m,g,i,s,p,a);break;case 24:!function(e,t,n,a,o,i,r,s){var c,l,u=0,d=v.width;for(l=t;l!==a;l+=n)for(c=o;c!==r;c+=i,u+=3)e[4*(c+d*l)+3]=255,e[4*(c+d*l)+2]=s[u+0],e[4*(c+d*l)+1]=s[u+1],e[4*(c+d*l)+0]=s[u+2]}(e,r,m,g,i,s,p,a);break;case 32:!function(e,t,n,a,o,i,r,s){var c,l,u=0,d=v.width;for(l=t;l!==a;l+=n)for(c=o;c!==r;c+=i,u+=4)e[4*(c+d*l)+2]=s[u+0],e[4*(c+d*l)+1]=s[u+1],e[4*(c+d*l)+0]=s[u+2],e[4*(c+d*l)+3]=s[u+3]}(e,r,m,g,i,s,p,a);break;default:console.error("TGALoader: Format not supported.")}}(P.data,v.width,v.height,T.pixel_data,T.palettes);return A.putImageData(P,0,0),y?w.transferToImageBitmap():w},setPath:function(e){return this.path=e,this}};var mt,pt=ht,vt=function(){var e,t,n;function a(e){this.manager=void 0!==e?e:Ie.t}function o(e){this.textureLoader=e}function i(){}function r(){}function s(){}function c(){}function l(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}function u(){}function d(e){var t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw new Error("FBXLoader: Cannot find the version number for the file given.")}function h(e){return e/46186158e3}a.prototype={constructor:a,crossOrigin:"anonymous",load:function(e,t,n,a){var o=this,i=void 0===o.path?Ie.Q.extractUrlBase(e):o.path,r=new Ie.z(this.manager);r.setPath(o.path),r.setResponseType("arraybuffer"),r.load(e,(function(n){try{t(o.parse(n,i))}catch(r){setTimeout((function(){a&&a(r),o.manager.itemError(e)}),0)}}),n,a)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setCrossOrigin:function(e){return this.crossOrigin=e,this},parse:function(t,n){if(function(e){var t="Kaydara FBX Binary  \0";return e.byteLength>=t.length&&t===y(e,0,t.length)}(t))e=(new c).parse(t);else{var a=y(t);if(!function(e){var t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],n=0;function a(t){var a=e[t-1];return e=e.slice(n+t),n++,a}for(var o=0;o<t.length;++o){if(a(1)===t[o])return!1}return!0}(a))throw new Error("FBXLoader: Unknown format.");if(d(a)<7e3)throw new Error("FBXLoader: FBX version not supported, FileVersion: "+d(a));e=(new s).parse(a)}return new o(new Ie.Jb(this.manager).setPath(this.resourcePath||n).setCrossOrigin(this.crossOrigin)).parse(e)}},o.prototype={constructor:o,parse:function(){t=this.parseConnections();var e=this.parseImages(),a=this.parseTextures(e),o=this.parseMaterials(a),r=this.parseDeformers(),s=(new i).parse(r);return this.parseScene(r,s,o),n},parseConnections:function(){var t=new Map;"Connections"in e&&e.Connections.connections.forEach((function(e){var n=e[0],a=e[1],o=e[2];t.has(n)||t.set(n,{parents:[],children:[]});var i={ID:a,relationship:o};t.get(n).parents.push(i),t.has(a)||t.set(a,{parents:[],children:[]});var r={ID:n,relationship:o};t.get(a).children.push(r)}));return t},parseImages:function(){var t={},n={};if("Video"in e.Objects){var a=e.Objects.Video;for(var o in a){var i=a[o];if(t[l=parseInt(o)]=i.RelativeFilename||i.Filename,"Content"in i){var r=i.Content instanceof ArrayBuffer&&i.Content.byteLength>0,s="string"===typeof i.Content&&""!==i.Content;if(r||s){var c=this.parseImage(a[o]);n[i.RelativeFilename||i.Filename]=c}}}}for(var l in t){var u=t[l];void 0!==n[u]?t[l]=n[u]:t[l]=t[l].split("\\").pop()}return t},parseImage:function(e){var t,n=e.Content,a=e.RelativeFilename||e.Filename,o=a.slice(a.lastIndexOf(".")+1).toLowerCase();switch(o){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":if("function"!==typeof pt)return void console.warn("FBXLoader: TGALoader is required to load TGA textures");if(null===Ie.P.Handlers.get(".tga")){var i=new pt;i.setPath(this.textureLoader.path),Ie.P.Handlers.add(/\.tga$/i,i)}t="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+o+'" is not supported.')}if("string"===typeof n)return"data:"+t+";base64,"+n;var r=new Uint8Array(n);return window.URL.createObjectURL(new Blob([r],{type:t}))},parseTextures:function(t){var n=new Map;if("Texture"in e.Objects){var a=e.Objects.Texture;for(var o in a){var i=this.parseTexture(a[o],t);n.set(parseInt(o),i)}}return n},parseTexture:function(e,t){var n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;var a=e.WrapModeU,o=e.WrapModeV,i=void 0!==a?a.value:0,r=void 0!==o?o.value:0;if(n.wrapS=0===i?Ie.xb:Ie.m,n.wrapT=0===r?Ie.xb:Ie.m,"Scaling"in e){var s=e.Scaling.value;n.repeat.x=s[0],n.repeat.y=s[1]}return n},loadTexture:function(e,n){var a,o,i=this.textureLoader.path,r=t.get(e.id).children;void 0!==r&&r.length>0&&void 0!==n[r[0].ID]&&(0!==(a=n[r[0].ID]).indexOf("blob:")&&0!==a.indexOf("data:")||this.textureLoader.setPath(void 0));var s=e.FileName.slice(-3).toLowerCase();if("tga"===s){var c=Ie.P.Handlers.get(".tga");null===c?(console.warn("FBXLoader: TGALoader not found, creating empty placeholder texture for",a),o=new Ie.Ib):o=c.load(a)}else"psd"===s?(console.warn("FBXLoader: PSD textures are not supported, creating empty placeholder texture for",a),o=new Ie.Ib):o=this.textureLoader.load(a);return this.textureLoader.setPath(i),o},parseMaterials:function(t){var n=new Map;if("Material"in e.Objects){var a=e.Objects.Material;for(var o in a){var i=this.parseMaterial(a[o],t);null!==i&&n.set(parseInt(o),i)}}return n},parseMaterial:function(e,n){var a=e.id,o=e.attrName,i=e.ShadingModel;if("object"===typeof i&&(i=i.value),!t.has(a))return null;var r,s=this.parseParameters(e,n,a);switch(i.toLowerCase()){case"phong":r=new Ie.cb;break;case"lambert":r=new Ie.Z;break;default:console.warn('FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',i),r=new Ie.cb}return r.setValues(s),r.name=o,r},parseParameters:function(e,n,a){var o={};e.BumpFactor&&(o.bumpScale=e.BumpFactor.value),e.Diffuse?o.color=(new Ie.o).fromArray(e.Diffuse.value):e.DiffuseColor&&"Color"===e.DiffuseColor.type&&(o.color=(new Ie.o).fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(o.displacementScale=e.DisplacementFactor.value),e.Emissive?o.emissive=(new Ie.o).fromArray(e.Emissive.value):e.EmissiveColor&&"Color"===e.EmissiveColor.type&&(o.emissive=(new Ie.o).fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(o.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(o.opacity=parseFloat(e.Opacity.value)),o.opacity<1&&(o.transparent=!0),e.ReflectionFactor&&(o.reflectivity=e.ReflectionFactor.value),e.Shininess&&(o.shininess=e.Shininess.value),e.Specular?o.specular=(new Ie.o).fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(o.specular=(new Ie.o).fromArray(e.SpecularColor.value));var i=this;return t.get(a).children.forEach((function(e){var t=e.relationship;switch(t){case"Bump":o.bumpMap=i.getTexture(n,e.ID);break;case"Maya|TEX_ao_map":o.aoMap=i.getTexture(n,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":o.map=i.getTexture(n,e.ID);break;case"DisplacementColor":o.displacementMap=i.getTexture(n,e.ID);break;case"EmissiveColor":o.emissiveMap=i.getTexture(n,e.ID);break;case"NormalMap":case"Maya|TEX_normal_map":o.normalMap=i.getTexture(n,e.ID);break;case"ReflectionColor":o.envMap=i.getTexture(n,e.ID),o.envMap.mapping=Ie.w;break;case"SpecularColor":o.specularMap=i.getTexture(n,e.ID);break;case"TransparentColor":o.alphaMap=i.getTexture(n,e.ID),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("FBXLoader: %s map is not supported in three.js, skipping texture.",t)}})),o},getTexture:function(n,a){return"LayeredTexture"in e.Objects&&a in e.Objects.LayeredTexture&&(console.warn("FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),a=t.get(a).children[0].ID),n.get(a)},parseDeformers:function(){var n={},a={};if("Deformer"in e.Objects){var o=e.Objects.Deformer;for(var i in o){var r=o[i],s=t.get(parseInt(i));if("Skin"===r.attrType){var c=this.parseSkeleton(s,o);c.ID=i,s.parents.length>1&&console.warn("FBXLoader: skeleton attached to more than one geometry is not supported."),c.geometryID=s.parents[0].ID,n[i]=c}else if("BlendShape"===r.attrType){var l={id:i};l.rawTargets=this.parseMorphTargets(s,o),l.id=i,s.parents.length>1&&console.warn("FBXLoader: morph target attached to more than one geometry is not supported."),a[i]=l}}}return{skeletons:n,morphTargets:a}},parseSkeleton:function(e,t){var n=[];return e.children.forEach((function(e){var a=t[e.ID];if("Cluster"===a.attrType){var o={ID:e.ID,indices:[],weights:[],transformLink:(new Ie.V).fromArray(a.TransformLink.a)};"Indexes"in a&&(o.indices=a.Indexes.a,o.weights=a.Weights.a),n.push(o)}})),{rawBones:n,bones:[]}},parseMorphTargets:function(e,n){for(var a=[],o=0;o<e.children.length;o++){var i=e.children[o],r=n[i.ID],s={name:r.attrName,initialWeight:r.DeformPercent,id:r.id,fullWeights:r.FullWeights.a};if("BlendShapeChannel"!==r.attrType)return;s.geoID=t.get(parseInt(i.ID)).children.filter((function(e){return void 0===e.relationship}))[0].ID,a.push(s)}return a},parseScene:function(a,o,i){n=new Ie.F;var s=this.parseModels(a.skeletons,o,i),c=e.Objects.Model,l=this;s.forEach((function(e){var a=c[e.ID];l.setLookAtProperties(e,a),t.get(e.ID).parents.forEach((function(t){var n=s.get(t.ID);void 0!==n&&n.add(e)})),null===e.parent&&n.add(e)})),this.bindSkeleton(a.skeletons,o,s),this.createAmbientLight(),this.setupMorphMaterials(),n.traverse((function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrixWorld=e.parent.matrix);var t=g(e.userData.transformData);e.applyMatrix(t)}}));var u=(new r).parse();1===n.children.length&&n.children[0].isGroup&&(n.children[0].animations=u,n=n.children[0]),n.animations=u},parseModels:function(n,a,o){var i=new Map,r=e.Objects.Model;for(var s in r){var c=parseInt(s),l=r[s],u=t.get(c),d=this.buildSkeleton(u,n,c,l.attrName);if(!d){switch(l.attrType){case"Camera":d=this.createCamera(u);break;case"Light":d=this.createLight(u);break;case"Mesh":d=this.createMesh(u,a,o);break;case"NurbsCurve":d=this.createCurve(u,a);break;case"LimbNode":case"Root":d=new Ie.f;break;case"Null":default:d=new Ie.F}d.name=Ie.qb.sanitizeNodeName(l.attrName),d.ID=c}this.getTransformData(d,l),i.set(c,d)}return i},buildSkeleton:function(e,t,n,a){var o=null;return e.parents.forEach((function(e){for(var i in t){var r=t[i];r.rawBones.forEach((function(t,i){if(t.ID===e.ID){var s=o;(o=new Ie.f).matrixWorld.copy(t.transformLink),o.name=Ie.qb.sanitizeNodeName(a),o.ID=n,r.bones[i]=o,null!==s&&o.add(s)}}))}})),o},createCamera:function(t){var n,a;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(a=n)})),void 0===a)n=new Ie.hb;else{var o=0;void 0!==a.CameraProjectionType&&1===a.CameraProjectionType.value&&(o=1);var i=1;void 0!==a.NearPlane&&(i=a.NearPlane.value/1e3);var r=1e3;void 0!==a.FarPlane&&(r=a.FarPlane.value/1e3);var s=window.innerWidth,c=window.innerHeight;void 0!==a.AspectWidth&&void 0!==a.AspectHeight&&(s=a.AspectWidth.value,c=a.AspectHeight.value);var l=s/c,u=45;void 0!==a.FieldOfView&&(u=a.FieldOfView.value);var d=a.FocalLength?a.FocalLength.value:null;switch(o){case 0:n=new Ie.lb(u,l,i,r),null!==d&&n.setFocalLength(d);break;case 1:n=new Ie.jb(-s/2,s/2,c/2,-c/2,i,r);break;default:console.warn("FBXLoader: Unknown camera type "+o+"."),n=new Ie.hb}}return n},createLight:function(t){var n,a;if(t.children.forEach((function(t){var n=e.Objects.NodeAttribute[t.ID];void 0!==n&&(a=n)})),void 0===a)n=new Ie.hb;else{var o;o=void 0===a.LightType?0:a.LightType.value;var i=16777215;void 0!==a.Color&&(i=(new Ie.o).fromArray(a.Color.value));var r=void 0===a.Intensity?1:a.Intensity.value/100;void 0!==a.CastLightOnObject&&0===a.CastLightOnObject.value&&(r=0);var s=0;void 0!==a.FarAttenuationEnd&&(s=void 0!==a.EnableFarAttenuation&&0===a.EnableFarAttenuation.value?0:a.FarAttenuationEnd.value);switch(o){case 0:n=new Ie.nb(i,r,s,1);break;case 1:n=new Ie.u(i,r);break;case 2:var c=Ie.T.PI/3;void 0!==a.InnerAngle&&(c=Ie.T.degToRad(a.InnerAngle.value));var l=0;void 0!==a.OuterAngle&&(l=Ie.T.degToRad(a.OuterAngle.value),l=Ie.T.max(l,1)),n=new Ie.Gb(i,r,s,c,l,1);break;default:console.warn("FBXLoader: Unknown light type "+a.LightType.value+", defaulting to a PointLight."),n=new Ie.nb(i,r)}void 0!==a.CastShadows&&1===a.CastShadows.value&&(n.castShadow=!0)}return n},createMesh:function(e,t,n){var a,o=null,i=null,r=[];return e.children.forEach((function(e){t.has(e.ID)&&(o=t.get(e.ID)),n.has(e.ID)&&r.push(n.get(e.ID))})),r.length>1?i=r:r.length>0?i=r[0]:(i=new Ie.cb({color:13421772}),r.push(i)),"color"in o.attributes&&r.forEach((function(e){e.vertexColors=Ie.Tb})),o.FBX_Deformer?(r.forEach((function(e){e.skinning=!0})),(a=new Ie.Db(o,i)).normalizeSkinWeights()):a=new Ie.W(o,i),a},createCurve:function(e,t){var n=e.children.reduce((function(e,n){return t.has(n.ID)&&(e=t.get(n.ID)),e}),null),a=new Ie.L({color:3342591,linewidth:1});return new Ie.K(n,a)},getTransformData:function(e,t){var n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?b(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n},setLookAtProperties:function(a,o){"LookAtProperty"in o&&t.get(a.ID).children.forEach((function(t){if("LookAtProperty"===t.relationship){var o=e.Objects.Model[t.ID];if("Lcl_Translation"in o){var i=o.Lcl_Translation.value;void 0!==a.target?(a.target.position.fromArray(i),n.add(a.target)):a.lookAt((new Ie.Qb).fromArray(i))}}}))},bindSkeleton:function(e,n,a){var o=this.parsePoseNodes();for(var i in e){var r=e[i];t.get(parseInt(r.ID)).parents.forEach((function(e){if(n.has(e.ID)){var i=e.ID;t.get(i).parents.forEach((function(e){a.has(e.ID)&&a.get(e.ID).bind(new Ie.Cb(r.bones),o[e.ID])}))}}))}},parsePoseNodes:function(){var t={};if("Pose"in e.Objects){var n=e.Objects.Pose;for(var a in n)if("BindPose"===n[a].attrType){var o=n[a].PoseNode;Array.isArray(o)?o.forEach((function(e){t[e.Node]=(new Ie.V).fromArray(e.Matrix.a)})):t[o.Node]=(new Ie.V).fromArray(o.Matrix.a)}}return t},createAmbientLight:function(){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,a=t[0],o=t[1],i=t[2];if(0!==a||0!==o||0!==i){var r=new Ie.o(a,o,i);n.add(new Ie.b(r,1))}}},setupMorphMaterials:function(){var e=this;n.traverse((function(t){t.isMesh&&t.geometry.morphAttributes.position&&t.geometry.morphAttributes.position.length&&(Array.isArray(t.material)?t.material.forEach((function(n,a){e.setupMorphMaterial(t,n,a)})):e.setupMorphMaterial(t,t.material))}))},setupMorphMaterial:function(e,t,a){var o=e.uuid,i=t.uuid,r=!1;if(n.traverse((function(e){e.isMesh&&(Array.isArray(e.material)?e.material.forEach((function(t){t.uuid===i&&e.uuid!==o&&(r=!0)})):e.material.uuid===i&&e.uuid!==o&&(r=!0))})),!0===r){var s=t.clone();s.morphTargets=!0,void 0===a?e.material=s:e.material[a]=s}else t.morphTargets=!0}},i.prototype={constructor:i,parse:function(n){var a=new Map;if("Geometry"in e.Objects){var o=e.Objects.Geometry;for(var i in o){var r=t.get(parseInt(i)),s=this.parseGeometry(r,o[i],n);a.set(parseInt(i),s)}}return a},parseGeometry:function(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}},parseMeshGeometry:function(t,n,a){var o=a.skeletons,i=a.morphTargets,r=t.parents.map((function(t){return e.Objects.Model[t.ID]}));if(0!==r.length){var s=t.children.reduce((function(e,t){return void 0!==o[t.ID]&&(e=o[t.ID]),e}),null),c=t.children.reduce((function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e}),null),l=r[0],u={};"RotationOrder"in l&&(u.eulerOrder=b(l.RotationOrder.value)),"InheritType"in l&&(u.inheritType=parseInt(l.InheritType.value)),"GeometricTranslation"in l&&(u.translation=l.GeometricTranslation.value),"GeometricRotation"in l&&(u.rotation=l.GeometricRotation.value),"GeometricScaling"in l&&(u.scale=l.GeometricScaling.value);var d=g(u);return this.genGeometry(n,s,c,d)}},genGeometry:function(e,t,n,a){var o=new Ie.i;e.attrName&&(o.name=e.attrName);var i=this.parseGeoNode(e,t),r=this.genBuffers(i),s=new Ie.A(r.vertex,3);if(a.applyToBufferAttribute(s),o.addAttribute("position",s),r.colors.length>0&&o.addAttribute("color",new Ie.A(r.colors,3)),t&&(o.addAttribute("skinIndex",new Ie.Lb(r.weightsIndices,4)),o.addAttribute("skinWeight",new Ie.A(r.vertexWeights,4)),o.FBX_Deformer=t),r.normal.length>0){var c=new Ie.A(r.normal,3);(new Ie.U).getNormalMatrix(a).applyToBufferAttribute(c),o.addAttribute("normal",c)}if(r.uvs.forEach((function(e,t){var n="uv"+(t+1).toString();0===t&&(n="uv"),o.addAttribute(n,new Ie.A(r.uvs[t],2))})),i.material&&"AllSame"!==i.material.mappingType){var l=r.materialIndex[0],u=0;if(r.materialIndex.forEach((function(e,t){e!==l&&(o.addGroup(u,t-u,l),l=e,u=t)})),o.groups.length>0){var d=o.groups[o.groups.length-1],h=d.start+d.count;h!==r.materialIndex.length&&o.addGroup(h,r.materialIndex.length-h,l)}0===o.groups.length&&o.addGroup(0,r.materialIndex.length,r.materialIndex[0])}return this.addMorphTargets(o,e,n,a),o},parseGeoNode:function(e,t){var n={};if(n.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],n.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];for(var a=0;e.LayerElementUV[a];)n.uv.push(this.parseUVs(e.LayerElementUV[a])),a++}return n.weightTable={},null!==t&&(n.skeleton=t,t.rawBones.forEach((function(e,t){e.indices.forEach((function(a,o){void 0===n.weightTable[a]&&(n.weightTable[a]=[]),n.weightTable[a].push({id:t,weight:e.weights[o]})}))}))),n},genBuffers:function(e){var t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},n=0,a=0,o=!1,i=[],r=[],s=[],c=[],l=[],u=[],d=this;return e.vertexIndices.forEach((function(h,f){var p=!1;h<0&&(h^=-1,p=!0);var v=[],g=[];if(i.push(3*h,3*h+1,3*h+2),e.color){var b=m(f,n,h,e.color);s.push(b[0],b[1],b[2])}if(e.skeleton){if(void 0!==e.weightTable[h]&&e.weightTable[h].forEach((function(e){g.push(e.weight),v.push(e.id)})),g.length>4){o||(console.warn("FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);var x=[0,0,0,0],y=[0,0,0,0];g.forEach((function(e,t){var n=e,a=v[t];y.forEach((function(e,t,o){if(n>e){o[t]=n,n=e;var i=x[t];x[t]=a,a=i}}))})),v=x,g=y}for(;g.length<4;)g.push(0),v.push(0);for(var w=0;w<4;++w)l.push(g[w]),u.push(v[w])}if(e.normal){b=m(f,n,h,e.normal);r.push(b[0],b[1],b[2])}if(e.material&&"AllSame"!==e.material.mappingType)var A=m(f,n,h,e.material)[0];e.uv&&e.uv.forEach((function(e,t){var a=m(f,n,h,e);void 0===c[t]&&(c[t]=[]),c[t].push(a[0]),c[t].push(a[1])})),a++,p&&(d.genFace(t,e,i,A,r,s,c,l,u,a),n++,a=0,i=[],r=[],s=[],c=[],l=[],u=[])})),t},genFace:function(e,t,n,a,o,i,r,s,c,l){for(var u=2;u<l;u++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(u-1)]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(u-1)+2]]),e.vertex.push(t.vertexPositions[n[3*u]]),e.vertex.push(t.vertexPositions[n[3*u+1]]),e.vertex.push(t.vertexPositions[n[3*u+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[4*(u-1)]),e.vertexWeights.push(s[4*(u-1)+1]),e.vertexWeights.push(s[4*(u-1)+2]),e.vertexWeights.push(s[4*(u-1)+3]),e.vertexWeights.push(s[4*u]),e.vertexWeights.push(s[4*u+1]),e.vertexWeights.push(s[4*u+2]),e.vertexWeights.push(s[4*u+3]),e.weightsIndices.push(c[0]),e.weightsIndices.push(c[1]),e.weightsIndices.push(c[2]),e.weightsIndices.push(c[3]),e.weightsIndices.push(c[4*(u-1)]),e.weightsIndices.push(c[4*(u-1)+1]),e.weightsIndices.push(c[4*(u-1)+2]),e.weightsIndices.push(c[4*(u-1)+3]),e.weightsIndices.push(c[4*u]),e.weightsIndices.push(c[4*u+1]),e.weightsIndices.push(c[4*u+2]),e.weightsIndices.push(c[4*u+3])),t.color&&(e.colors.push(i[0]),e.colors.push(i[1]),e.colors.push(i[2]),e.colors.push(i[3*(u-1)]),e.colors.push(i[3*(u-1)+1]),e.colors.push(i[3*(u-1)+2]),e.colors.push(i[3*u]),e.colors.push(i[3*u+1]),e.colors.push(i[3*u+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(a),e.materialIndex.push(a),e.materialIndex.push(a)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(u-1)]),e.normal.push(o[3*(u-1)+1]),e.normal.push(o[3*(u-1)+2]),e.normal.push(o[3*u]),e.normal.push(o[3*u+1]),e.normal.push(o[3*u+2])),t.uv&&t.uv.forEach((function(t,n){void 0===e.uvs[n]&&(e.uvs[n]=[]),e.uvs[n].push(r[n][0]),e.uvs[n].push(r[n][1]),e.uvs[n].push(r[n][2*(u-1)]),e.uvs[n].push(r[n][2*(u-1)+1]),e.uvs[n].push(r[n][2*u]),e.uvs[n].push(r[n][2*u+1])}))},addMorphTargets:function(t,n,a,o){if(null!==a){t.morphAttributes.position=[];var i=this;a.rawTargets.forEach((function(a){var r=e.Objects.Geometry[a.geoID];void 0!==r&&i.genMorphGeometry(t,n,r,o,a.name)}))}},genMorphGeometry:function(e,t,n,a,o){var i=new Ie.i;n.attrName&&(i.name=n.attrName);for(var r=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],s=void 0!==t.Vertices?t.Vertices.a.slice():[],c=void 0!==n.Vertices?n.Vertices.a:[],l=void 0!==n.Indexes?n.Indexes.a:[],u=0;u<l.length;u++){var d=3*l[u];s[d]+=c[3*u],s[d+1]+=c[3*u+1],s[d+2]+=c[3*u+2]}var h={vertexIndices:r,vertexPositions:s},f=this.genBuffers(h),m=new Ie.A(f.vertex,3);m.name=o||n.attrName,a.applyToBufferAttribute(m),e.morphAttributes.position.push(m)},parseNormals:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,a=e.Normals.a,o=[];return"IndexToDirect"===n&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:a,indices:o,mappingType:t,referenceType:n}},parseUVs:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,a=e.UV.a,o=[];return"IndexToDirect"===n&&(o=e.UVIndex.a),{dataSize:2,buffer:a,indices:o,mappingType:t,referenceType:n}},parseVertexColors:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType,a=e.Colors.a,o=[];return"IndexToDirect"===n&&(o=e.ColorIndex.a),{dataSize:4,buffer:a,indices:o,mappingType:t,referenceType:n}},parseMaterialIndices:function(e){var t=e.MappingInformationType,n=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};for(var a=e.Materials.a,o=[],i=0;i<a.length;++i)o.push(i);return{dataSize:1,buffer:a,indices:o,mappingType:t,referenceType:n}},parseNurbsGeometry:function(e){if(void 0===ft)return console.error("FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new Ie.i;var t=parseInt(e.Order);if(isNaN(t))return console.error("FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new Ie.i;for(var n,a,o=t-1,i=e.KnotVector.a,r=[],s=e.Points.a,c=0,l=s.length;c<l;c+=4)r.push((new Ie.Rb).fromArray(s,c));if("Closed"===e.Form)r.push(r[0]);else if("Periodic"===e.Form){n=o,a=i.length-1-n;for(c=0;c<o;++c)r.push(r[c])}var u=new ft(o,i,r,n,a).getPoints(7*r.length),d=new Float32Array(3*u.length);u.forEach((function(e,t){e.toArray(d,3*t)}));var h=new Ie.i;return h.addAttribute("position",new Ie.h(d,3)),h}},r.prototype={constructor:r,parse:function(){var e=[],t=this.parseClips();if(void 0!==t)for(var n in t){var a=t[n],o=this.addClip(a);e.push(o)}return e},parseClips:function(){if(void 0!==e.Objects.AnimationCurve){var t=this.parseAnimationCurveNodes();this.parseAnimationCurves(t);var n=this.parseAnimationLayers(t);return this.parseAnimStacks(n)}},parseAnimationCurveNodes:function(){var t=e.Objects.AnimationCurveNode,n=new Map;for(var a in t){var o=t[a];if(null!==o.attrName.match(/S|R|T|DeformPercent/)){var i={id:o.id,attr:o.attrName,curves:{}};n.set(i.id,i)}}return n},parseAnimationCurves:function(n){var a=e.Objects.AnimationCurve;for(var o in a){var i={id:a[o].id,times:a[o].KeyTime.a.map(h),values:a[o].KeyValueFloat.a},r=t.get(i.id);if(void 0!==r){var s=r.parents[0].ID,c=r.parents[0].relationship;c.match(/X/)?n.get(s).curves.x=i:c.match(/Y/)?n.get(s).curves.y=i:c.match(/Z/)?n.get(s).curves.z=i:c.match(/d|DeformPercent/)&&n.has(s)&&(n.get(s).curves.morph=i)}}},parseAnimationLayers:function(a){var o=e.Objects.AnimationLayer,i=new Map;for(var r in o){var s=[],c=t.get(parseInt(r));if(void 0!==c)c.children.forEach((function(o,i){if(a.has(o.ID)){var r=a.get(o.ID);if(void 0!==r.curves.x||void 0!==r.curves.y||void 0!==r.curves.z){if(void 0===s[i])if(void 0!==(f=t.get(o.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID)){var c=e.Objects.Model[f.toString()],l={modelName:Ie.qb.sanitizeNodeName(c.attrName),ID:c.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};n.traverse((function(e){e.ID===c.id&&(l.transform=e.matrix,e.userData.transformData&&(l.eulerOrder=e.userData.transformData.eulerOrder))})),l.transform||(l.transform=new Ie.V),"PreRotation"in c&&(l.preRotation=c.PreRotation.value),"PostRotation"in c&&(l.postRotation=c.PostRotation.value),s[i]=l}s[i]&&(s[i][r.attr]=r)}else if(void 0!==r.curves.morph){if(void 0===s[i]){var u=t.get(o.ID).parents.filter((function(e){return void 0!==e.relationship}))[0].ID,d=t.get(u).parents[0].ID,h=t.get(d).parents[0].ID,f=t.get(h).parents[0].ID;c=e.Objects.Model[f],l={modelName:Ie.qb.sanitizeNodeName(c.attrName),morphName:e.Objects.Deformer[u].attrName};s[i]=l}s[i][r.attr]=r}}})),i.set(parseInt(r),s)}return i},parseAnimStacks:function(n){var a=e.Objects.AnimationStack,o={};for(var i in a){var r=t.get(parseInt(i)).children;r.length>1&&console.warn("FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=n.get(r[0].ID);o[i]={name:a[i].attrName,layer:s}}return o},addClip:function(e){var t=[],n=this;return e.layer.forEach((function(e){t=t.concat(n.generateTracks(e))})),new Ie.c(e.name,-1,t)},generateTracks:function(e){var t=[],n=new Ie.Qb,a=new Ie.rb,o=new Ie.Qb;if(e.transform&&e.transform.decompose(n,a,o),n=n.toArray(),a=(new Ie.x).setFromQuaternion(a,e.eulerOrder).toArray(),o=o.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){var i=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var r=this.generateRotationTrack(e.modelName,e.R.curves,a,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var s=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");void 0!==s&&t.push(s)}if(void 0!==e.DeformPercent){var c=this.generateMorphTrack(e);void 0!==c&&t.push(c)}return t},generateVectorTrack:function(e,t,n,a){var o=this.getTimesForAllAxes(t),i=this.getKeyframeTrackValues(o,t,n);return new Ie.Sb(e+"."+a,o,i)},generateRotationTrack:function(e,t,n,a,o,i){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(Ie.T.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(Ie.T.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(Ie.T.degToRad));var r=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(r,t,n);void 0!==a&&((a=a.map(Ie.T.degToRad)).push(i),a=(new Ie.x).fromArray(a),a=(new Ie.rb).setFromEuler(a)),void 0!==o&&((o=o.map(Ie.T.degToRad)).push(i),o=(new Ie.x).fromArray(o),o=(new Ie.rb).setFromEuler(o).inverse());for(var c=new Ie.rb,l=new Ie.x,u=[],d=0;d<s.length;d+=3)l.set(s[d],s[d+1],s[d+2],i),c.setFromEuler(l),void 0!==a&&c.premultiply(a),void 0!==o&&c.multiply(o),c.toArray(u,d/3*4);return new Ie.sb(e+".quaternion",r,u)},generateMorphTrack:function(e){var t=e.DeformPercent.curves.morph,a=t.values.map((function(e){return e/100})),o=n.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new Ie.gb(e.modelName+".morphTargetInfluences["+o+"]",t.times,a)},getTimesForAllAxes:function(e){var t=[];return void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),t=t.sort((function(e,t){return e-t})).filter((function(e,t,n){return n.indexOf(e)==t}))},getKeyframeTrackValues:function(e,t,n){var a=n,o=[],i=-1,r=-1,s=-1;return e.forEach((function(e){if(t.x&&(i=t.x.times.indexOf(e)),t.y&&(r=t.y.times.indexOf(e)),t.z&&(s=t.z.times.indexOf(e)),-1!==i){var n=t.x.values[i];o.push(n),a[0]=n}else o.push(a[0]);if(-1!==r){var c=t.y.values[r];o.push(c),a[1]=c}else o.push(a[1]);if(-1!==s){var l=t.z.values[s];o.push(l),a[2]=l}else o.push(a[2])})),o},interpolateRotations:function(e){for(var t=1;t<e.values.length;t++){var n=e.values[t-1],a=e.values[t]-n,o=Ie.T.abs(a);if(o>=180){for(var i=o/180,r=a/i,s=n+r,c=e.times[t-1],l=(e.times[t]-c)/i,u=c+l,d=[],h=[];u<e.times[t];)d.push(u),u+=l,h.push(s),s+=r;e.times=w(e.times,t,d),e.values=w(e.values,t,h)}}}},s.prototype={constructor:s,getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,t){this.currentProp=e,this.currentPropName=t},parse:function(e){this.currentIndent=0,this.allNodes=new u,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var t=this,n=e.split(/[\r\n]+/);return n.forEach((function(e,a){var o=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!o&&!i){var r=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),c=e.match("^\\t{"+(t.currentIndent-1)+"}}");r?t.parseNodeBegin(e,r):s?t.parseNodeProperty(e,s,n[++a]):c?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}})),this.allNodes},parseNodeBegin:function(e,t){var n=t[1].trim().replace(/^"/,"").replace(/"$/,""),a=t[2].split(",").map((function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")})),o={name:n},i=this.parseNodeAttr(a),r=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(n,o):n in r?("PoseNode"===n?r.PoseNode.push(o):void 0!==r[n].id&&(r[n]={},r[n][r[n].id]=r[n]),""!==i.id&&(r[n][i.id]=o)):"number"===typeof i.id?(r[n]={},r[n][i.id]=o):"Properties70"!==n&&(r[n]="PoseNode"===n?[o]:o),"number"===typeof i.id&&(o.id=i.id),""!==i.name&&(o.attrName=i.name),""!==i.type&&(o.attrType=i.type),this.pushStack(o)},parseNodeAttr:function(e){var t=e[0];""!==e[0]&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));var n="",a="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),a=e[2]),{id:t,name:n,type:a}},parseNodeProperty:function(e,t,n){var a=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===a&&","===o&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===a){var r=o.split(",").slice(1),s=parseInt(r[0]),c=parseInt(r[1]),l=o.split(",").slice(3);a="connections",function(e,t){for(var n=0,a=e.length,o=t.length;n<o;n++,a++)e[a]=t[n]}(o=[s,c],l=l.map((function(e){return e.trim().replace(/^"/,"")}))),void 0===i[a]&&(i[a]=[])}"Node"===a&&(i.id=o),a in i&&Array.isArray(i[a])?i[a].push(o):"a"!==a?i[a]=o:i.a=o,this.setCurrentProp(i,a),"a"===a&&","!==o.slice(-1)&&(i.a=x(o))}else this.parseNodeSpecialProperty(e,a,o)},parseNodePropertyContinued:function(e){var t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=x(t.a))},parseNodeSpecialProperty:function(e,t,n){var a=n.split('",').map((function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")})),o=a[0],i=a[1],r=a[2],s=a[3],c=a[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":c=parseFloat(c);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":c=x(c)}this.getPrevNode()[o]={type:i,type2:r,flag:s,value:c},this.setCurrentProp(this.getPrevNode(),o)}},c.prototype={constructor:c,parse:function(e){var t=new l(e);t.skip(23);for(var n=t.getUint32(),a=new u;!this.endOfContent(t);){var o=this.parseNode(t,n);null!==o&&a.add(o.name,o)}return a},endOfContent:function(e){return e.size()%16===0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,t){var n={},a=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32(),i=(t>=7500?e.getUint64():e.getUint32(),e.getUint8()),r=e.getString(i);if(0===a)return null;for(var s=[],c=0;c<o;c++)s.push(this.parseProperty(e));var l=s.length>0?s[0]:"",u=s.length>1?s[1]:"",d=s.length>2?s[2]:"";for(n.singleProperty=1===o&&e.getOffset()===a;a>e.getOffset();){var h=this.parseNode(e,t);null!==h&&this.parseSubNode(r,n,h)}return n.propertyList=s,"number"===typeof l&&(n.id=l),""!==u&&(n.attrName=u),""!==d&&(n.attrType=d),""!==r&&(n.name=r),n},parseSubNode:function(e,t,n){if(!0===n.singleProperty){var a=n.propertyList[0];Array.isArray(a)?(t[n.name]=n,n.a=a):t[n.name]=a}else if("Connections"===e&&"C"===n.name){var o=[];n.propertyList.forEach((function(e,t){0!==t&&o.push(e)})),void 0===t.connections&&(t.connections=[]),t.connections.push(o)}else if("Properties70"===n.name){Object.keys(n).forEach((function(e){t[e]=n[e]}))}else if("Properties70"===e&&"P"===n.name){var i,r=n.propertyList[0],s=n.propertyList[1],c=n.propertyList[2],l=n.propertyList[3];0===r.indexOf("Lcl ")&&(r=r.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),i="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[r]={type:s,type2:c,flag:l,value:i}}else void 0===t[n.name]?"number"===typeof n.id?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:"PoseNode"===n.name?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):void 0===t[n.name][n.id]&&(t[n.name][n.id]=n)},parseProperty:function(e){var t=e.getString(1);switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var n=e.getUint32();return e.getArrayBuffer(n);case"S":n=e.getUint32();return e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var a=e.getUint32(),o=e.getUint32(),i=e.getUint32();if(0===o)switch(t){case"b":case"c":return e.getBooleanArray(a);case"d":return e.getFloat64Array(a);case"f":return e.getFloat32Array(a);case"i":return e.getInt32Array(a);case"l":return e.getInt64Array(a)}console.log(),"undefined"===typeof ut.Zlib&&console.error("FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var r=new l(new ut.Zlib.Inflate(new Uint8Array(e.getArrayBuffer(i))).decompress().buffer);switch(t){case"b":case"c":return r.getBooleanArray(a);case"d":return r.getFloat64Array(a);case"f":return r.getFloat32Array(a);case"i":return r.getInt32Array(a);case"l":return r.getInt64Array(a)}default:throw new Error("FBXLoader: Unknown property type "+t)}}},l.prototype={constructor:l,getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1===(1&this.getUint8())},getBooleanArray:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getBoolean());return t},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt32());return t},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,4294967295===(e=4294967295&~e)&&(t=t+1&4294967295),-(4294967296*t+(e=e+1&4294967295))):4294967296*t+e},getInt64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getInt64());return t},getUint64:function(){var e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat32());return t},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var t=[],n=0;n<e;n++)t.push(this.getFloat64());return t},getArrayBuffer:function(e){var t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},getString:function(e){for(var t=[],n=0;n<e;n++)t[n]=this.getUint8();var a=t.indexOf(0);return a>=0&&(t=t.slice(0,a)),Ie.Q.decodeText(new Uint8Array(t))}},u.prototype={constructor:u,add:function(e,t){this[e]=t}};var f=[];function m(e,t,n,a){var o;switch(a.mappingType){case"ByPolygonVertex":o=e;break;case"ByPolygon":o=t;break;case"ByVertice":o=n;break;case"AllSame":o=a.indices[0];break;default:console.warn("FBXLoader: unknown attribute mapping type "+a.mappingType)}"IndexToDirect"===a.referenceType&&(o=a.indices[o]);var i=o*a.dataSize,r=i+a.dataSize;return function(e,t,n,a){for(var o=n,i=0;o<a;o++,i++)e[i]=t[o];return e}(f,a.buffer,i,r)}var p=new Ie.x,v=new Ie.Qb;function g(e){var t,n=new Ie.V,a=new Ie.V,o=new Ie.V,i=new Ie.V,r=new Ie.V,s=new Ie.V,c=new Ie.V,l=new Ie.V,u=new Ie.V,d=new Ie.V,h=new Ie.V,f=e.inheritType?e.inheritType:0;(e.translation&&n.setPosition(v.fromArray(e.translation)),e.preRotation)&&((t=e.preRotation.map(Ie.T.degToRad)).push(e.eulerOrder),a.makeRotationFromEuler(p.fromArray(t)));e.rotation&&((t=e.rotation.map(Ie.T.degToRad)).push(e.eulerOrder),o.makeRotationFromEuler(p.fromArray(t)));e.postRotation&&((t=e.postRotation.map(Ie.T.degToRad)).push(e.eulerOrder),i.makeRotationFromEuler(p.fromArray(t)));e.scale&&r.scale(v.fromArray(e.scale)),e.scalingOffset&&c.setPosition(v.fromArray(e.scalingOffset)),e.scalingPivot&&s.setPosition(v.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(v.fromArray(e.rotationOffset)),e.rotationPivot&&u.setPosition(v.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(d=e.parentMatrixWorld);var m=a.multiply(o).multiply(i),g=new Ie.V;d.extractRotation(g);var b,x,y,w,A=new Ie.V;if(A.copyPosition(d),y=A.getInverse(A).multiply(d),x=g.getInverse(g).multiply(y),b=r,0===f)w=g.multiply(m).multiply(x).multiply(b);else if(1===f)w=g.multiply(x).multiply(m).multiply(b);else{var P=(new Ie.V).copy(r),T=x.multiply(P.getInverse(P));w=g.multiply(m).multiply(T).multiply(b)}var S=n.multiply(l).multiply(u).multiply(a).multiply(o).multiply(i).multiply(u.getInverse(u)).multiply(c).multiply(s).multiply(r).multiply(s.getInverse(s)),F=(new Ie.V).copyPosition(S),E=d.multiply(F);return h.copyPosition(E),S=h.multiply(w)}function b(e){var t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function x(e){return e.split(",").map((function(e){return parseFloat(e)}))}function y(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=e.byteLength),Ie.Q.decodeText(new Uint8Array(e,t,n))}function w(e,t,n){return e.slice(0,t).concat(n).concat(e.slice(t))}return a}(),gt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){(new vt).load(n.asset.src,(function(e){n.asset.data=e,n.emit("loaded",n.asset)}),(function(){}),(function(e){n.emit("error","Failed to load ".concat(n.asset.src),e)}))},n.asset=e,n}return Object(he.a)(t,e),t}(nt),bt=function(){var e=/^[og]\s*(.+)?/,t=/^mtllib /,n=/^usemtl /;function a(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var n=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var a={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"===typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(a),a},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"===typeof n.clone){var a=n.clone(0);a.inherited=!0,this.object.materials.push(a)}this.objects.push(this.object)},finalize:function(){this.object&&"function"===typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var a=this.vertices,o=this.object.geometry.vertices;o.push(a[e+0],a[e+1],a[e+2]),o.push(a[t+0],a[t+1],a[t+2]),o.push(a[n+0],a[n+1],a[n+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){var a=this.normals,o=this.object.geometry.normals;o.push(a[e+0],a[e+1],a[e+2]),o.push(a[t+0],a[t+1],a[t+2]),o.push(a[n+0],a[n+1],a[n+2])},addColor:function(e,t,n){var a=this.colors,o=this.object.geometry.colors;o.push(a[e+0],a[e+1],a[e+2]),o.push(a[t+0],a[t+1],a[t+2]),o.push(a[n+0],a[n+1],a[n+2])},addUV:function(e,t,n){var a=this.uvs,o=this.object.geometry.uvs;o.push(a[e+0],a[e+1]),o.push(a[t+0],a[t+1]),o.push(a[n+0],a[n+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,a,o,i,r,s,c){var l=this.vertices.length,u=this.parseVertexIndex(e,l),d=this.parseVertexIndex(t,l),h=this.parseVertexIndex(n,l);if(this.addVertex(u,d,h),void 0!==a&&""!==a){var f=this.uvs.length;u=this.parseUVIndex(a,f),d=this.parseUVIndex(o,f),h=this.parseUVIndex(i,f),this.addUV(u,d,h)}if(void 0!==r&&""!==r){var m=this.normals.length;u=this.parseNormalIndex(r,m),d=r===s?u:this.parseNormalIndex(s,m),h=r===c?u:this.parseNormalIndex(c,m),this.addNormal(u,d,h)}this.colors.length>0&&this.addColor(u,d,h)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,n=0,a=e.length;n<a;n++)this.addVertexPoint(this.parseVertexIndex(e[n],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,a=this.uvs.length,o=0,i=e.length;o<i;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));var r=0;for(i=t.length;r<i;r++)this.addUVLine(this.parseUVIndex(t[r],a))}};return e.startObject("",!1),e}function o(e){this.manager=void 0!==e?e:Ie.t,this.materials=null}return o.prototype={constructor:o,load:function(e,t,n,a){var o=this,i=new Ie.z(o.manager);i.setPath(this.path),i.load(e,(function(e){t(o.parse(e))}),n,a)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(o){console.time("OBJLoader");var i=new a;-1!==o.indexOf("\r\n")&&(o=o.replace(/\r\n/g,"\n")),-1!==o.indexOf("\\\n")&&(o=o.replace(/\\\n/g,""));for(var r=o.split("\n"),s="",c="",l=[],u="function"===typeof"".trimLeft,d=0,h=r.length;d<h;d++)if(s=r[d],0!==(s=u?s.trimLeft():s.trim()).length&&"#"!==(c=s.charAt(0)))if("v"===c){var f=s.split(/\s+/);switch(f[0]){case"v":i.vertices.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3])),8===f.length&&i.colors.push(parseFloat(f[4]),parseFloat(f[5]),parseFloat(f[6]));break;case"vn":i.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));break;case"vt":i.uvs.push(parseFloat(f[1]),parseFloat(f[2]))}}else if("f"===c){for(var m=s.substr(1).trim().split(/\s+/),p=[],v=0,g=m.length;v<g;v++){var b=m[v];if(b.length>0){var x=b.split("/");p.push(x)}}var y=p[0];for(v=1,g=p.length-1;v<g;v++){var w=p[v],A=p[v+1];i.addFace(y[0],w[0],A[0],y[1],w[1],A[1],y[2],w[2],A[2])}}else if("l"===c){var P=s.substring(1).trim().split(" "),T=[],S=[];if(-1===s.indexOf("/"))T=P;else for(var F=0,E=P.length;F<E;F++){var _=P[F].split("/");""!==_[0]&&T.push(_[0]),""!==_[1]&&S.push(_[1])}i.addLineGeometry(T,S)}else if("p"===c){var O=s.substr(1).trim().split(" ");i.addPointGeometry(O)}else if(null!==(l=e.exec(s))){var C=(" "+l[0].substr(1).trim()).substr(1);i.startObject(C)}else if(n.test(s))i.object.startMaterial(s.substring(7).trim(),i.materialLibraries);else if(t.test(s))i.materialLibraries.push(s.substring(7).trim());else{if("s"!==c){if("\0"===s)continue;throw new Error('OBJLoader: Unexpected line: "'+s+'"')}if((l=s.split(" ")).length>1){var I=l[1].trim().toLowerCase();i.object.smooth="0"!==I&&"off"!==I}else i.object.smooth=!0;(V=i.object.currentMaterial())&&(V.smooth=i.object.smooth)}i.finalize();var M=new Ie.F;M.materialLibraries=[].concat(i.materialLibraries);for(d=0,h=i.objects.length;d<h;d++){var L=i.objects[d],N=L.geometry,k=L.materials,j="Line"===N.type,U="Points"===N.type,R=!1;if(0!==N.vertices.length){var D=new Ie.i;D.addAttribute("position",new Ie.A(N.vertices,3)),N.normals.length>0?D.addAttribute("normal",new Ie.A(N.normals,3)):D.computeVertexNormals(),N.colors.length>0&&(R=!0,D.addAttribute("color",new Ie.A(N.colors,3))),N.uvs.length>0&&D.addAttribute("uv",new Ie.A(N.uvs,2));for(var X,z=[],Y=0,B=k.length;Y<B;Y++){var Q=k[Y],V=void 0;if(null!==this.materials)if(V=this.materials.create(Q.name),!j||!V||V instanceof Ie.L){if(U&&V&&!(V instanceof Ie.pb)){var H=new Ie.pb({size:10,sizeAttenuation:!1});Ie.S.prototype.copy.call(H,V),H.color.copy(V.color),H.map=V.map,H.lights=!1,V=H}}else{var G=new Ie.L;Ie.S.prototype.copy.call(G,V),G.color.copy(V.color),G.lights=!1,V=G}V||((V=j?new Ie.L:U?new Ie.pb({size:1,sizeAttenuation:!1}):new Ie.cb).name=Q.name),V.flatShading=!Q.smooth,V.vertexColors=R?Ie.Tb:Ie.fb,z.push(V)}if(z.length>1){for(Y=0,B=k.length;Y<B;Y++){Q=k[Y];D.addGroup(Q.groupStart,Q.groupCount,Y)}X=j?new Ie.M(D,z):U?new Ie.ob(D,z):new Ie.W(D,z)}else X=j?new Ie.M(D,z[0]):U?new Ie.ob(D,z[0]):new Ie.W(D,z[0]);X.name=L.name,M.add(X)}}return console.timeEnd("OBJLoader"),M}},o}(),xt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){(new bt).load(n.asset.src,(function(e){n.asset.data=e,n.emit("loaded",n.asset)}),(function(){}),(function(e){n.emit("error","Failed to load ".concat(n.asset.src),e)}))},n.asset=e,n}return Object(he.a)(t,e),t}(nt),yt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(){var e=new fe.Howl({src:[n.asset.src],autoplay:!1,loop:n.asset.args.loop||!1,volume:n.asset.args.volume||1,preload:!1,onloaderror:function(){n.emit("error","Failed to load ".concat(n.asset.src))}});e.once("load",(function(){n.asset.data=e,n.emit("loaded",n.asset)})),e.load()},n.asset=e,n}return Object(he.a)(t,e),t}(nt),wt=(mt={},Object(p.a)(mt,nt.image,at),Object(p.a)(mt,nt.json,ot),Object(p.a)(mt,nt.fbx,gt),Object(p.a)(mt,nt.obj,xt),Object(p.a)(mt,nt.texture,it),Object(p.a)(mt,nt.cubeTexture,lt),Object(p.a)(mt,nt.textureAtlas,ct),Object(p.a)(mt,nt.sound,yt),mt),At=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(e){n.loaders=[],e.forEach((function(e){void 0!==wt[e.type]&&n.loaders.push(new wt[e.type](e))})),n.loaded=0,n.queue=0,n.currentParallel=0,n.parallelLoads=ee.a.isDesktop?10:5,n.total=n.loaders.length,0===n.total?n.emit("loaded",[]):n.loadNextInQueue()},n.loadNextInQueue=function(){if(n.queue<n.total&&n.currentParallel<n.parallelLoads){var e=n.loaders[n.queue];n.queue+=1,n.currentParallel+=1,e.once("loaded",n.onLoaded),e.once("error",n.onError),e.load(),n.loadNextInQueue()}},n.onLoaded=function(){if(n.loaded+=1,n.emit("progress",n.loaded/n.total),n.loaded===n.total){var e=[];n.loaders.forEach((function(t){e.push(t.asset)})),n.emit("loaded",e)}else n.currentParallel-=1,n.loadNextInQueue()},n.onError=function(e){n.emit("error",e)},n.id=e,n}return Object(he.a)(t,e),t}(Ce.a),Pt=new(function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(ue.a)(this,(e=Object(de.a)(t)).call.apply(e,[this].concat(o)))).load=function(e,t){var a=new At(e);t.forEach((function(e){void 0===e.args&&(e.args={})})),a.on("progress",(function(e){n.emit("progress",e)})),a.once("loaded",(function(e){n.emit("loaded",e)})),a.once("error",(function(e){n.emit("error",e)})),a.load(t)},n}return Object(he.a)(t,e),t}(Ce.a)),Tt=n(19),St=n(20),Ft=n(14),Et=ee.a.soundsEnabled?[new et.a({id:Ft.j,src:"".concat(ee.a.soundsPath,"home/home-background.mp3"),type:nt.sound,args:{volume:.5,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}})]:[],_t=[].concat(Et),Ot=[],Ct=[],It=[];Ot.push(new et.a({id:"rock-model",src:"".concat(ee.a.webglPath,"rock/rock.fbx"),type:nt.fbx}),new et.a({id:"crystal-model",src:"".concat(ee.a.webglPath,"crystal/crystal.fbx"),type:nt.fbx})),Ct.push(new et.a({id:"rock-map",src:"".concat(ee.a.webglPath,"rock/rock-").concat(ee.a.isDesktop&&Object(De.K)()===De.q?4096:2048,".png"),type:nt.textureAtlas,args:{atlas:[{id:"normal",position:[.5,0],size:[.5,1]},{id:"ao",position:[0,0],size:[.5,1]}]}})),Ct.push(new et.a({id:"rock-matcap",src:"".concat(ee.a.webglPath,"matcap/").concat(7,"-512.jpg"),type:nt.texture}),new et.a({id:"crystal-matcap",src:"".concat(ee.a.webglPath,"matcap/").concat(25,"-512.jpg"),type:nt.texture}));for(var Mt=0;Mt<0;Mt++)Ct.push(new et.a({id:"rock-matcap-".concat(Mt),src:"".concat(ee.a.webglPath,"matcap/").concat(Mt,"-512.jpg"),type:nt.texture}));for(var Lt=[7,7,25],Nt=0;Nt<Lt.length;Nt++)Ct.push(new et.a({id:"rock-matcap-".concat(Lt[Nt]),src:"".concat(ee.a.webglPath,"matcap/").concat(Lt[Nt],"-512.jpg"),type:nt.texture}));Ct.push(new et.a({id:"particle-color",src:"".concat(ee.a.webglPath,"particles/particle-color-256.jpg"),type:nt.texture})),ee.a.soundsEnabled&&It.push(new et.a({id:Ft.k,src:"".concat(ee.a.soundsPath,"past/past-background.mp3"),type:nt.sound,args:{volume:.5,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}}),new et.a({id:Ft.m,src:"".concat(ee.a.soundsPath,"past/past-rock-interaction.mp3"),type:nt.sound,args:{volume:1,fadeOutDuration:1,loop:!1,oneshot:!0}}),new et.a({id:Ft.n,src:"".concat(ee.a.soundsPath,"past/past-rock-shatter.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!1}}),new et.a({id:Ft.o,src:"".concat(ee.a.soundsPath,"past/past-rock-shatter-crystals.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!1}}),new et.a({id:Ft.l,src:"".concat(ee.a.soundsPath,"past/past-orb-reveal.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!1}}));var kt=[].concat(Ct,Ot,It),jt=ee.a.soundsEnabled?[new et.a({id:Ft.p,src:"".concat(ee.a.soundsPath,"present/present-background.mp3"),type:nt.sound,args:{volume:.5,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}}),new et.a({id:Ft.q,src:"".concat(ee.a.soundsPath,"present/present-bubbles.mp3"),type:nt.sound,args:{volume:1,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}})]:[];if(ee.a.soundsEnabled)for(var Ut=0;Ut<Ft.r.length;Ut++)jt.push(new et.a({id:Ft.r[Ut],src:"".concat(ee.a.soundsPath,"present/present-click-").concat(Ut,".mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!0}}));var Rt=[].concat(jt),Dt=[];Dt.push(new et.a({id:"future-particle-color",src:"".concat(ee.a.webglPath,"particles/future-particle-color-256.jpg"),type:nt.texture}));var Xt=[];ee.a.soundsEnabled&&Xt.push(new et.a({id:Ft.c,src:"".concat(ee.a.soundsPath,"future/future-background.mp3"),type:nt.sound,args:{volume:.5,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}}),new et.a({id:Ft.d,src:"".concat(ee.a.soundsPath,"future/future-background-tone.mp3"),type:nt.sound,args:{volume:1,fadeInDuration:3,fadeOutDuration:3,loop:!0,oneshot:!1}}),new et.a({id:Ft.e,src:"".concat(ee.a.soundsPath,"future/future-camera.mp3"),type:nt.sound,args:{volume:1,fadeInDuration:1,fadeOutDuration:2,loop:!1,oneshot:!0}}),new et.a({id:Ft.g,src:"".concat(ee.a.soundsPath,"future/future-confetti-0.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!0}}),new et.a({id:Ft.h,src:"".concat(ee.a.soundsPath,"future/future-confetti-1.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!0}}),new et.a({id:Ft.i,src:"".concat(ee.a.soundsPath,"future/future-confetti-2.mp3"),type:nt.sound,args:{volume:1,loop:!1,oneshot:!0}}));var zt=[].concat([],Dt,Xt),Yt=[new et.a({id:"screenshot-fwa",src:"".concat(ee.a.webglPath,"screenshot/fwa.png"),type:nt.image}),new et.a({id:"screenshot-jam3",src:"".concat(ee.a.webglPath,"screenshot/jam3.png"),type:nt.image})];ee.a.preloadAllAssets&&Yt.push.apply(Yt,Object(C.a)(_t)),ee.a.soundsEnabled&&Yt.push(new et.a({id:Ft.a,src:"".concat(ee.a.soundsPath,"button-click.mp3"),type:nt.sound,args:{volume:.5,loop:!1,oneshot:!0,fade:!1}}),new et.a({id:Ft.b,src:"".concat(ee.a.soundsPath,"button-rollover.mp3"),type:nt.sound,args:{volume:.5,loop:!1,oneshot:!0,fade:!1}}));var Bt=[].concat(Object(C.a)(kt),Object(C.a)(Rt),Object(C.a)(zt)),Qt=[].concat(Yt,Object(C.a)(Bt)),Vt=Object(Me.a)(32,32,{depthBuffer:!1,format:Ie.ub});function Ht(e,t){!1===t?(e.wasFrustumCulled=e.frustumCulled,e.wasVisible=e.visible,e.visible=!0,e.frustumCulled=!1):(e.visible=e.wasVisible,e.frustumCulled=e.wasFrustumCulled),e.children.forEach((function(e){return Ht(e,t)}))}function Gt(e,t){return new Promise((function(n,a){try{var o=t.aspect;t.aspect=1,t.updateProjectionMatrix(),Ht(e,!1),Me.b.setRenderTarget(Vt),Me.b.render(e,t),Me.b.setRenderTarget(null),t.aspect=o,t.updateProjectionMatrix(),Ht(e,!0),n()}catch(i){a(i)}}))}var Wt=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).load=function(e){return new Promise((function(t,a){if(ee.a.preloadAllAssets){if(e)return void t();n.id===De.x?t():n._load(De.p,Bt,t,a)}else n._load(n.id,n.assets,t,a)}))},n.loadAll=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise((function(t,a){Ee.j.delayedCall(e,(function(){n._load(De.p,Bt,t,a)}))}))},n._load=function(e,t,n,a){ee.a.preloadAllAssets||void 0===Tt.a.assets[e]?(Pt.once("loaded",(function(t){Tt.a.add(e,t),n()})),Pt.once("error",a),Pt.load(e,t)):n()},n.createObjects=function(){return new Promise((function(e,t){try{e()}catch(n){t(n)}}))},n.setup=function(){var e=Object(He.a)(Ve.a.mark((function e(t){return Ve.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.load(t);case 2:return e.next=4,n.createObjects();case 4:return e.next=6,Gt(n.scene,n.camera);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.onStateChanged=function(){},n.captureScreenShot=function(e){},n.setActive=function(e){},n.resize=function(e,t){n.camera.aspect=e/t,n.camera.updateProjectionMatrix()},n.update=function(e){},n.dispose=function(){for(var e=Object(C.a)(n.scene.children),t=0;t<e.length;t++)Object(St.c)(e[t],n.scene)},n.id=e.id,n.scene=new Ie.yb,n.camera=qe(),n.camera.name=n.id,n.assets=e.assets||[],n.backgroundColor=0,Ze(n.camera,10),e.gui?(n.gui=je.b.addFolder("".concat(n.id," scene")),e.guiOpen&&n.gui.open()):n.gui=new je.a,n.helpers=[],ee.a.helpers&&(n.helpers=[new Ie.E(10,10),new Ie.d],n.helpers.forEach((function(e){n.scene.add(e)}))),n}return Object(he.a)(t,e),t}(Ce.a),Zt=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(c.a)(this,e),this.step=t.step||"",this.data=t.data||{}};function qt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=new Ie.l(e),a=n.getPoints(t);return{curve:n=new Ie.l(a),points:a}}var Kt,$t,Jt=function(e){function t(e,n,a){var o;return Object(c.a)(this,t),(o=Object(ue.a)(this,Object(de.a)(t).call(this))).updateSplines=function(){o.curves.origin=qt(o.origin,o.steps),o.curves.lookat=qt(o.lookat,o.steps)},o.get=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=o.curves.origin.curve.getPointAt(e),n=o.curves.lookat.curve.getPointAt(e);return{origin:t,lookat:n}},o.destroy=function(){o.curves.origin=null,o.curves.lookat=null},o.steps=a,o.origin=[],o.lookat=[],e.forEach((function(e){o.origin.push(new Ie.Qb(e.x,e.y,e.z))})),n.forEach((function(e){o.lookat.push(new Ie.Qb(e.x,e.y,e.z))})),o.curves={origin:qt(o.origin,a),lookat:qt(o.lookat,a)},o}return Object(he.a)(t,e),t}(Ce.a),en=n(3),tn=function(e){function t(e,n,a,o,i,r,s,l,u,d,h){var f;return Object(c.a)(this,t),(f=Object(ue.a)(this,Object(de.a)(t).call(this))).toggleVisibility=function(e){f.group.visible=e&&f.helpersVisible,f.guiEnabled&&(e&&f.guiOpen?(f.gui.open(),f.guiOrigin.open(),f.guiLookat.open()):(f.gui.close(),f.guiOrigin.close(),f.guiLookat.close()))},f.createPoints=function(e,t){t.forEach((function(t,n){f.points[e][n]=new Ie.W(f.pointGeometry,f.pointMaterial),f.points[e][n].position.set(t.x,t.y,t.z);f.points[e][n].scale.set(3,3,3),f.group.add(f.points[e][n])}))},f.createLine=function(e,t){var n=new Ie.D;n.vertices=t,f.lines[e]=new Ie.K(n,new Ie.L({color:16777215})),f.group.add(f.lines[e])},f.updateLine=function(e,t){t.forEach((function(t,n){f.lines[e].geometry.vertices[n].copy(t)})),f.lines[e].geometry.verticesNeedUpdate=!0},f.updatePoints=function(e,t){t.forEach((function(t,n){f.points[e][n].position.copy(t)}))},f.rebuild=function(){f.dolly.updateSplines(),f.updateLine("origin",f.dolly.curves.origin.points),f.updateLine("lookat",f.dolly.curves.lookat.points),f.updatePoints("origin",f.dolly.origin),f.updatePoints("lookat",f.dolly.lookat),f.emit("rebuild")},f.destroy=function(){f.guiEnabled&&f.guiParent.removeFolder(f.gui.name),Object(St.c)(f.group,f.scene)},f.id=e,f.uuid=en.f.generateUUID().split("-")[0],f.dolly=n,f.scene=a,f.helpersVisible=i,f.group=new Ie.F,f.group.visible=!1,f.scene.add(f.group),f.guiParent=o,f.guiEnabled=l,l&&(f.gui=o.addFolder("Dolly ".concat(f.id," ").concat(f.uuid)),f.guiOpen=u,u&&f.gui.open()),f.steps=r,f.range=s,f.lines={origin:null,lookat:null},f.points={origin:[],lookat:[]},f.pointGeometry=new Ie.Eb(.2,8,8),f.pointMaterial=new Ie.X,f.createPoints("origin",f.dolly.origin),f.createPoints("lookat",f.dolly.lookat),l&&(f.guiOrigin=f.gui.addFolder("origin"),f.guiLookat=f.gui.addFolder("lookat")),f.createLine("origin",f.dolly.curves.origin.points),f.createLine("lookat",f.dolly.curves.lookat.points),l&&(d&&f.guiOrigin.open(),h&&f.guiLookat.open(),f.dolly.origin.forEach((function(e,t){var n=f.guiOrigin.addFolder("".concat(t));n.open(),n.add(e,"x",-f.range,f.range).onChange(f.rebuild),n.add(e,"y",-f.range,f.range).onChange(f.rebuild),n.add(e,"z",-f.range,f.range).onChange(f.rebuild)})),f.dolly.lookat.forEach((function(e,t){var n=f.guiLookat.addFolder("".concat(t));n.open(),n.add(e,"x",-f.range,f.range).onChange(f.rebuild),n.add(e,"y",-f.range,f.range).onChange(f.rebuild),n.add(e,"z",-f.range,f.range).onChange(f.rebuild)}))),f.toggleVisibility(f.helpersVisible),f}return Object(he.a)(t,e),t}(Ce.a),nn=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).add=function(e,t,a){void 0!==n.dollies[e]&&(n.dollies[e].destroy(),n.helpers[e].off("rebuild",n.update),n.helpers[e].destroy()),n.dollies[e]=new Jt(t.origin,t.lookat,n.curveSteps),n.gui&&(n.helpers[e]=new tn(e,n.dollies[e],a,n.gui,n.helpersVisible,n.curveSteps,n.guiSliderRange,n.guiEnabled,n.guiOpen,n.guiOpenOrigin,n.guiOpenLookat),n.helpers[e].on("rebuild",n.update)),n.lookat=new Ie.Qb},n.export=function(){var e=JSON.stringify({origin:n.dollies[n.dolly].origin,lookat:n.dollies[n.dolly].lookat},void 0,2);window.prompt("Copy to clipboard: Ctrl+C, Enter",e)},n.set=function(e,t){void 0!==n.dollies[e]&&(n.dolly=e,n.camera=t,Object.keys(n.helpers).forEach((function(t){var a=t===e;n.helpers[t].toggleVisibility(a)})))},n.transition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Xe.d.easeOut;Xe.g.killTweensOf(Object(_e.a)(n)),n.time=0,n.update(),Xe.g.to(Object(_e.a)(n),e,{time:1,ease:t,onUpdate:function(){n.update()},onComplete:function(){n.emit("transitionComplete")}})},n.stop=function(){Xe.g.killTweensOf(Object(_e.a)(n))},n.update=function(){var e=n.dollies[n.dolly].get(n.time),t=e.origin,a=e.lookat;n.camera.position.set(t.x,t.y,t.z),n.lookat.set(a.x,a.y,a.z),n.camera.lookAt(n.lookat)},n.setCameraPositionFromTransition=function(e){var t=n.dollies[e].get(1),a=t.origin,o=t.lookat;n.camera.position.copy(a),n.camera.lookAt(o)},n.destroy=function(){Object.keys(n.dollies).forEach((function(e){n.dollies[e].destroy()})),Object.keys(n.helpers).forEach((function(e){n.helpers[e].destroy()}))},Object.assign(Object(_e.a)(n),e),n.dollies=[],n.helpers=[],n.curveSteps=20,n.dolly="",n.time=0,n.gui&&(n.gui.add(Object(_e.a)(n),"time",0,1).step(.001).onChange((function(){Xe.g.killTweensOf(Object(_e.a)(n)),n.update()})),n.gui.add(Object(_e.a)(n),"export")),n}return Object(he.a)(t,e),t}(Ce.a),an=(Kt={},Object(p.a)(Kt,"PAST_SCENE_INTRO",n(154)),Object(p.a)(Kt,"PAST_TRANSITION_IN",n(155)),Object(p.a)(Kt,"PAST_TRANSITION_OUT",n(156)),Kt),on=($t={},Object(p.a)($t,"PRESENT_SCENE_INTRO",n(157)),Object(p.a)($t,"PRESENT_TRANSITION_IN",n(158)),Object(p.a)($t,"PRESENT_TRANSITION_OUT",n(159)),$t),rn=Object(p.a)({},"FUTURE_TRANSITION_OUT",n(160)),sn=["PAST_SCENE_INTRO","PAST_TRANSITION_IN","PAST_TRANSITION_OUT","PRESENT_SCENE_INTRO","PRESENT_TRANSITION_IN","PRESENT_TRANSITION_OUT","FUTURE_TRANSITION_OUT"],cn=new(function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(ue.a)(this,Object(de.a)(t).call(this))).addTransition=function(t,n,a,o){e.cameraDolly.add(t,n,a,o)},e.onTransitionComplete=function(){e.emit("transitionComplete")},e.setTransition=function(t,n){e.camera=n,e.cameraDolly.set(t,n)},e.setCameraPositionFromTransition=function(t,n){e.setTransition(t,n),e.cameraDolly.setCameraPositionFromTransition(t)},e.setTransitionStartFromLast=function(t,n){n.origin[0].x=e.camera.position.x,n.origin[0].y=e.camera.position.y,n.origin[0].z=e.camera.position.z,n.lookat[0].x=t.lookat[t.lookat.length-1].x,n.lookat[0].y=t.lookat[t.lookat.length-1].y,n.lookat[0].z=t.lookat[t.lookat.length-1].z},e.transition=function(t,n){e.cameraDolly.transition(t,n)},e.stop=function(){e.cameraDolly.stop()},e.gui=je.b.addFolder("transitions"),e.cameraDolly=new nn({gui:e.gui,helpersVisible:!1,guiSliderRange:50,guiOpen:!0,guiEnabled:!0,guiOpenOrigin:!0,guiOpenLookat:!0}),e.gui.add(e.cameraDolly,"dolly",sn).onChange((function(t){e.cameraDolly.set(t,e.camera)})).listen(),e.cameraDolly.on("transitionComplete",e.onTransitionComplete),e}return Object(he.a)(t,e),t}(Ce.a)),ln=new Ie.Pb(8.5,70),un={time:{value:0},rockMap:{value:null},crystalMap:{value:null},aoPower:{value:ln.clone()},fresnelPow:{value:1},maskTransition:{value:1},backgroundColor:{value:new Ie.o(13161956)},mask:{value:null},brightness:{value:0}},dn="\n  vec3 rockVertexTransform(vec3 vPosition, vec2 tUv) {\n    float ao = texture2D(aoMap, tUv).r;\n    ao = pow(ao, 25.0);\n    vec3 transformed = vPosition;\n    float maskHeight = texture2D(mask, tUv).r * maskTransition;\n    vec3 height = (normalize(normal) * 2.0);\n    transformed += (height * maskHeight) * ao;\n    return transformed;\n  }\n",hn="\n  vec4 crystalColor(vec3 viewPosition, vec3 normalA, vec3 normalB) {\n    vec4 envColor = matcap(viewPosition, normalB, crystalMap);\n    return 1.5 * vec4(envColor.rgb + (normalB.rgb * normalA.rgb * 0.25), 0.5);\n  }\n",fn="\n  vec3 normal2 = normalize(cross(dFdx(vPosition), dFdy(vPosition)));\n  float maskHeight = texture2D(mask, vUv).r * maskTransition;\n  float ao = texture2D(aoMap, vUv).r;\n  ao = pow(ao, mix(aoPower.x, aoPower.y, 1.0 - maskHeight));\n  vec4 matcapColor = matcap(vViewPosition, normal, rockMap);\n  matcapColor.rgb *= ambientOcclusion;\n  gl_FragColor.rgb *= matcapColor.rgb;\n  vec4 crystal = crystalColor(vViewPosition, normal, normal2);\n\n  float cosTheta = abs(dot(normalize(vEye), normal));\n  float fresnel = pow(cosTheta, fresnelPow);\n\n  gl_FragColor = mix(gl_FragColor, crystal, ao);\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, backgroundColor, 1.0 - fresnel);\n\n  gl_FragColor.rgb = mix(gl_FragColor.rgb, gl_FragColor.rgb * 1.1, brightness);\n\n  gl_FragColor.a = opacity;\n",mn="\n  vec4 matcap(vec3 viewPosition, vec3 normal, sampler2D matcapTexture) {\n    vec3 viewDir = normalize(viewPosition);\n    vec3 x = normalize(vec3(viewDir.z, 0.0, - viewDir.x));\n    vec3 y = cross(viewDir, x);\n    // 0.495 to remove artifacts caused by undersized matcap disks\n    vec2 uvM = vec2(dot(x, normal), dot(y, normal)) * 0.495 + 0.5;\n    return matcapTexelToLinear(texture2D(matcapTexture, uvM));\n  }\n",pn={uniforms:"\n    uniform float time;\n    uniform sampler2D mask;\n    uniform float maskTransition;\n    uniform sampler2D aoMap;\n    varying vec3 vEye;\n    varying vec3 vPosition;\n  ",functions:"\n    ".concat(dn,"\n  "),postTransform:"\n    transformed = rockVertexTransform(position, vUv);\n    vec3 worldPosition = (modelMatrix * vec4(transformed, 1.0)).xyz;\n    vPosition = transformed;\n    vEye = cameraPosition - worldPosition.xyz;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n  "},vn={uniforms:"\n    #extension GL_OES_standard_derivatives : enable\n\n    uniform sampler2D mask;\n    uniform float maskTransition;\n    uniform sampler2D rockMap;\n    uniform sampler2D crystalMap;\n    uniform samplerCube envMap;\n    uniform float brightness;\n    uniform vec2 aoPower;\n    uniform vec3 backgroundColor;\n    uniform float fresnelPow;\n    varying vec3 vEye;\n    varying vec3 vPosition;\n  ",functions:"\n    ".concat(mn,"\n    ").concat(hn,"\n  "),postNormal:"\n  ",postAo:"\n  #ifdef USE_AOMAP\n    // reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n    ambientOcclusion = ( texture2D( aoMap, vUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n    #if defined( USE_ENVMAP ) && defined( PHYSICAL )\n      float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n      reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n    #endif\n  #endif\n  ",postFragColor:"\n    ".concat(fn,"\n  ")},gn={uniforms:"insertbefore:#include <common>\n",functions:"insertafter:#include <clipping_planes_pars_vertex>\n",preTransform:"insertafter:#include <begin_vertex>\n",postTransform:"insertafter:#include <project_vertex>\n",preNormal:"insertafter:#include <beginnormal_vertex>\n"},bn={uniforms:"insertbefore:#include <common>\n",functions:"insertafter:#include <clipping_planes_pars_fragment>\n",preFragColor:"insertbefore:gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",postFragColor:"insertafter:gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n"},xn=function(e,t,n){var a;for(var o in t)n[o]&&(a=/insert(before):(.*)|insert(after):(.*)/.exec(t[o]))&&(a[1]?e=e.replace(a[2],n[o]+"\n"+a[2]):a[3]&&(e=e.replace(a[4],a[4]+"\n"+n[o])));return e},yn=function(e){var t={};for(var n in e)t[n]=Object.assign({},e[n]);return t},wn=null,An=function(e){if(!wn){var t={standard:Ie.db,basic:Ie.X,lambert:Ie.Z,phong:Ie.cb,depth:Ie.Y,matcap:Ie.ab};for(var n in wn={},t)wn[n]={ShaderClass:t[n],ShaderLib:Ie.Ab[n],Key:n,Count:0,ModifiedName:function(){return"ModifiedMesh".concat(this.Key[0].toUpperCase()+this.Key.slice(1),"Material_").concat(++this.Count)},TypeCheck:"isMesh".concat(n[0].toUpperCase()+n.slice(1),"Material")}}var a;if("function"===typeof e){for(var o in wn)if(wn[o].ShaderClass===e){a=wn[o];break}}else a=wn[e];if(!a)throw new Error("No Shader found to modify...");return a},Pn=function(){function e(t,n){Object(c.a)(this,e),this._vertexHooks={},this._fragmentHooks={},t&&this.defineVertexHooks(t),n&&this.defineFragmentHooks(n)}return Object(le.a)(e,[{key:"modify",value:function(e,t){var n=An(e);return{vertexShader:xn(n.ShaderLib.vertexShader,this._vertexHooks,t.vertexShader||{}),fragmentShader:xn(n.ShaderLib.fragmentShader,this._fragmentHooks,t.fragmentShader||{}),uniforms:Object.assign({},n.ShaderLib.uniforms,t.uniforms||{})}}},{key:"extend",value:function(e,t){var n=An(e),a=xn(n.ShaderLib.vertexShader,this._vertexHooks,t.vertexShader||{}),o=xn(n.ShaderLib.fragmentShader,this._fragmentHooks,t.fragmentShader||{}),i=Object.assign({},n.ShaderLib.uniforms,t.uniforms||{}),r=t.className||n.ModifiedName(),s=new Function("BaseClass","uniforms","vertexShader","fragmentShader","cloneUniforms","\n\n            var cls = function ".concat(r,"( params ){\n\n                BaseClass.call( this, params );\n\n                this.uniforms = cloneUniforms( uniforms );\n\n                this.vertexShader = vertexShader;\n                this.fragmentShader = fragmentShader;\n                this.type = '").concat(r,"';\n\n                this.setValues( params );\n\n            }\n\n            cls.prototype = Object.create( BaseClass.prototype );\n            cls.prototype.constructor = cls;\n            cls.prototype.").concat(n.TypeCheck," = true;\n\n            cls.prototype.copy = function( source ){\n\n                BaseClass.prototype.copy.call( this, source );\n\n                this.uniforms = Object.assign( {}, source.uniforms );\n                this.vertexShader = vertexShader;\n                this.fragmentShader = fragmentShader;\n                this.type = '").concat(r,"';\n\n                return this;\n\n            }\n\n            return cls;\n\n        "));return t.postModifyVertexShader&&(a=t.postModifyVertexShader(a)),t.postModifyFragmentShader&&(o=t.postModifyFragmentShader(o)),s(n.ShaderClass,i,a,o,yn)}},{key:"defineVertexHooks",value:function(e){for(var t in e)this._vertexHooks[t]=e[t]}},{key:"defineFragmentHooks",value:function(e){for(var t in e)this._fragmentHooks[t]=e[t]}}]),e}(),Tn=(new Pn(gn,bn),new Pn);Tn.defineVertexHooks({uniforms:"insertbefore:#include <common>\n",functions:"insertafter:#include <clipping_planes_pars_vertex>\n",preTransform:"insertafter:#include <begin_vertex>\n",postTransform:"insertafter:#include <project_vertex>\n",preNormal:"insertafter:#include <beginnormal_vertex>\n"}),Tn.defineFragmentHooks({uniforms:"insertbefore:#include <common>\n",functions:"insertafter:#include <clipping_planes_pars_fragment>\n",preFragColor:"insertbefore:gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",postFragColor:"insertafter:gl_FragColor = vec4( outgoingLight, diffuseColor.a );\n",postMap:"insertafter:#include <map_fragment>\n",postRoughness:"insertafter:#include <roughnessmap_fragment>\n",postNormal:"insertafter:#include <normal_fragment_maps>\n",postAo:"insertafter:#include <aomap_fragment>\n"});var Sn=Tn,Fn=(n(53),function(){function e(){Object(c.a)(this,e),this.x=0,this.y=0,this.percent=0,this.active=!1}return Object(le.a)(e,[{key:"touchStart",value:function(){Xe.g.killTweensOf(this),this.percent=0,this.active=!0,Xe.g.to(this,.1,{percent:1,ease:Xe.f.easeOut})}},{key:"touchEnd",value:function(){this.active=!1,Xe.g.killTweensOf(this)}},{key:"brush",value:function(e,t,n,a){e.beginPath();var o=e.createRadialGradient(n,a,0,n,a,t),i=this.percent;o.addColorStop(1,"rgba(0, 0, 0, 1)"),o.addColorStop(0,"rgba(".concat(Math.floor(255*i),", 0, 0, ").concat(i,")")),e.fillStyle=o,e.arc(n,a,t,0,en.c,!1),e.fill()}},{key:"draw",value:function(e,t){if(this.active){var n=this.percent*en.f.lerp(60,80,this.percent);if(this.brush(e,n,this.x,this.y),this.x<n){var a=0-this.x+n;this.brush(e,n,512-a+n,this.y)}else if(512-this.x<n){var o=this.x+n-512;this.brush(e,n,o-n,this.y)}e.closePath()}}}]),e}()),En=function(){function e(t){var n=this;Object(c.a)(this,e),this.export=function(){var e=document.createElement("a");e.download="screenshot.png",e.href=n.canvas.toDataURL(),e.click()},this.onTouchStart=function(e){var t=en.f.clamp(e[0].x/n.canvas.width,0,1),a=en.f.clamp(e[0].y/n.canvas.height,0,1);n.paintStart(t,a)},this.onTouchMove=function(e){var t=en.f.clamp(e[0].x/n.canvas.width,0,1),a=en.f.clamp(e[0].y/n.canvas.height,0,1);n.paintMove(t,a)},this.onTouchEnd=function(){n.paintEnd()},this.gui=t.addFolder("paint");var a=Object(rt.a)(512,512),o=a.canvas,i=a.ctx;this.canvas=o,this.ctx=i,this.brushes=[],this.brushIndex=0;for(var r=0;r<5;r++)this.brushes.push(new Fn);this.texture=new Ie.Ib(this.canvas),Object.assign(o.style,{top:"0px",left:"0px",position:"absolute",zIndex:1e3,border:"1px solid white",pointerEvents:"none",transform:"scale(0.5)",transformOrigin:"0 0"}),this.gui.add(this,"export")}return Object(le.a)(e,[{key:"setActive",value:function(e){}},{key:"hitboxTouchStart",value:function(e){this.paintStart(e.x,1-e.y)}},{key:"hitboxTouchMove",value:function(e){this.paintMove(e.x,1-e.y)}},{key:"hitboxTouchEnd",value:function(){this.paintEnd()}},{key:"paintStart",value:function(e,t){this.brushIndex++,this.brushIndex>=this.brushes.length&&(this.brushIndex=0),this.setBrushPosition(e,t),this.brushes[this.brushIndex].touchStart()}},{key:"paintMove",value:function(e,t){this.setBrushPosition(e,t)}},{key:"paintEnd",value:function(){this.brushes[this.brushIndex].touchEnd()}},{key:"setBrushPosition",value:function(e,t){this.brushes[this.brushIndex].x=e*this.canvas.width,this.brushes[this.brushIndex].y=t*this.canvas.height}},{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.texture.needsUpdate=!0}},{key:"draw",value:function(e){for(var t=!1,n=0;n<5;n++)t||(t=this.brushes[n].active);if(t){this.ctx.save(),this.ctx.globalCompositeOperation="screen";for(var a=0;a<5;a++)this.brushes[a].draw(this.ctx,e);this.ctx.restore(),this.texture.needsUpdate=!0}}},{key:"onStateChanged",value:function(e){switch(e.sceneStep){case De.A:this.reset();break;case De.y:this.reset(),this.setActive(!0);break;case De.z:this.setActive(!1)}}},{key:"reset",value:function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(var e=0;e<5;e++)this.brushes[e].touchEnd();this.texture.needsUpdate=!0}}]),e}(),_n=_n||{};_n.DomEvents=function(e,t){this._camera=e||null,this._domElement=t||document,this._raycaster=new Ie.wb,this._selected=null,this._boundObjs={};var n=this;this._$onClick=function(){n._onClick.apply(n,arguments)},this._$onDblClick=function(){n._onDblClick.apply(n,arguments)},this._$onMouseMove=function(){n._onMouseMove.apply(n,arguments)},this._$onMouseDown=function(){n._onMouseDown.apply(n,arguments)},this._$onMouseUp=function(){n._onMouseUp.apply(n,arguments)},this._$onTouchMove=function(){n._onTouchMove.apply(n,arguments)},this._$onTouchStart=function(){n._onTouchStart.apply(n,arguments)},this._$onTouchEnd=function(){n._onTouchEnd.apply(n,arguments)},this._$onContextmenu=function(){n._onContextmenu.apply(n,arguments)},this._domElement.addEventListener("click",this._$onClick,!1),this._domElement.addEventListener("dblclick",this._$onDblClick,!1),this._domElement.addEventListener("mousemove",this._$onMouseMove,!1),this._domElement.addEventListener("mousedown",this._$onMouseDown,!1),this._domElement.addEventListener("mouseup",this._$onMouseUp,!1),this._domElement.addEventListener("touchmove",this._$onTouchMove,!1),this._domElement.addEventListener("touchstart",this._$onTouchStart,!1),this._domElement.addEventListener("touchend",this._$onTouchEnd,!1),this._domElement.addEventListener("contextmenu",this._$onContextmenu,!1)},_n.DomEvents.prototype.destroy=function(){this._domElement.removeEventListener("click",this._$onClick,!1),this._domElement.removeEventListener("dblclick",this._$onDblClick,!1),this._domElement.removeEventListener("mousemove",this._$onMouseMove,!1),this._domElement.removeEventListener("mousedown",this._$onMouseDown,!1),this._domElement.removeEventListener("mouseup",this._$onMouseUp,!1),this._domElement.removeEventListener("touchmove",this._$onTouchMove,!1),this._domElement.removeEventListener("touchstart",this._$onTouchStart,!1),this._domElement.removeEventListener("touchend",this._$onTouchEnd,!1),this._domElement.removeEventListener("contextmenu",this._$onContextmenu,!1)},_n.DomEvents.eventNames=["click","dblclick","mouseover","mouseout","mousemove","mousedown","mouseup","contextmenu","touchstart","touchend"],_n.DomEvents.prototype._getRelativeMouseXY=function(e){var t=e.target||e.srcElement;3===t.nodeType&&(t=t.parentNode);var n={x:0,y:0},a=t,o=getComputedStyle(a,null);n.y+=parseInt(o.getPropertyValue("padding-top"),10),n.x+=parseInt(o.getPropertyValue("padding-left"),10);do{n.x+=a.offsetLeft,n.y+=a.offsetTop,o=getComputedStyle(a,null),n.x+=parseInt(o.getPropertyValue("border-left-width"),10),n.y+=parseInt(o.getPropertyValue("border-top-width"),10)}while(a=a.offsetParent);var i=t===window?window.innerWidth:t.offsetWidth,r=t===window?window.innerHeight:t.offsetHeight;return{x:+(e.pageX-n.x)/i*2-1,y:-(e.pageY-n.y)/r*2+1}},_n.DomEvents.prototype._objectCtxInit=function(e){e._3xDomEvent={}},_n.DomEvents.prototype._objectCtxDeinit=function(e){delete e._3xDomEvent},_n.DomEvents.prototype._objectCtxIsInit=function(e){return!!e._3xDomEvent},_n.DomEvents.prototype._objectCtxGet=function(e){return e._3xDomEvent},_n.DomEvents.prototype.camera=function(e){return e&&(this._camera=e),this._camera},_n.DomEvents.prototype.bind=function(e,t,n,a){console.assert(-1!==_n.DomEvents.eventNames.indexOf(t),"not available events:".concat(t)),this._objectCtxIsInit(e)||this._objectCtxInit(e);var o=this._objectCtxGet(e);o["".concat(t,"Handlers")]||(o["".concat(t,"Handlers")]=[]),o["".concat(t,"Handlers")].push({callback:n,useCapture:a}),void 0===this._boundObjs[t]&&(this._boundObjs[t]=[]),this._boundObjs[t].push(e)},_n.DomEvents.prototype.addEventListener=_n.DomEvents.prototype.bind,_n.DomEvents.prototype.unbind=function(e,t,n,a){console.assert(-1!==_n.DomEvents.eventNames.indexOf(t),"not available events:".concat(t)),this._objectCtxIsInit(e)||this._objectCtxInit(e);var o=this._objectCtxGet(e);o["".concat(t,"Handlers")]||(o["".concat(t,"Handlers")]=[]);for(var i=o["".concat(t,"Handlers")],r=0;r<i.length;r++){var s=i[r];if(n==s.callback&&a==s.useCapture){i.splice(r,1);break}}if(void 0!==this._boundObjs[t]){var c=this._boundObjs[t].indexOf(e);this._boundObjs[t].splice(c,1)}},_n.DomEvents.prototype.removeEventListener=_n.DomEvents.prototype.unbind,_n.DomEvents.prototype._bound=function(e,t){var n=this._objectCtxGet(t);return!!n&&!!n["".concat(e,"Handlers")]},_n.DomEvents.prototype._onMove=function(e,t,n,a){var o=this._boundObjs[e];if(void 0!==o&&0!==o.length){var i=new Ie.Pb;i.set(t,n),this._raycaster.setFromCamera(i,this._camera);var r=this._raycaster.intersectObjects(o),s=this._selected;if(r.length>0){var c,l,u,d=r[0],h=d.object;this._selected=h,u=this._bound("mousemove",h),s!=h&&(c=this._bound("mouseover",h),l=s&&this._bound("mouseout",s))}else l=s&&this._bound("mouseout",s),this._selected=null;u&&this._notify("mousemove",h,a,d),c&&this._notify("mouseover",h,a,d),l&&this._notify("mouseout",s,a,d)}},_n.DomEvents.prototype._onEvent=function(e,t,n,a){var o=this._boundObjs[e];if(void 0!==o&&0!==o.length){var i=new Ie.Pb;i.set(t,n),this._raycaster.setFromCamera(i,this._camera);var r=this._raycaster.intersectObjects(o,!0);if(0!==r.length){for(var s=r[0],c=s.object,l=this._objectCtxGet(c),u=c.parent;"undefined"===typeof l&&u;)l=this._objectCtxGet(u),u=u.parent;l&&this._notify(e,c,a,s)}}},_n.DomEvents.prototype._notify=function(e,t,n,a){var o=this._objectCtxGet(t),i=o?o["".concat(e,"Handlers")]:null;if(console.assert(4===arguments.length),o&&i&&0!==i.length){i=o["".concat(e,"Handlers")];for(var r=0;r<i.length;r++){var s=i[r],c=!0;s.callback({type:e,target:t,origDomEvent:n,intersect:a,stopPropagation:function(){c=!1}}),c&&(!1===s.useCapture&&t.parent&&this._notify(e,t.parent,n,a))}}else t.parent&&this._notify(e,t.parent,n,a)},_n.DomEvents.prototype._onMouseDown=function(e){return this._onMouseEvent("mousedown",e)},_n.DomEvents.prototype._onMouseUp=function(e){return this._onMouseEvent("mouseup",e)},_n.DomEvents.prototype._onMouseEvent=function(e,t){var n=this._getRelativeMouseXY(t);this._onEvent(e,n.x,n.y,t)},_n.DomEvents.prototype._onMouseMove=function(e){var t=this._getRelativeMouseXY(e);this._onMove("mousemove",t.x,t.y,e),this._onMove("mouseover",t.x,t.y,e),this._onMove("mouseout",t.x,t.y,e)},_n.DomEvents.prototype._onClick=function(e){this._onMouseEvent("click",e)},_n.DomEvents.prototype._onDblClick=function(e){this._onMouseEvent("dblclick",e)},_n.DomEvents.prototype._onContextmenu=function(e){this._onMouseEvent("contextmenu",e)},_n.DomEvents.prototype._onTouchStart=function(e){return this._onTouchEvent("touchstart",e)},_n.DomEvents.prototype._onTouchEnd=function(e){return this._onTouchEvent("touchend",e)},_n.DomEvents.prototype._onTouchMove=function(e){if(1==e.touches.length){var t=+e.touches[0].pageX/window.innerWidth*2-1,n=-e.touches[0].pageY/window.innerHeight*2+1;this._onMove("mousemove",t,n,e),this._onMove("mouseover",t,n,e),this._onMove("mouseout",t,n,e)}},_n.DomEvents.prototype._onTouchEvent=function(e,t){if(1==t.touches.length){var n=+t.touches[0].pageX/window.innerWidth*2-1,a=-t.touches[0].pageY/window.innerHeight*2+1;this._onEvent(e,n,a,t)}};var On=_n.DomEvents,Cn=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(ue.a)(this,Object(de.a)(t).call(this))).setActive=function(e){a.active=e;var t=e?"bind":"unbind";ee.a.isDesktop?(a.domEvents[t](a.mesh,"mouseover",a.onMouseOver),a.domEvents[t](a.mesh,"mouseout",a.onMouseOut),a.domEvents[t](a.mesh,"mousedown",a.onTouchStart),a.domEvents[t](a.mesh,"mousemove",a.onTouchMove),document.body.addEventListener("mouseup",a.onTouchEnd,!1)):(a.domEvents[t](a.mesh,"touchstart",a.onTouchStart),a.domEvents[t](a.mesh,"mousemove",a.onTouchMove),document.body.addEventListener("touchend",a.onTouchEnd,!1))},a.onMouseOver=function(){a.active&&(Object(Me.g)(!0),a.emit("over"))},a.onMouseOut=function(){a.active&&(Object(Me.g)(!1),a.emit("out"))},a.onTouchStart=function(e){a.active&&(a.isDown=!0,a.emit("start",e.intersect.uv))},a.onTouchMove=function(e){a.active&&a.isDown&&a.emit("move",e.intersect.uv)},a.onTouchEnd=function(){a.active&&(a.isDown=!1,a.emit("end"))},a.domEvents=new On(e,Me.b.domElement),a.isDown=!1,a.mesh=n,a}return Object(he.a)(t,e),t}(Ce.a),In="\nfloat mapLinear(float value, float in_min, float in_max, float out_min, float out_max) {\n\treturn (value - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;\n}\n",Mn="\n  uniform float time;\n  uniform sampler2D mask;\n  uniform float maskTransition;\n  uniform sampler2D aoMap;\n  uniform sampler2D displacementMap;\n  uniform float displacementScale;\n  uniform float displacementBias;\n  // varying vec2 vUv;\n  varying vec3 vPosition;\n  ".concat(dn,"\n\n  void main() {\n    vec3 transformed = rockVertexTransform(position, uv);\n    vec3 vPositionUvSpace = vec3((uv * 2.0 - vec2(1.0)) * ").concat(.8,", 1.0);\n    vPosition = transformed;\n    gl_Position = vec4(vPositionUvSpace, 1.0);\n    // gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0); // proj\n  }\n"),Ln="\n  varying vec3 vPosition;\n  ".concat(In,"\n  void main() {\n    float x = mapLinear(vPosition.x, -").concat(20,".0, ").concat(20,".0, 0.0, 1.0);\n    float y = mapLinear(vPosition.y, -").concat(20,".0, ").concat(20,".0, 0.0, 1.0);\n    float z = mapLinear(vPosition.z, -").concat(20,".0, ").concat(20,".0, 0.0, 1.0);\n    gl_FragColor = vec4(vec3(x, y, z) , 1.0);\n    // gl_FragColor = vec4(vPosition * 0.1 , 1.0);\n  }\n"),Nn=("\n  uniform float time;\n  uniform sampler2D uHeight;\n  uniform float maskTransition;\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    vec3 transformed = position;\n    vec2 uvOffset = uv - vec2(0.5);\n    uvOffset *= ".concat(.8,"; // Scale for padding\n    uvOffset += vec2(0.5);\n    vec3 pos = texture2D(uHeight, uvOffset).rgb;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);\n  }\n"),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).setActive=function(e){n.active=e;var t=e?"bind":"unbind";ee.a.isDesktop?(n.domEvents[t](n.mesh,"mousedown",n.onTouchStart),n.domEvents[t](n.mesh,"mousemove",n.onTouchMove),document.body.addEventListener("mouseup",n.onTouchEnd,!1)):(n.domEvents[t](n.mesh,"touchstart",n.onTouchStart),n.domEvents[t](n.mesh,"mousemove",n.onTouchMove),document.body.addEventListener("touchend",n.onTouchEnd,!1))},n.onTouchStart=function(e){n.active&&(n.isDown=!0,n.emit("start",e.intersect.point))},n.onTouchMove=function(e){n.active&&n.isDown&&n.emit("move",e.intersect.point)},n.onTouchEnd=function(){n.active&&(n.isDown=!1,n.emit("end"))},n.domEvents=new On(e,Me.b.domElement),n.mesh=new Ie.W(new Ie.mb(100,100),new Ie.X({wireframe:!1})),n.isDown=!1,n}return Object(he.a)(t,e),t}(Ce.a)),kn=n(46),jn=n(17),Un=new Ie.Qb,Rn=new Ie.Qb(1,1,.1),Dn=new Ie.Pb(.01,.035),Xn=function(e){function t(e,n,a,o){var i;Object(c.a)(this,t),(i=Object(ue.a)(this,Object(de.a)(t).call(this))).setMatcap=function(e,t){e.value=Tt.a.get(De.B,"rock-matcap-".concat(t)),e.value.needsUpdate=!0},i.rtt=function(){i.renderToTexture=!0},i.onStateChanged=function(e){switch(i.paint.onStateChanged(e),i.state=e,e.sceneStep){case De.E:i.onBgHitboxInteract(Rn,!1),Xe.g.to(i.tweens.maskTransition,1,{value:0,ease:Xe.f.easeOut,onUpdate:function(){i.setMaskTransition(i.tweens.maskTransition.value)}}),i.paint.onStateChanged(e);break;case De.y:i.group.position.copy(en.e),i.setActive(!0),i.paint.onStateChanged(e);break;case De.z:i.scaleMesh(!1),i.setActive(!1),i.renderToTexture=!0,Xe.g.to(i.speedRange,4,{x:.001});break;default:i.renderToTexture=!1,i.group.position.copy(Un),Xe.g.killTweensOf(i.tweens.meshScale),Xe.g.killTweensOf(i.tweens.interactionProgress),i.tweens.meshScale.value=0,i.tweens.interactionProgress.value=0,i.speedRange.set(Dn.x,Dn.y),i.onBgHitboxInteract(Rn,!1),i.lookAtHelper.rotation.set(0,0,0),i.mesh.visible=!0,i.setMaskTransition(0),i.paint.clear()}},i.setActive=function(e){var t=e?"on":"off";i.hitbox[t]("start",i.onHitboxStart),i.hitbox[t]("move",i.onHitboxMove),i.hitbox[t]("end",i.onHitboxEnd),i.bgHitbox[t]("start",i.onBgHitboxInteract),i.bgHitbox[t]("move",i.onBgHitboxInteract);try{i.hitbox.setActive(e),i.bgHitbox.setActive(e)}catch(n){}},i.onHitboxStart=function(e){i.paint.clear(),Xe.g.killTweensOf(i.tweens.maskTransition),i.setMaskTransition(1),i.paint.hitboxTouchStart(e),i.crystalTexture.needsUpdate=!0,i.scaleMesh(!0)},i.onHitboxMove=function(e){i.paint.hitboxTouchMove(e),i.crystalTexture.needsUpdate=!0},i.setMaskTransition=function(e){i.mesh.material.uniforms.maskTransition.value=e,i.heightMesh.material.uniforms.maskTransition.value=e},i.onHitboxEnd=function(){i.paint.hitboxTouchEnd(),i.scaleMesh(!1)},i.scaleMesh=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Xe.g.killTweensOf(i.tweens.meshScale),Xe.g.killTweensOf(i.tweens.interactionProgress);var t=e?1:0;e?jn.a.play(De.B,Ft.m):jn.a.stop(De.B,Ft.m);var n=e?8:3;Xe.g.to(i.tweens.interactionProgress,n,{value:t,ease:Xe.c.easeNone,onUpdate:function(){i.emit("interactionProgress",i.tweens.interactionProgress.value)},onComplete:function(){e&&i.emit("complete")}}),Xe.g.to(i.tweens.meshScale,n,{value:t,ease:Xe.f.easeOut,onUpdate:function(){var t=1;t=i.tweens.meshScale.value<.995?en.f.lerp(1,1.35,Object(en.g)(i.tweens.meshScale.value,0,.995)):en.f.lerp(1.35,1.5,Object(en.g)(i.tweens.meshScale.value,.995,1)),i.group.scale.set(t,t,t);var n=Object(en.g)(i.tweens.meshScale.value,.975,1);i.material.uniforms.aoPower.value.x=en.f.lerp(ln.x,0,n),i.material.uniforms.aoPower.value.y=en.f.lerp(ln.y,0,n),i.material.opacity=en.f.lerp(1,.45,n);var a=Object(en.g)(i.tweens.meshScale.value,e?.9995:.5,1);i.material.uniforms.brightness.value=en.f.lerp(0,1,a)}}),e||i.state.sceneStep!==De.y||(Xe.g.killTweensOf(i.tweens.maskTransition),i.tweens.maskTransition.value=1,Xe.g.to(i.tweens.maskTransition,1,{value:0,ease:Xe.f.easeOut,onUpdate:function(){i.setMaskTransition(i.tweens.maskTransition.value)},onComplete:function(){i.paint.clear()}}))},i.onBgHitboxInteract=function(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.z=20,i.lookAtHelper.lookAt(e),i.lookAtEase.setValue(i.lookAtHelper.rotation.x,i.lookAtHelper.rotation.y,i.lookAtHelper.rotation.z)},i.update=function(e,t){i.material.uniforms.time.value+=e,i.paint.draw(e),i.lookAtEase.update(),i.speed=i.speedRange.x+en.f.lerp(0,i.speedRange.y,i.tweens.meshScale.value),i.rotationAxis.copy(i.lookAtEase.value).negate().normalize(),i.rotationMatrix.makeRotationAxis(i.rotationAxis,i.speed),i.rotationMatrix.multiply(i.mesh.matrix),i.mesh.matrix.copy(i.rotationMatrix),i.mesh.rotation.setFromRotationMatrix(i.mesh.matrix),i.renderToTexture&&(Me.b.setRenderTarget(i.renderTarget),Me.b.render(i.renderTargetScene,t),Me.b.setRenderTarget(null),i.renderToTexture=!1,i.emit("renderTargetRender",i.renderTarget),i.mesh.visible=!1)},i.dispose=function(){i.guiParent.removeFolder(i.gui.name)},i.guiParent=e,i.gui=e.addFolder("rock"),i.group=new Ie.hb,i.crystalTexture=o,i.tweens={meshScale:{value:0},interactionProgress:{value:0},maskTransition:{value:1}},i.speedRange=new Ie.Pb(Dn.x,Dn.y),i.speed=i.speedRange.x,i.rotationMatrix=new Ie.V,i.rotationAxis=new Ie.Qb(0,0,0),i.lookAtEase=new kn.b,i.lookAtEase.easing=.015,i.gui.add(i.speedRange,"x",0,1),i.gui.add(i.speedRange,"y",0,1),i.gui.add(i.lookAtEase,"easing",0,.1),i.paint=new En(i.gui);var r=Sn.extend(Ie.db,{uniforms:un,vertexShader:pn,fragmentShader:vn}),s={color:11519999,rockMap:7,crystalMap:25},l=Tt.a.get(De.B,"rock-map")[0].data,u=Tt.a.get(De.B,"rock-map")[1].data,d=Tt.a.get(De.B,"rock-matcap");i.material=new r({color:s.color,normalMap:l,aoMap:u,roughness:0,metalness:0,aoMapIntensity:.6,normalMapType:Ie.ib,transparent:!0,fog:!1}),i.material.uniforms.mask.value=i.paint.texture,i.material.uniforms.rockMap.value=d,i.material.uniforms.crystalMap.value=o.texture,i.gui.add(i.material,"aoMapIntensity",0,10),i.gui.add(i.material,"roughness",0,1),i.gui.add(i.material,"metalness",0,1),i.gui.add(i.material.uniforms.aoPower.value,"x",0,10),i.gui.add(i.material.uniforms.aoPower.value,"y",0,3e3),i.gui.add(i.material.uniforms.fresnelPow,"value",0,20).name("fresnelPow"),i.gui.add(i.material.uniforms.brightness,"value",0,1).name("brightness");i.gui.add(i.group.position,"x",-50,50),i.gui.add(i.group.position,"y",-50,50),i.gui.add(i.group.position,"z",-50,50),i.gui.add(s,"rockMap",0,-1).step(1).onChange((function(e){i.setMatcap(i.material.uniforms.rockMap,e)})),i.gui.addColor(s,"color").onChange((function(e){i.material.color.setHex(Number("".concat(s.color).replace("#","0x")))})),i.mesh=new Ie.W(a,i.material),i.group.add(i.mesh),i.gui.add(i.mesh,"visible"),i.hitbox=new Cn(n,i.mesh),i.bgHitbox=new Nn(n);i.renderTarget=Object(Me.a)(128,128,{format:Ie.ub,type:Ie.Ob,minFilter:Ie.eb,magFilter:Ie.eb,wrapS:Ie.m,wrapT:Ie.m}),i.renderTargetScene=new Ie.yb,i.renderTargetCamera=new Ie.jb(-1,1,1,-1,0,1);var h=new Ie.Bb({uniforms:{aoMap:{value:u},mask:{value:i.paint.texture},maskTransition:{value:0},time:{value:0}},vertexShader:Mn,fragmentShader:Ln});return i.heightMesh=new Ie.W(a,h),i.renderTargetScene.add(i.heightMesh),i.renderToTexture=!1,i.gui.add(Object(_e.a)(i),"rtt"),i.lookAtHelper=new Ie.W(new Ie.g(1,1,2),new Ie.X),i.onBgHitboxInteract(Rn,!1),i}return Object(he.a)(t,e),t}(Ce.a),zn=function(){function e(t){var n,a=this;Object(c.a)(this,e),this.onUpdate=function(){a.material.uniforms.color0.value.setHex(a.config.color0),a.material.uniforms.color1.value.setHex(a.config.color1)},this.guiParent=t,this.config={color0:13161956,color1:7575750},this.material=new Ie.Bb({uniforms:{color0:{value:new Ie.o(this.config.color0)},color1:{value:new Ie.o(this.config.color1)},strength:{value:2.5},powStrength:{value:1.3}},vertexShader:"\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader:"\n  uniform vec3 color0;\n  uniform vec3 color1;\n  uniform float strength;\n  uniform float powStrength;\n  varying vec2 vUv;\n\n  void main() {\n    float y = distance(vec2(0.5), vec2(0.5, vUv.y)) * strength;\n    y = pow(y, powStrength);\n    vec3 color = mix(color0, color1, y);\n\n    gl_FragColor = vec4(color, 1.0);\n  }\n",side:Ie.e}),this.gui=t.addFolder("background"),this.gui.add(this.material.uniforms.strength,"value",0,10).onChange(this.onUpdate),this.gui.add(this.material.uniforms.powStrength,"value",0,10).onChange(this.onUpdate),this.gui.addColor(this.config,"color0").onChange(this.onUpdate),this.gui.addColor(this.config,"color1").onChange(this.onUpdate);var o=(n={},Object(p.a)(n,De.q,[32,16]),Object(p.a)(n,De.r,[18,8]),n)[Object(De.K)()];this.mesh=new Ie.W(new Ie.Eb(50,o[0],o[1]),this.material),this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix()}return Object(le.a)(e,[{key:"dispose",value:function(){this.guiParent.removeFolder(this.gui.name)}}]),e}(),Yn="\nmat4 rotationMatrix(vec3 axis, float angle) {\n  axis = normalize(axis);\n  float s = sin(angle);\n  float c = cos(angle);\n  float oc = 1.0 - c;\n  return mat4(oc * axis.x * axis.x + c,\n              oc * axis.x * axis.y - axis.z * s,\n              oc * axis.z * axis.x + axis.y * s,\n              0.0,\n              oc * axis.x * axis.y + axis.z * s,\n              oc * axis.y * axis.y + c,\n              oc * axis.y * axis.z - axis.x * s,\n              0.0,\n              oc * axis.z * axis.x - axis.y * s,\n              oc * axis.y * axis.z + axis.x * s,\n              oc * axis.z * axis.z + c,\n              0.0,\n              0.0, 0.0, 0.0, 1.0);\n}\n  vec3 rotate(vec3 v, vec3 axis, float angle) {\n    mat4 m = rotationMatrix(axis, angle);\n    return (m * vec4(v, 1.0)).xyz;\n  }\n",Bn={uniforms:"\n    uniform float time;\n    uniform float explode;\n    uniform float maskTransition;\n\t\tattribute vec3 mcol0;\n\t\tattribute vec3 mcol1;\n\t\tattribute vec3 mcol2;\n\t\tattribute vec3 mcol3;\n\n\t\tattribute vec2 uvcol0;\n\t\tattribute vec2 uvcol1;\n\t\tattribute vec2 uvcol2;\n\t\tattribute vec2 uvcol3;\n\n\t\tattribute vec3 aCenter;\n\t\tattribute float aIndex;\n\t\tattribute vec4 aAxis;\n    // varying vec3 vWorldPosition;\n    varying vec3 vEye;\n    varying vec3 vPosition;\n    // varying vec3 vColorId;\n    // varying vec2 vRockUv;\n\n\n  ",functions:"\n    ".concat(Yn,"\n  "),postTransform:"\n    transformed = position;\n\n    // vec3 col = vec3(0.0);\n\n    if (aIndex == 0.0) {\n      // col.r = 1.0;\n      transformed = mcol0;\n      vUv = uvcol0;\n    } else if (aIndex == 0.25) {\n      // col.g = 1.0;\n      transformed = mcol1;\n      vUv = uvcol1;\n    } else if (aIndex == 0.75) {\n      // col.b = 1.0;\n      transformed = mcol2;\n      vUv = uvcol2;\n    } else {\n      transformed = mcol3;\n      vUv = uvcol3;\n    }\n\n    float ambientSpeed = 0.45;\n    float motionRange = 0.2;\n    float motionX = mix(-motionRange, motionRange, sin(aAxis.w + time * ambientSpeed) * 0.5 + 0.5);\n    float motionY = mix(-motionRange, motionRange, cos(aAxis.w + time * ambientSpeed) * 0.5 + 0.5);\n    float motionZ = mix(-motionRange, motionRange, sin(aAxis.w + time * ambientSpeed) * 0.5 + 0.5);\n\n    // Ambient motion\n    vec3 ambientMotion = vec3(motionX, motionY, motionZ) * explode;\n\n\n    vec3 rotationAxis = vec3(0.0, 1.0, 0.0);\n    float speed = mix(5.0, 0.5, explode);\n    float rotateAngle  = (time + aAxis.w) * speed * explode;\n    transformed += ambientMotion;\n\n    vec3 rotated = rotate(transformed - aCenter, aAxis.xyz, rotateAngle);\n    vec3 direction = normalize(aCenter - vec3(0.0));\n    float explodeScalar = mix(6.0, 40.0, aAxis.x);\n\n    vec3 center = mix(aCenter, aCenter + direction * explodeScalar, explode);\n    transformed = center + rotated;\n\n    vViewPosition = - (modelViewMatrix * vec4(transformed, 1.0)).xyz;\n\n    vPosition = transformed;\n\n    // vColorId = col;\n\n    vEye = cameraPosition - (modelMatrix * vec4(transformed, 1.0)).xyz;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n\n    mvPosition = (modelMatrix * vec4(transformed, 1.0));\n\n    ".concat(Ie.zb.fog_vertex,"\n  ")},Qn={uniforms:"\n    #extension GL_OES_standard_derivatives : enable\n    uniform sampler2D crystalMap;\n    uniform sampler2D rockMap;\n    uniform sampler2D mask;\n    uniform float maskTransition;\n    uniform vec2 aoPower;\n    uniform float fresnelPow;\n    uniform vec3 backgroundColor;\n    uniform float brightness;\n    // uniform float fogPow;\n    varying vec3 vEye;\n    varying vec3 vPosition;\n    // varying vec3 vColorId;\n\n\n  ",functions:"\n    ".concat(mn,"\n    ").concat(hn,"\n  "),postAo:"\n    #ifdef USE_AOMAP\n      // reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\n      ambientOcclusion = ( texture2D( aoMap, vUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n      #if defined( USE_ENVMAP ) && defined( PHYSICAL )\n        float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n        reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n      #endif\n    #endif\n  ",postFragColor:"\n    normal = (texture2D(normalMap, vUv)).xyz * 2.0 - 1.0;\n    #ifdef DOUBLE_SIDED\n\t\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n    normal = normalize( normalMatrix * normal );\n    ".concat(fn,"\n\n    #ifdef USE_FOG\n      #ifdef FOG_EXP2\n        float fogFactor2 = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n      #else\n        float fogFactor2 = smoothstep( fogNear, fogFar, fogDepth );\n      #endif\n      gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor2);\n    #endif\n\n    // gl_FragColor = vec4(1);\n  ")},Vn=new Ie.Qb,Hn=new Ie.Qb,Gn=new Ie.Qb,Wn=new Ie.Qb,Zn=new Ie.Qb,qn=new Ie.Qb,Kn=new Ie.Qb,$n=new Ie.Qb,Jn=new Ie.Pb,ea=function(){function e(t,n,a,o){var i=this;Object(c.a)(this,e),this.setMatcap=function(e){i.mesh.material.uniforms.rockMap.value=Tt.a.get(De.B,"rock-matcap-".concat(e)),i.mesh.material.uniforms.rockMap.value.needsUpdate=!0},this.reset=function(){Xe.g.killTweensOf(i.mesh.material.uniforms.explode),i.mesh.material.uniforms.time.value=0,i.mesh.material.uniforms.explode.value=0,i.camera.fov=65,i.camera.updateProjectionMatrix()},this.explode=function(){i.reset(),jn.a.play(De.B,Ft.n),jn.a.play(De.B,Ft.o),i.mesh.rotation.copy(i.rock.mesh.rotation),i.mesh.scale.copy(i.rock.group.scale),i.material.uniforms.aoPower.value.x=0,i.material.uniforms.aoPower.value.y=0,i.material.opacity=.45,Xe.g.to(i.mesh.material.uniforms.explode,4,{value:1,onUpdate:function(){i.onExplodeUpdate()}})},this.onExplodeUpdate=function(){var e=i.mesh.material.uniforms.explode.value,t=65;e>0&&e<.1?(e=Object(en.g)(e,0,.1),t=en.f.lerp(65,55,e)):e>.1&&(e=Object(en.g)(e,.1,1),t=en.f.lerp(55,85,e)),i.camera.fov=t,i.camera.updateProjectionMatrix()},this.onRenderTargetRender=function(e){var t=new Uint8Array(e.width*e.height*4);Me.b.readRenderTargetPixels(e,0,0,e.width,e.height,t);for(var n=0;n<i.totalInstances;n++){var a=i.getVerticesFromTexture(n,e,t),o=i.getUvsFromTexture(n,e,t);i.mcol0.setXYZ(n,a[0][0],a[0][1],a[0][2]),i.mcol1.setXYZ(n,a[1][0],a[1][1],a[1][2]),i.mcol2.setXYZ(n,a[2][0],a[2][1],a[2][2]),i.mcol3.setXYZ(n,a[3][0],a[3][1],a[3][2]),i.uvcol0.setXY(n,o[0][0],o[0][1]),i.uvcol1.setXY(n,o[1][0],o[1][1]),i.uvcol2.setXY(n,o[2][0],o[2][1]),i.uvcol3.setXY(n,o[0][0],o[0][1]),i.aCenter.setXYZ(n,a[4][0],a[4][1],a[4][2])}i.mcol0.needsUpdate=!0,i.mcol1.needsUpdate=!0,i.mcol2.needsUpdate=!0,i.mcol3.needsUpdate=!0,i.uvcol0.needsUpdate=!0,i.uvcol1.needsUpdate=!0,i.uvcol2.needsUpdate=!0,i.uvcol3.needsUpdate=!0,i.aCenter.needsUpdate=!0,i.mesh.visible=!0,i.explode()},this.gui=t.addFolder("crystals"),this.group=new Ie.F,this.rockGeometry=n;this.pointScalar=new Ie.Pb(-.25,-1.25),this.icoMesh=new Ie.W(n.clone(),new Ie.X({wireframe:!0})),this.totalInstances=this.icoMesh.geometry.attributes.position.count/3;var r=Tt.a.get(De.B,"crystal-model").children[0].geometry,s=(new Ie.J).copy(r);s.maxInstancedCount=this.totalInstances,this.mcol0=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol1=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol2=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol3=new Ie.I(new Float32Array(3*this.totalInstances),3),this.uvcol0=new Ie.I(new Float32Array(2*this.totalInstances),2),this.uvcol1=new Ie.I(new Float32Array(2*this.totalInstances),2),this.uvcol2=new Ie.I(new Float32Array(2*this.totalInstances),2),this.uvcol3=new Ie.I(new Float32Array(2*this.totalInstances),2),this.aCenter=new Ie.I(new Float32Array(3*this.totalInstances),3),this.aAxis=new Ie.I(new Float32Array(4*this.totalInstances),4);for(var l=s.attributes.position.array.length/3,u=new Ie.h(new Float32Array(l),1),d=[0,.25,.75,1],h=0;h<l;h++)u.setX(h,d[h%4]);for(var f=0;f<this.totalInstances;f++){var m=this.getVertices(this.icoMesh.geometry.attributes.position.array,f);this.mcol0.setXYZ(f,m[0][0],m[0][1],m[0][2]),this.mcol1.setXYZ(f,m[1][0],m[1][1],m[1][2]),this.mcol2.setXYZ(f,m[2][0],m[2][1],m[2][2]),this.mcol3.setXYZ(f,m[3][0],m[3][1],m[3][2]),this.uvcol0.setXY(f,0,0),this.uvcol1.setXY(f,1,0),this.uvcol2.setXY(f,0,1),this.uvcol3.setXY(f,1,1),this.aCenter.setXYZ(f,m[4][0],m[4][1],m[4][2]),this.aAxis.setXYZW(f,Math.random(),Math.random(),Math.random(),Math.random()<.5?-1:1)}s.addAttribute("mcol0",this.mcol0),s.addAttribute("mcol1",this.mcol1),s.addAttribute("mcol2",this.mcol2),s.addAttribute("mcol3",this.mcol3),s.addAttribute("uvcol0",this.uvcol0),s.addAttribute("uvcol1",this.uvcol1),s.addAttribute("uvcol2",this.uvcol2),s.addAttribute("uvcol3",this.uvcol3),s.addAttribute("aIndex",u),s.addAttribute("aCenter",this.aCenter),s.addAttribute("aAxis",this.aAxis);var p=7,v=Tt.a.get(De.B,"rock-map")[0].data,g=Tt.a.get(De.B,"rock-map")[1].data,b=Tt.a.get(De.B,"rock-matcap-".concat(p)),x=Sn.extend(Ie.db,{uniforms:Object(St.b)({explode:{value:0}},un),vertexShader:Bn,fragmentShader:Qn});this.material=new x({normalMap:v,aoMap:g,side:Ie.v,roughness:0,metalness:0,aoMapIntensity:.6,normalMapType:Ie.ib,transparent:!0}),this.material.uniforms.mask.value=o.texture,this.material.uniforms.rockMap.value=b,this.material.uniforms.crystalMap.value=a.texture,this.gui.add(this.material,"aoMapIntensity",0,10),this.gui.add(this.material,"roughness",0,1),this.gui.add(this.material,"metalness",0,1),this.gui.add(this.material.uniforms.aoPower.value,"x",0,10),this.gui.add(this.material.uniforms.aoPower.value,"y",0,3e3),this.mesh=new Ie.W(s,this.material);this.mesh.scale.set(1.001,1.001,1.001),this.mesh.visible=!1,this.group.add(this.mesh),this.gui.add(this.mesh.material.uniforms.explode,"value",0,1).name("explode").onChange(this.onExplodeUpdate),this.gui.add(this,"explode"),this.gui.add(this,"reset")}return Object(le.a)(e,[{key:"resetAll",value:function(){Xe.g.killTweensOf(this.mesh.material.uniforms.explode),this.mesh.material.uniforms.time.value=0,this.mesh.material.uniforms.explode.value=0,this.camera.fov=65,this.camera.updateProjectionMatrix();for(var e=0;e<this.totalInstances;e++){var t=this.getVertices(this.icoMesh.geometry.attributes.position.array,e);this.mcol0.setXYZ(e,t[0][0],t[0][1],t[0][2]),this.mcol1.setXYZ(e,t[1][0],t[1][1],t[1][2]),this.mcol2.setXYZ(e,t[2][0],t[2][1],t[2][2]),this.mcol3.setXYZ(e,t[3][0],t[3][1],t[3][2]),this.uvcol0.setXY(e,0,0),this.uvcol1.setXY(e,1,0),this.uvcol2.setXY(e,0,1),this.uvcol3.setXY(e,1,1),this.aCenter.setXYZ(e,t[4][0],t[4][1],t[4][2]),this.aAxis.setXYZW(e,Math.random(),Math.random(),Math.random(),Math.random()<.5?-1:1)}this.mcol0.needsUpdate=!0,this.mcol1.needsUpdate=!0,this.mcol2.needsUpdate=!0,this.mcol3.needsUpdate=!0,this.uvcol0.needsUpdate=!0,this.uvcol1.needsUpdate=!0,this.uvcol2.needsUpdate=!0,this.uvcol3.needsUpdate=!0,this.aCenter.needsUpdate=!0,this.mesh.visible=!1}},{key:"calculateFaceCenter",value:function(e,t){return Vn.set(e[9*t+0],e[9*t+1],e[9*t+2]),Hn.set(e[9*t+3],e[9*t+4],e[9*t+5]),Gn.set(e[9*t+6],e[9*t+7],e[9*t+8]),[(Vn.x+Hn.x+Gn.x)/3,(Vn.y+Hn.y+Gn.y)/3,(Vn.z+Hn.z+Gn.z)/3]}},{key:"getVertices",value:function(e,t){var n=this.calculateFaceCenter(e,t);Vn.set(e[9*t+0],e[9*t+1],e[9*t+2]),Hn.set(e[9*t+3],e[9*t+4],e[9*t+5]),Gn.set(e[9*t+6],e[9*t+7],e[9*t+8]),Kn.subVectors(Gn,Hn),qn.subVectors(Vn,Hn),$n.crossVectors(Kn,qn).normalize();var a=en.f.lerp(this.pointScalar.x,this.pointScalar.y,Math.random());return Zn.set(a,a,a),Wn.fromArray(n).add(Zn.multiply($n)),n=[(Vn.x+Hn.x+Gn.x+Wn.x)/4,(Vn.y+Hn.y+Gn.y+Wn.y)/4,(Vn.z+Hn.z+Gn.z+Wn.z)/4],[Vn.toArray(),Hn.toArray(),Gn.toArray(),Wn.toArray(),n]}},{key:"getVerticesFromTexture",value:function(e,t,n){var a=this.getCanvasUvPos(this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+0),t),o=this.getCanvasUvPos(this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+1),t),i=this.getCanvasUvPos(this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+2),t);Vn.fromArray(this.getHeightPos(n,a,t)),Hn.fromArray(this.getHeightPos(n,o,t)),Gn.fromArray(this.getHeightPos(n,i,t));(Math.abs(Vn.length())>10||Math.abs(Hn.length())>10||Math.abs(Gn.length())>10)&&(Vn.set(this.icoMesh.geometry.attributes.position.array[9*e+0],this.icoMesh.geometry.attributes.position.array[9*e+1],this.icoMesh.geometry.attributes.position.array[9*e+2]),Hn.set(this.icoMesh.geometry.attributes.position.array[9*e+3],this.icoMesh.geometry.attributes.position.array[9*e+4],this.icoMesh.geometry.attributes.position.array[9*e+5]),Gn.set(this.icoMesh.geometry.attributes.position.array[9*e+6],this.icoMesh.geometry.attributes.position.array[9*e+7],this.icoMesh.geometry.attributes.position.array[9*e+8]));var r=[(Vn.x+Hn.x+Gn.x)/3,(Vn.y+Hn.y+Gn.y)/3,(Vn.z+Hn.z+Gn.z)/3];Kn.subVectors(Gn,Hn),qn.subVectors(Vn,Hn),$n.crossVectors(Kn,qn).normalize();var s=en.f.lerp(this.pointScalar.x,this.pointScalar.y,Math.random());return Zn.set(s,s,s),Wn.fromArray(r).add(Zn.multiply($n)),r=[(Vn.x+Hn.x+Gn.x+Wn.x)/4,(Vn.y+Hn.y+Gn.y+Wn.y)/4,(Vn.z+Hn.z+Gn.z+Wn.z)/4],[Vn.toArray(),Hn.toArray(),Gn.toArray(),Wn.toArray(),r]}},{key:"getUvsFromTexture",value:function(e,t,n){var a=this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+0,!1);return[a,this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+1,!1),this.getUv(this.icoMesh.geometry.attributes.uv.array,3*e+2,!1),a]}},{key:"getCanvasUvPos",value:function(e,t){return[Math.floor(e[0]*t.width),Math.floor(e[1]*t.width)]}},{key:"getHeightPos",value:function(e,t,n){var a=this.getColorIndicesForCoord(t[0],t[1],n.width);return[en.f.mapLinear(e[a[0]],0,255,-20,20),en.f.mapLinear(e[a[1]],0,255,-20,20),en.f.mapLinear(e[a[2]],0,255,-20,20)]}},{key:"getColorIndicesForCoord",value:function(e,t,n){var a=t*(4*n)+4*e;return[a,a+1,a+2]}},{key:"getUv",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return Jn.set(e[2*t],e[2*t+1]),n&&(Jn.x-=.5,Jn.y-=.5,Jn.x*=.8,Jn.y*=.8,Jn.x+=.5,Jn.y+=.5),Jn.toArray()}},{key:"update",value:function(e,t){this.mesh.material.uniforms.time.value+=e,this.mesh.rotation.copy(t.mesh.rotation),this.mesh.scale.copy(t.group.scale)}}]),e}(),ta=function(){function e(t){var n=this;Object(c.a)(this,e),this.setMatcap=function(e){n.mesh.material.uniforms.colorMap.value=Tt.a.get(De.B,"rock-matcap-".concat(e)),n.mesh.material.uniforms.colorMap.value.needsUpdate=!0},this.update=function(){n.needsUpdate&&(n.render(),n.needsUpdate=!1)},this.gui=t.addFolder("crystal"),this.scene=new Ie.yb,this.camera=qe(),this.camera.aspect=1,this.camera.updateProjectionMatrix(),this.controls=new Ge(this.camera,Me.b.domElement),this.controls.enableZoom=!1,this.controls.enabled=!1;var a=Object(rt.a)(512,512),o=a.canvas,i=a.ctx,r=Object(rt.a)(512,512),s=r.canvas,l=r.ctx;this.canvas=o,this.ctx=i,this.canvasFlipped=s,this.ctxFlipped=l,this.renderTarget=Object(Me.a)(512,512,{format:Ie.ub}),this.imageData=this.ctxFlipped.createImageData(this.canvas.width,this.canvas.height),this.pixelBuffer=new Uint8Array(this.renderTarget.width*this.renderTarget.height*4),this.camera.position.z=1.25,this.camera.rotation.fromArray(1.9458662971132943,1.2647394769733968,-1.9623694301469414,"XYZ"),this.camera.lookAt(en.e),window.camera=this.camera;this.mesh=new Ie.W(new Ie.G(1,2),new Ie.Bb({uniforms:{colorMap:{value:Tt.a.get(De.B,"crystal-matcap")}},blending:Ie.a,side:Ie.v,depthTest:!1,depthWrite:!1,vertexShader:"\n          varying vec3 vNormal;\n          varying vec3 vViewPosition;\n          void main() {\n            vNormal = normal;\n            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\n            vViewPosition = - mvPosition.xyz;\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ",fragmentShader:"\n          #extension GL_OES_standard_derivatives : enable\n          uniform sampler2D colorMap;\n          varying vec3 vViewPosition;\n          varying vec3 vNormal;\n          ".concat(mn,"\n          void main() {\n            vec3 normal2 = normalize(cross(dFdx(vViewPosition), dFdy(vViewPosition)));\n            vec4 color = matcap(vViewPosition, normal2, colorMap);\n            vec3 a = vec3((normalize(vNormal) * 0.5 + 0.5).xy, 1.0);\n            color.rgb *= a;\n            color *= 1.5;\n            gl_FragColor = vec4(color.rgb, 0.5);\n          }\n      ")})),this.scene.add(this.mesh),this.gui.add({map:50},"map",0,-1).step(1).onChange((function(e){n.setMatcap(e)})),this.texture=new Ie.Ib(this.canvas),this.needsUpdate=!0,this.render()}return Object(le.a)(e,[{key:"render",value:function(){Me.b.setRenderTarget(this.renderTarget),Me.b.setClearColor(0),Me.b.render(this.scene,this.camera),Me.b.readRenderTargetPixels(this.renderTarget,0,0,this.renderTarget.width,this.renderTarget.height,this.pixelBuffer),this.imageData.data.set(this.pixelBuffer),this.ctxFlipped.putImageData(this.imageData,0,0),this.ctx.save(),this.ctx.scale(1,-1),this.ctx.drawImage(this.canvasFlipped,0,-this.canvas.height,this.canvas.width,this.canvas.height),this.ctx.restore(),this.texture.needsUpdate=!0,Me.b.setRenderTarget(null)}}]),e}(),na=n(27),aa=("\n    ".concat(Yn,"\n  "),"\n    ".concat(mn,"\n    ").concat(hn,"\n  "),new Ie.Eb(.1,6,6),new Ie.X,new Ie.hb,new Ie.V),oa=(aa.elements,new Ie.Eb(2,6,6),new Ie.Qb,new Ie.Qb,new Ie.Qb,new Ie.Qb,new Ie.Qb,new Ie.Qb,{uniforms:"\n    attribute float size;\n    attribute float alpha;\n    attribute float life;\n    attribute float phase;\n    attribute vec3 pColor;\n    uniform float particleSize;\n    varying float vAlpha;\n    varying float vLife;\n    varying vec3 vColor;\n    varying float vDistanceFromCenter;\n  ",postTransform:"\n  \tgl_PointSize = size * (particleSize / length(mvPosition.xyz));\n\t  gl_Position = projectionMatrix * mvPosition;\n    vAlpha = alpha;\n    vLife = life;\n    vColor = pColor;\n    vDistanceFromCenter = abs(distance(vec3(0.0), position));\n  "}),ia={uniforms:"\n    varying float vAlpha;\n    varying float vLife;\n    varying vec3 vColor;\n    varying float vDistanceFromCenter;\n    uniform float time;\n    uniform sampler2D particleMap;\n  ",functions:"\n   ".concat(In,"\n    const float brightness = 3.0;\n  "),postFragColor:"\n    float lifeAlpha = 1.0;\n    float cullingAlpha = 0.0;\n\n    // Circle gradient\n    cullingAlpha = smoothstep(5.0, 8.0, vDistanceFromCenter);\n\n    if (vLife < 0.25) {\n      lifeAlpha = clamp(mapLinear(vLife, 0.0, 0.25, 0.0, 1.0), 0.0, 1.0);\n    }\n\n    if (vLife > 0.75) {\n      lifeAlpha = clamp(mapLinear(vLife, 0.75, 1.0, 1.0, 0.0), 0.0, 1.0);\n    }\n\n    vec4 texel = texture2D(particleMap, gl_PointCoord.xy);\n\n    float outgoingAlpha = texel.r * vAlpha * lifeAlpha * brightness;\n\n    gl_FragColor = vec4(texel.rgb * vColor, outgoingAlpha * cullingAlpha);\n    // gl_FragColor = vec4(vec3(cullingAlpha, 0.0, 0.0),  1.0);\n  "},ra=function(){function e(t){var n,a=this;Object(c.a)(this,e),this.onConfigChange=function(){for(var e=0,t=Object.values(a.config.colors),n=0;n<a.totalParticles;n++){e=3*n;var o=a.getRandomColor(t);a.resetParticle(n,e,o)}a.updateBuffers()},this.group=new Ie.F,this.gui=t.addFolder("particles");var o,i=(n={},Object(p.a)(n,De.q,500),Object(p.a)(n,De.r,200),n);this.totalParticles=i[Object(De.K)()],this.curves=[],this.config={colors:{0:"#c6a9d3",1:"#ced9ef"},bounds:25,particle:{min:.25,max:7.5}},this.colors=Object.values(this.config.colors),this.color=new Ie.o,this.pixelRatio=Me.b.getPixelRatio(),this.simulation={direction:new Float32Array(3*this.totalParticles),phase:new Float32Array(3*this.totalParticles),lifespan:new Float32Array(this.totalParticles)},this.attributes={position:new Ie.h(new Float32Array(3*this.totalParticles),3),size:new Ie.h(new Float32Array(this.totalParticles),1),alpha:new Ie.h(new Float32Array(this.totalParticles),1),life:new Ie.h(new Float32Array(this.totalParticles),1),color:new Ie.h(new Float32Array(3*this.totalParticles),3)};for(var r=0,s=0;s<this.totalParticles;s++)r=3*s,o=this.getRandomColor(this.colors),this.resetParticle(s,r,o);var l=new Ie.i;l.addAttribute("position",this.attributes.position),l.addAttribute("size",this.attributes.size),l.addAttribute("alpha",this.attributes.alpha),l.addAttribute("life",this.attributes.life),l.addAttribute("pColor",this.attributes.color);var u=Sn.extend(Ie.X,{uniforms:{time:{value:0},particleSize:{type:"f",value:100},particleMap:{type:"t",value:Tt.a.get(De.B,"particle-color")},cameraPosition:{type:"v3",value:new Ie.Qb},cameraDirection:{type:"v3",value:new Ie.Qb}},vertexShader:oa,fragmentShader:ia});this.material=new u({transparent:!0,depthTest:!0,depthWrite:!1,alphaTest:.1,blending:Ie.a,fog:!1}),this.mesh=new Ie.ob(l,this.material),this.mesh.frustumCulled=!1,this.group.add(this.mesh),this.gui.add(this.group.position,"y",0,20),this.gui.add(this.config.particle,"min",0,200).name("min size").onChange(this.onConfigChange),this.gui.add(this.config.particle,"max",0,200).name("max size").onChange(this.onConfigChange),this.gui.add(this.config,"bounds",0,500).name("bounds size").onChange(this.onConfigChange),this.gui.add(this.material.uniforms.particleSize,"value",0,200).name("particle scale"),Object.keys(this.config.colors).forEach((function(e){a.gui.addColor(a.config.colors,e).onChange(a.onConfigChange)}))}return Object(le.a)(e,[{key:"getRandomColor",value:function(e){var t=e[Math.floor(Math.random()*e.length)].replace("#","0x");return[this.color.setHex(t).r,this.color.setHex(t).g,this.color.setHex(t).b]}},{key:"resetParticle",value:function(e,t,n){var a=en.f.randFloat(-this.config.bounds,this.config.bounds),o=en.f.randFloat(-this.config.bounds,this.config.bounds),i=en.f.randFloat(-this.config.bounds,this.config.bounds);this.attributes.position.setXYZ(e,a,o,i),this.attributes.color.setXYZ(e,n[0],n[1],n[2]),this.attributes.size.setX(e,en.f.randFloat(this.config.particle.min,this.config.particle.max)*this.pixelRatio),this.attributes.alpha.setX(e,Math.random()),this.attributes.life.setX(e,0),this.simulation.direction[t]=en.f.lerp(-1,1,Math.random()),this.simulation.direction[t+1]=en.f.lerp(-1,1,Math.random()),this.simulation.direction[t+2]=en.f.lerp(-1,1,Math.random()),this.simulation.phase[t]=en.f.lerp(0,2*Math.PI,Math.random()),this.simulation.phase[t+1]=en.f.lerp(0,2*Math.PI,Math.random()),this.simulation.phase[t+2]=en.f.lerp(0,2*Math.PI,Math.random()),this.simulation.lifespan[e]=en.f.lerp(0,.005,Math.random()),this.attributes.color.needsUpdate=!0,this.updateBuffers()}},{key:"update",value:function(e,t){for(var n,a,o,i,r,s,c,l,u=this.mesh.geometry.attributes,d=0;d<this.totalParticles;d+=1)if(l=3*d,n=u.position.getX(d),a=u.position.getY(d),o=u.position.getZ(d),r=this.simulation.phase[l],s=this.simulation.phase[l+1],c=this.simulation.phase[l+2],n+=e*(this.simulation.direction[l]*Math.cos(r+e))*1.1,a+=e*(this.simulation.direction[l+1]*Math.cos(s+e))*1.1,o+=e*(this.simulation.direction[l+2]*Math.sin(c+e))*1.1,u.position.setXYZ(d,n,a,o),i=u.life.getX(d),i+=.05*e,i+=this.simulation.lifespan[d],u.life.setX(d,i),i>=1){var h=Object.values(this.config.colors),f=this.getRandomColor(h);this.resetParticle(d,l,f)}this.material.uniforms.time.value+=e,this.material.uniforms.cameraPosition.value.copy(t.position),this.updateBuffers()}},{key:"updateBuffers",value:function(){this.attributes.position.needsUpdate=!0,this.attributes.size.needsUpdate=!0,this.attributes.life.needsUpdate=!0,this.attributes.alpha.needsUpdate=!0}}]),e}(),sa=Ie.Nb.merge([{time:{value:0},envMap:{value:null},materialId:{value:0},envColor:{value:new Ie.o(16777215)},envMapEnabled:{value:1},shadowEnabled:{value:1},visible:{value:1},reflectivityEnabled:{value:1},opacity:{value:1}},Ie.Mb.ambient,Ie.Mb.lights]),ca=function(e){var t="\n    ".concat(Ie.zb.shadowmap_pars_vertex,"\n    attribute vec3 mcol0;\n    attribute vec3 mcol1;\n    attribute vec3 mcol2;\n    attribute vec3 mcol3;\n    attribute vec3 aGradientX;\n    attribute vec3 aGradientY;\n    attribute vec3 aGradientZ;\n    attribute float aMaterialId;\n    attribute float aVisible;\n    varying vec3 gradientX;\n    varying vec3 gradientY;\n    varying vec3 gradientZ;\n    varying float materialId;\n    varying float visible;\n\n    ").concat(Ie.zb.fog_pars_vertex,"\n\n  ");return"\n    ".concat(e?t:"","\n\n    uniform float time;\n    varying vec3 vNormal;\n    varying vec3 vReflect;\n    varying vec3 vWorldPosition;\n\n    vec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\n      // matrix is assumed to be orthogonal,\n      return normalize((vec4(normal, 0.0) * matrix).xyz);\n    }\n  ")},la=function(e){return"\n    ".concat(Ie.zb.common,"\n    ").concat(Ie.zb.packing,"\n    ").concat(Ie.zb.bsdfs,"\n    ").concat(Ie.zb.lights_pars_begin,"\n    ").concat(Ie.zb.shadowmap_pars_fragment,"\n    ").concat(Ie.zb.shadowmask_pars_fragment,"\n\n    ").concat(e?"\n    varying vec3 gradientX;\n    varying vec3 gradientY;\n    varying vec3 gradientZ;\n    varying float materialId;\n    varying float visible;\n  ":"\n    uniform vec3 gradientX;\n    uniform vec3 gradientY;\n    uniform vec3 gradientZ;\n    uniform float materialId;\n    uniform float visible;\n  ","\n\n    uniform float time;\n    uniform samplerCube envMap;\n    uniform vec3 envColor;\n    uniform float envMapEnabled;\n    uniform float reflectivityEnabled;\n    uniform float opacity;\n    uniform float shadowEnabled;\n\n    varying vec3 vNormal;\n    varying vec3 vReflect;\n    varying vec3 vWorldPosition;\n\n    ").concat(mn,"\n    ").concat(In,"\n\n    ").concat(Ie.zb.fog_pars_fragment,"\n\n    float calculateReflectivity(vec3 normal) {\n      // Reflection transparency\n      // We don't want spheres far away from 0,0,0 to show reflections on the opposite side\n      // So we use lambert gradient to fade out the envcolor past a distance from 0\n      float dist = abs(distance(vec3(0), vWorldPosition));\n      dist = clamp(mapLinear(dist, 0.0, 17.5, 0.0, 1.0), 0.0, 1.0);\n      vec3 eye = normalize(vec3(0) - vWorldPosition);\n      float reflectiveDropoff = max(0.0, dot(eye, normal) * 0.5 + 0.5);\n      return mix(1.0, reflectiveDropoff, dist);\n    }\n  ")},ua=function(e){return"\n     ".concat(e?"\n    mat4 matrix = mat4(\n      vec4(mcol0, 0),\n      vec4(mcol1, 0),\n      vec4(mcol2, 0),\n      vec4(mcol3, 1)\n    );\n    gradientX = aGradientX;\n    gradientY = aGradientY;\n    gradientZ = aGradientZ;\n    materialId = aMaterialId;\n    visible = aVisible;\n  ":"","\n    vec4 worldPosition = modelMatrix * ").concat(e?"matrix * ":""," vec4(transformed, 1.0);\n    ").concat(Ie.zb.shadowmap_vertex,"\n    vNormal = normalize(mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal);\n    vec3 transformedNormal = normalMatrix * normal;\n    vec3 cameraToVertex = normalize(worldPosition.xyz - cameraPosition);\n    vec3 worldNormal = inverseTransformDirection(transformedNormal, viewMatrix);\n    vReflect = reflect(cameraToVertex, worldNormal);\n    vWorldPosition = worldPosition.xyz;\n\n    // vec4 mvPosition = modelViewMatrix * ").concat(e?"matrix * ":""," vec4(position, 1.0);\n    vec4 mvPosition = modelMatrix * ").concat(e?"matrix * ":""," vec4(transformed, 1.0);\n    ").concat(Ie.zb.fog_vertex,"\n  ")},da="\n  if (shadowEnabled == 1.0) {\n    float shadowMask = getShadowMask();\n    vec3 shadowColor = vec3(0.0);\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, shadowColor, (1.0 - shadowMask) * maxShadow);\n  }\n\n  gl_FragColor.a *= visible;\n\n  #ifdef USE_FOG\n    #ifdef FOG_EXP2\n      float fogFactor2 = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n    #else\n      float fogFactor2 = smoothstep( fogNear, fogFar, fogDepth );\n    #endif\n    gl_FragColor.rgb = mix(gl_FragColor.rgb, fogColor, fogFactor2);\n  #endif\n",ha={gradientX:15991004,gradientY:15466398,gradientZ:11270911},fa={iridescentSpeed:{value:.97},iridescentFresnelPow:{value:.66},gradientX:{value:new Ie.o(ha.gradientX)},gradientY:{value:new Ie.o(ha.gradientY)},gradientZ:{value:new Ie.o(ha.gradientZ)},iridescentVal:{value:new Ie.Rb(.6,22,2,1.97)},iridescentVal2:{value:new Ie.Pb(6.5,2.7)}},ma="\n  uniform float iridescentSpeed;\n  ".concat(Yn,"\n"),pa=function(e){return e?"\n    if (aMaterialId == 1.0) {\n      vPosition = rotate(position, normalize(worldPosition).xyz, time * iridescentSpeed);\n    }\n  ":"\n    vPosition = rotate(position, normalize(worldPosition).xyz, time * iridescentSpeed);\n  "},va="\n  ".concat(ca(!1),"\n  ").concat(ma,"\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!1),"\n    ").concat(pa(!1),"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n"),ga="\n  uniform float iridescentSpeed;\n  uniform vec4 iridescentVal;\n  uniform vec2 iridescentVal2;\n  uniform float iridescentFresnelPow;\n  ".concat("\n  // Created by Andrew Wild - akohdr/2016\n  // https://www.shadertoy.com/view/MlcGWr\n  // License Creative Commons Attribution-NonCommercial-ShareAlike 3.0 Unported License.\n  #define rot(p,a) vec2 sc=sin(vec2(a,a+1.6)); p*=mat2(sc.y,-sc.x,sc);\n  #define A vec3(0,1,157)\n  #define B {vec2 m=fract(p),l=dot(p-m,A.yz)+A.xz,r=mix(fract(57.*sin(l++)),fract(57.*sin(l)),(m*=m*(3.-m-m)).x);color+=mix(r.x,r.y,m.y)/(s+=s);p*=mat2(1,1,1,-1);}\n","\n"),ba="\n  vec3 normal = normalize( vNormal );\n  normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n  vec3 envMapColor = envColor;\n\n  if (envMapEnabled == 1.0) {\n    envMapColor = textureCube(envMap, vec3(vReflect.x, vReflect.yz)).rgb;\n    if (reflectivityEnabled == 1.0) {\n      float reflectivity = calculateReflectivity(normal);\n      envMapColor *= reflectivity;\n    }\n  }\n\n  envMapColor = mix(envMapColor, vec3(1), 0.65);\n\n  vec3 eye = cameraPosition - vWorldPosition.xyz;\n\n  float cosTheta = abs(dot(normalize(eye), normal));\n  float fresnel = pow(cosTheta, iridescentFresnelPow);\n\n  float newTime = time * iridescentSpeed;\n  vec2 p = (normalize(vPosition) * 0.5 + 0.5).xy;\n  rot(p, newTime / iridescentVal2.x);\t// slow field rotation\n\n  float s = 1.0;\n  vec4 color = vec4(0);\n  B B B B // unrolled perlin noise see https://www.shadertoy.com/view/lt3GWn\n  color += sin(iridescentVal.x * sin(color * iridescentVal.y + newTime * iridescentVal.z) + p.yxyy-p.yyxy * iridescentVal.w) / iridescentVal2.y; // colour transform\n  // vec4 outgoingColor = vec4(0.0, 0.0, 0.0, 1.0);\n  // outgoingColor.rgb = mix(uGradientX, uGradientY, pow(color.g, 2.0));\n  vec3 gradientColor = gradientX;\n  gradientColor = mix(gradientColor, gradientY, color.g);\n  gradientColor = mix(gradientColor, gradientZ, color.b);\n\n  vec3 outgoingColor = mix(envMapColor, gradientColor, fresnel);\n  gl_FragColor = vec4(outgoingColor, opacity);\n\n\n\n  // gl_FragColor = vec4(envMapColor, 1.0);\n\n  // gl_FragColor = vec4(vec3(reflectivity), 1.0);\n",xa="\n  ".concat(la(!1),"\n  ").concat(ga,"\n  varying vec3 vPosition;\n  void main() {\n    float maxShadow = 0.0;\n    ").concat(ba,"\n    ").concat(da,"\n  }\n");function ya(e,t){var n=e.addFolder("iridescent material"),a=new Ie.Bb({uniforms:Object(St.b)(fa,sa),vertexShader:va,fragmentShader:xa,lights:!0,transparent:!0});return n.add(a.uniforms.iridescentSpeed,"value",0,2).name("iridescentSpeed"),n.add(a.uniforms.iridescentFresnelPow,"value",0,10).name("iridescentFresnelPow"),n.addColor(ha,"gradientX").onChange((function(e){a.uniforms.gradientX.value.setHex(e)})),n.addColor(ha,"gradientY").onChange((function(e){a.uniforms.gradientY.value.setHex(e)})),n.addColor(ha,"gradientZ").onChange((function(e){a.uniforms.gradientZ.value.setHex(e)})),n.add(a.uniforms.iridescentVal.value,"x",0,30),n.add(a.uniforms.iridescentVal.value,"y",0,30),n.add(a.uniforms.iridescentVal.value,"z",0,30),n.add(a.uniforms.iridescentVal.value,"w",0,30),n.add(a.uniforms.iridescentVal2.value,"x",0,1),n.add(a.uniforms.iridescentVal2.value,"y",0,30),a}var wa=function(){function e(t){var n,a,o=this;Object(c.a)(this,e),this.onStateChanged=function(e){switch(e.sceneStep){case De.z:Xe.g.killTweensOf(o.meshGlow.material.uniforms.transition),Xe.g.delayedCall(2.25,(function(){jn.a.play(De.B,Ft.l)})),Xe.g.to(o.meshGlow.material.uniforms.transition,5,{value:1,onUpdate:function(){o.coreTransition(o.meshGlow.material.uniforms.transition.value)}});break;default:Xe.g.killTweensOf(o.meshGlow.material.uniforms.transition),o.meshGlow.material.uniforms.transition.value=0,o.coreTransition(o.meshGlow.material.uniforms.transition.value)}},this.coreTransition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=en.f.lerp(.8,1,e);o.meshGradient.scale.set(t,t,t),o.meshGradient.material.uniforms.opacity.value=Object(en.g)(e,.65,1,0,1)},this.group=new Ie.F,this.gui=t.addFolder("core");var i=new Ie.Bb({uniforms:{time:{value:0},transition:{value:0},fresnelPow:{value:4},smoothStep:{value:new Ie.Pb(.2,1)}},vertexShader:"\n  varying vec3 vEye;\n  varying vec3 vNormal;\n  void main() {\n    vec4 worldPos = modelMatrix * vec4(position, 1.0);\n    vNormal = normalize(mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal);\n    vEye = cameraPosition - worldPos.xyz;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader:"\n  varying vec3 vEye;\n  varying vec3 vNormal;\n  uniform float time;\n  uniform float fresnelPow;\n  uniform float transition;\n  uniform vec2 smoothStep;\n  void main() {\n    float cosTheta = abs(dot(normalize(vEye), vNormal));\n    float fresnel = pow(cosTheta, fresnelPow);\n    // float xx = mix(0.5, 1.0, sin(time * 2.0) * 0.5 + 0.5);\n    float alpha = smoothstep(smoothStep.x, smoothStep.y, fresnel);\n    gl_FragColor.rgb = vec3(1.0);\n    gl_FragColor.a = alpha * transition;\n  }\n",transparent:!0,side:Ie.e}),r=(n={},Object(p.a)(n,De.q,[32,16]),Object(p.a)(n,De.r,[24,12]),n),s=r[Object(De.K)()];this.meshGlow=new Ie.W(new Ie.Eb(10,s[0],s[1]),i),this.group.add(this.meshGlow),this.gui.add(i.uniforms.fresnelPow,"value",0,10).name("fresnelPow"),this.gui.add(i.uniforms.smoothStep.value,"x",0,1),this.gui.add(i.uniforms.smoothStep.value,"y",0,1),this.gui.add(i.uniforms.transition,"value",0,1).name("transition").onChange(this.scaleCore);var l=new Ie.o;this.iridescentMaterial=ya(this.gui),this.iridescentMaterial.uniforms.envMapEnabled.value=0,this.iridescentMaterial.uniforms.iridescentFresnelPow.value=2.13,l.setHex(De.b),this.iridescentMaterial.uniforms.gradientX.value.r=l.r,this.iridescentMaterial.uniforms.gradientX.value.g=l.g,this.iridescentMaterial.uniforms.gradientX.value.b=l.b,l.setHex(De.d),this.iridescentMaterial.uniforms.gradientY.value.r=l.r,this.iridescentMaterial.uniforms.gradientY.value.g=l.g,this.iridescentMaterial.uniforms.gradientY.value.b=l.b,l.setHex(De.d),this.iridescentMaterial.uniforms.gradientZ.value.r=l.r,this.iridescentMaterial.uniforms.gradientZ.value.g=l.g,this.iridescentMaterial.uniforms.gradientZ.value.b=l.b,a={},Object(p.a)(a,De.q,[32,16]),Object(p.a)(a,De.r,[8,8]),s=(r=a)[Object(De.K)()],this.meshGradient=new Ie.W(new Ie.Eb(2.5,s[0],s[1]),this.iridescentMaterial),this.group.add(this.meshGradient),this.coreTransition(this.meshGlow.material.uniforms.transition.value)}return Object(le.a)(e,[{key:"update",value:function(e){this.meshGlow.material.uniforms.time.value+=e,this.meshGradient.material.uniforms.time.value+=e}}]),e}(),Aa=function(){function e(){Object(c.a)(this,e),this.ambient=new ze({ambient:13948116,intensity:.6}),this.directional=new Ye({intensity:.7}),this.directional.light.position.set(-.1,.2,.1),this.lights=[this.ambient,this.directional]}return Object(le.a)(e,[{key:"gui",value:function(e){this.guiParent=e,this.guiLights=e.addFolder("lights"),this.ambient.gui(this.guiLights),this.directional.gui(this.guiLights)}},{key:"get",value:function(){return[this.ambient.light,this.directional.light]}},{key:"dispose",value:function(e){this.guiParent.removeFolder(this.guiLights.name),this.lights.forEach((function(e){e.dispose()}))}}]),e}(),Pa=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this,{id:e,lights:new Aa,gui:!1,guiOpen:!1}))).backgroundColor=16777215,n}return Object(he.a)(t,e),t}(Wt),Ta=function(){function e(t,n,a){Object(c.a)(this,e),this.gui=t.addFolder("transition pass"),this.gui.open(),this.scene=new Ie.yb,this.camera=a;var o=Object(Me.d)(),i=o.width,r=o.height,s=new Ie.Bb({uniforms:Object(St.b)({time:{value:0},texture0:{value:null},texture1:{value:null},transition:{value:0},resolution:{value:new Ie.Pb(i,r)}}),vertexShader:"\n  void main() {\n    gl_Position = vec4(position, 1.0);\n  }\n",fragmentShader:"\n  uniform sampler2D texture0;\n  uniform sampler2D texture1;\n  uniform float transition;\n  uniform vec2 resolution;\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec4 texel0 = texture2D(texture0, uv);\n    vec4 texel1 = texture2D(texture1, uv);\n    gl_FragColor = mix(texel0, texel1, transition);\n  }\n"});this.mesh=new Ie.W(n,s),this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix(),this.scene.add(this.mesh),this.enabled=!1,this.gui.add(this.mesh.material.uniforms.transition,"value",0,1).name("transition").listen()}return Object(le.a)(e,[{key:"transition",value:function(){var e=this;return new Promise((function(t,n){e.mesh.material.uniforms.transition.value=0,e.enabled=!0,Xe.g.killTweensOf(e.mesh.material.uniforms.transition),Xe.g.to(e.mesh.material.uniforms.transition,3,{value:1,onComplete:function(){e.enabled=!1,t()}})}))}},{key:"resize",value:function(e,t){this.mesh.material.uniforms.resolution.value.x=e,this.mesh.material.uniforms.resolution.value.y=t}},{key:"update",value:function(e){}},{key:"render",value:function(e,t,n,a,o){e.update(o),t.update(o),Me.b.setClearColor(e.backgroundColor),Me.b.setRenderTarget(n),Me.b.render(e.scene,e.camera),Me.b.setClearColor(t.backgroundColor),Me.b.setRenderTarget(a),Me.b.render(t.scene,t.camera),this.mesh.material.uniforms.texture0.value=n.texture,this.mesh.material.uniforms.texture1.value=a.texture,this.mesh.material.uniforms.time.value+=o,Me.b.setRenderTarget(null)}}]),e}(),Sa={noiseSpeed:{value:.18},noiseAmount:{value:.045}},Fa={fxaaEnabled:{value:1},fxaaResolution:{value:new Ie.Pb(1/1024,1/512)}};var Ea="\n  uniform vec2 resolution;\n  uniform float time;\n  uniform float tint;\n  uniform vec3 tintColor;\n  uniform sampler2D texture;\n  ".concat("\n  precision highp float;\n  uniform bool fxaaEnabled;\n  uniform vec2 fxaaResolution;\n  varying vec2 vUv;\n","\n  ").concat("\n  // FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\n\n  //----------------------------------------------------------------------------------\n  // File:        es3-kepler/FXAA/assets/shaders/FXAA_DefaultES.frag\n  // SDK Version: v3.00\n  // Email:       gameworks@nvidia.com\n  // Site:        http://developer.nvidia.com/\n  //\n  // Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n  //\n  // Redistribution and use in source and binary forms, with or without\n  // modification, are permitted provided that the following conditions\n  // are met:\n  //  * Redistributions of source code must retain the above copyright\n  //    notice, this list of conditions and the following disclaimer.\n  //  * Redistributions in binary form must reproduce the above copyright\n  //    notice, this list of conditions and the following disclaimer in the\n  //    documentation and/or other materials provided with the distribution.\n  //  * Neither the name of NVIDIA CORPORATION nor the names of its\n  //    contributors may be used to endorse or promote products derived\n  //    from this software without specific prior written permission.\n  //\n  // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS 'AS IS' AND ANY\n  // EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n  // IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n  // PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n  // CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n  // EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n  // PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n  // PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n  // OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n  // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n  // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n  //\n  //----------------------------------------------------------------------------------\n\n  #define FXAA_PC 1\n  #define FXAA_GLSL_100 1\n  #define FXAA_QUALITY_PRESET 12\n\n  #define FXAA_GREEN_AS_LUMA 1\n\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_PC_CONSOLE\n      //\n      // The console algorithm for PC is included\n      // for developers targeting really low spec machines.\n      // Likely better to just run FXAA_PC, and use a really low preset.\n      //\n      #define FXAA_PC_CONSOLE 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GLSL_120\n      #define FXAA_GLSL_120 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GLSL_130\n      #define FXAA_GLSL_130 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_3\n      #define FXAA_HLSL_3 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_4\n      #define FXAA_HLSL_4 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_5\n      #define FXAA_HLSL_5 0\n  #endif\n  /*==========================================================================*/\n  #ifndef FXAA_GREEN_AS_LUMA\n      //\n      // For those using non-linear color,\n      // and either not able to get luma in alpha, or not wanting to,\n      // this enables FXAA to run using green as a proxy for luma.\n      // So with this enabled, no need to pack luma in alpha.\n      //\n      // This will turn off AA on anything which lacks some amount of green.\n      // Pure red and blue or combination of only R and B, will get no AA.\n      //\n      // Might want to lower the settings for both,\n      //    fxaaConsoleEdgeThresholdMin\n      //    fxaaQualityEdgeThresholdMin\n      // In order to insure AA does not get turned off on colors\n      // which contain a minor amount of green.\n      //\n      // 1 = On.\n      // 0 = Off.\n      //\n      #define FXAA_GREEN_AS_LUMA 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_EARLY_EXIT\n      //\n      // Controls algorithm's early exit path.\n      // On PS3 turning this ON adds 2 cycles to the shader.\n      // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n      // Turning this off on console will result in a more blurry image.\n      // So this defaults to on.\n      //\n      // 1 = On.\n      // 0 = Off.\n      //\n      #define FXAA_EARLY_EXIT 1\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_DISCARD\n      //\n      // Only valid for PC OpenGL currently.\n      // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n      //\n      // 1 = Use discard on pixels which don't need AA.\n      //     For APIs which enable concurrent TEX+ROP from same surface.\n      // 0 = Return unchanged color on pixels which don't need AA.\n      //\n      #define FXAA_DISCARD 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_FAST_PIXEL_OFFSET\n      //\n      // Used for GLSL 120 only.\n      //\n      // 1 = GL API supports fast pixel offsets\n      // 0 = do not use fast pixel offsets\n      //\n      #ifdef GL_EXT_gpu_shader4\n          #define FXAA_FAST_PIXEL_OFFSET 1\n      #endif\n      #ifdef GL_NV_gpu_shader5\n          #define FXAA_FAST_PIXEL_OFFSET 1\n      #endif\n      #ifdef GL_ARB_gpu_shader5\n          #define FXAA_FAST_PIXEL_OFFSET 1\n      #endif\n      #ifndef FXAA_FAST_PIXEL_OFFSET\n          #define FXAA_FAST_PIXEL_OFFSET 0\n      #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GATHER4_ALPHA\n      //\n      // 1 = API supports gather4 on alpha channel.\n      // 0 = API does not support gather4 on alpha channel.\n      //\n      #if (FXAA_HLSL_5 == 1)\n          #define FXAA_GATHER4_ALPHA 1\n      #endif\n      #ifdef GL_ARB_gpu_shader5\n          #define FXAA_GATHER4_ALPHA 1\n      #endif\n      #ifdef GL_NV_gpu_shader5\n          #define FXAA_GATHER4_ALPHA 1\n      #endif\n      #ifndef FXAA_GATHER4_ALPHA\n          #define FXAA_GATHER4_ALPHA 0\n      #endif\n  #endif\n\n\n  /*============================================================================\n                          FXAA QUALITY - TUNING KNOBS\n  ------------------------------------------------------------------------------\n  NOTE the other tuning knobs are now in the shader function inputs!\n  ============================================================================*/\n  #ifndef FXAA_QUALITY_PRESET\n      //\n      // Choose the quality preset.\n      // This needs to be compiled into the shader as it effects code.\n      // Best option to include multiple presets is to\n      // in each shader define the preset, then include this file.\n      //\n      // OPTIONS\n      // -----------------------------------------------------------------------\n      // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n      // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n      // 39       - no dither, very expensive\n      //\n      // NOTES\n      // -----------------------------------------------------------------------\n      // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n      // 13 = about same speed as FXAA 3.9 and better than 12\n      // 23 = closest to FXAA 3.9 visually and performance wise\n      //  _ = the lowest digit is directly related to performance\n      // _  = the highest digit is directly related to style\n      //\n      #define FXAA_QUALITY_PRESET 12\n  #endif\n\n\n  /*============================================================================\n\n                              FXAA QUALITY - PRESETS\n\n  ============================================================================*/\n\n  /*============================================================================\n                        FXAA QUALITY - MEDIUM DITHER PRESETS\n  ============================================================================*/\n  #if (FXAA_QUALITY_PRESET == 10)\n      #define FXAA_QUALITY_PS 3\n      #define FXAA_QUALITY_P0 1.5\n      #define FXAA_QUALITY_P1 3.0\n      #define FXAA_QUALITY_P2 12.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 11)\n      #define FXAA_QUALITY_PS 4\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 3.0\n      #define FXAA_QUALITY_P3 12.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 12)\n      #define FXAA_QUALITY_PS 5\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 4.0\n      #define FXAA_QUALITY_P4 12.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 13)\n      #define FXAA_QUALITY_PS 6\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 4.0\n      #define FXAA_QUALITY_P5 12.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 14)\n      #define FXAA_QUALITY_PS 7\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 4.0\n      #define FXAA_QUALITY_P6 12.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 15)\n      #define FXAA_QUALITY_PS 8\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 4.0\n      #define FXAA_QUALITY_P7 12.0\n  #endif\n\n  /*============================================================================\n                        FXAA QUALITY - LOW DITHER PRESETS\n  ============================================================================*/\n  #if (FXAA_QUALITY_PRESET == 20)\n      #define FXAA_QUALITY_PS 3\n      #define FXAA_QUALITY_P0 1.5\n      #define FXAA_QUALITY_P1 2.0\n      #define FXAA_QUALITY_P2 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 21)\n      #define FXAA_QUALITY_PS 4\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 22)\n      #define FXAA_QUALITY_PS 5\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 23)\n      #define FXAA_QUALITY_PS 6\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 24)\n      #define FXAA_QUALITY_PS 7\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 3.0\n      #define FXAA_QUALITY_P6 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 25)\n      #define FXAA_QUALITY_PS 8\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 4.0\n      #define FXAA_QUALITY_P7 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 26)\n      #define FXAA_QUALITY_PS 9\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 2.0\n      #define FXAA_QUALITY_P7 4.0\n      #define FXAA_QUALITY_P8 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 27)\n      #define FXAA_QUALITY_PS 10\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 2.0\n      #define FXAA_QUALITY_P7 2.0\n      #define FXAA_QUALITY_P8 4.0\n      #define FXAA_QUALITY_P9 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 28)\n      #define FXAA_QUALITY_PS 11\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 2.0\n      #define FXAA_QUALITY_P7 2.0\n      #define FXAA_QUALITY_P8 2.0\n      #define FXAA_QUALITY_P9 4.0\n      #define FXAA_QUALITY_P10 8.0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_QUALITY_PRESET == 29)\n      #define FXAA_QUALITY_PS 12\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.5\n      #define FXAA_QUALITY_P2 2.0\n      #define FXAA_QUALITY_P3 2.0\n      #define FXAA_QUALITY_P4 2.0\n      #define FXAA_QUALITY_P5 2.0\n      #define FXAA_QUALITY_P6 2.0\n      #define FXAA_QUALITY_P7 2.0\n      #define FXAA_QUALITY_P8 2.0\n      #define FXAA_QUALITY_P9 2.0\n      #define FXAA_QUALITY_P10 4.0\n      #define FXAA_QUALITY_P11 8.0\n  #endif\n\n  /*============================================================================\n                        FXAA QUALITY - EXTREME QUALITY\n  ============================================================================*/\n  #if (FXAA_QUALITY_PRESET == 39)\n      #define FXAA_QUALITY_PS 12\n      #define FXAA_QUALITY_P0 1.0\n      #define FXAA_QUALITY_P1 1.0\n      #define FXAA_QUALITY_P2 1.0\n      #define FXAA_QUALITY_P3 1.0\n      #define FXAA_QUALITY_P4 1.0\n      #define FXAA_QUALITY_P5 1.5\n      #define FXAA_QUALITY_P6 2.0\n      #define FXAA_QUALITY_P7 2.0\n      #define FXAA_QUALITY_P8 2.0\n      #define FXAA_QUALITY_P9 2.0\n      #define FXAA_QUALITY_P10 4.0\n      #define FXAA_QUALITY_P11 8.0\n  #endif\n\n\n\n  /*============================================================================\n\n                                  API PORTING\n\n  ============================================================================*/\n  #if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n      #define FxaaBool bool\n      #define FxaaDiscard discard\n      #define FxaaFloat float\n      #define FxaaFloat2 vec2\n      #define FxaaFloat3 vec3\n      #define FxaaFloat4 vec4\n      #define FxaaHalf float\n      #define FxaaHalf2 vec2\n      #define FxaaHalf3 vec3\n      #define FxaaHalf4 vec4\n      #define FxaaInt2 ivec2\n      #define FxaaSat(x) clamp(x, 0.0, 1.0)\n      #define FxaaTex sampler2D\n  #else\n      #define FxaaBool bool\n      #define FxaaDiscard clip(-1)\n      #define FxaaFloat float\n      #define FxaaFloat2 float2\n      #define FxaaFloat3 float3\n      #define FxaaFloat4 float4\n      #define FxaaHalf half\n      #define FxaaHalf2 half2\n      #define FxaaHalf3 half3\n      #define FxaaHalf4 half4\n      #define FxaaSat(x) saturate(x)\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_GLSL_100 == 1)\n    #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n    #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_GLSL_120 == 1)\n      // Requires,\n      //  #version 120\n      // And at least,\n      //  #extension GL_EXT_gpu_shader4 : enable\n      //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n      #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n      #if (FXAA_FAST_PIXEL_OFFSET == 1)\n          #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n      #else\n          #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n      #endif\n      #if (FXAA_GATHER4_ALPHA == 1)\n          // use #extension GL_ARB_gpu_shader5 : enable\n          #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n          #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n          #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n          #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n      #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_GLSL_130 == 1)\n      // Requires #version 130 or better\n      #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n      #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n      #if (FXAA_GATHER4_ALPHA == 1)\n          // use #extension GL_ARB_gpu_shader5 : enable\n          #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n          #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n          #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n          #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n      #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_HLSL_3 == 1)\n      #define FxaaInt2 float2\n      #define FxaaTex sampler2D\n      #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\n      #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_HLSL_4 == 1)\n      #define FxaaInt2 int2\n      struct FxaaTex { SamplerState smpl; Texture2D tex; };\n      #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n      #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_HLSL_5 == 1)\n      #define FxaaInt2 int2\n      struct FxaaTex { SamplerState smpl; Texture2D tex; };\n      #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\n      #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\n      #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\n      #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\n      #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\n      #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\n  #endif\n\n\n  /*============================================================================\n                      GREEN AS LUMA OPTION SUPPORT FUNCTION\n  ============================================================================*/\n  #if (FXAA_GREEN_AS_LUMA == 0)\n      FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n  #else\n      FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n  #endif\n\n\n\n\n  /*============================================================================\n\n                                FXAA3 QUALITY - PC\n\n  ============================================================================*/\n  #if (FXAA_PC == 1)\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat4 FxaaPixelShader(\n      //\n      // Use noperspective interpolation here (turn off perspective interpolation).\n      // {xy} = center of pixel\n      FxaaFloat2 pos,\n      //\n      // Used only for FXAA Console, and not used on the 360 version.\n      // Use noperspective interpolation here (turn off perspective interpolation).\n      // {xy_} = upper left of pixel\n      // {_zw} = lower right of pixel\n      FxaaFloat4 fxaaConsolePosPos,\n      //\n      // Input color texture.\n      // {rgb_} = color in linear or perceptual color space\n      // if (FXAA_GREEN_AS_LUMA == 0)\n      //     {__a} = luma in perceptual color space (not linear)\n      FxaaTex tex,\n      //\n      // Only used on the optimized 360 version of FXAA Console.\n      // For everything but 360, just use the same input here as for tex.\n      // For 360, same texture, just alias with a 2nd sampler.\n      // This sampler needs to have an exponent bias of -1.\n      FxaaTex fxaaConsole360TexExpBiasNegOne,\n      //\n      // Only used on the optimized 360 version of FXAA Console.\n      // For everything but 360, just use the same input here as for tex.\n      // For 360, same texture, just alias with a 3nd sampler.\n      // This sampler needs to have an exponent bias of -2.\n      FxaaTex fxaaConsole360TexExpBiasNegTwo,\n      //\n      // Only used on FXAA Quality.\n      // This must be from a constant/uniform.\n      // {x_} = 1.0/screenWidthInPixels\n      // {_y} = 1.0/screenHeightInPixels\n      FxaaFloat2 fxaaQualityRcpFrame,\n      //\n      // Only used on FXAA Console.\n      // This must be from a constant/uniform.\n      // This effects sub-pixel AA quality and inversely sharpness.\n      //   Where N ranges between,\n      //     N = 0.50 (default)\n      //     N = 0.33 (sharper)\n      // {x__} = -N/screenWidthInPixels\n      // {_y_} = -N/screenHeightInPixels\n      // {_z_} =  N/screenWidthInPixels\n      // {__w} =  N/screenHeightInPixels\n      FxaaFloat4 fxaaConsoleRcpFrameOpt,\n      //\n      // Only used on FXAA Console.\n      // Not used on 360, but used on PS3 and PC.\n      // This must be from a constant/uniform.\n      // {x__} = -2.0/screenWidthInPixels\n      // {_y_} = -2.0/screenHeightInPixels\n      // {_z_} =  2.0/screenWidthInPixels\n      // {__w} =  2.0/screenHeightInPixels\n      FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n      //\n      // Only used on FXAA Console.\n      // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n      // This must be from a constant/uniform.\n      // {x__} =  8.0/screenWidthInPixels\n      // {_y_} =  8.0/screenHeightInPixels\n      // {_z_} = -4.0/screenWidthInPixels\n      // {__w} = -4.0/screenHeightInPixels\n      FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n      //\n      // Only used on FXAA Quality.\n      // This used to be the FXAA_QUALITY_SUBPIX define.\n      // It is here now to allow easier tuning.\n      // Choose the amount of sub-pixel aliasing removal.\n      // This can effect sharpness.\n      //   1.00 - upper limit (softer)\n      //   0.75 - default amount of filtering\n      //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n      //   0.25 - almost off\n      //   0.00 - completely off\n      FxaaFloat fxaaQualitySubpix,\n      //\n      // Only used on FXAA Quality.\n      // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\n      // It is here now to allow easier tuning.\n      // The minimum amount of local contrast required to apply algorithm.\n      //   0.333 - too little (faster)\n      //   0.250 - low quality\n      //   0.166 - default\n      //   0.125 - high quality\n      //   0.063 - overkill (slower)\n      FxaaFloat fxaaQualityEdgeThreshold,\n      //\n      // Only used on FXAA Quality.\n      // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\n      // It is here now to allow easier tuning.\n      // Trims the algorithm from processing darks.\n      //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n      //   0.0625 - high quality (faster)\n      //   0.0312 - visible limit (slower)\n      // Special notes when using FXAA_GREEN_AS_LUMA,\n      //   Likely want to set this to zero.\n      //   As colors that are mostly not-green\n      //   will appear very dark in the green channel!\n      //   Tune by looking at mostly non-green content,\n      //   then start at zero and increase until aliasing is a problem.\n      FxaaFloat fxaaQualityEdgeThresholdMin,\n      //\n      // Only used on FXAA Console.\n      // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\n      // It is here now to allow easier tuning.\n      // This does not effect PS3, as this needs to be compiled in.\n      //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\n      //   Due to the PS3 being ALU bound,\n      //   there are only three safe values here: 2 and 4 and 8.\n      //   These options use the shaders ability to a free *|/ by 2|4|8.\n      // For all other platforms can be a non-power of two.\n      //   8.0 is sharper (default!!!)\n      //   4.0 is softer\n      //   2.0 is really soft (good only for vector graphics inputs)\n      FxaaFloat fxaaConsoleEdgeSharpness,\n      //\n      // Only used on FXAA Console.\n      // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\n      // It is here now to allow easier tuning.\n      // This does not effect PS3, as this needs to be compiled in.\n      //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\n      //   Due to the PS3 being ALU bound,\n      //   there are only two safe values here: 1/4 and 1/8.\n      //   These options use the shaders ability to a free *|/ by 2|4|8.\n      // The console setting has a different mapping than the quality setting.\n      // Other platforms can use other values.\n      //   0.125 leaves less aliasing, but is softer (default!!!)\n      //   0.25 leaves more aliasing, and is sharper\n      FxaaFloat fxaaConsoleEdgeThreshold,\n      //\n      // Only used on FXAA Console.\n      // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\n      // It is here now to allow easier tuning.\n      // Trims the algorithm from processing darks.\n      // The console setting has a different mapping than the quality setting.\n      // This only applies when FXAA_EARLY_EXIT is 1.\n      // This does not apply to PS3,\n      // PS3 was simplified to avoid more shader instructions.\n      //   0.06 - faster but more aliasing in darks\n      //   0.05 - default\n      //   0.04 - slower and less aliasing in darks\n      // Special notes when using FXAA_GREEN_AS_LUMA,\n      //   Likely want to set this to zero.\n      //   As colors that are mostly not-green\n      //   will appear very dark in the green channel!\n      //   Tune by looking at mostly non-green content,\n      //   then start at zero and increase until aliasing is a problem.\n      FxaaFloat fxaaConsoleEdgeThresholdMin,\n      //\n      // Extra constants for 360 FXAA Console only.\n      // Use zeros or anything else for other platforms.\n      // These must be in physical constant registers and NOT immediates.\n      // Immediates will result in compiler un-optimizing.\n      // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n      FxaaFloat4 fxaaConsole360ConstDir\n  ) {\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat2 posM;\n      posM.x = pos.x;\n      posM.y = pos.y;\n      #if (FXAA_GATHER4_ALPHA == 1)\n          #if (FXAA_DISCARD == 0)\n              FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n              #if (FXAA_GREEN_AS_LUMA == 0)\n                  #define lumaM rgbyM.w\n              #else\n                  #define lumaM rgbyM.y\n              #endif\n          #endif\n          #if (FXAA_GREEN_AS_LUMA == 0)\n              FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n              FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n          #else\n              FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n              FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n          #endif\n          #if (FXAA_DISCARD == 1)\n              #define lumaM luma4A.w\n          #endif\n          #define lumaE luma4A.z\n          #define lumaS luma4A.x\n          #define lumaSE luma4A.y\n          #define lumaNW luma4B.w\n          #define lumaN luma4B.z\n          #define lumaW luma4B.x\n      #else\n          FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n          #if (FXAA_GREEN_AS_LUMA == 0)\n              #define lumaM rgbyM.w\n          #else\n              #define lumaM rgbyM.y\n          #endif\n          #if (FXAA_GLSL_100 == 1)\n            FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n          #else\n            FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n          #endif\n      #endif\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat maxSM = max(lumaS, lumaM);\n      FxaaFloat minSM = min(lumaS, lumaM);\n      FxaaFloat maxESM = max(lumaE, maxSM);\n      FxaaFloat minESM = min(lumaE, minSM);\n      FxaaFloat maxWN = max(lumaN, lumaW);\n      FxaaFloat minWN = min(lumaN, lumaW);\n      FxaaFloat rangeMax = max(maxWN, maxESM);\n      FxaaFloat rangeMin = min(minWN, minESM);\n      FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n      FxaaFloat range = rangeMax - rangeMin;\n      FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n      FxaaBool earlyExit = range < rangeMaxClamped;\n  /*--------------------------------------------------------------------------*/\n      if(earlyExit)\n          #if (FXAA_DISCARD == 1)\n              FxaaDiscard;\n          #else\n              return rgbyM;\n          #endif\n  /*--------------------------------------------------------------------------*/\n      #if (FXAA_GATHER4_ALPHA == 0)\n          #if (FXAA_GLSL_100 == 1)\n            FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n          #else\n            FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\n            FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n          #endif\n      #else\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n      #endif\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat lumaNS = lumaN + lumaS;\n      FxaaFloat lumaWE = lumaW + lumaE;\n      FxaaFloat subpixRcpRange = 1.0/range;\n      FxaaFloat subpixNSWE = lumaNS + lumaWE;\n      FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n      FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat lumaNESE = lumaNE + lumaSE;\n      FxaaFloat lumaNWNE = lumaNW + lumaNE;\n      FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n      FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat lumaNWSW = lumaNW + lumaSW;\n      FxaaFloat lumaSWSE = lumaSW + lumaSE;\n      FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n      FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n      FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n      FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n      FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n      FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n      FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n      FxaaBool horzSpan = edgeHorz >= edgeVert;\n      FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n  /*--------------------------------------------------------------------------*/\n      if(!horzSpan) lumaN = lumaW;\n      if(!horzSpan) lumaS = lumaE;\n      if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n      FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat gradientN = lumaN - lumaM;\n      FxaaFloat gradientS = lumaS - lumaM;\n      FxaaFloat lumaNN = lumaN + lumaM;\n      FxaaFloat lumaSS = lumaS + lumaM;\n      FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n      FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n      if(pairN) lengthSign = -lengthSign;\n      FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat2 posB;\n      posB.x = posM.x;\n      posB.y = posM.y;\n      FxaaFloat2 offNP;\n      offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n      offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n      if(!horzSpan) posB.x += lengthSign * 0.5;\n      if( horzSpan) posB.y += lengthSign * 0.5;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat2 posN;\n      posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\n      posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\n      FxaaFloat2 posP;\n      posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\n      posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\n      FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\n      FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n      FxaaFloat subpixE = subpixC * subpixC;\n      FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n  /*--------------------------------------------------------------------------*/\n      if(!pairN) lumaNN = lumaSS;\n      FxaaFloat gradientScaled = gradient * 1.0/4.0;\n      FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n      FxaaFloat subpixF = subpixD * subpixE;\n      FxaaBool lumaMLTZero = lumaMM < 0.0;\n  /*--------------------------------------------------------------------------*/\n      lumaEndN -= lumaNN * 0.5;\n      lumaEndP -= lumaNN * 0.5;\n      FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n      FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n      if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\n      if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\n      FxaaBool doneNP = (!doneN) || (!doneP);\n      if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\n      if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\n  /*--------------------------------------------------------------------------*/\n      if(doneNP) {\n          if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n          if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n          if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n          if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n          doneN = abs(lumaEndN) >= gradientScaled;\n          doneP = abs(lumaEndP) >= gradientScaled;\n          if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\n          if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\n          doneNP = (!doneN) || (!doneP);\n          if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\n          if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\n  /*--------------------------------------------------------------------------*/\n          #if (FXAA_QUALITY_PS > 3)\n          if(doneNP) {\n              if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n              if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n              if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n              if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n              doneN = abs(lumaEndN) >= gradientScaled;\n              doneP = abs(lumaEndP) >= gradientScaled;\n              if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\n              if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\n              doneNP = (!doneN) || (!doneP);\n              if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\n              if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\n  /*--------------------------------------------------------------------------*/\n              #if (FXAA_QUALITY_PS > 4)\n              if(doneNP) {\n                  if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                  if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                  if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                  if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                  doneN = abs(lumaEndN) >= gradientScaled;\n                  doneP = abs(lumaEndP) >= gradientScaled;\n                  if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\n                  if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\n                  doneNP = (!doneN) || (!doneP);\n                  if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\n                  if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\n  /*--------------------------------------------------------------------------*/\n                  #if (FXAA_QUALITY_PS > 5)\n                  if(doneNP) {\n                      if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                      if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                      if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                      if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                      doneN = abs(lumaEndN) >= gradientScaled;\n                      doneP = abs(lumaEndP) >= gradientScaled;\n                      if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\n                      if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\n                      doneNP = (!doneN) || (!doneP);\n                      if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\n                      if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\n  /*--------------------------------------------------------------------------*/\n                      #if (FXAA_QUALITY_PS > 6)\n                      if(doneNP) {\n                          if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                          if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                          if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                          if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                          doneN = abs(lumaEndN) >= gradientScaled;\n                          doneP = abs(lumaEndP) >= gradientScaled;\n                          if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\n                          if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\n                          doneNP = (!doneN) || (!doneP);\n                          if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\n                          if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\n  /*--------------------------------------------------------------------------*/\n                          #if (FXAA_QUALITY_PS > 7)\n                          if(doneNP) {\n                              if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                              if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                              if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                              if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                              doneN = abs(lumaEndN) >= gradientScaled;\n                              doneP = abs(lumaEndP) >= gradientScaled;\n                              if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\n                              if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\n                              doneNP = (!doneN) || (!doneP);\n                              if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\n                              if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\n  /*--------------------------------------------------------------------------*/\n      #if (FXAA_QUALITY_PS > 8)\n      if(doneNP) {\n          if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n          if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n          if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n          if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n          doneN = abs(lumaEndN) >= gradientScaled;\n          doneP = abs(lumaEndP) >= gradientScaled;\n          if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\n          if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\n          doneNP = (!doneN) || (!doneP);\n          if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\n          if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\n  /*--------------------------------------------------------------------------*/\n          #if (FXAA_QUALITY_PS > 9)\n          if(doneNP) {\n              if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n              if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n              if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n              if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n              doneN = abs(lumaEndN) >= gradientScaled;\n              doneP = abs(lumaEndP) >= gradientScaled;\n              if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\n              if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\n              doneNP = (!doneN) || (!doneP);\n              if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\n              if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\n  /*--------------------------------------------------------------------------*/\n              #if (FXAA_QUALITY_PS > 10)\n              if(doneNP) {\n                  if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                  if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                  if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                  if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                  doneN = abs(lumaEndN) >= gradientScaled;\n                  doneP = abs(lumaEndP) >= gradientScaled;\n                  if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\n                  if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\n                  doneNP = (!doneN) || (!doneP);\n                  if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\n                  if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\n  /*--------------------------------------------------------------------------*/\n                  #if (FXAA_QUALITY_PS > 11)\n                  if(doneNP) {\n                      if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                      if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                      if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                      if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                      doneN = abs(lumaEndN) >= gradientScaled;\n                      doneP = abs(lumaEndP) >= gradientScaled;\n                      if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\n                      if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\n                      doneNP = (!doneN) || (!doneP);\n                      if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\n                      if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\n  /*--------------------------------------------------------------------------*/\n                      #if (FXAA_QUALITY_PS > 12)\n                      if(doneNP) {\n                          if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                          if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                          if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                          if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                          doneN = abs(lumaEndN) >= gradientScaled;\n                          doneP = abs(lumaEndP) >= gradientScaled;\n                          if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\n                          if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\n                          doneNP = (!doneN) || (!doneP);\n                          if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\n                          if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\n  /*--------------------------------------------------------------------------*/\n                      }\n                      #endif\n  /*--------------------------------------------------------------------------*/\n                  }\n                  #endif\n  /*--------------------------------------------------------------------------*/\n              }\n              #endif\n  /*--------------------------------------------------------------------------*/\n          }\n          #endif\n  /*--------------------------------------------------------------------------*/\n      }\n      #endif\n  /*--------------------------------------------------------------------------*/\n                          }\n                          #endif\n  /*--------------------------------------------------------------------------*/\n                      }\n                      #endif\n  /*--------------------------------------------------------------------------*/\n                  }\n                  #endif\n  /*--------------------------------------------------------------------------*/\n              }\n              #endif\n  /*--------------------------------------------------------------------------*/\n          }\n          #endif\n  /*--------------------------------------------------------------------------*/\n      }\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat dstN = posM.x - posN.x;\n      FxaaFloat dstP = posP.x - posM.x;\n      if(!horzSpan) dstN = posM.y - posN.y;\n      if(!horzSpan) dstP = posP.y - posM.y;\n  /*--------------------------------------------------------------------------*/\n      FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n      FxaaFloat spanLength = (dstP + dstN);\n      FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n      FxaaFloat spanLengthRcp = 1.0/spanLength;\n  /*--------------------------------------------------------------------------*/\n      FxaaBool directionN = dstN < dstP;\n      FxaaFloat dst = min(dstN, dstP);\n      FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n      FxaaFloat subpixG = subpixF * subpixF;\n      FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n      FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n  /*--------------------------------------------------------------------------*/\n      FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n      FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n      if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n      if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n      #if (FXAA_DISCARD == 1)\n          return FxaaTexTop(tex, posM);\n      #else\n          return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n      #endif\n  }\n  /*==========================================================================*/\n  #endif\n","\n  ").concat("\n  uniform float noiseSpeed;\n  uniform float noiseAmount;\n\n  float random(vec2 n, float offset) {\n    return 0.5 - fract(sin(dot(n.xy + vec2(offset, 0.0), vec2(12.9898, 78.233)))* 43758.5453);\n  }\n","\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    vec4 outgoingColor = texture2D(texture, uv);\n    ").concat("\n  // FXAA pass start\n  if (fxaaEnabled) {\n    outgoingColor = FxaaPixelShader(\n      uv,\n      vec4(0.0),\n      texture,\n      texture,\n      texture,\n      fxaaResolution,\n      vec4(0.0),\n      vec4(0.0),\n      vec4(0.0),\n      0.75,\n      0.166,\n      0.0833,\n      0.0,\n      0.0,\n      0.0,\n      vec4(0.0)\n    );\n    // TODO avoid querying texture twice for same texel\n    outgoingColor.a = texture2D(texture, uv).a;\n  }\n  // FXAA pass end\n","\n    ").concat("\n  outgoingColor += vec4(vec3(noiseAmount * random(uv, 0.00001 * noiseSpeed * time)), 1.0);\n","\n    gl_FragColor.rgb = mix(outgoingColor.rgb, tintColor, tint);\n    gl_FragColor.a = outgoingColor.a;\n    // gl_FragColor = vec4(uv, 1.0, 1.0);\n  }\n"),_a=function(){function e(t,n,a){Object(c.a)(this,e),this.gui=t.addFolder("final pass"),this.gui.open(),this.scene=new Ie.yb,this.camera=a;var o=Object(Me.d)(),i=o.width,r=o.height,s={tintColor:De.j},l=new Ie.Bb({uniforms:Object(St.b)({time:{value:0},tint:{value:0},tintColor:{value:new Ie.o(s.tintColor)},texture:{value:null},resolution:{value:new Ie.Pb(i,r)}},Sa,Fa),vertexShader:"\n  void main() {\n    gl_Position = vec4(position, 1.0);\n  }\n",fragmentShader:Ea});l.uniforms.tintColor.value=new Ie.o(s.tintColor),this.gui.add(l.uniforms.noiseAmount,"value",0,1).name("noise amount"),this.gui.add(l.uniforms.noiseSpeed,"value",0,1).name("noise speed"),this.gui.addColor(s,"tintColor").onChange((function(e){l.uniforms.tintColor.value.setHex(e)})),this.gui.add(l.uniforms.tint,"value",0,1).name("tint").listen(),this.mesh=new Ie.W(n,l),this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix(),this.scene.add(this.mesh)}return Object(le.a)(e,[{key:"resize",value:function(e,t){this.mesh.material.uniforms.resolution.value.x=e,this.mesh.material.uniforms.resolution.value.y=t,this.mesh.material.uniforms.fxaaResolution.value.x=1/e,this.mesh.material.uniforms.fxaaResolution.value.y=1/t}},{key:"setTint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;Ee.j.killTweensOf(this.mesh.material.uniforms.tint),o&&this.mesh.material.uniforms.tintColor.value.setHex(o),t?Ee.j.to(this.mesh.material.uniforms.tint,n,{value:e,delay:a}):this.mesh.material.uniforms.tint.value=e}},{key:"render",value:function(e,t,n){Me.b.setRenderTarget(t),Me.b.render(e.scene,e.camera),Me.b.setRenderTarget(null),this.mesh.material.uniforms.texture.value=t.texture,this.mesh.material.uniforms.time.value+=n,Me.b.render(this.scene,this.camera)}},{key:"screenShotRender",value:function(e,t,n,a,o){this.mesh.material.uniforms.texture.value=n.texture,this.mesh.material.uniforms.time.value+=o,Me.b.setRenderTarget(a),Me.b.render(this.scene,this.camera)}}]),e}(),Oa="\n  void main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",Ca="\n  uniform sampler2D texture;\n  uniform vec2 direction;\n  uniform vec2 resolution;\n\n  vec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n    vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.3333333333333333) * direction;\n    color += texture2D(image, uv) * 0.29411764705882354;\n    color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\n    color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\n    return color;\n  }\n\n  vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n    vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.3846153846) * direction;\n    vec2 off2 = vec2(3.2307692308) * direction;\n    color += texture2D(image, uv) * 0.2270270270;\n    color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n    color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n    color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n    color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n    return color;\n  }\n\n\n  // https://github.com/Jam3/glsl-fast-gaussian-blur/\n  vec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n    vec4 color = vec4(0.0);\n    vec2 off1 = vec2(1.411764705882353) * direction;\n    vec2 off2 = vec2(3.2941176470588234) * direction;\n    vec2 off3 = vec2(5.176470588235294) * direction;\n    color += texture2D(image, uv) * 0.1964825501511404;\n    color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\n    color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\n    color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\n    color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\n    color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\n    color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\n    return color;\n  }\n\n  void main() {\n    vec2 uv = gl_FragCoord.xy / resolution;\n    gl_FragColor = blur13(texture, uv, resolution, direction);\n  }\n",Ia=function(){function e(t,n,a,o){var i=this;Object(c.a)(this,e),this.onChange=function(){i.setBlur(i.strength)},this.render=function(e,t){if(Me.b.setRenderTarget(t),Me.b.setClearColor(16777215),Me.b.render(e.scene,e.camera),i.strength>0)for(var n=0;n<i.iterations;n++)i.mesh.material.uniforms.texture.value=0===n?t.texture:i.readBuffer.texture,i.mesh.material.uniforms.direction.value.set(i.directions[n][0],i.directions[n][1]),Me.b.setRenderTarget(i.writeBuffer),Me.b.render(i.scene,i.camera),i.swap=i.writeBuffer,i.writeBuffer=i.readBuffer,i.readBuffer=i.swap;else i.mesh.material.uniforms.texture.value=t.texture;Me.b.setRenderTarget(null),Me.b.render(i.scene,i.camera)},this.gui=t.addFolder("blur"),this.gui.open(),this.scene=new Ie.yb,this.camera=new Ie.jb(-1,1,1,-1,0,1),this.camera.position.z=1,this.camera.updateProjectionMatrix();var r=new Ie.Bb({uniforms:{texture:{value:null},resolution:{value:new Ie.Pb(a.width,a.height)},direction:{value:new Ie.Pb(0,1)}},vertexShader:Oa,fragmentShader:Ca});this.mesh=new Ie.W(n,r),this.scene.add(this.mesh),this.iterations=8,this.strength=0,this.writeBuffer=a,this.readBuffer=o,this.swap=null,this.enabled=!1,this.setBlur(this.strength),this.gui.add(this,"strength",0,1).onChange(this.onChange),this.gui.add(this,"iterations",0,8).step(1).onChange(this.onChange)}return Object(le.a)(e,[{key:"setBlur",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(n)Xe.g.killTweensOf(this),this.enabled=!0,Xe.g.to(this,a,{strength:e,delay:o,onUpdate:function(){t.directions=[];for(var e=0;e<t.iterations;e++)t.directions.push(t.getRadius(e))},onComplete:function(){0===e&&(t.enabled=!1)}});else{this.strength=e,this.enabled=e>0,this.directions=[];for(var i=0;i<this.iterations;i++)this.directions.push(this.getRadius(i))}}},{key:"getRadius",value:function(e){var t=(this.iterations-e-1)*this.strength;return e%2===0?[t,0]:[0,t]}},{key:"resize",value:function(e,t){this.mesh.material.uniforms.resolution.value.set(e,t)}}]),e}(),Ma={tColor:{value:null},aspect:{value:1},maxblur:{value:.025},resolution:{value:new Ie.Pb},radius:{value:.65},radiusEdge:{value:.4},strength:{value:1}},La="\n  #define DEPTH_PACKING 1\n\t#define PERSPECTIVE_CAMERA 1\n\n  ".concat(Ie.zb.common,"\n\n  uniform sampler2D tColor;\n  uniform float maxblur;\n  uniform float aspect;\n  uniform vec2 resolution;\n  uniform float radius;\n  uniform float radiusEdge;\n  uniform float strength;\n\n  void main() {\n    vec2 vUv = gl_FragCoord.xy / resolution;\n\n    vec2 aspectcorrect = vec2( 1.0, aspect );\n\n    // Gradient circle for focus\n    vec2 uvCircle = vUv;\n    vec2 circleCenter = vec2(0.5);\n    uvCircle -= circleCenter;\n    float dist =  sqrt(dot(uvCircle, uvCircle));\n    float circleAlpha = 1.0 - smoothstep(radius, radius - radiusEdge, dist);\n\n    float factor = circleAlpha;\n\n    float fac = factor * maxblur * strength;\n\n    vec2 dofblur = vec2(fac);\n\n    vec2 dofblur9 = dofblur * 0.9;\n    vec2 dofblur7 = dofblur * 0.7;\n    vec2 dofblur4 = dofblur * 0.4;\n\n    vec4 col = vec4( 0.0 );\n\n    gl_FragColor.a = 1.0;\n    if (fac > 0.0) {\n      col += texture2D( tColor, vUv.xy );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );\n\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );\n\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );\n\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );\n      col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );\n      gl_FragColor = col / 41.0;\n    } else {\n      gl_FragColor = texture2D( tColor, vUv.xy );\n    }\n\n    // gl_FragColor.rgb = vec3(0);\n    // gl_FragColor.r = circleAlpha;\n  }\n"),Na=function(){function e(t,n,a,o){var i=this;Object(c.a)(this,e),this.onChange=function(){i.setDof(i.strength)},this.gui=t.addFolder("depth of field"),this.gui.open(),this.scene=new Ie.yb,this.strength=0,this.camera=new Ie.jb(-1,1,1,-1,0,1),this.camera.position.z=1,this.camera.updateProjectionMatrix(),this.renderTarget=Object(Me.a)(a,o,{format:Ie.ub});var r=new Ie.Bb({uniforms:Ma,vertexShader:"\n  void main() {\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader:La});this.mesh=new Ie.W(n,r),this.scene.add(this.mesh),r.uniforms.tColor.value=this.renderTarget.texture,r.uniforms.resolution.value.x=a,r.uniforms.resolution.value.y=o,r.uniforms.strength.value=this.stength,this.gui.add(r.uniforms.maxblur,"value",0,1).name("max blur"),this.gui.add(r.uniforms.radius,"value",0,1).name("radius"),this.gui.add(r.uniforms.radiusEdge,"value",0,1).name("radius edge"),this.strength=0,this.enabled=!1,this.gui.add(this,"strength",0,1).onChange(this.onChange)}return Object(le.a)(e,[{key:"setDof",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;n?(Ee.j.killTweensOf(this),this.enabled=!0,Ee.j.to(this,a,{strength:e,delay:o,onComplete:function(){0===e&&(t.enabled=!1)}})):(this.enabled=e>0,this.strength=e)}},{key:"setAspect",value:function(e){this.mesh.material.uniforms.aspect.value=e.aspect}},{key:"resize",value:function(e,t,n){this.mesh.material.uniforms.resolution.value.set(e,t),this.mesh.material.uniforms.aspect.value=n.aspect,this.renderTarget.setSize(e,t)}},{key:"render",value:function(e){this.mesh.material.uniforms.strength.value=this.strength,Me.b.setRenderTarget(this.renderTarget),Me.b.render(e.scene,e.camera)}},{key:"resizeScreenshot",value:function(e,t,n){this.mesh.material.uniforms.resolution.value.x=t,this.mesh.material.uniforms.resolution.value.y=n,this.mesh.material.uniforms.aspect.value=e.aspect}},{key:"renderScreenshot",value:function(e,t,n){this.mesh.material.uniforms.strength.value=this.strength,Me.b.setRenderTarget(t),Me.b.render(e.scene,e.camera),this.mesh.material.uniforms.tColor.value=t.texture,Me.b.setRenderTarget(n),Me.b.render(this.scene,this.camera),Me.b.setRenderTarget(null)}},{key:"screenshotReset",value:function(){this.mesh.material.uniforms.tColor.value=this.renderTarget.texture}}]),e}(),ka=new(function(){function e(){Object(c.a)(this,e),this.gui=je.b.addFolder("post processing");var t=Object(St.a)();this.camera=new Ie.jb(-1,1,1,-1,0,1),this.transitionPass=new Ta(this.gui,t,this.camera),this.finalPass=new _a(this.gui,t,this.camera);var n=Object(Me.d)(),a=n.width,o=n.height;this.renderTargetA=Object(Me.a)(a,o),this.renderTargetB=Object(Me.a)(a,o),this.renderTargetC=Object(Me.a)(a,o),this.renderTargetD=Object(Me.a)(a,o);var i=new Pa("emptyA"),r=new Pa("emptyB");this.dofPass=new Na(this.gui,t,a,o),this.blurPass=new Ia(this.gui,t,this.renderTargetA,this.renderTargetB),this.lastPass=null,this.currentScene=null,this.setScenes(i,r)}return Object(le.a)(e,[{key:"resize",value:function(e){var t=Object(Me.d)(),n=t.width,a=t.height;this.renderTargetA.setSize(n,a),this.renderTargetB.setSize(n,a),this.renderTargetC.setSize(n,a),this.renderTargetD.setSize(n,a),this.transitionPass.resize(n,a),this.finalPass.resize(n,a),this.blurPass.resize(n,a),this.dofPass.resize(n,a,e)}},{key:"setScenes",value:function(e,t){this.sceneA=e,this.sceneB=t}},{key:"transition",value:function(){return this.transitionPass.transition()}},{key:"setBlur",value:function(e,t,n,a){this.blurPass.setBlur(e,t,n,a)}},{key:"setDof",value:function(e,t,n,a){this.dofPass.setDof(e,t,n,a),this.dofPass.setAspect(this.currentScene.camera)}},{key:"setTint",value:function(e,t,n,a,o){this.finalPass.setTint(e,t,n,a,o)}},{key:"setCurrentScene",value:function(e){this.currentScene=e}},{key:"render",value:function(e){this.currentScene=0===this.transitionPass.mesh.material.uniforms.transition.value?this.sceneA:this.sceneB,this.lastPass=this.currentScene,this.transitionPass.enabled&&(this.transitionPass.render(this.sceneA,this.sceneB,this.renderTargetA,this.renderTargetB,e),this.lastPass=this.transitionPass),this.dofPass.enabled&&(this.dofPass.render(this.lastPass,e),this.lastPass=this.dofPass),this.blurPass.enabled&&(this.blurPass.render(this.lastPass,this.renderTargetC,e),this.lastPass=this.blurPass),this.finalPass.render(this.lastPass,this.renderTargetD,e)}}]),e}()),ja=function e(t){var n=this;Object(c.a)(this,e),this.gui=t.addFolder("fog"),this.gui.open(),this.config={color:13161956,density:.1,near:.1,far:5},this.fog=new Ie.B(this.config.color,this.config.near,this.config.far),this.gui.add(this.fog,"near",0,1),this.gui.add(this.fog,"far",0,100),this.gui.addColor(this.config,"color").onChange((function(e){n.fog.color.setHex(e)}))},Ua=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(ue.a)(this,Object(de.a)(t).call(this,{id:De.B,assets:kt,gui:!0,guiOpen:!1}))).createObjects=function(){return new Promise((function(t,n){try{e.lights=new Be,e.lights.get().forEach((function(t){e.scene.add(t)})),e.lights.gui(e.gui),Object.keys(an).forEach((function(t){cn.addTransition(t,an[t],e.scene)})),e.crystalTexture=new ta(e.gui),e.background=new zn(e.gui),e.scene.add(e.background.mesh);var a=Tt.a.get(De.B,"rock-model").children[0].geometry.clone();e.rock=new Xn(e.gui,e.camera,a,e.crystalTexture),e.scene.add(e.rock.group),e.crystals=new ea(e.gui,a,e.crystalTexture,e.rock.paint),e.crystals.camera=e.camera,e.crystals.rock=e.rock,e.scene.add(e.crystals.group),e.rock.on("renderTargetRender",e.crystals.onRenderTargetRender),e.particles=new ra(e.gui),e.scene.add(e.particles.group),e.core=new wa(e.gui),e.scene.add(e.core.group),e.fog=new ja(e.gui),e.scene.fog=e.fog.fog,e.camera.fov=65,e.camera.updateProjectionMatrix(),e.ready=!0,t()}catch(o){n(o)}}))},e.setState=function(t){e.emit("sceneStep",t)},e.onStateChanged=function(t){switch(e.state=t,e.state.route===v.k.Past&&na.b.setCamera(e.camera),e.state.sceneStep){case De.A:e.rock.onStateChanged(e.state),jn.a.play(De.B,Ft.k),cn.setTransition("PAST_SCENE_INTRO",e.camera),cn.transition(6),ka.setBlur(1),ka.setDof(0),ka.setTint(De.u,!0,De.t,0,De.k);break;case De.E:e.rock.onStateChanged(e.state),e.core.onStateChanged(e.state),cn.setTransition("PAST_TRANSITION_IN",e.camera),cn.once("transitionComplete",e.onTransitionComplete),cn.transition(.75),ka.setBlur(0,!0,.75),ka.setDof(1,!0,.75),ka.setTint(0,!0,De.t);break;case De.y:ka.setDof(1);var n=e.camera.position.length(),a=ee.a.isDesktop?30:15,o=ee.a.isDesktop?8:11;na.b.setConfig(new na.a(a,o,.115,.7*n,n)),na.b.setActive(!0),e.rock.once("complete",e.onInteractionComplete),e.rock.on("interactionProgress",e.onInteractionProgress),e.rock.once("interactionProgress",e.onInteractionStarted),e.rock.onStateChanged(e.state),e.core.onStateChanged(e.state),cn.setCameraPositionFromTransition("PAST_TRANSITION_IN",e.camera);break;case De.z:e.rock.off("interactionProgress",e.onInteractionProgress),Object(Me.g)(!1),e.rock.onStateChanged(e.state),e.core.onStateChanged(e.state),cn.setCameraPositionFromTransition("PAST_TRANSITION_IN",e.camera);break;case De.F:na.b.setActive(!1),an.PAST_TRANSITION_OUT.origin[0].x=e.camera.position.x,an.PAST_TRANSITION_OUT.origin[0].y=e.camera.position.y,an.PAST_TRANSITION_OUT.origin[0].z=e.camera.position.z;var i=(new Ie.Qb).lerpVectors(e.camera.position,en.e,.825);an.PAST_TRANSITION_OUT.origin[1].x=i.x,an.PAST_TRANSITION_OUT.origin[1].y=i.y,an.PAST_TRANSITION_OUT.origin[1].z=i.z,ka.setDof(0,!0,3),cn.addTransition("PAST_TRANSITION_OUT",an.PAST_TRANSITION_OUT,e.scene,e.camera),cn.setTransition("PAST_TRANSITION_OUT",e.camera),cn.once("transitionComplete",e.onTransitionComplete),cn.transition(4,Xe.d.easeIn),Xe.g.delayedCall(3.85,(function(){jn.a.stop(De.B,Ft.k),e.emit("complete")}))}},e.onInteractionProgress=function(t){e.emit("interactionProgress",t)},e.onInteractionStarted=function(){e.emit("interactionStarted")},e.onInteractionComplete=function(){e.setState(new Zt({step:De.z}))},e.captureScreenShot=function(e){na.b.captureScreenShot(e)},e.onTransitionComplete=function(){switch(e.state.sceneStep){case De.E:e.setState(new Zt({step:De.y}));break;case De.F:e.rock.onStateChanged(e.state),e.core.onStateChanged(e.state),e.crystals.resetAll()}},e.update=function(t){e.ready&&(na.b.update(),e.crystals.update(t,e.rock),e.crystalTexture.update(),e.rock.update(t,$e.dev),e.particles.update(t,$e.dev),e.core.update(t))},e.dispose=function(){for(var t=Object(C.a)(e.scene.children),n=0;n<t.length;n++)Object(St.c)(t[n],e.scene);e.background.dispose(),e.rock.dispose(),Tt.a.dispose(De.B)},e.ready=!1,e}return Object(he.a)(t,e),t}(Wt),Ra=function(){function e(){Object(c.a)(this,e),this.ambient=new ze({ambient:15792892,intensity:.7}),this.directional=new Ye({intensity:.6}),this.directional.light.castShadow=!0,this.directional.light.shadow.mapSize.width=1024,this.directional.light.shadow.mapSize.height=1024,this.directional.light.shadow.camera.near=1,this.directional.light.shadow.camera.far=1e3,this.directional.light.shadow.camera.right=15,this.directional.light.shadow.camera.left=-15,this.directional.light.shadow.camera.top=15,this.directional.light.shadow.camera.bottom=-15,this.directional.light.shadow.bias=-.002,this.directional.light.position.set(20,20,20)}return Object(le.a)(e,[{key:"gui",value:function(e){var t=e.addFolder("lights");t.open(),this.ambient.gui(t),this.directional.gui(t),this.directional.gui.add(this.directional.light.shadow,"bias",-.01,0).step(1e-4)}},{key:"resize",value:function(){}},{key:"update",value:function(){}},{key:"get",value:function(){return[this.ambient.light,this.directional.light]}},{key:"dispose",value:function(e){this.get().forEach((function(e){e.dispose()}))}}]),e}(),Da=function(){function e(t){var n,a=this;Object(c.a)(this,e),this.onUpdate=function(){a.material.uniforms.color0.value.setHex(a.config.color0),a.material.uniforms.color1.value.setHex(a.config.color1)},this.guiParent=t,this.config={color0:De.b,color1:De.d},this.material=new Ie.Bb({uniforms:{color0:{value:new Ie.o(this.config.color0)},color1:{value:new Ie.o(this.config.color1)},strength:{value:1.5},powStrength:{value:1.6}},vertexShader:"\n  varying vec2 vUv;\n  void main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",fragmentShader:"\n  uniform vec3 color0;\n  uniform vec3 color1;\n  uniform float strength;\n  uniform float powStrength;\n  varying vec2 vUv;\n\n  void main() {\n    float y = distance(vec2(0.5, 0.0), vUv) * strength;\n    y = pow(y, powStrength);\n    vec3 color = mix(color0, color1, y);\n\n    gl_FragColor = vec4(color, 1.0);\n  }\n",side:Ie.e}),this.gui=t.addFolder("background"),this.gui.add(this.material.uniforms.strength,"value",0,10).onChange(this.onUpdate),this.gui.add(this.material.uniforms.powStrength,"value",0,10).onChange(this.onUpdate),this.gui.addColor(this.config,"color0").onChange(this.onUpdate),this.gui.addColor(this.config,"color1").onChange(this.onUpdate);var o=(n={},Object(p.a)(n,De.q,[32,16]),Object(p.a)(n,De.r,[18,8]),n)[Object(De.K)()];this.mesh=new Ie.W(new Ie.Eb(40,o[0],o[1]),this.material),this.mesh.rotation.y=Math.PI,this.mesh.matrixAutoUpdate=!1,this.mesh.updateMatrix()}return Object(le.a)(e,[{key:"dispose",value:function(){this.guiParent.removeFolder(this.gui.name)}}]),e}(),Xa=n(71),za=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(ue.a)(this,Object(de.a)(t).call(this))).setActive=function(e){if(a.active!==e){a.active=e;var t=e?"bind":"unbind";ee.a.isDesktop?(a.domEvents[t](a.mesh,"mouseover",a.onMouseOver),a.domEvents[t](a.mesh,"mouseout",a.onMouseOut),a.domEvents[t](a.mesh,"mousedown",a.onTouchStart),a.domEvents[t](a.mesh,"mousemove",a.onTouchMove),document.body.addEventListener("mouseup",a.onTouchEnd,!1)):(a.domEvents[t](a.mesh,"touchstart",a.onTouchStart),a.domEvents[t](a.mesh,"mousemove",a.onTouchMove),document.body.addEventListener("touchend",a.onTouchEnd,!1))}},a.onMouseOver=function(){a.active&&(Object(Me.g)(!0),a.emit("over"))},a.onMouseOut=function(){a.active&&(Object(Me.g)(!1),a.emit("out"))},a.onTouchStart=function(e){a.active&&(a.isDown=!0,a.emit("start",e.intersect))},a.onTouchMove=function(e){a.active&&a.emit("move",e.intersect)},a.onTouchEnd=function(){a.active&&(a.isDown=!1,a.emit("end"))},a.domEvents=new On(e,Me.b.domElement),a.isDown=!1,a.mesh=n,a}return Object(he.a)(t,e),t}(Ce.a),Ya=n(48),Ba=new Ie.Qb,Qa=new Ie.Qb,Va=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).start=function(){n.interval=setInterval((function(){n.count++,n.emit("emit"),n.count>=n.total&&clearInterval(n.interval)}),n.delay)},n.dispose=function(){clearInterval(n.interval)},n.count=0,n.total=e,n.delay=a,n}return Object(he.a)(t,e),t}(Ce.a),Ha=function(e){function t(e,n,a,o){var i;Object(c.a)(this,t),(i=Object(ue.a)(this,Object(de.a)(t).call(this))).export=function(){for(var e={position:[],size:[]},t=0,n=new Ie.Qb,a=i.sizeBuffer.length,o=0;o<a;o++){t=3*o;var r=i.sizeBuffer[o],s=i.positionBuffer[t],c=i.positionBuffer[t+1],l=i.positionBuffer[t+2],u=Math.abs(n.set(s,c,l).distanceTo(en.e));l<5&&u>10&&(e.position.push(s,c,l),e.size.push(r))}var d=JSON.stringify(e),h=new Blob([d],{type:"application/json"}),f=URL.createObjectURL(h),m=document.createElement("a");m.download="data.json",m.href=f,m.click()},i.createHitbox=function(e){var t=new Ie.mb(1,1),n=new Ie.W(t,new Ie.X({side:Ie.v,wireframe:!1,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1}));i.group.add(n),i.hitbox=new za(e,n),i.hitbox.on("move",i.onHitboxMove)},i.getProgress=function(){var e=(i.interactionIndex-1)/i.spawnIncrements.length,t=i.interactionIndex/i.spawnIncrements.length;return i.interactionIndex===i.spawnIncrements.length&&(t=1),{from:e,to:t}},i.onMotionUpdate=function(e){i.positionMotionEase.setValue(e[0].normalX,e[0].normalY,!0)},i.createBall=function(){var e={type:"sphere",size:[4],pos:[0,0,0],rot:[0,0,0],move:!0,kinematic:!0};i.ball=i.world.add(e),i.ballMesh=new Ie.W(new Ie.Eb(1,8,8),new Ie.bb),i.ballMesh.scale.set(4,4,4)},i.onHitboxMove=function(e){i.ball.setPosition({x:e.point.x,y:e.point.y,z:0})},i.onHitboxStart=function(e){i.addVelocity(),i.clickIndex++,jn.a.play(De.C,Ft.r[i.clickIndex%Ft.r.length])},i.addVelocity=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.35;i.spheres.forEach((function(t){t.applyImpulse(Qa,new Ie.Qb(en.f.lerp(-e,e,Math.random()),en.f.lerp(-e,e,Math.random()),en.f.lerp(-e,e,Math.random())))}))},i.randomPosition=function(){return Object(en.h)(0,0,0,en.f.lerp(.25*i.radius,i.radius,Math.random()),!0)},i.randomRotation=function(){return[en.f.lerp(-180,180,Math.random()),en.f.lerp(-180,180,Math.random()),en.f.lerp(-180,180,Math.random())]},i.createSphere=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=1;a=t?en.f.lerp(4,5,Math.random()):en.f.lerp(.8,1.5,Math.random());var o={type:"sphere",size:[t?a:.1],pos:e,rot:i.randomRotation(),move:n,density:1,friction:.6,restitution:.1},r=i.world.add(o);return n&&(i.spheres.push(r),t||Xe.g.to(r.shapes,.85,{radius:a,ease:Xe.a.easeOut})),r},i.createPair=function(e,t){var n=i.createSphere([0,0,0],!1,!1),a=i.createSphere(e,t,!0);return i.world.add({type:"jointDistance",body1:n.id,body2:a.id,spring:[.8,.05]},i.radius.min,i.radius.max),{sphereInteractive:a}},i.onStateChanged=function(e){switch(e.sceneStep){case De.A:i.pause=!1,i.state=e,i.hitbox.setActive(!1);break;case De.E:i.state=e,Xe.g.to(i.interactiveSpherePosition,3,{z:5});break;case De.y:i.state=e,i.hitbox.setActive(!0);break;case De.z:i.state=e,i.hitbox.on("start",i.onHitboxStart);break;case De.F:i.hitbox.off("start",i.onHitboxStart),i.hitbox.setActive(!1),i.transitionOut()}},i.reset=function(){i.hitbox.off("start",i.onHitboxStart),i.hitbox.setActive(!1);for(var e=0;e<i.spheres.length;e++)i.sizeBuffer[e]=0,i.positionBuffer[3*e]=1e4,i.positionBuffer[3*e+1]=1e4,i.positionBuffer[3*e+2]=1e4;i.spheres.forEach((function(e){e.dispose()})),i.world.clear(),i.spheres=[],i.pairs=[];for(var t=0;t<1;t++)i.createSphere([0,0,0],!0,!0);i.interactionIndex=0,i.count=0,i.clickIndex=3},i.explode=function(e){i.spherePosition=e;var t=i.spawnIncrements[i.interactionIndex]-i.count;i.interactionIndex++,i.count+=t,i.burstSphere();var n=new Va(t,15);n.on("emit",i.onSpawnSphere),n.start(),i.emitters.push(n),i.hitbox.setActive(!0)},i.transitionOut=function(){i.pause=!0,i.addVelocity(4.5),i.world.step();for(var e=Object(C.a)(i.positionBuffer),t=new Array(3*i.totalInstances),n=0;n<i.spheres.length;n++){Math.abs(i.spheres[n].linearVelocity.x)>35&&(i.spheres[n].linearVelocity.x=35*Math.sign(i.spheres[n].linearVelocity.x)),Math.abs(i.spheres[n].linearVelocity.y)>35&&(i.spheres[n].linearVelocity.y=35*Math.sign(i.spheres[n].linearVelocity.y)),Math.abs(i.spheres[n].linearVelocity.z)>35&&(i.spheres[n].linearVelocity.z=35*Math.sign(i.spheres[n].linearVelocity.z));var a=i.spheres[n].getPosition();t[3*n]=a.x,t[3*n+1]=a.y,t[3*n+2]=a.z}var o={value:0},r=0;Xe.g.to(o,7,{value:1,ease:Xe.e.easeOut,onUpdate:function(){for(var n=0;n<i.spheres.length;n++)r=3*n,i.positionBuffer[r]=en.f.lerp(e[r],t[r],o.value),i.positionBuffer[r+1]=en.f.lerp(e[r+1],t[r+1],o.value),i.positionBuffer[r+2]=en.f.lerp(e[r+2],t[r+2],o.value)}})},i.burstSphere=function(){var e=i.spheres[0].shapes,t=e.radius,n=1.8*e.radius,a=.1*e.radius,o={value:0};Xe.g.to(o,.5,{value:1,ease:Xe.f.easeInOut,onUpdate:function(){var i=0,r=1;o.value<.25?(i=Object(en.g)(o.value,0,.25),r=en.f.lerp(t,n,i)):(i=Object(en.g)(o.value,.25,1),r=en.f.lerp(n,a,i)),e.radius=r},onComplete:function(){i.spheres[0].setPosition({x:100,y:100,z:100}),i.spheres[0].shapes.radius=1.5;var e=i.interactionIndex/i.spawnIncrements.length;i.addVelocity(en.f.lerp(.01,.35,e)),i.interactionIndex===i.spawnIncrements.length?i.emit("complete"):i.respawnSphere()}})},i.respawnSphere=function(){i.spheres[0].setPosition({x:0,y:0,z:0});var e=i.spheres[0].shapes,t=en.f.lerp(4,5,Math.random());Xe.g.to(e,.75,{radius:t,ease:Xe.a.easeOut,onComplete:function(){i.emit("respawnSphere")}})},i.onSpawnSphere=function(){Ba.fromArray(i.spherePosition),Ba.x+=en.f.lerp(-5,5,Math.random()),Ba.y+=en.f.lerp(-5,5,Math.random()),Ba.z+=en.f.lerp(-5,5,Math.random());i.createPair(Ba.toArray(),!1).sphereInteractive.applyImpulse(Qa,new Ie.Qb(en.f.lerp(-.1,.1,Math.random()),en.f.lerp(-.1,.1,Math.random()),en.f.lerp(-.1,.1,Math.random())))},i.update=function(){if(!i.pause&&void 0!==i.state)if(i.state.sceneStep===De.A)for(var e=0;e<i.spheres.length;e++){var t=i.spheres[e].getPosition();i.sizeBuffer[e]=i.spheres[e].shapes.radius,i.positionBuffer[3*e]=t.x,i.positionBuffer[3*e+1]=t.y,i.positionBuffer[3*e+2]=t.z}else{if(i.world.step(),Ya.a.update(),i.state.sceneStep!==De.A&&i.state.sceneStep!==De.F&&i.state.sceneStep!==De.z){i.positionMotionEase.update();var n=en.f.lerp(-i.positionRange.x,i.positionRange.x,i.positionMotionEase.value.x),a=en.f.lerp(i.positionRange.y,-i.positionRange.y,i.positionMotionEase.value.y);i.interactiveSpherePosition.x=n,i.interactiveSpherePosition.y=a,i.spheres[0].setPosition(i.interactiveSpherePosition)}for(var o=0;o<i.spheres.length;o++){Math.abs(i.spheres[o].linearVelocity.x)>35&&(i.spheres[o].linearVelocity.x=35*Math.sign(i.spheres[o].linearVelocity.x)),Math.abs(i.spheres[o].linearVelocity.y)>35&&(i.spheres[o].linearVelocity.y=35*Math.sign(i.spheres[o].linearVelocity.y)),Math.abs(i.spheres[o].linearVelocity.z)>35&&(i.spheres[o].linearVelocity.z=35*Math.sign(i.spheres[o].linearVelocity.z));var r=i.spheres[o].getPosition();i.sizeBuffer[o]=i.spheres[o].shapes.radius,i.positionBuffer[3*o]=r.x,i.positionBuffer[3*o+1]=r.y,i.positionBuffer[3*o+2]=r.z}}},i.resize=function(){var e=Object(St.d)(i.camera.projectionMatrix,i.camera.aspect,i.camera.position.distanceTo(i.hitbox.mesh.position)),t=e.scaleX,n=e.scaleY;i.hitbox.mesh.scale.set(5*t,5*n,1)},i.dispose=function(){i.hitbox.off("move",i.onHitboxMove),i.spheres.forEach((function(e){e.dispose()}))},i.gui=o.addFolder("physics"),i.gui.open(),i.group=new Ie.F,i.camera=a,i.totalInstances=e,i.spawnIncrements=n,i.spherePosition=new Ie.Qb,i.count=0,i.interactionIndex=0,i.world=new Xa.a({timestep:1/60,iterations:8,broadphase:2,worldscale:1,random:!0,info:!1,gravity:[0,0,0]}),i.radius={min:2,max:100},i.spheres=[],i.positionBuffer=new Float32Array(3*e),i.sizeBuffer=new Float32Array(e),i.emitters=[],i.positionMotionEase=new kn.a,i.positionMotionEase.newValue.set(.5,.5),i.positionMotionEase.value.set(.5,.5,!1),i.positionMotionEase.easing=.05,i.positionRange=new Ie.Pb(10,15),i.interactiveSpherePosition=new Ie.Qb(0,0,0);i.gui.add(i.positionRange,"x",0,20).name("positionRange x"),i.gui.add(i.positionRange,"y",0,20).name("positionRange y"),i.gui.add(i.positionMotionEase,"easing",0,1).name("rotation easing"),i.createHitbox(a),i.createBall(),i.clickIndex=3;for(var r=0;r<i.positionBuffer.length;r++)i.positionBuffer[r]=r<3?0:5e3;for(var s=0;s<1;s++)i.createSphere([0,0,0],!0,!0);return Ya.a.on("update",i.onMotionUpdate),o.add(Object(_e.a)(i),"pause"),o.add(Object(_e.a)(i),"export"),i}return Object(he.a)(t,e),t}(Ce.a),Ga=n(55),Wa=n.n(Ga),Za={spotColor:16777215,gradientX:15991004,gradientY:15466398,gradientZ:14079743},qa={softFresnelPow:{value:2.5},softSpot:{value:new Ie.o(Za.spotColor)},gradientX:{value:new Ie.o(Za.gradientX)},gradientY:{value:new Ie.o(Za.gradientY)},gradientZ:{value:new Ie.o(Za.gradientZ)}},Ka="\n  uniform vec3 softSpot;\n  uniform float softFresnelPow;\n",$a="\n  vec3 normal = normalize( vNormal );\n  normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n  vec3 lightPos = vec3(1);\n  float lambert =  max(dot(normal, lightPos) * 0.5 + 0.5, 0.0);\n\n  vec3 eye = cameraPosition - vWorldPosition.xyz;\n\n  float cosTheta = abs(dot(normalize(eye), vNormal));\n  float fresnel = pow(cosTheta, softFresnelPow);\n  vec2 gradientXY = (normalize(vPosition) * 0.5 + 0.5).xy;\n  vec3 gradientColor = mix(gradientX, gradientY, gradientXY.x);\n  gradientColor = mix(gradientColor, gradientZ, gradientXY.y);\n  gl_FragColor.rgb = mix(gradientColor * 0.8 , gradientColor * 1.1, lambert);\n  // gl_FragColor.rgb = mix(gradientColor, softSpot, fresnel);\n  // gl_FragColor.rgb = vec3(1.0) * lambert;\n  gl_FragColor.a = 1.0;\n",Ja=("\n  ".concat(ca(!1),"\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!1),"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n"),"\n  ".concat(la(!1),"\n  ").concat(Ka,"\n  varying vec3 vPosition;\n  void main() {\n    float maxShadow = 0.0;\n    ").concat($a,"\n    ").concat(da,"\n  }\n"),{reflectiveFresnelPow:{value:2.1},reflectiveFresnelPow1:{value:.4}}),eo=("\n  ".concat(ca(!1),"\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!1),"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);;\n  }\n"),"\n  uniform float reflectiveFresnelPow;\n  uniform float reflectiveFresnelPow1;\n"),to="\n  vec3 normal = normalize( vNormal );\n  normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n  vec3 eye = cameraPosition - vWorldPosition.xyz;\n\n  float cosTheta = abs(dot(normalize(eye), normal));\n  float fresnel = pow(cosTheta, reflectiveFresnelPow);\n  float fresnel1 = pow(cosTheta, reflectiveFresnelPow1);\n\n  // vec3 gradientColor = vec3(normalize(vPosition).xy * 0.5 + 0.5, 1.0);\n  vec2 gradientXY = (normalize(vPosition) * 0.5 + 0.5).xy;\n  vec3 gradientColor = mix(gradientX, gradientY, gradientXY.x);\n  gradientColor = mix(gradientColor, gradientZ, gradientXY.y);\n\n  vec3 envMapColor = textureCube(envMap, vec3(vReflect.x, vReflect.yz)).rgb;\n\n  float reflectivity = calculateReflectivity(normal);\n  envMapColor *= reflectivity;\n\n  envMapColor = mix(envMapColor, vec3(1), 0.55);\n\n  vec3 outgoingColor = mix(gradientColor * 1.25, envMapColor, (1.0 - fresnel));\n  gl_FragColor = vec4(outgoingColor, fresnel1);\n",no=("\n  ".concat(la(!1),"\n  ").concat(eo,"\n  varying vec3 vPosition;\n  void main() {\n    float maxShadow = 0.0;\n    ").concat(to,"\n    ").concat(da,"\n  }\n"),{spotColor:16777215,gradientX:16711725,gradientY:5308671}),ao={glowFresnelPow:{value:.53},glowSpot:{value:new Ie.o(no.spotColor)},gradientX:{value:new Ie.o(no.gradientX)},gradientY:{value:new Ie.o(no.gradientY)}},oo=("\n  ".concat(ca(!1),"\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!1),"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n"),"\n  uniform vec3 glowSpot;\n  uniform float glowFresnelPow;\n"),io="\n  vec3 normal = normalize( vNormal );\n  normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n  vec3 eye = cameraPosition - vWorldPosition.xyz;\n\n  float cosTheta = abs(dot(normalize(eye), normal));\n  float fresnel = pow(cosTheta, glowFresnelPow);\n  vec2 gradientXY = (normalize(vPosition)).xy;\n  vec3 gradientColor = mix(gradientX, gradientY, gradientXY.x);\n\n  vec3 envMapColor = textureCube(envMap, vec3(vReflect.x, vReflect.yz)).rgb;\n\n  float reflectivity = calculateReflectivity(normal);\n  envMapColor = mix(gradientColor, envMapColor, reflectivity);\n  envMapColor = mix(envMapColor, vec3(1), 0.55);\n\n  gradientColor = mix(gradientColor, envMapColor, fresnel * 1.25);\n\n  gl_FragColor.rgb = mix(gradientColor, glowSpot, 1.0 - fresnel);\n  gl_FragColor.a = pow((1.0 - fresnel), 0.675);\n",ro=("\n  ".concat(la(!1),"\n  ").concat(oo,"\n  varying vec3 vPosition;\n  void main() {\n    float maxShadow = 0.0;\n    ").concat(io,"\n    ").concat(da,"\n  }\n"),"\n  ".concat(ca(!0),"\n  ").concat(ma,"\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!0),"\n    ").concat(pa(!0),"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * matrix * vec4(position, 1.0);\n  }\n")),so="\n  ".concat(la(!0),"\n  ").concat(Ka,"\n  ").concat(eo,"\n  ").concat(ga,"\n  ").concat(oo,"\n  varying vec3 vPosition;\n\n  void main() {\n    float maxShadow = 1.0;\n    if (materialId >= 0.0 && materialId < 0.9) {\n      ").concat($a,"\n      maxShadow = ").concat(.25,";\n    } else if(materialId >= 0.9 && materialId < 1.9) {\n      ").concat(to,"\n      maxShadow = ").concat(.085,";\n    } else if(materialId >= 1.9 && materialId < 2.9) {\n      ").concat(ba,"\n      maxShadow = ").concat(.08,";\n    } else if(materialId >= 2.9) {\n      ").concat(io,"\n      maxShadow = ").concat(.055,";\n    }\n    ").concat(da,"\n  }\n"),co={uniforms:Ie.Ab.depth.uniforms,vertexShader:"\n    attribute vec3 mcol0;\n    attribute vec3 mcol1;\n    attribute vec3 mcol2;\n    attribute vec3 mcol3;\n\n    #include <common>\n    #include <uv_pars_vertex>\n    #include <displacementmap_pars_vertex>\n    #include <morphtarget_pars_vertex>\n    #include <skinning_pars_vertex>\n    #include <logdepthbuf_pars_vertex>\n    #include <clipping_planes_pars_vertex>\n    void main() {\n      #include <uv_vertex>\n      #include <skinbase_vertex>\n      #ifdef USE_DISPLACEMENTMAP\n        #include <beginnormal_vertex>\n        #include <morphnormal_vertex>\n        #include <skinnormal_vertex>\n      #endif\n      #include <begin_vertex>\n\n      mat4 matrix = mat4(\n        vec4(mcol0, 0),\n        vec4(mcol1, 0),\n        vec4(mcol2, 0),\n        vec4(mcol3, 1)\n      );\n      transformed = (matrix * vec4(position, 1.0)).xyz;\n\n      #include <morphtarget_vertex>\n      #include <skinning_vertex>\n      #include <displacementmap_vertex>\n      #include <project_vertex>\n      #include <logdepthbuf_vertex>\n      #include <clipping_planes_vertex>\n\t\t\t\t}\n  ",fragmentShader:Ie.zb.depth_frag},lo=(new Ie.hb,new Ie.V),uo=(new Ie.o,lo.elements,{brightness:.6,saturation:.7}),ho=new Ie.hb,fo=new Ie.V,mo=fo.elements,po=new Ie.o,vo=function(e){function t(e,n){var a,o;Object(c.a)(this,t),(o=Object(ue.a)(this,Object(de.a)(t).call(this))).onStateChanged=function(e){switch(e.sceneStep){case De.y:o.hitbox.setActive(!0)}},o.reset=function(){o.gradientIndex=0},o.envMapRender=function(e,t){t?(o.mesh.material.uniforms.shadowEnabled.value=e?0:1,o.aVisible.setX(0,e?0:1),o.aVisible.needsUpdate=!0):o.mesh.visible=!e},o.onInteractiveMeshClick=function(e){o.emit("click",e.object.position.toArray()),o.hitbox.setActive(!1),jn.a.play(De.C,Ft.r[o.gradientIndex]),0===o.gradientIndex&&jn.a.play(De.C,Ft.q),o.gradientIndex++,o.setGradient(o.gradients[o.gradientIndex%o.gradients.length])},o.setGradient=function(e){var t=o.getGradient(o.aGradientX,0),n=o.getGradient(o.aGradientY,0),a=o.getGradient(o.aGradientZ,0);o.colors.to[0].setHex(e[0]),o.colors.to[1].setHex(e[1]),o.colors.to[2].setHex(e[2]),o.tween=0,Xe.g.killTweensOf(Object(_e.a)(o)),Xe.g.to(Object(_e.a)(o),.75,{tween:1,delay:.25,ease:Xe.a.easeOut,onUpdate:function(){o.colors.tween[0].setHex(t).lerp(o.colors.to[0],o.tween),o.colors.tween[1].setHex(n).lerp(o.colors.to[1],o.tween),o.colors.tween[2].setHex(a).lerp(o.colors.to[2],o.tween),o.aGradientX.setXYZ(0,o.colors.tween[0].r,o.colors.tween[0].g,o.colors.tween[0].b),o.aGradientY.setXYZ(0,o.colors.tween[1].r,o.colors.tween[1].g,o.colors.tween[1].b),o.aGradientZ.setXYZ(0,o.colors.tween[2].r,o.colors.tween[2].g,o.colors.tween[2].b),o.aGradientX.needsUpdate=!0,o.aGradientY.needsUpdate=!0,o.aGradientZ.needsUpdate=!0}})},o.getGradient=function(e,t){var n=e.getX(0),a=e.getY(0),o=e.getZ(0);return po.setRGB(n,a,o),po.getHex()},o.onSphereRespawn=function(){o.hitbox.setActive(!0)},o.update=function(e,t,n){o.mesh.material.uniforms.time.value+=e,o.interactiveMesh.position.set(t.positionBuffer[0],t.positionBuffer[1],t.positionBuffer[2]),o.interactiveMesh.scale.set(t.sizeBuffer[0],t.sizeBuffer[0],t.sizeBuffer[0]);for(var a=0,i=0;i<o.totalInstances;i++){a=3*i;var r=t.sizeBuffer[i]||.1,s=t.positionBuffer[a]||0,c=t.positionBuffer[a+1]||0,l=t.positionBuffer[a+2]||0;ho.position.set(s,c,l),ho.scale.set(r,r,r),ho.updateMatrix(),fo.copy(ho.matrix),o.mcol0.setXYZ(i,mo[0],mo[1],mo[2]),o.mcol1.setXYZ(i,mo[4],mo[5],mo[6]),o.mcol2.setXYZ(i,mo[8],mo[9],mo[10]),o.mcol3.setXYZ(i,mo[12],mo[13],mo[14])}o.mesh.geometry.attributes.mcol0.needsUpdate=!0,o.mesh.geometry.attributes.mcol1.needsUpdate=!0,o.mesh.geometry.attributes.mcol2.needsUpdate=!0,o.mesh.geometry.attributes.mcol3.needsUpdate=!0},o.dispose=function(){},o.group=new Ie.F,o.totalInstances=e,o.config=uo;var i=(a={},Object(p.a)(a,De.q,[28,20]),Object(p.a)(a,De.r,[24,16]),a)[Object(De.K)()],r=(new Ie.J).copy(new Ie.Eb(1,i[0],i[1]));r.maxInstancedCount=e,o.mcol0=new Ie.I(new Float32Array(3*e),3),o.mcol1=new Ie.I(new Float32Array(3*e),3),o.mcol2=new Ie.I(new Float32Array(3*e),3),o.mcol3=new Ie.I(new Float32Array(3*e),3),o.aGradientX=new Ie.I(new Float32Array(3*o.totalInstances),3),o.aGradientY=new Ie.I(new Float32Array(3*o.totalInstances),3),o.aGradientZ=new Ie.I(new Float32Array(3*o.totalInstances),3),o.aMaterialId=new Ie.I(new Float32Array(o.totalInstances),1),o.aVisible=new Ie.I(new Uint8Array(o.totalInstances),1);for(var s=Object(C.a)(De.a),l=0;l<e;l++){var u=Object(en.h)(0,0,0,10),d=u.x,h=u.y,f=u.z;ho.position.set(d,h,f),ho.updateMatrix(),fo.copy(ho.matrix),o.mcol0.setXYZ(l,mo[0],mo[1],mo[2]),o.mcol1.setXYZ(l,mo[4],mo[5],mo[6]),o.mcol2.setXYZ(l,mo[8],mo[9],mo[10]),o.mcol3.setXYZ(l,mo[12],mo[13],mo[14]),Wa()(s),po.setHex(s[0]),o.aGradientX.setXYZ(l,po.r,po.g,po.b),po.setHex(s[1]),o.aGradientY.setXYZ(l,po.r,po.g,po.b),po.setHex(s[2]),o.aGradientZ.setXYZ(l,po.r,po.g,po.b),o.aMaterialId.setX(l,0===l?3:en.f.randInt(0,3)),o.aVisible.setX(l,1)}r.addAttribute("mcol0",o.mcol0),r.addAttribute("mcol1",o.mcol1),r.addAttribute("mcol2",o.mcol2),r.addAttribute("mcol3",o.mcol3),r.addAttribute("aGradientX",o.aGradientX),r.addAttribute("aGradientY",o.aGradientY),r.addAttribute("aGradientZ",o.aGradientZ),r.addAttribute("aMaterialId",o.aMaterialId),r.addAttribute("aVisible",o.aVisible);var m=new Ie.Bb({uniforms:Object(St.b)(sa,qa,Ja,fa,ao),vertexShader:ro,fragmentShader:so,transparent:!0,side:Ie.C,shadowSide:Ie.v,lights:!0,fog:!0});Object.assign(m.uniforms,Ie.Mb.fog);var v=new Ie.Bb({defines:{DEPTH_PACKING:Ie.tb},uniforms:Ie.Nb.clone(co.uniforms),vertexShader:co.vertexShader,fragmentShader:co.fragmentShader});return o.mesh=new Ie.W(r,m),o.mesh.castShadow=!0,o.mesh.receiveShadow=!0,o.mesh.customDepthMaterial=v,o.mesh.frustumCulled=!1,o.group.add(o.mesh),o.interactiveMesh=new Ie.W(new Ie.Eb(1,6,6),new Ie.X({side:Ie.C,wireframe:!1,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1})),o.group.add(o.interactiveMesh),o.hitbox=new za(n,o.interactiveMesh),o.hitbox.on("start",o.onInteractiveMeshClick),o.colors={tween:[new Ie.o,new Ie.o,new Ie.o],to:[new Ie.o,new Ie.o,new Ie.o]},o.gradients=[[De.f,De.n,De.c],[De.m,De.c,De.f],[De.n,De.f,De.g],[De.e,De.o,De.n]],o.gradientIndex=0,o.setGradient(o.gradients[0]),o}return Object(he.a)(t,e),t}(Ce.a);"\n  ".concat(ca(!1),"\n  ").concat(ma,"\n  void main() {\n    ").concat(ua(!1),"\n    ").concat(pa(!1),"\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n"),"\n  ".concat(la(!1),"\n  ").concat(Ka,"\n  ").concat(eo,"\n  ").concat(ga,"\n  ").concat(oo,"\n  void main() {\n    // In case the materialId uniform isn't set\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    if (materialId == 0.0) {\n      ").concat($a,"\n    } else if(materialId == 1.0) {\n      ").concat(to,"\n    } else if(materialId == 2.0) {\n      ").concat(ba,"\n    } else if(materialId == 3.0) {\n      ").concat(io,"\n    }\n    ").concat(da,"\n  }\n");new Ie.Eb(1,32,32),Ce.a,new Ie.Eb(1,8,8),"\n  varying vec3 vPosition;\n  ".concat(Ie.zb.shadowmap_pars_vertex,"\n  void main() {\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    ").concat(Ie.zb.shadowmap_vertex,"\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * worldPosition;\n  }\n"),"\n  varying vec3 vPosition;\n  ".concat(Ie.zb.common,"\n  ").concat(Ie.zb.packing,"\n  ").concat(Ie.zb.bsdfs,"\n  ").concat(Ie.zb.lights_pars_begin,"\n  ").concat(Ie.zb.shadowmap_pars_fragment,"\n  ").concat(Ie.zb.shadowmask_pars_fragment,"\n\n  void main() {\n    float shadow = getShadowMask();\n    vec3 color = vec3(normalize(vPosition).xy * 0.5 + 0.5, 1.0);\n    color += (shadow * 0.25);\n    gl_FragColor = vec4(color, 1.0);\n  }\n");var go=function e(t){var n=this;Object(c.a)(this,e),this.gui=t.addFolder("fog"),this.config={color:9411071,density:.02,near:.1,far:10},this.fog=new Ie.B(this.config.color,this.config.near,this.config.far),this.gui.add(this.fog,"near",0,100),this.gui.add(this.fog,"far",0,100),this.gui.addColor(this.config,"color").onChange((function(e){n.fog.color.setHex(e)}))},bo=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(ue.a)(this,Object(de.a)(t).call(this,{id:De.C,assets:Rt,gui:!0,guiOpen:!0}))).createObjects=function(){return new Promise((function(t,n){try{var a;e.lights=new Ra,e.lights.get().forEach((function(t){e.scene.add(t)})),e.lights.gui(e.gui),Object.keys(on).forEach((function(t){cn.addTransition(t,on[t],e.scene,e.camera)})),e.background=new Da(e.gui),e.scene.add(e.background.mesh);var o=[3,47,100,150],i=(a={},Object(p.a)(a,De.q,{spawnIncrements:o,totalInstances:300}),Object(p.a)(a,De.r,{spawnIncrements:o,totalInstances:300}),a);e.reflectionsEnabled=ee.a.isDesktop&&Object(De.K)()===De.q,e.cameras={cube0:new Ie.p(1,1e3,128),cube1:new Ie.p(1,1e3,128)},e.cameras.cube0.renderTarget.texture.generateMipmaps=!0,e.cameras.cube0.renderTarget.texture.minFilter=Ie.O,e.cameras.cube1.renderTarget.texture.generateMipmaps=!0,e.cameras.cube1.renderTarget.texture.minFilter=Ie.O,e.count=0;var r=i[Object(De.K)()];e.physics=new Ha(r.totalInstances,r.spawnIncrements,e.camera,e.gui),e.scene.add(e.physics.group),e.spheres=new vo(r.totalInstances,e.camera),e.scene.add(e.spheres.group),e.physics.on("respawnSphere",e.spheres.onSphereRespawn),e.spheres.on("click",e.onInteractionProgress),e.physics.on("complete",e.onInteractionComplete),e.fog=new go(e.gui),e.scene.fog=e.fog.fog,e.camera.fov=75,e.camera.updateProjectionMatrix(),e.ready=!0,t()}catch(s){n(s)}}))},e.setState=function(t){e.emit("sceneStep",t)},e.onStateChanged=function(t){switch(e.state=t,e.state.route===v.k.Present&&na.b.setCamera(e.camera),e.state.sceneStep){case De.A:jn.a.play(De.C,Ft.p),e.spheres.onStateChanged(e.state),e.physics.onStateChanged(e.state),cn.setTransition("PRESENT_SCENE_INTRO",e.camera),cn.transition(3),ka.setBlur(1),ka.setDof(1),ka.setTint(De.u,!0,De.t,0,De.l);break;case De.E:e.spheres.onStateChanged(e.state),e.physics.onStateChanged(e.state),cn.once("transitionComplete",e.onTransitionComplete),cn.setTransition("PRESENT_TRANSITION_IN",e.camera),cn.transition(1),ka.setBlur(0,!0,1),ka.setDof(1,!0,1),ka.setTint(0,!0,De.t);break;case De.y:cn.setCameraPositionFromTransition("PRESENT_TRANSITION_IN",e.camera),e.spheres.once("click",e.onInteractionStarted),e.spheres.onStateChanged(e.state),e.physics.onStateChanged(e.state);var n=e.camera.position.length(),a=ee.a.isDesktop?30:15,o=ee.a.isDesktop?8:6;na.b.setConfig(new na.a(a,o,.115,.7*n,n)),na.b.setActive(!0),ka.setDof(1);break;case De.z:e.spheres.onStateChanged(e.state),e.physics.onStateChanged(e.state);break;case De.F:Object(Me.g)(!1),e.spheres.onStateChanged(e.state),e.physics.onStateChanged(e.state),na.b.setActive(!1),on.PRESENT_TRANSITION_OUT.origin[0].x=e.camera.position.x,on.PRESENT_TRANSITION_OUT.origin[0].y=e.camera.position.y,on.PRESENT_TRANSITION_OUT.origin[0].z=e.camera.position.z;var i=(new Ie.Qb).lerpVectors(e.camera.position,en.e,.75);on.PRESENT_TRANSITION_OUT.origin[1].x=i.x,on.PRESENT_TRANSITION_OUT.origin[1].y=i.y,on.PRESENT_TRANSITION_OUT.origin[1].z=i.z,cn.addTransition("PRESENT_TRANSITION_OUT",on.PRESENT_TRANSITION_OUT,e.scene,e.camera),cn.once("transitionComplete",e.onTransitionComplete),cn.setTransition("PRESENT_TRANSITION_OUT",e.camera),cn.transition(4,Xe.d.easeInOut),ka.setDof(0,!0,2),ka.setBlur(1,!0,2),Xe.g.delayedCall(2.5,(function(){jn.a.stop(De.C,Ft.p),jn.a.stop(De.C,Ft.q),e.emit("complete")}))}},e.onInteractionProgress=function(t){e.physics.explode(t);var n=e.physics.getProgress();e.animateProgress(n.from,n.to)},e.onInteractionStarted=function(){e.emit("interactionStarted")},e.onInteractionComplete=function(){e.setState(new Zt({step:De.z}))},e.animateProgress=function(t,n){var a={value:t};Xe.g.to(a,1,{value:n,onUpdate:function(){e.emit("interactionProgress",a.value)},onComplete:function(){1===n&&e.emit("interactionProgress",1)}})},e.captureScreenShot=function(e){na.b.captureScreenShot(e)},e.onTransitionComplete=function(){switch(e.state.sceneStep){case De.E:e.setState(new Zt({step:De.y}));break;case De.F:e.emit("complete"),Xe.g.delayedCall(2,(function(){e.spheres.reset(),e.physics.reset(),e.spheres.update(0,e.physics,e.camera)}))}},e.resize=function(t,n){e.camera.aspect=t/n,e.camera.updateProjectionMatrix(),e.lights.resize(),e.physics.resize()},e.update=function(t){e.ready&&(e.lights.update(),na.b.update(),e.spheres.envMapRender(!0,e.reflectionsEnabled),e.count%2===0?(e.spheres.mesh.material.uniforms.envMap.value=e.cameras.cube0.renderTarget.texture,e.cameras.cube1.update(Me.b,e.scene)):(e.spheres.mesh.material.uniforms.envMap.value=e.cameras.cube1.renderTarget.texture,e.cameras.cube0.update(Me.b,e.scene)),e.spheres.envMapRender(!1,e.reflectionsEnabled),e.count++,e.physics.update(),e.spheres.update(t,e.physics,e.camera))},e.dispose=function(){for(var t=Object(C.a)(e.scene.children),n=0;n<t.length;n++)Object(St.c)(t[n],e.scene);e.physics.dispose(),e.spheres.dispose(),Tt.a.dispose(De.C)},e.ready=!1,e}return Object(he.a)(t,e),t}(Wt),xo=function(){function e(){Object(c.a)(this,e),this.ambient=new ze({ambient:15792892,intensity:.7}),this.directional=new Ye({intensity:.6}),this.directional.light.castShadow=!0,this.directional.light.shadow.mapSize.width=1024,this.directional.light.shadow.mapSize.height=1024,this.directional.light.shadow.camera.near=1,this.directional.light.shadow.camera.far=1e3,this.directional.light.shadow.camera.right=15,this.directional.light.shadow.camera.left=-15,this.directional.light.shadow.camera.top=15,this.directional.light.shadow.camera.bottom=-15,this.directional.light.shadow.bias=-9e-4,this.directional.light.position.set(-25.46,-.32,11.11)}return Object(le.a)(e,[{key:"gui",value:function(e){var t=e.addFolder("lights");t.open(),this.ambient.gui(t),this.directional.gui(t),this.directional.gui.add(this.directional.light.shadow,"bias",-.01,0).step(1e-4)}},{key:"update",value:function(){}},{key:"get",value:function(){return[this.ambient.light,this.directional.light]}},{key:"dispose",value:function(e){this.get().forEach((function(e){e.dispose()}))}}]),e}(),yo="\n  uniform float time;\n  varying vec3 vNormal;\n  varying vec3 vEye;\n  varying vec3 vPosition;\n  ".concat(ma,"\n\n  void main() {\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n    vNormal = normalize(mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal);\n    vEye = cameraPosition - worldPosition.xyz;\n    vPosition = rotate(position, normalize(worldPosition).xyz, time * iridescentSpeed);\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n"),wo="\n  uniform float time;\n  uniform vec3 gradientX;\n  uniform vec3 gradientY;\n  uniform vec3 gradientZ;\n  uniform float transition;\n  varying vec3 vNormal;\n  varying vec3 vEye;\n  varying vec3 vPosition;\n  ".concat(ga,"\n\n  void main() {\n    vec3 normal = normalize( vNormal );\n    normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n    float cosTheta = abs(dot(normalize(vEye), normal));\n    float fresnel = pow(cosTheta, iridescentFresnelPow);\n\n    float newTime = time * iridescentSpeed;\n    vec2 p = (normalize(vPosition) * 0.5 + 0.5).xy;\n    rot(p, newTime / iridescentVal2.x);\t// slow field rotation\n\n    float s = 1.0;\n    vec4 color = vec4(0);\n    B B B B // unrolled perlin noise see https://www.shadertoy.com/view/lt3GWn\n    color += sin(iridescentVal.x * sin(color * iridescentVal.y + newTime * iridescentVal.z) + p.yxyy-p.yyxy * iridescentVal.w) / iridescentVal2.y; // colour transform\n    vec3 outgoingColor = vec3(0.0, 0.0, 0.0);\n    outgoingColor.rgb = mix(gradientX, gradientY, pow(color.g, 2.0));\n    vec3 gradientColor = gradientX;\n    gradientColor = mix(gradientColor, gradientY, color.g);\n    gradientColor = mix(gradientColor, gradientZ, color.b);\n\n    outgoingColor = mix(vec3(0.0), gradientColor.rgb, fresnel);\n    outgoingColor = mix(vec3(1), outgoingColor, transition);\n\n    gl_FragColor = vec4(outgoingColor, 1.0);\n\n    // gl_FragColor = vec4(1.0);\n  }\n"),Ao=function(){function e(t,n){var a,o=this;Object(c.a)(this,e),this.onUpdate=function(){o.material.color.setHex(Number("".concat(o.settings.color).replace("#","0x")))},this.gui=t.addFolder("background"),this.tween=0,this.index=-1,this.gradients=[{gradientX:new Ie.o(De.e),gradientY:new Ie.o(De.o),gradientZ:new Ie.o(De.n)},{gradientX:new Ie.o(De.h),gradientY:new Ie.o(De.c),gradientZ:new Ie.o(De.f)},{gradientX:new Ie.o(De.n),gradientY:new Ie.o(De.f),gradientZ:new Ie.o(De.g)}],this.config={gradientX:this.gradients[0].gradientX.clone(),gradientY:this.gradients[0].gradientY.clone(),gradientZ:this.gradients[0].gradientZ.clone()},this.colors={gradientX:new Ie.o,gradientY:new Ie.o,gradientZ:new Ie.o},this.material=new Ie.Bb({uniforms:{time:{value:0},iridescentSpeed:{value:.97},iridescentFresnelPow:{value:.66},gradientX:{value:this.config.gradientX},gradientY:{value:this.config.gradientY},gradientZ:{value:this.config.gradientZ},iridescentVal:{value:new Ie.Rb(.6,22,2,1.97)},iridescentVal2:{value:new Ie.Pb(6.5,2.7)},transition:{value:n===De.w?1:0}},vertexShader:yo,fragmentShader:wo,depthWrite:!1,side:Ie.e});var i=(a={},Object(p.a)(a,De.q,[32,16]),Object(p.a)(a,De.r,[18,8]),a)[Object(De.K)()];this.mesh=new Ie.W(new Ie.Eb(150,i[0],i[1]),this.material),this.gui.add(this.material.uniforms.iridescentSpeed,"value",0,2).name("iridescentSpeed"),this.gui.add(this.material.uniforms.iridescentFresnelPow,"value",0,10).name("iridescentFresnelPow"),this.gui.addColor(this.config,"gradientX").onChange((function(e){o.material.uniforms.gradientX.value.setHex(e)})),this.gui.addColor(this.config,"gradientY").onChange((function(e){o.material.uniforms.gradientY.value.setHex(e)})),this.gui.addColor(this.config,"gradientZ").onChange((function(e){o.material.uniforms.gradientZ.value.setHex(e)})),this.gui.add(this.material.uniforms.iridescentVal.value,"x",0,30),this.gui.add(this.material.uniforms.iridescentVal.value,"y",0,30),this.gui.add(this.material.uniforms.iridescentVal.value,"z",0,30),this.gui.add(this.material.uniforms.iridescentVal.value,"w",0,30),this.gui.add(this.material.uniforms.iridescentVal2.value,"x",0,1),this.gui.add(this.material.uniforms.iridescentVal2.value,"y",0,30),this.gui.add(this.mesh.position,"z",-100,100),this.gui.add(this.mesh.rotation,"y",0,2*Math.PI)}return Object(le.a)(e,[{key:"setGradient",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.index!==e){this.index=e;var a=this.material.uniforms.gradientX.value.getHex(),o=this.material.uniforms.gradientY.value.getHex(),i=this.material.uniforms.gradientZ.value.getHex();this.tween=0,Xe.g.killTweensOf(this),n?Xe.g.to(this,2.9,{tween:1,onUpdate:function(){t.colors.gradientX.setHex(a).lerp(t.gradients[e].gradientX,t.tween),t.colors.gradientY.setHex(o).lerp(t.gradients[e].gradientY,t.tween),t.colors.gradientZ.setHex(i).lerp(t.gradients[e].gradientZ,t.tween),t.mesh.material.uniforms.gradientX.value.copy(t.colors.gradientX),t.mesh.material.uniforms.gradientY.value.copy(t.colors.gradientY),t.mesh.material.uniforms.gradientZ.value.copy(t.colors.gradientZ)}}):(this.mesh.material.uniforms.gradientX.value.setHex(this.gradients[e].gradientX.getHex()),this.mesh.material.uniforms.gradientY.value.setHex(this.gradients[e].gradientY.getHex()),this.mesh.material.uniforms.gradientZ.value.setHex(this.gradients[e].gradientZ.getHex()))}}},{key:"update",value:function(e){this.mesh.material.uniforms.time.value+=e}},{key:"homeTransition",value:function(){Xe.g.to(this.mesh.material.uniforms.transition,3,{value:1})}},{key:"dispose",value:function(){Xe.g.killTweensOf(this)}}]),e}(),Po="\n  ".concat(ca(!0),"\n  ").concat(ma,"\n  attribute vec3 aMotion;\n  varying vec3 vPosition;\n  void main() {\n    vec3 transformed = position;\n    ").concat(ua(!0),"\n\n    float ambientSpeed = 0.65;\n    float motionRangeXZ = 0.25;\n    float motionRangeY = 0.4;\n    float motionX = mix(-motionRangeXZ, motionRangeXZ, sin(aMotion.x + time * ambientSpeed) * 0.5 + 0.5);\n    float motionY = mix(-motionRangeXZ, motionRangeXZ, cos(aMotion.y + time * ambientSpeed) * 0.5 + 0.5);\n    float motionZ = mix(-motionRangeY, motionRangeY, sin(aMotion.z + time * ambientSpeed) * 0.5 + 0.5);\n    vec3 ambientMotion = vec3(motionX, motionY, motionZ);\n\n    transformed += ambientMotion;\n\n    ").concat(pa(!0),"\n\n    vPosition = position;\n\n    gl_Position = projectionMatrix * modelViewMatrix * matrix * vec4(transformed, 1.0);\n  }\n"),To="\n  ".concat(la(!0),"\n  ").concat(Ka,"\n  ").concat(eo,"\n  ").concat(ga,"\n  ").concat(oo,"\n  uniform float cameraDistance;\n  varying vec3 vPosition;\n\n  void main() {\n    if (materialId >= 0.0 && materialId < 0.9) {\n       ").concat($a,"\n    } else if(materialId >= 0.9 && materialId < 1.9) {\n      ").concat(to,"\n    } else if(materialId >= 1.9 && materialId < 2.9) {\n      ").concat(ba,"\n    } else if(materialId >= 2.9) {\n      ").concat(io,"\n    }\n    float maxShadow = 0.0;\n    ").concat(da,"\n\n    // Fade sphere out past a certain distance from the camera\n    float alphaDistance = abs(distance(vWorldPosition, cameraPosition));\n    alphaDistance = clamp(mapLinear(alphaDistance, 0.0, cameraDistance, 1.0, 0.0), 0.0, 1.0);\n    gl_FragColor.a *= alphaDistance;\n  }\n"),So=new Ie.hb,Fo=new Ie.V,Eo=Fo.elements,_o=function(){function e(t,n){var a,o=this;Object(c.a)(this,e),this.exitTransition=function(){Xe.g.to(o.mesh.material.uniforms.cameraDistance,6,{value:245})},this.data=n,this.gui=t.addFolder("present spheres"),this.gui.open(),this.group=new Ie.F;var i=n.size.length;this.totalInstances=i,this.config=uo;var r=(a={},Object(p.a)(a,De.q,[32,24]),Object(p.a)(a,De.r,[24,18]),a)[Object(De.K)()],s=(new Ie.J).copy(new Ie.Eb(1,r[0],r[1]));s.maxInstancedCount=i,this.mcol0=new Ie.I(new Float32Array(3*i),3),this.mcol1=new Ie.I(new Float32Array(3*i),3),this.mcol2=new Ie.I(new Float32Array(3*i),3),this.mcol3=new Ie.I(new Float32Array(3*i),3),this.sType=new Ie.I(new Float32Array(i),1),this.aGradientX=new Ie.I(new Float32Array(3*i),3),this.aGradientY=new Ie.I(new Float32Array(3*i),3),this.aGradientZ=new Ie.I(new Float32Array(3*i),3),this.aMaterialId=new Ie.I(new Uint8Array(i),1),this.aVisible=new Ie.I(new Uint8Array(this.totalInstances),1),this.aMotion=new Ie.I(new Float32Array(3*this.totalInstances),3);for(var l=Object(C.a)(De.a),u=new Ie.o,d=1,h=0,f=0,m=0,v=0;v<i;v++)h=n.position[v].x,f=n.position[v].y,m=n.position[v].z,So.position.set(h,f,m),d=n.size[v],So.scale.set(d,d,d),So.updateMatrix(),Fo.copy(So.matrix),this.sType.setX(v,v<3?.5:0),this.mcol0.setXYZ(v,Eo[0],Eo[1],Eo[2]),this.mcol1.setXYZ(v,Eo[4],Eo[5],Eo[6]),this.mcol2.setXYZ(v,Eo[8],Eo[9],Eo[10]),this.mcol3.setXYZ(v,Eo[12],Eo[13],Eo[14]),Wa()(l),u.setHex(l[0]),this.aGradientX.setXYZ(v,u.r,u.g,u.b),u.setHex(l[1]),this.aGradientY.setXYZ(v,u.r,u.g,u.b),u.setHex(l[2]),this.aGradientZ.setXYZ(v,u.r,u.g,u.b),this.aMotion.setXYZ(v,en.f.randFloat(-en.c,en.c),en.f.randFloat(-en.c,en.c),en.f.randFloat(-en.c,en.c)),this.aMaterialId.setX(v,v<3?2:en.f.randInt(0,3)),this.aVisible.setX(v,1);s.addAttribute("mcol0",this.mcol0),s.addAttribute("mcol1",this.mcol1),s.addAttribute("mcol2",this.mcol2),s.addAttribute("mcol3",this.mcol3),s.addAttribute("sType",this.sType),s.addAttribute("aGradientX",this.aGradientX),s.addAttribute("aGradientY",this.aGradientY),s.addAttribute("aGradientZ",this.aGradientZ),s.addAttribute("aMaterialId",this.aMaterialId),s.addAttribute("aVisible",this.aVisible),s.addAttribute("aMotion",this.aMotion);var g=new Ie.Bb({uniforms:Object(St.b)(sa,qa,Ja,fa,ao,{cameraDistance:{value:145}}),vertexShader:Po,fragmentShader:To,transparent:!0,side:Ie.C,lights:!0,fog:!0});Object.assign(g.uniforms,Ie.Mb.fog),g.uniforms.reflectivityEnabled.value=0,this.mesh=new Ie.W(s,g),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.mesh.frustumCulled=!1,this.group.add(this.mesh),this.gui.add(g.uniforms.cameraDistance,"value",0,300).name("cameraDistance")}return Object(le.a)(e,[{key:"envMapRender",value:function(e){this.mesh.visible=!e}},{key:"update",value:function(e){this.mesh.material.uniforms.time.value+=e}},{key:"dispose",value:function(){Xe.g.killTweensOf(this.mesh.material.uniforms.cameraDistance)}}]),e}(),Oo=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(ue.a)(this,Object(de.a)(t).call(this))).setActive=function(e){a.active=e;var t=e?"bind":"unbind";ee.a.isDesktop?a.domEvents[t](a.mesh,"mousedown",a.onTouchStart):a.domEvents[t](a.mesh,"touchstart",a.onTouchStart)},a.onTouchStart=function(e){a.active&&a.emit("start",e.intersect.point)},a.domEvents=new On(e,Me.b.domElement),a.mesh=n,a}return Object(he.a)(t,e),t}(Ce.a),Co={uniforms:"\n    uniform float time;\n    uniform float explode;\n\n\t\tattribute vec3 mcol0;\n\t\tattribute vec3 mcol1;\n\t\tattribute vec3 mcol2;\n\t\tattribute vec3 mcol3;\n\t\tattribute vec3 aCenter;\n\t\tattribute float aIndex;\n\t\tattribute vec4 aAxis;\n\t\tattribute vec3 aColor;\n\n    varying vec3 vViewPosition;\n    // varying vec3 vPosition;\n    varying vec3 vColor;\n    varying float vLife;\n  ",functions:"\n    ".concat(Yn,"\n    ").concat(In,"\n  "),postTransform:"\n    transformed = position;\n\n    if (aIndex == 0.0) {\n      transformed = mcol0;\n    } else if (aIndex == 0.25) {\n      transformed = mcol1;\n    } else if (aIndex == 0.75) {\n      transformed = mcol2;\n    } else {\n      transformed = mcol3;\n    }\n\n    vec3 rotationAxis = vec3(0.0, 1.0, 0.0);\n    float speed = mix(10.0, 3.0, explode);\n    float rotateAngle = (time * aAxis.w) * speed * explode;\n\n    vec3 rotated = rotate(transformed - aCenter, aAxis.xyz, rotateAngle);\n    vec3 direction = normalize(aCenter - vec3(0.0));\n\n    // float dropOff = 0.0;\n    // if (explode > 0.5) {\n    //   dropOff = clamp(mapLinear(explode, 0.5, 1.0, 0.0, 1.0), 0.0, 1.0);\n    // }\n\n    // direction.y = mix(direction.y, direction.y - 0.6, dropOff * explode);\n\n    float explodeScalar = mix(5.0, 20.0, aAxis.x);\n\n    vec3 center = mix(aCenter, aCenter + direction * explodeScalar, explode);\n    transformed = center + rotated;\n\n\n\n    // Move downwards at the end for drop off\n    // transformed = mix(transformed, transformed * vec3(1.0, -0.5, 1.0), dropOff);\n\n    vViewPosition = - (modelViewMatrix * vec4(transformed, 1.0)).xyz;\n\n    // vPosition = transformed;\n    vColor = aColor;\n    vLife = aAxis.x;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(transformed, 1.0);\n  "},Io={uniforms:"\n    #extension GL_OES_standard_derivatives : enable\n    uniform vec3 lightDirection;\n    uniform float explode;\n    // varying vec3 vPosition;\n    varying vec3 vViewPosition;\n    varying vec3 vColor;\n    varying float vLife;\n  ",functions:"\n    ".concat(In,"\n  "),postFragColor:"\n    vec3 normal = normalize(cross(dFdx(vViewPosition), dFdy(vViewPosition)));\n    float lambert = max(0.0, dot(normalize(lightDirection), normal) * 0.5 + 0.5);\n\n    float alpha = 1.0;\n    if (explode < 0.25) {\n      alpha = clamp(mapLinear(explode, 0.0, 0.25, 0.0, 1.0), 0.0, 1.0);\n    }\n\n    float endLife = clamp(vLife, 0.45, 0.65);\n    if (explode > endLife) {\n      alpha = clamp(mapLinear(explode, endLife, 1.0, 1.0, 0.0), 0.0, 1.0);\n    }\n\n    vec3 color = mix(vColor, vColor * 0.65, lambert);\n    gl_FragColor = vec4(color, alpha);\n  "},Mo=new Ie.Qb,Lo=new Ie.Qb,No=new Ie.Qb,ko=new Ie.Qb,jo=new Ie.Qb,Uo=new Ie.Qb,Ro=new Ie.Qb,Do=new Ie.Qb,Xo=new Ie.o,zo=new Ie.G(3,3),Yo=function(){function e(t,n,a){var o=this;Object(c.a)(this,e),this.onGUIChange=function(){for(var e=0;e<o.totalInstances;e++)Xo.setHSL(Math.random(),o.config.saturation,o.config.brightness),o.aColor.setXYZ(e,Xo.r,Xo.g,Xo.b);o.mesh.geometry.attributes.aColor.needsUpdate=!0},this.reset=function(){Xe.g.killTweensOf(o.mesh.material.uniforms.explode),o.mesh.material.uniforms.time.value=0,o.mesh.material.uniforms.explode.value=0},this.explode=function(e){return new Promise((function(t,n){o.reset(),o.mesh.visible=!0,jn.a.play(De.w,Ft.f[e%Ft.f.length]),Xe.g.to(o.mesh.material.uniforms.explode,2.5,{value:1,ease:Xe.b.easeOut,onComplete:function(){o.mesh.visible=!1,t()}})}))},this.config=a,this.group=new Ie.F;this.pointScalar=new Ie.Pb(-.05,-.25);for(var i=zo.attributes.position.count/3,r=[],s=0;s<i;s++){this.getVertices(zo.attributes.position.array,s)[4][2]<0&&Math.random()>.75&&r.push(s)}this.totalInstances=r.length;var l=new Ie.Hb(1,0),u=(new Ie.J).copy(l);u.maxInstancedCount=this.totalInstances,this.mcol0=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol1=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol2=new Ie.I(new Float32Array(3*this.totalInstances),3),this.mcol3=new Ie.I(new Float32Array(3*this.totalInstances),3),this.aColor=new Ie.I(new Float32Array(3*this.totalInstances),3),this.aCenter=new Ie.I(new Float32Array(3*this.totalInstances),3),this.aAxis=new Ie.I(new Float32Array(4*this.totalInstances),4);for(var d=u.attributes.position.array.length/3,h=new Ie.h(new Float32Array(d),1),f=[0,.25,.75,1],m=0;m<d;m++)h.setX(m,f[m%4]);for(var p=[De.h,De.d,De.o,De.f,De.e],v=0;v<this.totalInstances;v++){var g=this.getVertices(zo.attributes.position.array,r[v]);this.mcol0.setXYZ(v,g[0][0],g[0][1],g[0][2]),this.mcol1.setXYZ(v,g[1][0],g[1][1],g[1][2]),this.mcol2.setXYZ(v,g[2][0],g[2][1],g[2][2]),this.mcol3.setXYZ(v,g[3][0],g[3][1],g[3][2]),this.aCenter.setXYZ(v,g[4][0],g[4][1],g[4][2]),Xo.setHex(p[v%p.length]),this.aColor.setXYZ(v,Xo.r,Xo.g,Xo.b),this.aAxis.setXYZW(v,Math.random(),Math.random(),Math.random(),Math.random()<.5?-1:1)}u.addAttribute("mcol0",this.mcol0),u.addAttribute("mcol1",this.mcol1),u.addAttribute("mcol2",this.mcol2),u.addAttribute("mcol3",this.mcol3),u.addAttribute("aColor",this.aColor),u.addAttribute("aIndex",h),u.addAttribute("aCenter",this.aCenter),u.addAttribute("aAxis",this.aAxis);var b=Sn.extend(Ie.X,{uniforms:{time:{value:0},explode:{value:1},lightDirection:{value:n.directional.light.position}},vertexShader:Co,fragmentShader:Io});this.material=new b({side:Ie.v,transparent:!0,depthTest:!1}),this.mesh=new Ie.W(u,this.material);this.mesh.scale.set(5,5,5),this.group.add(this.mesh)}return Object(le.a)(e,[{key:"calculateFaceCenter",value:function(e,t){return Mo.set(e[9*t+0],e[9*t+1],e[9*t+2]),Lo.set(e[9*t+3],e[9*t+4],e[9*t+5]),No.set(e[9*t+6],e[9*t+7],e[9*t+8]),[(Mo.x+Lo.x+No.x)/3,(Mo.y+Lo.y+No.y)/3,(Mo.z+Lo.z+No.z)/3]}},{key:"getVertices",value:function(e,t){var n=this.calculateFaceCenter(e,t);Mo.set(e[9*t+0],e[9*t+1],e[9*t+2]),Lo.set(e[9*t+3],e[9*t+4],e[9*t+5]),No.set(e[9*t+6],e[9*t+7],e[9*t+8]),Ro.subVectors(No,Lo),Uo.subVectors(Mo,Lo),Do.crossVectors(Ro,Uo).normalize();var a=en.f.lerp(this.pointScalar.x,this.pointScalar.y,Math.random());return jo.set(a,a,a),ko.fromArray(n).add(jo.multiply(Do)),n=[(Mo.x+Lo.x+No.x+ko.x)/4,(Mo.y+Lo.y+No.y+ko.y)/4,(Mo.z+Lo.z+No.z+ko.z)/4],[Mo.toArray(),Lo.toArray(),No.toArray(),ko.toArray(),n]}},{key:"setPosition",value:function(e){this.mesh.position.copy(e)}},{key:"update",value:function(e,t){this.mesh.material.uniforms.time.value+=e}},{key:"dispose",value:function(){Xe.g.killTweensOf(this.mesh.material.uniforms.explode)}}]),e}(),Bo=function(e){function t(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).start=function(){n.interval=setInterval((function(){n.count++,n.emit("emit",n.count),n.count>=n.total&&clearInterval(n.interval)}),n.delay)},n.dispose=function(){clearInterval(n.interval)},n.count=0,n.total=e,n.delay=a,n}return Object(he.a)(t,e),t}(Ce.a),Qo=function(){function e(t,n,a){var o=this;Object(c.a)(this,e),this.onGUIChange=function(){for(var e=0;e<o.confettis.length;e++)o.confettis[e].onGUIChange()},this.exitTransition=function(){o.explodePositions=[];for(var e=0;e<o.total;e++){var t=new Ie.Qb,n=(e/o.total-1)*en.c,a=en.f.randFloat(30,60);t.x=a*Math.cos(n),t.y=a*Math.sin(n),t.z=en.f.lerp(0,30,Math.random()),o.explodePositions.push(t)}Wa()(o.explodePositions),Xe.g.delayedCall(.45,(function(){var e=new Bo(o.total,400);e.on("emit",o.autoExplode),e.start()}))},this.autoExplode=function(e){o.explode(o.explodePositions[e-1])},this.bindEvents=function(e){var t=e?"on":"off";o.hitbox[t]("start",o.onTouchStart),o.hitbox.setActive(e)},this.onTouchStart=function(e){e.z=en.f.lerp(0,30,Math.random()),o.explode(e)},this.gui=t.addFolder("confettis"),this.gui.open(),this.camera=n,this.group=new Ie.F,this.config={brightness:.7,saturation:.85},this.hitboxMesh=new Ie.W(new Ie.mb(1,1),new Ie.X({wireframe:!0,side:Ie.v,transparent:!0,opacity:0,depthWrite:!1})),this.group.add(this.hitboxMesh),this.hitbox=new Oo(n,this.hitboxMesh),this.confettis=[],this.total=8,this.current=0;for(var i=0;i<this.total;i++){var r=new Yo(this.gui,a,this.config);this.group.add(r.group),this.confettis.push(r)}this.gui.add(this.config,"saturation",0,1).onChange(this.onGUIChange),this.gui.add(this.config,"brightness",0,1).onChange(this.onGUIChange)}return Object(le.a)(e,[{key:"setLogoPositions",value:function(e){this.logoPositions=e}},{key:"explode",value:function(e){this.current++,this.current>=this.total&&(this.current=0),this.confettis[this.current].setPosition(e),this.confettis[this.current].explode(this.current)}},{key:"onStateChanged",value:function(e){switch(e.sceneStep){case De.A:this.bindEvents(!1);break;case De.z:this.resize(),this.bindEvents(!0);break;default:this.bindEvents(!1)}}},{key:"resize",value:function(){var e=Object(St.d)(this.camera.projectionMatrix,this.camera.aspect,this.camera.position.distanceTo(this.hitboxMesh.position)),t=e.scaleX,n=e.scaleY;this.hitboxMesh.scale.set(t,n,1)}},{key:"update",value:function(e){for(var t=0;t<this.confettis.length;t++)this.confettis[t].update(e)}},{key:"dispose",value:function(){for(var e=0;e<this.confettis.length;e++)this.confettis[e].dispose();this.bindEvents(!1)}}]),e}(),Vo="\n  uniform float time;\n  varying vec3 vEye;\n  varying vec3 vNormal;\n  varying vec3 vPosition;\n  varying vec3 vReflect;\n  // varying vec3 vWorldPosition;\n\n  vec3 inverseTransformDirection(in vec3 normal, in mat4 matrix) {\n    // matrix is assumed to be orthogonal,\n    return normalize((vec4(normal, 0.0) * matrix).xyz);\n  }\n\n  void main() {\n    vec4 worldPosition = modelMatrix *  vec4(position, 1.0);\n    vNormal = normalize(mat3(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz) * normal);\n    vEye = cameraPosition - worldPosition.xyz;\n    vec3 transformedNormal = normalMatrix * normal;\n    vec3 cameraToVertex = normalize(worldPosition.xyz - cameraPosition);\n    vec3 worldNormal = inverseTransformDirection(transformedNormal, viewMatrix);\n    vReflect = reflect(cameraToVertex, worldNormal);\n    // vWorldPosition = worldPosition.xyz;\n    vPosition = position;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n  }\n",Ho="\n  uniform float reflectiveFresnelPow;\n  uniform float reflectiveFresnelPow1;\n  uniform vec3 cameraEyePosition;\n  uniform samplerCube envMap;\n  uniform float cameraDistance;\n  uniform float depthSide;\n  uniform vec3 gradientX;\n  uniform vec3 gradientY;\n  uniform vec3 gradientZ;\n  varying vec3 vEye;\n  varying vec3 vNormal;\n  varying vec3 vPosition;\n  varying vec3 vReflect;\n  // varying vec3 vWorldPosition;\n\n  ".concat(In,"\n\n  void main() {\n    vec3 normal = normalize( vNormal );\n    normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\n\n    float cosTheta = abs(dot(normalize(vEye), normal));\n    float fresnel = pow(cosTheta, reflectiveFresnelPow);\n    float fresnel1 = pow(cosTheta, reflectiveFresnelPow1);\n\n    vec2 gradientXY = (normalize(vPosition) * 0.5 + 0.5).xy;\n    vec3 gradientColor = mix(gradientX, gradientY, gradientXY.x);\n    gradientColor = mix(gradientColor, gradientZ, gradientXY.y);\n\n     vec3 envMapColor = textureCube(envMap, vec3(vReflect.x, vReflect.yz)).rgb;\n\n    float dist = abs(distance(vPosition, cameraEyePosition));\n    float alpha = clamp(mapLinear(dist, 0.0, cameraDistance, 1.0, 0.0), 0.0, 1.0);\n\n    vec3 outgoingColor = mix(gradientColor * 1.25, envMapColor, (1.0 - fresnel));\n    gl_FragColor = vec4(outgoingColor, (fresnel1 * alpha));\n\n    if (depthSide == 0.0) {\n      if (vPosition.z > 0.0) {\n        discard;\n      }\n    } else {\n      if (vPosition.z < 0.0) {\n        discard;\n      }\n    }\n\n    // gl_FragColor.rgb *= 1.5;\n    // gl_FragColor = vec4(envMapColor, 1.0);\n  }\n"),Go=function(e){function t(e,n){var a;return Object(c.a)(this,t),(a=Object(ue.a)(this,Object(de.a)(t).call(this))).setActive=function(e){a.active=e;var t=e?"bind":"unbind";ee.a.isDesktop,a.domEvents[t](a.mesh,"mousemove",a.onTouchMove)},a.onTouchStart=function(e){a.active&&a.emit("start",e.intersect.point)},a.onTouchMove=function(e){a.emit("move",e.intersect.uv)},a.domEvents=new On(e,Me.b.domElement),a.mesh=n,a}return Object(he.a)(t,e),t}(Ce.a),Wo=n(62),Zo=(new Ie.Eb(1),ee.a.isDesktop?1:1.2),qo=new Ie.Qb(0,0,-135*Zo),Ko=new Ie.Qb(0,0,0),$o=200*Zo,Jo=70*Zo,ei=120*Zo,ti=function(e){function t(e,n,a,o){var i,r;Object(c.a)(this,t),(r=Object(ue.a)(this,Object(de.a)(t).call(this))).createSphereData=function(){var e=r.createSpherePathData(),t=r.createSpherePathData(25,2,9,7,20,0,0,!0);return e.position=e.position.concat(t.position),e.size=e.size.concat(t.size),e},r.createSpherePathData=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:15,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:20,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=50,u=[],d=en.c,h=0;h<l;h++){var f=h/(l-1),m=r.getPathPosition(f,e,d),p=m.position;u.push(p)}for(var v=qt(u,100),g=v.curve,b=(v.points,{size:[],position:[]}),x=0;x<n;x++){var y=x/(n-1),w=r.mesh.geometry.parameters.path.getPointAt(y),A=g.getPointAt(y);A.multiplyScalar(t);var P=Math.abs(A.distanceTo(w)),T=1;if(c)T=en.f.randFloat(a,o);else{var S=en.f.clamp(en.f.mapLinear(P,i,s,0,1),0,1);T=en.f.lerp(a,o,S)}if(0!==y&&1!==y)b.size.push(T),b.position.push(A)}return b},r.createParticlePaths=function(e){for(var t=[],n=en.c*e,a=en.f.lerp(-50,50,Math.random()),o=0;o<50;o++){var i=o/49,s=r.getPathPosition(i,a,n).position;t.push(s)}var c=qt(t,50),l=c.curve;c.points;return l},r.getPathPosition=function(e,t,n){var a=r.mesh.geometry.parameters.path.getPointAt(e),o=r.mesh.geometry.parameters.path.getPointAt((e+.01)%1).sub(a).normalize(),i=a.clone().cross(en.d).normalize(),s=i.cross(o).multiplyScalar(t),c=a.clone().add(s),l=n+e*en.c;c.applyAxisAngle(a.normalize(),l);var u=e*r.segments,d=Math.floor(u)%r.segments,h=(d+1)%r.segments,f=new Ie.Qb;f.subVectors(r.mesh.geometry.binormals[h],r.mesh.geometry.binormals[d]),f.multiplyScalar(u-d).add(r.mesh.geometry.binormals[d]);var m=r.mesh.geometry.parameters.path.getTangentAt(e);return i.copy(f).cross(m),{position:c,normal:i}},r.createCameraPath=function(e){var t=[e%1,(e+.075)%1];r.data={origin:[],lookat:[r.cameraEye.position.clone()],normal:[]};for(var n=0;n<t.length;n++){var a=r.getCurvePosition(t[n],en.f.lerp(10,30,n/(t.length-1)),en.f.lerp(20,10,n/(t.length-1)),!0);r.data.origin.push(a.position),n===t.length-1&&(r.data.lookat.push(a.lookAt),r.data.normal.push(a.normal))}var o=r.data.lookat[r.data.lookat.length-1],i=Ko.clone().lerp(o,.5),s=Ko.clone().sub(o).normalize().cross(en.d);i.add(s.multiplyScalar(2.5)),r.data.origin.push(qo);var c=Ko.clone();c.z=o.z,r.data.lookat.push(c),r.data.normal.push(new Ie.Qb(0,1,0)),cn.addTransition("logo",r.data,r.group,r.camera),cn.setTransition("logo",r.camera)},r.getCurvePosition=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:20,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=a?new Ie.Qb:r.cameraNormal,i=a?new Ie.Qb:r.cameraPosition,s=a?new Ie.Qb:r.cameraLookAt,c=a?new Ie.Qb:r.binormal;i.copy(r.mesh.geometry.parameters.path.getPointAt(e));var l=e*r.segments,u=Math.floor(l)%r.segments,d=(u+1)%r.segments;c.subVectors(r.mesh.geometry.binormals[d],r.mesh.geometry.binormals[u]),c.multiplyScalar(l-u).add(r.mesh.geometry.binormals[u]);var h=r.mesh.geometry.parameters.path.getTangentAt(e);if(o.copy(c).cross(h.clone().negate()),i.add(o.clone().multiplyScalar(-t)),r.cameraRight.crossVectors(o,h),s.copy(r.mesh.geometry.parameters.path.getPointAt((e+n/r.mesh.geometry.parameters.path.getLength())%1)),a)return{position:i.clone(),lookAt:s.clone(),normal:o.clone()}},r.exitTransition=function(){Object(Me.g)(!1),r.createCameraPath(r.time),Xe.g.killTweensOf(Object(_e.a)(r)),r.transition=0;var e=qt(r.data.normal,30).curve;r.exitTransitionFrame(e),r.setTouchControlsActive(!1),r.emit("exitTransition"),jn.a.stop(De.w,Ft.c),jn.a.play(De.w,Ft.d),Xe.g.to(Object(_e.a)(r),5,{transition:1,ease:Xe.e.easeOut,onUpdate:function(){r.uniforms.cameraDistance.value=en.f.lerp(60,$o,r.transition),r.camera.fov=en.f.lerp(ei,Jo,r.transition),r.camera.updateProjectionMatrix(),r.exitTransitionFrame(e),r.uniforms.reflectiveFresnelPow1.value=en.f.lerp(.025,.689,r.transition)},onComplete:function(){r.emit("interactionComplete")}})},r.exitTransitionFrame=function(e){var t=cn.cameraDolly.dollies[cn.cameraDolly.dolly].get(r.transition),n=t.origin,a=t.lookat;r.camera.position.set(n.x,n.y,n.z);var o=en.f.clamp(en.f.mapLinear(r.transition,0,.25,0,1),0,1),i=e.getPointAt(o);r.camera.matrix.lookAt(n,a,i),r.camera.quaternion.setFromRotationMatrix(r.camera.matrix)},r.onTimeChange=function(){r.createCameraPath(r.time),r.getCurvePosition(r.time),r.camera.position.copy(r.cameraPosition),r.cameraEye.position.copy(r.cameraLookAt),r.camera.matrix.lookAt(r.camera.position,r.cameraLookAt,r.cameraNormal),r.camera.quaternion.setFromRotationMatrix(r.camera.matrix),r.hitboxMesh.position.copy(r.cameraEye.position),r.hitboxMesh.quaternion.setFromRotationMatrix(r.camera.matrix)},r.onTouchStart=function(){r.tweens.interaction.value<.7&&r.interactionAnimation(!0)},r.onHitboxTouchMove=function(e){r.particleCenter.x=(e.x-.5)*r.hitboxMesh.scale.x,r.particleCenter.y=(e.y-.5)*r.hitboxMesh.scale.y,r.particleMotionEase.setValue(r.particleCenter.x,r.particleCenter.y)},r.onTouchEnd=function(){r.tweens.interaction.value<.7&&r.interactionAnimation(!1)},r.interactionAnimation=function(e){Xe.g.killTweensOf(r.tweens.camera),Xe.g.killTweensOf(r.tweens.interaction),Xe.g.killTweensOf(r.tweens.interactionProgress),Xe.g.to(r.tweens.camera,3,{ease:e?Xe.b.easeOut:Xe.e.easeOut,value:e?1:0,onUpdate:function(){r.uniforms.cameraDistance.value=en.f.lerp(30,60,r.tweens.camera.value),r.camera.fov=en.f.lerp(Jo,ei,r.tweens.camera.value),r.camera.updateProjectionMatrix()}}),e||ci&&r.background.setGradient(0);var t=14*(1-r.tweens.interaction.value),n=14*r.tweens.interaction.value,a=e?t:n;e?jn.a.play(De.w,Ft.e):jn.a.stop(De.w,Ft.e),Xe.g.to(r.tweens.interactionProgress,a,{value:e?1:0,ease:Xe.c.easeNone,onUpdate:function(){r.emit("interactionProgress",r.tweens.interactionProgress.value)}}),Xe.g.to(r.tweens.interaction,a,{ease:e?Xe.d.easeIn:Xe.e.easeOut,value:e?1:0,onUpdate:function(){var t=3*r.tweens.interaction.value;r.time=en.f.lerp(.85,1.85,t)%1,r.computeCamera(r.time),r.emit("interactionProgress",r.tweens.interaction.value),ci&&e&&(r.tweens.interaction.value<.33?r.background.setGradient(0):r.tweens.interaction.value>.33&&r.tweens.interaction.value<.66?r.background.setGradient(1):r.background.setGradient(2))},onComplete:function(){e&&r.exitTransition()}})},r.computeCamera=function(e){r.getCurvePosition(e),r.camera.position.copy(r.cameraPosition),r.cameraEye.position.copy(r.cameraLookAt),r.camera.matrix.lookAt(r.camera.position,r.cameraLookAt,r.cameraNormal),r.camera.quaternion.setFromRotationMatrix(r.camera.matrix),r.hitboxMesh.position.copy(r.cameraEye.position),r.hitboxMesh.quaternion.setFromRotationMatrix(r.camera.matrix);var t=Object(St.d)(r.camera.projectionMatrix,r.camera.aspect,r.camera.position.distanceTo(r.cameraEye.position)),n=t.scaleX,a=t.scaleY;r.hitboxMesh.scale.set(n,a,1)},r.envMapRender=function(e){r.mesh.visible=!e,r.mesh2.visible=!e},r.onStateChanged=function(e){switch(e.sceneStep){case De.A:case De.E:r.group.position.z=0,r.computeCamera(.85),r.camera.fov=Jo,r.camera.updateProjectionMatrix();break;case De.y:r.group.position.z=0,r.computeCamera(.85),r.setParticlesActive(!0),r.setTouchControlsActive(!0),r.camera.fov=Jo,r.camera.updateProjectionMatrix();break;case De.z:r.uniforms.cameraDistance.value=$o,r.onHitboxTouchMove({x:.5,y:.5}),r.setParticlesActive(!1)}},r.reset=function(){r.uniforms.cameraDistance.value=30,r.uniforms.reflectiveFresnelPow1.value=.025,r.transition=0,r.tweens.interaction.value=0,r.tweens.interactionProgress.value=0,r.tweens.camera.value=0,r.computeCamera(.85),r.camera.fov=Jo,r.camera.updateProjectionMatrix()},r.setParticlesActive=function(e){var t=e?"on":"off";r.hitbox[t]("move",r.onHitboxTouchMove),r.hitbox.setActive(e)},r.setTouchControlsActive=function(e){var t=e?"on":"off";Wo.a[t]("start",r.onTouchStart),Wo.a[t]("end",r.onTouchEnd)},r.update=function(e){r.uniforms.cameraEyePosition.value.copy(r.cameraEye.position),r.particleMotionEase.update()},r.dispose=function(){r.setParticlesActive(!1),r.setTouchControlsActive(!1)},r.gui=e.addFolder("logo"),r.gui.open(),r.group=new Ie.F,r.camera=n,r.background=o,r.time=.95,r.transition=0,r.cameraPosition=new Ie.Qb,r.cameraLookAt=new Ie.Qb,r.cameraNormal=new Ie.Qb,r.cameraRight=new Ie.Qb,r.binormal=new Ie.Qb,r.tweens={camera:{value:0},interaction:{value:0},interactionProgress:{value:0}};var s=(i={},Object(p.a)(i,De.q,{tubularSegments:100,radiusSegments:12}),Object(p.a)(i,De.r,{tubularSegments:80,radiusSegments:10}),i)[Object(De.K)()],l=new Ie.Kb(a,s.tubularSegments,5,s.radiusSegments,!0),u={gradientX:16752885,gradientY:De.b,gradientZ:11270911};r.uniforms={cameraEyePosition:{value:new Ie.Qb},cameraDistance:{value:30},depthSide:{value:1},time:{value:0},envMap:{value:null},reflectiveFresnelPow:{value:2.411},reflectiveFresnelPow1:{value:.025},gradientX:{value:new Ie.o(u.gradientX)},gradientY:{value:new Ie.o(u.gradientY)},gradientZ:{value:new Ie.o(u.gradientZ)}};var d=new Ie.Bb({uniforms:{cameraEyePosition:r.uniforms.cameraEyePosition,cameraDistance:r.uniforms.cameraDistance,depthSide:{value:1},time:r.uniforms.time,envMap:r.uniforms.envMap,reflectiveFresnelPow:r.uniforms.reflectiveFresnelPow,reflectiveFresnelPow1:r.uniforms.reflectiveFresnelPow1,gradientX:r.uniforms.gradientX,gradientY:r.uniforms.gradientY,gradientZ:r.uniforms.gradientZ},vertexShader:Vo,fragmentShader:Ho,transparent:!0}),h=new Ie.Bb({uniforms:{cameraEyePosition:r.uniforms.cameraEyePosition,cameraDistance:r.uniforms.cameraDistance,depthSide:{value:0},time:r.uniforms.time,envMap:r.uniforms.envMap,reflectiveFresnelPow:r.uniforms.reflectiveFresnelPow,reflectiveFresnelPow1:r.uniforms.reflectiveFresnelPow1,gradientX:r.uniforms.gradientX,gradientY:r.uniforms.gradientY,gradientZ:r.uniforms.gradientZ},vertexShader:Vo,fragmentShader:Ho,transparent:!0});return r.gui.add(r.uniforms.reflectiveFresnelPow,"value",0,5).name("reflectiveFresnelPow"),r.gui.add(r.uniforms.reflectiveFresnelPow1,"value",0,20).name("reflectiveFresnelPow1").listen(),r.gui.add(r.uniforms.cameraDistance,"value",0,200).name("cameraDistance"),r.gui.addColor(u,"gradientX").onChange((function(e){r.uniforms.gradientX.value.setHex(e)})),r.gui.addColor(u,"gradientY").onChange((function(e){r.uniforms.gradientY.value.setHex(e)})),r.gui.addColor(u,"gradientZ").onChange((function(e){r.uniforms.gradientZ.value.setHex(e)})),r.mesh=new Ie.W(l,d),r.group.add(r.mesh),r.segments=r.mesh.geometry.tangents.length,r.mesh2=new Ie.W(l,h),r.group.add(r.mesh2),r.cameraEye=new Ie.hb,r.hitboxMesh=new Ie.W(new Ie.mb(1,1),new Ie.X({color:16777215,wireframe:!1,opacity:0,transparent:!0,depthTest:!1,depthWrite:!1})),r.group.add(r.hitboxMesh),r.hitbox=new Go(n,r.hitboxMesh),r.particleCenter=new Ie.Pb,r.particleMotionEase=new kn.a,r.particleMotionEase.easing=.025,r.gui.add(r.particleMotionEase,"easing",0,1).name("particle easing"),r.gui.add(Object(_e.a)(r),"time",0,1).onChange(r.onTimeChange),r}return Object(he.a)(t,e),t}(Ce.a),ni=function(e){function t(e){var n;Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this))).render=function(){n.ctx.clearRect(0,0,n.canvas.width,n.canvas.height),n.ctx.drawImage(n.ref,0,0),n.ctx.lineWidth=10,n.ctx.strokeStyle="#FF0000";var e=n.formula(),t=e[Math.floor((e.length-1)*n.alpha)];n.ctx.beginPath();for(var a=0;a<e.length;a++)0===a?n.ctx.moveTo(e[a].x,e[a].y):n.ctx.lineTo(e[a].x,e[a].y);n.ctx.stroke(),n.ctx.closePath(),n.ctx.beginPath(),n.ctx.fillStyle="#00ff00",n.ctx.arc(t.x,t.y,20,0,2*Math.PI),n.ctx.fill(),n.ctx.closePath();for(var o=0;o<e.length;o++)n.ctx.beginPath(),n.ctx.fillStyle="#0000ff",n.ctx.arc(e[o].x,e[o].y,10,0,2*Math.PI),n.ctx.fill(),n.ctx.closePath()},n.gui=e.addFolder("logo eq"),n.gui.open();n.width=1280,n.height=545,n.curve=[],n.scale=150,n.angle=3.95,n.radius=260,n.alpha=.1,n.x=n.height/2,n.y=n.height/2;var a=qt(n.formula3D(),50).curve;return n.curve=a,n}return Object(he.a)(t,e),Object(le.a)(t,[{key:"formula3D",value:function(){for(var e=this.formula(!0),t=[],n=this.height/this.width/2,a=0;a<e.length;a++)t.push(new Ie.Qb(e[a].x-.5,e[a].y-n,e[a].z));return t}},{key:"getPoint",value:function(e){return this.curve.getPointAt(e).multiplyScalar(this.scale)}},{key:"getPointAt",value:function(e){return this.curve.getPointAt(e).multiplyScalar(this.scale)}},{key:"arc",value:function(e){var t=this.width/2,n=this.height/2,a=[],o={x:t,y:n};a.push(o);var i=3.95+en.a,r=en.c-(3.95+en.a),s=n,c=n;for(var l=0;l<20;l++){var u=en.f.lerp(i,r,l/19),d=s+267*Math.cos(u),h=c+267*Math.sin(u);a.push({x:d,y:h})}var f={x:t,y:n};e||a.push(f);for(var m=.15,p=e?-m:m,v=e?m:-m,g=0;g<a.length;g++)a[g].z=en.f.lerp(p,v,g/(a.length-1));return a}},{key:"formula",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.arc(!0),n=this.arc(),a=0;a<n.length;a++)n[a].x*=-1,n[a].x+=this.width;var o=t.concat(n);if(e)for(var i=0;i<o.length;i++)o[i].x/=this.width,o[i].y/=this.width;return o}}]),t}(Ie.s),ai="\n  attribute float size;\n  attribute float alpha;\n  attribute float life;\n  attribute vec3 pColor;\n  uniform vec3 cameraNormal;\n  uniform vec3 cameraRight;\n  uniform vec2 particleCenter;\n  uniform float particleSize;\n  uniform float cameraDistance;\n  uniform float particleRadiusInfluence;\n  varying float vAlpha;\n  varying float vLife;\n  varying vec3 vColor;\n  varying vec3 vPosition;\n\n  ".concat(In,"\n\n  void main() {\n    vec3 pos = position;\n\n\n    // Move particle position along camera up / right to follow mouse\n    // up\n    pos += cameraNormal * particleCenter.y;\n    // right\n    pos += cameraRight * -particleCenter.x;\n\n    float dist = abs(distance(pos, cameraPosition));\n    dist = clamp(mapLinear(dist, 0.0, particleRadiusInfluence, 1.0, 0.0), 0.0, 1.0);\n\n    pos = mix(position, pos, dist);\n\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_PointSize = size * (particleSize / length(mvPosition.xyz));\n\t  gl_Position = projectionMatrix * mvPosition;\n    vAlpha = alpha;\n    vLife = life;\n    vColor = pColor;\n    vPosition = pos;\n  }\n"),oi="\n  uniform sampler2D particleMap;\n  uniform float cameraDistance;\n  uniform float opacity;\n  varying float vAlpha;\n  varying float vLife;\n  varying vec3 vColor;\n  varying vec3 vPosition;\n\n  ".concat(In,"\n  const float brightness = 3.0;\n\n  void main() {\n    float lifeAlpha = 1.0;\n    float transtionAlpha = 1.0;\n\n    float dist = abs(distance(vPosition, cameraPosition));\n\n    lifeAlpha = clamp(mapLinear(dist, 0.0, cameraDistance, 1.0, 0.0), 0.0, 1.0);\n\n    if (vLife < 0.25) {\n      lifeAlpha *= clamp(mapLinear(vLife, 0.0, 0.25, 0.0, 1.0), 0.0, 1.0);\n    }\n\n    if (vLife > 0.75) {\n      lifeAlpha *= clamp(mapLinear(vLife, 0.75, 1.0, 1.0, 0.0), 0.0, 1.0);\n    }\n    vec4 texel = texture2D(particleMap, gl_PointCoord.xy);\n    float outgoingAlpha = texel.r * vAlpha * lifeAlpha * brightness * transtionAlpha;\n\n    gl_FragColor = vec4(vColor, outgoingAlpha * texel.r * opacity);\n    // gl_FragColor = vec4(vec3(1), outgoingAlpha);\n    // gl_FragColor = vec4(vec3(1), 1.0);\n  }\n"),ii=function(){function e(t,n){var a;Object(c.a)(this,e),this.curve=n,this.config=t,this.pixelRatio=Me.b.getPixelRatio();var o=(a={},Object(p.a)(a,De.q,100),Object(p.a)(a,De.r,75),a);this.totalParticles=o[Object(De.K)()],this.colors=Object.values(this.config.colors),this.color=new Ie.o,this.simulation={pointOnCurveStart:new Float32Array(this.totalParticles),pointOnCurveEnd:new Float32Array(this.totalParticles),curveIndex:new Array(this.totalParticles),lifespan:new Float32Array(this.totalParticles)},this.attributes={position:new Ie.h(new Float32Array(3*this.totalParticles),3),color:new Ie.h(new Float32Array(3*this.totalParticles),3),size:new Ie.h(new Float32Array(this.totalParticles),1),alpha:new Ie.h(new Float32Array(this.totalParticles),1),life:new Ie.h(new Float32Array(this.totalParticles),1)};for(var i=0,r=0;r<this.totalParticles;r++)i=3*r,this.resetParticle(r,i,this.getRandomColor());var s=new Ie.i;s.addAttribute("position",this.attributes.position),s.addAttribute("pColor",this.attributes.color),s.addAttribute("size",this.attributes.size),s.addAttribute("alpha",this.attributes.alpha),s.addAttribute("life",this.attributes.life),this.material=new Ie.Bb({uniforms:{transition:{type:"f",value:t.uniforms.transition},cameraPosition:{value:new Ie.Qb},cameraNormal:{value:new Ie.Qb},cameraRight:{value:new Ie.Qb},particleCenter:{value:new Ie.Pb},particleRadiusInfluence:{value:t.uniforms.particleRadiusInfluence},cameraDistance:{value:t.uniforms.cameraDistance},particleSize:{type:"f",value:t.uniforms.particleSize},particleMap:{type:"t",value:Tt.a.get(De.w,"future-particle-color")},opacity:{value:1}},vertexShader:ai,fragmentShader:oi,transparent:!0,depthTest:!1}),this.mesh=new Ie.ob(s,this.material),this.mesh.frustumCulled=!1}return Object(le.a)(e,[{key:"getRandomColor",value:function(){var e=this.colors[Math.floor(Math.random()*this.colors.length)];return[this.color.setHex(e).r,this.color.setHex(e).g,this.color.setHex(e).b]}},{key:"getPointOnCurve",value:function(e,t){var n=en.f.lerp(this.simulation.pointOnCurveStart[e],this.simulation.pointOnCurveEnd[e],t);return n>1&&(n-=1),n}},{key:"resetParticle",value:function(e,t,n){this.simulation.pointOnCurveStart[e]=en.f.lerp(0,1,Math.random()),this.simulation.pointOnCurveEnd[e]=this.simulation.pointOnCurveStart[e]+en.f.lerp(0,1,Math.random());var a=this.curve.getPoint(this.getPointOnCurve(e,0));this.attributes.position.setXYZ(e,a.x,a.y,a.z);var o=en.f.randFloat(this.config.particles.min,this.config.particles.max)*this.pixelRatio;this.attributes.size.setX(e,o),this.attributes.alpha.setX(e,Math.random()),this.attributes.life.setX(e,0),this.simulation.lifespan[e]=en.f.lerp(0,5e-4,Math.random()),this.attributes.color.setXYZ(e,n[0],n[1],n[2])}},{key:"updateUniforms",value:function(e){this.material.uniforms.transition.value=e.transition,this.mesh.material.uniforms.particleSize.value=e.particleSize,this.mesh.material.uniforms.cameraPosition.value.copy(e.cameraPosition),this.mesh.material.uniforms.cameraNormal.value.copy(e.cameraNormal),this.mesh.material.uniforms.cameraRight.value.copy(e.cameraRight),this.mesh.material.uniforms.cameraDistance.value=e.cameraDistance,this.mesh.material.uniforms.particleCenter.value.copy(e.particleCenter),this.mesh.material.uniforms.particleRadiusInfluence.value=e.particleRadiusInfluence,this.mesh.material.uniforms.opacity.value=e.opacity}},{key:"updateConfig",value:function(e){this.config=e;for(var t=0,n=0;n<this.totalParticles;n++)t=3*n,this.resetParticle(n,t,this.getRandomColor())}},{key:"update",value:function(e){for(var t,n,a,o=this.mesh.geometry.attributes,i=0;i<this.totalParticles;i+=1)n=3*i,t=o.life.getX(i),t+=.05*e,(t+=this.simulation.lifespan[i])>=1?this.resetParticle(i,n,this.getRandomColor()):(o.life.setX(i,t),a=this.curve.getPoint(this.getPointOnCurve(i,t)*this.config.uniforms.pathTransition),o.position.setXYZ(i,a.x,a.y,a.z));this.updateBuffers()}},{key:"updateBuffers",value:function(){this.attributes.position.needsUpdate=!0,this.attributes.size.needsUpdate=!0,this.attributes.life.needsUpdate=!0,this.attributes.alpha.needsUpdate=!0,this.attributes.color.needsUpdate=!0}}]),e}(),ri=function(){function e(t,n){var a,o=this;Object(c.a)(this,e),this.updateUniforms=function(){for(var e=0;e<o.particles.length;e++)o.particles[e].updateUniforms(o.config.uniforms)},this.updateConfig=function(){for(var e=0;e<o.particles.length;e++)o.particles[e].updateConfig(o.config)},this.envMapRender=function(e){o.group.visible=!e},this.onStateChanged=function(e){o.state=e},this.exitTransition=function(){Xe.g.to(o.config.uniforms,8,{opacity:0,cameraDistance:250,onComplete:function(){o.toggleVisibility(!1)}})},this.toggleVisibility=function(e){o.group.visible=e,o.config.uniforms.opacity=1,o.config.uniforms.cameraDistance=30},this.logo=n,this.gui=t.addFolder("particles"),this.gui.open(),this.group=new Ie.F,this.config={generation:0,uniforms:{transition:1,pathTransition:1,cameraDistance:30,hueShift:.2,particleSize:1,cameraPosition:new Ie.Qb,cameraNormal:new Ie.Qb,cameraRight:new Ie.Qb,particleCenter:new Ie.Pb,particleRadiusInfluence:70,opacity:1},colors:{color0:De.b,color1:De.o,color2:De.g,color3:De.c,color4:De.n},particles:{min:80,max:125}};var i=(a={},Object(p.a)(a,De.q,50),Object(p.a)(a,De.r,40),a)[Object(De.K)()];this.particles=[];for(var r=0;r<i;r++){var s=n.createParticlePaths(r/(i-1)||0);this.particles.push(new ii(this.config,s)),this.group.add(this.particles[r].mesh)}this.gui.add(this.config.uniforms,"particleSize",0,200).onChange(this.updateUniforms),this.gui.add(this.config.uniforms,"transition",0,1).onChange(this.updateUniforms),this.gui.add(this.config.uniforms,"pathTransition",0,1).onChange(this.updateUniforms),this.gui.add(this.config.uniforms,"cameraDistance",0,150).onChange(this.updateUniforms),this.gui.add(this.config.uniforms.particleCenter,"x",-1,1).onChange(this.updateUniforms),this.gui.add(this.config.uniforms.particleCenter,"y",-1,1).onChange(this.updateUniforms),this.gui.add(this.config.uniforms,"particleRadiusInfluence",0,200).onChange(this.updateUniforms),this.gui.add(this.config.uniforms,"opacity",0,1).onChange(this.updateUniforms)}return Object(le.a)(e,[{key:"reset",value:function(){this.toggleVisibility(!0)}},{key:"update",value:function(e){if(this.group.visible){this.config.uniforms.cameraPosition.copy(this.logo.cameraEye.position),this.config.uniforms.cameraNormal.copy(this.logo.cameraNormal),this.config.uniforms.cameraRight.copy(this.logo.cameraRight),this.config.uniforms.particleCenter.copy(this.logo.particleMotionEase.value),this.state&&this.state.sceneStep===De.y&&(this.config.uniforms.cameraDistance=en.f.lerp(30,60,this.logo.tweens.camera.value)),this.updateUniforms();for(var t=0;t<this.particles.length;t++)this.particles[t].update(e)}}},{key:"dispose",value:function(){Xe.g.killTweensOf(this.config.uniforms)}}]),e}(),si=function(){function e(){Object(c.a)(this,e),this.cameras={cube0:new Ie.p(1,1e3,128),cube1:new Ie.p(1,1e3,128)},this.cameras.cube0.renderTarget.texture.generateMipmaps=!0,this.cameras.cube0.renderTarget.texture.minFilter=Ie.O,this.cameras.cube1.renderTarget.texture.generateMipmaps=!0,this.cameras.cube1.renderTarget.texture.minFilter=Ie.O,this.count=0,this.texture=null}return Object(le.a)(e,[{key:"update",value:function(e){this.count%2===0?(this.texture=this.cameras.cube0.renderTarget.texture,this.cameras.cube1.update(Me.b,e)):(this.texture=this.cameras.cube1.renderTarget.texture,this.cameras.cube0.update(Me.b,e)),this.count++}}]),e}(),ci=!0,li=function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(ue.a)(this,Object(de.a)(t).call(this,{id:De.w,assets:zt,gui:!0,guiOpen:!0}))).createObjects=function(){return new Promise((function(t,n){try{e.lights=new xo,e.lights.get().forEach((function(t){e.scene.add(t)})),e.lights.gui(e.gui),e.sceneObjects=[],ee.a.helpers&&(e.cameraHelper=new Ie.j(e.camera),e.scene.add(e.cameraHelper)),ci&&(e.background=new Ao(e.gui,De.w),e.scene.add(e.background.mesh)),e.logoEquation=new ni(e.gui),e.logo=new ti(e.gui,e.camera,e.logoEquation,e.background),e.logo.confetti=e.confettis,e.scene.add(e.logo.group),e.sceneObjects.push(e.logo),e.envMap=new si,e.logo.on("interactionProgress",e.onInteractionProgress),e.particles=new ri(e.gui,e.logo),e.scene.add(e.particles.group),e.sceneObjects.push(e.particles),e.presentSpheres=new _o(e.gui,e.logo.createSphereData()),e.scene.add(e.presentSpheres.group),e.confettis=new Qo(e.gui,e.camera,e.lights),e.scene.add(e.confettis.group),e.sceneObjects.push(e.confettis),e.camera.fov=100,e.camera.updateProjectionMatrix(),e.gui.add(e.camera,"fov",1,200).onChange((function(t){e.camera.updateProjectionMatrix()})),e.ready=!0,t()}catch(a){n(a)}}))},e.onSceneChange=function(t){e.scene=e.scenes[t]},e.setState=function(t){e.emit("sceneStep",t)},e.updateSceneObjectsState=function(t){for(var n=0;n<e.sceneObjects.length;n++)e.sceneObjects[n].onStateChanged(t)},e.onStateChanged=function(t){switch(e.state=t,e.state.route===v.k.Future&&na.b.setCamera(e.camera),e.state.sceneStep){case De.A:e.updateSceneObjectsState(t),jn.a.play(De.w,Ft.c),ka.setBlur(1),ka.setDof(0),ka.setTint(De.u,!0,De.t,0,De.i);break;case De.E:e.updateSceneObjectsState(t),ka.setBlur(0,!0,1.5),ka.setDof(1,!0,1.5),ka.setTint(0,!0,De.t),Xe.g.delayedCall(1,(function(){e.setState(new Zt({step:De.y}))}));break;case De.y:e.logo.once("interactionProgress",e.onInteractionStarted),e.logo.once("interactionComplete",e.onInteractionComplete),e.logo.once("exitTransition",e.presentSpheres.exitTransition),e.logo.once("exitTransition",e.confettis.exitTransition),Object(Me.g)(!0),e.updateSceneObjectsState(t),ka.setDof(1);break;case De.D:ka.setBlur(1,!0,3),ka.setDof(0,!0,3),ka.setTint(De.u,!0,De.t,0,De.i);break;case De.z:Object(Me.g)(!0),ka.setBlur(0,!0,2),ka.setDof(1,!0,2),ka.setTint(0,!0,De.t);var n=-e.camera.position.length(),a=ee.a.isDesktop?30:15,o=ee.a.isDesktop?8:11;na.b.setConfig(new na.a(a,o,.115,.7*n,n)),na.b.setActive(!0),na.b.update(),e.updateSceneObjectsState(t);break;case De.F:Object(Me.g)(!1),na.b.setActive(!1),rn.FUTURE_TRANSITION_OUT.origin[0].x=e.camera.position.x,rn.FUTURE_TRANSITION_OUT.origin[0].y=e.camera.position.y,rn.FUTURE_TRANSITION_OUT.origin[0].z=e.camera.position.z;var i=(new Ie.Qb).lerpVectors(en.e,e.camera.position,1.05);rn.FUTURE_TRANSITION_OUT.origin[1].x=i.x,rn.FUTURE_TRANSITION_OUT.origin[1].y=i.y,rn.FUTURE_TRANSITION_OUT.origin[1].z=i.z,cn.addTransition("FUTURE_TRANSITION_OUT",rn.FUTURE_TRANSITION_OUT,e.scene,e.camera),cn.once("transitionComplete",e.onTransitionComplete),cn.setTransition("FUTURE_TRANSITION_OUT",e.camera),cn.transition(5,Ee.d.easeIn),ka.setBlur(1,!0,3),ka.setDof(0,!0,3),ka.setTint(De.u,!0,3.5,0,De.j),Xe.g.to(e.logo.group.position,5,{z:20,ease:Ee.d.easeIn}),Xe.g.delayedCall(3.5,(function(){jn.a.stop(De.w,Ft.d),e.emit("complete")}))}},e.resize=function(t,n){e.camera.aspect=t/n,e.camera.updateProjectionMatrix(),e.confettis.resize()},e.update=function(t){e.ready&&(ee.a.helpers&&e.cameraHelper.update(),na.b.update(),e.particles.envMapRender(!0),e.logo.envMapRender(!0),e.presentSpheres.envMapRender(!0),e.envMap.update(e.scene),e.logo.mesh.material.uniforms.envMap.value=e.envMap.texture,e.presentSpheres.mesh.material.uniforms.envMap.value=e.envMap.texture,e.presentSpheres.envMapRender(!1),e.particles.envMapRender(!1),e.logo.envMapRender(!1),ci&&e.background.update(t),e.logo.update(t),e.confettis.update(t),e.particles.update(t,e.camera),e.presentSpheres.update(t))},e.onInteractionProgress=function(t){e.emit("interactionProgress",t)},e.onInteractionStarted=function(){e.emit("interactionStarted")},e.onInteractionComplete=function(){e.setState(new Zt({step:De.D}))},e.captureScreenShot=function(e){na.b.captureScreenShot(e)},e.onTransitionComplete=function(){switch(e.state.sceneStep){case De.E:e.setState(new Zt({step:De.y}));break;case De.F:e.emit("complete"),Xe.g.delayedCall(2,(function(){ci&&e.background.setGradient(0,!1),e.logo.reset(),e.particles.reset()}))}},e.dispose=function(){e.logo.dispose(),ci&&e.background.dispose(),e.confettis.dispose(),e.particles.dispose(),e.presentSpheres.dispose();for(var t=Object(C.a)(e.scene.children),n=0;n<t.length;n++)Object(St.c)(t[n],e.scene);Tt.a.dispose(De.w)},e}return Object(he.a)(t,e),t}(Wt),ui=function(){function e(){Object(c.a)(this,e),this.ambient=new ze({ambient:15792892,intensity:.7}),this.directional=new Ye({intensity:.6})}return Object(le.a)(e,[{key:"gui",value:function(e){var t=e.addFolder("lights");t.open(),this.ambient.gui(t),this.directional.gui(t)}},{key:"get",value:function(){return[this.ambient.light,this.directional.light]}},{key:"dispose",value:function(e){this.get().forEach((function(e){e.dispose()}))}}]),e}(),di=(n(91),function(e){function t(){var e;return Object(c.a)(this,t),(e=Object(ue.a)(this,Object(de.a)(t).call(this,{id:De.x,assets:_t,gui:!0,guiOpen:!0}))).createObjects=function(){return new Promise((function(t,n){try{e.lights=new ui,e.lights.get().forEach((function(t){e.scene.add(t)})),e.lights.gui(e.gui),e.background=new Ao(e.gui,De.x),e.background.setGradient(2),e.scene.add(e.background.mesh),e.ready=!0,t()}catch(a){n(a)}}))},e.setState=function(t){e.emit("sceneStep",t)},e.onStateChanged=function(t){switch(e.state=t,e.state.sceneStep){case De.A:ka.setBlur(0,!0,3),ka.setTint(De.u,!1,0,0,De.j),e.background.homeTransition();break;case De.F:Ee.j.delayedCall(2,(function(){jn.a.stop(De.x,Ft.j),e.emit("complete")}))}"running"===t.audioContextState&&e.state.sceneStep===De.A&&jn.a.play(De.x,Ft.j)},e.update=function(t){e.ready&&e.background.update(t)},e.dispose=function(){for(var t=Object(C.a)(e.scene.children),n=0;n<t.length;n++)Object(St.c)(t[n],e.scene);Tt.a.dispose(De.x)},e.backgroundColor=16777215,e.state=new Zt,e.prevState=new Zt,e}return Object(he.a)(t,e),t}(Wt)),hi=n(99),fi=function e(t,n,a,o){var i=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];Object(c.a)(this,e),this.render=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height),i.ctx.drawImage(i.canvasRender,0,0);var t=Tt.a.get(De.p,"screenshot-fwa"),n=Tt.a.get(De.p,"screenshot-jam3"),a=i.settings.fwa.x*i.canvas.width,o=i.settings.fwa.y*i.canvas.height,r=i.settings.jam3.x*i.canvas.width,s=i.settings.jam3.y*i.canvas.height;if(i.ctx.drawImage(t,a,o-t.height/2),i.ctx.drawImage(n,r-n.width,s-n.height/2),!i.horizontalLayout){i.ctx.beginPath(),i.ctx.lineWidth=i.settings.lineWidth,i.ctx.strokeStyle="rgba(255, 255, 255, 0.5)";var c=i.canvas.width/2,l=s,u=i.settings.lineSize*i.canvas.height;i.ctx.moveTo(c,l-u),i.ctx.lineTo(c,l+u),i.ctx.stroke(),i.ctx.closePath()}if(!0===e){var d=.75,h="FWA100.jpg",f="image/jpeg";if(ee.a.isDesktop||ee.a.ios&&!ee.a.operaTouch)i.canvas.toBlob((function(e){Object(hi.a)(e,h)}),f,d);else if(ee.a.operaTouch)window.open(i.canvas.toDataURL(f,d));else{var m=document.createElement("a");m.download=h,m.href=i.canvas.toDataURL(f,d),m.target="_blank",m.click()}}},this.capture=function(e,t){i.ctx.clearRect(0,0,i.canvas.width,i.canvas.height);var n=t.aspect;t.aspect=i.width/i.height,t.updateProjectionMatrix();var a=ka.finalPass.mesh.material.uniforms.resolution.value.x,o=ka.finalPass.mesh.material.uniforms.resolution.value.y,r=ka.dofPass.mesh.material.uniforms.resolution.value.x,s=ka.dofPass.mesh.material.uniforms.resolution.value.y,c=Me.e.x,l=Me.e.y;i.renderer.setViewport(0,0,c,l),i.renderer.setScissor(0,0,c,l),ka.dofPass.resizeScreenshot(t,i.width,i.height),ka.dofPass.renderScreenshot({scene:e,camera:t},i.renderTargetA,i.renderTargetB),ka.finalPass.resize(i.width,i.height),ka.finalPass.screenShotRender(e,t,i.renderTargetB,i.renderTargetA,0),ka.render(0),i.renderer.readRenderTargetPixels(i.renderTargetA,0,0,i.renderTargetA.width,i.renderTargetA.height,i.pixelBuffer),i.imageData.data.set(i.pixelBuffer),i.ctxFlipped.putImageData(i.imageData,0,0),i.ctxRender.save(),i.ctxRender.scale(1,-1),i.ctxRender.drawImage(i.canvasFlipped,0,-i.canvas.height,i.canvas.width,i.canvas.height),i.ctxRender.restore(),i.renderer.setRenderTarget(null),t.aspect=n,t.updateProjectionMatrix(),ka.finalPass.resize(a,o),ka.dofPass.resizeScreenshot(t,r,s),ka.dofPass.screenshotReset(),i.render(!0)},this.gui=t.addFolder("screenshot"),this.renderer=n,this.width=a*r,this.height=o*r,this.horizontalLayout=s,this.renderTargetA=new Ie.Ub(this.width,this.height,{minFilter:Ie.N,magFilter:Ie.N,format:Ie.ub,stencilBuffer:!1}),this.renderTargetB=new Ie.Ub(this.width,this.height,{minFilter:Ie.N,magFilter:Ie.N,format:Ie.ub,stencilBuffer:!1});var l=Object(rt.a)(this.width,this.height),u=l.canvas,d=l.ctx,h=Object(rt.a)(this.width,this.height),f=h.canvas,m=h.ctx,p=Object(rt.a)(this.width,this.height),v=p.canvas,g=p.ctx;this.canvas=u,this.canvasFlipped=v,this.canvasRender=f,this.ctx=d,this.ctxFlipped=g,this.ctxRender=m,this.pixelBuffer=new Uint8Array(this.renderTargetA.width*this.renderTargetA.height*4),this.imageData=this.ctxFlipped.createImageData(this.canvas.width,this.canvas.height),Object.assign(this.canvas.style,{position:"absolute",top:"0",left:"0",zIndex:"100",border:"1px solid white",pointerEvents:"none",width:"".concat(a,"px"),height:"".concat(o,"px")}),Object.assign(this.canvasFlipped.style,{position:"absolute",top:"0",left:"512px",zIndex:"100",border:"1px solid white",pointerEvents:"none",width:"".concat(a,"px"),height:"".concat(o,"px")});var b={fwa:{x:.075,y:.5},jam3:{x:.925,y:.5}},x={fwa:{x:.35,y:.9},jam3:{x:.65,y:.9}};this.settings=this.horizontalLayout?b:x,this.settings.lineSize=.02,this.settings.lineWidth=3,this.gui.add(this,"render"),this.gui.add(this.settings.fwa,"x",0,1).onChange(this.render),this.gui.add(this.settings.fwa,"y",0,1).onChange(this.render),this.gui.add(this.settings.jam3,"x",0,1).onChange(this.render),this.gui.add(this.settings.jam3,"y",0,1).onChange(this.render),this.gui.add(this.settings,"lineWidth",0,10).onChange(this.render),this.gui.add(this.settings,"lineSize",0,1).onChange(this.render)},mi=n(39),pi=function(){function e(t){Object(c.a)(this,e),this.route=t.route,this.capture=t.capture,this.sceneStep=t.sceneStep,this.windowSize=t.windowSize,this.audioContextState=t.audioContextState,this.assetsLoaded=t.assetsLoaded}return Object(le.a)(e,[{key:"equals",value:function(e){return e.route===this.route&&e.capture===this.capture&&e.sceneStep===this.sceneStep&&e.assetsLoaded===this.assetsLoaded&&e.audioContextState===this.audioContextState&&e.windowSize.width===this.windowSize.width&&e.windowSize.height===this.windowSize.height}},{key:"clone",value:function(){return new e({route:this.route,capture:this.capture,sceneStep:this.sceneStep,assetsLoaded:this.assetsLoaded,audioContextState:this.audioContextState,windowSize:Object(mi.a)({},this.windowSize)})}}]),e}(),vi=function(e){function t(e){var n,a,o;Object(c.a)(this,t),(o=Object(ue.a)(this,Object(de.a)(t).call(this))).captureScreenShot=function(){h(_),o.currentScene.captureScreenShot(!0),o.screenshot.capture(o.currentScene.scene,o.currentScene.camera),o.currentScene.captureScreenShot(!1)},o.load=function(){return new Promise((function(e,t){ee.a.preloadAllAssets?(Pt.once("loaded",(function(t){Tt.a.add(De.p,t),e()})),Pt.once("error",t),Pt.load("default",Qt)):e()}))},o.setup=function(e){return new Promise((function(t,n){if(ee.a.preloadAllScenes){var a=[];Object.values(o.scenes).forEach((function(t){a.push(t.setup(e.assetsLoaded))})),Promise.all(a).then(t).catch(n)}else t()}))},o.setState=function(e){if(!e.equals(o.state))return o.prevState=o.state.clone(),o.state=e,o.onStateChanged(),Object(_e.a)(o)},o.onStateChanged=function(){if(o.state.route!==o.prevState.route){if(!Object.keys(o.routesMap).includes(o.state.route))return;De.v.includes(Object(Ue.a)("sceneId"))?o.setScene(Object(Ue.a)("sceneId")):o.setScene(o.routesMap[o.state.route])}else o.state.sceneStep===o.prevState.sceneStep&&o.state.audioContextState===o.prevState.audioContextState||o.currentScene.onStateChanged(o.state);o.state.capture===o.prevState.capture||o.state.sceneStep!==De.y&&o.state.sceneStep!==De.z||o.captureScreenShot()},o.setScene=function(e){o.sceneId=e;var t=ka.sceneB,n=o.scenes[e];o.currentScene.off("sceneStep",o.onSceneStep),o.currentScene.off("interactionProgress",o.onInteractionProgress),o.currentScene.off("interactionStarted",o.onInteractionStarted);var a=function(){o.currentScene=n,o.currentScene.on("sceneStep",o.onSceneStep),o.currentScene.on("interactionProgress",o.onInteractionProgress),o.currentScene.once("interactionStarted",o.onInteractionStarted),o.currentScene.onStateChanged(o.state),o.currentScene.resize(o.state.windowSize.width,o.state.windowSize.height),ka.setScenes(t,n),ka.transition().then((function(){ee.a.preloadAllScenes||t.dispose(),o.bindScene()})),"visible"!==Me.b.domElement.style.visibility&&requestAnimationFrame((function(){Ee.j.set(Me.b.domElement,{autoAlpha:1})}))};ee.a.preloadAllScenes?a():n.setup(o.assetsLoaded).then(a)},o.bindScene=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object.values(o.scenes).forEach((function(e){e.off("complete",o.onSceneComplete)})),o.currentScene.once("complete",o.onSceneComplete)},o.onSceneStep=function(e){o.emit("sceneStep",e)},o.onInteractionProgress=function(e){o.emit("sceneInteractionProgress",e)},o.onInteractionStarted=function(){o.emit("sceneInteractionStarted")},o.onSceneComplete=function(){o.emit("sceneComplete")},o.resize=function(e,t){Object(Me.f)(e,t),Ke.aspect=e/t,Ke.updateProjectionMatrix(),o.currentScene.resize(Me.e.x,Me.e.y),ka.resize(o.currentScene.camera)},o.renderScene=function(e,t,n,a,i,r){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];t*=Me.e.x,n*=Me.e.y,a*=Me.e.x,i*=Me.e.y,Me.b.setViewport(t,n,a,i),Me.b.setScissor(t,n,a,i),Me.b.setClearColor(0),s?ka.render(r):Me.b.render(o.currentScene.scene,e)},o.render=function(e){o.isRendering!==e&&(o.isRendering=e,e?o.update():cancelAnimationFrame(o.rafId))},o.update=function(){o.rafId=requestAnimationFrame(o.update),Je.update();var e=o.clock.getDelta();o.currentScene.update(e),Re.devCamera?o.renderScene(Ke,0,0,1,1,e,!1):o.renderScene(null,0,0,1,1,e,!0),ee.a.stats&&ke.update(Me.b)},e.appendChild(Me.b.domElement),Me.b.domElement.style.visibility="hidden",o.isRendering=!1,o.state=new pi({route:"",capture:!1}),o.sceneId=De.x,o.clock=new Ie.n(!0),je.c.add(Re,"devCamera").onChange((function(e){Object(Ue.b)("devCamera",e)})),o.gui=je.b.addFolder("webgl app"),o.gui.open(),o.scenes=(n={},Object(p.a)(n,De.x,new di),Object(p.a)(n,De.B,new Ua),Object(p.a)(n,De.C,new bo),Object(p.a)(n,De.w,new li),n),o.currentScene=o.scenes[o.sceneId],ka.setCurrentScene(o.currentScene),o.routesMap=(a={},Object(p.a)(a,v.k.Landing,De.x),Object(p.a)(a,v.k.Past,De.B),Object(p.a)(a,v.k.Present,De.C),Object(p.a)(a,v.k.Future,De.w),a);var i=ee.a.isDesktop?[1280,720]:[720,1280];return o.screenshot=new fi(o.gui,Me.b,i[0],i[1],2,ee.a.isDesktop),o.screenshot.gui.add(Object(_e.a)(o),"captureScreenShot"),o.gui.add(Object(_e.a)(o),"sceneId",Object.keys(o.scenes)).onChange((function(e){o.setScene(e),Object(Ue.b)("sceneId",e)})).listen(),o}return Object(he.a)(t,e),t}(Ce.a),gi=(n(162),n(65)),bi=n(97),xi=n(87),yi=(n(163),M.a.forwardRef((function(e,t){var n=e.progress,a=e.visible,o=Object(I.useRef)(null),i=Object(I.useRef)(null),r=Object(I.useCallback)((function(){bi.a.set(o.current,{autoAlpha:0,scaleX:0,transformOrigin:"0px 0px"})}),[]),s=Object(I.useCallback)(Object(He.a)(Ve.a.mark((function e(){return Ve.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:bi.a.to(o.current,0,{autoAlpha:1}),bi.a.to(o.current,1.3,{scaleX:1,ease:xi.a,clearProps:"transform"});case 2:case"end":return e.stop()}}),e)}))),[]),c=Object(I.useCallback)((function(){bi.a.to(o.current,.89,{autoAlpha:0}),bi.a.to(o.current,0,{scaleX:0,delay:.89})}),[]);return Object(I.useImperativeHandle)(t,(function(){return{animateInit:function(){return r()},animateIn:function(){return s()},animateOut:function(){return c()}}})),Object(I.useEffect)((function(){i.current&&(bi.a.set(i.current,{scaleX:n,transformOrigin:"0px 0px"}),1===n&&(bi.a.set(i.current,{scaleX:0}),c()))}),[n,c]),Object(I.useEffect)((function(){a&&s()}),[a,s,c]),M.a.createElement("div",{className:we()("ProgressBar"),ref:o},M.a.createElement("div",{className:"bar"},M.a.createElement("div",{className:"bar white",ref:i})))})));yi.defaultProps={};var wi=M.a.memo(yi),Ai=[De.y,De.G,De.H,De.I],Pi=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(ue.a)(this,(e=Object(de.a)(t)).call.apply(e,[this].concat(o)))).state={progress:0},n.onSceneStep=function(e){n.props.setSceneStep(e.step,e.data||{})},n.onSceneInteractionProgress=function(e){n.setState({progress:e})},n.onSceneInteractionStarted=function(){n.props.setInteractionStarted()},n.onAssetsLoaded=function(){n.props.setAssetsLoaded(!0)},n.onSceneComplete=function(){var e=v.g.indexOf(n.props.route);++e===v.g.length&&(e=0);var t=v.g[e];n.props.history.push(t)},n}return Object(he.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.app=new vi(this.container),Ee.j.delayedCall(2,(function(){e.app.load().then(e.onAssetsLoaded).catch((function(e){console.log("Failed to preload assets",e)}))})),this.app.on("sceneStep",this.onSceneStep),this.app.on("sceneInteractionProgress",this.onSceneInteractionProgress),this.app.on("sceneInteractionStarted",this.onSceneInteractionStarted),this.app.on("sceneComplete",this.onSceneComplete),this.progressBar.animateInit()}},{key:"componentDidUpdate",value:function(e,t){var n=this;this.props.windowSize.width===e.windowSize.width&&this.props.windowSize.height===e.windowSize.height||this.app.resize(this.props.windowSize.width,this.props.windowSize.height);var a=new pi(this.props);this.props.assetsLoaded!==e.assetsLoaded?this.app.setup(a).then((function(){n.app.setState(a),n.app.render(!0)})):this.props.assetsLoaded&&this.app.setState(a),this.props.audioContextState!==e.audioContextState&&"running"===this.props.audioContextState&&jn.a.toggle(!0),this.props.isMuted!==e.isMuted&&jn.a.toggle(!this.props.isMuted,!0)}},{key:"render",value:function(){var e=this,t=this.props.interactionStarted&&Ai.includes(this.props.sceneStep);return M.a.createElement("div",{id:"WebGL",ref:function(t){return e.container=t}},M.a.createElement(wi,{progress:this.state.progress,visible:t,ref:function(t){e.progressBar=t}}),M.a.createElement("div",{className:"vignette"}))}}]),t}(M.a.PureComponent);Pi.defaultProps={className:"",windowSize:{width:window.innerWidth,height:window.innerHeight}};var Ti=Object(me.a)(Object(k.b)((function(e,t){return{step:e.steps.currentStep,sceneStep:e.steps.sceneStep,data:e.steps.data,windowSize:e.windowSize,route:e.routing.location.pathname,capture:e.capture,isMuted:e.isMuted,assetsLoaded:e.steps.assetsLoaded,interactionStarted:e.steps.interactionStarted,audioContextState:e.audioContextState}}),(function(e){return{setSceneStep:function(t,n){return e(Object(gi.d)(t,n))},setAssetsLoaded:function(t){return e(Object(gi.b)(t))},setInteractionStarted:function(){return e(Object(gi.c)())}}}))(Pi)),Si=n(28),Fi=n.n(Si);X.a.register("isMuted",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.a.SET_IS_MUTED:return h(F(t.isMuted)),t.isMuted;default:return e}}));n(164);var Ei=function(e){var t=e.isMuted,n=e.setIsMuted,a=e.audioContextState,o=e.route,i=Object(I.useRef)(null),r=Object(I.useCallback)((function(){if(fe.Howler.ctx.state!==a&&$(fe.Howler.ctx.state),"suspended"===fe.Howler.ctx.state)switch(o){case v.k.Landing:jn.a.play(De.x,Ft.j);break;case v.k.Past:jn.a.play(De.B,Ft.k);break;case v.k.Present:jn.a.play(De.C,Ft.p);break;case v.k.Future:jn.a.play(De.w,Ft.c)}"running"===fe.Howler.ctx.state&&n(!t)}),[t,n,a,o]),s=t||"suspended"===fe.Howler.ctx.state,c=v.g.includes(o)?"":"hidden";return M.a.createElement("div",{ref:i,className:we()("SoundButton",{muted:s,hidden:c}),onClick:r,role:"button"},Array(11).fill(0).map((function(e,t){return M.a.createElement("span",{key:"sound-bar-".concat(t),className:"sound-bar"})})))};Ei.defaultProps={setIsMuted:Fi.a};var _i=M.a.memo(Object(k.b)((function(e){return{isMuted:e.isMuted,audioContextState:e.audioContextState,route:e.routing.location.pathname}}),(function(e){return{setIsMuted:function(t){return e(function(e){return{type:D.a.SET_IS_MUTED,isMuted:e}}(t))},setAudioContextState:function(t){return e($(t))}}}))(Ei));function Oi(){return(Oi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Ci(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Ii=M.a.createElement("g",{fill:"none",fillRule:"evenodd"},M.a.createElement("path",{fill:"#FFF",d:"M23.5414792,16 L15,16 C12.790861,16 11,17.790861 11,20 L11,27 C11,29.209139 12.790861,31 15,31 L31,31 C33.209139,31 35,29.209139 35,27 L35,20 C35,18.3184916 33.9624384,16.8793187 32.4926096,16.2877756 C32.383736,14.7299544 31.0855036,13.5 29.5,13.5 L26.5,13.5 C25.0135019,13.5 23.7795183,14.5811433 23.5414792,16 Z M23,46 C10.2974508,46 0,35.7025492 0,23 C0,10.2974508 10.2974508,0 23,0 C35.7025492,0 46,10.2974508 46,23 C46,35.7025492 35.7025492,46 23,46 Z"}),M.a.createElement("g",{transform:"translate(14 18)"},M.a.createElement("rect",{width:9,height:9,y:1,stroke:"#FFF",rx:4.5}),M.a.createElement("rect",{width:5,height:5,x:2,y:3,fill:"#FFF",rx:2.5}),M.a.createElement("path",{stroke:"#FFF",strokeLinecap:"round",strokeLinejoin:"round",d:"M13,1 L16,1"}))),Mi=function(e){var t=e.svgRef,n=e.title,a=Ci(e,["svgRef","title"]);return M.a.createElement("svg",Oi({width:46,height:46,viewBox:"0 0 46 46",ref:t},a),M.a.createElement("title",null,n),Ii)},Li=M.a.forwardRef((function(e,t){return M.a.createElement(Mi,Oi({svgRef:t},e))}));n.p;X.a.register("capture",(function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case D.a.SET_CAPTURE:return t.capture;default:return e}}));n(165);var Ni=function(e){var t=e.capture,n=e.setCapture,a=e.sceneStep,o=Object(I.useRef)(null),i=Object(I.useCallback)((function(){ee.a.inAppBrowser||n(!t)}),[t,n]),r=Object(I.useCallback)((function(){bi.a.set(o.current,{autoAlpha:0})}),[]),s=Object(I.useCallback)((function(){ee.a.inAppBrowser||(bi.a.killTweensOf(o.current),bi.a.to(o.current,.83,{autoAlpha:1}))}),[]),c=Object(I.useCallback)((function(){ee.a.inAppBrowser||(bi.a.killTweensOf(o.current),bi.a.to(o.current,.83,{autoAlpha:0}))}),[]);return Object(I.useEffect)((function(){switch(a){case De.y:case De.z:s();break;case De.F:case De.D:c();break;default:o.current&&r()}}),[a,r,s,c]),M.a.createElement("header",{className:"Nav"},M.a.createElement("nav",{"aria-labelledby":"page-navigation"},M.a.createElement(Li,{className:"share-button",onClick:i,ref:o,role:"button"}),M.a.createElement(_i,null)))};Ni.defaultProps={setCapture:Fi.a};var ki=Object(me.a)(Object(k.b)((function(e){return{capture:e.capture,sceneStep:e.steps.sceneStep}}),(function(e){return{setCapture:function(t){return e(function(e){return{type:D.a.SET_CAPTURE,capture:e}}(t))}}}))(Ni)),ji=n(88),Ui=n.n(ji),Ri=n(38),Di=n(56),Xi=n(82),zi=(n(169),M.a.forwardRef((function(e,t){var n=e.className,a=e.onClick;return M.a.createElement(Xi.a,{className:we()("CloseButton",n),ref:t,onClick:a},M.a.createElement("div",{className:"bar left"}),M.a.createElement("div",{className:"bar right"}))})));zi.defaultProps={onClick:Fi.a};var Yi=M.a.memo(zi),Bi=n(89);function Qi(){return(Qi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function Vi(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Hi=M.a.createElement("path",{d:"M21.92828,2.2286 C21.13144,2.5828 20.27388,2.82172 19.37408,2.92864 C20.2928,2.37864 20.99724,1.50744 21.32944,0.46816 C20.47012,0.97812 19.51884,1.34816 18.50552,1.54792 C17.6946,0.68376 16.53872,0.14344 15.25964,0.14344 C12.804,0.14344 10.813,2.13444 10.813,4.59052 C10.813,4.93856 10.85216,5.2778 10.92828,5.60384 C7.23228,5.41816 3.95516,3.64804 1.76176,0.95744 C1.37896,1.61392 1.15984,2.37776 1.15984,3.19352 C1.15984,4.73616 1.9448,6.09752 3.13808,6.8948 C2.40944,6.87148 1.72348,6.67128 1.12376,6.3382 C1.12332,6.35668 1.12332,6.3756 1.12332,6.39452 C1.12332,8.54876 2.65628,10.34572 4.69084,10.75492 C4.31772,10.85612 3.9248,10.91068 3.51912,10.91068 C3.23224,10.91068 2.95372,10.88296 2.68224,10.8306 C3.24852,12.5972 4.8906,13.88332 6.83628,13.91896 C5.31432,15.1118 3.39724,15.82284 1.3134,15.82284 C0.9548,15.82284 0.6006,15.80172 0.25256,15.76036 C2.22112,17.02272 4.5584,17.7584 7.06948,17.7584 C15.24952,17.7584 19.72212,10.9824 19.72212,5.10576 C19.72212,4.91304 19.71816,4.72076 19.7098,4.5298 C20.57836,3.90412 21.33252,3.12048 21.92828,2.2286 Z"}),Gi=function(e){var t=e.svgRef,n=e.title,a=Vi(e,["svgRef","title"]);return M.a.createElement("svg",Qi({width:22,height:18,viewBox:"0 0 22 18",ref:t},a),M.a.createElement("title",null,n),Hi)},Wi=M.a.forwardRef((function(e,t){return M.a.createElement(Gi,Qi({svgRef:t},e))}));n.p;function Zi(){return(Zi=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function qi(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var Ki=M.a.createElement("g",{transform:"translate(.8)"},M.a.createElement("path",{d:"M10.5314191,2.66453526e-14 L4.46858089,2.66453526e-14 C2.004595,2.66453526e-14 2.7533531e-14,2.004595 2.7533531e-14,4.46858089 L2.7533531e-14,10.5314191 C2.7533531e-14,12.995405 2.004595,15 4.46858089,15 L10.5314191,15 C12.995405,15 15,12.995405 15,10.5314191 L15,4.46858089 C15,2.004595 12.9953778,2.66453526e-14 10.5314191,2.66453526e-14 Z M13.4910006,10.5314191 C13.4910006,12.1659371 12.1659371,13.4910006 10.5314191,13.4910006 L4.46858089,13.4910006 C2.83406287,13.4910006 1.50899944,12.1659371 1.50899944,10.5314191 L1.50899944,4.46858089 C1.50899944,2.83403565 2.83406287,1.50899944 4.46858089,1.50899944 L10.5314191,1.50899944 C12.1659371,1.50899944 13.4910006,2.83403565 13.4910006,4.46858089 L13.4910006,10.5314191 L13.4910006,10.5314191 Z"}),M.a.createElement("path",{d:"M7.5,3.62046625 C5.36082166,3.62046625 3.62046625,5.36082166 3.62046625,7.49997278 C3.62046625,9.6391239 5.36082166,11.3795065 7.5,11.3795065 C9.63917834,11.3795065 11.3795337,9.63915112 11.3795337,7.49997278 C11.3795337,5.36079443 9.63917834,3.62046625 7.5,3.62046625 Z M7.5,9.8705343 C6.19077952,9.8705343 5.1294657,8.80922048 5.1294657,7.5 C5.1294657,6.19077952 6.19080674,5.1294657 7.5,5.1294657 C8.80922048,5.1294657 9.8705343,6.19077952 9.8705343,7.5 C9.8705343,8.80919326 8.80919326,9.8705343 7.5,9.8705343 Z"}),M.a.createElement("circle",{cx:11.387,cy:3.65,r:1})),$i=function(e){var t=e.svgRef,n=e.title,a=qi(e,["svgRef","title"]);return M.a.createElement("svg",Zi({viewBox:"0 0 16 15",ref:t},a),M.a.createElement("title",null,n),Ki)},Ji=M.a.forwardRef((function(e,t){return M.a.createElement($i,Zi({svgRef:t},e))})),er=(n.p,n(90));function tr(){return(tr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function nr(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var ar=M.a.createElement("path",{fillRule:"evenodd",d:"M10.442627,3.9670959 C13.3939428,-1.6086397 19.8338334,-1.10780268 20.9032998,4.22139821 C21.6269426,7.82734444 18.2891235,13.0868784 10.8898424,20 C10.8876467,19.9937045 10.885453,19.9874103 10.8832613,19.9811173 C10.8816485,19.9874103 10.880034,19.9937045 10.878418,20 C2.97097173,13.0868784 -0.624714177,7.82734444 0.0913602575,4.22139821 C1.14964129,-1.10780268 7.52217843,-1.6086397 10.442627,3.9670959 Z"}),or=function(e){var t=e.svgRef,n=e.title,a=nr(e,["svgRef","title"]);return M.a.createElement("svg",tr({width:21,height:20,viewBox:"0 0 21 20",ref:t},a),M.a.createElement("title",null,n),ar)},ir=M.a.forwardRef((function(e,t){return M.a.createElement(or,tr({svgRef:t},e))}));n.p;function rr(){return(rr=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function sr(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var cr=M.a.createElement("path",{d:"M262.6596,20.1742112 L262.6596,25.963665 L259.30324,25.963665 L259.30324,20.5619539 C259.30324,19.205 258.817779,18.278932 257.602888,18.278932 C256.675473,18.278932 256.123568,18.903034 255.880765,19.5067476 C255.792221,19.7225728 255.76943,20.0229733 255.76943,20.325085 L255.76943,25.963665 L252.411942,25.963665 C252.411942,25.963665 252.45716,16.8149393 252.411942,15.8670631 L255.769102,15.8670631 L255.769102,17.298216 C255.762294,17.3089199 255.753447,17.3204612 255.747039,17.3308374 L255.769102,17.3308374 L255.769102,17.298216 C256.215133,16.6112379 257.011699,15.6298665 258.79466,15.6298665 C261.003629,15.6298665 262.6596,17.0729248 262.6596,20.1742112 Z M248.899867,11 C247.751274,11 247,11.7533859 247,12.7441141 C247,13.7132524 247.729539,14.4895024 248.855303,14.4895024 L248.877731,14.4895024 C250.048568,14.4895024 250.776723,13.7133981 250.776723,12.7441141 C250.75466,11.7533859 250.048568,11 248.899867,11 Z M247.199405,25.963665 L250.555619,25.963665 L250.555619,15.8670631 L247.199405,15.8670631 L247.199405,25.963665 Z",transform:"translate(-247 -11)"}),lr=function(e){var t=e.svgRef,n=e.title,a=sr(e,["svgRef","title"]);return M.a.createElement("svg",rr({viewBox:"0 0 16 15",ref:t},a),M.a.createElement("title",null,n),cr)},ur=M.a.forwardRef((function(e,t){return M.a.createElement(lr,rr({svgRef:t},e))})),dr=(n.p,n(170),M.a.forwardRef((function(e,t){var n=e.className,a=e.global,o=e.credits,i=e.onModalClose,r=Object(I.useRef)(null),s=Object(I.useRef)(null),c=Object(I.useRef)(null),l=Object(I.useRef)(null),u=Object(I.useRef)(null),d=Object(I.useRef)(null),m=Object(I.useRef)(null),p=Object(I.useRef)(null),v=Object(I.useRef)(null),g=Object(I.useRef)(null),b=Object(I.useRef)(null),x=function(){var e=Object(He.a)(Ve.a.mark((function e(){return Ve.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ui()(1);case 2:f(A),b.current&&b.current.kill(),b.current=new Ri.a,b.current.to(l.current,.3,{autoAlpha:1}),b.current.to(g.current,1.2,{autoAlpha:1}),b.current.to(r.current,1.2,{autoAlpha:1},1),b.current.to(s.current,1.2,{autoAlpha:1},.98),b.current.to(c.current,1.2,{autoAlpha:1},1.32),Array.from(u.current.childNodes).forEach((function(e){b.current.to(e,en.f.randFloat(.4,1.4),{autoAlpha:1,onComplete:function(){e.classList.add("transition-in")}},0)})),b.current.to(m.current,.6,{autoAlpha:1},.84),b.current.set(m.current,{className:"+=transition-in"},.84),b.current.to(p.current,.6,{autoAlpha:1},1.02),b.current.set(p.current,{className:"+=transition-in"},1.02),b.current.to(v.current,.6,{autoAlpha:1},1.2),b.current.set(v.current,{className:"+=transition-in"},1.2);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=Object(He.a)(Ve.a.mark((function e(){return Ve.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Xe.h.to([l.current,r.current,g.current,s.current,c.current,d.current,m.current,p.current,v.current],.2,{autoAlpha:0,onComplete:i});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(I.useLayoutEffect)((function(){Xe.h.set([l.current,r.current,g.current,s.current,c.current,d.current,m.current,p.current,v.current],{autoAlpha:0}),x()}),[]);var w=function(){h(E)};return M.a.createElement("section",{className:we()("Credit",n),ref:t},M.a.createElement("div",{className:"background",ref:l}),M.a.createElement("div",{className:"scroll-container",ref:g},M.a.createElement("div",{className:"content-box"},M.a.createElement(Yi,{onClick:y,ref:r}),M.a.createElement("div",{className:"content"},M.a.createElement("div",{className:"title",ref:u},o.title.split("").map((function(e,t){return M.a.createElement("span",{className:32===e.charCodeAt(0)?"title-space":null,key:"credit-title-".concat(t)},e)})))),M.a.createElement("div",{className:"thank-you"},M.a.createElement(ir,{className:"heart-icon",ref:s}),M.a.createElement("p",{className:"made-by",ref:m},o.madeBy),M.a.createElement("p",{className:"collaborators",ref:p},o.collaborators),M.a.createElement("p",{className:"music-by",ref:v},o.musicBy),M.a.createElement("div",{className:"icons",ref:c},M.a.createElement(Di.a,{link:a.jam3link},M.a.createElement(er.a,{className:"jam3-logo logo"})),M.a.createElement(Di.a,{link:a.fwaUrl},M.a.createElement(Bi.a,{className:"fwa logo"})),M.a.createElement("span",{className:"separator"}),M.a.createElement(Di.a,{link:a.twitterUrl,onClick:w},M.a.createElement(Wi,{className:"twitter logo"})),M.a.createElement(Di.a,{link:a.instaUrl,onClick:w},M.a.createElement(Ji,{className:"instagram logo"})),M.a.createElement(Di.a,{link:a.linkedinUrl,onClick:w},M.a.createElement(ur,{className:"linkedin logo"})))))))})));dr.defaultProps={onModalClose:Fi.a};var hr=M.a.memo(dr),fr=n(72),mr=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(ue.a)(this,(e=Object(de.a)(t)).call.apply(e,[this].concat(o))))._keydownListener=function(e){27===e.keyCode&&n.props.setCreditClose()},n.setModalRoot=function(){n.modalRoot=document.querySelector("#modal-root")},n.getModalRoot=function(){return n.modalRoot},n.getModals=function(){return 0===n.props.modals.length?[]:n.props.modals.map((function(e){if(Object.values(fr.a).includes(e)){if(e===fr.a.CREDIT)return M.a.createElement(hr,{key:"modal-".concat(e),global:n.props.copy.global,credits:n.props.copy.credits,onModalClose:function(){return n.props.setCreditClose()}});n.props.setModalClose(e)}return!1})).filter(Boolean)},n}return Object(he.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){0}},{key:"componentDidUpdate",value:function(e){e.modals!==this.props.modals&&(this.props.modals.length>0?document.addEventListener("keydown",this._keydownListener):document.removeEventListener("keydown",this._keydownListener))}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this._keydownListener)}},{key:"render",value:function(){this.getModalRoot()||this.setModalRoot();var e=this.getModals();return e.length>0&&N.a.createPortal(e,this.getModalRoot())}}]),t}(M.a.PureComponent);mr.defaultProps={setModalOpen:Fi.a,setModalClose:Fi.a,setCreditClose:Fi.a};var pr=Object(k.b)((function(e){return{modals:e.modals,copy:e.copy}}),(function(e){return{setModalOpen:function(t){return e(Object(B.c)(t))},setModalClose:function(t){return e(Object(B.b)(t))},setCreditClose:function(){return e(Object(B.b)(fr.a.CREDIT))}}}))(mr),vr=(n(171),function(e){function t(){return Object(c.a)(this,t),Object(ue.a)(this,Object(de.a)(t).apply(this,arguments))}return Object(he.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){Ee.j.set(this.container,{autoAlpha:0}),this.animateIn()}},{key:"componentDidUpdate",value:function(e){this.props.assetsLoaded!==e.assetsLoaded&&this.props.assetsLoaded&&this.animateOut()}},{key:"animateIn",value:function(){var e=this;Ee.j.to(this.container,.5,{autoAlpha:1}),Ee.j.to(this.text,1,{autoAlpha:1,delay:.5,onComplete:function(){e.container.classList.add("ready")}})}},{key:"animateOut",value:function(){Ee.j.to(this.container,1,{autoAlpha:0,delay:.5})}},{key:"render",value:function(){var e=this;return M.a.createElement("section",{id:"Preloader",ref:function(t){return e.container=t}},M.a.createElement("p",{ref:function(t){return e.text=t}},this.props.copy.global.loading))}}]),t}(M.a.PureComponent));vr.defaultProps={className:""};var gr=Object(k.b)((function(e,t){return{copy:e.copy,assetsLoaded:e.steps.assetsLoaded}}),(function(e){return{}}),void 0,{withRef:!0})(vr),br=(n(172),function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(ue.a)(this,Object(de.a)(t).call(this,e))).preventScrolling=function(e){e.preventDefault(),e.stopPropagation()},n.setOrientationParentClass=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.state.orientation;"landscape"===e?document.body.classList.add("rotate-screen-visible"):document.body.classList.remove("rotate-screen-visible")},n.handleOrientationChange=function(){o.d.getOrientation()!==n.state.orientation&&(n.setState({orientation:o.d.getOrientation()}),"landscape"===o.d.getOrientation()&&f(w))},n.state={orientation:o.d.getOrientation()},n}return Object(he.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){this.setOrientationParentClass(),o.e.isAndroid?window.addEventListener("orientationchange",this.handleOrientationChange):window.addEventListener("resize",this.handleOrientationChange),this.container.addEventListener("touchmove",this.preventScrolling,{passive:!1})}},{key:"componentDidUpdate",value:function(e,t){this.state.orientation!==t.orientation&&this.setOrientationParentClass()}},{key:"componentWillUnmount",value:function(){o.e.isAndroid?window.removeEventListener("orientationchange",this.handleOrientationChange):window.removeEventListener("resize",this.handleOrientationChange),this.container.removeEventListener("touchmove",this.preventScrolling)}},{key:"render",value:function(){var e=this,t={visibility:"landscape"===this.state.orientation?"visible":"hidden"};return M.a.createElement("div",{className:we()("RotateScreen",this.props.className),style:t,ref:function(t){return e.container=t}},M.a.createElement("div",{className:"container"},this.props.iconSrc&&M.a.createElement("img",{src:this.props.iconSrc,className:"rotate-icon",alt:this.props.iconAlt}),this.props.copy&&M.a.createElement("p",{className:"rotate-text"},this.props.copy),this.props.children))}}]),t}(I.PureComponent));br.defaultProps={copy:"Please rotate your device into portrait mode.",iconAlt:"Please rotate your device"};var xr=n(100),yr={iconSrc:n.n(xr).a},wr=n(51),Ar=function(e){function t(){var e,n;Object(c.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(ue.a)(this,(e=Object(de.a)(t)).call.apply(e,[this].concat(o)))).handleResize=ve()((function(){var e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;n.props.setLayout(e,t,Z.all),setTimeout((function(){return window.scrollTo(0,(window.scrollY+1)%2)}),300)}),ee.a.resizeDebounceTime),n}return Object(he.a)(t,e),Object(le.a)(t,[{key:"componentDidMount",value:function(){var e,t,n=this;if(se.listen((function(e,t){"POP"===t&&h(S)})),window.addEventListener("resize",this.handleResize),"suspended"===fe.Howler.ctx.state)var a=setInterval((function(){"running"===fe.Howler.ctx.state&&(n.props.setAudioContextState(fe.Howler.ctx.state),clearInterval(a))}),100);else this.props.setAudioContextState(fe.Howler.ctx.state),jn.a.toggle(!0);o.d.isDesktop||document.addEventListener("gesturestart",(function(e){e.preventDefault()})),h((e=Object(Me.c)(),t=Object(wr.c)(),new u({event:"device",action:"Gpu",label:"".concat(e," | ").concat(t)})))}},{key:"componentDidUpdate",value:function(e,t){e.location.pathname!==this.props.location.pathname&&this.props.setPreviousRoute(e.location.pathname)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){return M.a.createElement(I.Fragment,null,M.a.createElement(I.Fragment,null,M.a.createElement(gr,null),M.a.createElement(Ti,null),M.a.createElement(Fe,null),M.a.createElement(ki,null),M.a.createElement(pr,null)),o.d.isMobile&&M.a.createElement(I.Suspense,{fallback:M.a.createElement("div",{className:"loading"})},M.a.createElement(br,yr)))}}]),t}(M.a.PureComponent);Ar.defaultProps={};var Pr=Object(me.a)(Object(k.b)((function(e){return{layout:e.layout,isMobileMenuOpen:e.isMobileMenuOpen}}),(function(e){return{setPreviousRoute:function(t){return e((n=t,{type:D.a.SET_PREV_ROUTE,previousRoute:n}));var n},setLayout:function(t,n,a){return e((o=[(i={width:t,height:n},{type:D.a.SET_WINDOW_SIZE,windowSize:i}),K(a)],{type:D.a.BATCH_ACTIONS,actions:o}));var o,i},setIsMobileMenuOpen:function(t){return e((n=t,{type:D.a.SET_IS_MOBILE_MENU_OPEN,isOpen:n}));var n},setAudioContextState:function(t){return e($(t))}}}))(Ar));U.a,n(173);"fwa100.jam3.com"===window.location.host&&"/"!==window.location.pathname&&(window.location.pathname="/"),a.a.initialize("UA-144183274-1"),function(){var e=document.getElementById("root"),t=[o.d.isMobile?"mobile":"",o.d.getType(),o.b.getName()].filter((function(e){return Boolean(e)}));document.body.className=[].concat(Object(C.a)(document.body.className.split(" ")),Object(C.a)(t)).filter(Boolean).join(" ");var n;n=M.a.createElement(Pr,null),N.a.render(M.a.createElement(k.a,{store:ce},M.a.createElement(j.a,{history:se},n)),e)}()}],[[102,5,6]]]);