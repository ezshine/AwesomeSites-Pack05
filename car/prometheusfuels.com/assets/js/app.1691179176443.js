// --------------------------------------
// 
//    _  _ _/ .  _  _/ /_ _  _  _        
//   /_|/_ / /|//_  / / //_ /_// /_/     
//   https://activetheory.net    _/      
// 
// --------------------------------------
//   8/4/23 12:59p
// --------------------------------------

"undefined"==typeof console&&(window.console={},console.log=console.error=console.info=console.debug=console.warn=console.trace=function(){}),window.performance=window.performance&&window.performance.now?window.performance:Date,Date.now=Date.now||function(){return+new Date},window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(){const start=Date.now();return function(callback){window.setTimeout((()=>callback(Date.now()-start)),1e3/60)}}()),window.defer=window.requestAnimationFrame,window.clearTimeout=function(){const _clearTimeout=window.clearTimeout;return function(ref){return window.Timer&&Timer.__clearTimeout(ref)||_clearTimeout(ref)}}(),window.requestIdleCallback=function(){const _requestIdleCallback=window.requestIdleCallback;return function(callback,max){return _requestIdleCallback?_requestIdleCallback(callback,max?{timeout:max}:null):defer((()=>{callback({didTimeout:!1})}),0)}}(),window.onIdle=window.requestIdleCallback,"undefined"==typeof Float32Array&&(Float32Array=Array),Math.sign=function(x){return 0===(x=+x)||isNaN(x)?Number(x):x>0?1:-1},Math._round=Math.round,Math.round=function(value,precision=0){let p=Math.pow(10,precision);return Math._round(value*p)/p},Math._random=Math.random,Math.rand=Math.random=function(min,max,precision=0){return void 0===min?Math._random():min===max?min:(min=min||0,max=max||1,0==precision?Math.floor(Math._random()*(max+1-min)+min):Math.round(min+Math._random()*(max-min),precision))},Math.degrees=function(radians){return radians*(180/Math.PI)},Math.radians=function(degrees){return degrees*(Math.PI/180)},Math.clamp=function(value,min=0,max=1){return Math.min(Math.max(value,Math.min(min,max)),Math.max(min,max))},Math.map=Math.range=function(value,oldMin=-1,oldMax=1,newMin=0,newMax=1,isClamp){const newValue=(value-oldMin)*(newMax-newMin)/(oldMax-oldMin)+newMin;return isClamp?Math.clamp(newValue,Math.min(newMin,newMax),Math.max(newMin,newMax)):newValue},Math.mix=function(a,b,alpha){return a*(1-alpha)+b*alpha},Math.step=function(edge,value){return value<edge?0:1},Math.smoothStep=function(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)},Math.fract=function(value){return value-Math.floor(value)};{const mainThread=!!window.document;Math.lerp=function(target,value,alpha,calcHz=!0){let hz=mainThread&&calcHz?Render.HZ_MULTIPLIER:1;return value+(target-value)*Math.clamp(alpha*hz,0,1)}}Math.mod=function(value,n){return(value%n+n)%n},Array.prototype.shuffle=function(){let temp,r,i=this.length-1;for(;i>0;)r=Math.random(0,i,0),i-=1,temp=this[i],this[i]=this[r],this[r]=temp;return this},Array.storeRandom=function(arr){arr.randomStore=[]},Array.prototype.random=function(range){let value=Math.random(0,this.length-1);if(arguments.length&&!this.randomStore&&Array.storeRandom(this),!this.randomStore)return this[value];if(range>this.length-1&&(range=this.length),range>1){for(;~this.randomStore.indexOf(value);)(value+=1)>this.length-1&&(value=0);this.randomStore.push(value),this.randomStore.length>=range&&this.randomStore.shift()}return this[value]},Array.prototype.remove=function(element){if(!this.indexOf)return;const index=this.indexOf(element);return~index?this.splice(index,1):void 0},Array.prototype.last=function(){return this[this.length-1]},window.Promise=window.Promise||{},Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function flat(){var depth=isNaN(arguments[0])?1:Number(arguments[0]);return depth?Array.prototype.reduce.call(this,(function(acc,cur){return Array.isArray(cur)?acc.push.apply(acc,flat.call(cur,depth-1)):acc.push(cur),acc}),[]):Array.prototype.slice.call(this)},writable:!0}),Promise.create=function(){const promise=new Promise(((resolve,reject)=>{this.temp_resolve=resolve,this.temp_reject=reject}));return promise.resolve=this.temp_resolve,promise.reject=this.temp_reject,delete this.temp_resolve,delete this.temp_reject,promise},Promise.catchAll=function(array){return Promise.all(array.map((promise=>promise.catch((error=>{Promise.reject(error)})))))},Promise.timeout=function(promise,timeout){return Array.isArray(promise)&&(promise=Promise.all(promise)),Promise.race([promise,Timer.delayedCall(timeout)])},String.prototype.includes=function(str){if(!Array.isArray(str))return!!~this.indexOf(str);for(let i=str.length-1;i>=0;i--)if(~this.indexOf(str[i]))return!0;return!1},String.prototype.equals=function(str){let compare=String(this);if(!Array.isArray(str))return str===compare;for(let i=str.length-1;i>=0;i--)if(str[i]===compare)return!0;return!1},String.prototype.strpos=function(str){return console.warn("strpos deprecated: use .includes()"),this.includes(str)},String.prototype.clip=function(num,end=""){return this.length>num?this.slice(0,Math.max(0,num-end.length)).trim()+end:this.slice()},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.replaceAll=function(find,replace){return this.split(find).join(replace)},String.prototype.replaceAt=function(index,replacement){return this.substr(0,index)+replacement+this.substr(index+replacement.length)},(!window.fetch||!window.AURA&&location.protocol.includes("file"))&&(window.fetch=function(url,options){options=options||{};const promise=Promise.create(),request=new XMLHttpRequest;request.open(options.method||"get",url),url.includes(".ktx")&&(request.responseType="arraybuffer");for(let i in options.headers)request.setRequestHeader(i,options.headers[i]);function response(){let header,keys=[],all=[],headers={};return request.getAllResponseHeaders().replace(/^(.*?):\s*([\s\S]*?)$/gm,((m,key,value)=>{keys.push(key=key.toLowerCase()),all.push([key,value]),header=headers[key],headers[key]=header?`${header},${value}`:value})),{ok:1==(request.status/200|0),status:request.status,statusText:request.statusText,url:request.responseURL,clone:response,text:()=>Promise.resolve(request.responseText),json:()=>Promise.resolve(request.responseText).then(JSON.parse),xml:()=>Promise.resolve(request.responseXML),blob:()=>Promise.resolve(new Blob([request.response])),arrayBuffer:()=>Promise.resolve(request.response),headers:{keys:()=>keys,entries:()=>all,get:n=>headers[n.toLowerCase()],has:n=>n.toLowerCase()in headers}}}return request.onload=()=>{promise.resolve(response())},request.onerror=promise.reject,request.send(options.body),promise}),window.get=function(url,options={credentials:"same-origin"}){let promise=Promise.create();return options.method="GET",fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.post=function(url,body={},options={}){let promise=Promise.create();return options.method="POST",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),options.headers||(options.headers={"content-type":"application/json"}),fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes("[")||text.charAt(0).includes("{"))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.put=function(url,body,options={}){let promise=Promise.create();return options.method="PUT",body&&(options.body="object"==typeof body||Array.isArray(body)?JSON.stringify(body):body),fetch(url,options).then((function handleResponse(e){if(!e.ok)return promise.reject(e);e.text().then((text=>{if(text.charAt(0).includes(["[","{"]))try{promise.resolve(JSON.parse(text))}catch(err){promise.resolve(text)}else promise.resolve(text)}))})).catch(promise.reject),promise},window.Class=function(_class,_type,_static){const _this=this||window,_name=_class.name||_class.toString().match(/function ?([^\(]+)/)[1];"function"==typeof _type&&(_static=_type,_type=null),(_type=(_type||"").toLowerCase())?"static"==_type?_this[_name]=new _class:"singleton"==_type&&(_this[_name]=_class,function(){let _instance;_this[_name].instance=function(a,b,c){return _instance||(_instance=new _class(a,b,c)),_instance}}(),_static&&_static()):(_this[_name]=_class,_static&&_static()),this&&this!==window&&(this[_name]._namespace=this.__namespace)},window.Inherit=function(child,parent){const args=[].slice.call(arguments,2);parent.apply(child,args);const save={};for(let method in child)save[method]=child[method];defer((()=>{for(let method in child)if(save[method]&&child[method]!==save[method]){if("destroy"==method&&child.destroy&&!child.__element)throw"Do not override destroy directly, use onDestroy :: "+child.constructor.toString();child["_"+method]=save[method]}}))},window.Namespace=function(obj){"string"==typeof obj?window[obj]||(window[obj]={Class:Class,__namespace:obj}):(obj.Class=Class,obj.__namespace=obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1])},window.Global={},window.THREAD=!1,Class((function Hydra(){const _this=this,_readyPromise=Promise.create();var _base,_callbacks=[];function initLoad(){return document&&window?window._NODE_?setTimeout(loaded,1):window._AURA_?window.Main?setTimeout(loaded,1):setTimeout(initLoad,1):void window.addEventListener("load",loaded,!1):setTimeout(initLoad,1)}function loaded(){window.removeEventListener("load",loaded,!1),_this.LOCAL=(!window._BUILT_||location.pathname.toLowerCase().includes("platform"))&&(location.hostname.indexOf("local")>-1||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&""==location.port,_callbacks.forEach((cb=>cb())),_callbacks=null,_readyPromise.resolve(),window.Main&&_readyPromise.then((()=>Hydra.Main=new window.Main))}this.HASH=window.location.hash.slice(1),this.LOCAL=!window._BUILT_&&(location.hostname.indexOf("local")>-1||"10"==location.hostname.split(".")[0]||"192"==location.hostname.split(".")[0]||/atdev.online$/.test(location.hostname))&&""==location.port,initLoad(),this.__triggerReady=function(){loaded()},this.ready=function(callback){if(!callback)return _readyPromise;_callbacks?_callbacks.push(callback):callback()},this.absolutePath=function(path){if(window.AURA)return path;let base=_base;if(void 0===base)try{if(document.getElementsByTagName("base").length>0){var a=document.createElement("a");a.href=document.getElementsByTagName("base")[0].href,base=a.pathname,_base=base}}catch(e){_base=null}let pathname=base||location.pathname;pathname.includes("/index.html")&&(pathname=pathname.replace("/index.html",""));let port=Number(location.port)>1e3?`:${location.port}`:"";return path.includes("http")?path:(location.protocol.length?location.protocol+"//":"")+(location.hostname+port+pathname+"/"+path).replace("//","/")}}),"Static"),Class((function Utils(){var _queries={},_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null;this.query=this.queryParams=function(key,value){if(void 0!==value&&(_queries[key]=value),void 0!==_queries[key])return _queries[key];if(_searchParams)"0"===(value=_searchParams.get(key))?value=0:"false"===value||null===value?value=!1:""===value&&(value=!0);else{let escapedKey=encodeURIComponent(key).replace(/[\.\+\*]/g,"\\$&");"0"==(value=decodeURIComponent(window.location.search.replace(new RegExp(`^(?:.*?[&?]${escapedKey}(?:=([^&]*)|[&$]))?.*$`,"i"),"$1")))?value=0:"false"==value?value=!1:value.length||(value=new RegExp(`[&?]${escapedKey}(?:[&=]|$)`,"i").test(window.location.search))}return _queries[key]=value,value},this.addQuery=function(query,value){return _queries[query]===value?_queries[query]:(this.removeQuery(query),window.history.replaceState({},document.title,`${location.pathname}${this.addParam(location.search,query,value)}`),_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null,_queries[query]=value)},this.removeQuery=function(query){return window.history.replaceState({},document.title,`${location.pathname}${this.removeParam(location.search,query)}`),_searchParams=window.URLSearchParams?new URLSearchParams(window.location.search):null,delete _queries[query]},this.addParam=function(url,param,value){let u=url.split("?"),addedParam=encodeURIComponent(param)+"="+value,pars=u[1]?u[1].split(/[&;]/g):[];return pars.push(addedParam),url=u[0]+(pars.length>0?"?"+pars.join("&"):"")},this.removeParam=function(url,param){let u=url.split("?");if(u.length>=2){let prefix=encodeURIComponent(param)+"=",pars=u[1].split(/[&;]/g);for(let i=pars.length;i-- >0;)-1!==pars[i].lastIndexOf(prefix,0)&&pars.splice(i,1);return url=u[0]+(pars.length>0?"?"+pars.join("&"):"")}return url},this.getConstructorName=function(obj){return obj?"function"==typeof obj?obj.toString().match(/function ([^\(]+)/)[1]:obj.constructor.name||obj.constructor.toString().match(/function ([^\(]+)/)[1]:obj},this.nullObject=function(object){if(object&&(object.destroy||object.div))for(var key in object)void 0!==object[key]&&(object[key]=null);return null},this.cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))},this.headsTails=function(n0,n1){return Math.random(0,1)?n1:n0},this.mergeObject=function(){for(var obj={},i=0;i<arguments.length;i++){var o=arguments[i];for(var key in o)obj[key]=o[key]}return obj},this.timestamp=this.uuid=function(){return Date.now()+"xx-4xx-yxx-xxx".replace(/[xy]/g,(function(c){let r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)}))},this.randomColor=function(){var color="#"+Math.floor(16777215*Math.random()).toString(16);return color.length<7&&(color=this.randomColor()),color},this.numberWithCommas=function(num){return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},this.padInt=function(num,digits,isLimit){isLimit&&(num=Math.min(num,Math.pow(10,digits)-1));let str=Math.floor(num).toString();return Math.pow(10,Math.max(0,digits-str.length)).toString().slice(1)+str},this.copyToClipboard=function(string){try{var el=document.createElement("textarea"),range=document.createRange();el.contentEditable=!0,el.readOnly=!0,el.value=string,document.body.appendChild(el),el.select(),range.selectNodeContents(el);var s=window.getSelection();return s.removeAllRanges(),s.addRange(range),el.setSelectionRange(0,string.length),document.execCommand("copy"),document.body.removeChild(el),!0}catch(e){return!1}},this.stringList=function(items=[],limit=0,options={}){if(0===items.length)return"";let output="",printed=0;"object"==typeof limit&&(options=limit,limit=0),options.oxford=!0===options.oxford,options.more=!1!==options.more&&(options.more?options.more:"more"),options.and=options.and?options.and:"&",options.comma=options.comma?options.comma:",",isNaN(options.limit)||(limit=options.limit),0===limit&&(limit=items.length);do{output=`${output}${items.shift()}${options.comma} `,printed++}while(items.length>1&&printed+1<limit);if(output=output.trim(),output=output.slice(0,output.length-1),1===items.length)output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${items.shift()}`;else if(items.length>1&&options.more){let more=`${items.length} ${options.more}`;output=`${output}${options.oxford&&printed>1?options.comma:""} ${options.and} ${more}`}return output},this.debounce=function(callback,time=100){clearTimeout(callback.__interval),callback.__interval=Timer.create(callback,time)}}),"Static"),Class((function Render(){const _this=this,_render=[],_native=[],_drawFrame=[],_multipliers=[];var _last=performance.now(),_localTSL=0,_elapsed=0,_capLast=0,_sampleRefreshRate=[],_firstSample=!1,_saveRefreshRate=60,rAF=requestAnimationFrame,_refreshScale=1,_canCap=0;function render(tsl){if(_native.length){let multiplier=60/_saveRefreshRate;for(let i=_native.length-1;i>-1;i--)_native[i](multiplier)}if(_this.capFPS>0&&++_canCap>31){let delta=tsl-_capLast;if(_capLast=tsl,(_elapsed+=delta)<1e3/_this.capFPS)return rAF(render);_this.REFRESH_RATE=_this.capFPS,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_elapsed=0}if(_this.timeScaleUniform.value=1,_multipliers.length)for(let i=0;i<_multipliers.length;i++){let obj=_multipliers[i];_this.timeScaleUniform.value*=obj.value}_this.DT=tsl-_last,_last=tsl;let delta=_this.DT*_this.timeScaleUniform.value;if(delta=Math.min(200,delta),_this.startFrame&&_this.startFrame(tsl,delta),_sampleRefreshRate&&!_this.capFPS){let fps=1e3/_this.DT;if(_sampleRefreshRate.push(fps),_sampleRefreshRate.length>30){_sampleRefreshRate.sort(((a,b)=>a-b));let rate=_sampleRefreshRate[Math.round(_sampleRefreshRate.length/2)];rate=_this.REFRESH_TABLE.reduce(((prev,curr)=>Math.abs(curr-rate)<Math.abs(prev-rate)?curr:prev)),_this.REFRESH_RATE=_saveRefreshRate=_firstSample?Math.max(_this.REFRESH_RATE,rate):rate,_this.HZ_MULTIPLIER=60/_this.REFRESH_RATE*_refreshScale,_sampleRefreshRate=null,_firstSample=!0}}_this.TIME=tsl,_this.DELTA=delta,_localTSL+=delta;for(let i=_render.length-1;i>=0;i--){var callback=_render[i];if(callback)if(callback.fps){if(tsl-callback.last<1e3/callback.fps)continue;callback(++callback.frame),callback.last=tsl}else callback(tsl,delta);else _render.remove(callback)}for(let i=_drawFrame.length-1;i>-1;i--)_drawFrame[i](tsl,delta);_this.drawFrame&&_this.drawFrame(tsl,delta),_this.endFrame&&_this.endFrame(tsl,delta),THREAD||_this.isPaused||rAF(render)}this.timeScaleUniform={value:1,type:"f",ignoreUIL:!0},this.REFRESH_TABLE=[30,60,72,90,100,120,144,240],this.REFRESH_RATE=60,this.HZ_MULTIPLIER=1,this.capFPS=null,THREAD||(rAF(render),setInterval((_=>_sampleRefreshRate=[]),3e3)),this.now=function(){return _localTSL},this.setRefreshScale=function(scale){_refreshScale=scale,_sampleRefreshRate=[]},this.start=function(callback,fps,native){fps&&(callback.fps=fps,callback.last=-1/0,callback.frame=-1),native?~_native.indexOf(callback)||_native.unshift(callback):~_render.indexOf(callback)||_render.unshift(callback)},this.stop=function(callback){_render.remove(callback),_native.remove(callback)},this.tick=function(){THREAD&&(this.TIME=performance.now(),render(this.TIME))},this.forceRender=function(time){this.TIME=time,render(this.TIME)},this.Worker=function(_callback,_budget=4){Inherit(this,Component);let _scope=this,_elapsed=0;function loop(){if(!_scope.dead){for(;_elapsed<_budget;){if(_scope.dead||_scope.paused)return;const start=performance.now();_callback&&_callback(),_elapsed+=performance.now()-start}_elapsed=0}}this.startRender(loop),this.stop=function(){this.dead=!0,this.stopRender(loop)},this.pause=function(){this.paused=!0,this.stopRender(loop)},this.resume=function(){this.paused=!1,this.startRender(loop)},this.setCallback=function(cb){_callback=cb}},this.pause=function(){_this.isPaused=!0},this.resume=function(){_this.isPaused&&(_this.isPaused=!1,rAF(render))},this.useRAF=function(raf){_firstSample=null,_last=performance.now(),(rAF=raf)(render)},this.onDrawFrame=function(cb){_drawFrame.push(cb)},this.setTimeScale=function(v){_this.timeScaleUniform.value=v},this.getTimeScale=function(){return _this.timeScaleUniform.value},this.createTimeMultiplier=function(){let obj={value:1};return _multipliers.push(obj),obj},this.destroyTimeMultiplier=function(obj){_multipliers.remove(obj)},this.tweenTimeScale=function(value,time,ease,delay){return tween(_this.timeScaleUniform,{value:value},time,ease,delay,null,null,!0)}}),"Static"),Class((function Timer(){const _this=this,_callbacks=[],_discard=[],_deferA=[],_deferB=[];var _defer=_deferA;function loop(t,delta){for(let i=_discard.length-1;i>=0;i--){let obj=_discard[i];obj.callback=null,_callbacks.remove(obj)}_discard.length&&(_discard.length=0);for(let i=_callbacks.length-1;i>=0;i--){let obj=_callbacks[i];obj?(obj.scaledTime?obj.current+=delta:obj.current+=Render.DT,obj.current>=obj.time&&(obj.callback&&obj.callback(),_discard.push(obj))):_callbacks.remove(obj)}for(let i=_defer.length-1;i>-1;i--)_defer[i]();_defer.length=0,_defer=_defer==_deferA?_deferB:_deferA}Render.start(loop),this.__clearTimeout=function(ref){const obj=function find(ref){for(let i=_callbacks.length-1;i>-1;i--)if(_callbacks[i].ref==ref)return _callbacks[i]}(ref);return!!obj&&(obj.callback=null,_callbacks.remove(obj),!0)},this.create=function(callback,time,scaledTime){if(window._NODE_)return setTimeout(callback,time);const obj={time:Math.max(1,time||1),current:0,ref:Utils.timestamp(),callback:callback,scaledTime:scaledTime};return _callbacks.unshift(obj),obj.ref},this.delayedCall=function(time){let promise=Promise.create();return _this.create(promise.resolve,time),promise},window.defer=this.defer=function(callback){let promise;return callback||(promise=Promise.create(),callback=promise.resolve),(_defer==_deferA?_deferB:_deferA).unshift(callback),promise}}),"static"),Class((function Events(){const _this=this;this.events={};const _e={},_linked=[];let _emitter;this.events.sub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),callback;let emitter=obj.events.emitter();return emitter._addEvent(evt,callback.resolve?callback.resolve:callback,this),emitter._saveLink(this),_linked.push(emitter),callback},this.events.wait=async function(obj,evt){const promise=Promise.create(),args=[obj,evt,e=>{_this.events.unsub(...args),promise.resolve(e)}];return"object"!=typeof obj&&args.splice(1,1),_this.events.sub(...args),promise},this.events.unsub=function(obj,evt,callback){if("object"!=typeof obj&&(callback=evt,evt=obj,obj=null),!obj)return Events.emitter._removeEvent(evt,callback.resolve?callback.resolve:callback);obj.events.emitter()._removeEvent(evt,callback.resolve?callback.resolve:callback)},this.events.fire=function(evt,obj,isLocalOnly){(obj=obj||_e).target=this,Events.emitter._check(evt),_emitter&&_emitter._fireEvent(evt,obj)||isLocalOnly||Events.emitter._fireEvent(evt,obj)},this.events.bubble=function(obj,evt){_this.events.sub(obj,evt,(e=>_this.events.fire(evt,e)))},this.events.destroy=function(){return Events.emitter._destroyEvents(this),_linked&&_linked.forEach((emitter=>emitter._destroyEvents(this))),_emitter&&_emitter.links&&_emitter.links.forEach((obj=>obj.events&&obj.events._unlink(_emitter))),null},this.events.emitter=function(){return _emitter||(_emitter=Events.emitter.createLocalEmitter()),_emitter},this.events._unlink=function(emitter){_linked.remove(emitter)}}),(()=>{Events.emitter=new function Emitter(){const prototype=Emitter.prototype;if(this.events=[],void 0!==prototype._check)return;prototype._check=function(evt){if(void 0===evt)throw"Undefined event"},prototype._addEvent=function(evt,callback,object){this._check(evt),this.events.push({evt:evt,object:object,callback:callback})},prototype._removeEvent=function(eventString,callback){this._check(eventString);for(let i=this.events.length-1;i>=0;i--)this.events[i].evt===eventString&&this.events[i].callback===callback&&this._markForDeletion(i)},prototype._sweepEvents=function(){for(let i=0;i<this.events.length;i++)this.events[i].markedForDeletion&&(delete this.events[i].markedForDeletion,this.events.splice(i,1),--i)},prototype._markForDeletion=function(i){this.events[i].markedForDeletion=!0,this._sweepScheduled||(this._sweepScheduled=!0,defer((()=>{this._sweepScheduled=!1,this._sweepEvents()})))},prototype._fireEvent=function(eventString,obj){this._check&&this._check(eventString),obj=obj||_e;let called=!1;for(let i=0;i<this.events.length;i++){let evt=this.events[i];evt.evt!=eventString||evt.markedForDeletion||(evt.callback(obj),called=!0)}return called},prototype._destroyEvents=function(object){for(var i=this.events.length-1;i>=0;i--)this.events[i].object===object&&this._markForDeletion(i)},prototype._saveLink=function(obj){this.links||(this.links=[]),~this.links.indexOf(obj)||this.links.push(obj)},prototype.createLocalEmitter=function(){return new Emitter}},Events.broadcast=Events.emitter._fireEvent,Events.VISIBILITY="hydra_visibility",Events.HASH_UPDATE="hydra_hash_update",Events.COMPLETE="hydra_complete",Events.PROGRESS="hydra_progress",Events.CONNECTIVITY="hydra_connectivity",Events.UPDATE="hydra_update",Events.LOADED="hydra_loaded",Events.END="hydra_end",Events.FAIL="hydra_fail",Events.SELECT="hydra_select",Events.ERROR="hydra_error",Events.READY="hydra_ready",Events.RESIZE="hydra_resize",Events.CLICK="hydra_click",Events.HOVER="hydra_hover",Events.MESSAGE="hydra_message",Events.ORIENTATION="orientation",Events.BACKGROUND="background",Events.BACK="hydra_back",Events.PREVIOUS="hydra_previous",Events.NEXT="hydra_next",Events.RELOAD="hydra_reload",Events.UNLOAD="hydra_unload",Events.FULLSCREEN="hydra_fullscreen";const _e={};Hydra.ready((()=>{let box;!function(){let _last,_lastTime=performance.now();function onfocus(){Render.blurTime=-1,"focus"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"focus"}),_last="focus"}function onblur(){Render.blurTime=Date.now(),"blur"!=_last&&Events.emitter._fireEvent(Events.VISIBILITY,{type:"blur"}),_last="blur"}Timer.create((function addVisibilityHandler(){let hidden,eventName;if([["msHidden","msvisibilitychange"],["webkitHidden","webkitvisibilitychange"],["hidden","visibilitychange"]].forEach((d=>{void 0!==document[d[0]]&&(hidden=d[0],eventName=d[1])})),!eventName){const root="ie"==Device.browser?document:window;return root.onfocus=onfocus,void(root.onblur=onblur)}document.addEventListener(eventName,(()=>{const time=performance.now();time-_lastTime>10&&(!1===document[hidden]?onfocus():onblur()),_lastTime=time}))}),250),window.addEventListener("online",(_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!0}))),window.addEventListener("offline",(_=>Events.emitter._fireEvent(Events.CONNECTIVITY,{online:!1}))),window.onbeforeunload=_=>(Events.emitter._fireEvent(Events.UNLOAD),null)}(),window.Stage=window.Stage||{},"social"==Device.system.browser&&"ios"==Device.system.os&&(box=document.createElement("div"),box.style.position="fixed",box.style.top=box.style.left=box.style.right=box.style.bottom="0px",box.style.zIndex="-1",box.style.opacity="0",box.style.pointerEvents="none",document.body.appendChild(box)),updateStage();let timer,iosResize="ios"===Device.system.os,html=!!iosResize&&document.querySelector("html"),delay=iosResize?500:16;function updateStage(){if(box){let bbox=box.getBoundingClientRect();Stage.width=bbox.width||window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=bbox.height||window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight,document.body.parentElement.scrollTop=document.body.scrollTop=0,document.documentElement.style.width=document.body.style.width=`${Stage.width}px`,document.documentElement.style.height=document.body.style.height=`${Stage.height}px`,Events.emitter._fireEvent(Events.RESIZE)}else Stage.width=window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight}window.addEventListener("resize",(function handleResize(){clearTimeout(timer),timer=setTimeout((_=>{updateStage(),html&&Math.min(window.screen.width,window.screen.height)!==Stage.height&&!Mobile.isAllowNativeScroll&&(html.scrollTop=-1),Events.emitter._fireEvent(Events.RESIZE)}),delay)})),window.onorientationchange=window.onresize,"social"==Device.system.browser&&(Stage.height>=screen.height||Stage.width>=screen.width)&&setTimeout(updateStage,1e3),defer(window.onresize)}))})),Class((function Device(){var vid,_this=this;this.agent=navigator.userAgent.toLowerCase(),this.detect=function(match){return this.agent.includes(match)},this.touchCapable=!!navigator.maxTouchPoints,this.pixelRatio=window.devicePixelRatio,this.system={},this.system.retina=window.devicePixelRatio>1,this.system.webworker=void 0!==window.Worker,window._NODE_||(this.system.geolocation=void 0!==navigator.geolocation),window._NODE_||(this.system.pushstate=void 0!==window.history.pushState),this.system.webcam=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices),this.system.language=window.navigator.userLanguage||window.navigator.language,this.system.webaudio=void 0!==window.AudioContext,this.system.xr={},this.system.detectXR=async function(){if(window.AURA)return _this.system.xr.vr=!0,void(_this.system.xr.ar=!0);if(!navigator.xr)return _this.system.xr.vr=!1,void(_this.system.xr.ar=!1);try{[_this.system.xr.vr,_this.system.xr.ar]=await Promise.all([navigator.xr.isSessionSupported("immersive-vr"),navigator.xr.isSessionSupported("immersive-ar")])}catch(e){}"android"==_this.system.os&&(_this.detect("oculus")||(_this.system.xr.vr=!1))};try{this.system.localStorage=void 0!==window.localStorage}catch(e){this.system.localStorage=!1}this.system.fullscreen=document.fullscreenEnabled||document.webkitFullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled,this.system.os=_this.detect(["ipad","iphone","ios"])||_this.detect("mac")&&_this.touchCapable&&Math.max(screen.width,screen.height)<1370?"ios":_this.detect(["android","kindle"])?"android":_this.detect(["blackberry"])?"blackberry":_this.detect(["mac os"])?"mac":_this.detect(["windows","iemobile"])?"windows":_this.detect(["linux"])?"linux":"unknown",this.system.version=function(){try{if("ios"==_this.system.os){if(_this.agent.includes("intel mac")){let split=_this.agent.split("version/")[1].split(" ")[0].split(".");return Number(split[0]+"."+split[1])}var num=_this.agent.split("os ")[1].split("_"),main=num[0],sub=num[1].split(" ")[0];return Number(main+"."+sub)}if("android"==_this.system.os){var version=_this.agent.split("android ")[1].split(";")[0];return version.length>3&&(version=version.slice(0,-2)),"."==version.charAt(version.length-1)&&(version=version.slice(0,-1)),Number(version)}if("windows"==_this.system.os)return _this.agent.includes("rv:11")?11:Number(_this.agent.split("windows phone ")[1].split(";")[0])}catch(e){}return-1}(),this.system.browser="ios"==_this.system.os?_this.detect(["twitter","fbios","instagram"])?"social":_this.detect(["crios"])?"chrome":_this.detect(["safari"])?"safari":"unknown":"android"==_this.system.os?_this.detect(["twitter","fb","facebook","instagram"])?"social":_this.detect(["chrome"])?"chrome":_this.detect(["firefox"])?"firefox":"browser":_this.detect(["msie"])||_this.detect(["trident"])&&_this.detect(["rv:"])||_this.detect(["windows"])&&_this.detect(["edge"])?"ie":_this.detect(["chrome"])?"chrome":_this.detect(["safari"])?"safari":_this.detect(["firefox"])?"firefox":"unknown",this.system.browserVersion=function(){try{if("chrome"==_this.system.browser)return Number(_this.agent.split("chrome/")[1].split(".")[0]);if("firefox"==_this.system.browser)return Number(_this.agent.split("firefox/")[1].split(".")[0]);if("safari"==_this.system.browser)return Number(_this.agent.split("version/")[1].split(".")[0].split(".")[0]);if("ie"==_this.system.browser)return _this.detect(["msie"])?Number(_this.agent.split("msie ")[1].split(".")[0]):_this.detect(["rv:"])?Number(_this.agent.split("rv:")[1].split(".")[0]):Number(_this.agent.split("edge/")[1].split(".")[0])}catch(e){return-1}}(),this.mobile=!(window._NODE_||!("ontouchstart"in window)&&!("onpointerdown"in window)||!_this.system.os.includes(["ios","android","magicleap"]))&&{},_this.detect("quest")&&(this.mobile=!0),this.mobile&&this.detect(["windows"])&&!this.detect(["touch"])&&(this.mobile=!1),this.mobile&&(this.mobile.tablet=Math.max(window.screen?screen.width:window.innerWidth,window.screen?screen.height:window.innerHeight)>1e3,this.mobile.phone=!this.mobile.tablet,this.mobile.pwa=!(!window.matchMedia||!window.matchMedia("(display-mode: standalone)").matches)||!!window.navigator.standalone,Hydra.ready((()=>{_this.mobile.native=!(!Mobile.NativeCore||!Mobile.NativeCore.active)||!!window._AURA_}))),this.media={},this.media.audio=!!document.createElement("audio").canPlayType&&(_this.detect(["firefox","opera"])?"ogg":"mp3"),this.media.video=!!(vid=document.createElement("video")).canPlayType&&(vid.canPlayType("video/webm;")?"webm":"mp4"),this.media.webrtc=!!(window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection||window.oRTCPeerConnection||window.RTCPeerConnection),this.graphics={},this.graphics.webgl=function(){let DISABLED=!1;Object.defineProperty(_this.graphics,"webgl",{get:()=>{if(DISABLED)return!1;if(_this.graphics._webglContext)return _this.graphics._webglContext;try{const names=["webgl2","webgl","experimental-webgl"],canvas=document.createElement("canvas");let gl;for(let i=0;i<names.length&&(gl=canvas.getContext(names[i]),!gl);i++);let info=gl.getExtension("WEBGL_debug_renderer_info"),output={};if(info){let gpu=info.UNMASKED_RENDERER_WEBGL;output.gpu=gl.getParameter(gpu).toLowerCase()}else output.gpu="unknown";return output.renderer=gl.getParameter(gl.RENDERER).toLowerCase(),output.version=gl.getParameter(gl.VERSION).toLowerCase(),output.glsl=gl.getParameter(gl.SHADING_LANGUAGE_VERSION).toLowerCase(),output.extensions=gl.getSupportedExtensions(),output.webgl2=output.version.includes(["webgl 2","webgl2"]),output.canvas=canvas,output.context=gl,output.detect=function(matches){if(output.gpu&&output.gpu.toLowerCase().includes(matches))return!0;if(output.version&&output.version.toLowerCase().includes(matches))return!0;for(let i=0;i<output.extensions.length;i++)if(output.extensions[i].toLowerCase().includes(matches))return!0;return!1},output.webgl2||output.detect("instance")||window.AURA||(DISABLED=!0),_this.graphics._webglContext=output,output}catch(e){return!1}},set:v=>{!1===v&&(DISABLED=!0)}})}(),this.graphics.metal=function(){if(!window.Metal)return!1;let output={};return output.gpu=Metal.device.getName().toLowerCase(),output.detect=function(matches){return output.gpu.includes(matches)},output}(),this.graphics.gpu=function(){if(!_this.graphics.webgl&&!_this.graphics.metal)return!1;let output={};return["metal","webgl"].forEach((name=>{_this.graphics[name]&&!output.identifier&&(output.detect=_this.graphics[name].detect,output.identifier=_this.graphics[name].gpu)})),output}(),this.graphics.canvas=!!document.createElement("canvas").getContext;const checkForStyle=function(){let _tagDiv;return function(prop){_tagDiv=_tagDiv||document.createElement("div");const vendors=["Khtml","ms","O","Moz","Webkit"];if(prop in _tagDiv.style)return!0;prop=prop.replace(/^[a-z]/,(val=>val.toUpperCase()));for(let i=vendors.length-1;i>=0;i--)if(vendors[i]+prop in _tagDiv.style)return!0;return!1}}();this.styles={},this.styles.filter=checkForStyle("filter"),this.styles.blendMode=checkForStyle("mix-blend-mode"),this.tween={},this.tween.transition=checkForStyle("transition"),this.tween.css2d=checkForStyle("transform"),this.tween.css3d=checkForStyle("perspective"),this.social=_this.agent.includes("instagram")?"instagram":_this.agent.includes("fban")||_this.agent.includes("fbav")||_this.agent.includes("fbios")?"facebook":(_this.agent.includes("twitter")||!(!document.referrer||!document.referrer.includes("//t.co/")))&&"twitter"}),"Static"),Class((function Component(){Inherit(this,Events);const _this=this,_setters={},_flags={},_timers=[],_loops=[];var _onDestroy,_appStateBindings;function defineSetter(_this,prop){_setters[prop]={},Object.defineProperty(_this,prop,{set:function(v){_setters[prop]&&_setters[prop].s&&_setters[prop].s.call(_this,v),v=null},get:function(){if(_setters[prop]&&_setters[prop].g)return _setters[prop].g.apply(_this)}})}this.classes={},this.findParent=function(type){let p=_this.parent;for(;p;){if(p._cachedName||(p._cachedName=Utils.getConstructorName(p)),p._cachedName==type)return p;p=p.parent}},this.set=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].s=callback},this.get=function(prop,callback){_setters[prop]||defineSetter(this,prop),_setters[prop].g=callback},this.isPlayground=function(name){return Global.PLAYGROUND&&Global.PLAYGROUND==(name||Utils.getConstructorName(_this))},this.initClass=function(clss){if(!clss)throw console.trace(),"unable to locate class";const args=[].slice.call(arguments,1),child=Object.create(clss.prototype);if(child.parent=this,clss.apply(child,args),child.destroy){const id=Utils.timestamp();this.classes[id]=child,this.classes[id].__id=id}if(child.element){const last=arguments[arguments.length-1];Array.isArray(last)&&1==last.length&&last[0]instanceof HydraObject?last[0].add(child.element):this.element&&this.element.add&&null!==last&&this.element.add(child.element)}if(child.group){const last=arguments[arguments.length-1];this.group&&null!==last&&this.group.add(child.group)}return child},this.delayedCall=function(callback,time,scaledTime){const timer=Timer.create((()=>{_this&&_this.destroy&&callback&&callback()}),time,scaledTime);return _timers.push(timer),_timers.length>50&&_timers.shift(),timer},this.clearTimers=function(){for(let i=_timers.length-1;i>=0;i--)clearTimeout(_timers[i]);_timers.length=0},this.startRender=function(callback,fps,obj){"number"!=typeof fps&&(obj=fps,fps=void 0);for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback)return;let flagInvisible=_=>{_this._invisible||(_this._invisible=!0,_this.onInvisible&&_this.onInvisible())},loop=(a,b,c,d)=>{if(!_this.startRender)return!1;let p=_this;for(;p;){if(!1===p.visible)return flagInvisible();if(p.group&&!1===p.group.visible)return flagInvisible();p=p.parent}return!1!==_this._invisible&&(_this._invisible=!1,_this.onVisible&&_this.onVisible()),callback(a,b,c,d),!0};_loops.push({callback:callback,loop:loop}),obj?obj==RenderManager.NATIVE_FRAMERATE?Render.start(loop,null,!0):RenderManager.schedule(loop,obj):Render.start(loop,fps)},this.onResize=function(callback){callback(),this.events.sub(Events.RESIZE,callback)},this.stopRender=function(callback,obj){for(let i=0;i<_loops.length;i++)if(_loops[i].callback==callback){let loop=_loops[i].loop;obj&&RenderManager.unschedule(loop,obj),Render.stop(loop),_loops.splice(i,1)}},this.clearRenders=function(){for(let i=0;i<_loops.length;i++)Render.stop(_loops[i].loop);_loops.length=0},this.wait=function(object,key,callback){const promise=Promise.create();let condition;if("string"==typeof object&&(callback=key,key=object,object=_this),"number"==typeof object&&1===arguments.length)return _this.delayedCall(promise.resolve,object),promise;if("function"==typeof object&&1===arguments.length&&(condition=object,object=_this),"function"==typeof object&&"string"==typeof callback){let _object=object;object=key,key=callback,callback=_object}if(callback=callback||promise.resolve,condition||("!"===key?.charAt?.(0)?(key=key.slice(1),condition=()=>!(object[key]||_this.flag(key))):condition=()=>!!object[key]||!!_this.flag(key)),condition())callback();else{function test(){if(!object||!_this.flag||null===object.destroy)return Render.stop(test);condition()&&(callback(),Render.stop(test))}Render.start(test)}return promise},this.bindState=function(appState,key,...rest){_appStateBindings||(_appStateBindings=[]),_appStateBindings.push(appState.bind(key,...rest))},this.flag=function(name,value,time){if(void 0===value)return _flags[name];_flags[name]=value,time&&(clearTimeout(_flags[name+"_timer"]),_flags[name+"_timer"]=this.delayedCall((()=>{_flags[name]=!_flags[name]}),time))},this.destroy=function(){this.removeDispatch&&this.removeDispatch(),this.onDestroy&&this.onDestroy(),this.fxDestroy&&this.fxDestroy(),_onDestroy&&_onDestroy.forEach((cb=>cb()));for(let id in this.classes){var clss=this.classes[id];clss&&clss.destroy&&clss.destroy()}return this.classes=null,this.clearRenders&&this.clearRenders(),this.clearTimers&&this.clearTimers(),this.element&&window.GLUI&&this.element instanceof GLUIObject&&this.element.remove(),this.events&&(this.events=this.events.destroy()),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id),_appStateBindings&&_appStateBindings.forEach((b=>b.destroy?.())),Utils.nullObject(this)},this._bindOnDestroy=function(cb){_onDestroy||(_onDestroy=[]),_onDestroy.push(cb)},this.__destroyChild=function(name){delete this.classes[name]}})),Class((function Model(){Inherit(this,Component),Namespace(this);const _this=this,_storage={},_requests={};let _data=0,_triggered=0;this.push=function(name,val){_storage[name]=val},this.pull=function(name){return _storage[name]},this.waitForData=this.promiseData=function(num=1){_data+=num},this.fulfillData=this.resolveData=function(){_triggered++,_triggered==_data&&(_this.dataReady=!0)},this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait(_this,"dataReady").then(promise.resolve),promise},this.initWithData=function(data){for(var key in _this.STATIC_DATA=data,_this){var model=_this[key],init=!1;for(var i in data)i.toLowerCase().replace(/-/g,"")==key.toLowerCase()&&(init=!0,model.init&&model.init(data[i]));!init&&model.init&&model.init()}_this.init&&_this.init(data)},this.loadData=function(url,callback){let promise=Promise.create();callback||(callback=promise.resolve);var _this=this;return get(url+"?"+Utils.timestamp()).then((d=>{defer((()=>{_this.initWithData(d),callback(d)}))})),promise},this.handleRequest=function(type,callback){_requests[type]=callback},this.makeRequest=async function(type,data,mockData={}){if(!_requests[type])return console.warn(`Missing data handler for ${type} with mockData`,mockData),Array.isArray(mockData)?new StateArray(mockData):AppState.createLocal(mockData);let result=await _requests[type](data,mockData);if(!(result instanceof StateArray||result.createLocal))throw`makeRequest ${type} must return either an AppState or StateArray`;return result}})),Class((function Modules(){const _modules={},_constructors={};function exec(){for(let m in _modules)for(let key in _modules[m]){let module=_modules[m][key];module._ready||(module._ready=!0,module.exec&&module.exec())}}defer(exec),this.Module=function(module){let m=new module,name=module.toString().slice(0,100).match(/function ([^\(]+)/);name?(m._ready=!0,name=name[1],_modules[name]={index:m},_constructors[name]=module):(_modules[m.module]||(_modules[m.module]={}),_modules[m.module][m.path]=m)},this.require=function(path){let root;return path.includes("/")?(root=path.split("/")[0],path=path.replace(root+"/","")):(root=path,path="index"),function requireModule(root,path){let module=_modules[root];if(!module)throw`Module ${root} not found`;return module=module[path],module._ready||(module._ready=!0,module.exec&&module.exec()),module}(root,path).exports},this.getConstructor=function(name){return _constructors[name]},window.Module=this.Module,window._NODE_||(window.requireNative=window.require,window.require=this.require)}),"Static"),Class((function LinkedList(){var prototype=LinkedList.prototype;this.length=0,this.first=null,this.last=null,this.current=null,this.prev=null,void 0===prototype.push&&(prototype.push=function(obj){this.first?(obj.__next=this.first,obj.__prev=this.last,this.last.__next=obj,this.last=obj):(this.first=obj,this.last=obj,obj.__prev=obj,obj.__next=obj),this.length++},prototype.remove=function(obj){obj&&obj.__next&&(this.length<=1?this.empty():(obj==this.first?(this.first=obj.__next,this.last.__next=this.first,this.first.__prev=this.last):obj==this.last?(this.last=obj.__prev,this.last.__next=this.first,this.first.__prev=this.last):(obj.__prev.__next=obj.__next,obj.__next.__prev=obj.__prev),this.length--),obj.__prev=null,obj.__next=null)},prototype.empty=function(){this.first=null,this.last=null,this.current=null,this.prev=null,this.length=0},prototype.start=function(){return this.current=this.first,this.prev=this.current,this.current},prototype.next=function(){if(this.current&&(this.current=this.current.__next,1!=this.length&&this.prev.__next!=this.first))return this.prev=this.current,this.current},prototype.destroy=function(){return Utils.nullObject(this),null})})),Class((function ObjectPool(_type,_number=10){var _pool=[];this.array=_pool,function(){if(_type)for(var i=0;i<_number;i++)_pool.push(new _type)}(),this.get=function(){return _pool.shift()||(_type?new _type:null)},this.empty=function(){_pool.length=0},this.put=function(obj){obj&&_pool.push(obj)},this.insert=function(array){void 0===array.push&&(array=[array]);for(var i=0;i<array.length;i++)_pool.push(array[i])},this.length=function(){return _pool.length},this.randomize=function(){let array=_pool;for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]]}},this.destroy=function(){for(let i=_pool.length-1;i>=0;i--)_pool[i].destroy&&_pool[i].destroy();return _pool=null}})),Class((function Gate(){var _list=[],_map={};this.create=function(name){let promise=Promise.create();name?_map[name]=promise:_list.push(promise)},this.open=function(name){name&&(_map[name]||(_map[name]=Promise.create()),_map[name].resolve());let promise=_list.shift();promise&&promise.resolve()},this.wait=function(name){return _list.length||name?name?(_map[name]||(_map[name]=Promise.create()),_map[name]):_list[_list.length-1]||Promise.resolve():Promise.resolve()}}),"static"),Class((function Assets(){const _this=this;function AssetList(arr){return arr.__proto__=AssetList.prototype,arr}this.__loaded=[],this.FLIPY=!0,this.CDN="",this.CORS="anonymous",this.IMAGES={},this.VIDEOS={},this.AUDIOS={},this.SDF={},this.JSON={push:function(prop,value){this[prop]=value,Object.defineProperty(this,prop,{get:()=>JSON.parse(JSON.stringify(value))})}},Object.defineProperty(this.JSON,"push",{enumerable:!1,writable:!0}),this.SVG={},AssetList.prototype=new Array,AssetList.prototype.filter=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)||this.splice(i,1);return this},AssetList.prototype.exclude=function(items){for(let i=this.length-1;i>=0;i--)this[i].includes(items)&&this.splice(i,1);return this},AssetList.prototype.prepend=function(prefix){for(let i=this.length-1;i>=0;i--)this[i]=prefix+this[i];return this},AssetList.prototype.append=function(suffix){for(let i=this.length-1;i>=0;i--)this[i]=this[i]+suffix;return this},this.list=function(){return window.ASSETS||console.warn("ASSETS list not available"),new AssetList(window.ASSETS.slice(0)||[])},this.BASE_PATH="",this.getPath=function(path){if(path.includes("~"))return _this.BASE_PATH+path.replace("~","");if(path.includes("//"))return path;if(path=function parseResolution(path){if(!window.ASSETS||!ASSETS.RES)return path;var res=ASSETS.RES[path],ratio=Math.min(Device.pixelRatio,3);if(!res)return path;if(!res["x"+ratio])return path;var split=path.split("/"),file=split[split.length-1];return split=file.split("."),path.replace(file,split[0]+"-"+ratio+"x."+split[1])}(path),_this.dictionary)for(let pathKey in _this.dictionary)if(_this.dictionary[pathKey].includes(path.split("?")[0]))return pathKey+path;return this.CDN&&!~path.indexOf(this.CDN)&&(path=this.CDN+path),path},this.registerPath=function(path,assets){_this.dictionary||(_this.dictionary={}),_this.dictionary[path]=assets},this.loadImage=function(path,isStore){var img=new Image;return img.crossOrigin=this.CORS,img.src=_this.getPath(path),img.loadPromise=function(){let promise=Promise.create();return img.onload=promise.resolve,promise},isStore&&(this.IMAGES[path]=img),img},this.decodeImage=function(path,params,promise){promise||(promise=Promise.create());let img=_this.loadImage(path);return img.onload=()=>promise.resolve(img),img.onerror=()=>_this.decodeImage("assets/images/_scenelayout/uv.jpg",params,promise),promise}}),"static"),Class((function AssetLoader(_assets,_callback,ASSETS=Assets){Inherit(this,Events);const _this=this;let _total=_assets.length,_loaded=0,_lastFiredPercent=0;function loadAsset(){let path=_assets.splice(_assets.length-1,1)[0];const name=path.split("assets/").last().split(".")[0],ext=path.split(".").last().split("?")[0].toLowerCase();let timeout=Timer.create(timedOut,AssetLoader.TIMEOUT,path);if(!Assets.preventCache&&~Assets.__loaded.indexOf(path))return loaded();if(ext.includes(["jpg","jpeg","png","gif"])){let image=ASSETS.loadImage(path);return image.complete?loaded():(image.onload=loaded,void(image.onerror=loaded))}function loaded(){timeout&&clearTimeout(timeout),increment(),_assets.length&&loadAsset()}ext.includes(["mp4","webm"])?fetch(path).then((async response=>{let blob=await response.blob();Assets.VIDEOS[name]=URL.createObjectURL(blob),loaded()})).catch((e=>{console.warn(e),loaded()})):ext.includes(["mp3"])?fetch(path).then((async response=>{let blob=await response.blob();Assets.AUDIOS[name]=URL.createObjectURL(blob),loaded()})).catch((e=>{console.warn(e),loaded()})):get(Assets.getPath(path),Assets.HEADERS).then((data=>{Assets.__loaded.push(path),"json"==ext&&ASSETS.JSON.push(name,data),"svg"==ext&&(ASSETS.SVG[name]=data),"fnt"==ext&&(ASSETS.SDF[name.split("/")[1]]=data),"js"==ext&&window.eval(data),ext.includes(["fs","vs","glsl"])&&window.Shaders&&Shaders.parse(data,path),loaded()})).catch((e=>{console.warn(e),loaded()}))}function increment(){let percent=Math.max(_lastFiredPercent,Math.min(1,++_loaded/_total));_this.events.fire(Events.PROGRESS,{percent:percent}),_lastFiredPercent=percent,_loaded>=_total&&defer(complete)}function complete(){_this.completed||(_this.completed=!0,defer((()=>{_callback&&_callback(),_this.events.fire(Events.COMPLETE)})))}function timedOut(path){console.warn("Asset timed out",path)}!function(){if(!Array.isArray(_assets))throw"AssetLoader requires array of assets to load";_assets=_assets.slice(0).reverse(),function init(){if(!_assets.length)return complete();for(let i=0;i<AssetLoader.SPLIT;i++)_assets.length&&loadAsset()}()}(),this.loadModules=function(){if(!window._BUILT_)return;this.add(1);let module=window._ES5_?"es5-modules":"modules",s=document.createElement("script");return s.src="assets/js/"+module+".js?"+window._CACHE_,s.async=!0,document.head.appendChild(s),AssetLoader.waitForLib("_MODULES_").then((_=>_this.trigger(1)))},this.add=function(num){_total+=num||1},this.trigger=function(num){for(let i=0;i<(num||1);i++)increment()}}),(()=>{AssetLoader.SPLIT=2,AssetLoader.TIMEOUT=5e3,AssetLoader.loadAllAssets=function(callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(Assets.list(),(()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())})),promise},AssetLoader.loadAssets=function(list,callback){let promise=Promise.create();return callback||(callback=promise.resolve),promise.loader=new AssetLoader(list,(()=>{callback&&callback(),promise.loader&&promise.loader.destroy&&(promise.loader=promise.loader.destroy())})),promise},AssetLoader.waitForLib=function(name,callback){let promise=Promise.create();return callback||(callback=promise.resolve),Render.start((function check(){window[name]&&(Render.stop(check),callback&&callback())})),promise},AssetLoader.waitForModules=function(){return AssetLoader.waitForLib(window._BUILT_?"_MODULES_":"zUtils3D")}})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).goober={})}(this,(function(e){let t={data:""},n=e=>"undefined"!=typeof window?((e?e.querySelector("#_goober"):window._goober)||Object.assign((e||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:e||t,o=/(?:([A-Z0-9-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(})/gi,r=/\/\*[^]*?\*\/|\s\s+|\n/g,l=(e,t)=>{let n,o="",r="",a="";for(let s in e){let c=e[s];"object"==typeof c?(n=t?t.replace(/([^,])+/g,(e=>s.replace(/([^,])+/g,(t=>/&/.test(t)?t.replace(/&/g,e):e?e+" "+t:t)))):s,r+="@"==s[0]?"f"==s[1]?l(c,s):s+"{"+l(c,"k"==s[1]?"":t)+"}":l(c,n)):"@"==s[0]&&"i"==s[1]?o=s+" "+c+";":(s=s.replace(/[A-Z]/g,"-$&").toLowerCase(),a+=l.p?l.p(s,c):s+":"+c+";")}return a[0]?(n=t?t+"{"+a+"}":a,o+n+r):o+r},a={},s=e=>{let t="";for(let n in e)t+=n+("object"==typeof e[n]?s(e[n]):e[n]);return t},c=(e,t,n,c,i)=>{let f="object"==typeof e?s(e):e,p=a[f]||(a[f]=(e=>{let t=0,n=11;for(;t<e.length;)n=101*n+e.charCodeAt(t++)>>>0;return"go"+n})(f));if(!a[p]){let t="object"==typeof e?e:(e=>{let t,n=[{}];for(;t=o.exec(e.replace(r,""));)t[4]&&n.shift(),t[3]?n.unshift(n[0][t[3]]=n[0][t[3]]||{}):t[4]||(n[0][t[1]]=t[2]);return n[0]})(e);a[p]=l(i?{["@keyframes "+p]:t}:t,n?"":"."+p)}return((e,t,n)=>{-1==t.data.indexOf(e)&&(t.data=n?e+t.data:t.data+e)})(a[p],t,c),p},i=(e,t,n)=>e.reduce(((e,o,r)=>{let a=t[r];if(a&&a.call){let e=a(n),t=e&&e.props&&e.props.className||/^go/.test(e)&&e;a=t?"."+t:e&&"object"==typeof e?e.props?"":l(e,""):e}return e+o+(null==a?"":a)}),"");function f(e){let t=this||{},o=e.call?e(t.p):e;return c(o.unshift?o.raw?i(o,[].slice.call(arguments,1),t.p):o.reduce(((e,n)=>n?Object.assign(e,n.call?n(t.p):n):e),{}):o,n(t.target),t.g,t.o,t.k)}let p,d,u,g=f.bind({g:1}),b=f.bind({k:1});e.css=f,e.extractCss=e=>{let t=n(e),o=t.data;return t.data="",o},e.glob=g,e.keyframes=b,e.setup=function(e,t,n,o){l.p=t,p=e,d=n,u=o},e.styled=function(e,t){let n=this||{};return function(){let o=arguments;function r(l,a){let s=Object.assign({},l),c=s.className||r.className;n.p=Object.assign({theme:d&&d()},s),n.o=/ *go\d+/.test(c),s.className=f.apply(n,o)+(c?" "+c:""),t&&(s.ref=a);let i=s.as||e;return u&&i[0]&&u(s),p(i,s)}return t?t(r):r}}})),function(i,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((i=i||self).gooberPrefixer={})}(this,(function(i){var n=new Map([["align-self","-ms-grid-row-align"],["color-adjust","-webkit-print-color-adjust"],["column-gap","grid-column-gap"],["gap","grid-gap"],["grid-template-columns","-ms-grid-columns"],["grid-template-rows","-ms-grid-rows"],["justify-self","-ms-grid-column-align"],["margin-inline-end","-webkit-margin-end"],["margin-inline-start","-webkit-margin-start"],["overflow-wrap","word-wrap"],["padding-inline-end","-webkit-padding-end"],["padding-inline-start","-webkit-padding-start"],["row-gap","grid-row-gap"],["scroll-margin-bottom","scroll-snap-margin-bottom"],["scroll-margin-left","scroll-snap-margin-left"],["scroll-margin-right","scroll-snap-margin-right"],["scroll-margin-top","scroll-snap-margin-top"],["scroll-margin","scroll-snap-margin"],["text-combine-upright","-ms-text-combine-horizontal"]]);i.prefix=function(i,r){let t="";const e=n.get(i);e&&(t+=`${e}:${r};`);const o=function(i){var n=/^(?:(text-(?:decoration$|e|or|si)|back(?:ground-cl|d|f)|box-d|(?:mask(?:$|-[ispro]|-cl)))|(tab-|column(?!-s)|text-align-l)|(ap)|(u|hy))/i.exec(i);return n?n[1]?1:n[2]?2:n[3]?3:5:0}(i);1&o&&(t+=`-webkit-${i}:${r};`),2&o&&(t+=`-moz-${i}:${r};`),4&o&&(t+=`-ms-${i}:${r};`);const a=function(i,n){var r=/^(?:(pos)|(background-i)|((?:max-|min-)?(?:block-s|inl|he|widt))|(dis))/i.exec(i);return r?r[1]?/^sti/i.test(n)?1:0:r[2]?/^image-/i.test(n)?1:0:r[3]?"-"===n[3]?2:0:/^(inline-)?grid$/i.test(n)?4:0:0}(i,r);return 1&a?t+=`${i}:-webkit-${r};`:2&a?t+=`${i}:-moz-${r};`:4&a&&(t+=`${i}:-ms-${r};`),t+=`${i}:${r};`,t}})),function(e,o){"object"==typeof exports&&"undefined"!=typeof module?o(exports,require("goober")):"function"==typeof define&&define.amd?define(["exports","goober"],o):o((e=e||self).gooberGlobal={},e.goober)}(this,(function(e,o){let n=o.css.bind({g:1});e.createGlobalStyles=function(){const e=o.styled.call({g:1},"div").apply(null,arguments);return function(o){return e(o),null}},e.glob=n})),Hydra.ready((function(){window.__window=$(window),window.__document=$(document),window.__body=$(document.getElementsByTagName("body")[0]),window.Stage=window.Stage&&window.Stage.style?$(window.Stage):__body.create("#Stage"),Stage.size("100%"),Stage.__useFragment=!0,Stage.width=window.innerWidth||document.body.clientWidth||document.documentElement.offsetWidth,Stage.height=window.innerHeight||document.body.clientHeight||document.documentElement.offsetHeight})),Class((function HydraCSS(){var _tag,_obj,_style,_needsUpdate,_this=this;function objToCSS(key){var match=key.match(/[A-Z]/),camelIndex=match?match.index:null;if(camelIndex){var start=key.slice(0,camelIndex),end=key.slice(camelIndex);key=start+"-"+end.toLowerCase()}return key}function setHTML(){_tag.innerHTML=_style,_needsUpdate=!1}Hydra.ready((function(){_obj={},_style="",(_tag=document.createElement("style")).type="text/css",document.getElementsByTagName("head")[0].appendChild(_tag)})),this._read=function(){return _style},this._write=function(css){_style=css,_needsUpdate||(_needsUpdate=!0,defer(setHTML))},this.style=function(selector,obj={}){_obj[selector]||(_obj[selector]={}),Object.assign(_obj[selector],obj),function render(){var s="";for(let selector in _obj){let obj=_obj[selector];for(var key in s+=`${selector} {`,obj){var prop=objToCSS(key),val=obj[key];"string"!=typeof val&&"opacity"!=key&&(val+="px"),s+=prop+":"+val+"!important;"}s+="}"}_this._write(s)}()},this.get=function(selector,prop){if(!_obj[selector])return prop?null:{};let obj=Object.assign({},_obj[selector]);return prop?obj[prop]:obj},this.textSize=function($obj){var $clone=$obj.clone();$clone.css({position:"relative",cssFloat:"left",styleFloat:"left",marginTop:-99999,width:"",height:""}),__body.addChild($clone);var width=$clone.div.offsetWidth,height=$clone.div.offsetHeight;return $clone.remove(),{width:width,height:height}},this.prefix=function(style){return""==_this.styles.vendor?style.charAt(0).toLowerCase()+style.slice(1):_this.styles.vendor+style},this._toCSS=objToCSS}),"Static"),Class((function HydraObject(_selector,_type,_exists,_useFragment){this._children=new LinkedList,this._onDestroy,this.__useFragment=_useFragment,this._initSelector(_selector,_type,_exists)}),(()=>{var prototype=HydraObject.prototype;prototype._initSelector=function(_selector,_type,_exists){if(_selector&&"string"!=typeof _selector)this.div=_selector;else{var first=_selector?_selector.charAt(0):null,name=_selector?_selector.slice(1):null;if("."!=first&&"#"!=first&&(name=_selector,first="."),_exists){if("#"!=first)throw"Hydra Selectors Require #ID";this.div=document.getElementById(name)}else this._type=_type||"div","svg"==this._type?(this.div=document.createElementNS("http://www.w3.org/2000/svg",this._type),this.div.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink")):(this.div=document.createElement(this._type),first&&("#"==first?this.div.id=name:this.div.className=name))}this.div.hydraObject=this},prototype.add=function(child){var div=this.div,_this=this,createFrag=function(){_this.__useFragment&&(_this._fragment||(_this._fragment=document.createDocumentFragment(),defer((function(){if(!_this._fragment||!_this.div)return _this._fragment=null;_this.div.appendChild(_this._fragment),_this._fragment=null}))),div=_this._fragment)};return child.element&&child.element instanceof HydraObject?(createFrag(),div.appendChild(child.element.div),this._children.push(child.element),child.element._parent=this,child.element.div.parentNode=this.div):child.div?(createFrag(),div.appendChild(child.div),this._children.push(child),child._parent=this,child.div.parentNode=this.div):child.nodeName&&(createFrag(),div.appendChild(child),child.parentNode=this.div),this},prototype.clone=function(){return $(this.div.cloneNode(!0))},prototype.create=function(name,type){var $obj=$(name,type);return this.add($obj),$obj},prototype.empty=function(){for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}return this.div.innerHTML="",this},prototype.parent=function(){return this._parent},prototype.children=function(isHydraChildren=!1){let children=this.div.children?this.div.children:this.div.childNodes;if(isHydraChildren){children=[];for(var child=this._children.start();child;)child&&(children.push(child),child=this._children.next())}return children},prototype.removeChild=function(object,keep){try{object.div.parentNode.removeChild(object.div)}catch(e){}keep||this._children.remove(object)},prototype.remove=function(param){param&&console.warn("HydraObject.remove removes ITSELF from its parent. use removeChild instead"),this._onDestroy&&this._onDestroy.forEach((cb=>cb())),this.removed=!0;var parent=this._parent;parent&&!parent.removed&&parent.removeChild&&parent.removeChild(this,!0);for(var child=this._children.start();child;){var next=this._children.next();child&&child.remove&&child.remove(),child=next}this._children.destroy(),this.div.hydraObject=null,Utils.nullObject(this)},prototype.destroy=function(){this.remove()},prototype._bindOnDestroy=function(cb){this._onDestroy||(this._onDestroy=[]),this._onDestroy.push(cb)},window.$=function(selector,type,exists){return new HydraObject(selector,type,exists)},$.fn=HydraObject.prototype})),$.fn.text=function(text){return void 0!==text?(this.__cacheText!=text&&(this.div.textContent=text),this.__cacheText=text,this):this.div.textContent},$.fn.html=function(text,force){return!text||text.includes("<")||force?void 0!==text?(this.div.innerHTML=text,this):this.div.innerHTML:this.text(text)},$.fn.hide=function(){return this.div.style.display="none",this},$.fn.show=function(){return this.div.style.display="",this},$.fn.visible=function(){return this.div.style.visibility="visible",this},$.fn.invisible=function(){return this.div.style.visibility="hidden",this},$.fn.setZ=function(z){return this.div.style.zIndex=z,this},$.fn.clearAlpha=function(){return this.div.style.opacity="",this},$.fn.size=function(w,h,noScale){return"string"==typeof w?(void 0===h?h="100%":"string"!=typeof h&&(h+="px"),this.div.style.width=w,this.div.style.height=h):(this.div.style.width=w+"px",this.div.style.height=h+"px",noScale||(this.div.style.backgroundSize=w+"px "+h+"px")),this.width=w,this.height=h,this},$.fn.mouseEnabled=function(bool){return this.div.style.pointerEvents=bool?"auto":"none",this},$.fn.fontStyle=function(family,size,color,style){var font={};return family&&(font.fontFamily=family),size&&(font.fontSize=size),color&&(font.color=color),style&&(font.fontStyle=style),this.css(font),this},$.fn.font=function(font){return this.css("font",font),this},$.fn.bg=function(src,x,y,repeat){return src?(src.includes(".")&&(src=Assets.getPath(src)),src.includes(".")?this.div.style.backgroundImage="url("+src+")":this.div.style.backgroundColor=src,void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style.backgroundPosition=x+" "+y),repeat&&(this.div.style.backgroundSize="",this.div.style.backgroundRepeat=repeat),"cover"!=x&&"contain"!=x||(this.div.style.backgroundSize=x,this.div.style.backgroundPosition=void 0!==y?y+" "+repeat:"center"),this):this},$.fn.center=function(x,y,noPos){var css={};return void 0===x?(css.left="50%",css.top="50%",css.marginLeft=-this.width/2,css.marginTop=-this.height/2):(x&&(css.left="50%",css.marginLeft=-this.width/2),y&&(css.top="50%",css.marginTop=-this.height/2)),noPos&&(delete css.left,delete css.top),this.css(css),this},$.fn.max=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.maxWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.maxHeight=h):(h=w,this.div.style.maxHeight=h),this},$.fn.min=function(width,height){let w,h;return void 0!==width&&(w="number"==typeof width?width+"px":width,this.div.style.minWidth=w),void 0!==height?(h="number"==typeof height?height+"px":height,this.div.style.minHeight=h):(h=w,this.div.style.minHeight=h),this},$.fn.flex=function(inline){return this.div.style.display=inline?"inline-flex":"flex",this.div.style.justifyContent="center",this.div.style.alignItems="center",this.div.classList.add("relative-children"),this},$.fn.order=function(opts={}){let s=this.div.style;return"none"===opts.flexWrap&&(opts.flexWrap="nowrap"),opts.direction&&(s.flexDirection=opts.direction),opts.wrap&&(s.flexWrap=opts.wrap),opts.order&&(s.order=opts.order),this},$.fn.align=function(opts={}){let s=this.div.style;function flex(str,contentMode=!1){return"start"===str?"flex-start":"end"===str?"flex-end":"between"===str?contentMode?"space-between":"flex-between":"around"===str?contentMode?"space-around":"flex-around":"none"===str?"nowrap":str}return opts.justify&&(s.justifyContent=flex(opts.justify)),opts.items&&(s.alignItems=flex(opts.items)),opts.self&&(s.alignSelf=flex(opts.self)),opts.content&&(s.alignContent=flex(opts.content,!0)),this},$.fn.flexibility=function(opts={}){let s=this.div.style;return"undefined"!==opts.grow&&(s.flexGrow=opts.grow),"undefined"!==opts.shrink&&(s.flexGrow=opts.shrink),void 0!==opts.basis&&(s.flexBasis="number"==typeof opts.basis?opts.basis+"px":opts.basis),this},$.fn.mask=function(arg){let maskPrefix="Moz"===HydraCSS.styles.vendor?"mask":HydraCSS.prefix("Mask");return this.div.style[maskPrefix]=(arg.includes(".")?"url("+arg+")":arg)+" no-repeat",this.div.style[maskPrefix+"Size"]="contain",this},$.fn.blendMode=function(mode,bg){return bg?this.div.style["background-blend-mode"]=mode:this.div.style["mix-blend-mode"]=mode,this},$.fn.css=function(obj,value){if("boolean"==typeof value&&(value=null),"object"!=typeof obj){if(value)return this.div.style[obj]=value,this;var style=this.div.style[obj];if("number"!=typeof style){if(!style)return!1;style.includes("px")&&(style=Number(style.slice(0,-2))),"opacity"==obj&&(style=isNaN(Number(this.div.style.opacity))?1:Number(this.div.style.opacity))}return style||(style=0),style}for(var type in TweenManager._clearCSSTween(this),obj){var val=obj[type];"string"!=typeof val&&"number"!=typeof val||("string"!=typeof val&&"opacity"!=type&&"zIndex"!=type&&(val+="px"),"position"==type&&"sticky"==val&&"safari"==Device.system.browser&&(val="-webkit-sticky"),this.div.style[type]=val)}return this},$.fn.transform=function(props){if(TweenManager._clearCSSTween(this),Device.tween.css2d){if(props)for(var key in props)"number"!=typeof props[key]&&"string"!=typeof props[key]||(this[key]=props[key]);else props=this;var transformString=TweenManager._parseTransform(props);this.__transformCache!=transformString&&(this.div.style[HydraCSS.styles.vendorTransform]=transformString,this.__transformCache=transformString)}return this},$.fn.willChange=function(props){if("boolean"==typeof props)this._willChangeLock=!0===props;else if(this._willChangeLock)return;var string="string"==typeof props;this._willChange&&!string||"null"==typeof props?(this._willChange=!1,this.div.style["will-change"]=""):(this._willChange=!0,this.div.style["will-change"]=string?props:HydraCSS.transformProperty+", opacity")},$.fn.backfaceVisibility=function(visible){this.div.style[HydraCSS.prefix("BackfaceVisibility")]=visible?"visible":"hidden"},$.fn.enable3D=function(perspective,x,y){return Device.tween.css3d?(this.div.style[HydraCSS.prefix("TransformStyle")]="preserve-3d",perspective&&(this.div.style[HydraCSS.prefix("Perspective")]=perspective+"px"),void 0!==x&&(x="number"==typeof x?x+"px":x,y="number"==typeof y?y+"px":y,this.div.style[HydraCSS.prefix("PerspectiveOrigin")]=x+" "+y),this):this},$.fn.disable3D=function(){return this.div.style[HydraCSS.prefix("TransformStyle")]="",this.div.style[HydraCSS.prefix("Perspective")]="",this},$.fn.transformPoint=function(x,y,z){var origin="";return void 0!==x&&(origin+="number"==typeof x?x+"px ":x+" "),void 0!==y&&(origin+="number"==typeof y?y+"px ":y+" "),void 0!==z&&(origin+="number"==typeof z?z+"px":z),this.div.style[HydraCSS.prefix("TransformOrigin")]=origin,this},$.fn.tween=function(props,time,ease,delay,callback,manual){"boolean"==typeof delay?(manual=delay,delay=0,callback=null):"function"==typeof delay&&(callback=delay,delay=0),"boolean"==typeof callback&&(manual=callback,callback=null),delay||(delay=0);var usePromise=null;callback&&callback instanceof Promise&&(usePromise=callback,callback=callback.resolve);var tween=TweenManager._detectTween(this,props,time,ease,delay,callback,manual);return usePromise||tween},$.fn.clearTransform=function(){return"number"==typeof this.x&&(this.x=0),"number"==typeof this.y&&(this.y=0),"number"==typeof this.z&&(this.z=0),"number"==typeof this.scale&&(this.scale=1),"number"==typeof this.scaleX&&(this.scaleX=1),"number"==typeof this.scaleY&&(this.scaleY=1),"number"==typeof this.rotation&&(this.rotation=0),"number"==typeof this.rotationX&&(this.rotationX=0),"number"==typeof this.rotationY&&(this.rotationY=0),"number"==typeof this.rotationZ&&(this.rotationZ=0),"number"==typeof this.skewX&&(this.skewX=0),"number"==typeof this.skewY&&(this.skewY=0),this.div.style[HydraCSS.styles.vendorTransform]="",this.__transformCache="",this},$.fn.clearTween=function(){return this._cssTween&&this._cssTween.stop(),this._mathTween&&this._mathTween.stop(),this},$.fn.stopTween=function(){return console.warn(".stopTween deprecated. use .clearTween instead"),this.clearTween()},$.fn.keypress=function(callback){this.div.onkeypress=function(e){(e=e||window.event).code=e.keyCode?e.keyCode:e.charCode,callback&&callback(e)}},$.fn.keydown=function(callback){this.div.onkeydown=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.keyup=function(callback){this.div.onkeyup=function(e){(e=e||window.event).code=e.keyCode,callback&&callback(e)}},$.fn.attr=function(attr,value){return"string"!=typeof attr?this:void 0===value?this.div.getAttribute(attr):(!1===value||null===value?this.div.removeAttribute(attr):this.div.setAttribute(attr,value),this)},$.fn.val=function(value){return void 0===value?this.div.value:(this.div.value=value,this)},$.fn.change=function(callback){var _this=this;this.div.onchange=function(){callback({object:_this,value:_this.div.value||""})}},$.fn.svgSymbol=function(id,width,height){var config=SVG.getSymbolConfig(id),svgHTML='<svg viewBox="0 0 '+config.width+" "+config.height+'" width="'+width+'" height="'+height+'"><use xlink:href="#'+config.id+'" x="0" y="0" /></svg>';this.html(svgHTML,!0)},$.fn.svg=async function(url){let promise=Promise.create();return fetch(url).then((async res=>{let svgHTML=await res.text();this.html(svgHTML,!0),promise.resolve()})),promise},$.fn.overflowScroll=function(dir){var x=!!dir.x,y=!!dir.y,overflow={};(!x&&!y||x&&y)&&(overflow.overflow="auto"),!x&&y&&(overflow.overflowY="auto",overflow.overflowX="hidden"),x&&!y&&(overflow.overflowX="auto",overflow.overflowY="hidden"),Device.mobile&&(overflow["-webkit-overflow-scrolling"]="touch",Mobile._addOverflowScroll(this)),this.css(overflow)},$.fn.removeOverflowScroll=function(){this.css({overflow:"hidden",overflowX:"",overflowY:"","-webkit-overflow-scrolling":""}),Device.mobile&&Mobile._removeOverflowScroll(this)},$.fn.accessible=function(type="label",tabIndex=-1){switch(tabIndex>-1&&this.attr("tabindex",tabIndex),type){case"label":this.attr("aria-label",this.div.textContent);break;case"hidden":this.attr("aria-hidden",!0)}},$.fn.tabIndex=function(tabIndex){return this.attr("tabindex",tabIndex),this},$.fn.createObserver=function(callback,{isViewport:isViewport=!1,...options}={}){isViewport&&(options.root=this.div);const observer=this._observer=new IntersectionObserver((array=>{array.forEach((entry=>{entry.object=entry.target.hydraObject})),callback(array)}),options);return this._bindOnDestroy((()=>{observer.disconnect()})),this},$.fn.observe=function(obj=this){return this._observer?.observe(obj.div),this},$.fn.unobserve=function(obj=this){return this._observer?.unobserve(obj.div),this},$.fn.cursor=function(cursor,lock){return lock&&(this.cursorLock||(this.cursorLock=new Map),"auto"==cursor?this.cursorLock.delete(lock):this.cursorLock.set(lock,cursor)),this.cursorLock&&"auto"==cursor&&this.cursorLock.forEach((v=>{cursor=v})),this.css("cursor",cursor),this},$.fn.classList=function(){return this.div.classList},$.fn.goob=function(styles){let _styles;return _styles="string"==typeof styles?goober.css`${styles}`:goober.css(styles),this.goobClass=_styles,this.div.classList.add(_styles),this},function(){var windowsPointer=!!window.MSGesture,translateEvent=function(evt){if(windowsPointer)switch(evt){case"touchstart":return"pointerdown";case"touchmove":return"MSGestureChange";case"touchend":return"pointerup"}return evt},convertTouchEvent=function(e){var touchEvent={x:0,y:0};if(e.windowsPointer)return e;if(!e)return touchEvent;if(e.touches||e.changedTouches?e.touches.length?(touchEvent.x=e.touches[0].clientX,touchEvent.y=e.touches[0].clientY):(touchEvent.x=e.changedTouches[0].clientX,touchEvent.y=e.changedTouches[0].clientY):(touchEvent.x=e.clientX,touchEvent.y=e.clientY),Mobile.ScreenLock&&Mobile.ScreenLock.isActive&&Mobile.orientationSet&&Mobile.orientation!==Mobile.orientationSet){if(90==window.orientation||0===window.orientation){var x=touchEvent.y;touchEvent.y=touchEvent.x,touchEvent.x=Stage.width-x}if(-90==window.orientation||180===window.orientation){var y=touchEvent.x;touchEvent.x=touchEvent.y,touchEvent.y=Stage.height-y}}return touchEvent};$.fn.click=function(callback){var _this=this;return this.div.addEventListener(translateEvent("click"),(function click(e){return!!_this.div&&(!Mouse._preventClicks&&(e.object="hit"==_this.div.className?_this.parent():_this,e.action="click",callback&&callback(e),void(Mouse.autoPreventClicks&&Mouse.preventClicks())))}),!0),this.div.style.cursor="pointer",this},$.fn.hover=function(callback){var _time,_this=this,_over=!1;function hover(e){if(!_this.div)return!1;var time=performance.now(),original=e.toElement||e.relatedTarget;if(_time&&time-_time<5)return _time=time,!1;switch(_time=time,e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mouseout":case"mouseleave":e.action="out";break;default:e.action="over"}if(_over){if(Mouse._preventClicks)return!1;if("over"==e.action)return!1;if("out"==e.action&&isAChild(_this.div,original))return!1;_over=!1}else{if("out"==e.action)return!1;_over=!0}callback&&callback(e)}function isAChild(div,object){for(var len=div.children.length-1,i=len;i>-1;i--)if(object==div.children[i])return!0;for(i=len;i>-1;i--)if(isAChild(div.children[i],object))return!0}return this.div.addEventListener(translateEvent("mouseover"),hover,!0),this.div.addEventListener(translateEvent("mouseout"),hover,!0),this},$.fn.press=function(callback){var _this=this;function press(e){if(!_this.div)return!1;switch(e.object="hit"==_this.div.className?_this.parent():_this,e.type){case"mousedown":e.action="down";break;default:e.action="up"}callback&&callback(e)}return this.div.addEventListener(translateEvent("mousedown"),press,!0),this.div.addEventListener(translateEvent("mouseup"),press,!0),this},$.fn.bind=function(evt,callback){if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.bind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.bind("mousedown",callback):evt="mousedown"):"touchmove"==evt?(Device.mobile||(Device.touchCapable?this.bind("mousemove",callback):evt="mousemove"),windowsPointer&&!this.div.msGesture&&(this.div.msGesture=new MSGesture,this.div.msGesture.target=this.div)):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.bind("mouseup",callback):evt="mouseup")),this._events["bind_"+evt]=this._events["bind_"+evt]||[];var _events=this._events["bind_"+evt],e={},target=this.div;function touchEvent(e){windowsPointer&&target.msGesture&&"touchstart"==evt&&target.msGesture.addPointer(e.pointerId),Device.mobile||"touchstart"!=evt||e.preventDefault();var touch=convertTouchEvent(e);if(windowsPointer){var windowsEvt=e;(e={}).preventDefault=()=>windowsEvt.preventDefault(),e.stopPropagation=()=>windowsEvt.stopPropagation(),e.x=Number(windowsEvt.clientX),e.y=Number(windowsEvt.clientY),e.target=windowsEvt.target,e.currentTarget=windowsEvt.currentTarget,e.path=[];for(var node=e.target;node;)e.path.push(node),node=node.parentElement||null;e.windowsPointer=!0}else e.x=touch.x,e.y=touch.y;for(var i=0;i<_events.length;i++){var ev=_events[i];ev.target==e.currentTarget&&ev.callback(e)}}return e.callback=callback,e.target=this.div,_events.push(e),this._events["fn_"+evt]||(this._events["fn_"+evt]=touchEvent,this.div.addEventListener(translateEvent(evt),touchEvent,{capture:!0,passive:!1})),this},$.fn.unbind=function(evt,callback){if(this._events=this._events||{},windowsPointer&&this==__window)return Stage.unbind(evt,callback);"touchstart"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousedown",callback):evt="mousedown"):"touchmove"==evt?Device.mobile||(Device.touchCapable?this.unbind("mousemove",callback):evt="mousemove"):"touchend"==evt&&(Device.mobile||(Device.touchCapable?this.unbind("mouseup",callback):evt="mouseup"));var _events=this._events["bind_"+evt];if(!_events)return this;for(var i=0;i<_events.length;i++){_events[i].callback==callback&&_events.splice(i,1)}return this._events["fn_"+evt]&&!_events.length&&(this.div.removeEventListener(translateEvent(evt),this._events["fn_"+evt],!Device.mobile||{passive:!0}),this._events["fn_"+evt]=null),this},$.fn.interact=function(overCallback,clickCallback,seoLink,seoText,zIndex,options){if(!this.hit){"object"==typeof arguments[arguments.length-1]&&(options=arguments[arguments.length-1],[overCallback,clickCallback,seoLink,seoText,zIndex]=Array.prototype.slice.call(arguments,0,-1),options.overCallback&&(overCallback=options.overCallback),options.clickCallback&&(clickCallback=options.clickCallback),options.seoLink&&(seoLink=options.seoLink),options.seoText&&(seoText=options.seoText),options.zIndex&&(zIndex=options.zIndex)),options||(options={}),this.hit=$(".hit",seoLink?"a":void 0),this.hit.css({width:"100%",height:"100%",zIndex:zIndex||99999,top:0,left:0,position:"absolute"}),this.add(this.hit);var _this=this;seoLink&&(this.hit.attr("href","#"===seoLink?seoLink:Hydra.absolutePath(seoLink)),this.hit.text(seoText||this.div.textContent),this.hit.css({fontSize:0}),this.hit.accessible(),"function"==typeof overCallback&&(this.hit.div.onfocus=_=>overCallback({action:"over",object:this}),this.hit.div.onblur=_=>overCallback({action:"out",object:this})),this.hit.div.onclick=e=>{e.preventDefault(),e.object=_this,e.action="click",clicked(e)}),options.role&&(this.hit.attr("role",options.role),"button"===options.role&&(this.hit.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),e.object=_this,e.action="click",clicked(e)}}))}let time=Render.TIME;function clicked(e){clickCallback&&Render.TIME-time>250&&clickCallback(e),time=Render.TIME}Device.mobile?this.hit.touchClick(overCallback,clicked).click(clicked):this.hit.hover(overCallback).click(clicked)},$.fn.clearInteract=function(){this.hit&&(this.hit=this.hit.destroy())},$.fn.disableInteract=function(){this.hit&&this.hit.css({pointerEvents:"none"})},$.fn.enableInteract=function(){this.hit&&this.hit.css({pointerEvents:"auto"})},$.fn.touchSwipe=function(callback,distance){if(!window.addEventListener)return this;var _startX,_startY,_this=this,_distance=distance||75,_moving=!1,_move={};function touchMove(e){if(!_this.div)return!1;if(_moving){var touch=convertTouchEvent(e),dx=_startX-touch.x,dy=_startY-touch.y;_move.direction=null,_move.moving=null,_move.x=null,_move.y=null,_move.evt=e,Math.abs(dx)>=_distance?(touchEnd(),_move.direction=dx>0?"left":"right"):Math.abs(dy)>=_distance?(touchEnd(),_move.direction=dy>0?"up":"down"):(_move.moving=!0,_move.x=dx,_move.y=dy),callback&&callback(_move,e)}}function touchEnd(e){if(!_this.div)return!1;_startX=_startY=_moving=!1,_this.div.removeEventListener(translateEvent("touchmove"),touchMove)}return Device.mobile&&(this.div.addEventListener(translateEvent("touchstart"),(function touchStart(e){var touch=convertTouchEvent(e);if(!_this.div)return!1;1==e.touches.length&&(_startX=touch.x,_startY=touch.y,_moving=!0,_this.div.addEventListener(translateEvent("touchmove"),touchMove,{passive:!0}))}),{passive:!0}),this.div.addEventListener(translateEvent("touchend"),touchEnd,{passive:!0}),this.div.addEventListener(translateEvent("touchcancel"),touchEnd,{passive:!0})),this},$.fn.touchClick=function(hover,click){if(!window.addEventListener)return this;var _time,_move,_this=this,_start={},_touch={};function setTouch(e){var touch=convertTouchEvent(e);e.touchX=touch.x,e.touchY=touch.y,_start.x=e.touchX,_start.y=e.touchY}return Device.mobile&&(this.div.addEventListener(translateEvent("touchstart"),(function touchStart(e){if(!_this.div)return!1;_time=performance.now(),e.action="over",e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),hover&&!_move&&hover(e)}),{passive:!0}),this.div.addEventListener(translateEvent("touchend"),(function touchEnd(e){if(!_this.div)return!1;var time=performance.now();if(_touch=convertTouchEvent(e),_move=function findDistance(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)}(_start,_touch)>25,e.object="hit"==_this.div.className?_this.parent():_this,setTouch(e),_time&&time-_time<750){if(Mouse._preventClicks)return!1;click&&!_move&&(!0,e.action="click",click&&!_move&&click(e),Mouse.autoPreventClicks&&Mouse.preventClicks())}hover&&(e.action="out",Mouse._preventFire||hover(e));_move=!1}),{passive:!0})),this}}(),Class((function Element(type="div"){Inherit(this,Component);var name=Utils.getConstructorName(this);this.__element=!0,this.element=$("."+name,type),this.element.__useFragment=!0,this.destroy=function(){this.element&&this.element.remove&&(this.element=this.element.remove()),this._destroy&&this._destroy()},this.querySelector=async function(selector){if(await defer(),Array.isArray(selector)){let values=[];return selector.forEach((s=>{values.push($(this.element.div.querySelector(s)))})),values}return $(this.element.div.querySelector(selector))},this.querySelectorAll=async function(selector){await defer();let list=this.element.div.querySelectorAll(selector),values=[];for(let i=0;i<list.length;i++)values.push($(list[i]));return values}})),(()=>{var zn=Object.create,ke=Object.defineProperty,Wn=Object.defineProperties,Ln=Object.getOwnPropertyDescriptor,Un=Object.getOwnPropertyDescriptors,Kn=Object.getOwnPropertyNames,Be=Object.getOwnPropertySymbols,Hn=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty,vr=Object.prototype.propertyIsEnumerable,Tt=(t,e,r)=>e in t?ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,g=(t,e)=>{for(var r in e||(e={}))It.call(e,r)&&Tt(t,r,e[r]);if(Be)for(var r of Be(e))vr.call(e,r)&&Tt(t,r,e[r]);return t},x=(t,e)=>Wn(t,Un(e)),br=t=>ke(t,"__esModule",{value:!0}),Fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),wt=(t,e)=>{for(var r in br(t),e)ke(t,r,{get:e[r],enumerable:!0})},Re=t=>((t,e,r)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let o of Kn(e))!It.call(t,o)&&"default"!==o&&ke(t,o,{get:()=>e[o],enumerable:!(r=Ln(e,o))||r.enumerable});return t})(br(ke(null!=t?zn(Hn(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),l=(t,e,r)=>(Tt(t,"symbol"!=typeof e?e+"":e,r),r),No=Fe(((Mc,Vo)=>{Vo.exports=function(){function t(e,r,o,n){this.set(e,r,o,n)}return t.prototype.set=function(e,r,o,n){this._cx=3*e,this._bx=3*(o-e)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*r,this._by=3*(n-r)-this._cy,this._ay=1-this._cy-this._by},t.epsilon=1e-6,t.prototype._sampleCurveX=function(e){return((this._ax*e+this._bx)*e+this._cx)*e},t.prototype._sampleCurveY=function(e){return((this._ay*e+this._by)*e+this._cy)*e},t.prototype._sampleCurveDerivativeX=function(e){return(3*this._ax*e+2*this._bx)*e+this._cx},t.prototype._solveCurveX=function(e,r){var o,n,a,i,s,u;for(a=void 0,i=void 0,s=void 0,u=void 0,o=void 0,n=void 0,s=e,n=0;n<8;){if(u=this._sampleCurveX(s)-e,Math.abs(u)<r)return s;if(o=this._sampleCurveDerivativeX(s),Math.abs(o)<r)break;s-=u/o,n++}if((s=e)<(a=0))return a;if(s>(i=1))return i;for(;a<i;){if(u=this._sampleCurveX(s),Math.abs(u-e)<r)return s;e>u?a=s:i=s,s=.5*(i-a)+a}return s},t.prototype.solve=function(e,r){return this._sampleCurveY(this._solveCurveX(e,r))},t.prototype.solveSimple=function(e){return this._sampleCurveY(this._solveCurveX(e,1e-6))},t}()})),qo=Fe(((dd,Ro)=>{var nt,Lt;nt=[],Lt=[],Ro.exports=function ts(t,e,r){var o,n,a,i,s,u,p,f;if(t===e)return 0;if(o=t.length,n=e.length,0===o)return n;if(0===n)return o;for(r&&(t=t.toLowerCase(),e=e.toLowerCase()),p=0;p<o;)Lt[p]=t.charCodeAt(p),nt[p]=++p;for(f=0;f<n;)for(a=e.charCodeAt(f),i=s=f++,p=-1;++p<o;)u=a===Lt[p]?s:s+1,s=nt[p],nt[p]=i=s>i?u>i?i+1:u:u>s?s+1:u;return i}})),Lo=Fe(((hd,Wo)=>{var zo=qo();Wo.exports=function rs(){var t,e,r,o,n,a=0,i=arguments[0],s=arguments[1],u=s.length,p=arguments[2];p&&(o=p.threshold,n=p.ignoreCase),void 0===o&&(o=0);for(var f=0;f<u;++f)(t=(e=n?zo(i,s[f],!0):zo(i,s[f]))>i.length?1-e/s[f].length:1-e/i.length)>a&&(a=t,r=s[f]);return a>=o?r:null}})),Qt=Fe(((Qh,In)=>{"use strict";In.exports=function t(e,r){if(e===r)return!0;if(e&&r&&"object"==typeof e&&"object"==typeof r){if(e.constructor!==r.constructor)return!1;var o,n,a;if(Array.isArray(e)){if((o=e.length)!=r.length)return!1;for(n=o;0!=n--;)if(!t(e[n],r[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if((o=(a=Object.keys(e)).length)!==Object.keys(r).length)return!1;for(n=o;0!=n--;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=o;0!=n--;){var i=a[n];if(!t(e[i],r[i]))return!1}return!0}return e!=e&&r!=r}})),gr={};wt(gr,{getProject:()=>Bn,onChange:()=>Fn,types:()=>ft});var yr={};wt(yr,{getProject:()=>Bn,onChange:()=>Fn,types:()=>ft});var ue=Array.isArray,xr="object"==typeof window&&window&&window.Object===Object&&window,Xn="object"==typeof self&&self&&self.Object===Object&&self,le=xr||Xn||Function("return this")(),N=le.Symbol,Pr=Object.prototype,ea=Pr.hasOwnProperty,ta=Pr.toString,Ce=N?N.toStringTag:void 0;var _r=function ra(t){var e=ea.call(t,Ce),r=t[Ce];try{t[Ce]=void 0;var o=!0}catch(a){}var n=ta.call(t);return o&&(e?t[Ce]=r:delete t[Ce]),n},na=Object.prototype.toString;var Sr=function aa(t){return na.call(t)},Ir=N?N.toStringTag:void 0;var fe=function pa(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ir&&Ir in Object(t)?_r(t):Sr(t)};var qe=function ua(t){return null!=t&&"object"==typeof t};var z=function fa(t){return"symbol"==typeof t||qe(t)&&"[object Symbol]"==fe(t)},ca=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,da=/^\w*$/;var Tr=function ha(t,e){if(ue(t))return!1;var r=typeof t;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=t&&!z(t))||(da.test(t)||!ca.test(t)||null!=e&&t in Object(e))};var Y=function ma(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)};var wr=function ja(t){if(!Y(t))return!1;var e=fe(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},ze=le["__core-js_shared__"],Dr=function(){var t=/[^.]+$/.exec(ze&&ze.keys&&ze.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();var Ar=function Pa(t){return!!Dr&&Dr in t},Sa=Function.prototype.toString;var Or=function Ia(t){if(null!=t){try{return Sa.call(t)}catch(e){}try{return t+""}catch(e){}}return""},wa=/^\[object .+?Constructor\]$/,Da=Function.prototype,Aa=Object.prototype,Oa=Da.toString,ka=Aa.hasOwnProperty,Ca=RegExp("^"+Oa.call(ka).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var kr=function Va(t){return!(!Y(t)||Ar(t))&&(wr(t)?Ca:wa).test(Or(t))};var Cr=function Na(t,e){return null==t?void 0:t[e]};var We=function Ma(t,e){var r=Cr(t,e);return kr(r)?r:void 0},M=We(Object,"create");var Vr=function $a(){this.__data__=M?M(null):{},this.size=0};var Nr=function Ba(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},qa=Object.prototype.hasOwnProperty;var Mr=function za(t){var e=this.__data__;if(M){var r=e[t];return"__lodash_hash_undefined__"===r?void 0:r}return qa.call(e,t)?e[t]:void 0},La=Object.prototype.hasOwnProperty;var Er=function Ua(t){var e=this.__data__;return M?void 0!==e[t]:La.call(e,t)};var $r=function Ha(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=M&&void 0===e?"__lodash_hash_undefined__":e,this};function ce(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}ce.prototype.clear=Vr,ce.prototype.delete=Nr,ce.prototype.get=Mr,ce.prototype.has=Er,ce.prototype.set=$r;var Dt=ce;var Br=function Ga(){this.__data__=[],this.size=0};var Fr=function Ja(t,e){return t===e||t!=t&&e!=e};var W=function Ya(t,e){for(var r=t.length;r--;)if(Fr(t[r][0],e))return r;return-1},Za=Array.prototype.splice;var Rr=function Qa(t){var e=this.__data__,r=W(e,t);return!(r<0)&&(r==e.length-1?e.pop():Za.call(e,r,1),--this.size,!0)};var qr=function ei(t){var e=this.__data__,r=W(e,t);return r<0?void 0:e[r][1]};var zr=function ti(t){return W(this.__data__,t)>-1};var Wr=function ri(t,e){var r=this.__data__,o=W(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this};function de(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}de.prototype.clear=Br,de.prototype.delete=Rr,de.prototype.get=qr,de.prototype.has=zr,de.prototype.set=Wr;var Lr=de,Ur=We(le,"Map");var Kr=function ni(){this.size=0,this.__data__={hash:new Dt,map:new(Ur||Lr),string:new Dt}};var Hr=function ai(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var L=function ii(t,e){var r=t.__data__;return Hr(e)?r["string"==typeof e?"string":"hash"]:r.map};var Gr=function si(t){var e=L(this,t).delete(t);return this.size-=e?1:0,e};var Jr=function pi(t){return L(this,t).get(t)};var Yr=function ui(t){return L(this,t).has(t)};var Xr=function li(t,e){var r=L(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this};function he(t){var e=-1,r=null==t?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}he.prototype.clear=Kr,he.prototype.delete=Gr,he.prototype.get=Jr,he.prototype.has=Yr,he.prototype.set=Xr;var At=he;function Ot(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var r=function(){var o=arguments,n=e?e.apply(this,o):o[0],a=r.cache;if(a.has(n))return a.get(n);var i=t.apply(this,o);return r.cache=a.set(n,i)||a,i};return r.cache=new(Ot.Cache||At),r}Ot.Cache=At;var Zr=Ot;var hi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mi=/\\(\\)?/g,eo=function di(t){var e=Zr(t,(function(o){return 500===r.size&&r.clear(),o})),r=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(hi,(function(r,o,n,a){e.push(n?a.replace(mi,"$1"):o||r)})),e}));var to=function gi(t,e){for(var r=-1,o=null==t?0:t.length,n=Array(o);++r<o;)n[r]=e(t[r],r,t);return n},ro=N?N.prototype:void 0,oo=ro?ro.toString:void 0;var Le=function no(t){if("string"==typeof t)return t;if(ue(t))return to(t,no)+"";if(z(t))return oo?oo.call(t):"";var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var Ue=function bi(t){return null==t?"":Le(t)};var ao=function ji(t,e){return ue(t)?t:Tr(t,e)?[t]:eo(Ue(t))};var io=function Pi(t){if("string"==typeof t||z(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e};var so=function _i(t,e){for(var r=0,o=(e=ao(e,t)).length;null!=t&&r<o;)t=t[io(e[r++])];return r&&r==o?t:void 0};var me=function Si(t,e,r){var o=null==t?void 0:so(t,e);return void 0===o?r:o};var uo=function Ii(t,e){return function(r){return t(e(r))}}(Object.getPrototypeOf,Object),Di=Function.prototype,Ai=Object.prototype,lo=Di.toString,Oi=Ai.hasOwnProperty,ki=lo.call(Object);var Ve=function Ci(t){if(!qe(t)||"[object Object]"!=fe(t))return!1;var e=uo(t);if(null===e)return!0;var r=Oi.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&lo.call(r)==ki};var j,o,fo=function Vi(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},U=class{constructor(){this._lastTapperId=0,this._tappers=new Map,this.tappable=new class{constructor(e){this._untapFromSourceTimeout=null,this._cb=e=>{this._tappers.forEach((r=>{r(e)}))},this._lastTapperId=0,this._untapFromSource=null,this._props=e,this._tappers=new Map}_check(){this._untapFromSource?0===this._tappers.size&&this._scheduleToUntapFromSource():0!==this._tappers.size&&(this._untapFromSource=this._props.tapToSource(this._cb))}_scheduleToUntapFromSource(){null===this._untapFromSourceTimeout&&(this._untapFromSourceTimeout=setTimeout((()=>{this._untapFromSourceTimeout=null,0===this._tappers.size&&(this._untapFromSource(),this._untapFromSource=null)}),0))}tap(e){let r=this._lastTapperId++;return this._tappers.set(r,e),this._check(),()=>{this._removeTapperById(r)}}_removeTapperById(e){this._tappers.delete(e),this._check()}}({tapToSource:e=>this._tap(e)})}_tap(e){let r=this._lastTapperId++;return this._tappers.set(r,e),this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size),()=>{this._removeTapperById(r)}}_removeTapperById(e){let r=this._tappers.size;this._tappers.delete(e),r!==this._tappers.size&&this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size)}emit(e){this._tappers.forEach((r=>{r(e)}))}hasTappers(){return 0!==this._tappers.size}onNumberOfTappersChange(e){this._onNumberOfTappersChangeListener=e}};function C(t){return t&&t.isDerivation&&!0===t.isDerivation}(o=j||(j={}))[o.none=0]="none",o[o.dep=1]="dep",o[o.inner=2]="inner";var kt,Ni=()=>{class t extends _{constructor(r,o){return super(),this._depDerivation=r,this._fn=o,this._innerDerivation=void 0,this._staleDependency=1,this._addDependency(r),this}_recalculateHot(){let r=this._staleDependency;if(this._staleDependency=0,2===r)return this._innerDerivation.getValue();let o=this._fn(this._depDerivation.getValue());return C(o)?(this._innerDerivation=o,this._addDependency(o),o.getValue()):o}_recalculateCold(){let r=this._fn(this._depDerivation.getValue());return C(r)?r.getValue():r}_recalculate(){return this.isHot?this._recalculateHot():this._recalculateCold()}_reactToDependencyBecomingStale(r){let o=r===this._depDerivation?1:2;if(2===o&&r!==this._innerDerivation)throw Error("got a _reactToDependencyBecomingStale() from neither the dep nor the inner derivation");0===this._staleDependency?(this._staleDependency=o,1===o&&this._removeInnerDerivation()):1===this._staleDependency||1===o&&(this._staleDependency=1,this._removeInnerDerivation())}_removeInnerDerivation(){this._innerDerivation&&(this._removeDependency(this._innerDerivation),this._innerDerivation=void 0)}_keepHot(){this._staleDependency=1,this.getValue()}_becomeCold(){this._staleDependency=1,this._removeInnerDerivation()}}return t.displayName="flatMap",t};var Vt,Mi=()=>class extends _{constructor(e,r){super(),this._dep=e,this._fn=r,this._addDependency(e)}_recalculate(){return this._fn(this._dep.getValue())}_reactToDependencyBecomingStale(){}};var ye=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){let e=this._head;if(e)return this._head=e.next,e.data}push(e){let r={next:this._head,data:e};this._head=r}};function co(){let e=new ye,r=()=>{};return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{e.push(r)},stopIgnoringDependencies:()=>{e.peek()!==r||e.pop()},reportResolutionStart:p=>{let f=e.peek();f&&f(p),e.push(r)},reportResolutionEnd:p=>{e.pop()},pushCollector:p=>{e.push(p)},popCollector:p=>{if(e.peek()!==p)throw new Error("Popped collector is not on top of the stack");e.pop()}}}var{startIgnoringDependencies:ge,stopIgnoringDependencies:ve,reportResolutionEnd:ho,reportResolutionStart:mo,pushCollector:yo,popCollector:go}=function Ei(){let t="__dataverse_discoveryMechanism_sharedStack";if(window){let e=window[t];if(e&&"object"==typeof e&&"Dataverse_discoveryMechanism"===e.type)return e;{let r=co();return window[t]=r,r}}return co()}(),_=class{constructor(){this.isDerivation=!0,this._didMarkDependentsAsStale=!1,this._isHot=!1,this._isFresh=!1,this._lastValue=void 0,this._dependents=new Set,this._dependencies=new Set,this._internal_markAsStale=e=>{this._reactToDependencyBecomingStale(e),!this._didMarkDependentsAsStale&&(this._didMarkDependentsAsStale=!0,this._isFresh=!1,this._dependents.forEach((r=>{r(this)})))}}get isHot(){return this._isHot}_addDependency(e){this._dependencies.has(e)||(this._dependencies.add(e),this._isHot&&e.addDependent(this._internal_markAsStale))}_removeDependency(e){!this._dependencies.has(e)||(this._dependencies.delete(e),this._isHot&&e.removeDependent(this._internal_markAsStale))}changes(e){return new class{constructor(e,r){return this._possiblyMarkAsStale=()=>{this._ticker.onThisOrNextTick(this._refresh)},this._refresh=()=>{let e=this._derivation.getValue();e===this._lastValue&&!0===this._lastValueRecorded||(this._lastValue=e,this._lastValueRecorded=!0,this._emitter.emit(e))},this._derivation=e,this._ticker=r,this._emitter=new U,this._emitter.onNumberOfTappersChange((()=>{this._reactToNumberOfTappersChange()})),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_reactToNumberOfTappersChange(){let e=this._emitter.hasTappers();e!==this._hadTappers&&(this._hadTappers=e,e?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}}(this,e).tappable()}changesWithoutValues(){return new class{constructor(e,r=!1){return this.dontEmitValues=r,this._possiblyMarkAsStale=()=>{this._emitter.emit(void 0)},this._derivation=e,this._emitter=new U,this._emitter.onNumberOfTappersChange((()=>{this._reactToNumberOfTappersChange()})),this._hadTappers=!1,this}_reactToNumberOfTappersChange(){let e=this._emitter.hasTappers();e!==this._hadTappers&&(this._hadTappers=e,e?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}}(this).tappable()}keepHot(){return this.changesWithoutValues().tap((()=>{}))}tapImmediate(e,r){let o=this.changes(e).tap(r);return r(this.getValue()),o}addDependent(e){let r=this._dependents.size>0;this._dependents.add(e),r!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}removeDependent(e){let r=this._dependents.size>0;this._dependents.delete(e),r!==this._dependents.size>0&&this._reactToNumberOfDependentsChange()}_markAsStale(e){this._internal_markAsStale(e)}getValue(){if(mo(this),!this._isFresh){let e=this._recalculate();this._lastValue=e,this._isHot&&(this._isFresh=!0,this._didMarkDependentsAsStale=!1)}return ho(this),this._lastValue}_reactToNumberOfDependentsChange(){let e=this._dependents.size>0;e!==this._isHot&&(this._isHot=e,this._didMarkDependentsAsStale=!1,this._isFresh=!1,e?(this._dependencies.forEach((r=>{r.addDependent(this._internal_markAsStale)})),this._keepHot()):(this._dependencies.forEach((r=>{r.removeDependent(this._internal_markAsStale)})),this._becomeCold()))}_keepHot(){}_becomeCold(){}map(e){return function Nt(t,e){return Vt||(Vt=Mi()),new Vt(t,e)}(this,e)}flatMap(e){return function Ct(t,e){return kt||(kt=Ni()),new kt(t,e)}(this,e)}},vo=()=>{},X=class extends _{constructor(e,r){super(),this._tapToSource=e,this._getValueFromSource=r,this._untapFromChanges=vo,this._cachedValue=void 0,this._hasCachedValue=!1}_recalculate(){return this.isHot?(this._hasCachedValue||(this._cachedValue=this._getValueFromSource(),this._hasCachedValue=!0),this._cachedValue):this._getValueFromSource()}_keepHot(){this._hasCachedValue=!1,this._cachedValue=void 0,this._untapFromChanges=this._tapToSource((e=>{this._hasCachedValue=!0,this._cachedValue=e,this._markAsStale(this)}))}_becomeCold(){this._untapFromChanges(),this._untapFromChanges=vo,this._hasCachedValue=!1,this._cachedValue=void 0}_reactToDependencyBecomingStale(){}},Mt=new WeakMap,bo=Symbol("pointerMeta"),jo=new WeakMap,$i={get(t,e){if(e===bo)return Mt.get(t);let r=jo.get(t);if(r||(r={},jo.set(t,r)),r[e])return r[e];let o=Mt.get(t),n=xo({root:o.root,path:[...o.path,e]});return r[e]=n,n}},Je=t=>t[bo],Ne=t=>{let{root:e,path:r}=Je(t);return{root:e,path:r}};function xo(t){var o;let e={root:t.root,path:null!=(o=t.path)?o:[]},r={};return Mt.set(r,e),new Proxy(r,$i)}var Z=xo,Q=t=>t&&!!Je(t);var K,Ye=(t,e,r)=>{if(0===e.length)return r(t);if(Array.isArray(t)){let[o,...n]=e;o=parseInt(String(o),10),isNaN(o)&&(o=0);let a=t[o],i=Ye(a,n,r);if(a===i)return t;let s=[...t];return s.splice(o,1,i),s}if("object"==typeof t&&null!==t){let[o,...n]=e,a=t[o],i=Ye(a,n,r);return a===i?t:x(g({},t),{[o]:i})}{let[o,...n]=e;return{[o]:Ye(void 0,n,r)}}};!function(o){o[o.Dict=0]="Dict",o[o.Array=1]="Array",o[o.Other=2]="Other"}(K||(K={}));var $t=t=>Array.isArray(t)?1:Ve(t)?0:2,Po=(t,e,r=$t(t))=>0===r&&"string"==typeof e||1===r&&Bi(e)?t[e]:void 0,Bi=t=>{let e="number"==typeof t?t:parseInt(t,10);return!isNaN(e)&&e>=0&&e<1/0&&(0|e)===e},Xe=class{constructor(e,r){this._parent=e,this._path=r,this.children=new Map,this.identityChangeListeners=new Set}addIdentityChangeListener(e){this.identityChangeListeners.add(e)}removeIdentityChangeListener(e){this.identityChangeListeners.delete(e),this._checkForGC()}removeChild(e){this.children.delete(e),this._checkForGC()}getChild(e){return this.children.get(e)}getOrCreateChild(e){let r=this.children.get(e);return r||(r=r=new Xe(this,this._path.concat([e])),this.children.set(e,r)),r}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(fo(this._path))}},y=class{constructor(e){this.$$isIdentityDerivationProvider=!0,this.reduceState=(e,r)=>{let o=function Et(t,e,r){return 0===e.length?r(t):Ye(t,e,r)}(this.getState(),e,r);return this.setState(o),o},this._onPathValueChange=(e,r)=>{let o=this._getOrCreateScopeForPath(e);return o.identityChangeListeners.add(r),()=>{o.identityChangeListeners.delete(r)}},this._currentState=e,this._rootScope=new Xe(void 0,[]),this.pointer=Z({root:this,path:[]})}setState(e){let r=this._currentState;this._currentState=e,this._checkUpdates(this._rootScope,r,e)}getState(){return this._currentState}getIn(e){return 0===e.length?this.getState():me(this.getState(),e)}setIn(e,r){return this.reduceState(e,(()=>r))}_checkUpdates(e,r,o){if(r===o||(e.identityChangeListeners.forEach((i=>i(o))),0===e.children.size))return;let n=$t(r),a=$t(o);2===n&&n===a||e.children.forEach(((i,s)=>{let u=Po(r,s,n),p=Po(o,s,a);this._checkUpdates(i,u,p)}))}_getOrCreateScopeForPath(e){let r=this._rootScope;for(let o of e)r=r.getOrCreateChild(o);return r}getIdentityDerivation(e){return new X((r=>this._onPathValueChange(e,r)),(()=>this.getIn(e)))}},_o=new WeakMap,S=t=>{let e=Je(t),r=_o.get(e);if(!r){let o=e.root;if(!function Fi(t){return"object"==typeof t&&null!==t&&!0===t.$$isIdentityDerivationProvider}(o))throw new Error("Cannot run valueDerivation() on a pointer whose root is not an IdentityChangeProvider");let{path:n}=e;r=o.getIdentityDerivation(n),_o.set(e,r)}return r};var v=t=>Q(t)?S(t).getValue():C(t)?t.getValue():t,E=class{constructor(e){this._value=e,this._emitter=new U,this._publicDerivation=new X((r=>this._emitter.tappable.tap(r)),this.get.bind(this))}set(e){e!==this._value&&(this._value=e,this._emitter.emit(e))}get(){return this._value}get derivation(){return this._publicDerivation}},T=class extends _{constructor(e){return super(),this._v=e,this}_recalculate(){return this._v}_reactToDependencyBecomingStale(){}},So=()=>{},Io=class extends _{constructor(e){super(),this._fn=e,this._cacheOfDendencyValues=new Map,this._possiblyStaleDeps=new Set,this._prismScope=new je}_recalculate(){let e;if(this._possiblyStaleDeps.size>0){let n=!1;ge();for(let a of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(a)!==a.getValue()){n=!0;break}if(ve(),this._possiblyStaleDeps.clear(),!n)return this._lastValue}let r=new Set;this._cacheOfDendencyValues.clear();let o=n=>{r.add(n),this._addDependency(n)};yo(o),V.push(this._prismScope);try{e=this._fn()}catch(n){console.error(n)}finally{V.pop()!==this._prismScope&&console.warn("The Prism hook stack has slipped. This is a bug.")}return go(o),this._dependencies.forEach((n=>{r.has(n)||this._removeDependency(n)})),this._dependencies=r,ge(),r.forEach((n=>{this._cacheOfDendencyValues.set(n,n.getValue())})),ve(),e}_reactToDependencyBecomingStale(e){this._possiblyStaleDeps.add(e)}_keepHot(){this._prismScope=new je,ge(),this.getValue(),ve()}_becomeCold(){To(this._prismScope),this._prismScope=new je}},je=class{constructor(){this.isPrismScope=!0,this._subs={}}sub(e){return this._subs[e]||(this._subs[e]=new je),this._subs[e]}get subs(){return this._subs}};function To(t){for(let[e,r]of Object.entries(t.subs))To(r);!function Ri(t){let e=Qe.get(t);if(e)for(let r of Object.keys(e)){Ze(e[r].cleanup,void 0)}Qe.delete(t)}(t)}function Ze(t,e){let r=e,o=!1;try{r=t(),o=!0}catch(n){setTimeout((()=>{throw n}))}return{success:o,returnValue:r}}var V=new ye,wo=new WeakMap,Qe=new WeakMap,Do=new WeakMap;function Ao(t,e){return void 0===t||void 0===e||t.length!==e.length||t.some(((r,o)=>r!==e[o]))}function Oo(t,e,r){let o=V.peek();if(!o)throw new Error("prism.memo() is called outside of a prism() call.");let n=Do.get(o);n||(n={},Do.set(o,n)),n[t]||(n[t]={cachedValue:null,deps:[{}]});let a=n[t];return Ao(a.deps,r)&&(ge(),a.cachedValue=Ze(e,void 0).returnValue,ve(),a.deps=r),a.cachedValue}var O=t=>new Io(t);O.ref=function qi(t,e){let r=V.peek();if(!r)throw new Error("prism.ref() is called outside of a prism() call.");let o=wo.get(r);if(o||(o={},wo.set(r,o)),o[t])return o[t];{let n={current:e};return o[t]=n,n}},O.effect=function zi(t,e,r){let o=V.peek();if(!o)throw new Error("prism.effect() is called outside of a prism() call.");let n=Qe.get(o);n||(n={},Qe.set(o,n)),n[t]||(n[t]={cleanup:So,deps:[{}]});let a=n[t];Ao(a.deps,r)&&(a.cleanup(),ge(),a.cleanup=Ze(e,So).returnValue,ve(),a.deps=r)},O.memo=Oo,O.ensurePrism=function Li(){if(!V.peek())throw new Error("The parent function is called outside of a prism() call.")},O.state=function Wi(t,e){let{b:r,setValue:o}=O.memo("state/"+t,(()=>{let n=new E(e);return{b:n,setValue:i=>n.set(i)}}),[]);return[r.derivation.getValue(),o]},O.scope=function Ui(t,e){let r=V.peek();if(!r)throw new Error("prism.scope() is called outside of a prism() call.");let o=r.sub(t);V.push(o);let n=Ze(e,void 0).returnValue;return V.pop(),n},O.sub=function Ki(t,e,r){return Oo(t,(()=>O(e)),r).getValue()},O.inPrism=function Hi(){return!!V.peek()};var d=O,ee=class{constructor(e){this.$$isIdentityDerivationProvider=!0,this._currentPointerBox=new E(e),this.pointer=Z({root:this,path:[]})}setPointer(e){this._currentPointerBox.set(e)}getIdentityDerivation(e){return this._currentPointerBox.derivation.flatMap((r=>{let o=e.reduce(((n,a)=>n[a]),r);return S(o)}))}},xe=new class{constructor(){l(this,"atom",new y({projects:{}}))}add(e,r){this.atom.reduceState(["projects",e],(()=>r))}get(e){return this.atom.getState().projects[e]}has(e){return!!this.get(e)}},Co=new WeakMap;function m(t){return Co.get(t)}function H(t,e){Co.set(t,e)}var Bt=[];var G=class{constructor(){l(this,"_values",{})}get(e,r){if(this.has(e))return this._values[e];{let o=r();return this._values[e]=o,o}}has(e){return this._values.hasOwnProperty(e)}},Rt=new WeakMap;function zt(t){if(Rt.has(t))return Rt.get(t);let e="compound"===t.type?function Yi(t){let e={};for(let[r,o]of Object.entries(t.props))e[r]=zt(o);return e}(t):"enum"===t.type?function Ji(t){let e={$case:t.defaultCase};for(let[r,o]of Object.entries(t.cases))e[r]=zt(o);return e}(t):t.default;return Rt.set(t,e),e}var Pe={log:console.log,warn:console.warn,error:console.error,trace:console.trace},Mo=Re(No());function Wt(t,e){return d((()=>{let r=v(t);return d.memo("driver",(()=>r?"BasicKeyframedTrack"===r.type?function Qi(t,e){return d((()=>{let r=d.ref("state",{started:!1}),o=r.current,n=e.getValue();return(!o.started||n<o.validFrom||o.validTo<=n)&&(r.current=o=es(e,t)),o.der.getValue()}))}(r,e):(Pe.error("Track type not yet supported."),new T(void 0)):new T(void 0)),[r]).getValue()}))}var Eo=new T(void 0),es=(t,e)=>{let r=t.getValue();if(0===e.keyframes.length)return{started:!0,validFrom:-1/0,validTo:1/0,der:Eo};let o=0;for(;;){let n=e.keyframes[o];if(!n)return te.error;let a=o===e.keyframes.length-1;if(r<n.position)return 0===o?te.beforeFirstKeyframe(n):te.error;if(n.position===r)return a?te.lastKeyframe(n):te.between(n,e.keyframes[o+1],t);if(o===e.keyframes.length-1)return te.lastKeyframe(n);{let i=o+1;if(e.keyframes[i].position<=r){o=i;continue}return te.between(n,e.keyframes[o+1],t)}}},te={beforeFirstKeyframe:t=>({started:!0,validFrom:-1/0,validTo:t.position,der:new T(t.value)}),lastKeyframe:t=>({started:!0,validFrom:t.position,validTo:1/0,der:new T(t.value)}),between(t,e,r){if(!t.connectedRight)return{started:!0,validFrom:t.position,validTo:e.position,der:new T(t.value)};let o=new Mo.default(t.handles[2],t.handles[3],e.handles[0],e.handles[1]),a=d((()=>{let i=(i=>(i-t.position)/(e.position-t.position))(r.getValue()),s=o.solveSimple(i);return t.value+s*(e.value-t.value)}));return{started:!0,validFrom:t.position,validTo:e.position,der:a}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:Eo}};function _e(t,e,r){let n=r.get(t);if(n&&n.override===e)return n.merged;let a=g({},t);for(let i of Object.keys(e)){let s=e[i],u=t[i];a[i]="object"==typeof s&&"object"==typeof u?_e(u,s,r):void 0===s?u:s}return r.set(t,{override:e,merged:a}),a}function et(t,e){let r=t;for(let o of e)r=r[o];return r}var Bo=new class{constructor(){this._ticking=!1,this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}onThisOrNextTick(e){this._scheduledForThisOrNextTick.add(e)}onNextTick(e){this._scheduledForNextTick.add(e)}offThisOrNextTick(e){this._scheduledForThisOrNextTick.delete(e)}offNextTick(e){this._scheduledForNextTick.delete(e)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}tick(e=performance.now()){this._ticking=!0,this._timeAtCurrentTick=e,this._scheduledForNextTick.forEach((r=>this._scheduledForThisOrNextTick.add(r))),this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(e){let r=this.time;if(e>10&&console.warn("_tick() recursing for 10 times"),e>100)throw new Error("Maximum recursion limit for _tick()");let o=this._scheduledForThisOrNextTick;if(this._scheduledForThisOrNextTick=new Set,o.forEach((n=>{n(r)})),this._scheduledForThisOrNextTick.size>0)return this._tick(e+1)}},$=Bo,Fo=t=>{Bo.tick(t),window.requestAnimationFrame(Fo)};window.requestAnimationFrame(Fo);Re(Lo());var Uo=class extends Error{},w=class extends Uo{},ns=/\s/;var Ko=function as(t){for(var e=t.length;e--&&ns.test(t.charAt(e)););return e},is=/^\s+/;var Ho=function ss(t){return t&&t.slice(0,Ko(t)+1).replace(is,"")},ps=/^[-+]0x[0-9a-f]+$/i,us=/^0b[01]+$/i,ls=/^0o[0-7]+$/i,fs=parseInt;var Jo=function cs(t){if("number"==typeof t)return t;if(z(t))return NaN;if(Y(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Y(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Ho(t);var r=us.test(t);return r||ls.test(t)?fs(t.slice(2),r?2:8):ps.test(t)?NaN:+t};var Xo=function hs(t){return t?Infinity===(t=Jo(t))||-Infinity===t?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0};var Zo=function ms(t){var e=Xo(t),r=e%1;return e==e?r?e-r:e:0};var Qo=function ys(t,e,r){var o=-1,n=t.length;e<0&&(e=-e>n?0:n+e),(r=r>n?n:r)<0&&(r+=n),n=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(n);++o<n;)a[o]=t[o+e];return a};var en=function gs(t,e,r){var o=t.length;return r=void 0===r?o:r,!e&&r>=o?t:Qo(t,e,r)},Is=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Se=function Ts(t){return Is.test(t)};var tn=function ws(t){return t.split("")},rn="\\ud800-\\udfff",Vs="["+rn+"]",Ut="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Kt="\\ud83c[\\udffb-\\udfff]",on="[^"+rn+"]",nn="(?:\\ud83c[\\udde6-\\uddff]){2}",an="[\\ud800-\\udbff][\\udc00-\\udfff]",sn="(?:"+Ut+"|"+Kt+")"+"?",pn="[\\ufe0e\\ufe0f]?",$s=pn+sn+("(?:\\u200d(?:"+[on,nn,an].join("|")+")"+pn+sn+")*"),Bs="(?:"+[on+Ut+"?",Ut,nn,an,Vs].join("|")+")",Fs=RegExp(Kt+"(?="+Kt+")|"+Bs+$s,"g");var un=function Rs(t){return t.match(Fs)||[]};var ln=function qs(t){return Se(t)?un(t):tn(t)};var fn=function zs(t){return function(e){return null==e?void 0:e[t]}},Ls=Math.floor;var Ht=function Us(t,e){var r="";if(!t||e<1||e>9007199254740991)return r;do{e%2&&(r+=t),(e=Ls(e/2))&&(t+=t)}while(e);return r},cn=fn("length"),dn="\\ud800-\\udfff",Zs="["+dn+"]",Gt="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Jt="\\ud83c[\\udffb-\\udfff]",hn="[^"+dn+"]",mn="(?:\\ud83c[\\udde6-\\uddff]){2}",yn="[\\ud800-\\udbff][\\udc00-\\udfff]",gn="(?:"+Gt+"|"+Jt+")"+"?",vn="[\\ufe0e\\ufe0f]?",rp=vn+gn+("(?:\\u200d(?:"+[hn,mn,yn].join("|")+")"+vn+gn+")*"),op="(?:"+[hn+Gt+"?",Gt,mn,yn,Zs].join("|")+")",bn=RegExp(Jt+"(?="+Jt+")|"+op+rp,"g");var jn=function np(t){for(var e=bn.lastIndex=0;bn.test(t);)++e;return e};var at=function ap(t){return Se(t)?jn(t):cn(t)},ip=Math.ceil;var xn=function sp(t,e){var r=(e=void 0===e?" ":Le(e)).length;if(r<2)return r?Ht(e,t):e;var o=Ht(e,ip(t/at(e)));return Se(e)?en(ln(o),0,t).join(""):o.slice(0,t)};var re=function pp(t,e,r){t=Ue(t);var o=(e=Zo(e))?at(t):0;return e&&o<e?xn(e-o,r)+t:t};function B(){let t,e,r=new Promise(((n,a)=>{t=i=>{n(i),o.status="resolved"},e=i=>{a(i),o.status="rejected"}})),o={resolve:t,reject:e,promise:r,status:"pending"};return o}var Ie=()=>{};var Pn=class{constructor(e){this._fps=e}formatSubUnitForGrid(e){let r=e%1,o=1/this._fps;return Math.round(r/o)+"f"}formatFullUnitForGrid(e){let r=e,o="";r>=Te&&(o+=Math.floor(r/Te)+"h",r%=Te),r>=ne&&(o+=Math.floor(r/ne)+"m",r%=ne),r>=oe&&(o+=Math.floor(r/oe)+"s",r%=oe);let n=1/this._fps;return r>=n&&(o+=Math.floor(r/n)+"f",r%=n),0===o.length?"0s":o}formatForPlayhead(e){let r=e,o="";if(r>=Te){let a=Math.floor(r/Te);o+=re(a.toString(),2,"0")+"h",r%=Te}if(r>=ne){let a=Math.floor(r/ne);o+=re(a.toString(),2,"0")+"m",r%=ne}else o.length>0&&(o+="00m");if(r>=oe){let a=Math.floor(r/oe);o+=re(a.toString(),2,"0")+"s",r%=oe}else o+="00s";let n=1/this._fps;if(r>=n){let a=Math.round(r/n);o+=re(a.toString(),2,"0")+"f",r%=n}else r/n>.98?(o+=re(1..toString(),2,"0")+"f",r%=n):o+="00f";return 0===o.length?"00s00f":o}formatBasic(e){return e.toFixed(2)+"s"}},oe=1,ne=60*oe,Te=60*ne,ft={};function lt(t,e){return t.length<=e?t:t.substr(0,e-3)+"..."}wt(ft,{boolean:()=>Xt,compound:()=>Me,number:()=>Yt,string:()=>Zt,stringLiteral:()=>hp});var we=t=>"string"==typeof t?`string("${lt(t,10)}")`:"number"==typeof t?`number(${lt(String(t),10)})`:null===t?"null":void 0===t?"undefined":"boolean"==typeof t?String(t):Array.isArray(t)?"array":"object"==typeof t?"object":"unknown",ae=Symbol("TheatrePropType_Basic");function _n(t){return"object"==typeof t&&!!t&&"TheatrePropType"===t[ae]}function cp(t){if("number"==typeof t)return Yt(t);if("boolean"==typeof t)return Xt(t);if("string"==typeof t)return Zt(t);if("object"==typeof t&&t){if(_n(t))return t;if(Ve(t))return Me(t);throw new w(`This value is not a valid prop type: ${we(t)}`)}throw new w(`This value is not a valid prop type: ${we(t)}`)}function Sn(t){let e={};for(let r of Object.keys(t)){let o=t[r];_n(o)?e[r]=o:e[r]=cp(o)}return e}var Me=(t,e)=>({type:"compound",props:Sn(t),valueType:null,[ae]:"TheatrePropType",label:null==e?void 0:e.label}),Yt=(t,e)=>{var r;return x(g({type:"number",valueType:0,default:t,[ae]:"TheatrePropType"},e||{}),{label:null==e?void 0:e.label,nudgeFn:null!=(r=null==e?void 0:e.nudgeFn)?r:mp,nudgeMultiplier:"number"==typeof(null==e?void 0:e.nudgeMultiplier)?e.nudgeMultiplier:1})},Xt=(t,e)=>({type:"boolean",default:t,valueType:null,[ae]:"TheatrePropType",label:null==e?void 0:e.label}),Zt=(t,e)=>({type:"string",default:t,valueType:null,[ae]:"TheatrePropType",label:null==e?void 0:e.label});function hp(t,e,r){var o;return{type:"stringLiteral",default:t,options:g({},e),[ae]:"TheatrePropType",valueType:null,as:null!=(o=null==r?void 0:r.as)?o:"menu",label:null==r?void 0:r.label}}var mp=({config:t,deltaX:e,deltaFraction:r,magnitude:o})=>{let{range:n}=t;return n?r*(n[1]-n[0])*o*t.nudgeMultiplier:e*o*t.nudgeMultiplier};function ct(t,e){return(t=>t.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/," / "))(t)}Re(Qt()),new WeakMap;var Tn=t=>new Promise((e=>setTimeout(e,t)));function D(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map((function(i){return"'"+i+"'"})).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ie(t){return!!t&&!!t[P]}function se(t){return!!t&&(function(e){if(!e||"object"!=typeof e)return!1;var r=Object.getPrototypeOf(e);if(null===r)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||"function"==typeof o&&Function.toString.call(o)===Tp}(t)||Array.isArray(t)||!!t[$n]||!!t.constructor[$n]||tr(t)||rr(t))}function Ee(t,e,r){void 0===r&&(r=!1),0===De(t)?(r?Object.keys:hr)(t).forEach((function(o){r&&"symbol"==typeof o||e(o,t[o],t)})):t.forEach((function(o,n){return e(n,o,t)}))}function De(t){var e=t[P];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:tr(t)?2:rr(t)?3:0}function er(t,e){return 2===De(t)?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function Dn(t,e,r){var o=De(t);2===o?t.set(e,r):3===o?(t.delete(e),t.add(r)):t[e]=r}function tr(t){return Sp&&t instanceof Map}function rr(t){return Ip&&t instanceof Set}function pe(t){return t.o||t.t}function or(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=wp(t);delete e[P];for(var r=hr(e),o=0;o<r.length;o++){var n=r[o],a=e[n];!1===a.writable&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[n]})}return Object.create(Object.getPrototypeOf(t),e)}function nr(t,e){return void 0===e&&(e=!1),ar(t)||ie(t)||!se(t)||(De(t)>1&&(t.set=t.add=t.clear=t.delete=xp),Object.freeze(t),e&&Ee(t,(function(r,o){return nr(o,!0)}),!0)),t}function xp(){D(2)}function ar(t){return null==t||"object"!=typeof t||Object.isFrozen(t)}function F(t){var e=Dp[t];return e||D(18,t),e}function An(){return $e}function ir(t,e){e&&(F("Patches"),t.u=[],t.s=[],t.v=e)}function yt(t){sr(t),t.p.forEach(Pp),t.p=null}function sr(t){t===$e&&($e=t.l)}function On(t){return $e={p:[],l:$e,h:t,m:!0,_:0}}function Pp(t){var e=t[P];0===e.i||1===e.i?e.j():e.O=!0}function pr(t,e){e._=e.p.length;var r=e.p[0],o=void 0!==t&&t!==r;return e.h.g||F("ES5").S(e,t,o),o?(r[P].P&&(yt(e),D(4)),se(t)&&(t=gt(e,t),e.l||vt(e,t)),e.u&&F("Patches").M(r[P],t,e.u,e.s)):t=gt(e,r,[]),yt(e),e.u&&e.v(e.u,e.s),t!==En?t:void 0}function gt(t,e,r){if(ar(e))return e;var o=e[P];if(!o)return Ee(e,(function(a,i){return kn(t,o,e,a,i,r)}),!0),e;if(o.A!==t)return e;if(!o.P)return vt(t,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=4===o.i||5===o.i?o.o=or(o.k):o.o;Ee(3===o.i?new Set(n):n,(function(a,i){return kn(t,o,n,a,i,r)})),vt(t,n,!1),r&&t.u&&F("Patches").R(o,r,t.u,t.s)}return o.o}function kn(t,e,r,o,n,a){if(ie(n)){var i=gt(t,n,a&&e&&3!==e.i&&!er(e.D,o)?a.concat(o):void 0);if(Dn(r,o,i),!ie(i))return;t.m=!1}if(se(n)&&!ar(n)){if(!t.h.F&&t._<1)return;gt(t,n),e&&e.A.l||vt(t,n)}}function vt(t,e,r){void 0===r&&(r=!1),t.h.F&&t.m&&nr(e,r)}function ur(t,e){var r=t[P];return(r?pe(r):t)[e]}function Cn(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var o=Object.getOwnPropertyDescriptor(r,e);if(o)return o;r=Object.getPrototypeOf(r)}}function lr(t){t.P||(t.P=!0,t.l&&lr(t.l))}function fr(t){t.o||(t.o=or(t.t))}function cr(t,e,r){var o=tr(e)?F("MapSet").N(e,r):rr(e)?F("MapSet").T(e,r):t.g?function(n,a){var i=Array.isArray(n),s={i:i?1:0,A:a?a.A:An(),P:!1,I:!1,D:{},l:a,t:n,k:null,o:null,j:null,C:!1},u=s,p=bt;i&&(u=[s],p=jt);var f=Proxy.revocable(u,p),h=f.revoke,b=f.proxy;return s.k=b,s.j=h,b}(e,r):F("ES5").J(e,r);return(r?r.A:An()).p.push(o),o}function _p(t){return ie(t)||D(22,t),function e(r){if(!se(r))return r;var o,n=r[P],a=De(r);if(n){if(!n.P&&(n.i<4||!F("ES5").K(n)))return n.t;n.I=!0,o=Vn(r,a),n.I=!1}else o=Vn(r,a);return Ee(o,(function(i,s){n&&function bp(t,e){return 2===De(t)?t.get(e):t[e]}(n.t,i)===s||Dn(o,i,e(s))})),3===a?new Set(o):o}(t)}function Vn(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return or(t)}var Nn,$e,dr="undefined"!=typeof Symbol&&"symbol"==typeof Symbol("x"),Sp="undefined"!=typeof Map,Ip="undefined"!=typeof Set,Mn="undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,En=dr?Symbol.for("immer-nothing"):((Nn={})["immer-nothing"]=!0,Nn),$n=dr?Symbol.for("immer-draftable"):"__$immer_draftable",P=dr?Symbol.for("immer-state"):"__$immer_state",Tp=("undefined"!=typeof Symbol&&Symbol.iterator,""+Object.prototype.constructor),hr="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,wp=Object.getOwnPropertyDescriptors||function(t){var e={};return hr(t).forEach((function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)})),e},Dp={},bt={get:function(t,e){if(e===P)return t;var r=pe(t);if(!er(r,e))return function(n,a,i){var s,u=Cn(a,i);return u?"value"in u?u.value:null===(s=u.get)||void 0===s?void 0:s.call(n.k):void 0}(t,r,e);var o=r[e];return t.I||!se(o)?o:o===ur(t.t,e)?(fr(t),t.o[e]=cr(t.A.h,o,t)):o},has:function(t,e){return e in pe(t)},ownKeys:function(t){return Reflect.ownKeys(pe(t))},set:function(t,e,r){var o=Cn(pe(t),e);if(null==o?void 0:o.set)return o.set.call(t.k,r),!0;if(!t.P){var n=ur(pe(t),e),a=null==n?void 0:n[P];if(a&&a.t===r)return t.o[e]=r,t.D[e]=!1,!0;if(function jp(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}(r,n)&&(void 0!==r||er(t.t,e)))return!0;fr(t),lr(t)}return t.o[e]===r&&"number"!=typeof r&&(void 0!==r||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return void 0!==ur(t.t,e)||e in t.t?(t.D[e]=!1,fr(t),lr(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=pe(t),o=Reflect.getOwnPropertyDescriptor(r,e);return o&&{writable:!0,configurable:1!==t.i||"length"!==e,enumerable:o.enumerable,value:r[e]}},defineProperty:function(){D(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){D(12)}},jt={};Ee(bt,(function(t,e){jt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}})),jt.deleteProperty=function(t,e){return bt.deleteProperty.call(this,t[0],e)},jt.set=function(t,e,r){return bt.set.call(this,t[0],e,r,t[0])};var I=new(function(){function t(r){var o=this;this.g=Mn,this.F=!0,this.produce=function(n,a,i){if("function"==typeof n&&"function"!=typeof a){var s=a;a=n;var u=o;return function(c){var Oe=this;void 0===c&&(c=s);for(var J=arguments.length,R=Array(J>1?J-1:0),k=1;k<J;k++)R[k-1]=arguments[k];return u.produce(c,(function(A){var q;return(q=a).call.apply(q,[Oe,A].concat(R))}))}}var p;if("function"!=typeof a&&D(6),void 0!==i&&"function"!=typeof i&&D(7),se(n)){var f=On(o),h=cr(o,n,void 0),b=!0;try{p=a(h),b=!1}finally{b?yt(f):sr(f)}return"undefined"!=typeof Promise&&p instanceof Promise?p.then((function(c){return ir(f,i),pr(c,f)}),(function(c){throw yt(f),c})):(ir(f,i),pr(p,f))}if(!n||"object"!=typeof n)return(p=a(n))===En?void 0:(void 0===p&&(p=n),o.F&&nr(p,!0),p);D(21,n)},this.produceWithPatches=function(n,a){return"function"==typeof n?function(u){for(var p=arguments.length,f=Array(p>1?p-1:0),h=1;h<p;h++)f[h-1]=arguments[h];return o.produceWithPatches(u,(function(b){return n.apply(void 0,[b].concat(f))}))}:[o.produce(n,a,(function(u,p){i=u,s=p})),i,s];var i,s},"boolean"==typeof(null==r?void 0:r.useProxies)&&this.setUseProxies(r.useProxies),"boolean"==typeof(null==r?void 0:r.autoFreeze)&&this.setAutoFreeze(r.autoFreeze)}var e=t.prototype;return e.createDraft=function(r){se(r)||D(8),ie(r)&&(r=_p(r));var o=On(this),n=cr(this,r,void 0);return n[P].C=!0,sr(o),n},e.finishDraft=function(r,o){var a=(r&&r[P]).A;return ir(a,o),pr(void 0,a)},e.setAutoFreeze=function(r){this.F=r},e.setUseProxies=function(r){r&&!Mn&&D(20),this.g=r},e.applyPatches=function(r,o){var n;for(n=o.length-1;n>=0;n--){var a=o[n];if(0===a.path.length&&"replace"===a.op){r=a.value;break}}var i=F("Patches").$;return ie(r)?i(r,o):this.produce(r,(function(s){return i(s,o.slice(n+1))}))},t}()),Ae=(I.produce,I.produceWithPatches.bind(I),I.setAutoFreeze.bind(I),I.setUseProxies.bind(I),I.applyPatches.bind(I),I.createDraft.bind(I),I.finishDraft.bind(I),{currentProjectStateDefinitionVersion:"0.4.0"});async function mr(t,e,r){await Tn(0),t.transaction((({drafts:o})=>{var f;let n=e.address.projectId;o.ephemeral.coreByProject[n]={lastExportedObject:null,loadingState:{type:"loading"}},o.ahistoric.coreByProject[n]={ahistoricStuff:""};let p=null==(f=function wn(t){return ie(t)||D(23,t),t[P].t}(o.historic))?void 0:f.coreByProject[e.address.projectId];p?r&&-1==p.revisionHistory.indexOf(r.revisionHistory[0])?function u(h){o.ephemeral.coreByProject[n].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:h}}(r):function s(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"}}():r?function i(h){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]=h}(r):function a(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]={sheetsById:{},definitionVersion:Ae.currentProjectStateDefinitionVersion,revisionHistory:[]}}()}))}Re(Qt());function Bn(t,e={}){let r=((t,e)=>{var r={};for(var o in t)It.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(null!=t&&Be)for(var o of Be(t))e.indexOf(o)<0&&vr.call(t,o)&&(r[o]=t[o]);return r})(e,[]),o=xe.get(t);return o?o.publicApi:(e.state&&Cp(t,e.state),new class{get type(){return"Theatre_Project_PublicAPI"}constructor(e,r={}){H(this,new class{constructor(e,r={},o){var a;this.config=r,this.publicApi=o,l(this,"pointers"),l(this,"_pointerProxies"),l(this,"address"),l(this,"_readyDeferred"),l(this,"_sheetTemplates",new y({})),l(this,"sheetTemplatesP",this._sheetTemplates.pointer),l(this,"_studio"),l(this,"type","Theatre_Project"),this.address={projectId:e};let n=new y({ahistoric:{ahistoricStuff:""},historic:null!=(a=r.state)?a:{sheetsById:{},definitionVersion:Ae.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._pointerProxies={historic:new ee(n.pointer.historic),ahistoric:new ee(n.pointer.ahistoric),ephemeral:new ee(n.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},xe.add(e,this),this._readyDeferred=B(),r.state?setTimeout((()=>{this._studio||this._readyDeferred.resolve(void 0)}),0):setTimeout((()=>{if(!this._studio)throw new Error(`Argument config.state in Theatre.getProject("${e}", config) is empty. This is fine while you are using @theatre/core along with @theatre/sutdio. But since @theatre/studio is not loaded, the state of project "${e}" will be empty.\n\nTo fix this, you need to add @theatre/studio into the bundle and export the projet's state. Learn how to do that at https://docs.theatrejs.com/in-depth/#exporting`)}),1e3)}attachToStudio(e){if(this._studio){if(this._studio!==e)throw new Error(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);console.warn(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`)}else this._studio=e,e.initialized.then((async()=>{await mr(e,this,this.config.state),this._pointerProxies.historic.setPointer(e.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(e.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(e.atomP.ephemeral.coreByProject[this.address.projectId]),this._readyDeferred.resolve(void 0)}))}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyDeferred.promise}isReady(){return"resolved"===this._readyDeferred.status}getOrCreateSheet(e,r="default"){let o=this._sheetTemplates.getState()[e];return o||(o=new class{constructor(e,r){this.project=e,l(this,"type","Theatre_SheetTemplate"),l(this,"address"),l(this,"_instances",new y({})),l(this,"instancesP",this._instances.pointer),l(this,"_objectTemplates",new y({})),l(this,"objectTemplatesP",this._objectTemplates.pointer),this.address=x(g({},e.address),{sheetId:r})}getInstance(e){let r=this._instances.getState()[e];return r||(r=new class{constructor(e,r){this.template=e,this.instanceId=r,l(this,"_objects",new y({})),l(this,"_sequence"),l(this,"address"),l(this,"publicApi"),l(this,"project"),l(this,"objectsP",this._objects.pointer),l(this,"type","Theatre_Sheet"),this.project=e.project,this.address=x(g({},e.address),{sheetInstanceId:this.instanceId}),this.publicApi=new class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(e){H(this,e)}object(e,r){let o=m(this),n=ct(e),a=o.getObject(n);if(a)return a.publicApi;{let s=Me(r);return o.createObject(n,null,s).publicApi}}get sequence(){return m(this).getSequence().publicApi}get project(){return m(this).project.publicApi}get address(){return g({},m(this).address)}}(this)}createObject(e,r,o){let a=this.template.getObjectTemplate(e,r,o).createInstance(this,r,o);return this._objects.setIn([e],a),a}getObject(e){return this._objects.getState()[e]}getSequence(){if(!this._sequence){let e=S(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length).map((o=>"number"==typeof o?o:10)),r=S(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit).map((o=>"number"==typeof o?o:30));this._sequence=new class{constructor(e,r,o,n,a){this._project=e,this._sheet=r,this._lengthD=o,this._subUnitsPerUnitD=n,l(this,"address"),l(this,"publicApi"),l(this,"_playbackControllerBox"),l(this,"_statePointerDerivation"),l(this,"_positionD"),l(this,"_positionFormatterD"),l(this,"_playableRangeD"),l(this,"closestGridPosition",(e=>{let o=1/this.subUnitsPerUnit;return parseFloat((Math.round(e/o)*o).toFixed(3))})),this.address=x(g({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(e){H(this,e)}play(e){if(m(this)._project.isReady())return m(this).play(e);{let r=B();return r.resolve(!0),r.promise}}pause(){m(this).pause()}get position(){return m(this).position}set position(e){m(this).position=e}async attachAudio(e){let{audioContext:r,destinationNode:o,decodedBuffer:n}=await async function lp(t){function e(){if(t.audioContext)return Promise.resolve(t.audioContext);let u=new AudioContext;return"running"===u.state?Promise.resolve(u):new Promise((p=>{let f=()=>{u.resume()},h=["mousedown","keydown","touchstart"],b={capture:!0,passive:!1};h.forEach((c=>{window.addEventListener(c,f,b)})),u.addEventListener("statechange",(()=>{"running"===u.state&&(h.forEach((c=>{window.removeEventListener(c,f,b)})),p(u))}))}))}async function r(){if(t.source instanceof AudioBuffer)return t.source;let p,f,b,u=B();if("string"!=typeof t.source)throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");try{p=await fetch(t.source)}catch(c){throw console.error(c),new Error(`Could not fetch '${t.source}'. Network error logged above.`)}try{f=await p.arrayBuffer()}catch(c){throw console.error(c),new Error(`Could not read '${t.source}' as an arrayBuffer.`)}(await o).decodeAudioData(f,u.resolve,u.reject);try{b=await u.promise}catch(c){throw console.error(c),new Error(`Could not decode ${t.source} as an audio file.`)}return b}let o=e(),n=r(),[a,i]=await Promise.all([o,n]);return{destinationNode:t.destinationNode||a.destination,audioContext:a,decodedBuffer:i}}(e),a=new class{constructor(e,r,o,n){this._ticker=e,this._decodedBuffer=r,this._audioContext=o,this._nodeDestination=n,l(this,"_mainGain"),l(this,"_state",new y({position:0})),l(this,"statePointer"),l(this,"_stopPlayCallback",Ie),l(this,"playing",!1),this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=Ie}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.reduceState(["position"],(()=>e))}getCurrentPosition(){return this._state.getState().position}play(e,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=this.getCurrentPosition(),s=r[1]-r[0];if("normal"!==n)throw new w(`Audio-controlled sequences can only be played in the "normal" direction. '${n}' given.`);(i<r[0]||i>r[1]||i===r[1])&&this._updatePositionInState(r[0]),i=this.getCurrentPosition();let u=B(),p=this._audioContext.createBufferSource();p.buffer=this._decodedBuffer,p.connect(this._mainGain),p.playbackRate.value=o,e>1e3&&(console.warn("Audio-controlled sequences cannot have an iterationCount larger than 1000. It has been clamped to 1000."),e=1e3),e>1&&(p.loop=!0,p.loopStart=r[0],p.loopEnd=r[1]);let f=a.time,h=i-r[0],b=s*e;p.start(0,i,b-h);let c=R=>{let A=Math.max(R-f,0)/1e3,q=Math.min(A*o+h,b);if(q!==b){let qn=q/s%1*s;this._updatePositionInState(qn+r[0]),J()}else this._updatePositionInState(r[1]),this.playing=!1,Oe(),u.resolve(!0)},Oe=()=>{p.stop(),p.disconnect()};this._stopPlayCallback=()=>{Oe(),a.offThisOrNextTick(c),a.offNextTick(c),this.playing&&u.resolve(!1)};let J=()=>a.onNextTick(c);return a.onThisOrNextTick(c),u.promise}}($,n,r,o);return m(this).replacePlaybackController(a),{audioContext:r,destinationNode:o,decodedBuffer:n}}}(this),this._playbackControllerBox=new E(null!=a?a:new class{constructor(e){this._ticker=e,l(this,"playing",!1),l(this,"_stopPlayCallback",Ie),l(this,"_state",new y({position:0})),l(this,"statePointer"),this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=Ie}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.reduceState(["position"],(()=>e))}getCurrentPosition(){return this._state.getState().position}play(e,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=r[1]-r[0];{let c=this.getCurrentPosition();c<r[0]||c>r[1]?"normal"===n||"alternate"===n?this._updatePositionInState(r[0]):("reverse"===n||"alternateReverse"===n)&&this._updatePositionInState(r[1]):"normal"===n||"alternate"===n?c===r[1]&&this._updatePositionInState(r[0]):c===r[0]&&this._updatePositionInState(r[1])}let s=B(),u=a.time,p=i*e,f=this.getCurrentPosition()-r[0];("reverse"===n||"alternateReverse"===n)&&(f=r[1]-this.getCurrentPosition());let h=c=>{let J=Math.max(c-u,0)/1e3,R=Math.min(J*o+f,p);if(R!==p){let k=Math.floor(R/i),A=R/i%1*i;if("normal"!==n)if("reverse"===n)A=i-A;else{let q=k%2==0;"alternate"===n?q||(A=i-A):q&&(A=i-A)}this._updatePositionInState(A+r[0]),b()}else{if("normal"===n)this._updatePositionInState(r[1]);else if("reverse"===n)this._updatePositionInState(r[0]);else{let k=(e-1)%2==0;"alternate"===n?k?this._updatePositionInState(r[1]):this._updatePositionInState(r[0]):k?this._updatePositionInState(r[0]):this._updatePositionInState(r[1])}this.playing=!1,s.resolve(!0)}};this._stopPlayCallback=()=>{a.offThisOrNextTick(h),a.offNextTick(h),this.playing&&s.resolve(!1)};let b=()=>a.onNextTick(h);return a.onThisOrNextTick(h),s.promise}}($)),this._statePointerDerivation=this._playbackControllerBox.derivation.map((i=>i.statePointer)),this._positionD=this._statePointerDerivation.flatMap((i=>S(i.position))),this._positionFormatterD=this._subUnitsPerUnitD.map((i=>new Pn(i)))}get positionFormatter(){return this._positionFormatterD.getValue()}get derivationToStatePointer(){return this._statePointerDerivation}get length(){return this._lengthD.getValue()}get positionDerivation(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(e){let r=e;this.pause(),r>this.length&&(r=this.length);let o=this.length;this._playbackControllerBox.get().gotoPosition(r>o?o:r)}getDurationCold(){return this._lengthD.getValue()}get playing(){return this._playbackControllerBox.get().playing}_makeRangeFromSequenceTemplate(){return d((()=>[0,v(this._lengthD)]))}async play(e){let r=this.length,o=e&&e.range?e.range:[0,r],n=e&&"number"==typeof e.iterationCount?e.iterationCount:1,a=e&&void 0!==e.rate?e.rate:1,i=e&&e.direction?e.direction:"normal";return await this._play(n,[o[0],o[1]],a,i)}_play(e,r,o,n){return this._playbackControllerBox.get().play(e,r,o,n)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(e){this.pause();let r=this._playbackControllerBox.get();this._playbackControllerBox.set(e);let o=r.getCurrentPosition();r.destroy(),e.gotoPosition(o)}}(this.template.project,this,e,r)}return this._sequence}}(this,e),this._instances.setIn([e],r)),r}getObjectTemplate(e,r,o){let n=this._objectTemplates.getState()[e];return n||(n=new class{constructor(e,r,o,n){this.sheetTemplate=e,l(this,"address"),l(this,"type","Theatre_SheetObjectTemplate"),l(this,"_config"),l(this,"_cache",new G),l(this,"project"),this.address=x(g({},e.address),{objectKey:r}),this._config=new y(n),this.project=e.project}get config(){return this._config.getState()}createInstance(e,r,o){return this._config.setState(o),new class{constructor(e,r,o){this.sheet=e,this.template=r,this.nativeObject=o,l(this,"$$isIdentityDerivationProvider",!0),l(this,"address"),l(this,"publicApi"),l(this,"_initialValue",new y({})),l(this,"_cache",new G),this.address=x(g({},r.address),{sheetInstanceId:e.address.sheetInstanceId}),this.publicApi=new class{constructor(e){l(this,"_cache",new G),H(this,e)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return m(this).propsP}get sheet(){return m(this).sheet.publicApi}get project(){return m(this).sheet.project.publicApi}get address(){return g({},m(this).address)}_valuesDerivation(){return this._cache.get("onValuesChangeDerivation",(()=>{let e=m(this);return d((()=>v(e.getValues().getValue())))}))}onValuesChange(e){return this._valuesDerivation().tapImmediate($,e)}get value(){return this._valuesDerivation().getValue()}set initialValue(e){m(this).setInitialValue(e)}}(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",(()=>d((()=>{let p,n=_e(v(this.template.getDefaultValues()),v(this._initialValue.pointer),d.memo("withInitialCache",(()=>new WeakMap),[])),u=_e(n,v(this.template.getStaticValues()),d.memo("withStatics",(()=>new WeakMap),[]));{let h=d.memo("seq",(()=>this.getSequencedValues()),[]),b=d.memo("withSeqsCache",(()=>new WeakMap),[]);p=v(v(h)),u=_e(u,p,b)}return((t,e)=>{let r=d.memo(t,(()=>new y(e)),[]);return r.setState(e),r})("finalAtom",u).pointer}))))}getValueByPointer(e){let r=v(this.getValues()),{path:o}=Ne(e);return v(et(r,o))}getIdentityDerivation(e){return d((()=>{let r=v(this.getValues());return v(et(r,e))}))}getSequencedValues(){return d((()=>{let e=d.memo("tracksToProcess",(()=>this.template.getArrayOfValidSequenceTracks()),[]),r=v(e),o=new y({});return d.effect("processTracks",(()=>{let n=[];for(let{trackId:a,pathToProp:i}of r){let s=this._trackIdToDerivation(a),u=()=>{o.setIn(i,s.getValue())},p=s.changesWithoutValues().tap(u);u(),n.push(p)}return()=>{for(let a of n)a()}}),r),o.pointer}))}_trackIdToDerivation(e){return Wt(this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[e],this.sheet.getSequence().positionDerivation)}get propsP(){return this._cache.get("propsP",(()=>Z({root:this,path:[]})))}validateValue(e,r){}setInitialValue(e){this.validateValue(this.propsP,e),this._initialValue.setState(e)}}(e,this,r)}overrideConfig(e){this._config.setState(e)}getDefaultValues(){return this._cache.get("getDefaultValues()",(()=>d((()=>function qt(t){return zt(t)}(v(this._config.pointer))))))}getStaticValues(){return this._cache.get("getDerivationOfStatics",(()=>d((()=>{let e=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId];return v(e.staticOverrides.byObject[this.address.objectKey])||{}}))))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",(()=>d((()=>{let e=v(this.getDefaultValues()),r=this.project.pointers.historic.sheetsById[this.address.sheetId],o=v(r.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath),n=[];if(!o)return Bt;for(let[a,i]of Object.entries(o)){let s;try{s=JSON.parse(a)}catch(p){Pe.warn(`property ${JSON.stringify(a)} cannot be parsed. Skipping.`);continue}"number"==typeof me(e,s)&&n.push({pathToProp:s,trackId:i})}return 0===n.length?Bt:n}))))}getMapOfValidSequenceTracks_forStudio(){return new T({})}getDefaultsAtPointer(e){let{path:r}=Ne(e);return function Ft(t,e){return 0===e.length?t:me(t,e)}(this.getDefaultValues().getValue(),r)}}(this,e,r,o),this._objectTemplates.setIn([e],n)),n}}(this,e),this._sheetTemplates.setIn([e],o)),o.getInstance(r)}}(e,r,this))}get ready(){return m(this).ready}get isReady(){return m(this).isReady()}get address(){return g({},m(this).address)}sheet(e,r="default"){let o=ct(e);return m(this).getOrCreateSheet(o,r).publicApi}}(t,r))}var Cp=(t,e)=>{((t,e)=>{if(Array.isArray(e)||null==e||e.definitionVersion!==Ae.currentProjectStateDefinitionVersion)throw new w(`Error validating conf.state in Theatre.getProject(${JSON.stringify(t)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`)})(t,e)};function Fn(t,e){if(Q(t))return S(t).tapImmediate($,e);if(C(t))return t.tapImmediate($,e);throw new Error("Called onChange(p) where p is neither a pointer nor a derivation.")}var _t="__TheatreJS_CoreBundle";!function Vp(){if("undefined"==typeof window)return;let t=window[_t];if(void 0!==t)throw"object"==typeof t&&t&&"string"==typeof t.version?new Error("It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:\n1. You might have two separate versions of theatre in node_modules.\n2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.\n\nNote that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module."):new Error(`The variable window.${_t} seems to be already set by a module other than @theatre/core.`);let e=new class{constructor(){l(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return process.env.version}getBitsForStudio(e,r){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=e,r({projectsP:xe.atom.pointer.projects,privateAPI:m,coreExports:yr})}};window[_t]=e;let r=window.__TheatreJS_StudioBundle;r&&null!==r&&"Theatre_StudioBundle"===r.type&&r.registerCoreBundle(e)}(),window.Theatre={core:gr,get studio(){alert("Theatre.studio is only available in the core-and-studio.js bundle. You're using the core-only.min.js bundle.")}}})(),Hydra.ready((()=>{TweenManager.Transforms=["scale","scaleX","scaleY","x","y","z","rotation","rotationX","rotationY","rotationZ","skewX","skewY","perspective"],TweenManager.CubicEases=[{name:"easeOutCubic",curve:"cubic-bezier(0.215, 0.610, 0.355, 1.000)"},{name:"easeOutQuad",curve:"cubic-bezier(0.250, 0.460, 0.450, 0.940)"},{name:"easeOutQuart",curve:"cubic-bezier(0.165, 0.840, 0.440, 1.000)"},{name:"easeOutQuint",curve:"cubic-bezier(0.230, 1.000, 0.320, 1.000)"},{name:"easeOutSine",curve:"cubic-bezier(0.390, 0.575, 0.565, 1.000)"},{name:"easeOutExpo",curve:"cubic-bezier(0.190, 1.000, 0.220, 1.000)"},{name:"easeOutCirc",curve:"cubic-bezier(0.075, 0.820, 0.165, 1.000)"},{name:"easeOutBack",curve:"cubic-bezier(0.175, 0.885, 0.320, 1.275)"},{name:"easeInCubic",curve:"cubic-bezier(0.550, 0.055, 0.675, 0.190)"},{name:"easeInQuad",curve:"cubic-bezier(0.550, 0.085, 0.680, 0.530)"},{name:"easeInQuart",curve:"cubic-bezier(0.895, 0.030, 0.685, 0.220)"},{name:"easeInQuint",curve:"cubic-bezier(0.755, 0.050, 0.855, 0.060)"},{name:"easeInSine",curve:"cubic-bezier(0.470, 0.000, 0.745, 0.715)"},{name:"easeInCirc",curve:"cubic-bezier(0.600, 0.040, 0.980, 0.335)"},{name:"easeInBack",curve:"cubic-bezier(0.600, -0.280, 0.735, 0.045)"},{name:"easeInOutCubic",curve:"cubic-bezier(0.645, 0.045, 0.355, 1.000)"},{name:"easeInOutQuad",curve:"cubic-bezier(0.455, 0.030, 0.515, 0.955)"},{name:"easeInOutQuart",curve:"cubic-bezier(0.770, 0.000, 0.175, 1.000)"},{name:"easeInOutQuint",curve:"cubic-bezier(0.860, 0.000, 0.070, 1.000)"},{name:"easeInOutSine",curve:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"},{name:"easeInOutExpo",curve:"cubic-bezier(1.000, 0.000, 0.000, 1.000)"},{name:"easeInOutCirc",curve:"cubic-bezier(0.785, 0.135, 0.150, 0.860)"},{name:"easeInOutBack",curve:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},{name:"easeInOut",curve:"cubic-bezier(.42,0,.58,1)"},{name:"linear",curve:"linear"}],TweenManager.useCSSTrans=function(props,ease,object){return!(props.math||"string"==typeof ease&&ease.includes(["Elastic","Bounce"])||object.multiTween||TweenManager._inspectEase(ease).path||!Device.tween.transition)},TweenManager._detectTween=function(object,props,time,ease,delay,callback){return TweenManager.useCSSTrans(props,ease,object)?new CSSTransition(object,props,time,ease,delay,callback):new FrameTween(object,props,time,ease,delay,callback)},TweenManager._parseTransform=function(props){var unitRequiresCSSTween=["%","vw","vh","em"],transforms="",translate="";if(props.perspective>0&&(transforms+="perspective("+props.perspective+"px)"),void 0!==props.x||void 0!==props.y||void 0!==props.z){var x=props.x||0,y=props.y||0,z=props.z||0;translate+=x+("string"==typeof props.x&&props.x.includes(unitRequiresCSSTween)?"":"px")+", ",translate+=y+("string"==typeof props.y&&props.y.includes(unitRequiresCSSTween)?"":"px"),Device.tween.css3d?transforms+="translate3d("+(translate+=", "+z+"px")+")":transforms+="translate("+translate+")"}return void 0!==props.scale?transforms+="scale("+props.scale+")":(void 0!==props.scaleX&&(transforms+="scaleX("+props.scaleX+")"),void 0!==props.scaleY&&(transforms+="scaleY("+props.scaleY+")")),void 0!==props.rotation&&(transforms+="rotate("+props.rotation+"deg)"),void 0!==props.rotationX&&(transforms+="rotateX("+props.rotationX+"deg)"),void 0!==props.rotationY&&(transforms+="rotateY("+props.rotationY+"deg)"),void 0!==props.rotationZ&&(transforms+="rotateZ("+props.rotationZ+"deg)"),void 0!==props.skewX&&(transforms+="skewX("+props.skewX+"deg)"),void 0!==props.skewY&&(transforms+="skewY("+props.skewY+"deg)"),transforms},TweenManager._clearCSSTween=function(obj){obj&&!obj._cssTween&&obj.div._transition&&!obj.persistTween&&(obj.div.style[HydraCSS.styles.vendorTransition]="",obj.div._transition=!1,obj._cssTween=null)},TweenManager._isTransform=function(key){return TweenManager.Transforms.indexOf(key)>-1},TweenManager._getAllTransforms=function(object){for(var obj={},i=TweenManager.Transforms.length-1;i>-1;i--){var tf=TweenManager.Transforms[i],val=object[tf];0===val||"number"!=typeof val&&"string"!=typeof val||(obj[tf]=val)}return obj};const prefix=function(){let pre="",dom="";try{var styles=window.getComputedStyle(document.documentElement,"");return pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1],{unprefixed:"ie"==Device.system.browser&&!Device.detect("msie 9"),dom:dom,lowercase:pre,css:"-"+pre+"-",js:("ie"==Device.system.browser?pre[0]:pre[0].toUpperCase())+pre.substr(1)}}catch(e){return{unprefixed:!0,dom:"",lowercase:"",css:"",js:""}}}();HydraCSS.styles={},HydraCSS.styles.vendor=prefix.unprefixed?"":prefix.js,HydraCSS.styles.vendorTransition=HydraCSS.styles.vendor.length?HydraCSS.styles.vendor+"Transition":"transition",HydraCSS.styles.vendorTransform=HydraCSS.styles.vendor.length?HydraCSS.styles.vendor+"Transform":"transform",HydraCSS.vendor=prefix.css,HydraCSS.transformProperty=function(){switch(prefix.lowercase){case"moz":return"-moz-transform";case"webkit":return"-webkit-transform";case"o":return"-o-transform";case"ms":return"-ms-transform";default:return"transform"}}(),HydraCSS.tween={},HydraCSS.tween.complete=prefix.unprefixed?"transitionend":prefix.lowercase+"TransitionEnd"})),Class((function CSSTransition(_object,_props,_time,_ease,_delay,_callback){const _this=this;let _transformProps,_transitionProps;function killed(){return!_this||_this.kill||!_object||!_object.div}function clearCSSTween(){killed()||(_this.playing=!1,_object._cssTween=null,_object.willChange(null),_object=_props=null,Utils.nullObject(this))}this.playing=!0,function(){if("number"!=typeof _time)throw"CSSTween Requires object, props, time, ease";!function initProperties(){var transform=TweenManager._getAllTransforms(_object),properties=[];for(var key in _props)TweenManager._isTransform(key)?(transform.use=!0,transform[key]=_props[key],delete _props[key]):("number"==typeof _props[key]||key.includes(["-","color"]))&&properties.push(key);transform.use&&(properties.push(HydraCSS.transformProperty),delete transform.use);_transformProps=transform,_transitionProps=properties}(),async function initCSSTween(values){if(killed())return;_object._cssTween&&(_object._cssTween.kill=!0);_object._cssTween=_this,_object.div._transition=!0;var strings=function buildStrings(time,ease,delay){for(var props="",str="",len=_transitionProps.length,i=0;i<len;i++){var transitionProp=_transitionProps[i];props+=(props.length?", ":"")+transitionProp,str+=(str.length?", ":"")+transitionProp+" "+time+"ms "+TweenManager._getEase(ease)+" "+delay+"ms"}return{props:props,transition:str}}(_time,_ease,_delay);_object.willChange(strings.props);var time=values?values.time:_time,delay=values?values.delay:_delay,props=values?values.props:_props,transformProps=values?values.transform:_transformProps,singleFrame=1e3/Render.REFRESH_RATE;if(_this.time=_time,_this.delay=_delay,await Timer.delayedCall(3*singleFrame),killed())return;if(_object.div.style[HydraCSS.styles.vendorTransition]=strings.transition,_this.playing=!0,"safari"==Device.system.browser){if(Device.system.browserVersion<11&&await Timer.delayedCall(singleFrame),killed())return;_object.css(props),_object.transform(transformProps)}else _object.css(props),_object.transform(transformProps);Timer.create((function(){killed()||(clearCSSTween(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())}),time+delay)}()}(),this.stop=function(){this.playing&&(this.kill=!0,this.playing=!1,_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1,_object.willChange(null),_object._cssTween=null,Utils.nullObject(this))},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise}})),Class((function FrameTween(_object,_props,_time,_ease,_delay,_callback,_manual){var _endValues,_transformEnd,_transformStart,_startValues,_isTransform,_isCSS,_transformProps,_cssTween,_transformTween,_this=this;function copy(obj){let newObj={};for(let key in obj)"number"==typeof obj[key]&&(newObj[key]=obj[key]);return newObj}function clear(){_object._cssTweens&&_object._cssTweens.remove(_this),_this.playing=!1,_object._cssTween=null,_object=_props=null}function update(){if(!function killed(){return _this.kill||!_object||!_object.div||!_object.css}()){if(_isCSS&&_object.css(_props),_isTransform)if(_object.multiTween){for(var key in _transformProps)"number"==typeof _transformProps[key]&&(_object[key]=_transformProps[key]);_object.transform()}else _object.transform(_transformProps);undefined}}function tweenComplete(){_this.playing&&(clear(),_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve())}this.playing=!0,_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer((function(){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if("object"==typeof _ease&&(_ease="easeOutCubic"),_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"FrameTween Requires object, props, time, ease";!function initValues(){_props.math&&delete _props.math;Device.tween.transition&&_object.div&&_object.div._transition&&(_object.div.style[HydraCSS.styles.vendorTransition]="",_object.div._transition=!1);_this.time=_time,_this.delay=_delay,_endValues={},_transformEnd={},_transformStart={},_startValues={},_object.multiTween||(void 0===_props.x&&(_props.x=_object.x),void 0===_props.y&&(_props.y=_object.y),void 0===_props.z&&(_props.z=_object.z));for(var key in _props)if(key.includes(["damping","spring"]))_endValues[key]=_props[key],_transformEnd[key]=_props[key];else if(TweenManager._isTransform(key))_isTransform=!0,_transformStart[key]=_object[key]||("scale"==key?1:0),_transformEnd[key]=_props[key];else{_isCSS=!0;var v=_props[key];"string"==typeof v?_object.div.style[key]=v:"number"==typeof v&&(_startValues[key]=_object.css?Number(_object.css(key)):0,_endValues[key]=v)}}(),function startTween(){!_object._cssTween||_manual||_object.multiTween||(_object._cssTween.kill=!0);_this.time=_time,_this.delay=_delay,_object.multiTween&&(_object._cssTweens||(_object._cssTweens=[]),_object._cssTweens.push(_this));_object._cssTween=_this,_this.playing=!0,_props=copy(_startValues),_transformProps=copy(_transformStart),_isCSS&&(_cssTween=tween(_props,_endValues,_time,_ease,_delay,null,_manual).onUpdate(update).onComplete(tweenComplete));_isTransform&&(_transformTween=tween(_transformProps,_transformEnd,_time,_ease,_delay,null,_manual).onComplete(_isCSS?null:tweenComplete).onUpdate(_isCSS?null:update))}()}})),this.stop=function(){this.playing&&(_cssTween&&_cssTween.stop&&_cssTween.stop(),_transformTween&&_transformTween.stop&&_transformTween.stop(),clear())},this.interpolate=function(elapsed){_cssTween&&_cssTween.interpolate(elapsed),_transformTween&&_transformTween.interpolate(elapsed),update()},this.getValues=function(){return{start:_startValues,transformStart:_transformStart,end:_endValues,transformEnd:_transformEnd}},this.setEase=function(ease){_cssTween&&_cssTween.setEase(ease),_transformTween&&_transformTween.setEase(ease)},this.onUpdate=function(){return this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise||(_this.completePromise=Promise.create()),_this.completePromise}}));class DOMAttribute{constructor({name:name,value:value,belongsTo:belongsTo,bindingLookup:bindingLookup}){this.name=name,this.value=value,this.belongsTo=belongsTo,this.bindingLookup=bindingLookup}}class TemplateRoot{constructor(string,values){this.string=string,this.values=values}consolidate(){let template=this.string;const consolidatedValues={};for(const[marker,value]of Object.entries(this.values))if(value instanceof TemplateHTML){const[innerTemplate,innerValues]=value.consolidate();template=template.replace(marker,innerTemplate),Object.assign(consolidatedValues,innerValues)}else if(Array.isArray(value)){let childTemplate="";for(let k=0;k<value.length;k++){const[innerString,innerValue]=value[k].consolidate();childTemplate+=innerString,Object.assign(consolidatedValues,innerValue)}template=template.replace(marker,childTemplate)}else consolidatedValues[marker]=value;return[template,consolidatedValues]}modifyMarkers(template,config,dataMarkers,bindings){let count=0;return template.replace(/@([a-z]+)="\{\{(hydra-[0-9]+)\}\}"/g,(function(_,event,marker){const dataMarker="data-attach-event-"+count++;return dataMarkers.push(dataMarker),`${dataMarker}="${event}|${marker}"`})).replace(/\{\{hydra-[0-9]+\}\}/g,(function(marker){if(config[marker]&&config[marker].state)return bindings.push({lookup:marker.trim()}),marker;if(config[marker]["@style"]){const styles=config[marker]["@style"];if(!styles||"object"!=typeof styles)return void console.error("@style must contain an object");let styleString="";return Object.keys(styles).forEach((prop=>{const kebabProp=prop.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase();styleString+=`${kebabProp}: ${styles[prop]};\n`})),styleString}return config[marker]}))}}class TemplateHTML extends TemplateRoot{constructor(string,values){super(string,values)}inflate(root,cssElement){let[template,config]=this.consolidate(),dataMarkers=[],nestedComponents=[],bindings=new LinkedList,scrollTop=root.firstChild?.scrollTop;const t=this.modifyMarkers(template,config,dataMarkers,bindings);for(;root.firstChild;)root.removeChild(root.firstChild);root.flatBindings&&root.flatBindings.forEach((b=>b.destroy())),root.flatBindings=[];let fragment=document.createDocumentFragment(),newNode=DOMTemplate.parser.parseFromString(t,"text/html"),els=newNode.body.firstChild.querySelectorAll("*"),length=els.length;fragment.appendChild(newNode.body.firstChild),cssElement&&fragment.appendChild(cssElement);for(let index=length-1;index>-1;index--){let el=els[index];~el.tagName.indexOf("-")&&nestedComponents.push(el);let innerText=el.innerText,innerHTML=el.innerHTML,attributes=[...el.attributes].map((a=>({name:a.name,value:a.value})));if(~innerHTML.indexOf("<"))continue;let binding=bindings.start();for(;binding;){let bindingLookup=binding.lookup;if(attributes.forEach((attr=>{if(~attr?.value?.indexOf(bindingLookup)){let obj=config[bindingLookup];const attrObject=new DOMAttribute({name:attr.name,value:el.getAttribute(attr.name),belongsTo:el,bindingLookup:bindingLookup});root.flatBindings.push(obj.state.bind(obj.key,attrObject))}})),~innerText.indexOf(bindingLookup)){let obj=config[bindingLookup];~innerText.indexOf("@[")&&(el.innerText=innerText.replace(bindingLookup,obj.key)),root.flatBindings.push(obj.state.bind(obj.key,el))}binding=bindings.next()}}root.appendChild(fragment),dataMarkers.forEach((dataMarker=>{const element=root.querySelector(`[${dataMarker}]`),dataEvent=element.getAttribute(dataMarker),[event,marker]=dataEvent.split("|");element.removeAttribute(dataMarker),element.addEventListener(`${event}`,config[`{{${marker}}}`])})),defer((()=>{nestedComponents.forEach((template=>{const className=template.tagName.toLowerCase().replace(/(^\w|-\w)/g,(str=>str.replace(/-/,"").toUpperCase()));$(`#${template.id}`,className,!0).add(new window[className])}))})),scrollTop&&(root.firstChild.scrollTop=scrollTop)}}class TemplateCSS extends TemplateRoot{constructor(string,values){super(string,values)}inflate(root){let[template,config]=this.consolidate(),bindings=new LinkedList,element=document.createElement("style");return element.innerHTML=this.modifyMarkers(template,config,[],bindings),element}}function styleMap(object){return Object.keys(object).map((key=>object[key]?key:"")).join(" ")}!function(){let markerID=0;function makeMarker(){return`{{hydra-${markerID++}}}`}function html(strings,...values){const config={};let string="";for(let i=0;i<strings.length-1;i++){const marker=makeMarker();string+=strings[i],string+=marker,config[marker]=values[i]}return string+=strings[strings.length-1],new TemplateHTML(string,config)}function css(strings,...values){const config={};let string="";for(let i=0;i<strings.length-1;i++){const marker=makeMarker();string+=strings[i],string+=marker,config[marker]=values[i]}return string+=strings[strings.length-1],new TemplateCSS(string,config)}Class((function DOMTemplate(){Inherit(this,Element);const _this=this;if(this.data=[],Hydra.LOCAL&&window.UILSocket){let name=Utils.getConstructorName(_this);_this.events.sub(UILSocket.JS_FILE,(e=>{e.file.includes(name)&&(DOMTemplate.updateGlobalStyles(),_this.update())}))}function update(){let cssContent;_this.dynamicStyle&&(cssContent=_this.dynamicStyle(css).inflate(_this.element.div)),_this.render?.(html).inflate?.(_this.element.div,cssContent),_this.postRender?.()}this.update=function(){DOMTemplate.clearScheduled(update),DOMTemplate.schedule(update)},this.render=function(html){throw new Error("render() needs to be overwritten.")},this.setSourceData=function(data){_this.data=data,this.update(),_this.events.sub(data,Events.UPDATE,this.update)},_this.update()}),(_=>{DOMTemplate.parser=new DOMParser;const queue=[],worker=new Render.Worker((_=>{let callback=queue.shift();callback?callback():worker.pause()}),2);var _css;worker.pause(),DOMTemplate.schedule=function(callback){queue.push(callback),worker.resume()},DOMTemplate.clearScheduled=function(callback){for(let i=0;i<queue.length;i++){if(queue[i]==callback)return queue.splice(i,1)}},DOMTemplate.updateGlobalStyles=function(){Utils.debounce((async _=>{let css=await get(Assets.getPath("assets/css/style-scss.css"));_css||(_css=$(document.head).create("DOMTemplate-hotload","style")),_css.div.innerHTML=css}),20)}}))}(),Class((function Interaction(_object){Inherit(this,Events);const _this=this;var _touchId,_velocity=[],_moved=0,_time=performance.now();function Vec2(){this.x=0,this.y=0,this.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}var _vec2Pool=new ObjectPool(Vec2,10);let _distance,_timeDown,_timeMove;function loop(){_moved++>10&&(_this.velocity.x=_this.velocity.y=0,_this.delta.x=_this.delta.y=0)}function down(e){if(_this.isTouching&&!_this.multiTouch||"hit"==e.target.className&&e.target.hydraObject!=_object||Interaction.hitIsBound(e.target,_object))return;_this.isTouching=!0;let x=e.x,y=e.y;e.changedTouches&&(x=e.changedTouches[0].clientX,y=e.changedTouches[0].clientY,_touchId=e.changedTouches[0].identifier),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.hold.x=_this.last.x=x,_this.hold.y=_this.last.y=y,_this.delta.x=_this.move.x=_this.velocity.x=0,_this.delta.y=_this.move.y=_this.velocity.y=0,_distance=0,_this.events.fire(Interaction.START,e,!0),_timeDown=_timeMove=Render.TIME}function move(e){if(!_this.isTouching&&!_this.unlocked)return;let now=performance.now();if(now-_time<16)return;_time=now;let x=e.x,y=e.y;if(e.touches)for(let i=0;i<e.touches.length;i++){let touch=e.touches[i];touch.identifier==_touchId&&(x=touch.clientX,y=touch.clientY)}_this.isTouching&&(_this.move.x=x-_this.hold.x,_this.move.y=y-_this.hold.y),e.touches&&"number"==typeof e.touches[0].force&&(e.force=e.touches[0].force),e.x=_this.x=x,e.y=_this.y=y,_this.delta.x=x-_this.last.x,_this.delta.y=y-_this.last.y,_this.last.x=x,_this.last.y=y,_moved=0,_distance+=_this.delta.length();let delta=Render.TIME-(_timeMove||Render.TIME);if(_timeMove=Render.TIME,delta>.01){let velocity=_vec2Pool.get();velocity.x=Math.abs(_this.delta.x)/delta,velocity.y=Math.abs(_this.delta.y)/delta,_velocity.push(velocity),_velocity.length>5&&_vec2Pool.put(_velocity.shift())}_this.velocity.x=_this.velocity.y=0;for(let i=0;i<_velocity.length;i++)_this.velocity.x+=_velocity[i].x,_this.velocity.y+=_velocity[i].y;_this.velocity.x/=_velocity.length,_this.velocity.y/=_velocity.length,_this.velocity.x=_this.velocity.x||0,_this.velocity.y=_this.velocity.y||0,_this.events.fire(Interaction.MOVE,e,!0),_this.isTouching&&_this.events.fire(Interaction.DRAG,e,!0)}function up(e){if(e&&e.changedTouches)for(let i=0;i<e.changedTouches.length;i++)if(e.changedTouches[i].identifier!=_touchId)return;if(!_this.isTouching&&!_this.unlocked)return;_this.isTouching=!1,_this.move.x=0,_this.move.y=0,Math.max(.001,Render.TIME-(_timeMove||Render.TIME))>100&&(_this.delta.x=0,_this.delta.y=0),_distance<20&&Render.TIME-_timeDown<1e3&&!e.isLeaveEvent&&_this.events.fire(Interaction.CLICK,e,!0),_this.events.fire(Interaction.END,e,!0),Device.mobile&&(_this.velocity.x=_this.velocity.y=0)}function leave(){_this.ignoreLeave||(_this.delta.x=0,_this.delta.y=0,up({isLeaveEvent:!0}))}this.x=0,this.y=0,this.hold=new Vec2,this.last=new Vec2,this.delta=new Vec2,this.move=new Vec2,this.velocity=new Vec2,function(){if(!_object instanceof HydraObject)throw"Interaction.Input requires a HydraObject";!function addHandlers(){_object==Stage||_object==__window?Interaction.bind("touchstart",down):(_object.bind("touchstart",down),Interaction.bindObject(_object));Interaction.bind("touchmove",move),Interaction.bind("touchend",up),Interaction.bind("leave",leave)}(),Render.start(loop)}(),this.onDestroy=function(){Interaction.unbind("touchstart",down),Interaction.unbind("touchmove",move),Interaction.unbind("touchend",up),Render.stop(loop),Interaction.unbindObject(_object),_object&&_object.unbind&&_object.unbind("touchstart",down)}}),(()=>{Namespace(Interaction),Interaction.CLICK="interaction_click",Interaction.START="interaction_start",Interaction.MOVE="interaction_move",Interaction.DRAG="interaction_drag",Interaction.END="interaction_end";const _objects=[],_events={touchstart:[],touchmove:[],touchend:[],leave:[]};function touchMove(e){_events.touchmove.forEach((c=>c(e)))}function touchStart(e){_events.touchstart.forEach((c=>c(e)))}function touchEnd(e){_events.touchend.forEach((c=>c(e)))}function leave(e){e.leave=!0,_events.leave.forEach((c=>c(e)))}Hydra.ready((async()=>{await defer(),__window.bind("touchstart",touchStart),__window.bind("touchmove",touchMove),__window.bind("touchend",touchEnd),__window.bind("touchcancel",touchEnd),__window.bind("contextmenu",touchEnd),__window.bind("mouseleave",leave),__window.bind("mouseout",leave)})),Interaction.bind=function(evt,callback){_events[evt].push(callback)},Interaction.unbind=function(evt,callback){_events[evt].remove(callback)},Interaction.bindObject=function(obj){_objects.push(obj)},Interaction.unbindObject=function(obj){_objects.remove(obj)},Interaction.hitIsBound=function(element,boundObj){let obj=element.hydraObject;if(!obj)return!1;for(;obj;){if(obj!=boundObj&&_objects.includes(obj))return!0;obj=obj._parent}return!1}})),Class((function Mouse(){Inherit(this,Events);const _this=this;this.x=0,this.y=0,this.normal={x:0,y:0},this.tilt={x:0,y:0},this.inverseNormal={x:0,y:0},this.resetOnRelease=!1;const _offset={x:0,y:0};function init(){defer((_=>{_this.resetOnRelease&&Device.mobile&&(_this.x=Stage.width/2,_this.y=Stage.height/2)})),_this.input=new Interaction(__window),_this.input.unlocked=!0,_this.events.sub(_this.input,Interaction.START,start),_this.events.sub(_this.input,Interaction.MOVE,update),_this.events.sub(_this.input,Interaction.END,end),_this.hold=_this.input.hold,_this.last=_this.input.last,_this.delta=_this.input.delta,_this.move=_this.input.move,_this.velocity=_this.input.velocity,defer((()=>{_this.events.sub(Events.RESIZE,resize),resize()}))}function start(e){_this.down=!0,update(e)}function update(e){_this.x=e.x,_this.y=e.y,Stage.width&&Stage.height&&(_this.normal.x=e.x/Stage.width-_offset.x,_this.normal.y=e.y/Stage.height-_offset.y,_this.tilt.x=2*_this.normal.x-1,_this.tilt.y=1-2*_this.normal.y,_this.inverseNormal.x=_this.normal.x,_this.inverseNormal.y=1-_this.normal.y)}function end(e){_this.down=!1,Device.mobile&&_this.resetOnRelease&&update({x:Stage.width/2,y:Stage.height/2})}function resize(){Stage.css("top")&&(_offset.y=Stage.css("top")/Stage.height),Stage.css("left")&&(_offset.x=Stage.css("left")/Stage.width)}Hydra.ready(init)}),"Static"),Class((function Keyboard(){Inherit(this,Component);var _this=this;function addListeners(){__window.keydown(keydown),__window.keyup(keyup),__window.keypress(keypress)}function keydown(e){_this.pressing.includes(e.key)||_this.pressing.push(e.key),_this.events.fire(_this.DOWN,e)}function keyup(e){_this.pressing.remove(e.key),_this.events.fire(_this.UP,e)}function keypress(e){_this.events.fire(_this.PRESS,e)}this.pressing=[],_this.DOWN="keyboard_down",_this.PRESS="keyboard_press",_this.UP="keyboard_up",Hydra.ready(addListeners)}),"static"),Class((function Mobile(){Inherit(this,Component),Namespace(this);const _this=this;var $html,$featureDetects,_is100vh=!1;function preventNativeScroll(e){if(_this.isAllowNativeScroll)return;let target=e.target;if("LABEL"==target.nodeName||"INPUT"==target.nodeName||"TEXTAREA"==target.nodeName||"SELECT"==target.nodeName||"A"==target.nodeName)return;let prevent=target.hydraObject;for(;target.parentNode&&prevent;)target._scrollParent&&(prevent=!1),target=target.parentNode;prevent&&e.preventDefault()}function resize(){updateOrientation(),checkResizeRefresh(),updateMobileFullscreen(),_this.isAllowNativeScroll||(document.body.scrollTop=0)}function updateOrientation(){_this.orientation=Stage.width>Stage.height?"landscape":"portrait",_this.orientationSet&&(window.Fullscreen.isOpen||Device.mobile.pwa)&&window.screen&&window.screen.orientation&&window.screen.orientation.lock(_this.orientationSet)}Hydra.ready((()=>{if(Device.mobile){if(function initFeatureDetects(){$featureDetects=__body.create("feature-detects")}(),function addHandlers(){_this.events.sub(Events.RESIZE,resize),Device.mobile.native||window.addEventListener("touchstart",preventNativeScroll,{passive:!1})}(),Device.mobile?.phone&&!Device.mobile.native){$html=$(document.documentElement);let ios="safari"===Device.system.browser;ios?$html.div.classList.add("ios"):$html.div.classList.add("mob"),_is100vh=!0,ios&&(__body.css({height:"100%"}).div.scrollTop=0),updateMobileFullscreen()}Device.mobile.native&&Stage.css({width:"100vw",height:"100vh"})}}));const checkResizeRefresh=function(){let _lastWidth;return function(){_this.isPreventResizeReload||_lastWidth!=Stage.width&&(_lastWidth=Stage.width,("ios"===Device.system.os||"android"==Device.system.os&&Device.system.version>=7)&&(!Device.mobile.tablet||Math.max(Stage.width,Stage.height)>800||window.location.reload()))}}();function updateMobileFullscreen(){if($html){let vh100=$featureDetects.div.offsetHeight;$html.div.offsetHeight!==Stage.height?Stage.height===vh100?($html.css({height:""}),_is100vh=!0):($html.css({height:Stage.height}),_is100vh=!1):_is100vh||Stage.height!==vh100||($html.css({height:""}),_is100vh=!0)}}this.vibrate=function(duration){navigator.vibrate&&navigator.vibrate(duration)},this.fullscreen=function(){if(Device.mobile&&!Device.mobile.native&&!Device.mobile.pwa&&!Dev.emulator){if(!window.Fullscreen)throw"Mobile.fullscreen requires Fullscreen module";"android"!==Device.system.os||Device.detect("oculus")||(__window.bind("touchend",(()=>{Fullscreen.open()})),_this.ScreenLock&&_this.ScreenLock.isActive&&window.onresize())}},this.setOrientation=function(orientation,isForce){if(_this.System&&_this.NativeCore.active)return _this.System.orientation=_this.System[orientation.toUpperCase()];if(_this.orientationSet=orientation,updateOrientation(),isForce){if(!_this.ScreenLock)throw"Mobile.setOrientation isForce argument requires ScreenLock module";"any"===orientation?_this.ScreenLock.unlock():_this.ScreenLock.lock()}},this.isKeyboardOpen=function(){return Device.mobile&&document.activeElement.tagName.toLowerCase().includes(["textarea","input"])},this.allowNativeScroll=function(){_this.isAllowNativeScroll=!0,[$(document.documentElement),__body,Stage].forEach(($el=>$el.css({touchAction:"unset",MSContentZooming:"unset",MSTouchAction:"unset"})))},this.preventResizeReload=function(){_this.isPreventResizeReload=!0},this._addOverflowScroll=function($obj){$obj.div._scrollParent=!0,Device.mobile.native||($obj.div._preventEvent=function(e){e.stopPropagation()},$obj.bind("touchmove",$obj.div._preventEvent))},this._removeOverflowScroll=function($obj){$obj.unbind("touchmove",$obj.div._preventEvent)},this.get("phone",(()=>{throw"Mobile.phone is removed. Use Device.mobile.phone"})),this.get("tablet",(()=>{throw"Mobile.tablet is removed. Use Device.mobile.tablet"})),this.get("os",(()=>{throw"Mobile.os is removed. Use Device.system.os"})),function(){var _props=["--safe-area-inset-top","--safe-area-inset-right","--safe-area-inset-bottom","--safe-area-inset-left"];function getSafeAreaInset(index){if(!$featureDetects)return 0;let style=getComputedStyle($featureDetects.div);return parseInt(style.getPropertyValue(_props[index]))||0}_this.getSafeAreaInsets=()=>_props.map(((_,i)=>getSafeAreaInset(i))),_this.getSafeAreaInsetTop=()=>getSafeAreaInset(0),_this.getSafeAreaInsetRight=()=>getSafeAreaInset(1),_this.getSafeAreaInsetBottom=()=>getSafeAreaInset(2),_this.getSafeAreaInsetLeft=()=>getSafeAreaInset(3)}()}),"Static"),Class((function PushState(_isHash){const _this=this;let _store,_useInternal,_root="";function getState(){return _useInternal?new String(_store):_isHash?String(window.location.hash.slice(3)):("/"!==_root&&""!==_root?location.pathname.split(_root)[1]:location.pathname.slice(1))||""}function handleStateChange(state,forced){if(state!==_store||forced)if(!_this.isLocked||forced)_store=state,_this.events.fire(Events.UPDATE,{value:state,split:state.split("/")});else{if(!_store)return;_useInternal?_store=_store:_isHash?window.location.hash="!/"+_store:window.history.pushState(null,null,_root+_store)}}"boolean"!=typeof _isHash&&(_isHash=Hydra.LOCAL||!Device.system.pushstate),this.isLocked=!1,function(){if(!_this.flag)throw"Inherit PushState/Router after main class";_this.flag("isNotBlocked",!0),function addHandlers(){if(_isHash)return window.addEventListener("hashchange",(()=>handleStateChange(getState())),!1);window.onpopstate=history.onpushstate=()=>handleStateChange(getState())}(),_store=getState()}(),this.getState=this._getState=function(){return Device.mobile.native?Storage.get("app_state")||"":getState()},this.setRoot=function(root){_root="/"===root.charAt(0)?root:"/"+root},this.setState=this._setState=async function(state,forced){if(_this.events.fire(PushState.SET_STATE),await _this.wait("isNotBlocked"),Device.mobile.native&&Storage.set("app_state",state),state!==_store||forced)return _useInternal?_store=state:_isHash?window.location.hash="!/"+state:window.history.pushState(null,null,_root+state),_this.fireChangeWhenSet&&handleStateChange(getState(),forced),_store=state,!0},this.enableBlocker=function(){_this.flag("isNotBlocked",!1)},this.disableBlocker=function(){_this.flag("isNotBlocked",!0)},this.replaceState=function(state){state!==_store&&(_store=state,_useInternal&&(_store=state),_isHash?window.location.hash="!/"+state:window.history.replaceState(null,null,_root+state))},this.setTitle=function(title){document.title=title},this.lock=function(){this.isLocked=!0,_this.events.fire(PushState.LOCK)},this.unlock=function(){this.isLocked=!1,_this.events.fire(PushState.UNLOCK)},this.useHash=function(){_isHash=!0},this.useInternal=function(){_useInternal=!0}}),(_=>{PushState.SET_STATE="push_state_set_state",PushState.LOCK="push_state_lock",PushState.UNLOCK="push_state_unlock"})),Class((function Router(_isHash,_rootPath){Inherit(this,PushState,_isHash);const _this=this;var _debounce,_prevView,_nextView,_404Route,_routes=[];function matchRoute(path){let matchedRoute=null;return _routes.forEach((routesList=>{const match=routesList.list.find((route=>{if(route.root===path[0]){if(route.pathSplit.length===path.length&&"*"===route.pathSplit[path.length-1])return!0;if(!path[1]&&!route.params)return!0;if(path[1]&&route.params&&!(route.children&&route.children.length>0||path[2]))return!0;if(path[1]&&route.children&&route.children.length>0)return route.children.forEach((c=>{c.active=c.path===path[2]})),!0;if(path[1]&&route.pathSplit.length===path.length){let didMatchAll=!0;if(route.pathSplit.forEach(((pathSplitPath,index)=>{pathSplitPath!==path[index]&&(didMatchAll=!1)})),didMatchAll)return!0}}return!1}));match&&(matchedRoute=match)})),matchedRoute}function handleState(e){let value=e?.value,split=e?.split;value||(value=_this.getState(),split=value.split("/"));let route=null,cb=null;if(_this.lock(),_routes.forEach((({callback:callback,list:list})=>{route||(route=matchRoute(split),cb=callback)})),route&&route.redirect){let redirectedRoute=matchRoute(route.redirect.split("/"));if(redirectedRoute){if(route.updateURL)return _this.unlock(),void _this.setState(route.redirect);route=redirectedRoute}}route||(route=_404Route),async function doRoute(route,split,callback){_nextView=route.view;let params=null;params=route.params?{[Object.keys(route.params)[0]]:split?.[1]}:split?.[1];await callback(_prevView,_nextView,split.join("/"),params,route),await(_nextView?.onRouteChange?.({params:params,path:split.join("/"),name:route.name,children:route.children,meta:route.meta})),_prevView=_nextView,_this.currentRoute={...route,params:params},_this.unlock()}(route,split,cb)}_this.currentRoute=null,_this.fireChangeWhenSet=!0,function setRootPath(val){let rootPath;rootPath="string"==typeof _rootPath?_rootPath:Hydra.LOCAL?"":"/",_this.setRoot(rootPath)}(),function initEvents(){_this.events.sub(_this,Events.UPDATE,handleState)}(),this.registerRoutes=function(callback,list){if(list.forEach((element=>{const split=element.path.split("/");if(element.path.startsWith("/"))throw new Error("router paths should not start with /");element.root=split[0],element.pathSplit=split,"404"===element.path&&(_404Route=element),split.forEach((s=>{":"!==s[0]||(element.params={[`${s.substring(1)}`]:""})}))})),!_404Route)throw new Error('Error: no 404 route defined.  Please define a route whos path is "404" ');_routes.push({callback:callback,list:list}),clearTimeout(_debounce),_debounce=_this.delayedCall(handleState,1)},this.navigate=function(path){path.startsWith("/")&&(path=path.substring(1)),_this.setState(path)},this.replace=function(path){path.startsWith("/")&&(path=path.substring(1)),_this.replaceState(path)}})),Class((function AppState(_default){Inherit(this,Component);const _this=this;var _map=new Map,_bindings=new Map;const iGLUI=!!window.GLUI;class StateBinding{constructor(_keys,_obj){if(this._keys=_keys,this._obj=_obj,this._string="",this._oldValue="",this._type="",this._bindingLookup="",_obj instanceof HTMLElement)"INPUT"==_obj.nodeName?this._string=_obj.value:this._string=_obj.innerText,this._type="HTMLElement";else if(_obj instanceof DOMAttribute)this._string=_obj.value,this._name=_obj.name,this._belongsTo=_obj.belongsTo,this._bindingLookup=_obj.bindingLookup,this._type="DOMAttribute";else if(_obj instanceof HydraObject)"input"==_obj._type?this._string=_obj.val():this._string=_obj.text(),this._type="HydraObject";else if(iGLUI&&_obj instanceof GLUIText)this._string=_obj.getTextString(),this._type="GLUIText";else if(_obj.createLocal&&(this._type="appState"),_obj.onStateChange&&(this._type="class"),"function"==typeof _obj&&(this._type="function"),Array.isArray(_obj)&&_obj.every((el=>"function"==typeof el))){this._type="piped";const lastFunctionInChain=this._obj.pop();this._operators=this._obj,this._obj=lastFunctionInChain,this._count=0}}parse(key,value){if(!this._string||!this._string.includes("@["))return value;let string=this._string;return this._keys.forEach((key=>{string=string.replace(`@[${key}]`,_this.get(key))})),string}async operateOnValue(value){return await this._operators.reduce((async(prev,fn)=>{const prevResolved=await prev;return(await fn)(prevResolved,this._count++,this)}),value)}update(key,value){let newValue=this.parse(key,value);if(newValue!==this._oldValue||value&&value.push){switch(this._oldValue=newValue,this._type){case"HTMLElement":"input"==this._obj._type?this._obj.value=newValue:this._obj.innerText=newValue;break;case"DOMAttribute":this._obj.belongsTo.setAttribute(this._obj.name,this._obj.value.replace(this._obj.bindingLookup,newValue));break;case"HydraObject":"input"==this._obj._type?this._obj.val(newValue):this._obj.text(newValue);break;case"GLUIText":this._obj.setText(newValue);break;case"function":this._obj(value);break;case"piped":this.operateOnValue(value).then((val=>this._obj(val)),(reject=>null));break;case"class":this._obj.onStateChange(value);break;case"appState":this._obj.set(key,value)}return!0}}destroy(){this._keys=null,this._obj=null,this._string=null,this._oldValue=null,this._type=null,this._operators=null,this._count=null,this.update=()=>null}}this.set=function(key,value){if(_this.flag("readonly"))return console.warn("This AppState is locked and can not make changes");_map.set(key,value),_this.onUpdate&&_this.onUpdate();let array=_bindings.get(key);if(array){let len=array.length;for(let i=0;i<len;i++){let b=array[i];b&&b.update?b.update(key,value):array.remove(b)}}},this.get=function(key){return _map.get(key)},this.getMap=function(){return _map},this.toJSON=function(){return Object.fromEntries(_map)},this.bind=function(keys,...rest){if(!rest.length)return{state:_this,key:keys};Array.isArray(keys)||(keys=[keys]);const obj=1===rest.length?rest[0]:rest;let binding=new StateBinding(keys,obj);return keys.forEach((key=>{_bindings.has(key)?_bindings.get(key).push(binding):_bindings.set(key,[binding]);let value=_map.get(key);void 0!==value&&binding.update(key,value)})),binding},this.createLocal=function(obj){let appState=new AppState(obj);return new Proxy(appState,{set(target,property,value){"origin"===property?appState[property]=value:appState.set(property,value)},get:(target,property)=>target[property]?target[property]:appState.get(property)})},this.setAll=function(obj){for(let key in obj)_this.set(key,obj[key])},this.lock=function(){_this.flag("readonly",!0)},this.unlock=function(){_this.flag("readonly",!1)},_default&&this.setAll(_default)}),"static"),Class((function AppStateOperators(_default){Inherit(this,Component),this.map=fn=>value=>fn(value),this.tap=fn=>value=>(fn(value),value),this.filter=fn=>(value,emittedCount)=>fn(value,emittedCount)?value:Promise.reject(),this.skip=skipCount=>this.filter(((_,emittedCount)=>skipCount<=emittedCount)),this.untilDestroyed=ctx=>{let checked=!1;return(value,_,binding)=>(checked||(checked=!0,ctx._bindOnDestroy((_=>{Hydra.LOCAL&&console.log("binding destroyed "),binding.destroy?.()}))),value)}}),"static"),Class((function AppStore(){const _this=this;this.state=AppState.createLocal();const _mutations={},_actions={};let _subscribers=[],_actionSubscribers=[];function registerMutation(type,handler){(_mutations[type]||(_mutations[type]=[])).push((function wrappedMutationHandler(payload){handler.call(_this,_this.state,payload)}))}function registerAction(type,handler){(_actions[type]||(_actions[type]=[])).push((function wrappedActionHandler(payload){let res=handler.call(_this,{dispatch:_this.dispatch,commit:_this.commit,state:_this.state,rootState:_this.state},payload);return function isPromise(val){return val&&"function"==typeof val.then}(res)||(res=Promise.resolve(res)),res}))}function genericSubscribe(fn,subscribers,options){return subscribers.indexOf(fn)<0&&(options&&options.prepend?subscribers.unshift(fn):subscribers.push(fn)),()=>{const i=subscribers.indexOf(fn);i>-1&&subscribers.splice(i,1)}}this.createAppStore=function(_params){!function setInitState(_params){const{state:state}=_params;for(let key in state)_this.state.set(key,state[key])}(_params),function mapMutations(_params){const{mutations:mutations}=_params;for(let key in mutations)registerMutation(key,mutations[key])}(_params),function mapActions(_params){const{actions:actions}=_params;for(let key in actions)registerAction(key,actions[key])}(_params)},this.commit=function(type,payload){const mutation={type:type,payload:payload},entry=_mutations[type];entry?(entry.forEach((function commitIterator(handler){handler(payload)})),_subscribers.slice().forEach((sub=>sub(mutation,this.state)))):Hydra.LOCAL&&console.error(`Error: no mutation for type ${type}`)},this.dispatch=function(type,payload){const action={type:type,payload:payload},entry=_actions[type];entry||Hydra.LOCAL&&console.error(`Error: no action for type ${type}`);try{_actionSubscribers.slice().filter((sub=>sub.before)).forEach((sub=>sub.before(action,_this.state)))}catch(e){Hydra.LOCAL&&(console.warn("Error in before action subscribers: "),console.error(e))}const result=entry.length>1?Promise.all(entry.map((handler=>handler(payload)))):entry[0](payload);return new Promise(((resolve,reject)=>{result.then((res=>{try{_actionSubscribers.filter((sub=>sub.after)).forEach((sub=>sub.after(action,_this.state)))}catch(e){Hydra.LOCAL&&(console.warn("Error in after action subscribers: "),console.error(e))}resolve(res)}),(error=>{try{_actionSubscribers.filter((sub=>sub.error)).forEach((sub=>sub.error(action,_this.state,error)))}catch(e){Hydra.LOCAL&&(console.warn("Error in error action subscribers: "),console.error(e))}reject(error)}))}))},this.subscribeAction=function(key,fn,options){let subs={};return"function"==typeof fn?subs.before=function subscriberEmptyBeforeWrapper(action){action.type===key&&fn(action)}:(fn.before&&(subs.before=function subscriberBeforeWrapper(action){action.type===key&&fn.before(action)}),fn.after&&(subs.after=function subscriberAfterWrapper(action){action.type===key&&fn.after(action)})),genericSubscribe(subs,_actionSubscribers,options)},this.subscribe=function(key,fn,options){return genericSubscribe((function subscriberWrapper(mutation){mutation.type===key&&fn(mutation)}),_subscribers,options)},this.bind=this.state.bind,this.watch=this.state.bind,this.get=this.state.get})),Class((function StateArray(_src=[]){Inherit(this,Events);const _this=this;var _data=[];if(Object.defineProperty(_this,"length",{get:function(){return _data.length}}),this.push=function(obj){let state=function wrap(obj){if(obj.createLocal)return obj;if("object"!=typeof obj||Array.isArray(obj))throw"StateArray entries must be {objects}!";let state=AppState.createLocal();for(let key in obj)state.set(key,obj[key]);return state.origin=obj,state}(obj);_data.push(state);let index=_data.length-1;return void 0===_this[index]&&Object.defineProperty(_this,index,{set:function(v){for(let key in v)_data[index].set(key,v[key])},get:function(){return _data[index]}}),_this.events.fire(Events.UPDATE,{type:"add",state:state}),state},this.remove=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];state.origin!==obj&&state!==obj||(_data.splice(i,1),_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0))}},this.forEach=function(cb){_data.forEach((function(...args){return cb.apply(this,args)}))},this.map=function(cb){let array=[];return _data.forEach((function(...args){return array.push(cb.apply(this,args))})),array},this.toJSON=function(){let array=[];return _data.forEach((appState=>{array.push(appState.toJSON())})),array},this.getMap=function(){let array=[];return _data.forEach((appState=>{array.push(appState.getMap())})),array},this.indexOf=function(obj){for(let i=0;i<_data.length;i++){let state=_data[i];if(state.origin===obj||state===obj)return i}},this.refresh=function(array){if(_this.events.fire(StateArray.REFRESH,{type:"refresh"},!0),!Array.isArray(array))throw"StateArray can only take an array as a parameter";let i=_data.length;for(;i--;){let state=_data.pop();_this.events.fire(Events.UPDATE,{type:"remove",state:state},!0)}_data.length=0,array.forEach(_this.push)},this.reflow=function(){this.refresh(_data.map((d=>d.origin)))},!Array.isArray(_src))throw"StateArray can only take an array as a parameter";_src.forEach(_this.push)}),(_=>{StateArray.REFRESH="state_array_refresh"})),Class((function ViewState(ViewClass,...rest){const _this=this;var _stateArray,_instances=this.views=[];function dataUpdate(e){switch(e.type){case"add":ViewState.schedule(_this,ViewClass,e.state,_stateArray.indexOf(e.state),rest);break;case"remove":!function remove(data){for(let i=0;i<_instances.length;i++){let inst=_instances[i];if(data==inst.data)return _this.onRemoveView?.(inst,i),void _instances.splice(i,1)}}(e.state),ViewState.clearScheduled(e.state)}}this.setSourceData=function(array){if(!(array instanceof StateArray))throw"ViewState::setSourceData must be instance of StateArray";_stateArray=_this.stateArray=array,_this.events.sub(array,Events.UPDATE,dataUpdate),array.forEach((state=>{ViewState.schedule(_this,ViewClass,state,_stateArray.indexOf(state),rest)}))},this.onInitialize=function(instance){_instances.push(instance),_this.onAddView?.(instance,_instances.length-1)}}),(_=>{const queue=[],worker=new Render.Worker((_=>{let obj=queue.shift();if(obj){let{ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:additionalArgs}=obj;if(!ref.initClass)return;let args=[];additionalArgs.forEach((arg=>{args.push(...arg)}));let inst=ref.initClass(ViewClass,data,index,...args);inst.data=data,ref.onInitialize(inst)}else worker.pause()}),2);worker.pause(),ViewState.clearScheduled=function(data){for(let i=0;i<queue.length;i++){if(queue[i].data===data)return queue.splice(i,1)}},ViewState.schedule=function(ref,ViewClass,data,index,...rest){ref.initClass&&(queue.push({ref:ref,ViewClass:ViewClass,data:data,index:index,additionalArgs:rest}),worker.resume())}})),Class((function StateComponent(){const _this=this;let _mutationsUnsubscribers=[],_actionsUnsubscribers=[];this.unsubscribeMutations=function(){_mutationsUnsubscribers.forEach((u=>u()))},this.unsubscribeActions=function(){_actionsUnsubscribers.forEach((u=>u()))},this.unsubscribeAll=function(){_this.unsubscribeMutations(),_this.unsubscribeActions()},this.subscribeMutation=function(store,type,fn){_mutationsUnsubscribers.push(store.subscribe(type,fn))},this.subscribeAction=function(store,type,fn){_actionsUnsubscribers.push(store.subscribeAction(type,fn))},this.commit=function(store,type,payload){store.commit(type,payload)},this.dispatch=async function(store,type,payload){await store.dispatch(type,payload)},this.getState=function(store,key){return store.get(key)},this.watch=function(store,key,fn,callInitial=!0){let hasCalled=!1;const callback=params=>{hasCalled||callInitial?fn(params):hasCalled=!0};return _this.bindState?_this.bindState(store,key,callback):store.watch(key,callback)},this.bind=this.watch,"function"==typeof this._bindOnDestroy&&this._bindOnDestroy((()=>{_this.unsubscribeAll()}))})),Class((function Dev(){var _post,_inter,_timerName,_this=this;Utils.timestamp();function postError(error){let device={gpu:Device.graphics.webgl?Device.graphics.webgl.gpu:"WEBGL UNAVAILABLE",version:Device.graphics.webgl?Device.graphics.webgl.version:"WEBGL UNAVAILABLE",tier:window.GPU?Device.mobile?GPU.M_TIER:GPU.TIER:"",mobile:JSON.stringify(Device.mobile),userAgent:Device.agent,dpr:Device.pixelRatio,screenSize:`${screen.width} x ${screen.height}`,stageSize:`${Stage.width} x ${Stage.height}`,href:window.location.href},tests={};try{if(window.Tests)for(let key in Tests)"function"==typeof Tests[key]&&(tests[key]=Tests[key]())}catch(e){}post(_post,{error:error,device:device,tests:tests}).catch((function(){Hydra.LOCAL&&console.log("Error whle posting to server")}))}this.emulator=Device.mobile&&navigator.platform&&navigator.platform.toLowerCase().includes(["mac","windows"]),this.postErrorsToServer=function(server){_post=server,function catchErrors(){window.onerror=function(message,file,line,column,e){postError({message:message,file:file,line:line,column:column,stack:e&&e.stack.toString()})},window.addEventListener("unhandledrejection",(e=>{postError({type:"unhandledrejection",message:e.reason.message,stack:e.reason.stack})}))}()},this.expose=function(name,val,force){(Hydra.LOCAL||force)&&(window[name]=val)},this.unsupported=function(needsAlert){needsAlert&&alert("Hi! This build is not yet ready for this device, things may not work as expected. Refer to build schedule for when this device will be supported.")},this.checkForLeaks=function(flag,array){if(!window.AURA){var matchArray=function(prop){if(!array)return!1;for(var i=0;i<array.length;i++)if(prop.includes(array[i]))return!0;return!1};clearInterval(_inter),flag&&(_inter=setInterval((function(){for(var prop in window){if(!prop.includes("webkit"))if("function"!=typeof window[prop]&&prop.length>2){if(prop.includes("_ga")||prop.includes("_typeface_js")||matchArray(prop))continue;var char1=prop.charAt(0),char2=prop.charAt(1);if(("_"==char1||"$"==char1)&&char2!==char2.toUpperCase())throw console.log(window[prop]),"Hydra Warning:: "+prop+" leaking into global scope"}}}),1e3))}},this.startTimer=function(name){_timerName=name||"Timer",console.time&&!window._NODE_?console.time(_timerName):_timer=performance.now()},this.stopTimer=function(){console.time&&!window._NODE_?console.timeEnd(_timerName):console.log("Render "+_timerName+": "+(performance.now()-_timer))},this.writeFile=function(file,data){let promise=Promise.create(),protocol=location.protocol,port="https:"===protocol?":8018":":8017",url=protocol+"//"+location.hostname+port+location.pathname+file;return post(url,data,{headers:{"content-type":"text/plain"}}).then((e=>{"OK"!=e?(console.warn(`Unable to write to ${file}`),promise.reject()):promise.resolve()})),promise},this.execUILScript=async function(name,data){if(!Hydra.LOCAL)return;let url=location.protocol+"//"+location.hostname+":8017"+(_this.pathName||location.pathname)+"/uil/"+name,response=await post(url,data,{headers:{"content-type":"text/plain"}});if("ERROR"==response)throw response;return response},Hydra.LOCAL&&_this.checkForLeaks(!0)}),"Static"),Class((function Service(){Inherit(this,Component);var _sw,_this=this;function getSWAssets(){if(!window.ASSETS.SW||_this.cached)return[];var assets=window.ASSETS.SW;return assets.forEach(((asset,i)=>{asset.includes(".js")&&(asset=assets[i].replace(".js",".js?"+window._CACHE_))})),assets}function handleRegistration(e){}function handleReady(e){_this.isReady=!0,_this.events.fire(Events.READY,e,!0),_sw=navigator.serviceWorker.controller,function checkCache(){Storage.get("service_cache")!=window._CACHE_&&_this.post("clearCache")}()}function handleError(e){e&&(_this.events.fire(Events.ERROR,e,!0),_this.active=!1)}function handleMessage(e){var data=e.data;data.evt&&_this.events.fire(data.evt,data)}this.active=!1,this.ready=!1,this.cached=!1,this.offline=!1,this.disabled=!1,this.ready=function(){return this.wait(this,"isReady")},this.init=function(){Hydra.ready((()=>{!("serviceWorker"in navigator)||Hydra.LOCAL&&""==location.port||window.process||_this.disabled||function initWorker(){_this.active=!0,navigator.serviceWorker.register(`${window._SW_PATH_?window._SW_PATH_:""}sw.js`).then(handleRegistration).then(handleReady).then(handleError)}()}))},this.cache=function(assets=[]){assets=Array.from(assets);_this.active&&_this.wait(_this,"ready",(function(){_this.post("upload",{assets:assets,cdn:Assets.CDN,hostname:location.hostname,sw:getSWAssets(),offline:_this.offline}),Storage.set("service_cache",window._CACHE_),_this.cached=!0}))},this.post=function(fn,data={}){if(!_this.active)return;_this.wait(_this,"ready",(function(){let mc=new MessageChannel;mc.port1.onmessage=handleMessage,data.fn=fn,_sw&&_sw.postMessage(data,[mc.port2])}))}}),"static"),Class((function Storage(){var _storage,_this=this,_sessionData={};function cookie(key,value,expires){var options;if(arguments.length>1&&(null===value||"object"!=typeof value)){if((options={}).path="/",options.expires=expires||1,null===value&&(options.expires=-1),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}return document.cookie=[encodeURIComponent(key),"=",options.raw?String(value):encodeURIComponent(String(value)),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result,decode=(options=value||{}).raw?function(s){return s}:decodeURIComponent;return(result=new RegExp("(?:^|; )"+encodeURIComponent(key)+"=([^;]*)").exec(document.cookie))?decode(result[1]):null}this.noTracking=!1,function testStorage(){try{if(window.localStorage)try{window.localStorage.test=1,window.localStorage.removeItem("test"),_storage=!0}catch(e){_storage=!1}else _storage=!1}catch(e){_storage=!1}}(),this.setCookie=function(key,value,expires){cookie(key,value,expires)},this.getCookie=function(key){return cookie(key)},this.set=function(key,value){_this.noTracking?_sessionData[key]=value:(null!=value&&"object"==typeof value&&(value=JSON.stringify(value)),_storage?null===value?window.localStorage.removeItem(key):window.localStorage[key]=value:cookie(key,value,365))},this.get=function(key){if(_this.noTracking)return _sessionData[key];var val,char0;(val=_storage?window.localStorage[key]:cookie(key))&&(val.charAt&&(char0=val.charAt(0)),"{"!=char0&&"["!=char0||(val=JSON.parse(val)),"true"!=val&&"false"!=val||(val="true"==val));return val}}),"Static"),Class((function Thread(_class){Inherit(this,Component);var _this=this,_worker,_callbacks,_path,_mvc,_msg={};function init(){let file=window._ES5_?"/hydra-thread-es5.js":"/hydra-thread.js";_callbacks={},_worker=new Worker(Thread.PATH+file)}function importClasses(){importClass(Utils),importClass(Component),importClass(Events),importClass(_class,!0),importES5()}function importClass(_class,scoped){if(_class){var code;if(scoped){code=(code=_class.toString().replace("{","!!!")).split("!!!")[1];for(var splitChar=window._MINIFIED_?"=":" ";code.includes("this.");){var name=code.slice(code.indexOf("this.")).split("this.")[1].split(splitChar)[0];code=code.replace("this","self"),createMethod(name)}code=(code=code.slice(0,-1)).replace(/_self/g,"_this")}else if("function"!=typeof _class){if((code=_class.constructor.toString()).includes("[native"))return;code=(_class.constructor._namespace?_class.constructor._namespace+".":"")+"Class("+code+', "static");'}else code=(_class._namespace?_class._namespace+".":"")+"Class("+_class.toString()+");";_worker.postMessage({code:code})}}function createMethod(name){_this[name]=function(message={},callback,buffer){let promise;return Array.isArray(callback)&&(buffer=callback,callback=void 0),Array.isArray(buffer)&&((message={msg:message,transfer:!0}).buffer=buffer),void 0===callback&&(promise=Promise.create(),callback=promise.resolve),_this.send(name,message,callback),promise}}function importES5(){window._ES5_&&(["_createSuper","_isNativeReflectConstruct"].forEach((name=>{let code=window[name].toString();code.includes("[native")||_worker.postMessage({code:code})})),_worker.postMessage({code:"function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}"}))}function addListeners(){_worker.addEventListener("message",workerMessage)}function workerMessage(e){if(e.data.console)console.log(e.data.message);else if(e.data.id){(callback=_callbacks[e.data.id])&&callback(e.data.message),delete _callbacks[e.data.id]}else if(e.data.emit){(callback=_callbacks[e.data.evt])&&callback(e.data.msg)}else{var callback;(callback=_callbacks.transfer)&&callback(e.data)}}init(),importClasses(),addListeners(),this.on=function(evt,callback){_callbacks[evt]=callback},this.off=function(evt){delete _callbacks[evt]},this.loadFunction=function(){let names=[],load=code=>{var split=(code=(code=code.toString()).replace("(","!!!")).split("!!!"),name=split[0].split(" ")[1];code="self."+name+" = function("+split[1],_worker.postMessage({code:code}),createMethod(name),names.push(name)};for(var i=0;i<arguments.length;i++)load(arguments[i]);return names},this.importScript=function(path){_worker.postMessage({path:Thread.absolutePath(path),importScript:!0})},this.importCode=function(code){_worker.postMessage({code:code})},this.importClass=function(){for(var i=0;i<arguments.length;i++){var code=arguments[i];importClass(code)}},this.importModules=this.importModule=function(){for(var i=0;i<arguments.length;i++){let code=Modules.getConstructor(arguments[i]).toString();_worker.postMessage({code:`Module(${code})`})}},this.importES6Class=function(name){if(window._ES5_){let Class=window[name],base=Class.toString(),proto=[],sup,matches=/(_this\w+)\s*=\s*(_super\w+)\.call/g.exec(base);if(matches){let superVar=matches[2],superConstructor=Object.getPrototypeOf(Class);if(!superConstructor.toString().includes("[native")){let superName=Utils.getConstructorName(superConstructor);sup=`_inherits(${name}, ${superName}); var ${superVar} = _createSuper(${name});`}}Object.getOwnPropertyNames(Class.prototype).forEach((fn=>{"constructor"!=fn&&Class.prototype[fn]&&proto.push({key:fn,string:Class.prototype[fn].toString()})})),_worker.postMessage({es5:base,name:name,proto:proto,sup:sup})}else _worker.postMessage({es6:`(${eval(name)})`,name:name})},this.send=function(name,message,callback){if("string"==typeof name){(message=message||{}).fn=name}else callback=message,message=name;Thread.UNIQUE_ID>999999&&(Thread.UNIQUE_ID=1);var id=Thread.UNIQUE_ID++;callback&&(_callbacks[id]=callback),message.transfer?(message.msg.id=id,message.msg.fn=message.fn,message.msg.transfer=!0,_worker.postMessage(message.msg,message.buffer)):(_msg.message=message,_msg.id=id,_worker.postMessage(_msg))},this.onDestroy=function(){_worker.terminate&&_worker.terminate()}}),(()=>{var _shared;Thread.PATH=window._THREAD_PATH_||"assets/js/hydra",Thread.UNIQUE_ID=1,Thread.absolutePath=Hydra.absolutePath,Thread.cluster=function(){return new function(){let index=0,array=[];this.push=function(thread){array.push(thread)},this.get=function(){let thread=array[index];return index++,index>=array.length&&(index=0),thread},this.array=array}},Thread.upload=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].loadFunction(...args);return name},Thread.uploadClass=function(...args){let name;Thread.shared();for(let i=0;i<_shared.array.length;i++)name=_shared.array[i].importClass(...args);return name},Thread.shared=function(list){if(!_shared){_shared=Thread.cluster();let hardware=navigator.hardwareConcurrency||4,count=Math.max(Math.min(hardware,8),4);for(let i=0;i<count;i++)_shared.push(new Thread)}return list?_shared:_shared.get()}})),Class((function TweenManager(){Namespace(this);var _this=this,_tweens=[];function updateTweens(time,dt){for(let i=_tweens.length-1;i>=0;i--){let tween=_tweens[i];tween.update?tween.update(dt):_this._removeMathTween(tween)}}function findEase(name){for(var eases=_this.CubicEases,i=eases.length-1;i>-1;i--)if(eases[i].name==name)return eases[i];return!1}this.CubicEases=[],Render.start(updateTweens),this._addMathTween=function(tween){_tweens.push(tween)},this._removeMathTween=function(tween){_tweens.remove(tween)},this._getEase=function(name,values){var ease=findEase(name);return!!ease&&(values?ease.path?ease.path.solve:ease.values:ease.curve)},this._inspectEase=function(name){return findEase(name)},this.tween=function(object,props,time,ease,delay,complete,isManual,scaledTime){"number"!=typeof delay&&(update=complete,complete=delay,delay=0);const tween=new MathTween(object,props,time,ease,delay,complete,isManual,scaledTime);let usePromise=null;return complete&&complete instanceof Promise&&(usePromise=complete,complete=complete.resolve),usePromise||tween},this.clearTween=function(object){if(object._mathTween&&object._mathTween.stop&&object._mathTween.stop(),object._mathTweens){for(var tweens=object._mathTweens,i=0;i<tweens.length;i++){var tw=tweens[i];tw&&tw.stop&&tw.stop()}object._mathTweens=null}},this.addCustomEase=function(ease){var add=!0;if("object"!=typeof ease||!ease.name||!ease.curve)throw"TweenManager :: addCustomEase requires {name, curve}";for(var i=_this.CubicEases.length-1;i>-1;i--)ease.name==_this.CubicEases[i].name&&(add=!1);if(add){if("m"==ease.curve.charAt(0).toLowerCase()){if(!window.EasingPath)throw"Using custom eases requires easingpath module";ease.path=new EasingPath(ease.curve)}else ease.values=function stringToValues(str){for(var values=str.split("(")[1].slice(0,-1).split(","),i=0;i<values.length;i++)values[i]=parseFloat(values[i]);return values}(ease.curve);_this.CubicEases.push(ease)}return ease},Math.interpolate=function(start,end,alpha,ease){const fn=_this.Interpolation.convertEase(ease);return Math.mix(start,end,"function"==typeof fn?fn(alpha):_this.Interpolation.solve(fn,alpha))},window.tween=this.tween,window.clearTween=this.clearTween}),"Static"),TweenManager.Class((function Interpolation(){function calculateBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}this.convertEase=function(ease){var fn=function(){switch(ease){case"easeInQuad":return TweenManager.Interpolation.Quad.In;case"easeInCubic":return TweenManager.Interpolation.Cubic.In;case"easeInQuart":return TweenManager.Interpolation.Quart.In;case"easeInQuint":return TweenManager.Interpolation.Quint.In;case"easeInSine":return TweenManager.Interpolation.Sine.In;case"easeInExpo":return TweenManager.Interpolation.Expo.In;case"easeInCirc":return TweenManager.Interpolation.Circ.In;case"easeInElastic":return TweenManager.Interpolation.Elastic.In;case"easeInBack":return TweenManager.Interpolation.Back.In;case"easeInBounce":return TweenManager.Interpolation.Bounce.In;case"easeOutQuad":return TweenManager.Interpolation.Quad.Out;case"easeOutCubic":return TweenManager.Interpolation.Cubic.Out;case"easeOutQuart":return TweenManager.Interpolation.Quart.Out;case"easeOutQuint":return TweenManager.Interpolation.Quint.Out;case"easeOutSine":return TweenManager.Interpolation.Sine.Out;case"easeOutExpo":return TweenManager.Interpolation.Expo.Out;case"easeOutCirc":return TweenManager.Interpolation.Circ.Out;case"easeOutElastic":return TweenManager.Interpolation.Elastic.Out;case"easeOutBack":return TweenManager.Interpolation.Back.Out;case"easeOutBounce":return TweenManager.Interpolation.Bounce.Out;case"easeInOutQuad":return TweenManager.Interpolation.Quad.InOut;case"easeInOutCubic":return TweenManager.Interpolation.Cubic.InOut;case"easeInOutQuart":return TweenManager.Interpolation.Quart.InOut;case"easeInOutQuint":return TweenManager.Interpolation.Quint.InOut;case"easeInOutSine":return TweenManager.Interpolation.Sine.InOut;case"easeInOutExpo":return TweenManager.Interpolation.Expo.InOut;case"easeInOutCirc":return TweenManager.Interpolation.Circ.InOut;case"easeInOutElastic":return TweenManager.Interpolation.Elastic.InOut;case"easeInOutBack":return TweenManager.Interpolation.Back.InOut;case"easeInOutBounce":return TweenManager.Interpolation.Bounce.InOut;case"linear":return TweenManager.Interpolation.Linear.None}}();if(!fn){var curve=TweenManager._getEase(ease,!0);fn=curve||TweenManager.Interpolation.Cubic.Out}return fn},this.solve=function(values,elapsed){return values[0]==values[1]&&values[2]==values[3]?elapsed:calculateBezier(function getTForX(aX,mX1,mX2){for(var aT,aA1,aA2,aGuessT=aX,i=0;i<4;i++){var currentSlope=(aT=aGuessT,3*A(aA1=mX1,aA2=mX2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1));if(0==currentSlope)return aGuessT;aGuessT-=(calculateBezier(aGuessT,mX1,mX2)-aX)/currentSlope}return aGuessT}(elapsed,values[0],values[2]),values[1],values[3])},this.Linear={None:function(k){return k}},this.Quad={In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},this.Cubic={In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},this.Quart={In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},this.Quint={In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},this.Sine={In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},this.Expo={In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(2-Math.pow(2,-10*(k-1)))}},this.Circ={In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},this.Elastic={In:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p))},Out:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k,a=1,p=.4){var s;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*-.5:a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},this.Back={In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?k*k*((s+1)*k-s)*.5:.5*((k-=2)*k*((s+1)*k+s)+2)}},this.Bounce={In:function(k){return 1-this.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*this.Bounce.In(2*k):.5*this.Bounce.Out(2*k-1)+.5}}}),"Static"),Class((function MathTween(_object,_props,_time,_ease,_delay,_callback,_manual,_scaledTime){var _startTime,_startValues,_endValues,_easeFunction,_paused,_newEase,_spring,_damping,_update,_currentTime,_this=this,_elapsed=0;function clear(){if(!_object&&!_props)return!1;_object._mathTween=null,TweenManager._removeMathTween(_this),Utils.nullObject(_this),_object._mathTweens&&_object._mathTweens.remove(_this._tweenWrapper)}_this.object=_object,_this.props=_props,_this.time=_time,_this.ease=_ease,_this.delay=_delay,defer((function(){if(!_this.stopped){if(_this.overrideValues){let values=_this.overrideValues(_this,_object,_props,_time,_ease,_delay);values&&(_this.props=_props=values.props||_props,_this.time=_time=values.time||_time,_this.ease=_ease=values.ease||_ease,_this.delay=_delay=values.delay||_delay)}if(_object&&_props){if(_this.object=_object,"number"!=typeof _time)throw"MathTween Requires object, props, time, ease";!function start(){_object.multiTween||!_object._mathTween||_manual||TweenManager.clearTween(_object);_manual||TweenManager._addMathTween(_this);_this.time=_time,_this.delay=_delay;let propString=function getPropString(){let string="";for(let key in _props)"number"==typeof _props[key]&&(string+=key+" ");return string}();_object._mathTween=_this,_object.multiTween&&(_object._mathTweens||(_object._mathTweens=[]),_object._mathTweens.forEach((t=>{t.props==propString&&t.tween.stop()})),_this._tweenWrapper={props:propString,tween:_this},_object._mathTweens.push(_this._tweenWrapper));_ease||(_ease="linear");"string"==typeof _ease&&(_ease=TweenManager.Interpolation.convertEase(_ease),_easeFunction="function"==typeof _ease);_startTime=_scaledTime?Render.now():performance.now(),_currentTime=_startTime,_startTime+=_delay,_endValues=_props,_startValues={},_props.spring&&(_spring=_props.spring);_props.damping&&(_damping=_props.damping);for(var prop in _this.startValues=_startValues,_endValues)"number"==typeof _object[prop]&&(_startValues[prop]=_object[prop])}()}}})),this.update=function(dt){if(_paused)return;if((_currentTime+=_scaledTime?dt:Render.DT)<_startTime)return;_elapsed=(_elapsed=(_currentTime-_startTime)/_time)>1?1:_elapsed;let delta=this.interpolate(_elapsed);_update&&_update(delta),1==_elapsed&&(_callback&&_callback(),_this.completePromise&&_this.completePromise.resolve(),clear())},this.pause=function(){_paused=!0},this.resume=function(){_paused=!1},this.stop=function(){return _this.stopped=!0,clear(),null},this.setEase=function(ease){_newEase!=ease&&(_newEase=ease,_ease=TweenManager.Interpolation.convertEase(ease),_easeFunction="function"==typeof _ease)},this.getValues=function(){return{start:_startValues,end:_endValues}},this.interpolate=function(elapsed){var delta=_easeFunction?_ease(elapsed,_spring,_damping):TweenManager.Interpolation.solve(_ease,elapsed);for(var prop in _startValues)if("number"==typeof _startValues[prop]&&"number"==typeof _endValues[prop]){var start=_startValues[prop],end=_endValues[prop];_object[prop]=start+(end-start)*delta}return delta},this.onUpdate=function(callback){return _update=callback,this},this.onComplete=function(callback){return _callback=callback,this},this.promise=function(){return _this.completePromise=Promise.create(),_this.completePromise},this.setElapsed=function(elapsed){_startTime=performance.now(),_currentTime=_startTime+_time*elapsed}})),Class((function TweenTimeline(){Inherit(this,Component);const _this=this;let _tween,_total=0;const _tweens=[];function calculate(){_tweens.sort((function(a,b){const ta=a.time+a.delay;return b.time+b.delay-ta}));const first=_tweens[0];_total=first.time+first.delay}function loop(){let time=_this.elapsed*_total;for(let i=_tweens.length-1;i>-1;i--){let t=_tweens[i],relativeTime=time-t.delay,elapsed=Math.clamp(relativeTime/t.time,0,1);t.interpolate(elapsed)}_this.events.fire(Events.UPDATE,_this,!0)}this.elapsed=0,this.get("timeRemaining",(()=>_total-_this.elapsed*_total)),this.add=function(object,props,time,ease,delay=0){let tween;return(object instanceof MathTween||object instanceof FrameTween)&&(props=object.props,time=object.time,ease=object.ease,delay=object.delay,object=object.object),tween=object instanceof HydraObject?new FrameTween(object,props,time,ease,delay,null,!0):new MathTween(object,props,time,ease,delay,null,!0),_tweens.push(tween),defer(calculate),tween},this.tween=function(to,time,ease,delay,callback){return _this.clearTween(),_tween=tween(_this,{elapsed:to},time,ease,delay).onUpdate(loop).onComplete(callback),_tween},this.clearTween=function(){_tween&&_tween.stop&&_tween.stop()},this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)},this.update=function(){loop()},this.onDestroy=function(){_this.clearTween(),Render.stop(loop);for(var i=0;i<_tweens.length;i++)_tweens[i].stop()}})),Class((function Data(){Inherit(this,Model);const _this=this;!async function(){await Hydra.ready(),await CMS.ready();Config.PAGE={chapter1:[{layoutName:"carflyaround",height:10,scrollEndPad:.5,bloom:.25,title:CMS.get("home.homeSubhead"),copy:CMS.get("home.homeBody"),cta:CMS.get("home.homeCTA"),text:[{start:.13,end:.28,copy:CMS.get("chapters.chapter-1.stories")[0].copy},{start:.22,end:.37,copy:CMS.get("chapters.chapter-1.stories")[1].copy},{start:.31,end:.46,copy:CMS.get("chapters.chapter-1.stories")[2].copy},{start:.4,end:.58,copy:CMS.get("chapters.chapter-1.stories")[3].copy,right:!0},{start:.55,end:.8,copy:CMS.get("chapters.chapter-1.stories")[4].extra1,color:Colors.value.black,right:!0},{start:.65,end:.9,copy:CMS.get("chapters.chapter-1.stories")[4].copy.replaceAll("CO2","CO₂"),color:Colors.value.black,right:!0}],instruction:{type:"engine",start:.35,end:.52,copy:"Accelerate the car"},landingCopy:[{start:.001,end:.12,title:CMS.get("home.homeSubhead"),copy:CMS.get("home.homeBody"),cta:CMS.get("home.homeCTA")}],scroll:{start:-.1,end:.1}},{layoutName:"forgefield2",height:3,bloom:0,text:[{start:.1,end:.7,copy:CMS.get("chapters.chapter-1.stories")[5].copy,color:Colors.value.black},{start:.35,end:1.1,copy:CMS.get("chapters.chapter-1.stories")[5].extra1,color:Colors.value.black}]},{layoutName:"fanscene2",height:2,bloom:.1,text:[{start:.1,end:1,copy:CMS.get("chapters.chapter-1.stories")[6].copy,color:Colors.value.black,right:!0}]},{layout:Molecules,height:9,bloom:.25,text:[{start:0,end:.15,copy:CMS.get("chapters.chapter-1.stories")[7].extra1,cta:CMS.get("chapters.chapter-1.stories")[7].userInstruction},{start:.1,end:.25,copy:CMS.get("chapters.chapter-1.stories")[8].extra1,cta:CMS.get("chapters.chapter-1.stories")[8].userInstruction},{start:.28,end:.6,copy:CMS.get("chapters.chapter-1.stories")[9].extra1,cta:CMS.get("chapters.chapter-1.stories")[9].userInstruction},{start:.52,end:.7,copy:CMS.get("chapters.chapter-1.stories")[10].extra1,cta:CMS.get("chapters.chapter-1.stories")[10].userInstruction},{start:.75,end:1.1,copy:CMS.get("chapters.chapter-1.stories")[11].extra1,top:!0,right:!0}],instruction:{start:.35,end:.65,copy:"energize the molecules",color:"#efcd7c"}},{layoutName:"gasstation3",height:4,bloom:.25,text:[{start:.05,end:.55,copy:CMS.get("chapters.chapter-1.stories")[12].extra1,right:!0},{start:.45,end:1.1,copy:CMS.get("chapters.chapter-1.stories")[13].extra1},{start:.58,end:1.2,copy:CMS.get("chapters.chapter-1.stories")[13].extra2,color:Colors.value.teal,additive:!0}],dashboard:{type:"fillup",start:.5,end:1},instruction:{start:.45,end:1.1,copy:"fill the tank",color:Colors.value.teal}}],chapter2:[{layout:GasStation2,height:2,bloom:.25,text:[{start:.4,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[0].copy}],scroll:{start:-.1,end:.1}},{layoutName:"route66",height:2,bloom:.25,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[0].extra1}]},{layoutName:"trucks",height:2,bloom:.25,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[1].copy}],dashboard:{type:"truck",start:.1,end:1.1}},{layoutName:"planeLayout",height:2,bloom:.25,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[2].copy,color:Colors.value.black}],dashboard:{type:"plane",start:.1,end:1.1}},{layoutName:"oilfieldtransform",height:2,bloom:.25,text:[{start:.1,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[3].copy,right:!0},{start:.25,end:1.25,copy:CMS.get("chapters.chapter-2.stories")[3].extra1,right:!0,color:Colors.value.teal,additive:!0}]},{layoutName:"solarfield2",height:4,bloom:.25,text:[{start:.1,end:.7,copy:CMS.get("chapters.chapter-2.stories")[4].copy,right:!0},{start:.4,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[4].extra1,right:!0}]},{layoutName:"distill",height:2,bloom:.25,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[5].copy,top:!0}],dashboard:{type:"spirits",start:.2,end:1.1,left:!0}},{layoutName:"campshopsmall",height:2,bloom:1,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[6].copy}],dashboard:{type:"store",start:.1,end:1.1}},{layoutName:"tents",height:2,bloom:.8,text:[{start:.2,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[7].copy}],dashboard:{type:"camp",start:.1,end:1.1}},{layoutName:"campfire",height:3,bloom:1.5,text:[{start:.4,end:1.1,copy:CMS.get("chapters.chapter-2.stories")[8].copy}]}],chapter3:[{layoutName:"ch3newlanding",height:6,bloom:.25,text:[{start:0,end:.1,copy:"Scroll to read our story",isA11Y:!0},{start:.1,end:.6,copy:CMS.get("chapters.chapter-3.stories")[0].copy,right:!0},{start:.4,end:1,copy:CMS.get("chapters.chapter-3.stories")[0].extra1,right:!0}],scroll:{start:-.1,end:1}},{layoutName:"ch3landing",height:3,bloom:.25,text:[{start:.1,end:1.1,copy:CMS.get("chapters.chapter-3.stories")[1].copy,right:!0}]},{layoutName:"ch3insidefactory",height:4,bloom:.25,text:[{start:.1,end:.6,copy:CMS.get("chapters.chapter-3.stories")[2].copy,right:!1,top:!1,color:Colors.value.white},{start:.4,end:1,copy:CMS.get("chapters.chapter-3.stories")[2].extra1,right:!0,top:!1,color:Colors.value.white}]},{layoutName:"ch3caravan",height:4,bloom:.25,text:[{start:.1,end:.5,copy:CMS.get("chapters.chapter-3.stories")[4].copy,right:!1}]},{layoutName:"ch3shipping",height:3,bloom:.25,text:[{start:.25,end:1.1,copy:CMS.get("chapters.chapter-3.stories")[5].copy,right:!0}]},{layoutName:"ch3destination",height:3,bloom:.25,text:[{start:0,end:1,copy:CMS.get("chapters.chapter-3.stories")[6].copy,right:!0,top:!0,color:Colors.value.white}]},{layoutName:"ch3ending",height:7,bloom:.25,text:[{start:.01,end:.26,copy:CMS.get("chapters.chapter-3.stories")[7].copy,right:!1},{start:.3,end:.45,copy:CMS.get("chapters.chapter-3.stories")[7].extra1,right:!1},{start:.4,end:.6,copy:CMS.get("chapters.chapter-3.stories")[7].extra2,right:!1},{start:.52,end:.7,copy:CMS.get("chapters.chapter-3.stories")[7].extra3,right:!1},{start:.7,end:.875,copy:CMS.get("chapters.chapter-3.stories")[7].extra4,right:!1},{start:.8,end:1,copy:CMS.get("chapters.chapter-3.stories")[7].extra5,right:!1}]},{layoutName:"ch3endingsplit",mobileCameras:!0,near:5,height:4,bloom:.25,text:[{start:0,end:.3,copy:CMS.get("chapters.chapter-3.stories")[8].copy,right:!1},{start:.15,end:.4,copy:CMS.get("chapters.chapter-3.stories")[8].extra1,right:!1},{start:.35,end:.7,copy:CMS.get("chapters.chapter-3.stories")[8].extra2,right:!1},{start:.7,end:.9,copy:CMS.get("chapters.chapter-3.stories")[8].extra3,right:!1,sub:CMS.get("chapters.chapter-3.stories")[9].extra1,cta:CMS.get("chapters.chapter-3.stories")[9].userInstruction}]}],news:[{layoutName:"newsMain",ui:NewsPageUI}],mission:[{layoutName:"aboutMain",height:1}],menu:[{layout:MenuSection,ui:MenuUI}],error:[{layout:ErrorSection,ui:ErrorUI}],privacy:[{layoutName:"privacySection",ui:PrivacyUI}],contact:[{layout:ContactSection,ui:ContactUI}],newsDetail:[{layoutName:"newsDetail",ui:NewsDetailUI}]},Config.TECHNOLOGY={section1:{bg:"black",data:{text1:`${CMS.get("technology.landing").title}`.replace(/<br>/g,"\n")}},section2:{bg:"beige",data:{text1:CMS.get("technology.titan-fuel-forge").textItems.subhead.value,text2:CMS.get("technology.titan-fuel-forge").title.replace(/<br>/g,"\n"),text3:CMS.get("technology.titan-fuel-forge").longTextItems.bodycopy1.value.replace(/<br>/g,"\n"),text4:CMS.get("technology.titan-fuel-forge").longTextItems.bodycopy2.value.replace(/<br>/g,"\n")}},section3:{bg:"black",data:{text1:CMS.get("technology.carbon-salvage").title.replace(/<br>/g,"\n"),text2:CMS.get("technology.carbon-salvage").longTextItems.bodycopy1.value.replace(/<br>/g,"\n")}},section4:{bg:"beige",data:{text1:CMS.get("technology.charging").title.replace(/<br>/g,"\n"),text2:CMS.get("technology.charging").longTextItems.bodycopy1.value.replace(/<br>/g,"\n"),text3:CMS.get("technology.charging").longTextItems.bodycopy2.value.replace(/<br>/g,"\n")}},section5:{bg:"black",data:{text1:CMS.get("technology.molecular-sorting").title.replace(/<br>/g,"\n"),text2:CMS.get("technology.molecular-sorting").longTextItems.bodycopy1.value.replace(/<br>/g,"\n")}},section6:{bg:"beige",data:{text1:CMS.get("technology.custom-assembly").title.replace(/<br>/g,"\n"),text2:CMS.get("technology.custom-assembly").longTextItems.bodycopy1.value.replace(/<br>/g,"\n")}}},Config.CONTACT={header:CMS.get("contact.formHeader"),success:CMS.get("contact.success"),description:CMS.get("contact.disclaimer"),emailError:"Please verify your email address and try again",generalError:CMS.get("contact.error"),title:CMS.get("contact.title")},_this.dataReady=!0}()}),"static"),window.ASSETS=["assets/js/lib/_draco/draco_decoder.js","assets/js/lib/_draco/draco_decoder.wasm","assets/js/lib/_draco/draco_wasm_wrapper.js","assets/js/lib/basis_transcoder.js","assets/js/lib/basis_transcoder.wasm","assets/js/lib/firebase-app.js","assets/js/lib/firebase-auth.js","assets/js/lib/firebase-database.js","assets/js/lib/firebase-storage.js","assets/js/lib/quill.js","assets/js/lib/video.min.js","assets/data/bouncingcube-baked.json","assets/data/test/bouncingcube-baked.json","assets/data/test/timeline-baked.json","assets/data/test/toggle_test-baked.json","assets/data/timeline-baked.json","assets/data/timeline-ch3caravan_theatre.json","assets/data/timeline-ch3ending_theatre.json","assets/data/timeline-ch3endingsplit_theatre.json","assets/data/timeline-ch3landing_theatre.json","assets/data/timeline-ch3newlanding_theatre.json","assets/data/timeline-ch3shipping_theatre.json","assets/data/uil.1691179176443.json","assets/shaders/compiled.1691179176443.vs"],ASSETS.SW=["assets/fonts/FuturaLT-Bold.json","assets/fonts/FuturaLT-Bold.png","assets/fonts/FuturaLT-Bold.ttf","assets/fonts/FuturaLT-Book.json","assets/fonts/FuturaLT-Book.otf","assets/fonts/FuturaLT-Book.png","assets/fonts/FuturaLT-Heavy.json","assets/fonts/FuturaLT-Heavy.png","assets/fonts/FuturaLT-Heavy.ttf","assets/fonts/FuturaLT-Light.json","assets/fonts/FuturaLT-Light.otf","assets/fonts/FuturaLT-Light.png","assets/fonts/FuturaLT-Medium.json","assets/fonts/FuturaLT-Medium.png","assets/fonts/FuturaLT-Medium.ttf","assets/fonts/marscondensed-regular-TRIAL.json","assets/fonts/marscondensed-regular-TRIAL.otf","assets/fonts/marscondensed-regular-TRIAL.png","assets/fonts/marscondensedweb-regular-TRIAL.eot","assets/fonts/marscondensedweb-regular-TRIAL.woff","assets/fonts/marsextended-regular-TRIAL.json","assets/fonts/marsextended-regular-TRIAL.otf","assets/fonts/marsextended-regular-TRIAL.png","assets/fonts/marsextendedweb-regular-TRIAL.eot","assets/fonts/marsextendedweb-regular-TRIAL.woff","assets/css/style-scss.css","assets/css/style.css","assets/css/video-js.min.css","assets/js/app.1691179176443.js"],Class((function Config(){Inherit(this,Model);this.ANALYTICS_ID="UA-160159103-1",this.ENV=window._CONFIG_&&window._CONFIG_.ENV,this.CMS=window._CONFIG_&&window._CONFIG_.CMS,this.API=window._CONFIG_&&window._CONFIG_.API,this.NEWSLETTER_URL=window._CONFIG_&&window._CONFIG_.newsletterRoot+"newsletter",this.SCROLL_PAGE_OFFSET=Device.mobile?0:12}),"static"),Mobile.Class((function Accelerometer(){var _this=this;function updateAccel(e){switch(window.orientation){case 0:_this.x=-e.accelerationIncludingGravity.x,_this.y=e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 180:_this.x=e.accelerationIncludingGravity.x,_this.y=-e.accelerationIncludingGravity.y,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.beta=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case 90:_this.x=e.accelerationIncludingGravity.y,_this.y=e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians);break;case-90:_this.x=-e.accelerationIncludingGravity.y,_this.y=-e.accelerationIncludingGravity.x,_this.z=e.accelerationIncludingGravity.z,e.rotationRate&&(_this.rotationRate.alpha=-e.rotationRate.alpha*_this.toRadians,_this.rotationRate.beta=-e.rotationRate.beta*_this.toRadians,_this.rotationRate.gamma=e.rotationRate.gamma*_this.toRadians)}"android"==Device.system.os&&(_this.x*=-1,_this.y*=-1,_this.z*=-1)}function updateOrientation(e){for(var key in e)key.toLowerCase().includes("heading")&&(_this.heading=e[key]);switch(window.orientation){case 0:_this.alpha=e.beta*_this.toRadians,_this.beta=-e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 180:_this.alpha=-e.beta*_this.toRadians,_this.beta=e.alpha*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case 90:_this.alpha=e.alpha*_this.toRadians,_this.beta=e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians;break;case-90:_this.alpha=-e.alpha*_this.toRadians,_this.beta=-e.beta*_this.toRadians,_this.gamma=e.gamma*_this.toRadians}_this.tilt=e.beta*_this.toRadians,_this.yaw=e.alpha*_this.toRadians,_this.roll=-e.gamma*_this.toRadians,"android"==Device.system.os&&(_this.heading=function compassHeading(alpha,beta,gamma){var degtorad=Math.PI/180,_x=beta?beta*degtorad:0,_y=gamma?gamma*degtorad:0,_z=alpha?alpha*degtorad:0,cY=(Math.cos(_x),Math.cos(_y)),cZ=Math.cos(_z),sX=Math.sin(_x),sY=Math.sin(_y),sZ=Math.sin(_z),Vx=-cZ*sY-sZ*sX*cY,Vy=-sZ*sY+cZ*sX*cY,compassHeading=Math.atan(Vx/Vy);Vy<0?compassHeading+=Math.PI:Vx<0&&(compassHeading+=2*Math.PI);return compassHeading*(180/Math.PI)}(e.alpha,e.beta,e.gamma))}this.x=0,this.y=0,this.z=0,this.alpha=0,this.beta=0,this.gamma=0,this.heading=0,this.rotationRate={},this.rotationRate.alpha=0,this.rotationRate.beta=0,this.rotationRate.gamma=0,this.toRadians="ios"==Device.system.os?Math.PI/180:1,this.capture=function(){this.active||(this.active=!0,window.DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((permissionState=>{"granted"===permissionState&&window.addEventListener("devicemotion",updateAccel)})).catch(console.error):window.addEventListener("devicemotion",updateAccel),window.DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((permissionState=>{"granted"===permissionState&&window.addEventListener("deviceorientation",updateOrientation)})).catch(console.error):window.addEventListener("deviceorientation",updateOrientation))},this.stop=function(){this.active=!1,window.ondevicemotion=null,_this.x=_this.y=_this.z=0,window.removeEventListener("deviceorientation",updateOrientation)}}),"Static"),Class((function Antimatter(_num,_config,_renderer=World.RENDERER){Inherit(this,AntimatterFBO);var _geometry,_this=this,_drawLimit=_num,_size=function findSize(){return _config.pot?Math.pow(2,Math.ceil(Math.log(Math.sqrt(_num))/Math.log(2))):Math.ceil(Math.sqrt(_num))}();async function createBuffer(){let{geometry:geometry,vertices:vertices,attribs:attribs,usedDepth:usedDepth}=await AntimatterUtil.createBufferArray(_size,_num,_config);_this.vertices=_this.cloneVertices?vertices.clone():vertices,(_geometry=geometry.clone(!0)).drawRange.end=_drawLimit,_this.vertices.geometry=_geometry,_this.attribs=_this.random=attribs,_this.textureUsedDepth=usedDepth,_this.init(_geometry,_renderer,_size)}defer(createBuffer),this.createFloatArray=function(components=3){return new Float32Array(_size*_size*components)},this.createFloatArrayAsync=async function(components=3,freshCopy){let{array:array}=await AntimatterUtil.createFloatArray(_size*_size*components,freshCopy);return array},this.ready=function(callback){return _this.wait(_this,"vertices")},this.useShader=function(vs,fs,params){"object"==typeof fs&&(params=fs,fs=null),this.vertexShader=vs,this.fragmentShader=fs||vs,this.uniforms=params},this.createMesh=this.getMesh=function(){let shader=_this.createShader(_this.fragmentShader||"AntimatterBasicFrag");return _this.mesh=new Points(_geometry,shader),_this.mesh.frustumCulled=!1,_this.shader=shader,_this.geometry=_geometry,_this.mesh},this.createShader=function(fs){let uniforms=_this.uniforms||{},obj={tPos:{type:"t",value:_this.vertices.texture,ignoreUIL:!0},tPrevPos:{type:"t",value:_this.vertices.texture,ignoreUIL:!0}};for(let key in uniforms)obj[key]=uniforms[key];let shader=new Shader(_this.vertexShader||"AntimatterPosition",fs,obj),vs=shader.vertexShader;if(vs&&!vs.includes("uniform sampler2D tPos")){let split=vs.split("__ACTIVE_THEORY_LIGHTS__"),defined="uniform sampler2D tPos;";shader.vertexShader=split[0]+"\n"+defined+"\n__ACTIVE_THEORY_LIGHTS__\n"+split[1]}return shader},this.getLookupArray=function(){return new Float32Array(_this.vertices.geometry.attributes.position.array)},this.getRandomArray=function(){return _geometry.attributes.random.array},this.overrideShader=function(original){let shader=original.clone();original.copyUniformsTo(shader),shader.uniforms.tPos={type:"t",value:_this.vertices.texture,ignoreUIL:!0},shader.uniforms.tPrevPos={type:"t",value:_this.vertices.texture,ignoreUIL:!0},_this.shader=shader,_this.mesh.shader=shader},this.upload=async function(needsMesh){_this.preventRender=!0,_geometry.distributeBufferData=!0,await _this.ready(),await _this.vertices.uploadAsync(),await defer(),await _this.random.uploadAsync(),await defer(),_this.mesh&&needsMesh&&(_this.mesh.upload(),await _geometry.uploadBuffersAsync());for(let key in _this.shader.uniforms){let uniform=_this.shader.uniforms[key];uniform.value&&(uniform.value.uploadAsync?await uniform.value.uploadAsync():uniform.value.upload&&(uniform.value.upload(),await defer()))}await _this.wait(100);for(let i=0;i<_this.passes.length;i++)await _this.passes[i].upload();_this.preventRender=!1},this.uploadSync=async function(needsMesh){await _this.ready(),_this.customClass&&_this.customClass.loaded&&await _this.customClass.loaded(),_this.mesh&&needsMesh&&_this.mesh.upload();for(let i=0;i<4;i++)_this.update()},this.get("particleCount",(_=>_num)),this.get("textureSize",(_=>_size)),this.get("powerOf2",(_=>Math.pow(2,Math.ceil(Math.log(Math.sqrt(_num))/Math.log(2)))))})),Class((function AntimatterAttribute(_data,_components){Inherit(this,Component);var _this=this,_size=Math.sqrt(_data.length/(_components||3));this.size=_size,this.count=_size*_size,this.buffer=_data,this.texture=new DataTexture(_data,_size,_size,4==_components?Texture.RGBAFormat:Texture.RGBFormat,Texture.FLOAT),this.set("needsUpdate",(function(){_this.texture&&(_this.texture.needsUpdate=!0)})),this.bufferData=function(data,components){_this.buffer=data,components!=_components?(_this.texture.destroy(),_this.texture=new DataTexture(data,_size,_size,4==components?Texture.RGBAFormat:Texture.RGBFormat,Texture.FLOAT)):(_this.texture.data=data,_this.texture.needsUpdate=!0),_components=components,_data=data},this.upload=function(){_this.texture.upload()},this.uploadAsync=function(){return _this.texture.distributeTextureData=!0,_this.texture.upload(),_this.texture.uploadAsync()},this.clone=function(){return new AntimatterAttribute(_data,_components)},this.onDestroy=function(){_this.texture&&_this.texture.destroy&&_this.texture.destroy()}})),Class((function AntimatterFBO(){var _this,_gpuGeom,_renderer,_size,_prevRT,_scene,_mesh,_camera,_copy,_geometry;Inherit(this,Component);var _output={type:"t",value:null,ignoreUIL:!0},_prevOutput={type:"t",value:null,ignoreUIL:!0};function copy(input,output){World.RENDERER.blit(input,output)||(_copy.visible=!0,_mesh.visible=!1,_copy.shader.uniforms.tMap.value=input,_renderer.renderSingle(_copy,_camera,output),_copy.visible=!1,_mesh.visible=!0)}this.passes=[],this.init=function(geometry,renderer,size){_this=this,_gpuGeom=geometry.attributes.position.array,_renderer=renderer,_size=size,function initPasses(){_camera=World.CAMERA,_geometry=World.QUAD,_scene=new Scene,(_mesh=new Mesh(_geometry,null)).frustumCulled=!1,_mesh.noMatrices=!0,_mesh.transient=!0,_scene.add(_mesh);let copyShader=AntimatterFBO.getCopyShader();(_copy=new Mesh(_geometry,copyShader)).noMatrices=!0,_scene.add(_copy),_copy.visible=!1}()},this.getGPUGeom=function(){return _gpuGeom},this.addPass=function(pass,index){_this=this,pass.init||pass.initialize(_size),"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass)},this.findPass=function(name){_this=this;for(var i=0;i<_this.passes.length;i++){var pass=_this.passes[i];if(pass.name==name)return pass}},this.removePass=function(pass){_this=this,"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},this.update=function(){if((_this=this).mesh&&!_this.preventRender){var output=_output.value||_this.vertices.texture;_this.storeVelocity&&(_prevRT?(copy(_output.value,_prevRT),_prevOutput.value=_prevRT):(_prevOutput.value=output,(_prevRT=_this.passes[0].getRT(0).clone()).upload()));for(var i=0;i<_this.passes.length;i++){var pass=_this.passes[i],needsInit=!pass.init,firstRender=!pass.first;needsInit&&pass.initialize(_size),pass.first=!0,_mesh.shader=pass.shader,_mesh.shader.uniforms.tInput.value=firstRender?_this.vertices.texture:pass.output,pass.ready||(_mesh.shader.uniforms.tInput.value=_this.vertices.texture);var rt=firstRender?pass.getRT(0):pass.getWrite();output=pass.output;_renderer.renderSingle(_scene.children[0],_camera,rt),copy(rt,output),pass.swap()}output&&(_output.value=output,_this.mesh.shader.uniforms.tPos.value=_output.value,_this.mesh.shader.uniforms.tPrevPos.value=_prevOutput.value)}},this.onDestroy=function(){_this.vertices&&_this.vertices.destroy&&_this.vertices.destroy(),_this.attribs&&_this.attribs.destroy&&_this.attribs.destroy(),_this.passes.forEach((function(pass){pass.first=!1,_this.persistPasses||pass&&pass.destroy&&pass.destroy()})),_this.mesh.destroy()},this.getOutput=function(){return _output},this.getPrevOutput=function(){return _prevOutput}}),(function(){var _shader;AntimatterFBO.getCopyShader=function(){return _shader||((_shader=new Shader("ScreenQuad")).addUniforms({tMap:{type:"t",value:null}}),_shader._attachmentData={format:Texture.RGBAFormat,type:Texture.FLOAT,attachments:1}),_shader}})),Class((function AntimatterPass(_shader,_uni,_clone){var _this=this;this.UILPrefix="am_"+_shader;const _uniforms={tInput:{type:"t",value:null,ignoreUIL:!0},fSize:{type:"f",value:64,ignoreUIL:!0}};var _rts=[],_read=0,_write=0;function prepareShader(code,type){if("vs"==type)return code;let header=["uniform sampler2D tInput;","uniform float fSize;","varying vec2 vUv;",Shaders.getShader("antimatter.glsl")].join("\n"),mainAt=code.indexOf("void main()"),before=code.slice(0,mainAt),after=code.slice(mainAt);return code=before+header+after,_this.onCreateShader&&(code=_this.onCreateShader(code)),code}function initRT(size){var type="ios"==Device.system.os?Texture.HALF_FLOAT:Texture.FLOAT,parameters={minFilter:Texture.NEAREST,magFilter:Texture.NEAREST,format:Texture.RGBAFormat,type:type},rt=new RenderTarget(size,size,parameters);return rt.texture.generateMipmaps=!1,rt}this.uniforms=_uniforms,this.output=initRT(64),this.name=_shader,this.id=Utils.timestamp(),this.ready=!1,function(){if(_uni)for(var key in _uni.unique&&(_this.UILPrefix+="_"+_uni.unique.replace("/","_"),delete _uni.unique),_uni.customCompile&&(_this.customCompile=_uni.customCompile||"",delete _uni.customCompile),_uni)_uniforms[key]=_uni[key]}(),this.addInput=function(name,attribute){var uniform="object"!=typeof attribute||attribute.height||"string"!=typeof attribute.type?attribute instanceof AntimatterAttribute?{type:"t",value:attribute.texture,ignoreUIL:!0}:attribute instanceof AntimatterPass?{type:"t",value:attribute.output,ignoreUIL:!0}:{type:"t",value:attribute,ignoreUIL:!0}:attribute;let lookup=UILStorage.parse(_this.UILPrefix+name);lookup&&(uniform.value=lookup.value);let uniforms=_shader&&_shader.uniforms?_shader.uniforms:_uniforms;return uniforms[name]=uniform,uniform.ignoreUIL=!0,uniforms[name]},this.addUniforms=function(object){let uniforms=_shader&&_shader.uniforms?_shader.uniforms:_uniforms;for(let key in object){let uniform=object[key],lookup=UILStorage.parse(_this.UILPrefix+key);if(lookup){if(Array.isArray(lookup.value))switch(lookup.value.length){case 2:lookup.value=(new Vector2).fromArray(lookup.value);break;case 3:lookup.value=(new Vector3).fromArray(lookup.value);break;case 4:lookup.value=(new Vector4).fromArray(lookup.value)}uniform.value=lookup.value}uniforms[key]=uniform}},this.getRT=function(index){return _rts[index]},this.getRead=function(){return _rts[_read]},this.getWrite=function(){return _rts[_write]},this.setRead=function(index){_read=index},this.setWrite=function(index){_write=index},this.swap=function(){++_write>2&&(_write=0,_this.ready=!0),++_read>2&&(_this.onInit&&(_this.onInit(),_this.onInit=null),_read=0)},this.initialize=function(size){if(!_this.init){_this.init=!0;for(var i=0;i<3;i++)_rts.push(initRT(size));_this.output.setSize(size,size),_shader instanceof Shader||((_shader=new Shader("AntimatterPass",_shader,{customCompile:_this.customCompile}))._attachmentData={format:Texture.RGBAFormat,type:Texture.FLOAT,attachments:1},_shader.preCompile=prepareShader,_shader.addUniforms(_uniforms),_this.uniforms=_shader.uniforms,_shader.UILPrefix=_this.UILPrefix,_shader.id=Utils.timestamp()),_this.shader=_shader,_shader.uniforms.fSize.value=size}},this.setUniform=function(key,value){_uniforms[key]||(_uniforms[key]={value:value}),_uniforms[key].value=value,_shader&&_shader.uniforms&&(_shader.uniforms[key].value=value)},this.getUniform=function(key){return _shader&&_shader.uniforms?_shader.uniforms[key].value:null},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_shader.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return new AntimatterPass(_shader,_uni)},this.destroy=function(){_rts.forEach((function(rt){rt&&rt.destroy&&rt.destroy()}))},this.upload=async function(){_shader.upload(),await defer();for(let i=0;i<_rts.length;i++)_rts[i].upload(),await defer();for(let key in _shader.uniforms){let uniform=_shader.uniforms[key];uniform.value&&(uniform.value.uploadAsync?await uniform.value.uploadAsync():uniform.value.upload&&(uniform.value.upload(),await defer()))}}})),Class((function AntimatterSpawn(_proton,_group,_input){Inherit(this,Component);const _this=this;var _life,_pass,_velocity,_color,_index=-1,_total=_proton.particleCount,_releasedA=[],_releasedB=[],_temp0=[],_temp1=[],_temp2=[],_vec=new Vector3;function loop(){let count=_releasedA.length;for(let i=count-1;i>-1;i--){let index=_releasedA[i];_life.buffer[4*index+0]=0}_releasedA.length=0,count&&(_life.needsUpdate=!0);let hold=_releasedA;_releasedA=_releasedB,_releasedB=hold}!async function(){await async function initPass(){let[lifeBuffer,velocityBuffer]=await Promise.all([_proton.antimatter.createFloatArrayAsync(4,!0),_proton.antimatter.createFloatArrayAsync(3,!0)]);_life=_this.initClass(AntimatterAttribute,lifeBuffer,4),_velocity=_this.initClass(AntimatterAttribute,velocityBuffer,3),_pass=_this.initClass(AntimatterPass,"AntimatterSpawn",{unique:_input.prefix,uMaxCount:_proton.behavior.uniforms.uMaxCount,tAttribs:_proton.behavior.uniforms.tAttribs,tLife:{value:_life,ignoreUIL:!0},uSetup:{value:1,ignoreUIL:!0},decay:{value:1},HZ:{value:Render.HZ_MULTIPLIER,ignoreUIL:!0},decayRandom:{value:new Vector2(1,1)}}),ShaderUIL.add(_pass,_group).setLabel("Life Shader"),_pass.onInit=_=>{_pass.setUniform("uSetup",0),_this.canEmit=!0},_proton.behavior.addInput("tSpawn",_pass),_proton.behavior.addInput("tVelocity",_velocity),_proton.shader.addUniforms({tLife:{value:_pass.output}}),_proton.antimatter.addPass(_pass,0),_this.lifeOutput=_pass.output}(),_this.startRender(loop)}(),this.emit=function(position,velocity,color){if(!_this.canEmit)return;if(velocity&&position.length!=velocity.length)throw"Position and velocity need to be the same length";if(color&&position.length!=color.length)throw"Position and color need to be the same length";let count=position.length/3;for(let i=0;i<count;i++){let index=++_index;_index>=_total&&(_index=-1),_life.buffer[4*index+0]=1,_life.buffer[4*index+1]=position[3*i+0],_life.buffer[4*index+2]=position[3*i+1],_life.buffer[4*index+3]=position[3*i+2],velocity&&(_velocity.buffer[3*index+0]=velocity[3*i+0],_velocity.buffer[3*index+1]=velocity[3*i+1],_velocity.buffer[3*index+2]=velocity[3*i+2]),color&&_color&&(_color.buffer[3*index+0]=color[3*i+0],_color.buffer[3*index+1]=color[3*i+1],_color.buffer[3*index+2]=color[3*i+2]),_releasedB.push(index)}_life.needsUpdate=!0,velocity&&(_velocity.needsUpdate=!0),color&&_color&&(_color.needsUpdate=!0)},this.release=function(pos,count=1,radius=0,velocity,color){if(!_this.canEmit)return;let positions=_temp0,velocities=velocity?_temp1:null,colors=color?_temp2:null,radX=Array.isArray(radius)?radius[0]:radius,radY=Array.isArray(radius)?radius[1]:radius,radZ=Array.isArray(radius)?radius[2]:radius;for(let i=0;i<count;i++)pos.spherical?(_vec.set(Math.random(-1,1,4),Math.random(-1,1,4),Math.random(-1,1,4)).normalize().multiplyScalar(radX),positions[3*i+0]=pos.x+_vec.x,positions[3*i+1]=pos.y+_vec.y,positions[3*i+2]=pos.z+_vec.z):(positions[3*i+0]=pos.x+Math.random(-1,1,4)*radX,positions[3*i+1]=pos.y+Math.random(-1,1,4)*radY,positions[3*i+2]=pos.z+Math.random(-1,1,4)*radZ),velocities&&(velocities[3*i+0]=velocity.x,velocities[3*i+1]=velocity.y,velocities[3*i+2]=velocity.z),colors&&(colors[3*i+0]=color.r,colors[3*i+1]=color.g,colors[3*i+2]=color.b);_this.emit(positions,velocities,colors),_temp0.length=0,_temp1.length=0,_temp2.length=0},this.upload=async function(){await(_life?.uploadAsync()),await(_velocity?.uploadAsync())},this.useColor=async function(shader){let colorBuffer=await _proton.antimatter.createFloatArrayAsync(3,!0);_color=_this.initClass(AntimatterAttribute,colorBuffer,3),shader||(shader=_proton.shader),shader.addUniforms({tColor:{value:_color}}),_proton.behavior.addInput("tColor",_color)},this.applyToShader=function(shader){shader.uniforms.tLife=_proton.shader.uniforms.tLife,_velocity&&(shader.uniforms.tVelocity={value:_velocity}),_color&&(shader.uniforms.tColor={value:_color})},this.ready=function(){return this.wait("canEmit")},this.get("total",(_=>_total)),this.get("index",(_=>_index)),this.set("index",(i=>_index=i))})),Class((function AntimatterUtil(){Inherit(this,Component);var _thread,_this=this,_promises={};function createBufferArrayAntimatter(e,id){let size=e.size,num=e.num,position=new Float32Array(size*size*3);if(window.NativeUtils)NativeUtils.fillBufferUV(position,num,size);else{let h=.5/size;for(let i=0;i<num;i++)position[3*i+0]=h+i%size/size,position[3*i+1]=h+Math.floor(i/size)/size,position[3*i+2]=i}let{w:w,h:h,d:d}=e.dimensions,usedDepth=num/(size*size),grid=0==w[0]&&0==w[1]&&0==h[0]&&0==h[1];var vertices=new Float32Array(size*size*4);if(window.NativeUtils)grid?NativeUtils.fillBufferGrid(vertices,num,size,usedDepth):NativeUtils.fillBufferRange(vertices,num,w[0],w[1],h[0],h[1],d[0],d[1]);else for(let i=0;i<num;i++)grid?(vertices[4*i+0]=Math.range(i%size,0,size,-1,1),vertices[4*i+1]=Math.range(i/size,size*usedDepth*usedDepth,0,-1,1)):(vertices[4*i+0]=Math.random(w[0],w[1],10),vertices[4*i+1]=Math.random(h[0],h[1],10),vertices[4*i+2]=Math.random(d[0],d[1],10)),vertices[4*i+3]=1;var attribs=new Float32Array(size*size*4);if(window.NativeUtils)NativeUtils.fillBufferRandom(attribs,attribs.length);else for(let i=0;i<num;i++)attribs[4*i+0]=Math.random(0,1,10),attribs[4*i+1]=Math.random(0,1,10),attribs[4*i+2]=Math.random(0,1,10),attribs[4*i+3]=Math.random(0,1,10);resolve({geometry:position,vertices:vertices,attribs:attribs,usedDepth:usedDepth},id,[position.buffer,vertices.buffer,attribs.buffer])}function createFloatArrayAntimatter({size:size},id){let array=new Float32Array(size);resolve({array:array},id,[array.buffer])}this.cache=!0,this.createBufferArray=function(size,num,config={}){let key;if(_thread||function initThread(){_thread=!0,Thread.upload(createBufferArrayAntimatter),Thread.upload(createFloatArrayAntimatter)}(),_this.cache&&(key=`buffer_${JSON.stringify(config)}_${size}_${num}`,_promises[key]))return _promises[key];let promise=Promise.create();return key&&(_promises[key]=promise),Thread.shared().createBufferArrayAntimatter({size:size,num:num,dimensions:config}).then((data=>{data.attribs=new AntimatterAttribute(data.attribs,4),data.vertices=new AntimatterAttribute(data.vertices,4);let geometry=data.geometry;data.geometry=new Geometry,data.geometry.addAttribute("position",new GeometryAttribute(geometry,3)),data.geometry.addAttribute("random",new GeometryAttribute(data.attribs.buffer,4)),promise.resolve(data)})),promise},this.createFloatArray=function(size,freshCopy){if(freshCopy||!_this.cache)return Thread.shared().createFloatArrayAntimatter({size:size});if(_promises[`float_size${size}`])return _promises[`float_size${size}`];return _promises[`float_size${size}`]=Thread.shared().createFloatArrayAntimatter({size:size})}}),"static"),Class((function Audio3D(_options){Inherit(this,Component);const _this=this;var _bindingLabel;const _config=require("Audio3DConfig");function onVisibility(e){if(!_this.context||!GlobalAudio3D.blurs)return;let hasFocus="focus"===e.type;_this.context.visibilityMuted=!hasFocus,(_this.context.playing||_this.flag("wasPlaying"))&&(hasFocus?(_this.flag("wasPlaying",!1),_this.context.play()):(_this.flag("wasPlaying",!0),_this.context.pause()))}!function initContext(){_options||(_options={}),GlobalAudio3D.native?(window._al&&(_this.context=_this.initClass(Audio3DALBuffer)),window.AVFSound&&(_this.context=_this.initClass(Audio3DNBuffer,"AVF")),window.MPAudio&&(_options.stream?_this.context=_this.initClass(Audio3DNBuffer,"MP"):_this.context=_this.initClass(Audio3DNBuffer,"GVR"))):_options.fallback||GlobalAudio3D.fallback?_this.context=_this.initClass(Audio3DFallback):_options.positional&&GlobalAudio3D.resonanceAudio?_this.context=_this.initClass(Audio3DResonanceAudio):_options.simpleBuffer&&"ie"!==Device.system.browser?_this.context=_this.initClass(Audio3DWASimpleBuffer):!0!==_options.stream&&"ie"!==Device.system.browser?_this.context=_this.initClass(Audio3DWABuffer):_this.context=_this.initClass(Audio3DWAStream)}(),function initInterface(){for(let command of _config.commands)_this[command]=_this.context[command];for(let setter of _config.setters)_this.set(setter,(e=>{_this.context&&(_this.context[setter]=e)}));for(let getter of _config.getters)_this.get(getter,(_=>{if(_this.context)return _this.context[getter]}))}(),function addHandlers(){_this.events.sub(_this.context,Events.END,(e=>_this.events.fire(Events.END,e))),_this.events.sub(_this.context,Events.LOADED,(e=>_this.events.fire(Events.LOADED,e))),_this.events.sub(Events.VISIBILITY,onVisibility)}(),function initOptions(){if(_options){for(let option in _options)_config.setters.includes(option)&&(_this.context[option]=_options[option]);_options.label&&(_bindingLabel=GlobalAudio3D.getLabelState(_options.label).bind("mute",(async bool=>{if(!_this.context)return _bindingLabel.destroy();_this.context.muted=bool})))}}(),this.tween=function(){return tween(_this,...arguments)},this.clone=function(){return new Audio3D(_options)},this.onDestroy=function(){_this.context.unload(),_bindingLabel?.destroy?.()}})),Class((function Audio3DLayer(...args){Inherit(this,Component);const _this=this;var _group,_input,_mesh,_audio3D,_config,_key,_autoplay,_volume={value:0},_captionsSetup="undefined"!=typeof CaptionsController;async function fadeIn(){_this.flag("init")||await _this.wait("init");let captionsPath=_config.get("captions");_captionsSetup&&captionsPath&&_config.get("enableCaptions")&&await async function loadCaptions(path){await CaptionsController.instance().load(path)}(captionsPath);let delay=_config.getNumber("delay");if(delay&&await _this.wait(delay),_audio3D.play(),_captionsSetup&&captionsPath&&_config.get("enableCaptions")&&toggleCaptions(!0),0!=_config.getNumber("fadeInTime")){_volume.value=0,_audio3D.volume=0;let volumeTween=tween(_volume,{value:_config.getNumber("volume")},_config.getNumber("fadeInTime"),"easeOutExpo");volumeTween.onUpdate((()=>{_audio3D.volume=_volume.value})),await volumeTween.promise()}}async function fadeOut(){if(_this.flag("init")||await _this.wait("init"),_captionsSetup&&_config.get("captions")&&_config.get("enableCaptions")&&toggleCaptions(!1),0!=_config.getNumber("fadeOutTime")){_volume.value=_config.getNumber("volume");let volumeTween=tween(_volume,{value:0},_config.getNumber("fadeOutTime"),"easeOutExpo",0);volumeTween.onUpdate((()=>{_audio3D.volume=_volume.value})),volumeTween.onComplete((()=>{_audio3D.context&&_audio3D.context.stream&&Audio3DWA.getActiveStreamCount(_audio3D.context.stream)>1||_audio3D.pause()})),await volumeTween.promise()}else{if(_audio3D.context&&_audio3D.context.stream&&Audio3DWA.getActiveStreamCount(_audio3D.context.stream)>1)return;_audio3D.pause()}}function toggleCaptions(bool=!1){bool?CaptionsController.instance().start():CaptionsController.instance().stop()}!function parseArgs(){args.forEach((arg=>{switch(Utils.getConstructorName(arg)){case"InputUILConfig":_input=arg;break;case"UILFolder":_group=arg;break;case"Mesh":_mesh=arg,_this.parent=_mesh,_mesh.audioCount?_mesh.audioCount++:_mesh.audioCount=1,_mesh.findSound||(_mesh.shader.visible=!1,_mesh.findSound=async function(key){if(!Array.isArray(_mesh.scriptClass))return _mesh.scriptClass;for(let scriptClass of _mesh.scriptClass)if(await scriptClass.key==key)return scriptClass})}})),_this.visible=_input.get("visible")}(),function initConfig(){let config=InputUIL.create(_input.prefix+"audio3dLayer"+(_mesh?_mesh.audioCount:""),_group);config.add("path").add("key").add("label").addToggle("autoplay",!1).addToggle("loop",!1).addToggle("stream",!1).addToggle("positional",!1).addNumber("volume",1).addNumber("rolloff",1).addNumber("fadeInTime",0).addNumber("fadeOutTime",0).addNumber("delay",0).addNumber("gain",1).setLabel("Audio"),config.addButton("preview",{label:"Preview",actions:[{title:"Play",callback:fadeIn},{title:"Stop",callback:fadeOut}]}),_captionsSetup&&config.add("captions").addToggle("enableCaptions",!1),config.onUpdate=key=>{if(_audio3D)switch(key){case"autoplay":case"loop":_audio3D[key]=_config.get(key);break;case"volume":case"rolloff":case"gain":_audio3D[key]=_config.getNumber(key)}},_config=config}(),async function initAudio(){GlobalAudio3D.initialized||await GlobalAudio3D.interacted,_key=_config.get("key"),_autoplay=_config.get("autoplay");let path=_config.get("path");if(path){_audio3D=_this.initClass(Audio3D,{src:path,autoplay:!1,volume:_config.getNumber("volume"),loop:_config.get("loop"),stream:_config.get("stream"),positional:_config.get("positional"),label:_config.get("label"),rolloff:_config.getNumber("rolloff")});let gain=_config.get("gain");"string"==typeof gain&&(gain=Number(gain)),isFinite(gain)&&(_audio3D.gain=gain),_mesh&&_mesh.add(_audio3D.group),_this.flag("init",!0)}}(),_this.startRender((()=>{})),this.get("audio",(()=>_audio3D)),this.play=async function(){await fadeIn()},this.stop=async function(){await fadeOut()},this.get("key",(async()=>(await _this.wait("init"),_key))),_this.set("volume",(volume=>{_audio3D.volume=volume})),_this.set("rolloff",(rolloff=>{_audio3D.rolloff=rolloff})),this.onVisible=async function(){_this.flag("init")||await _this.wait("init"),_audio3D&&_autoplay&&await fadeIn()},this.onInvisible=async function(){_this.flag("init")||await _this.wait("init"),_audio3D&&await fadeOut()}})),Class((function GlobalAudio3D(){Inherit(this,Component);const _this=this;var _volume=1,_muted=!1,_blurs=!0,_playbackRate=1,_poolSize=3,_interacted=Promise.create(),_labelStates={};function initInteraction(e){_this.initialized||(e&&e.preventDefault&&e.preventDefault(),document.removeEventListener(Device.mobile?"touchend":"mouseup",initInteraction,{passive:!1}),"undefined"!=typeof XRDeviceManager&&_this.events.unsub(XRDeviceManager.SESSION_START,initInteraction),Audio3DWA.createPool(_poolSize),Audio3DWA.purge(),_this.initialized=!0,_this.events.fire(Events.READY),_interacted.resolve())}this.native=!1,this.TRANSPARENT=0,this.ACOUSTIC_CEILING_TILES=1,this.BRICK_BARE=2,this.BRICK_PAINTED=3,this.CONCRETE_BLOCK_COARSE=4,this.CONCRETE_BLOCK_PAINTED=5,this.CURTAIN_HEAVY=6,this.FIBER_GLASS_INSULATION=7,this.GLASS_THICK=8,this.GLASS_THIN=9,this.GRASS=10,this.LINOLEUM_ON_CONCRETE=11,this.MARBLE=12,this.METAL=13,this.PARQUET_ON_CONCRETE=14,this.PLASTER_ROUGH=15,this.PLASTER_SMOOTH=16,this.PLYWOOD_PANEL=17,this.POLISHED_CONCRETE_OR_TILE=18,this.SHEET_ROCK=19,this.WATER_OR_ICE_SURFACE=20,this.WOOD_CEILING=21,this.WOOD_PANEL=22,this.LOW=0,this.MED=1,this.HIGH=2,this.RESONANCE_AUDIO="resonance_audio",this.quality=this.HIGH,async function(){await defer(),window.AURA&&function initNative(){_this.native=!0,!window._al||Audio3DAL.init();_this.initialized=!0,_interacted.resolve()}(),function initDebug(){Hydra.LOCAL&&Utils.query("audioDebug")&&(AudioNode.prototype.connect=(func=AudioNode.prototype.connect,function(){var target=arguments[0];return(this.outputs||(this.outputs=[])).push(arguments[0]),(target.inputs||(target.inputs=[])).push(this),func.apply(this,arguments)}));var func}()}(),this.set("volume",(v=>{_volume=v,_this.events.fire(Events.UPDATE,{volume:_volume})})),this.get("volume",(_=>_volume)),this.set("muted",(v=>{_muted=v,_this.events.fire(Events.UPDATE,{muted:_muted})})),this.get("muted",(_=>_muted)),this.set("blurs",(v=>{_blurs=v,_this.events.fire(Events.UPDATE,{blurs:_blurs})})),this.get("blurs",(_=>_blurs)),this.set("playbackRate",(v=>{_playbackRate=v,_this.events.fire(Events.UPDATE,{playbackRate:_playbackRate})})),this.get("playbackRate",(_=>_playbackRate)),this.get("pool",(_=>_poolSize)),this.set("pool",(n=>{_poolSize=n})),this.get("interacted",(_=>_interacted)),this.get("fallback",(_=>"ie"===Device.system.browser&&Device.system.browserVersion<=11||"ios"===Device.system.os&&Device.system.version>=13&&Device.system.version<13.6)),this.setup=function(type="default"){Utils.query("muted")&&Hydra.LOCAL&&(_muted=!0),document.addEventListener(Device.mobile?"touchend":"mouseup",initInteraction,{passive:!1}),"undefined"!=typeof XRDeviceManager&&_this.events.sub(XRDeviceManager.SESSION_START,initInteraction),"resonance_audio"!=type||_this.native||_this.fallback||(_this.resonanceAudio=!0,AssetLoader.loadAssets(["assets/js/lib/_resonance/resonance-audio.min.js"]))},this.ready=function(){return _this.wait(_this,"initialized")},this.enableRoom=function(bool){window.GVRAudio&&GVRAudio.enableRoom(bool)},this.setRoomProperties=function(x,y,z,wall,ceiling,floor){window.GVRAudio&&GVRAudio.setRoomProperties(x,y,z,wall,ceiling,floor)},this.setRoomReverbAdjustments=function(gain,time,brightness){window.GVRAudio&&GVRAudio.setRoomReverbAdjustments(gain,time,brightness)},this.muteLabel=function(label){_this.getLabelState(label).set("mute",!0)},this.unmuteLabel=function(label){_this.getLabelState(label).set("mute",!1)},this.getLabelState=function(label){return _labelStates[label]||(_labelStates[label]=AppState.createLocal()),_labelStates[label]}}),"static"),Module((function Audio3DConfig(){this.exports={getters:["playbackRate","loop","autoplay","volume","rolloff","preload","visibilityMuted","selfDestruct","src","frequency","group","duration","currentTime","activity","playing","filter","panner","delay","progress","reverb","gain","sourceWidth","directivitySharpness","directivityAlpha"],setters:["playbackRate","loop","autoplay","volume","rolloff","preload","visibilityMuted","selfDestruct","src","gain","sourceWidth","directivitySharpness","directivityAlpha"],commands:["play","pause","stop","seek","load","unload","convolve"]}})),Module((function Audio3DSilence(){this.exports="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAADAAAGhgBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr///////////////////////////////////////////8AAAA5TEFNRTMuOThyAc0AAAAAAAAAABSAJAiqQgAAgAAABobxtI73AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//uQxAACFEII9ACZ/sJZwWEoEb8w/////N//////JcxjHjf+7/v/H2PzCCFAiDtGeyBCIx7bJJ1mmEEMy6g8mm2c8nrGABB4h2Mkmn//4z/73u773R5qHHu/j/w7Kxkzh5lWRWdsifCkNAnY9Zc1HvDAhjhSHdFkHFzLmabt/AQxSg2wwzLhHIJOBnAWwVY4zrhIYhhc2kvhYDfQ4hDi2Gmh5KyFn8EcGIrHAngNgIwVIEMf5bzbAiTRoAD///8z/KVhkkWEle6IX+d/z4fvH3BShK1e5kmjkCMoxVmXhd4ROlTKo3iipasvTilY21q19ta30/v/0/idPX1v8PNxJL6ramnOVsdvMv2akO0iSYIzdJFirtzWXCZicS9vHqvSKyqm5XJBdqBwPxyfJdykhWTZ0G0ZyTZGpLKxsNwwoRhsx3tZfhwmeOBVISm3impAC/IT/8hP/EKEM1KMdVdVKM2rHV4x7HVXZvbVVKN/qq8CiV9VL9jjH/6l6qf7MBCjZmOqsAibjcP+qqqv0oxqpa/NVW286hPo1nz2L/h8+jXt//uSxCmDU2IK/ECN98KKtE5IYzNoCfbw+u9i5r8PoadUMFPKqWL4LK3T/LCraMSHGkW4bpLXR/E6LlHOVQxmslKVJ8IULktMN06N0FKCpHCoYsjC4F+Z0NVqdNFoGSTjSiyjzLdnZ2fNqTi2eHKONONKLMPMKLONKLMPQRJGlFxZRoKcJFAYEeIFiRQkUWUeYfef//Ko04soswso40UJAgMw8wosososy0EalnZyjQUGBRQGIFggOWUacWUeYmuadrZziQKKEgQsQLAhQkUJAgMQDghltLO1onp0cpkNInSFMqlYeSEJ5AHsqFdOwy1DA2sRmRJKxdKRfLhfLw5BzUxBTUUzLjk4LjJVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk4LjJVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7ksRRA8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU="})),Class((function Audio3DBase(){Inherit(this,Object3D);const _this=this;var _quaternion,_euler,_position=new Vector3;this.audioPosition=function(){return _position=_this.group._parent?_this.group.getWorldPosition():Audio3DWA.getCamera().getWorldPosition()},this.audioPositionInverse=function(){return _position=_this.audioPosition(),_this.group._parent&&_position.applyMatrix4(Audio3DWA.getCamera().matrixWorldInverse),_position},this.audioOrientationInverse=function(){return _quaternion||(_quaternion=new Quaternion,_euler=new Euler),_this.group.parent?(_this.group.getWorldQuaternion(_quaternion),_euler.setFromQuaternion(_quaternion)):_euler.set(0,0,0),_euler},this.listenerPosition=function(){return _this.group._parent&&(_position=Audio3DWA.getCamera().getWorldPosition()),_position}})),Class((function Audio3DFallback(){Inherit(this,Audio3DBase);const _this=this;var _stream,_options={},_settings={playing:!1,loaded:!1,loading:!1},_currentTime=0;function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.rolloff=_options.rolloff||1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.playbackRate=_this.playbackRate}function ready(){initOptions(),(_settings.autoplay||_options.autoplay)&&_this.play()}initOptions(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update),_this.events.sub(GlobalAudio3D,Events.READY,ready)}(),this.set("src",(src=>{_this.unload(),function destroyStream(){_stream&&_stream.element&&GlobalAudio3D.initialized&&(Audio3DWA.unloadStream(_settings.src),_stream=null)}(),_settings.src=src})),this.get("src",(_=>_settings.src)),this.set("volume",(v=>(v=Math.clamp(v,0,1),_options.volume=v,_stream&&_stream.element&&(_stream.element.volume=_options.muted||_options.globalMuted?0:v*Math.clamp(_options.globalVolume)),_options.volume))),this.get("volume",(_=>_options.volume)),this.set("loop",(l=>(l=!!l,_stream&&(_stream.element.loop=l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>_this.ready)),this.get("frequency",(_=>0)),this.get("activity",(_=>0)),this.get("playing",(_=>_settings.playing)),this.set("rolloff",(r=>{})),this.get("rolloff",(_=>0)),this.get("loaded",(_=>!0)),this.get("duration",(_=>_stream?_stream.element.duration:0)),this.get("currentTime",(_=>_stream?_stream.element.currentTime:0)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("progress",(_=>_this.currentTime/_this.duration)),this.set("playbackRate",(v=>{_options.playbackRate=v,_stream&&_stream.element&&(_stream.element.playbackRate=v*_options.globalPlaybackRate)})),this.get("playbackRate",(_=>_options.playbackRate)),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.play=function(){if(_settings.autoplay=!0,_settings.src&&GlobalAudio3D.initialized&&(function createStream(){!_stream&&GlobalAudio3D.initialized&&((_stream=Audio3DWA.loadStream(_settings.src)).element.onended=_=>{_this.unload(),_this.events.fire(Events.END)},_this.loop=_this.loop,_this.volume=_this.volume,_this.rolloff=_this.rolloff,_this.muted=_this.muted,(_options.autoplay||_settings.autoplay)&&_this.play())}(),!0!==_settings.playing&&(_settings.playing=!0,_this.volume=_options.volume,_stream))){_stream.element.playbackRate=_options.playbackRate,_stream.element.play();try{_stream.element.currentTime=_currentTime}catch(e){}}},this.pause=function(){if(_settings.autoplay=!1,_stream&&GlobalAudio3D.initialized&&_settings.src&&_settings.playing){try{_currentTime=_stream.element.currentTime}catch(e){}_stream.element.pause(),_settings.playing=!1}},this.stop=function(){if(_settings.autoplay=!1,_settings.src&&GlobalAudio3D.initialized&&(_currentTime=0,_settings.playing=!1,_stream&&_stream.element&&_stream.element.stop)){_stream.element.stop();try{_stream.element.currentTime=0}catch(e){}}},this.seek=function(time){if(_settings.src&&(_currentTime=time,_stream&&_stream.element))try{_stream.element.currentTime=time}catch(e){}},this.load=function(){return!0},this.unload=function(){_settings.autoplay=!1,_stream&&GlobalAudio3D.initialized&&_settings.src&&_this.stop()},this.convolve=function(src){}})),Class((function Audio3DN(){Inherit(this,Component);const _this=this;var _init;function loop(){window.GVRAudio&&(GVRAudio.setHeadPos(World.CAMERA.position.x,World.CAMERA.position.y,World.CAMERA.position.z),GVRAudio.setHeadRotation(World.CAMERA.quaternion.x,World.CAMERA.quaternion.y,World.CAMERA.quaternion.z,World.CAMERA.quaternion.w))}this.audioContext=function(){window.GVRAudio&&!_init&&(GVRAudio.initEngine(GlobalAudio3D.quality),_init=!0,_this.startRender(loop))}}),"static"),Class((function Audio3DNBuffer(_backingType){Inherit(this,Audio3DBase);const _this=this;var _backing,_options={},_settings={playing:!1,loaded:!1,loading:!1},_currentTime=0;function loop(){let pos,orientation;switch(_backingType){case"AVF":pos=_this.audioPositionInverse(),orientation=_this.audioOrientationInverse();break;case"GVR":pos=_this.audioPosition()}pos&&_backing&&(_backing.setPos(pos.x,pos.y,pos.z),orientation&&_backing.setOrientation(orientation.x,orientation.y,orientation.z,0,1,0))}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.playbackRate=_this.playbackRate}Audio3DN.audioContext(),function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.rolloff=_options.rolloff||1,_options.selfDestruct=_options.selfDestruct||!1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate}(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update)}(),this.set("src",(src=>{_this.stop(),_settings.src=src,defer((_=>{if(_options.autoplay)return _this.play();_options.preload&&_this.load(),_this.volume=_options.volume}))})),this.get("src",(_=>_settings.src)),this.get("selfDestruct",(_=>_options.selfDestruct)),this.set("selfDestruct",(d=>{_options.selfDestruct=d})),this.set("volume",(v=>(_options.volume=v,_backing&&_backing.volume(v),_options.volume))),this.get("volume",(_=>_options.volume)),this.set("loop",(l=>(l=!!l,_backing&&_backing.loop(l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>_this.ready)),this.get("frequency",(_=>[])),this.get("activity",(_=>0)),this.get("playing",(_=>_settings.playing)),this.set("rolloff",(r=>{_options.rolloff=r})),this.get("rolloff",(_=>_options.rolloff)),this.get("loaded",(_=>_settings.loaded)),this.get("currentTime",(_=>_currentTime)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("duration",(_=>0)),this.get("progress",(_=>_this.currentTime/_this.duration)),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.set("playbackRate",(v=>{_options.playbackRate=v,_backing&&_backing.setRate(v)})),this.get("playbackRate",(_=>_options.playbackRate)),this.play=async function(){_settings.autoplay=!0,_settings.src&&(_settings.loadingPlay=!0,_settings.loading||_settings.playing||(_settings.loaded||await _this.load(),_settings.playing=!0,_this.volume=_options.volume,_this.playbackRate=_options.playbackRate,_this.startRender(loop),_backing.seek(_currentTime),_backing.play(_options.loop)))},this.pause=function(){_settings.autoplay=!1,_settings.src&&_settings.loaded&&_settings.playing&&(_currentTime=_currentTime,_settings.loadingPlay=!1,_settings.playing=!1,_backing&&_backing.pause(),_this.stopRender(loop))},this.stop=function(){_settings.autoplay=!1,_settings.loaded&&(_currentTime=0,_backing&&_backing.stop(),_settings.playing=!1,_this.stopRender(loop))},this.seek=function(time){if(_settings.src){_settings.loadingPlay=!1;var wasPlaying=_settings.playing;_currentTime=time,_backing&&(_backing.seek(_currentTime),wasPlaying&&_backing.play())}},this.load=async function(){_settings.src&&(_settings.loading||_settings.loaded||(_settings.loading=!0,_this.ready=await function createBuffer(){let promise=Promise.create(),url=_settings.src;switch(url.includes("http")||(url=AURA.rootPath+url),_backingType){case"AVF":_backing=AVFSound.create(url);break;case"MP":_backing=new MPAudio(url);break;case"GVR":_backing=new GVRAudio(url)}return _backing.onComplete=_=>{_this.events.fire(Events.END),_options.selfDestruct&&_this.parent.destroy()},_backing.onUpdate=t=>{_currentTime=t},_backing.onReady=promise.resolve,promise}(),_this.events.fire(Events.LOADED),_settings.loadingPlay=!1,_settings.loading=!1,_settings.loaded=!0))},this.unload=function(){_settings.src&&_settings.loaded&&(_this.stop(),_backing.destroy())},this.convolve=async function(src){}})),Class((function Audio3DResonance(){Inherit(this,Component);const _this=this;require("Audio3DSilence");var _context,_resonance,_orientation,_cam;function loop(){(_cam=Audio3DWA.getCamera())&&_context&&_context.listener&&(_orientation.set(0,0,-1).applyQuaternion(_cam.quaternion),_resonance.setListenerOrientation(_orientation.x,_orientation.y,_orientation.z,_cam.up.x,_cam.up.y,_cam.up.z),_resonance.setListenerPosition(_cam.position.x,_cam.position.y,_cam.position.z))}this.createAudioInput=async function(url){_context||await _this.resonance();let audioElementSource,stream={};stream.element=Audio3DWA.getElement(),stream.element.crossOrigin="anonymous",stream.element.src=url,audioElementSource=stream.element.mediaSrc?stream.element.mediaSrc:_context.createMediaElementSource(stream.element),stream.element.mediaSrc=audioElementSource;let source=_resonance.createSource();return audioElementSource.connect(source.input),stream.source=source,stream},this.unloadStream=function(stream){stream.element.mediaSrc.disconnect(stream.source.input),Audio3DWA.putElement(stream.element)},this.resonance=async function(refresh){return window.ResonanceAudio||await AssetLoader.waitForLib("ResonanceAudio"),await GlobalAudio3D.ready(),_context&&!refresh||(_context&&(_context.close(),_context=null),_orientation=new Vector3,"running"!==(_context=Audio3DWA.audioContext()).state&&_context.resume(),(_resonance=new ResonanceAudio(_context)).output.connect(_context.destination),Render.start(loop)),_resonance},this.setRoomProperties=function(dimensions,materials){_resonance.setRoomProperties(dimensions,materials)},this.get("initialized",(()=>!!_context))}),"static"),Class((function Audio3DResonanceAudio(){Inherit(this,Audio3DBase);const _this=this;var _stream,_options={},_settings={playing:!1,loaded:!1,loading:!1},_orientation=new Vector3,_currentTime=0;function loop(){let pos;if(pos=_this.audioPosition(),pos&&_stream){_stream.source.setPosition(pos.x,pos.y,pos.z);let euler=_this.audioOrientationInverse();_orientation.set(0,0,-1).applyEuler(euler),_stream.source.setOrientation(_orientation.x,_orientation.y,_orientation.z,_this.group.up.x,_this.group.up.y,_this.group.up.z)}}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.gain=_this.gain,_this.playbackRate=_this.playbackRate}function handleEnded(){_this.unload(),_this.events.fire(Events.END)}!async function(){Audio3DResonance.initialized||await Audio3DResonance.resonance(),function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.rolloff=_options.rolloff||1,_options.selfDestruct=_options.selfDestruct||!1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_options.gain="number"==typeof _options.gain?_options.gain:ResonanceAudio.Utils.DEFAULT_SOURCE_GAIN,_options.sourceWidth="number"==typeof _options.sourceWidth?_options.sourceWidth:ResonanceAudio.Utils.DEFAULT_SOURCE_WIDTH,_options.directivitySharpness="number"==typeof _options.directivitySharpness?_options.directivitySharpness:ResonanceAudio.Utils.DEFAULT_DIRECTIVITY_SHARPNESS,_options.directivityAlpha="number"==typeof _options.directivityAlpha?_options.directivityAlpha:ResonanceAudio.Utils.DEFAULT_DIRECTIVITY_ALPHA}(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update)}()}(),this.set("src",(src=>{_this.stop(),_settings.src=src,defer((_=>{if(_options.autoplay)return _this.play();_options.preload&&_this.load(),_this.volume=_this.volume,_this.gain=_this.gain}))})),this.get("src",(_=>_settings.src)),this.get("selfDestruct",(_=>_options.selfDestruct)),this.set("selfDestruct",(d=>{_options.selfDestruct=d})),this.set("volume",(v=>(_options.volume=v,_stream&&(_stream.element.volume=_options.muted||_options.globalMuted?0:v*Math.clamp(_options.globalVolume)),_options.volume))),this.get("volume",(_=>_options.volume)),this.get("gain",(()=>_options.gain)),this.set("gain",(v=>{_options.gain=v,_stream&&_stream.source.setGain(_options.gain*Math.max(1,_options.globalVolume))})),this.set("loop",(l=>(l=!!l,_stream&&(_stream.element.loop=l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>_this.ready)),this.get("frequency",(_=>[])),this.get("activity",(_=>0)),this.get("playing",(_=>_settings.playing)),this.set("rolloff",(r=>{_options.rolloff=r})),this.get("rolloff",(_=>_options.rolloff)),this.get("loaded",(_=>_settings.loaded)),this.get("currentTime",(_=>_currentTime)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("duration",(_=>_stream?_stream.element.duration:0)),this.get("progress",(_=>_this.currentTime/_this.duration)),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.set("playbackRate",(v=>{_options.playbackRate=v})),this.get("playbackRate",(_=>_options.playbackRate)),this.get("sourceWidth",(()=>_options.sourceWidth)),this.set("sourceWidth",(v=>{_options.sourceWidth=v,_stream&&_stream.source.setSourceWidth(_options.sourceWidth)})),this.get("directivitySharpness",(()=>_options.directivitySharpness)),this.set("directivitySharpness",(v=>{_options.directivitySharpness=v,_stream&&_stream.source.setDirectivityPattern(_options.directivityAlpha,_options.directivitySharpness)})),this.get("directivityAlpha",(()=>_options.directivityAlpha)),this.set("directivityAlpha",(v=>{_options.directivityAlpha=v,_stream&&_stream.source.setDirectivityPattern(_options.directivityAlpha,_options.directivitySharpness)})),this.play=async function(){_settings.autoplay=!0,_settings.src&&(_settings.loadingPlay=!0,_settings.loading||_settings.playing||(_settings.loaded||await _this.load(),_settings.playing=!0,_this.volume=_options.volume,_this.playbackRate=_options.playbackRate,_this.startRender(loop),_stream.element.currentTime=_currentTime,_stream.element.play()))},this.pause=function(){_settings.autoplay=!1,_settings.src&&_settings.loaded&&_settings.playing&&(_currentTime=_currentTime,_settings.loadingPlay=!1,_settings.playing=!1,_stream&&_stream.element.pause(),_this.stopRender(loop))},this.stop=function(){_settings.autoplay=!1,_settings.loaded&&(_currentTime=0,_stream&&(_stream.element.pause(),_stream.element.currentTime=0),_settings.playing=!1,_this.stopRender(loop))},this.seek=function(time){if(_settings.src){_settings.loadingPlay=!1;var wasPlaying=_settings.playing;_currentTime=time,_stream&&(_stream.element.seek(_currentTime),wasPlaying&&_stream.element.play())}},this.load=async function(){_settings.src&&(_settings.loading||_settings.loaded||(_settings.loading=!0,_this.ready=await async function createBuffer(){let promise=Promise.create(),url=_settings.src;return(_stream=await Audio3DResonance.createAudioInput(url)).element.addEventListener("ended",handleEnded),_this.loop=_this.loop,_this.volume=_this.volume,_this.rolloff=_this.rolloff,_this.muted=_this.muted,_this.gain=_this.gain,_this.sourceWidth=_this.sourceWidth,_this.directivitySharpness=_this.directivitySharpness,_this.directivityAlpha=_this.directivityAlpha,_stream.element.currentTime=_currentTime,_stream.element.volume=_this.volume,_stream.element.onloadeddata=promise.resolve,_stream.element.load(),(_options.autoplay||_settings.autoplay)&&_this.play(),promise}(),_this.events.fire(Events.LOADED),_settings.loadingPlay=!1,_settings.loading=!1,_settings.loaded=!0))},this.unload=function(){_settings.src&&_settings.loaded&&(_this.stop(),function destroyStream(){_stream&&(_settings.loaded=!1,_stream.element.removeEventListener("ended",handleEnded),Audio3DResonance.unloadStream(_stream),_stream=null)}())}})),Class((function Audio3DWA(){Inherit(this,Component);const _this=this,_silence=require("Audio3DSilence");var _context,_orientation,_cam,_pool,_streams={},_buffers={};function loop(){(_cam=_this.getCamera())&&_cam.getWorldQuaternion&&_context&&_context.listener&&(_orientation.set(0,0,-1).applyQuaternion(_cam.getWorldQuaternion()),_context.listener.forwardX?(_context.listener.forwardX.setValueAtTime(_orientation.x,_context.currentTime),_context.listener.forwardY.setValueAtTime(_orientation.y,_context.currentTime),_context.listener.forwardZ.setValueAtTime(_orientation.z,_context.currentTime),_context.listener.upX.setValueAtTime(_cam.up.x,_context.currentTime),_context.listener.upY.setValueAtTime(_cam.up.y,_context.currentTime),_context.listener.upZ.setValueAtTime(_cam.up.z,_context.currentTime)):(_context.listener.setOrientation&&_context.listener.setOrientation(_orientation.x,_orientation.y,_orientation.z,_cam.up.x,_cam.up.y,_cam.up.z),_context.listener.setPosition&&_context.listener.setPosition(_cam.position.x,_cam.position.y,_cam.position.z),_context.listener.setVelocity&&_context.listener.setVelocity(0,0,0)))}function createAudioElement(){let audio;return GlobalAudio3D.fallback?(audio=document.createElement("audio"),audio.style.visibility="hidden",document.body.appendChild(audio),audio.source=document.createElement("source"),audio.appendChild(audio.source),audio.setAttribute("controls",""),audio.source.setAttribute("src",_silence),audio.source.setAttribute("type","audio/mp3"),audio.play()):(audio=new Audio,audio.src=_silence,audio.play().catch((e=>{}))),audio}this.createPool=function(n=10){_pool=_this.initClass(ObjectPool,createAudioElement,n),_this.flag("init",!0)},this.audioContext=function(refresh){return _context&&!refresh||(_context&&(_context.close(),_context=null),_orientation=new Vector3,(_context=new(window.AudioContext||window.webkitAudioContext)({sampleRate:48e3})).dest=_context.createMediaStreamDestination(),Render.start(loop)),_context},this.unloadBuffer=function(url){_buffers[url]&&delete _buffers[url]},this.loadBuffer=async function(url){if(!_buffers[url]){_buffers[url]={loaded:Promise.create(),data:null};var response=await fetch(url),buffer=await response.arrayBuffer();_this.audioContext().decodeAudioData(buffer,(data=>{_buffers[url].data=data,_buffers[url].loaded.resolve()}))}return await _buffers[url].loaded,_buffers[url].data},this.unloadStream=function(url){_streams[url]&&(_streams[url].stream.element.src=_silence,_streams[url].stream.element.load(),_streams[url].count--,_pool.put(_streams[url].stream.element),0==_streams[url].count&&defer((_=>{delete _streams[url]})))},this.loadStream=function(url){let isElement="string"!=typeof url&&void 0!==url,element=null;if(isElement&&(element=url,url=element.src?element.src:element.srcObject?element.srcObject.id:""),!_streams[url]){let stream={};_streams[url]={stream:null,count:0},isElement?(stream.element=element,element.setAttribute("muted",!0),element.muted=!0):(stream.element=_this.getElement(),stream.element.crossOrigin="anonymous",stream.element.src=url),GlobalAudio3D.fallback?stream.element.setAttribute("src",url):(stream.element.mediaSrc?stream.source=stream.element.mediaSrc:stream.element.srcObject?(stream.source=_this.audioContext().createMediaStreamSource(stream.element.srcObject),(new Audio).srcObject=element.srcObject):stream.source=_this.audioContext().createMediaElementSource(stream.element),stream.element.mediaSrc=stream.source),isElement||stream.element.load(),_streams[url].stream=stream}return _streams[url].count++,_streams[url].stream},this.getActiveStreamCount=function(stream){for(let key in _streams)if(_streams[key].stream==stream)return _streams[key].count;return-1},this.purge=function(){for(let stream in _streams)_this.unloadStream(stream);for(let buffer in _buffers)_this.unloadBuffer(buffer)},this.getElement=function(){return _pool||_this.createPool(),_pool.get()},this.putElement=function(audio){audio.src=_silence,audio.load(),_pool.put(audio)},this.useCamera=function(camera){_this.CAMERA=camera},this.getCamera=function(){return _this.CAMERA||(_this.CAMERA=World.CAMERA),_this.CAMERA}}),"static"),Class((function Audio3DWABuffer(){Inherit(this,Audio3DBase);const _this=this;var _context,_buffer,_stream,_gain,_panner,_analyser,_filter,_delay,_convolver,_position,_frequency,_convolution,_options={},_settings={playing:!1,loaded:!1,loading:!1},_currentTime=0;function loop(){_context&&(_position=_context.listener.forwardX?_this.audioPosition().sub(_this.listenerPosition()):_this.audioPosition(),_panner.setPosition(_position.x,_position.y,_position.z))}function initContext(){GlobalAudio3D.initialized&&(_context=Audio3DWA.audioContext(),_gain=_context.createGain?_context.createGain():_context.createGainNode(),_panner=_context.createPanner(),(_filter=_context.createBiquadFilter()).type="lowshelf",_filter.frequency.value=0,_filter.gain.value=1,_analyser=_context.createAnalyser(),(_delay=_context.createDelay(10)).delayTime.value=0,_analyser.fftSize=32,_frequency=new Uint8Array(_analyser.frequencyBinCount),_analyser.connect(_context.destination),_delay.connect(_analyser),_filter.connect(_delay),_convolver?(_convolver.connect(_filter),_gain.connect(_convolver)):_gain.connect(_filter),_panner.connect(_gain))}function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.rolloff=_options.rolloff||1,_options.selfDestruct=_options.selfDestruct||!1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate}function destroyBuffer(){if(_buffer&&_stream){_settings.loaded=!1;try{_stream.disconnect(_panner),_convolver?(_convolver.disconnect(_filter),_gain.disconnect(_convolver)):_gain.disconnect(_filter),_analyser.disconnect(_context.destination),_buffer.stop(),_buffer=null,Audio3DWA.unloadBuffer(_settings.src)}catch(e){}}}async function createStream(){_stream||((_stream=_context.createBufferSource()).buffer=_buffer.buffer,_stream.loop=_options.loop,_stream.playbackRate=_options.playbackRate,_stream.onended=_=>{_this&&_this.stop&&(_this.stop(),_this.events.fire(Events.END),_options.selfDestruct&&_this.parent.destroy())},_this.volume=_this.volume,_this.rolloff=_this.rolloff,_this.muted=_this.muted,_stream.connect(_panner),_stream.start(0,_currentTime))}function destroyStream(){if(_stream)try{_stream.disconnect(_panner),_stream.stop(),_stream=null}catch(e){}}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.playbackRate=_this.playbackRate}function ready(){destroyBuffer(),destroyStream(),_context=null,_gain=null,_panner=null,_analyser=null,_delay=null,_frequency=null,_filter=null,initContext(),initOptions(),_convolution&&_this.convolve(_convolution),(_options.autoplay||_settings.autoplay)&&_this.play()}!async function(){initContext(),initOptions(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update),_this.events.sub(GlobalAudio3D,Events.READY,ready)}()}(),this.set("src",(src=>{_this.stop(),_settings.src=src,defer((_=>{if(_options.autoplay)return _this.play();_options.preload&&_this.load(),_this.volume=_options.volume}))})),this.get("src",(_=>_settings.src)),this.get("selfDestruct",(_=>_options.selfDestruct)),this.set("selfDestruct",(d=>{_options.selfDestruct=d})),this.set("volume",(v=>(_options.volume=v,_gain&&(_gain.gain.value=_options.muted||_options.globalMuted?0:v*_options.globalVolume),_options.volume))),this.get("volume",(_=>_options.volume)),this.set("loop",(l=>(l=!!l,_stream&&(_stream.loop=l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>_this.ready)),this.get("frequency",(_=>_analyser?(_analyser.getByteFrequencyData(_frequency),_frequency):[])),this.get("activity",(_=>_analyser?(_analyser.getByteFrequencyData(_frequency),Math.clamp(_frequency.slice(3,13).reduce(((n1,n2)=>n1+n2),0)/2560,0,1)):0)),this.get("playing",(_=>_settings.playing)),this.set("rolloff",(r=>{_options.rolloff=r,_panner&&(_panner.rolloffFactor=r)})),this.get("rolloff",(_=>_options.rolloff)),this.get("loaded",(_=>_settings.loaded)),this.get("currentTime",(_=>_context&&_buffer?_context.currentTime%_buffer.buffer.duration:0)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.set("playbackRate",(v=>{_options.playbackRate=v,_stream&&(_stream.playbackRate.value=v*_options.globalPlaybackRate)})),this.get("playbackRate",(_=>_options.playbackRate)),this.get("filter",(_=>_filter)),this.get("delay",(_=>_delay)),this.get("panner",(_=>_panner)),this.get("duration",(_=>_buffer?_buffer.buffer.duration:0)),this.get("progress",(_=>_this.currentTime/_this.duration)),this.play=async function(){_settings.autoplay=!0,_settings.src&&GlobalAudio3D.initialized&&(_settings.loadingPlay=!0,_stream||_settings.loading||_settings.playing||(_settings.loaded||await _this.load(),await createStream(),_settings.playing=!0,_this.volume=_options.volume,_this.startRender(loop)))},this.pause=function(){_settings.autoplay=!1,_stream&&GlobalAudio3D.initialized&&_settings.src&&_settings.loaded&&_settings.playing&&(_currentTime=_context.currentTime,destroyStream(),_settings.loadingPlay=!1,_settings.playing=!1,_this.stopRender(loop))},this.stop=function(){_settings.autoplay=!1,_settings.src&&GlobalAudio3D.initialized&&_settings.loaded&&(_currentTime=0,destroyStream(),_settings.loading=!1,_settings.loaded=!1,_settings.loadingPlay=!1,_settings.playing=!1,_this.stopRender(loop))},this.seek=function(time){if(_settings.src){_settings.loadingPlay=!1;var wasPlaying=_settings.playing;_this.stop(),_currentTime=time,wasPlaying&&_this.play()}},this.load=async function(){_settings.src&&(_settings.loading||_settings.loaded||(_settings.loading=!0,_this.ready=await async function createBuffer(){GlobalAudio3D.initialized||await GlobalAudio3D.ready(),_context||await defer(),(_buffer=_context.createBufferSource()).buffer=await Audio3DWA.loadBuffer(_settings.src),_settings.loaded=!0}(),await createStream(),_options.autoplay||_settings.loadingPlay||destroyStream(),_this.events.fire(Events.LOADED),_settings.loadingPlay=!1,_settings.loading=!1,_settings.loaded=!0))},this.unload=function(){_settings.src&&_settings.loaded&&(_this.stop(),destroyBuffer())},this.convolve=async function(src){if(_convolution=src,!GlobalAudio3D.initialized)return;if(!1===src)return void(_convolver&&(_convolver.disconnect(),_gain.disconnect(),_gain.connect(_filter),_convolver=null));let buffer=await Audio3DWA.loadBuffer(src);_convolver||(_convolver=_context.createConvolver(),_gain.disconnect(),_convolver.connect(_filter),_gain.connect(_convolver)),_convolver.buffer=buffer}})),Class((function Audio3DWASimpleBuffer(){Inherit(this,Audio3DBase);const _this=this;var _context,_buffer,_stream,_gain,_options={},_settings={playing:!1,loaded:!1,loading:!1},_currentTime=0;function initContext(){GlobalAudio3D.initialized&&(_context=Audio3DWA.audioContext(),(_gain=_context.createGain?_context.createGain():_context.createGainNode()).connect(_context.destination))}function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.selfDestruct=_options.selfDestruct||!1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate}function destroyBuffer(){_buffer&&_stream&&(_settings.loaded=!1,_stream.disconnect(_gain),_gain.disconnect(_context.destination),_buffer.stop(),_buffer=null,Audio3DWA.unloadBuffer(_settings.src))}async function createStream(){!_stream&&GlobalAudio3D.initialized&&((_stream=_context.createBufferSource()).buffer=_buffer.buffer,_stream.loop=_options.loop,_stream.playbackRate=_options.playbackRate,_stream.onended=_=>{_this.stop(),_this.events.fire(Events.END),_options.selfDestruct&&_this.parent.destroy()},_this.volume=_this.volume,_this.rolloff=_this.rolloff,_this.muted=_this.muted,_stream.connect(_gain),_stream.start(0,_currentTime))}function destroyStream(){_stream&&(_stream.disconnect(_gain),_stream.stop(),_stream=null)}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.playbackRate=_this.playbackRate}function ready(){destroyBuffer(),destroyStream(),_context=null,_gain=null,initContext(),initOptions(),(_options.autoplay||_settings.autoplay)&&_this.play()}initContext(),initOptions(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update),_this.events.sub(GlobalAudio3D,Events.READY,ready)}(),this.set("src",(src=>{_this.stop(),_settings.src=src,defer((_=>{if(_options.autoplay)return _this.play();_options.preload&&_this.load(),_this.volume=_options.volume}))})),this.get("src",(_=>_settings.src)),this.get("selfDestruct",(_=>_options.selfDestruct)),this.set("selfDestruct",(d=>{_options.selfDestruct=d})),this.set("volume",(v=>(_options.volume=v,_gain&&(_gain.gain.value=_options.muted||_options.globalMuted?0:v*_options.globalVolume),_options.volume))),this.get("volume",(_=>_options.volume)),this.set("loop",(l=>(l=!!l,_stream&&(_stream.loop=l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>_this.ready)),this.get("playing",(_=>_settings.playing)),this.get("loaded",(_=>_settings.loaded)),this.get("currentTime",(_=>_context&&_buffer?_context.currentTime%_buffer.buffer.duration:0)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.set("playbackRate",(v=>{_options.playbackRate=v,_stream&&(_stream.playbackRate.value=v*_options.globalPlaybackRate)})),this.get("playbackRate",(_=>_options.playbackRate)),this.get("duration",(_=>_buffer?_buffer.buffer.duration:0)),this.get("progress",(_=>_this.currentTime/_this.duration)),this.play=async function(){_settings.autoplay=!0,_settings.src&&GlobalAudio3D.initialized&&(_settings.loadingPlay=!0,_stream||_settings.loading||_settings.playing||(_settings.loaded||await _this.load(),await createStream(),_settings.playing=!0,_this.volume=_options.volume))},this.pause=function(){_settings.autoplay=!1,_stream&&GlobalAudio3D.initialized&&_settings.src&&_settings.loaded&&_settings.playing&&(_currentTime=_context.currentTime,destroyStream(),_settings.loadingPlay=!1,_settings.playing=!1)},this.stop=function(){_settings.autoplay=!1,_settings.src&&GlobalAudio3D.initialized&&_settings.loaded&&(_currentTime=0,destroyStream(),_settings.loading=!1,_settings.loaded=!1,_settings.loadingPlay=!1,_settings.playing=!1)},this.seek=function(time){if(_settings.src){_settings.loadingPlay=!1;var wasPlaying=_settings.playing;_stream&&(_stream.onended=null),_this.stop(),_currentTime=time,wasPlaying&&_this.play()}},this.load=async function(){_settings.src&&(_settings.loading||_settings.loaded||(_settings.loading=!0,_this.ready=await async function createBuffer(){GlobalAudio3D.initialized&&((_buffer=_context.createBufferSource()).buffer=await Audio3DWA.loadBuffer(_settings.src),_settings.loaded=!0)}(),await createStream(),_options.autoplay||_settings.loadingPlay||(_stream.onended=null,destroyStream()),_this.events.fire(Events.LOADED),_settings.loadingPlay=!1,_settings.loading=!1,_settings.loaded=!0))},this.unload=function(){_settings.src&&_settings.loaded&&(_this.stop(),destroyBuffer())},this.convolve=async function(src){}})),Class((function Audio3DWAStream(){Inherit(this,Audio3DBase);const _this=this;var _context,_stream,_gain,_panner,_analyser,_filter,_delay,_convolver,_position,_frequency,_convolution,_options={},_settings={playing:!1,loaded:!1,loading:!1},_currentTime=0;function loop(){_context&&(_position=_context.listener.forwardX?_this.audioPosition().sub(_this.listenerPosition()):_this.audioPosition(),_panner.setPosition(_position.x,_position.y,_position.z))}function initContext(){GlobalAudio3D.initialized&&(_context=Audio3DWA.audioContext(),_gain=_context.createGain?_context.createGain():_context.createGainNode(),_panner=_context.createPanner(),(_analyser=_context.createAnalyser()).fftSize=32,_frequency=new Uint8Array(_analyser.frequencyBinCount),(_filter=_context.createBiquadFilter()).type="lowshelf",_filter.frequency.value=0,_filter.gain.value=1,(_delay=_context.createDelay(10)).delayTime.value=0)}function initOptions(){_options.loop=_options.loop||!1,_options.autoplay=_options.autoplay||!1,_options.volume=void 0===_options.volume?1:_options.volume,_options.playbackRate=_options.playbackRate||1,_options.preload=_options.preload||!1,_options.muted=_options.muted||!1,_options.rolloff=_options.rolloff||1,_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate}function createStream(){_stream||((_stream=Audio3DWA.loadStream(_settings.src)).element.addEventListener("ended",handleEnded),_this.loop=_this.loop,_this.volume=_this.volume,_this.rolloff=_this.rolloff,_this.muted=_this.muted,_stream.source.connect(_panner),_panner.connect(_gain),_convolver?(_gain.connect(_convolver),_convolver.connect(_filter)):_gain.connect(_filter),_filter.connect(_delay),_delay.connect(_analyser),_analyser.connect(_context.destination),_stream.element.currentTime=_currentTime,(_options.autoplay||_settings.autoplay)&&_this.play())}function destroyStream(){_stream&&(_stream.element.removeEventListener("ended",handleEnded),_stream.source.disconnect(_panner),_stream=null)}function update(e){_options.globalMuted=GlobalAudio3D.muted,_options.globalVolume=GlobalAudio3D.volume,_options.globalPlaybackRate=GlobalAudio3D.playbackRate,_this.volume=_this.volume,_this.playbackRate=_this.playbackRate}function ready(){destroyStream(),_context=null,_gain=null,_panner=null,_analyser=null,_delay=null,_filter=null,_frequency=null,initContext(),initOptions(),_convolution&&_this.convolve(_convolution),(_settings.autoplay||_options.autoplay)&&_this.play()}function handleEnded(){_this.unload(),_this.events.fire(Events.END)}initOptions(),initContext(),function addListeners(){_this.events.sub(GlobalAudio3D,Events.UPDATE,update),_this.events.sub(GlobalAudio3D,Events.READY,ready)}(),this.set("src",(src=>{if(destroyStream(),_settings.src=src,_options.autoplay)return _this.play();_options.preload&&_this.load()})),this.get("src",(_=>_settings.src)),this.set("volume",(v=>(v=Math.clamp(v,0,1),_options.volume=v,_gain&&(_gain.gain.value=_options.muted||_options.globalMuted?0:v*_options.globalVolume),_options.volume))),this.get("volume",(_=>_options.volume)),this.set("loop",(l=>(l=!!l,_stream&&(_stream.element.loop=l),_options.loop=l))),this.get("loop",(_=>_options.loop)),this.set("autoplay",(autoplay=>{_options.autoplay=autoplay})),this.get("autoplay",(_=>_options.autoplay)),this.set("preload",(preload=>{_options.preload=preload})),this.get("preload",(_=>_options.preload)),this.get("ready",(_=>!!_stream)),this.get("frequency",(_=>(_analyser&&_analyser.getByteFrequencyData(_frequency),_frequency))),this.get("activity",(_=>_analyser?(_analyser.getByteFrequencyData(_frequency),Math.clamp(_frequency.slice(3,13).reduce(((n1,n2)=>n1+n2),0)/2560,0,1)):0)),this.get("playing",(_=>_settings.playing)),this.set("rolloff",(r=>{_options.rolloff=r,_panner&&(_panner.rolloffFactor=r)})),this.get("rolloff",(_=>_options.rolloff)),this.get("loaded",(_=>!0)),this.get("duration",(_=>_stream?_stream.element.duration:0)),this.get("currentTime",(_=>_stream?_stream.element.currentTime:0)),this.set("currentTime",(t=>{_this.seek(t)})),this.get("progress",(_=>_this.currentTime/_this.duration)),this.set("playbackRate",(v=>{_options.playbackRate=v,_stream&&_stream.element&&(_stream.element.playbackRate=v*_options.globalPlaybackRate)})),this.get("playbackRate",(_=>_options.playbackRate)),this.get("visibilityMuted",(_=>_options.muted)),this.set("visibilityMuted",(muted=>{!0===muted?_options.muteState=_options.muted:void 0!==_options.muteState&&(muted=_options.muteState,delete _options.muteState),_options.muted!==muted&&(_options.muted=muted,_this.volume=_this.volume)})),this.get("muted",(_=>_options.muted)),this.set("muted",(muted=>{_options.muted=muted,_this.volume=_this.volume})),this.get("filter",(_=>_filter)),this.get("delay",(_=>_delay)),this.get("panner",(_=>_panner)),this.play=function(){_settings.autoplay=!0,_settings.src&&(createStream(),_stream&&!0!==_settings.playing&&(_settings.playing=!0,_this.volume=_this.volume,_this.startRender(loop),_stream.element.playbackRate=_options.playbackRate?_options.playbackRate:1,_stream.element.play().catch((e=>{}))))},this.pause=function(){_settings.autoplay=!1,_stream&&_settings.src&&_settings.playing&&(_currentTime=_stream.element.currentTime,_stream.element.pause(),_settings.playing=!1,_this.stopRender(loop))},this.stop=function(){_settings.autoplay=!1,_settings.src&&(_currentTime=0,_settings.playing=!1,_this.stopRender(loop),_stream&&_stream.element&&_stream.element.stop&&(_stream.element.stop(),_stream.element.currentTime=0))},this.seek=function(time){_settings.src&&(_currentTime=time,_stream&&(_stream.element.currentTime=time))},this.load=function(){_settings.src&&(_settings.playing||(createStream(),_stream.element.load()))},this.unload=function(){_settings.autoplay=!1,_settings.src&&(_this.stop&&_this.stop(),destroyStream(),Audio3DWA.unloadStream(_settings.src))},this.convolve=async function(src){if(_convolution=src,!1===src)return void(_convolver&&(_convolver.disconnect(),_gain.disconnect(),_gain.connect(_analyser),_convolver=null));let buffer=await Audio3DWA.loadBuffer(src);_convolver||(_convolver=_context.createConvolver(),_gain.disconnect(),_convolver.connect(_analyser),_gain.connect(_convolver)),_convolver.buffer=buffer},this.get("stream",(_=>_stream))})),Class((function ImageDecoder(){Inherit(this,Component);var _ktx1Settings,_this=this;const ACTIVE=!(!(window.fetch&&window.createImageBitmap&&Device.system.browser.includes("chrome"))||window.AURA);function decodeImage(data,id){(async _=>{try{let e=await fetch(data.path,{mode:"cors"});if(200!=e.status)throw resolve({fail:!0},id),`Image not found :: ${data.path}`;let blob=await e.blob(),obj={imageOrientation:"flipY",crossOrigin:"anonymous"};data.params&&!1===data.params.premultiplyAlpha&&(obj.premultiplyAlpha="none"),obj.imageOrientation=data.params&&!1===data.params.flipY?void 0:"flipY";let bitmap=await createImageBitmap(blob,obj),message={post:!0,id:id,message:bitmap};self.postMessage(message,[bitmap])}catch(e){throw resolve({fail:`${data.path} could not be decoded: ${e.message||e}`},id),e}})()}function decodeKtx1CompressedImage(data,id){(async _=>{let ext;data.settings.dxt?ext="dxt":data.settings.etc?ext="astc":data.settings.pvrtc?ext="pvrtc":data.settings.astc&&(ext="astc");let fileName=data.path.split("/");fileName=fileName[fileName.length-1];let e=await fetch(`${data.path}/${fileName}-${ext}.ktx`);if(200!=e.status)throw`Image not found :: ${data.path}`;let arrayBuffer=await e.arrayBuffer(),header=new Int32Array(arrayBuffer,12,13),gliFormat=(header[1],header[2],header[3],header[4]),baseWidth=(header[5],header[6]),baseHeight=header[7],width=baseWidth,height=baseHeight,numberOfArrayElements=header[9],numberOfFaces=header[10],miplevels=header[11],buffers=[],compressedData=[],sizes=[],cube=6===numberOfFaces&&0===numberOfArrayElements,dataOffset=64+header[12];for(let level=0;level<miplevels;level++){let imageSize=new Int32Array(arrayBuffer,dataOffset,1)[0];dataOffset+=4,cube&&(imageSize*=6);let byteArray=new Uint8Array(arrayBuffer,dataOffset,imageSize);dataOffset+=imageSize,dataOffset+=3-(imageSize+3)%4,sizes.push(width),width=Math.max(1,.5*width),height=Math.max(1,.5*height);let clone=new Uint8Array(byteArray);compressedData.push(clone),buffers.push(clone.buffer)}resolve({gliFormat:gliFormat,compressedData:compressedData,sizes:sizes,width:baseWidth,height:baseHeight,cube:cube},id,buffers)})().catch((e=>{console.log(e.toString()),resolve({fail:`${data.path} could not be decoded: ${e.message||e}`},id)}))}function findDominantColors(e,id){let imageData=e.imageData;(async _=>{try{let threshold=40/255,colors=[];for(let i=0;i<imageData.length;i+=4){let r=imageData[i+0]/255,g=imageData[i+1]/255,b=imageData[i+2]/255,color=new Color(r,g,b);if(0==i)colors.push([color,1]);else{let below=colors.filter((data=>{let c=data[0];return Math.pow(c.r-r,2)+Math.pow(c.g-g,2)+Math.pow(c.b-b,2)<threshold*threshold}));if(0==below.length)colors.push([color,1]);else{let closestColor=below.sort(((a,b)=>{let d1=a[0];d1=Math.pow(d1.r-r,2)+Math.pow(d1.g-g,2)+Math.pow(d1.b-b,2);let d2=b[0];return d2=Math.pow(d2.r-r,2)+Math.pow(d2.g-g,2)+Math.pow(d2.b-b,2),d1-d2}))[0][0];closestColor=colors.filter((el=>el[0].equals(closestColor))),closestColor=closestColor[0];let index=colors.indexOf(closestColor);colors[index][1]++}}}let l=Math.floor(colors.length/8),c=[colors[0][0],colors[1*l][0],colors[2*l][0],colors[3*l][0]];resolve({colors:c},id)}catch(e){throw resolve({fail:!0},id),e}})()}this.scale=1,async function(){await Hydra.ready(),Thread.upload(decodeImage),Thread.upload(findDominantColors),Thread.upload(decodeKtx1CompressedImage)}(),this.decode=async function(path,params={}){let fallback=Thread.absolutePath(Assets.getPath("assets/images/_scenelayout/uv.jpg"));if(path=Thread.absolutePath(Assets.getPath(path)),void 0===_ktx1Settings){_ktx1Settings={dxt:!!Renderer.extensions.s3tc,etc:!!Renderer.extensions.etc1,pvrtc:!!Renderer.extensions.pvrtc,astc:!!Renderer.extensions.astc};let found=!1;for(let key in _ktx1Settings)!0===_ktx1Settings[key]&&(found=!0);found||(_ktx1Settings=null)}let compressedIdentifier=/-compressedKtx2?/.exec(path)?.[0],compressed=!!compressedIdentifier&&(compressedIdentifier.endsWith("2")?"ktx2":"ktx1");if((Utils.query("noKtx")||!_ktx1Settings&&"ktx1"===compressed)&&(path=path.replace(compressedIdentifier,""),compressed=!1),/\.ktx2(?:\?|#|$)/.test(path)&&(compressed="ktx2",Utils.query("noKtx")&&(params.uncompressed=!0)),compressed){try{let bitmap;if(path=path.substring(0,path.lastIndexOf(".")),bitmap="ktx1"===compressed?await Thread.shared().decodeKtx1CompressedImage({path:path,params:params,settings:_ktx1Settings}):await Ktx2Transcoder.transcode({path:`${path}.ktx2`,params:params}),!bitmap.fail)return bitmap}catch(e){}return _this.decode(fallback,params)}{let getBitmap=(path,params)=>ACTIVE?Thread.shared().decodeImage({path:path,params:params}):Assets.decodeImage(path,params);try{let bitmap=await getBitmap(path,params);if(bitmap.fail&&(bitmap=await getBitmap(fallback,params),bitmap.fail))throw"could not decode "+path;return function process(bitmap,scale){if(1==scale*_this.scale)return bitmap;let pow2=Math.isPowerOf2(bitmap.width,bitmap.height),canvas=document.createElement("canvas");return canvas.context=canvas.getContext("2d"),canvas.width=Math.round(bitmap.width*_this.scale*scale),canvas.height=Math.round(bitmap.height*_this.scale*scale),pow2&&scale*_this.scale<1&&(canvas.width=canvas.height=Math.floorPowerOf2(Math.max(canvas.width,canvas.height))),canvas.context.drawImage(bitmap,0,0,canvas.width,canvas.height),canvas}(bitmap,params.scale||1)}catch(e){throw"could not decode "+path}}},this.parseColors=async function(imageData){return await Thread.shared().findDominantColors({imageData:imageData})}}),"static"),Class((function Ktx2Transcoder(){Inherit(this,Component);const _this=this;var _transcoderReady,_basisAssets=["~assets/js/lib/basis_transcoder.js","~assets/js/lib/basis_transcoder.wasm"].map(Assets.getPath).map(Thread.absolutePath);async function initBasisTranscoder(){if(_transcoderReady)await _transcoderReady;else{_transcoderReady=Promise.create();let[js,wasmBinary]=await Promise.all(_basisAssets.map((async(path,i)=>{let response=await fetch(path);return 0===i?response.text():response.arrayBuffer()}))),formats=function getSupportedFormats(){let supported={astc:!!Renderer.extensions.astc,etc1:!!Renderer.extensions.etc1,etc2:!!Renderer.extensions.etc,dxt:!!Renderer.extensions.s3tc,bptc:!!Renderer.extensions.bptc,pvrtc:!!Renderer.extensions.pvrtc,uncompressed:!0};Renderer.type===Renderer.WEBGL2&&(supported.etc1=!1);let formats={};return Object.keys(supported).filter((id=>supported[id])).forEach((id=>{let format={id:id,needsPowerOfTwo:!1};switch(formats[id]=format,id){case"astc":format.gliFormat=[Renderer.extensions.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,Renderer.extensions.astc.COMPRESSED_RGBA_ASTC_4x4_KHR];break;case"bptc":format.gliFormat=[Renderer.extensions.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,Renderer.extensions.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT];break;case"dxt":format.gliFormat=[Renderer.extensions.s3tc.COMPRESSED_RGB_S3TC_DXT1_EXT,Renderer.extensions.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT];break;case"etc2":format.gliFormat=[Renderer.extensions.etc.COMPRESSED_RGB8_ETC2,Renderer.extensions.etc.COMPRESSED_RGBA8_ETC2_EAC];break;case"etc1":format.gliFormat=[Renderer.extensions.etc.COMPRESSED_RGB_ETC1_WEBGL];break;case"pvrtc":format.gliFormat=[Renderer.extensions.pvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,Renderer.extensions.pvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG],format.needsPowerOfTwo=!0;break;case"uncompressed":format.gliFormat=[Renderer.context.RGBA,Renderer.context.RGBA]}})),formats}(),threads=Thread.shared(!0).array;await Promise.all(threads.map((async thread=>{thread.importCode(js),thread.loadFunction(initKtx2TranscoderThread),thread.loadFunction((function transcodeKtx2(){})),await thread.initKtx2TranscoderThread({wasmBinary:wasmBinary,formats:formats})}))),_transcoderReady.resolve(),_this.flag("transcoderLoaded",!0)}}function initKtx2TranscoderThread(e,id){var _formats;async function transcodeKtx2({path:path,params:params},id){let ktx2File;try{let response=await fetch(path);if(200!==response.status)throw new Error(`Image not found :: ${path}`);let arrayBuffer=await response.arrayBuffer();if(ktx2File=new BasisModule.KTX2File(new Uint8Array(arrayBuffer)),!ktx2File.isValid())throw new Error("Invalid or unsupported .ktx2 file");let basisFormat=ktx2File.isUASTC()?"uastc":"etc1s",baseWidth=ktx2File.getWidth(),baseHeight=ktx2File.getHeight(),layers=ktx2File.getLayers()||1,levels=ktx2File.getLevels(),faceCount=ktx2File.getFaces(),hasAlpha=ktx2File.getHasAlpha(),premultiplyAlpha=!!(1&ktx2File.getDFDFlags()),{transcoderFormat:transcoderFormat,gliFormat:gliFormat,uncompressed:uncompressed}=function getTranscoderFormat(basisFormat,width,height,hasAlpha,params){let format;format=params.uncompressed?_formats.uncompressed:_formats[basisFormat].find((format=>!(hasAlpha&&format.transcoderFormat.length<2||format.needsPowerOfTwo&&!Math.isPowerOf2(width,height))));let uncompressed="uncompressed"===format.id;uncompressed&&!params.uncompressed&&console.warn("No suitable compressed texture format found. Decoding to RGBA32.");let which=hasAlpha?1:0;return{transcoderFormat:format.transcoderFormat[which],gliFormat:format.gliFormat[which],uncompressed:uncompressed}}(basisFormat,baseWidth,baseHeight,hasAlpha,params);if(!baseWidth||!baseHeight||!levels)throw new Error("Invalid texture");if(layers>1)throw new Error("Array textures not implemented");if(!ktx2File.startTranscoding())throw new Error("startTranscoding failed");let buffers=[],compressedData=[],sizes=[],cube=6===faceCount;for(let level=0;level<levels;level++){let width,height,data,faces=[];for(let faceIndex=0;faceIndex<faceCount;++faceIndex){let levelInfo=ktx2File.getImageLevelInfo(level,0,faceIndex);width=levelInfo.origWidth,height=levelInfo.origHeight;let data=new Uint8Array(ktx2File.getImageTranscodedSizeInBytes(level,0,faceIndex,transcoderFormat));if(!ktx2File.transcodeImage(data,level,0,faceIndex,transcoderFormat,0,-1,-1))throw new Error("transcodeImage failed");faces.push(data)}if(faces.length>1){let totalLength=0;faces.forEach((face=>{totalLength+=face.byteLength})),data=new Uint8Array(totalLength);let offset=0;faces.forEach((face=>{data.set(face,offset),offset+=face.byteLength}))}else data=faces[0];compressedData.push(data),buffers.push(data.buffer),sizes.push({width:width,height:height})}resolve({gliFormat:gliFormat,compressedData:compressedData,sizes:sizes,width:baseWidth,height:baseHeight,cube:cube,premultiplyAlpha:premultiplyAlpha,uncompressed:uncompressed},id,buffers)}catch(e){console.log(e.toString()),resolve({fail:`${path} could not be decoded: ${e.message||e}`},id)}finally{ktx2File&&(ktx2File.close(),ktx2File.delete())}}var BasisModule={wasmBinary:e.wasmBinary,onRuntimeInitialized:function(){BasisModule.initializeBasis(),function initFormats(formats){Object.keys(formats).forEach((id=>{let format=formats[id];switch(id){case"astc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFASTC_4x4_RGBA.value,BasisModule.transcoder_texture_format.cTFASTC_4x4_RGBA.value];break;case"bptc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFBC7_RGBA.value,BasisModule.transcoder_texture_format.cTFBC7_RGBA.value];break;case"dxt":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFBC1_RGB.value,BasisModule.transcoder_texture_format.cTFBC3_RGBA.value];break;case"etc2":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFETC1_RGB.value,BasisModule.transcoder_texture_format.cTFETC2_RGBA.value];break;case"etc1":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFETC1_RGB.value];break;case"pvrtc":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFPVRTC1_4_RGB.value,BasisModule.transcoder_texture_format.cTFPVRTC1_4_RGBA.value];break;case"uncompressed":format.transcoderFormat=[BasisModule.transcoder_texture_format.cTFRGBA32.value,BasisModule.transcoder_texture_format.cTFRGBA32.value]}})),_formats={uastc:[formats.astc,formats.bptc,formats.etc2,formats.etc1,formats.dxt,formats.pvrtc,formats.uncompressed].filter(Boolean),etc1s:[formats.etc2,formats.etc1,formats.bptc,formats.dxt,formats.pvrtc,formats.uncompressed].filter(Boolean),uncompressed:formats.uncompressed}}(e.formats),self.transcodeKtx2=transcodeKtx2,delete self.initKtx2TranscoderThread,resolve(id)}};BASIS(BasisModule)}_this.transcode=async function({path:path,params:params}){_this.flag("transcoderLoaded")||await initBasisTranscoder();let result=await Thread.shared().transcodeKtx2({path:path,params:params});if(result.fail)throw new Error(result.fail);return result}}),"static"),Class((function BaseCamera(_input,_group){Inherit(this,Object3D);const _this=this;var _debugCamera,_type="perspective";function resize(){if(_this.overrideResize)"function"==typeof _this.overrideResize&&_this.overrideResize();else switch(_type){case"perspective":_this.camera.aspect=Stage.width/Stage.height,_this.camera.updateProjectionMatrix();break;case"orthographic":if(_this.width||_this.height)_this.camera.setViewport(_this.width,_this.height);else{let m=900/Stage.height/100;_this.camera.setViewport(Stage.width*m,Stage.height*m)}}}this.camera=new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),this.group.add(this.camera),this.playgroundLock=function(camera=Camera.instance()){if(!Global.PLAYGROUND)return;Utils.getConstructorName(_this.parent).includes(Global.PLAYGROUND.split("/")[0])&&RenderManager.type==RenderManager.NORMAL&&camera.lock(_this.camera)},this.lock=function(camera=Camera.instance()){if("orthographic"==_type&&!camera.worldCamera.isOrthographicCamera)return console.error("You can't lock an orthographic camera to the main camera. Use an FXScene .setCamera");RenderManager.type==RenderManager.NORMAL&&camera.lock(_this.camera)},this.transition=function(time,ease,delay,camera=Camera.instance()){"object"==typeof delay&&(camera=delay,delay=0);let p=Promise.create();return camera.transition(_this.camera,time,ease,delay||0),_this.delayedCall((_=>p.resolve()),time+(delay||0)),p},this.manualTransition=function(camera=Camera.instance()){return camera.manualTransition(_this.camera)},this.setFOV=function(fov){"orthographic"!==_type&&fov!=this.camera.fov&&(this.camera.fov=fov,this.camera.updateProjectionMatrix())},this.getFOV=function(){return this.camera.fov},this.useOrthographic=function(w,h){"orthographic"!==_type&&(isNaN(w)||(this.width=w),isNaN(h)||(this.height=h),this.camera&&this.group.remove(this.camera),this.camera=new OrthographicCamera,this.group.add(this.camera),this.camera.position.z=1,_type="orthographic",resize())},this.usePerspective=function(){"perspective"!==_type&&(this.camera&&this.group.remove(this.camera),this.camera=new PerspectiveCamera,this.group.add(this.camera),_type="perspective",resize())},this.useCurve=function(curve){return _this.camera.curve=curve,this},_this.get("zoom",(()=>_this.camera.zoom)),_this.set("zoom",(zoom=>{_this.camera.zoom=zoom,_this.camera.updateProjectionMatrix()})),_this.get("near",(()=>_this.camera.near)),_this.set("near",(near=>{_this.camera.near=near,_this.camera.updateProjectionMatrix()})),_this.get("far",(()=>_this.camera.far)),_this.set("far",(far=>{_this.camera.far=far,_this.camera.updateProjectionMatrix()})),function init(){if(_this.startRender((_=>{if(_this.group.updateMatrixWorld(!0),_debugCamera&&_debugCamera.visible){Utils3D.decompose(_this.camera,_debugCamera);let viewportHeight,active=AppState.get("playground_camera_active");viewportHeight=active.isOrthographicCamera?(active.top-active.bottom)/active.zoom:Utils3D.getHeightFromCamera(active,_this.camera.position.distanceTo(active.position)),_debugCamera.scale.setScalar(.025*viewportHeight/.1)}})),_this.onResize(resize),_input){_this.prefix=_input.prefix;let cameraUIL=CameraUIL.add(_this,_group);cameraUIL.setLabel("Camera"),_this.group._cameraUIL=cameraUIL}Global.PLAYGROUND&&AppState.bind("playground_camera_active",(active=>{_this.group._parent&&(active?(_debugCamera||((_debugCamera=new Mesh(new BoxGeometry(.1,.1,.2),new Shader("DebugCamera",{uColor:{value:new Color("#ffffff")},transparent:!0,depthTest:!1}))).renderOrder=9999,_this.delayedCall((_=>_this.group._parent.add(_debugCamera)),50)),_debugCamera.visible=!0):_debugCamera&&(_debugCamera.visible=!1))}))}()})),Class((function Camera(_worldCamera){Inherit(this,Component);const _this=this;var _prevCamera,_lockCamera,_curve,_manual,_scheduleSlot,_calc=new Vector3,_target=new Group,_anim={weight:0,weight2:0},_cameraTarget=(new Vector3,new Group),_cameraTarget2=new Group;function loop(){_scheduleSlot||render()}function render(){if(_manual&&(_anim.weight2=_manual.value),_anim.weight+=(_anim.weight2-_anim.weight)*_this.lerp,_prevCamera){if(_prevCamera.updateMatrixWorld(),_lockCamera.updateMatrixWorld(),_curve){_curve.lerpPos||(_curve.lerpPos=(new Vector3).copy(_prevCamera.getWorldPosition())),_curve.lerpOffset||(_curve.lerpOffset=(new Vector3).copy(_curve.getPointAt(1)).multiplyScalar(-2).add(_lockCamera.getWorldPosition()));let pos=_calc.copy(_curve.getPointAt(_anim.weight)).add(_curve.lerpOffset).add(_lockCamera.getWorldPosition());_curve.lerpPos.lerp(pos,_curve.lerp||1,!1),_target.position.copy(_curve.lerpPos),_anim.weight>=1&&(_curve=_curve.lerpPos=_curve.lerpOffset=null,_this.onCurveComplete&&_this.onCurveComplete())}else _target.position.copy(_prevCamera.getWorldPosition()).lerp(_lockCamera.getWorldPosition(),_anim.weight,!1);_target.quaternion.copy(_prevCamera.getWorldQuaternion()).slerp(_lockCamera.getWorldQuaternion(),_anim.weight,!1);let needsUpdate=!1,zoom=Math.mix(_prevCamera.zoom,_lockCamera.zoom,_anim.weight);_worldCamera.zoom!==zoom&&(_worldCamera.zoom=zoom,needsUpdate=!0);let fov=!_worldCamera.isOrthographicCamera&&Math.mix(_prevCamera.fov,_lockCamera.fov,_anim.weight);fov&&_worldCamera.fov!==fov&&(_worldCamera.fov=fov,needsUpdate=!0);let near=Math.mix(_prevCamera.near,_lockCamera.near,_anim.weight);_worldCamera.near!==near&&(_worldCamera.near=near,needsUpdate=!0);let far=Math.mix(_prevCamera.far,_lockCamera.far,_anim.weight);_worldCamera.far!==far&&(_worldCamera.far=far,needsUpdate=!0),needsUpdate&&_worldCamera.updateProjectionMatrix(),_cameraTarget.position.lerp(_target.position,_this.lerp2,!1),_cameraTarget.quaternion.slerp(_target.quaternion,_this.lerp2,!1)}else if(_lockCamera){_lockCamera.updateMatrixWorld(),Utils3D.decompose(_lockCamera,_cameraTarget);let needsUpdate=!1;_lockCamera.zoom&&_worldCamera.zoom!=_lockCamera.zoom&&(_worldCamera.zoom=_lockCamera.zoom,needsUpdate=!0),_worldCamera.isOrthographicCamera||_worldCamera.fov==_lockCamera.fov||(_worldCamera.fov=_lockCamera.fov,needsUpdate=!0),_worldCamera.near!==_lockCamera.near&&(_worldCamera.near=_lockCamera.near,needsUpdate=!0),_worldCamera.far!==_lockCamera.far&&(_worldCamera.far=_lockCamera.far,needsUpdate=!0),needsUpdate&&_worldCamera.updateProjectionMatrix()}_cameraTarget2.position.lerp(_cameraTarget.position,_this.finalLerp,!1),_cameraTarget2.quaternion.slerp(_cameraTarget.quaternion,_this.finalLerp,!1),_worldCamera.position.lerp(_cameraTarget2.position,_this.finalLerp,!1),_worldCamera.quaternion.slerp(_cameraTarget2.quaternion,_this.finalLerp,!1),_worldCamera.updateMatrixWorld(),RenderManager.fire(_this)}this.lerp=1,this.lerp2=1,this.worldCamera=_worldCamera,this.finalLerp=1,this.multiTween=!0,function(){if(RenderManager.type!=RenderManager.NORMAL)return _worldCamera=void 0,void(_this.worldCamera=_worldCamera);_worldCamera.controllingCamera=_this,_this.startRender(loop,RenderManager.AFTER_LOOPS)}(),this.lock=function(camera,scheduleSlot){camera instanceof Camera?(scheduleSlot=camera,camera=camera.worldCamera):camera.controllingCamera&&(scheduleSlot=camera.controllingCamera),_lockCamera=camera,_prevCamera=null,_worldCamera&&(_scheduleSlot&&_this.stopRender(render,_scheduleSlot),(_scheduleSlot=scheduleSlot)&&_this.startRender(render,_scheduleSlot),_lockCamera.zoom&&(_worldCamera.zoom=_lockCamera.zoom),_worldCamera.isOrthographicCamera||(_worldCamera.fov=_lockCamera.fov),_worldCamera.updateProjectionMatrix(),render())},this.transition=function(camera,duration=1e3,ease="easeInOutCubic",scheduleSlotOrDelay){let delay,scheduleSlot;return"number"==typeof scheduleSlotOrDelay?delay=scheduleSlotOrDelay:scheduleSlotOrDelay&&(scheduleSlot=scheduleSlotOrDelay),camera instanceof Camera?(scheduleSlot=camera,camera=camera.worldCamera):camera.controllingCamera&&(scheduleSlot=camera.controllingCamera),_curve&&(_curve=_curve.lerpPos=_curve.lerpOffset=null),camera.curve&&((_curve=camera.curve).lerpPos=camera.lerpPos),_prevCamera===camera?(duration*=.5*Math.smoothStep(.5,1,_anim.weight)+.5,_anim.weight=1-_anim.weight):_anim.weight=0,_manual=void 0,scheduleSlot&&_worldCamera&&(_scheduleSlot&&_this.stopRender(render,_scheduleSlot),_scheduleSlot=scheduleSlot,_this.startRender(render,_scheduleSlot)),_anim.weight2=_anim.weight,_prevCamera=_lockCamera,_lockCamera=camera,tween(_anim,{weight2:1},duration,ease,delay)},this.manualTransition=function(camera){return this.transition(camera).stop(),_manual={value:0}},this.setPrevCamera=function(camera){_prevCamera=camera.camera||camera},this.get("worldCamera",(_=>_worldCamera)),this.get("lockCamera",(_=>_lockCamera)),this.set("debugScale",(s=>{undefined})),this.createLocal=function(camera){return camera||(camera=World.CAMERA.clone(),_this.onResize((_=>{camera.aspect=Stage.width/Stage.height,camera.updateProjectionMatrix()}))),new Camera(camera.camera||camera)}}),"singleton"),Class((function GazeCamera(_input,_group){Inherit(this,BaseCamera);const _this=this;var _strength={v:1},_cacheObj={},_move=new Vector3,_position=new Vector3,_wobble=new Vector3,_rotation=0,_wobbleAngle=Math.radians(Math.rand(0,360)),_innerGroup=new Group,_viewportFocusOffset=new Vector3,_hasViewportFocusOffset=!1,_manualRender=!1,_quaternion=new Quaternion;const V3_ZERO=new Vector3(0);function loop(){if(_hasViewportFocusOffset&&_this.camera.position.sub(_viewportFocusOffset),_this.useAccelerometer&&Mobile.Accelerometer&&Mobile.Accelerometer.connected)_move.x=_this.position.x+Math.range(Mobile.Accelerometer.x,-2,2,-1,1,!0)*_strength.v*_this.moveXY.x*_this.strength,_move.y=_this.position.y;else{_move.x=_this.position.x+Math.range(Mouse.x,0,Stage.width,-1,1,!0)*_strength.v*_this.moveXY.x*_this.strength,_move.y=_this.position.y+Math.range(Mouse.y,0,Stage.height,-1,1,!0)*_strength.v*_this.moveXY.y*_this.strength;let rotateStrength=Math.range(Math.abs(Mouse.delta.x)/Stage.width,0,.02,0,1,!0);_rotation=Math.lerp(Math.radians(_this.deltaRotate)*rotateStrength*Math.sign(Mouse.delta.x),_rotation,.02*_this.deltaLerp*_strength.v),_innerGroup.rotation.z=Math.lerp(_rotation,_innerGroup.rotation.z,.07*_this.deltaLerp)}if(_move.z=_this.position.z,_position.lerp(_move,_this.lerpSpeed2),_position.z+=_this.zoomOffset,_this.camera.position.lerp(_position,_this.lerpSpeed),_this.camera.lookAt(_this.lookAt),(Math.abs(_this.cameraRotation.x)>Base3D.DIRTY_EPSILON||Math.abs(_this.cameraRotation.y)>Base3D.DIRTY_EPSILON||Math.abs(_this.cameraRotation.z)>Base3D.DIRTY_EPSILON)&&(_quaternion.setFromEuler(_this.cameraRotation),_this.camera.quaternion.multiply(_quaternion)),function focusViewport(){let nextHasViewportFocusOffset=Math.abs(_this.viewportFocus.x)>1e-4||Math.abs(_this.viewportFocus.y)>1e-4;nextHasViewportFocusOffset!==_hasViewportFocusOffset&&(nextHasViewportFocusOffset||_viewportFocusOffset.setScalar(0),_hasViewportFocusOffset=nextHasViewportFocusOffset);if(!_hasViewportFocusOffset)return;let localCamera=_cacheObj,camera=_this.camera;camera.matrixDirty&&camera.updateMatrix();localCamera.matrixWorld=camera.matrix,localCamera.projectionMatrix=camera.projectionMatrix,_viewportFocusOffset.copy(_this.lookAt).project(localCamera),_viewportFocusOffset.x-=_this.viewportFocus.x,_viewportFocusOffset.y-=_this.viewportFocus.y,_viewportFocusOffset.unproject(localCamera),_viewportFocusOffset.sub(_this.lookAt),_this.camera.position.add(_viewportFocusOffset)}(),_this.wobbleStrength>0){let t=Render.TIME;_wobble.x=Math.cos(_wobbleAngle+t*(75e-5*_this.wobbleSpeed))*(_wobbleAngle+200*Math.sin(t*(95e-5*_this.wobbleSpeed))),_wobble.y=Math.sin(Math.asin(Math.cos(_wobbleAngle+t*(85e-5*_this.wobbleSpeed))))*(150*Math.sin(_wobbleAngle+t*(75e-5*_this.wobbleSpeed))),_wobble.x*=2*Math.sin(_wobbleAngle+t*(75e-5*_this.wobbleSpeed)),_wobble.y*=1.75*Math.cos(_wobbleAngle+t*(65e-5*_this.wobbleSpeed)),_wobble.x*=1.1*Math.cos(_wobbleAngle+t*(75e-5*_this.wobbleSpeed)),_wobble.y*=1.15*Math.sin(_wobbleAngle+t*(25e-5*_this.wobbleSpeed)),_wobble.z=Math.sin(_wobbleAngle+.0025*_wobble.x)*(100*_this.wobbleZ),_wobble.multiplyScalar(.001*_this.wobbleStrength*_strength.v),_innerGroup.position.lerp(_wobble,.07),_this.flag("hasWobble",!0)}else _this.flag("hasWobble")&&(_innerGroup.position.lerp(V3_ZERO,.07),_innerGroup.position.length()<.001&&(_innerGroup.position.set(0,0,0),_this.flag("hasWobble",!1)))}this.strength=1,this.moveXY=new Vector2(4,4),this.position=new function Position(){Inherit(this,Component);var _x=0,_y=0,_z=0;this.get("x",(_=>_x)),this.get("y",(_=>_y)),this.get("z",(_=>_z)),this.set("x",(x=>{_x=x})),this.set("y",(y=>{_y=y})),this.set("z",(z=>{_z=z,_move.z=_z,_this.camera.position.copy(_move),_position.copy(_move)})),this.set=function(x,y,z,noCopy){_x=x,_y=y,_z=z,_move.z=z,noCopy||_this.camera.position.copy(_move),_position.copy(_move)},this.toArray=function(){return[_x,_y,_z]},this.fromArray=function(array){_x=array[0],_y=array[1],_z=array[2],_move.set(_x,_y,_z),_this.camera.position.copy(_move),_position.copy(_move)},this.copy=function(vec){_x=vec.x,_y=vec.y,_z=vec.z,_move.set(_x,_y,_z),_this.camera.position.copy(_move),_position.copy(_move)}},this.lerpSpeed=.05,this.lerpSpeed2=1,this.lookAt=new Vector3(0,0,0),this.cameraRotation=new Euler,this.viewportFocus=new Vector2(0,0),this.deltaRotate=0,this.deltaLerp=1,this.wobbleSpeed=1,this.wobbleStrength=0,this.wobbleZ=1,this.zoomOffset=0,function(){if(_input){_this.prefix=_input.prefix;let cameraUIL=CameraUIL.add(_this,_group);cameraUIL.setLabel("Camera"),_this.group._cameraUIL=cameraUIL}_this.startRender(loop),_innerGroup.add(_this.camera),_this.group.add(_innerGroup)}(),this.orbit=function(time=1e3,ease="easeInOutSine"){return tween(_strength,{v:1},time,ease)},this.still=function(time=300,ease="easeInOutSine"){return tween(_strength,{v:0},time,ease)};var _v1=new Vector3,_v2=new Vector3,_v3=new Vector3;this.move=function(vec){let moveDiff=_v1.subVectors(_move,_this.position),positionDiff=_v2.subVectors(_move,_position),cameraPosDiff=_v3.subVectors(_this.camera.position,_position);_this.position.set(vec.x,vec.y,vec.z,!0),_move.copy(vec).add(moveDiff),_position.copy(_move).add(positionDiff),_this.camera.position.copy(_position).add(cameraPosDiff)},this.get("manualRender",(()=>_manualRender)),this.set("manualRender",(value=>{(value=!!value)!==_manualRender&&((_manualRender=value)?_this.stopRender(loop):_this.startRender(loop))})),this.update=function(){_manualRender||!Hydra.LOCAL||_this.flag("manualRenderWarned")||(console.warn("Set manualRender to true if using GazeCamera.update()"),_this.flag("manualRenderWarned",!0)),loop()}}));class Base3D{constructor(){this.position=new Vector3D,this.rotation=new Euler,this.quaternion=new Quaternion,this.scale=new Vector3D(1,1,1),this._parent=null,this.up=new Vector3(0,1,0),this.isObject3D=!0,this.children=[],this.childrenLength=0,this.modelViewMatrix=new Matrix4,this.normalMatrix=new Matrix3,this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.matrixDirty=!0,this.decomposeDirty=!0,this.visible=!0,this.hidden=!1,this.castShadow=!1,this.frustumCulled=!0,this.occlusionCulled=!1,this._renderOrder=0,this.worldPos=new Vector3,this.worldQuat=new Quaternion;const _this=this;this.quaternion.onChange((_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty(),_this.rotation.setFromQuaternion(_this.quaternion,void 0,!1)})),this.rotation.onChange((_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty(),_this.quaternion.setFromEuler(_this.rotation,!1)})),this.scale.onChange((_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty()})),this.position.onChange((_=>{_this.matrixDirty=!0,_this.decomposeDirty=!0,_this.onMatrixDirty&&_this.onMatrixDirty()}))}get renderOrder(){return this._renderOrder}set renderOrder(value){this._renderOrder=value;let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent;for(let i=0;i<this.children.length;i++)this.children[i].renderOrder+=value}applyMatrix(matrix){return this.matrix.multiplyMatrices(matrix,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale),this}applyQuaternion(q){return this.quaternion.premultiply(q),this}setRotationFromAxisAngle(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)}setRotationFromMatrix(m){this.quaternion.setFromRotationMatrix(m)}setRotationFromQuaternion(q){this.quaternion.copy(q)}localToWorld(v){return v.applyMatrix4(this.matrixWorld)}worldToLocal(v){let m1=this.M1||new Matrix4;return this.M1=m1,v.applyMatrix4(m1.getInverse(this.matrixWorld))}lookAt(x,y,z){let m1=this.M1||new Matrix4;this.M1=m1;let v=this.V1||new Vector3;this.V1=v,x.isVector3?v.copy(x):v.set(x,y,z),this.isCamera?m1.lookAt(this.position,v,this.up):m1.lookAt(v,this.position,this.up),this.quaternion.setFromRotationMatrix(m1)}add(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}if(object===this)return this;if(object&&object.isObject3D?(null!==object._parent&&object._parent.remove(object),object._parent=this,this.children.push(object),this.childrenLength=this.children.length):console.error("Object is not instance of Object3D",object),this.isScene)this.displayNeedsUpdate=!0;else{let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent}return this}attach(object){this.updateMatrixWorld(!0);let m1=this.M1||new Matrix4;this.M1=m1;const worldInverse=this.M1.getInverse(this.matrixWorld);null!==object._parent&&(object._parent.updateMatrixWorld(!0),worldInverse.multiply(object._parent.matrixWorld)),object.applyMatrix(worldInverse),this.add(object),object.updateMatrixWorld(!0)}remove(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}if(this.isScene)this.displayNeedsUpdate=!0;else{let p=this._parent;for(;p;)p instanceof Scene&&(p.displayNeedsUpdate=!0),p=p._parent}this.children.remove(object),this.childrenLength=this.children.length}getWorldPosition(target){let v=this.V1||new Vector3;return this.V1=v,target||(target=v),this.updateMatrixWorld(),target.setFromMatrixPosition(this.matrixWorld)}getWorldScale(target){let v=this.V1S||new Vector3;this.V1S=v;let v2=this.V12||new Vector3;this.V2=v2;let q=this.Q1||new Quaternion;return this.Q1=q,target||(target=v2),this.updateMatrixWorld(),this.matrixWorld.decompose(v,q,target),target}getWorldQuaternion(target){let v=this.V1Q||new Vector3;this.V1Q=v;let q=this.Q1||new Quaternion;return this.Q1=q,target||(target=q),this.updateMatrixWorld(),this.matrixWorld.decompose(v,target,v),target}traverse(callback){callback(this);let children=this.children;for(let i=0;i<children.length;i++)children[i].traverse(callback)}updateMatrix(){!1!==this.matrixAutoUpdate&&(this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0)}updateMatrixWorld(force){if(!1===this.matrixAutoUpdate)return;if(!force&&!this.determineVisible())return;(this.determineDirty()||force)&&!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==force||(null===this._parent||this.determineNoTransform()?this.matrixWorld.copy(this.matrix):(this.matrixWorld.multiplyMatrices(this._parent.matrixWorld,this.matrix),RenderStats.active&&RenderStats.update("updateMatrixWorld")),this.decomposeDirty=!0,this.matrixWorldNeedsUpdate=!1);for(let i=this.childrenLength-1;i>-1;i--)this.children[i].updateMatrixWorld(force);this.matrixDirty=!1}clone(recursive){(new this.constructor).copy(this,recursive)}copy(source,recursive){if(this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,!0===recursive)for(let i=0;i<source.children.length;i++){let child=source.children[i];this.add(child.clone())}return this}render(){}determineVisible(){if(!this.visible)return!1;let p=this._parent;for(;p;){if(!p.visible)return!1;p=p._parent}return!0}determineDirty(){let p=this._parent;for(;p;){if(p.matrixDirty)return!0;p=p._parent}return this.matrixDirty}determineNoTransform(){return this._parent?this._parent.determineNoTransform()&&this.matrix.isIdentity():this.matrix.isIdentity()}translateX(distance){this.xAxis||(this.xAxis=new Vector3(1,0,0)),this.translateOnAxis(this.xAxis,distance)}translateY(distance){this.yAxis||(this.yAxis=new Vector3(0,1,0)),this.translateOnAxis(this.yAxis,distance)}translateZ(distance){this.zAxis||(this.zAxis=new Vector3(0,0,1)),this.translateOnAxis(this.zAxis,distance)}translateOnAxis(axis,distance){let v=this.V1||new Vector3;return this.V1=v,v.copy(axis).applyQuaternion(this.quaternion),this.position.add(v.multiplyScalar(distance)),this}upload(){this.shader&&(this.shader.upload(this,this.geometry),this.shader.shadow&&this.shader.shadow.upload(this,this.geometry)),this.geometry&&this.geometry.upload(this,this.shader)}destroy(){this.geometry&&this.geometry.destroy&&this.geometry.destroy(this),this.shader&&this.shader.destroy&&this.shader.destroy(this),this.hitDestroy&&this.hitDestroy(),this._gl&&this._gl.ubo&&this._gl.ubo.destroy(),this._gl&&this._gl.vao&&this._gl.vao.destroy(),this._gl&&(this._gl=null),this._parent&&this._parent.remove(this),this.parent&&this.parent.__destroyChild&&this.parent.__destroyChild(this.__id)}}Base3D.DIRTY_EPSILON=1e-4,Class((function Renderer(_params={}){Inherit(this,Component);const _this=this;var _canvas,_gl,_width,_height,_anisotropy,_clearColor,_projScreenMatrix,_frustum,_ubo,_dpr=1,_resolution=new Vector2,_m0=new Matrix4,_m1=new Matrix4,_time={value:0},_stencilActive=!1;function initCameraUBO(camera){camera._ubo=new UBO(0,_gl),camera._ubo.push({value:camera.projectionMatrix}),camera._ubo.push({value:camera.matrixWorldInverse}),camera._ubo.push({value:camera.worldPos}),camera._ubo.push({value:camera.worldQuat}),camera._ubo.push({value:_resolution}),camera._ubo.push(_time),camera._ubo.push(Render.timeScaleUniform),camera._ubo.upload()}function sortFrontToBack(array,sortOrder,camera){for(let i=array.length-1;i>-1;i--){let obj=array[i];obj.__sortVec||(obj.__sortVec=new Vector3),sortOrder==Scene.FRONT_TO_BACK_BOUNDING&&obj.geometry&&obj.geometry.boundingSphere?obj.__sortVec.copy(obj.geometry.boundingSphere.center):obj.__sortVec.setFromMatrixPosition(camera.modelViewMatrix)}array.sort(((a,b)=>b.__sortVec.z-a.__sortVec.z))}function projectObject(object,camera,scene){if(object.isOcclusionMesh&&scene.displayNeedsUpdate&&scene.toRender[0].push(object),object.doNotProject)return;let isVisible=!1;if(void 0!==object.shader){let visible=object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&!object.hidden;visible&&(object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),null!==object._occlusionMesh&&object.isMesh&&(object.updateOcclusionMesh(),object._occlusionMesh.matrixWorld.copy(object.matrixWorld),object._occlusionMesh.normalMatrix.copy(object.normalMatrix),object._occlusionMesh.modelViewMatrix.copy(object.modelViewMatrix))),isVisible=visible,(scene.displayNeedsUpdate||object.shader.transparent&&!scene.disableAutoSort&&visible)&&object.getWorldPosition(object.worldPos),scene.displayNeedsUpdate&&scene.toRender[object.shader.transparent?1:0].push(object)}else isVisible=object.visible&&!object.hidden;if(isVisible||scene.displayNeedsUpdate)for(let i=object.childrenLength-1;i>-1;i--)projectObject(object.children[i],camera,scene)}function attachSceneUniforms(object,scene,camera){if(Shader.renderer.appendUniform(object.shader,"normalMatrix",object.normalMatrix),Shader.renderer.appendUniform(object.shader,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader,"modelViewMatrix",object.modelViewMatrix),_ubo?camera._ubo.bind(object.shader._gl.program,"global"):(Shader.renderer.appendUniform(object.shader,"projectionMatrix",camera.projectionMatrix),Shader.renderer.appendUniform(object.shader,"viewMatrix",camera.matrixWorldInverse),Shader.renderer.appendUniform(object.shader,"cameraPosition",camera.worldPos),Shader.renderer.appendUniform(object.shader,"cameraQuaternion",camera.worldQuat),Shader.renderer.appendUniform(object.shader,"resolution",_resolution),Shader.renderer.appendUniform(object.shader,"time",_time.value),Shader.renderer.appendUniform(object.shader,"timeScale",Render.timeScaleUniform.value)),_this.shadows&&object.shader.receiveShadow&&!_this.overridePreventShadows){let lights=Lighting.getShadowLights();object._gl||(object._gl={}),object._gl.shadowData||(object._gl.shadowData={combined:new Float32Array(16*lights.length)});for(let i=0;i<lights.length;i++){let light=lights[i];_m1.multiplyMatrices(light.shadow.camera.matrixWorldInverse,object.matrixWorld),_m0.multiplyMatrices(light.shadow.camera.projectionMatrix,_m1),_m0.toArray(object._gl.shadowData.combined,16*i)}scene._shadowData&&scene._shadowData.count&&(object.shader.uniforms.shadowMap.value=scene._shadowData[_this.overridePreventShadows?"emptyMaps":"maps"],Shader.renderer.appendUniform(object.shader,"shadowMatrix",object._gl.shadowData.combined,"matrix"),Shader.renderer.appendUniform(object.shader,"shadowLightPos",scene._shadowData.pos,"vec3"),Shader.renderer.appendUniform(object.shader,"shadowSize",scene._shadowData.size,"float"))}}function attachShadowUniforms(object,scene,light){light._mvm||(light._mvm=new Matrix4),light._nm||(light._nm=new Matrix3),light._mvm.multiplyMatrices(light.shadow.camera.matrixWorldInverse,object.matrixWorld),light._nm.getNormalMatrix(object.modelViewMatrix),Shader.renderer.appendUniform(object.shader.shadow,"normalMatrix",light._nm),Shader.renderer.appendUniform(object.shader.shadow,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader.shadow,"modelViewMatrix",light._mvm),_ubo?light.shadow.camera._ubo.bind(object.shader._gl.program,"global"):(Shader.renderer.appendUniform(object.shader.shadow,"projectionMatrix",light.shadow.camera.projectionMatrix),Shader.renderer.appendUniform(object.shader.shadow,"viewMatrix",light.shadow.camera.matrixWorldInverse))}function loop(t,dt){_time.value+=.001*dt}function render(scene,camera,rt){rt&&rt.width?(_resolution.set(rt.width,rt.height),rt.multisample?RenderTarget.renderer.bind(rt._rtMultisample):RenderTarget.renderer.bind(rt)):(Renderer.overrideViewport||(_gl.viewport(0,0,_width*_dpr,_height*_dpr),_resolution.set(_canvas.width,_canvas.height)),_this.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT))),camera.parent||camera.updateMatrixWorld(),camera.getWorldPosition(camera.worldPos),camera.getWorldQuaternion(camera.worldQuat),_frustum.setFromCamera(camera),_ubo&&(camera._ubo?camera._ubo.update():initCameraUBO(camera));for(let l=0;l<2;l++){let len=scene.toRender[l].length;for(let i=0;i<len;i++){let object=scene.toRender[l][i];if(object.onBeforeRender&&object.onBeforeRender(),object._drawing=!1,object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&!object.neverRender&&(object._occlusionGroup&&(object._occlusionGroup.updateOcclusionBoundingBox(),object._occlusionGroup.updateOcclusionVisibility(object?._gl?.occluded)),_this.useOcclusionQuery&&object.isOcclusionMesh&&_this.type==Renderer.WEBGL2&&object._queryMesh.occlusionCulled&&(object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader,!0)),!1===object.frustumCulled||!0===_frustum.intersectsObject(object))){if(object._drawing=!0,object.shader.nullRender||object?._gl?.occluded||object.isOcclusionMesh)continue;let doubleSideTransparency=object.shader.side===Shader.DOUBLE_SIDE_TRANSPARENCY;doubleSideTransparency&&(object.shader.side=Shader.BACK_SIDE),object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader),doubleSideTransparency&&(object.shader.side=Shader.FRONT_SIDE,object.shader.draw(object,object.geometry),attachSceneUniforms(object,scene,camera),object.geometry.draw(object,object.shader),object.shader.side=Shader.DOUBLE_SIDE_TRANSPARENCY)}}}rt&&rt.width&&(rt.texture.generateMipmaps&&(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),_gl.generateMipmap(_gl.TEXTURE_2D),_gl.bindTexture(_gl.TEXTURE_2D,null)),rt.multisample?(_this.blit(rt._rtMultisample,rt),RenderTarget.renderer.unbind(rt._rtMultisample)):RenderTarget.renderer.unbind(rt))}this.autoClear=!0,this.shadows=Renderer.SHADOWS_MED,this.useOcclusionQuery=!0,Renderer.instance=_this,Renderer.CLEAR=[0,0,0,1],function initContext(){let contextAttributes={antialias:void 0!==_params.antialias&&_params.antialias,powerPreference:_params.powerPreference,preserveDrawingBuffer:_params.preserveDrawingBuffer,xrCompatible:_params.xrCompatible,alpha:void 0!==_params.alpha&&_params.alpha,stencil:_params.stencil};if(_this.stencil=!!_params.stencil,_canvas=_params.canvas||document.createElement("canvas"),_params.gl?(_gl=_params.gl,_this.type=Device.graphics.webgl.version.includes(["webgl 2","webgl2"])?Renderer.WEBGL2:Renderer.WEBGL1):Device.graphics.webgl?["webgl2","webgl","experimental-webgl"].forEach((name=>{_gl||"webgl2"==name&&_params.forceWebGL1||(_gl=_canvas.getContext(name,contextAttributes),_this.type=_gl&&"webgl2"==name?Renderer.WEBGL2:Renderer.WEBGL1)})):(_gl=new NoGLPolyfill,_this.type=Renderer.WEBGL2),!_gl)throw"Error! Could not create WebGL context";_this.domElement=_canvas,_canvas.style.background="black",Renderer.type=_this.type,Renderer.context=_this.context=_gl}(),function setExtensions(){_this.extensions={},_this.type!=Renderer.WEBGL2?(_this.extensions.VAO=_gl.getExtension("OES_vertex_array_object"),_this.extensions.instancedArrays=_gl.getExtension("ANGLE_instanced_arrays"),_this.extensions.standardDerivatives=_gl.getExtension("OES_standard_derivatives"),_this.extensions.elementIndexUint=_gl.getExtension("OES_element_index_uint"),_this.extensions.depthTextures=_gl.getExtension("WEBGL_depth_texture"),_this.extensions.drawBuffers=_gl.getExtension("WEBGL_draw_buffers"),_this.extensions.halfFloat=_gl.getExtension("OES_texture_half_float"),_this.extensions.float=_gl.getExtension("OES_texture_float"),_this.extensions.colorBufferFloat=_gl.getExtension("WEBGL_color_buffer_float"),_this.extensions.lod=_gl.getExtension("EXT_shader_texture_lod"),_this.extensions.minMax=_gl.getExtension("EXT_blend_minmax")):_this.extensions.colorBufferFloat=_gl.getExtension("EXT_color_buffer_float"),_this.extensions.filterFloat=_gl.getExtension("OES_texture_float_linear"),_this.extensions.anisotropy=_gl.getExtension("EXT_texture_filter_anisotropic")||_gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),_this.extensions.astc=_gl.getExtension("WEBGL_compressed_texture_astc"),_this.extensions.atc=_gl.getExtension("WEBGL_compressed_texture_atc"),_this.extensions.etc=_gl.getExtension("WEBGL_compressed_texture_etc"),_this.extensions.etc1=_gl.getExtension("WEBGL_compressed_texture_etc1"),_this.extensions.pvrtc=_gl.getExtension("WEBGL_compressed_texture_pvrtc")||_gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),_this.extensions.s3tc=_gl.getExtension("WEBGL_compressed_texture_s3tc")||_gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),_this.extensions.bptc=_gl.getExtension("EXT_texture_compression_bptc"),_this.extensions.s3tc_srgb=_gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),Renderer.extensions=_this.extensions}(),function initRenderers(){Geometry.renderer=new GeometryRendererWebGL(_gl),Texture.renderer=new TextureRendererWebGL(_gl),Shader.renderer=new ShaderRendererWebGL(_gl),RenderTarget.renderer=new FBORendererWebGL(_gl)}(),function initMath(){_projScreenMatrix=new Matrix4,new Vector3,_frustum=new Frustum}(),function initUBO(){_this.type==Renderer.WEBGL2&&(_ubo=!0),Renderer.UBO=_ubo}(),_this.startRender(loop),this.render=function(scene,camera,rt,forceToScreen){scene.displayNeedsUpdate&&(scene.toRender[0].length=0,scene.toRender[1].length=0),_this.modifyCameraBeforeRender&&(camera.renderCamera||(camera.renderCamera=camera.clone()),camera.renderCamera.copy(camera),camera=camera.renderCamera,_this.modifyCameraBeforeRender(camera)),scene.updateMatrixWorld(),projectObject(scene,camera,scene),(scene.displayNeedsUpdate||scene.opaqueSortOrder==Scene.FRONT_TO_BACK)&&function sortOpaque(array,sortOrder,camera){for(let i=array.length-1;i>-1;i--){let obj=array[i];obj.shader._gl||obj.shader.upload()}sortOrder==Scene.FRONT_TO_BACK?sortFrontToBack(array,sortOrder,camera):array.sort(((a,b)=>{if(a.renderOrder!==b.renderOrder)return a.renderOrder-b.renderOrder;let aid=a.shader._gl._id,bid=b.shader._gl._id;return aid!==bid?aid-bid:a.id-b.id}))}(scene.toRender[0],scene.opaqueSortOrder,camera),(scene.displayNeedsUpdate||scene.toRender[1].length&&!scene.disableAutoSort)&&function sortTransparent(array,sortOrder,camera){RenderStats.update("SortTransparent",array.length),sortOrder==Scene.FRONT_TO_BACK||sortOrder==Scene.FRONT_TO_BACK_BOUNDING?sortFrontToBack(array,sortOrder,camera):array.sort(((a,b)=>a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.worldPos.z!==b.worldPos.z?a.worldPos.z-b.worldPos.z:a.id-b.id))}(scene.toRender[1],scene.transparentSortOrder,camera),_this.shadows&&!_this.overridePreventShadows&&!_this.pauseShadowRendering&&scene.hasShadowLight&&function renderShadows(scene,camera){let render=(light,lightIndex)=>{RenderTarget.renderer.bind(light.shadow.rt),RenderStats.update("ShadowLights"),light.shadow.camera.updateMatrixWorld(),camera.getWorldPosition(camera.worldPos),_frustum.setFromCamera(camera),_ubo&&(light.shadow.camera._ubo?light.shadow.camera._ubo.update():initCameraUBO(light.shadow.camera));for(let l=0;l<2;l++)for(let i=0;i<scene.toRender[l].length;i++){let object=scene.toRender[l][i];object.onBeforeRenderShadow&&object.onBeforeRenderShadow(light,lightIndex)||!0===object.castShadow&&object.determineVisible()&&object.shader.visible&&!object.shader.neverRender&&(!1!==object.frustumCulled&&!0!==_frustum.intersectsObject(object)||(object.shader.shadow||Lighting.initShadowShader(object),object.shader.shadow.draw(object,object.geometry),attachShadowUniforms(object,0,light),object.geometry.draw(object,object.shader.shadow),_ubo&&light.shadow.camera._ubo.unbind(),RenderStats.update("ShadowMesh")))}RenderTarget.renderer.unbind(light.shadow.rt)},lights=Lighting.getShadowLights();scene._shadowData||(scene._shadowData={maps:[],emptyMaps:[],size:new Float32Array(lights.length),pos:new Float32Array(3*lights.length),count:lights.length}),scene._shadowData.count!=lights.length&&(scene._shadowData.size=new Float32Array(lights.length),scene._shadowData.pos=new Float32Array(3*lights.length),scene._shadowData.count=lights.length);for(let i=0;i<lights.length;i++){let light=lights[i];light.prepareRender(),scene._shadowData.maps[i]=light.shadow.rt.depth,scene._shadowData.emptyMaps[i]=Utils3D.getEmptyTexture(),scene._shadowData.size[i]=light.shadow.size,light.position.toArray(scene._shadowData.pos,3*i)}for(let i=0;i<lights.length;i++){let light=lights[i];!light.shadow.frozen&&light.determineVisible()&&render(light,i)}}(scene,camera),rt&&!rt.vrRT||!_this.vrRenderingPath||forceToScreen?rt||!_this.arRenderingPath||forceToScreen?render(scene,camera,rt):_this.arRenderingPath(render,scene,camera):_this.vrRenderingPath(scene,camera,_projScreenMatrix,_frustum,attachSceneUniforms,rt),scene.displayNeedsUpdate=!1,Shader.renderer.resetState()},this.renderSingle=function(object,camera,rt){rt?(_resolution.set(rt.width,rt.height),rt.multisample?RenderTarget.renderer.bind(rt._rtMultisample):RenderTarget.renderer.bind(rt)):(Renderer.overrideViewport||(_gl.viewport(0,0,_width*_dpr,_height*_dpr),_resolution.set(_canvas.width,_canvas.height)),_this.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT))),camera.getWorldPosition(camera.worldPos),object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.getWorldPosition(object.worldPos),_ubo&&(camera._ubo?camera.pauseUBO||camera._ubo.update():initCameraUBO(camera));let doubleSideTransparency=object.shader.side===Shader.DOUBLE_SIDE_TRANSPARENCY;doubleSideTransparency&&(object.shader.side=Shader.BACK_SIDE,object.shader._renderFrontFirst&&(object.shader.side=Shader.FRONT_SIDE)),object.shader.draw(object,object.geometry),object.noMatrices||(Shader.renderer.appendUniform(object.shader,"normalMatrix",object.normalMatrix),Shader.renderer.appendUniform(object.shader,"modelMatrix",object.matrixWorld),Shader.renderer.appendUniform(object.shader,"modelViewMatrix",object.modelViewMatrix)),_ubo?camera._ubo.bind(object.shader._gl.program,"global"):(Shader.renderer.appendUniform(object.shader,"projectionMatrix",camera.projectionMatrix),Shader.renderer.appendUniform(object.shader,"viewMatrix",camera.matrixWorldInverse),Shader.renderer.appendUniform(object.shader,"cameraPosition",camera.worldPos),Shader.renderer.appendUniform(object.shader,"cameraQuaternion",camera.worldQuat),Shader.renderer.appendUniform(object.shader,"resolution",_resolution),Shader.renderer.appendUniform(object.shader,"time",_time.value),Shader.renderer.appendUniform(object.shader,"timeScale",Render.timeScaleUniform.value)),object.geometry.draw(object,object.shader),doubleSideTransparency&&(object.shader.side=Shader.FRONT_SIDE,object.shader._renderFrontFirst&&(object.shader.side=Shader.BACK_SIDE),object.shader.draw(object,object.geometry),object.geometry.draw(object,object.shader),object.shader.side=Shader.DOUBLE_SIDE_TRANSPARENCY),_ubo&&camera._ubo.unbind(),rt&&(rt.texture.generateMipmaps&&(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),_gl.generateMipmap(_gl.TEXTURE_2D),_gl.bindTexture(_gl.TEXTURE_2D,null)),rt.multisample?(_this.blit(rt._rtMultisample,rt),RenderTarget.renderer.unbind(rt._rtMultisample)):RenderTarget.renderer.unbind(rt)),Shader.renderer.resetState()},this.setClearColor=function(color,alpha=1){_clearColor=new Color(color),Renderer.CLEAR=[_clearColor.r,_clearColor.g,_clearColor.b,alpha]},this.setClearAlpha=function(alpha){Renderer.CLEAR[3]=alpha},this.getClearColor=function(){return _clearColor||(_clearColor=new Color(0,0,0)),_clearColor},this.getClearAlpha=function(){return Renderer.CLEAR[3]},this.setPixelRatio=function(dpr){_dpr=dpr,this.setSize(_width,_height)},this.setSize=function(width,height){_width=width,_height=height,_canvas.width=width*_dpr,_canvas.height=height*_dpr,_canvas.style.width=`${width}px`,_canvas.style.height=`${height}px`,_resolution.set(_canvas.width,_canvas.height)},this.getMaxAnisotropy=function(){return Device.graphics.webgl&&_this.extensions.anisotropy?(_anisotropy||(_anisotropy=_gl.getParameter(_this.extensions.anisotropy.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),_anisotropy):0},this.readPixels=function(rt,x=0,y=0,width,height,array,type=_gl.UNSIGNED_BYTE){width||(width=rt?rt.width:1),height||(height=rt?rt.height:1),width=Math.round(width),height=Math.round(height),type=type||_gl.UNSIGNED_BYTE;let w=Math.round(width-x),h=Math.round(height-y);return array||(array=new Uint8Array(w*h*4)),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt?rt._gl:null),_gl.readPixels(x,y,width,height,_gl.RGBA,type,array),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),array},this.blit=function(input,output,mask=_gl.COLOR_BUFFER_BIT){if(_this.type!=Renderer.WEBGL2)return!1;if(input._gl||input.upload(),output._gl||output.upload(),_gl.bindFramebuffer(_gl.READ_FRAMEBUFFER,input._gl),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,output._gl),input===output._rtMultisample&&(output.depth&&(mask|=_gl.DEPTH_BUFFER_BIT),output.stencil&&(mask|=_gl.STENCIL_BUFFER_BIT)),_gl.blitFramebuffer(0,0,input.width,input.height,0,0,output.width,output.height,mask,_gl.NEAREST),input===output._rtMultisample&&output.multi){let attachments=output.attachments;for(let i=1;i<attachments.length;i++){let texture=attachments[i];_gl.readBuffer(_gl[`COLOR_ATTACHMENT${i}`]),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,texture._blitFramebuffer),_gl.blitFramebuffer(0,0,input.width,input.height,0,0,output.width,output.height,_gl.COLOR_BUFFER_BIT,_gl.NEAREST)}_gl.readBuffer(_gl.COLOR_ATTACHMENT0)}return _gl.bindFramebuffer(_gl.READ_FRAMEBUFFER,null),_gl.bindFramebuffer(_gl.DRAW_FRAMEBUFFER,null),!0},this.setupStencilMask=function(ref=1){_stencilActive||(_gl.enable(_gl.STENCIL_TEST),_gl.clear(_gl.STENCIL_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT)),_stencilActive=!0,_gl.stencilFunc(_gl.ALWAYS,ref,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.REPLACE),_gl.stencilMask(255),_gl.colorMask(!1,!1,!1,!1),_gl.disable(_gl.DEPTH_TEST)},this.setupStencilDraw=function(mode,ref=1){_gl.colorMask(!0,!0,!0,!0),_gl.enable(_gl.DEPTH_TEST),_gl.stencilFunc("inside"==mode?_gl.EQUAL:_gl.NOTEQUAL,ref,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.KEEP)},this.clearStencil=function(){_gl.disable(_gl.STENCIL_TEST),_stencilActive=!1},this.clearDepth=function(rt){rt&&!rt._gl&&rt.upload(),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),_gl.clear(_gl.DEPTH_BUFFER_BIT),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.clearColor=function(rt){rt&&!rt._gl&&rt.upload(),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),_gl.clear(_gl.COLOR_BUFFER_BIT),rt&&_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.get("resolution",(_=>_resolution)),this.get("time",(_=>_time)),this.get("canvas",(_=>_canvas))}),(_=>{Renderer.WEBGL1="webgl1",Renderer.WEBGL2="webgl2",Renderer.STATIC_SHADOWS="static_shadows",Renderer.SHADOWS_LOW="shadows_low",Renderer.SHADOWS_MED="shadows_med",Renderer.SHADOWS_HIGH="shadows_high",Renderer.ID=0}));class CameraBase3D extends Base3D{constructor(){super(),this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.isCamera=!0}copy(source,recursive){return Base3D.prototype.copy.call(this,source,recursive),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this}updateMatrixWorld(force){Base3D.prototype.updateMatrixWorld.call(this,force),this.offsetMatrixWorld&&this.matrixWorld.multiply(this.offsetMatrixWorld),this.matrixWorldInverse.getInverse(this.matrixWorld)}clone(){return(new this.constructor).copy(this)}}class CubeCamera extends Base3D{constructor(near=.1,far=1e3,cubeResolution=512){super();this.px=new PerspectiveCamera(90,1,near,far),this.px.up.set(0,-1,0),this.px.lookAt(new Vector3(1,0,0)),this.add(this.px),this.nx=new PerspectiveCamera(90,1,near,far),this.nx.up.set(0,-1,0),this.nx.lookAt(new Vector3(-1,0,0)),this.add(this.nx),this.py=new PerspectiveCamera(90,1,near,far),this.py.up.set(0,0,1),this.py.lookAt(new Vector3(0,1,0)),this.add(this.py),this.ny=new PerspectiveCamera(90,1,near,far),this.ny.up.set(0,0,-1),this.ny.lookAt(new Vector3(0,-1,0)),this.add(this.ny),this.pz=new PerspectiveCamera(90,1,near,far),this.pz.up.set(0,-1,0),this.pz.lookAt(new Vector3(0,0,1)),this.add(this.pz),this.nz=new PerspectiveCamera(90,1,near,far),this.nz.up.set(0,-1,0),this.nz.lookAt(new Vector3(0,0,-1)),this.add(this.nz),this.rt=new CubeRenderTarget(cubeResolution,cubeResolution)}render(scene=World.SCENE,renderer=World.RENDERER){let rt=this.rt;this.updateMatrixWorld(!0),this.beforeRender&&this.beforeRender(this.px),rt.activeFace=0,renderer.render(scene,this.px,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.nx),rt.activeFace=1,renderer.render(scene,this.nx,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.py),rt.activeFace=2,renderer.render(scene,this.py,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.ny),rt.activeFace=3,renderer.render(scene,this.ny,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.pz),rt.activeFace=4,renderer.render(scene,this.pz,rt),this.afterRender&&this.afterRender(rt),this.beforeRender&&this.beforeRender(this.nz),rt.activeFace=5,renderer.render(scene,this.nz,rt),this.afterRender&&this.afterRender(rt)}}class OrthographicCamera extends CameraBase3D{constructor(left,right,top,bottom,near,far){super(),this.isOrthographicCamera=!0,this.zoom=1,this.left=left,this.right=right,this.top=top,this.bottom=bottom,this.near=void 0!==near?near:.1,this.far=void 0!==far?far:2e3,this.position.z=1,this.updateProjectionMatrix()}clone(){return(new OrthographicCamera).copy(this)}copy(source,recursive){return CameraBase3D.prototype.copy.call(this,source,recursive),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this}updateProjectionMatrix(){let dx=(this.right-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.right+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far)}setViewport(width,height){this.left=width/-2,this.right=width/2,this.top=height/2,this.bottom=height/-2,this.updateProjectionMatrix()}}class PerspectiveCamera extends CameraBase3D{constructor(fov,aspect,near,far){super(),this.type="PerspectiveCamera",this.fov=fov||50,this.zoom=1,this.near=near||.1,this.far=far||2e3,this.focus=10,this.aspect=aspect||1,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}clone(){return(new PerspectiveCamera).copy(this)}copy(source,recursive){return CameraBase3D.prototype.copy.call(this,source,recursive),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this}setFocalLength(focalLength){let vExtentSlope=.5*this.getFilmHeight()/focalLength;this.fov=Math.degrees(2*Math.atan(vExtentSlope)),this.updateProjectionMatrix()}getFocalLength(){let vExtentSlope=Math.tan(Math.radians(.5*this.fov));return.5*this.getFilmHeight()/vExtentSlope}getEffectiveFOV(){return Math.degrees(2*Math.atan(Math.tan(Math.radians(.5*this.fov))/this.zoom))}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}updateProjectionMatrix(){let near=this.near,top=near*Math.tan(Math.radians(.5*this.fov))/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width,skew=(this.view,this.filmOffset);0!==skew&&(left+=near*skew/this.getFilmWidth()),this.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far)}}class Geometry{constructor(){this.attributes=Geometry.createAttributes(this),this.drawRange={start:0,end:0},this.boundingBox=null,this.boundingSphere=null,this.index=null,this.maxInstancedCount=void 0,this.keepAlive=!1,this.id=Utils.timestamp()}draw(mesh,shader,isQuery=!1){Geometry.renderer.draw(this,mesh,shader,isQuery)}upload(mesh,shader){Geometry.renderer.upload(this,mesh,shader)}destroy(mesh){this.keepAlive||Geometry.renderer.destroy(this,mesh)}addAttribute(name,attribute){attribute.meshPerAttribute>=1&&(this.isInstanced=!0,this.maxInstancedCount=attribute.count),this.attributes[name]=attribute}setIndex(attribute){this.index=attribute.array||attribute}toNonIndexed(){let geometry2=new Geometry,indices=this.index,attributes=this.attributes;for(let name in attributes){let attribute=attributes[name],array=attribute.array,itemSize=attribute.itemSize,array2=new array.constructor(indices.length*itemSize),index=0,index2=0;for(let i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(let j=0;j<itemSize;j++)array2[index2++]=array[index++]}geometry2.addAttribute(name,new GeometryAttribute(array2,itemSize))}return geometry2}normalizeNormals(){let vector=this._V1||new Vector3;this._V1=vector;let x,y,z,normals=this.attributes.normal;for(let i=0,il=normals.count;i<il;i++)x=3*i+0,y=3*i+1,z=3*i+2,vector.x=normals.array[x],vector.y=normals.array[y],vector.z=normals.array[z],vector.normalize(),normals.array[x]=vector.x,normals.array[y]=vector.y,normals.array[z]=vector.z}computeFaceNormals(){let cb=new Vector3,ab=new Vector3;for(let f=0,fl=this.faces.length;f<fl;f++){let face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c];cb.subVectors(vC,vB),ab.subVectors(vA,vB),cb.cross(ab),cb.normalize(),face.normal.copy(cb)}}computeVertexNormals(){let index=this.index,attributes=this.attributes,groups=this.groups;if(attributes.position){let positions=attributes.position.array;if(void 0===attributes.normal)this.addAttribute("normal",new GeometryAttribute(new Float32Array(positions.length),3));else{let array=attributes.normal.array;for(let i=0,il=array.length;i<il;i++)array[i]=0}let vA,vB,vC,normals=attributes.normal.array,pA=new Vector3,pB=new Vector3,pC=new Vector3,cb=new Vector3,ab=new Vector3;if(index){let indices=index.array;0===groups.length&&this.addGroup(0,indices.length);for(let j=0,jl=groups.length;j<jl;++j){let group=groups[j],start=group.start;for(let i=start,il=start+group.count;i<il;i+=3)vA=3*indices[i+0],vB=3*indices[i+1],vC=3*indices[i+2],pA.fromArray(positions,vA),pB.fromArray(positions,vB),pC.fromArray(positions,vC),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[vA]+=cb.x,normals[vA+1]+=cb.y,normals[vA+2]+=cb.z,normals[vB]+=cb.x,normals[vB+1]+=cb.y,normals[vB+2]+=cb.z,normals[vC]+=cb.x,normals[vC+1]+=cb.y,normals[vC+2]+=cb.z}}else for(let i=0,il=positions.length;i<il;i+=9)pA.fromArray(positions,i),pB.fromArray(positions,i+3),pC.fromArray(positions,i+6),cb.subVectors(pC,pB),ab.subVectors(pA,pB),cb.cross(ab),normals[i]=cb.x,normals[i+1]=cb.y,normals[i+2]=cb.z,normals[i+3]=cb.x,normals[i+4]=cb.y,normals[i+5]=cb.z,normals[i+6]=cb.x,normals[i+7]=cb.y,normals[i+8]=cb.z;this.normalizeNormals(),attributes.normal.needsUpdate=!0}}computeBoundingBox(){this.boundingBox||(this.boundingBox=new Box3);let position=this.attributes.position;position?this.boundingBox.setFromBufferAttribute(position):this.boundingBox.makeEmpty()}computeBoundingSphere(){let box=new Box3,vector=new Vector3;this.boundingSphere||(this.boundingSphere=new Sphere);let position=this.attributes.position;if(position){let center=this.boundingSphere.center;box.setFromBufferAttribute(position),box.getCenter(center);let maxRadiusSq=0;for(let i=0,il=position.count;i<il;i++)vector.x=position.array[3*i+0],vector.y=position.array[3*i+1],vector.z=position.array[3*i+2],maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector));this.boundingSphere.radius=Math.sqrt(maxRadiusSq),isNaN(this.boundingSphere.radius)&&console.error("Bounding Sphere came up NaN, broken position buffer.",this)}}merge(geometry){let Float32ArrayConcat=(first,second)=>{let firstLength=first.length,result=new Float32Array(firstLength+second.length);return result.set(first),result.set(second,firstLength),result},attributes=this.attributes;if(this.index){let indices=geometry.index,offset=attributes.position.count;for(let i=0,il=indices.length;i<il;i++)indices[i]=offset+indices[i];this.index=((first,second)=>{let firstLength=first.length,result=new(Geometry.arrayNeedsUint32(second)?Uint32Array:Uint16Array)(firstLength+second.length);return result.set(first),result.set(second,firstLength),result})(this.index,indices)}for(let key in attributes)void 0!==geometry.attributes[key]&&(attributes[key].array=Float32ArrayConcat(attributes[key].array,geometry.attributes[key].array),attributes[key].count=attributes[key].array.length/attributes[key].itemSize);return this}clone(noCopy){return(new Geometry).copy(this,noCopy)}copy(source,noCopy){this.index=null,this.boundingBox=null,this.boundingSphere=null,this.index=source.index;let attributes=source.attributes;for(let name in attributes)this.addAttribute(name,attributes[name].clone(noCopy));let boundingBox=source.boundingBox;boundingBox&&boundingBox.clone&&(this.boundingBox=boundingBox.clone());let boundingSphere=source.boundingSphere;return boundingSphere&&boundingSphere.clone&&(this.boundingSphere=boundingSphere.clone()),this}center(){let offset=new Vector3;return this.computeBoundingBox(),this.boundingBox.getCenter(offset).negate(),this.applyMatrix((new Matrix4).makeTranslation(offset.x,offset.y,offset.z)),this}applyMatrix(matrix){let position=this.attributes.position;position&&(matrix.applyToBufferAttribute(position),position.needsUpdate=!0);let normal=this.attributes.normal;if(normal){(new Matrix3).getNormalMatrix(matrix).applyToBufferAttribute(normal),normal.needsUpdate=!0}return this.boundingBox&&this.computeBoundingBox(),this.boundingSphere&&this.computeBoundingSphere(),this}scale(x,y,z){this.applyMatrix((new Matrix4).makeScale(x,y,z))}setFromPoints(points){let position=[];for(let i=0,l=points.length;i<l;i++){let point=points[i];position.push(point.x,point.y,point.z||0)}return this.addAttribute("position",new GeometryAttribute(new Float32Array(position),3)),this}instanceFrom(geom){return geom.clone()}uploadBuffersAsync(){return Geometry.renderer.uploadBuffersAsync(this)}toJSON(){let props={};this.index&&(props.index=Array.from(this.index));for(let key in this.attributes)props[key]=Array.from(this.attributes[key].array);return JSON.stringify(props)}}class GeometryAttribute{constructor(_array,_itemSize,_meshPerAttribute,_dynamic=!1){this.array=_array,this.itemSize=_itemSize,this.count=void 0!==_array?_array.length/_itemSize:0,this.dynamic=_dynamic,this.updateRange={offset:0,count:-1},this.meshPerAttribute=_meshPerAttribute}setArray(array){let newCount=void 0!==array?array.length/this.itemSize:0;newCount!=this.count&&(this.needsNewBuffer=!0),this.array=array,this.count=newCount,this.needsUpdate=!0}clone(noCopy){return noCopy?this:new GeometryAttribute(new Float32Array(this.array),this.itemSize,this.meshPerAttribute)}getX(index){return this.array[index*this.itemSize]}setX(index,x){return this.array[index*this.itemSize]=x,this}getY(index){return this.array[index*this.itemSize+1]}setY(index,y){return this.array[index*this.itemSize+1]=y,this}getZ(index){return this.array[index*this.itemSize+2]}setZ(index,z){return this.array[index*this.itemSize+2]=z,this}getW(index){return this.array[index*this.itemSize+3]}setW(index,w){return this.array[index*this.itemSize+3]=w,this}setXY(index,x,y){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this}setXYZ(index,x,y,z){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this}setXYZW(index,x,y,z,w){return index*=this.itemSize,this.array[index+0]=x,this.array[index+1]=y,this.array[index+2]=z,this.array[index+3]=w,this}}class InterleavedBuffer{constructor(array,stride){this.array=array,this.stride=stride,this.count=array?array.length/stride:0,this.isInterleaved=!0,this.needsUpdate=!1,this.dynamic=!1,this.updateRange={offset:0,count:-1}}}class InterleavedGeometryAttribute{constructor(interleavedBuffer,itemSize,offset){this.data=interleavedBuffer,this.itemSize=itemSize,this.offset=offset,this.isInterleaved=!0}}class Group extends Base3D{constructor(){super(),this.isGroup=!0,this._occlusionMesh=null,this._bbVertices=[];for(let i=0;i<8;i++)this._bbVertices.push(new Vector3)}generateOcclusionMesh(){if(!this.occlusionCulled){this.occlusionCulled=!0;let occShader=new Shader("OcclusionMaterial",{bbMin:{value:new Vector3(0,0,0)},bbMax:{value:new Vector3(1,1,1)}});occShader.wireframe=!0;let _occlusionMesh=new Mesh(World.BOX,occShader);_occlusionMesh.occlusionCulled=!0,_occlusionMesh._occlusionGroup=this,_occlusionMesh.renderOrder=-1e3,_occlusionMesh.hideByOcclusion=!0,_occlusionMesh._occlusionMesh.renderOrder=1e3,this.add(_occlusionMesh),this._occlusionMesh=_occlusionMesh,this.bb=new Box3}}updateOcclusionBoundingBox(){this.bb.makeEmpty();const _this=this;_this.children.forEach((child=>{if(void 0===child._occlusionGroup){child.updateOcclusionMesh();let bb=child._geometry.boundingBox,m=bb.min,M=bb.max;_this._bbVertices[0].set(m.x,m.y,m.z),_this._bbVertices[1].set(m.x,m.y,M.z),_this._bbVertices[2].set(m.x,M.y,m.z),_this._bbVertices[3].set(M.x,m.y,m.z),_this._bbVertices[4].set(M.x,M.y,m.z),_this._bbVertices[5].set(M.x,m.y,M.z),_this._bbVertices[6].set(m.x,M.y,M.z),_this._bbVertices[7].set(M.x,M.y,M.z),_this._bbVertices.forEach((vertex=>{vertex.applyMatrix4(child.matrix),_this.bb.min.x=Math.min(_this.bb.min.x,vertex.x),_this.bb.min.y=Math.min(_this.bb.min.y,vertex.y),_this.bb.min.z=Math.min(_this.bb.min.z,vertex.z),_this.bb.max.x=Math.max(_this.bb.max.x,vertex.x),_this.bb.max.y=Math.max(_this.bb.max.y,vertex.y),_this.bb.max.z=Math.max(_this.bb.max.z,vertex.z)}))}})),this._occlusionMesh?.shader?.set("bbMin",this.bb.min),this._occlusionMesh?.shader?.set("bbMax",this.bb.max),this._occlusionMesh?._occlusionMesh?.shader?.set("bbMin",this.bb.min.add(new Vector3(-.01,-.01,-.01))),this._occlusionMesh?._occlusionMesh?.shader?.set("bbMax",this.bb.max.add(new Vector3(.01,.01,.01))),this._occlusionMesh.position.copy(this.bb.max.clone().add(this.bb.min).multiplyScalar(.5))}updateOcclusionVisibility(doHide){this.children.forEach((child=>{void 0===child._occlusionGroup&&(child.hideByOcclusion=doHide)}))}}class BaseLight extends Base3D{constructor(color=16777215,intensity=1,distance=9999){super(),this.color=new Color(color),this.data=new Vector4,this.data2=new Vector4,this.data3=new Vector4,this.properties=new Vector4(intensity,distance,0,0)}destroy(){this.shadow&&(Lighting.removeFromShadowGroup(this),this.shadow.destroy())}prepareRender(){this.shadow.camera.position.copy(this.position),this.shadow.camera.lookAt(this.shadow.target)}set castShadow(bool){(this.shadow||bool)&&(this.shadow||(this.shadow=new Shadow(this)),this.shadow.enabled=bool,this.silentShadow||(bool?Lighting.addToShadowGroup(this):Lighting.removeFromShadowGroup(this)))}set intensity(v){this.properties.x=v}get intensity(){return this.properties.x}set distance(v){this.properties.y=v}get distance(){return this.properties.y}set bounce(v){this.properties.z=v}get bounce(){return this.properties.z}}class Line extends Base3D{constructor(geometry,shader){super(),this.geometry=geometry,this.shader=shader,this.isLine=!0,this.id=Renderer.ID++}clone(){return new Line(this.geometry,this.shader).copy(this)}}class Mesh extends Base3D{constructor(geometry,shader,isQuery=!1){super(),shader||window.THREAD||(shader=new Shader("TestMaterial")),this._geometry=geometry,this._shader=shader&&shader.shader?shader.shader:shader,this.isMesh=!0;if(this.occlusionMesh=null,!isQuery&&!window.THREAD){let occShader=new Shader("OcclusionMaterial",{bbMin:{value:new Vector3},bbMax:{value:new Vector3}});occShader.side=Shader.DOUBLE_SIDE;let _occlusionMesh=new Mesh(World.BOX,occShader,!0);_occlusionMesh.occlusionCulled=!1,_occlusionMesh.doNotProject=!0,_occlusionMesh._queryMesh=this,_occlusionMesh.isOcclusionMesh=!0,this.add(_occlusionMesh),this._occlusionMesh=_occlusionMesh,this._occlusionDirty=!0}this.id=Utils.timestamp(),shader&&(this._shader.mesh=this)}clone(){return new Mesh(this._geometry,this.shader).copy(this)}set geometry(g){Geometry.renderer.resetMeshGeom(this),this._geometry=g}get geometry(){return this._geometry}set shader(shader){this._shader=shader&&shader.shader?shader.shader:shader}get shader(){return this._shader}isInsideOf(mesh){return this.box3||(this.box3=new Box3),this.box3.setFromObject(this),mesh.isMeshInside(this)}isMeshInside(mesh){return this.box3||(this.box3=new Box3),this.box3.setFromObject(this),mesh.box3.intersectsBox(this.box3)}updateOcclusionMesh(force){if(this.occlusionCulled&&(this._occlusionDirty||force)){this._geometry.computeBoundingBox();let bb=this._geometry.boundingBox;this._occlusionMesh?.shader?.set("bbMin",bb.min.add(new Vector3(-.01,-.01,-.01))),this._occlusionMesh?.shader?.set("bbMax",bb.max.add(new Vector3(.01,.01,.01))),this._occlusionMesh.renderOrder=this.renderOrder+1e3,this._occlusionDirty=!1}}}class Points extends Base3D{constructor(geometry,shader){super(),this._geometry=geometry,this.shader=shader,this.isPoints=!0,this.id=Renderer.ID++,shader&&(this.shader.mesh=this)}clone(){return new Points(this._geometry,this.shader).copy(this)}set geometry(g){Geometry.renderer.resetMeshGeom(this),this._geometry=g}get geometry(){return this._geometry}}class Scene extends Base3D{constructor(){super(),this.autoUpdate=!0,this.toRender=[[],[]],this._displayNeedsUpdate=!0,this.isScene=!0,this.changes=[]}set displayNeedsUpdate(v){!0===v&&this.changes.forEach((cb=>cb())),this._displayNeedsUpdate=v}get displayNeedsUpdate(){return this._displayNeedsUpdate}bindSceneChange(cb){this.changes.push(cb)}}Class((function FBORendererWebGL(_gl){const WEBGL2=Renderer.type==Renderer.WEBGL2;let _maxSamples=WEBGL2&&_gl.getParameter(_gl.MAX_SAMPLES);const{getFormat:getFormat,getInternalFormat:getInternalFormat,getProperty:getProperty,getType:getType,getFloatParams:getFloatParams}=require("GLTypes");function prepareTexture(texture){texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_2D,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),texture.needsUpdate=!1}function texImageDB(rt,texture){if(texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),getType(texture),null);_gl.bindTexture(_gl.TEXTURE_2D,null)}function getRenderBufferInternalFormat(texture){return texture.type.includes("float")?getFloatParams(texture).internalformat:getInternalFormat(texture)}this.upload=function(rt){if(!rt._gl){if(rt.cube)return function uploadCube(rt){rt._gl=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl);let texture=rt.texture;texture._gl=_gl.createTexture(),texture.cube=!0,texture.needsUpdate=!1,_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture._gl);for(let i=0;i<6;i++)_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),_gl.UNSIGNED_BYTE,null);_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_CUBE_MAP,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),rt._depthBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,rt._depthBuffer),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}(rt);if(rt.texture.isTexture3D)return function upload3DTexture(rt){rt.texture.upload();let colorAttachments=[];rt._gl=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl);for(let i=0;i<rt.indices.length;i++){let key="COLOR_ATTACHMENT"+i;colorAttachments.push(_gl[key]),_gl.framebufferTextureLayer(_gl.FRAMEBUFFER,_gl[key],rt.texture._gl,0,rt.indices[i])}_gl.drawBuffers(colorAttachments),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}(rt);if(rt._gl=_gl.createFramebuffer(),!rt.depth&&!rt.disableDepth)if(rt._depthBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,rt.stencil?_gl.DEPTH24_STENCIL8:_gl.DEPTH_COMPONENT24,rt.width,rt.height)}else _gl.renderbufferStorage(_gl.RENDERBUFFER,rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT16,rt.width,rt.height);if(RenderCount.add(`fbo_${Math.round(rt.width)}x${Math.round(rt.height)}`,rt),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.multi)if(WEBGL2){let colorAttachments=[];for(let i=0;i<rt.attachments.length;i++){let key="COLOR_ATTACHMENT"+i,texture=rt.attachments[i];colorAttachments.push(_gl[key]),prepareTexture(texture),texImageDB(rt,texture),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl[key],_gl.TEXTURE_2D,texture._gl,0),rt.multisample&&i>0&&(texture._blitFramebuffer=_gl.createFramebuffer(),_gl.bindFramebuffer(_gl.FRAMEBUFFER,texture._blitFramebuffer),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,texture._gl,0))}_gl.drawBuffers(colorAttachments)}else{let ext=Renderer.extensions.drawBuffers,colorAttachments=[];for(let i=0;i<rt.attachments.length;i++){let key="COLOR_ATTACHMENT"+i+"_WEBGL",texture=rt.attachments[i];colorAttachments.push(ext[key]),prepareTexture(texture),texImageDB(rt,texture),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,ext[key],_gl.TEXTURE_2D,texture._gl,0)}ext.drawBuffersWEBGL(colorAttachments)}else if(rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);if(rt.parent.multi){let colorAttachments=[],attachments=rt.parent.attachments;for(let i=0;i<attachments.length;i++){let key="COLOR_ATTACHMENT"+i,texture=attachments[i];colorAttachments.push(_gl[key]),texture._colorBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,texture._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl[key],_gl.RENDERBUFFER,texture._colorBuffer),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}_gl.drawBuffers(colorAttachments)}else rt._colorBuffer=_gl.createRenderbuffer(),_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(rt.texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.RENDERBUFFER,rt._colorBuffer)}else{if(prepareTexture(rt.texture),rt.texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(rt.texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(rt.texture),rt.width,rt.height,0,getFormat(rt.texture),getType(rt.texture),null);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D,rt.texture._gl,0)}if(rt.depth){prepareTexture(rt.depth);let iformat=rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT,type=rt.stencil?WEBGL2?_gl.UNSIGNED_INT_24_8:Renderer.extensions.depthTextures.UNSIGNED_INT_24_8_WEBGL:_gl.UNSIGNED_INT;_gl.texImage2D(_gl.TEXTURE_2D,0,iformat,rt.width,rt.height,0,rt.stencil?_gl.DEPTH_STENCIL:_gl.DEPTH_COMPONENT,type,null),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,rt.depth._gl,0)}else rt.disableDepth||(rt.internalMultisample,_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,rt._depthBuffer));_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}},this.bind=function(rt){rt._gl||this.upload(rt),_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.cube&&_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+rt.activeFace,rt.texture._gl,0),rt.scissor&&(_gl.enable(_gl.SCISSOR_TEST),_gl.scissor(rt.scissor.x,rt.scissor.y,rt.scissor.width,rt.scissor.height)),_gl.viewport(rt.viewport.x,rt.viewport.y,rt.width,rt.height),rt.customViewport&&_gl.viewport(rt.customViewport.x,rt.customViewport.y,rt.customViewport.z,rt.customViewport.w),Renderer.instance.autoClear&&(_gl.clearColor(Renderer.CLEAR[0],Renderer.CLEAR[1],Renderer.CLEAR[2],Renderer.CLEAR[3]),rt.sharedRenderbuffer?rt.clearDepth?_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT):_gl.clear(_gl.COLOR_BUFFER_BIT):_gl.clear(_gl.COLOR_BUFFER_BIT|_gl.DEPTH_BUFFER_BIT|_gl.STENCIL_BUFFER_BIT))},this.unbind=function(rt){rt.scissor&&_gl.disable(_gl.SCISSOR_TEST),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)},this.resize=function(rt){if(rt.texture._gl&&rt._gl){if(_gl.bindFramebuffer(_gl.FRAMEBUFFER,rt._gl),rt.multi)for(let i=0;i<rt.attachments.length;i++){let texture=rt.attachments[i];if(_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(texture),rt.width,rt.height,0,getFormat(texture),getType(texture),null)}else if(rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);if(rt.parent.multi){let attachments=rt.parent.attachments;for(let i=0;i<attachments.length;i++){let texture=attachments[i];_gl.bindRenderbuffer(_gl.RENDERBUFFER,texture._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(texture),rt.width,rt.height),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}}else _gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._colorBuffer),_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,getRenderBufferInternalFormat(rt.texture),rt.width,rt.height),_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.RENDERBUFFER,rt._colorBuffer)}else if(_gl.bindTexture(_gl.TEXTURE_2D,rt.texture._gl),rt.texture.type.includes("float")){let{internalformat:internalformat,format:format,type:type}=getFloatParams(rt.texture);_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,rt.width,rt.height,0,format,type,null)}else _gl.texImage2D(_gl.TEXTURE_2D,0,getFormat(rt.texture),rt.width,rt.height,0,getFormat(rt.texture),getType(rt.texture),null);if(rt.depth){_gl.bindTexture(_gl.TEXTURE_2D,rt.depth._gl);let iformat=rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT,type=rt.stencil?WEBGL2?_gl.UNSIGNED_INT_24_8:Renderer.extensions.depthTextures.UNSIGNED_INT_24_8_WEBGL:_gl.UNSIGNED_INT;_gl.texImage2D(_gl.TEXTURE_2D,0,iformat,rt.width,rt.height,0,rt.stencil?_gl.DEPTH_STENCIL:_gl.DEPTH_COMPONENT,type,null),_gl.framebufferTexture2D(_gl.FRAMEBUFFER,rt.stencil?_gl.DEPTH_STENCIL_ATTACHMENT:_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,rt.depth._gl,0)}else if(!rt.disableDepth)if(_gl.bindRenderbuffer(_gl.RENDERBUFFER,rt._depthBuffer),rt.internalMultisample){let samples=Math.min(_maxSamples,rt._samplesAmount);_gl.renderbufferStorageMultisample(_gl.RENDERBUFFER,samples,rt.stencil?_gl.DEPTH24_STENCIL8:_gl.DEPTH_COMPONENT24,rt.width,rt.height)}else _gl.renderbufferStorage(_gl.RENDERBUFFER,rt.stencil?WEBGL2?_gl.DEPTH24_STENCIL8:_gl.DEPTH_STENCIL:WEBGL2?_gl.DEPTH_COMPONENT24:_gl.DEPTH_COMPONENT16,rt.width,rt.height);_gl.bindTexture(_gl.TEXTURE_2D,null),_gl.bindFramebuffer(_gl.FRAMEBUFFER,null),_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}},this.destroy=function(rt){_gl.deleteFramebuffer(rt._gl),rt._depthBuffer&&_gl.deleteRenderbuffer(rt._depthBuffer),Texture.renderer.destroy(rt.texture),RenderCount.remove(`fbo_${Math.round(rt.width)}x${Math.round(rt.height)}`),rt.multi&&rt.attachments.forEach((t=>{t._colorBuffer&&_gl.deleteRenderbuffer(t._colorBuffer),t._blitFramebuffer&&_gl.deleteFramebuffer(t._blitFramebuffer),Texture.renderer.destroy(t)})),rt._gl=null}})),Class((function GeometryRendererWebGL(_gl){var _cache={},_isDebbugingShader=Utils.query("displayShaderError");const WEBGL2=Renderer.type==Renderer.WEBGL2;function updateBuffer(attrib){if(!attrib._gl)return;attrib.needsUpdate=!1,_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),RenderStats.update("BufferUpdates");let array=attrib.array,updateRange=attrib.updateRange;if(-1===updateRange.count)attrib.needsNewBuffer?(_gl.bufferData(_gl.ARRAY_BUFFER,attrib.array,_gl.DYNAMIC_DRAW),attrib.needsNewBuffer=!1):_gl.bufferSubData(_gl.ARRAY_BUFFER,0,array);else if(Array.isArray(updateRange)){for(let i=updateRange.length-1;i>-1;i--){let{offset:offset,count:count}=updateRange[i];_gl.bufferSubData(_gl.ARRAY_BUFFER,offset*array.BYTES_PER_ELEMENT,array.subarray(offset,offset+count))}updateRange.length=0}else _gl.bufferSubData(_gl.ARRAY_BUFFER,updateRange.offset*array.BYTES_PER_ELEMENT,array.subarray(updateRange.offset,updateRange.offset+updateRange.count));_gl.bindBuffer(_gl.ARRAY_BUFFER,null)}function renderingCount(count,mode,instanceCount=1){if(RenderStats.active)switch(mode){case _gl.TRIANGLES:RenderStats.update("Triangles",instanceCount*(count/3));break;case _gl.LINES:RenderStats.update("Lines",instanceCount*(count/2));break;case _gl.LINE_STRIP:RenderStats.update("LineStrip",instanceCount*(count-1));break;case _gl.LINE_LOOP:RenderStats.update("LineLoop",instanceCount*count);break;case _gl.POINTS:RenderStats.update("Points",instanceCount*count)}}this.draw=function(geom,mesh,shader,isQuery){geom._gl&&!geom.needsUpdate&&mesh._gl&&mesh._gl.geomInit||this.upload(geom,mesh,shader),RenderStats.active&&RenderStats.update("DrawCalls",1,shader.vsName+"|"+shader.fsName,mesh);for(let i=geom._attributeKeys.length-1;i>-1;i--){let key=geom._attributeKeys[i],attrib=geom._attributeValues[i];mesh._gl.program==shader._gl.program&&void 0!==mesh._gl[key]||(mesh._gl[key]=_gl.getAttribLocation(shader._gl.program,key)),-1!==mesh._gl[key]&&(attrib.isInterleaved&&attrib.data.needsUpdate?updateBuffer(attrib.data):(attrib.needsUpdate||attrib.dynamic)&&updateBuffer(attrib))}if(mesh._gl.program=shader._gl.program,geom.indexNeedsUpdate){if(geom._gl.indexType=geom.index instanceof Uint16Array?_gl.UNSIGNED_SHORT:_gl.UNSIGNED_INT,_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),geom.indexUpdateRange){let updateRange=geom.indexUpdateRange;_gl.bufferSubData(_gl.ELEMENT_ARRAY_BUFFER,updateRange.offset*geom.index.BYTES_PER_ELEMENT,geom.index.subarray(updateRange.offset,updateRange.offset+updateRange.count))}else _gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,geom.index,_gl.STATIC_DRAW);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,null),geom.indexNeedsUpdate=!1}mesh._gl.vao.bind();let mode=mesh._gl.mode;mode||(mesh._gl.mode=mode=function getMode(mesh,shader){return mesh.isPoints?_gl.POINTS:mesh.isLine?_gl.LINE_STRIP:shader.wireframe?_gl.LINES:_gl.TRIANGLES}(mesh,shader));let drawStart=geom.drawRange.start||0,drawEnd=geom.drawRange.end||geom.attributes.position.count;if(isQuery&&WEBGL2){let queryMesh=mesh._queryMesh;void 0!==queryMesh._gl&&(queryMesh._gl.queryInProgress&&_gl.getQueryParameter(queryMesh._gl.query,_gl.QUERY_RESULT_AVAILABLE)&&(queryMesh._gl.occluded=!_gl.getQueryParameter(queryMesh._gl.query,_gl.QUERY_RESULT),queryMesh._gl.queryInProgress=!1),queryMesh._gl.queryInProgress||(_gl.beginQuery(_gl.ANY_SAMPLES_PASSED_CONSERVATIVE,queryMesh._gl.query),_gl.colorMask(!1,!1,!1,!1),_gl.depthMask(!1),geom.index?(_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),_gl.drawElements(mode,geom.index.length,geom._gl.indexType,0)):_gl.drawArrays(mode,drawStart,drawEnd),_gl.colorMask(!0,!0,!0,!0),_gl.depthMask(!0),_gl.endQuery(_gl.ANY_SAMPLES_PASSED_CONSERVATIVE),queryMesh._gl.queryInProgress=!0))}else{if(geom.isInstanced){let maxInstancedCount=mesh.maxInstancedCount?Math.min(mesh.maxInstancedCount,geom.maxInstancedCount):geom.maxInstancedCount;shader.maxInstancedCount&&(maxInstancedCount=Math.min(maxInstancedCount||9999,shader.maxInstancedCount)),WEBGL2?geom.index?_gl.drawElementsInstanced(mode,geom.index.length,geom._gl.indexType,0,maxInstancedCount):_gl.drawArraysInstanced(mode,drawStart,drawEnd,maxInstancedCount):geom.index?Renderer.extensions.instancedArrays.drawElementsInstancedANGLE(mode,geom.index.length,geom._gl.indexType,0,maxInstancedCount):Renderer.extensions.instancedArrays.drawArraysInstancedANGLE(mode,drawStart,drawEnd,maxInstancedCount),renderingCount(geom.index?geom.index.length:drawEnd,mode,maxInstancedCount)}else mesh.hideByOcclusion||(geom.index?_gl.drawElements(mode,geom.index.length,geom._gl.indexType,0):_gl.drawArrays(mode,drawStart,drawEnd),renderingCount(geom.index?geom.index.length:drawEnd,mode,1));_isDebbugingShader&&_gl.getError()!=_gl.NO_ERROR&&console.log(mesh,shader),mesh._gl.vao.unbind()}},this.upload=function(geom,mesh,shader,hotload){if(!mesh)return;geom._gl||(geom._gl={id:Utils.timestamp()}),mesh._gl||(mesh._gl={}),mesh._gl.geomInit=!0,geom.uploaded=!0,!mesh.isOcclusionMesh&&WEBGL2&&(mesh._gl.query=_gl.createQuery(),mesh._gl.queryInProgress=!1,mesh._gl.occluded=!1);const KEY=`${geom._gl.id}_${shader._gl._id}`;let cached=_cache[KEY];if(cached&&!hotload)return cached.count++,mesh._gl.vao=cached.vao,void(mesh._gl.lookup=KEY);Utils.query("debugUpload")&&console.log("?debugUpload – upload geometry",geom),RenderCount.add("geometry"),mesh._gl.vao&&mesh._gl.vao.destroy(),mesh._gl.vao=new VAO(_gl),geom.distributeBufferData||RenderCount.add("geom_upload",geom);for(let i=geom._attributeKeys.length-1;i>-1;i--){let key=geom._attributeKeys[i],attrib=geom._attributeValues[i],location=mesh._gl.program===shader._gl.program&&mesh._gl[key]||_gl.getAttribLocation(shader._gl.program,key);if(mesh._gl[key]=location,attrib._gl)continue;attrib._gl={};let{array:array,dynamic:dynamic}=attrib;attrib.isInterleaved&&(attrib.data._gl||(attrib.data._gl=attrib._gl),attrib._gl=attrib.data._gl,array=attrib.data.array,dynamic=attrib.data.dynamic),attrib._gl.buffer||(attrib._gl.buffer=_gl.createBuffer(),attrib._gl.bufferUploaded=!geom.distributeBufferData,_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),_gl.bufferData(_gl.ARRAY_BUFFER,geom.distributeBufferData?array.length*array.BYTES_PER_ELEMENT:array,dynamic?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ARRAY_BUFFER,null)),attrib.needsUpdate=!1}geom.index&&(geom._gl.index||(geom._gl.index=_gl.createBuffer(),geom._gl.indexType=geom.index instanceof Uint16Array?_gl.UNSIGNED_SHORT:_gl.UNSIGNED_INT,_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,geom.index,_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,null))),mesh._gl.vao.bind();for(let i=geom._attributeKeys.length-1;i>-1;i--){let key=geom._attributeKeys[i],attrib=geom._attributeValues[i],location=mesh._gl[key];if(-1==location)continue;let stride=0,offset=0;if(attrib.isInterleaved){let bytes=attrib.data.array.BYTES_PER_ELEMENT;stride=attrib.data.stride*bytes,offset=attrib.offset*bytes}_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),_gl.vertexAttribPointer(location,attrib.itemSize,_gl.FLOAT,!1,stride,offset),_gl.enableVertexAttribArray(location),geom.isInstanced&&(WEBGL2?_gl.vertexAttribDivisor(location,attrib.meshPerAttribute):Renderer.extensions.instancedArrays.vertexAttribDivisorANGLE(location,attrib.meshPerAttribute))}geom.index&&_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geom._gl.index),mesh._gl.vao.unbind(),_cache[KEY]={count:1,vao:mesh._gl.vao}},this.destroy=function(geom,mesh){for(let i=geom._attributeKeys.length-1;i>-1;i--){geom._attributeKeys[i];let attrib=geom._attributeValues[i];attrib._gl&&(_gl.deleteBuffer(attrib._gl.buffer),attrib._gl=null)}if(geom._gl?.index&&_gl.deleteBuffer(geom._gl.index),RenderCount.remove("geometry"),mesh&&mesh._gl&&mesh._gl.vao){let cache=_cache[mesh._gl.lookup];cache?(cache.count--,0==cache.count&&(cache.vao.destroy(),delete _cache[mesh._gl.lookup])):mesh._gl.vao.destroy(),delete mesh._gl.vao}delete geom._gl},this.resetMeshGeom=function(mesh){mesh._gl&&(mesh._gl.geomInit=!1)},this.uploadBuffersAsync=async function(geom){if(geom._gl&&geom._gl.uploadedAsync)return;let upload=attrib=>{let array=attrib.array,buffer=attrib._gl.buffer,promise=Promise.create(),amt=4,match=!1;for(;!match;)amt--,array.length%amt==0&&(match=!0);let chunk=array.length/amt,i=0,worker=new Render.Worker((function uploadBuffersAsync(){let offset=i*chunk,subarray=array.subarray(offset,offset+chunk);if(!attrib._gl)return worker.stop(),promise.resolve();subarray.length&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer),_gl.bufferSubData(_gl.ARRAY_BUFFER,offset*array.BYTES_PER_ELEMENT,subarray),_gl.bindBuffer(_gl.ARRAY_BUFFER,null)),++i==amt&&(promise.resolve(),worker.stop())}));return promise},uploaded=!1;for(let i=geom._attributeKeys.length-1;i>-1;i--){geom._attributeKeys[i];let attrib=geom._attributeValues[i];if(!attrib._gl){geom.distributeBufferData=!0;let{array:array,dynamic:dynamic}=attrib;attrib._gl={},attrib.isInterleaved&&(attrib.data._gl||(attrib.data._gl=attrib._gl),attrib._gl=attrib.data._gl,array=attrib.data.array,dynamic=attrib.data.dynamic),attrib._gl.buffer||(attrib._gl.buffer=_gl.createBuffer(),attrib._gl.bufferUploaded=!geom.distributeBufferData,attrib.array.length&&(_gl.bindBuffer(_gl.ARRAY_BUFFER,attrib._gl.buffer),_gl.bufferData(_gl.ARRAY_BUFFER,array.length*array.BYTES_PER_ELEMENT,dynamic?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW),_gl.bindBuffer(_gl.ARRAY_BUFFER,null))),attrib.needsUpdate=!1,geom.needsUpdate=!0}attrib._gl.bufferUploaded||(attrib._gl.bufferUploaded=!0,uploaded=!0,await upload(attrib),attrib.needsUpdate=!1)}geom._gl.uploadedAsync=!0,uploaded&&RenderCount.add("geom_uploadAsync",geom)}})),Class((function ShaderRendererWebGL(_gl){var _pool={},_programID=0,_cached={},_uboCache={};const PROFILER=!!window.OptimizationProfiler,WEBGL2=Renderer.type==Renderer.WEBGL2,GLOBAL_UNIFORMS=["normalMatrix","modelMatrix","modelViewMatrix","projectionMatrix","viewMatrix","cameraPosition","cameraQuaternion","resolution","time","shadowMatrix","shadowLightPos","shadowSize"],DEPTH_FUNC_KEYS={[Shader.DEPTH_FUNC_NEVER]:"NEVER",[Shader.DEPTH_FUNC_LESS]:"LESS",[Shader.DEPTH_FUNC_EQUAL]:"EQUAL",[Shader.DEPTH_FUNC_LEQUAL]:"LEQUAL",[Shader.DEPTH_FUNC_GREATER]:"GREATER",[Shader.DEPTH_FUNC_NOTEQUAL]:"NOTEQUAL",[Shader.DEPTH_FUNC_GEQUAL]:"GEQUAL",[Shader.DEPTH_FUNC_ALWAYS]:"ALWAYS"};function toTypedArray(uni){uni.value;return uni._gl||(uni._gl={}),uni._gl.array&&uni._gl.array.length==uni.value.length?uni._gl.array.set(uni.value):uni._gl.array=new Float32Array(uni.value),uni._gl.array}function createShader(str,type,name="Shader"){let shader=_gl.createShader(type);return void 0!==window.SPECTOR&&(shader.__SPECTOR_Metadata={name:name}),_gl.shaderSource(shader,str),_gl.compileShader(shader),Hydra.LOCAL&&(_gl.getShaderParameter(shader,_gl.COMPILE_STATUS)||(!function logPrettyShaderError(shader){const shaderSrc=_gl.getShaderSource(shader).split("\n").map(((line,index)=>`${index}: ${line}`)),shaderLog=_gl.getShaderInfoLog(shader),splitShader=shaderLog.split("\n"),dedupe={},lineNumbers=splitShader.map((line=>parseFloat(line.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((n=>!(!n||dedupe[n])&&(dedupe[n]=!0,!0))),logArgs=[""];lineNumbers.forEach((number=>{shaderSrc[number-1]=`%c${shaderSrc[number-1]}%c`,logArgs.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const fragmentSourceToLog=shaderSrc.join("\n");logArgs[0]=fragmentSourceToLog,console.error(shaderLog),console.groupCollapsed("click to view full shader code"),console.warn(...logArgs),console.groupEnd()}(shader),_gl.deleteShader(shader))),shader}function createProgram(shader){shader.vertexShader||Shader.runPreProcess(shader);let vsCode=shader.onBeforeCompile(shader.vertexShader,"vs"),fsCode=shader.onBeforeCompile(shader.fragmentShader,"fs");PROFILER&&OptimizationProfiler.active&&([vsCode,fsCode]=OptimizationProfiler.override(shader,vsCode,fsCode)),RenderCount.add("shader",shader);let vs=createShader(vsCode,_gl.VERTEX_SHADER,`${shader.vsName} - ${shader.UILPrefix}`),fs=createShader(fsCode,_gl.FRAGMENT_SHADER,`${shader.fsName} - ${shader.UILPrefix}`);Hydra.LOCAL&&window.GLSLLinter&&GLSLLinter.lint(shader,vsCode,fsCode);let program=_gl.createProgram();return _gl.attachShader(program,vs),_gl.attachShader(program,fs),_gl.linkProgram(program),Hydra.LOCAL&&(_gl.getProgramParameter(program,_gl.LINK_STATUS)||(console.warn(`Shader: ${shader.vsName} | ${shader.vsName}`),console.error(`Could not compile WebGL program. ${shader.vsName} ${shader.fsName} \n\n`+_gl.getProgramInfoLog(program)))),_gl.deleteShader(vs),_gl.deleteShader(fs),program}function setupShaders(shader){for(let i=shader._uniformKeys.length-1;i>-1;i--){let key=shader._uniformKeys[i],uniform=shader._uniformValues[i];if(void 0===shader._gl[key]&&uniform)if(uniform.ubo)if(WEBGL2){if(_uboCache[shader.UILPrefix]&&!shader.ubo&&(shader.ubo=_uboCache[shader.UILPrefix]),_uboCache[shader.UILPrefix]){shader._gl[key]="U";continue}shader.ubo||(shader.ubo=new UBO(1,_gl)),shader.ubo.push(uniform),shader._gl[key]="U"}else shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key);else WEBGL2&&uniform.lightUBO?(shader._gl[key]="U",shader.uboLight=!0):shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key)}shader.ubo&&!_uboCache[shader.UILPrefix]&&(_uboCache[shader.UILPrefix]=shader.ubo),shader._gl.setupGlobals||(shader._gl.setupGlobals=!0,GLOBAL_UNIFORMS.forEach((key=>{shader._gl[key]=_gl.getUniformLocation(shader._gl.program,key)}))),shader.uboLight&&_gl.getUniformBlockIndex(shader._gl.program,"lights"),WEBGL2&&_gl.getUniformBlockIndex(shader._gl.program,"global")}function uniformTextureArray(uni,uLoc,shader){let array=shader._gl.texArray||[];array.length=0,shader._gl.texArray=array;for(let i=0;i<uni.value.length;i++){array.push(shader._gl.texIndex);let texture=uni.value[i];!1===texture.loaded&&(texture=Utils3D.getEmptyTexture()),(void 0===texture._gl||texture.needsReupload)&&Texture.renderer.upload(texture),_gl.activeTexture(_gl["TEXTURE"+shader._gl.texIndex++]),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl)}_gl.uniform1iv(uLoc,array)}this.upload=function(shader){if(PROFILER&&OptimizationProfiler.active&&OptimizationProfiler.setupShader(shader),!shader._gl){shader._gl={};let key=`${shader.vsName}_${shader.fsName}_${shader.customCompile}`,cached=_pool[key];cached?(shader._gl.program=cached.program,shader._gl._id=cached.id,shader.onBeforePrecompilePromise.resolve(),cached.count++,Hydra.LOCAL&&_pool[key].references.push(shader)):(shader._gl.program=createProgram(shader),shader._gl._id=_programID++,_pool[key]={count:1,program:shader._gl.program,id:shader._gl._id},Shader.registerPreProcess(shader),Hydra.LOCAL&&(_pool[key].references=[shader]))}setupShaders(shader),shader.ubo&&shader.ubo.upload(),Renderer.type==Renderer.WEBGL1&&FXLayer.exists||(shader.vertexShader=shader.fragmentShader="")},this.findCachedProgram=function(shader){let key=`${shader.vsName}_${shader.fsName}_${shader.customCompile}`,cached=_pool[key];return!!cached&&(shader._gl={},shader._gl.program=cached.program,shader._gl._id=cached.id,shader.onBeforePrecompilePromise.resolve(),_uboCache[shader.UILPrefix]&&(shader.ubo=shader.UILPrefix),cached.count++,Hydra.LOCAL&&_pool[key].references.push(shader),!0)},this.draw=function(shader){void 0===shader._gl&&this.upload(shader),shader._gl.texIndex=0,shader._gl.program!=_cached.program&&(_gl.useProgram(shader._gl.program),_cached.program=shader._gl.program),shader.ubo&&shader.ubo.bind(shader._gl.program,"ubo"),shader.uboLight&&Lighting.bindUBO(shader._gl.program);for(let i=shader._uniformKeys.length-1;i>-1;i--){let key=shader._uniformKeys[i],uni=shader._uniformValues[i];if(!uni)continue;let uLoc=shader._gl[key];if(void 0===uLoc&&(setupShaders(shader),uLoc=shader._gl[key]),null!==uLoc&&-1!==uLoc&&"U"!==uLoc){if(null===uni.value&&(uni.value=Utils3D.getEmptyTexture()),Hydra.LOCAL&&void 0===uni.value)throw`Uniform ${key} value is undefined. | ${shader.vsName} ${shader.fsName}`;switch(uni.type||(uni.type="string"==typeof(uniform=uni).type?uniform.type:"boolean"==typeof uniform.value?"b":null===uniform.value||uniform.value instanceof Texture||uniform.value.texture||uniform.value.rt&&uniform.value.rt.texture?"t":uniform.value instanceof Vector2?"v2":uniform.value instanceof Vector3||uniform.value instanceof Vector3D?"v3":uniform.value instanceof Vector4?"v4":uniform.value instanceof Matrix4?"m4":uniform.value instanceof Matrix3?"m3":uniform.value instanceof Color?"c":uniform.value instanceof Quaternion?"q":Array.isArray(uniform.value)&&uniform.value[0]instanceof Texture?"tv":"f"),uni.type){case"f":_gl.uniform1f(uLoc,uni.value);break;case"i":_gl.uniform1i(uLoc,Math.floor(uni.value));break;case"b":_gl.uniform1i(uLoc,uni.value);break;case"v2":_gl.uniform2f(uLoc,uni.value.x,uni.value.y);break;case"v3":_gl.uniform3f(uLoc,uni.value.x,uni.value.y,uni.value.z);break;case"c":_gl.uniform3f(uLoc,uni.value.r,uni.value.g,uni.value.b);break;case"q":case"v4":_gl.uniform4f(uLoc,uni.value.x,uni.value.y,uni.value.z,uni.value.w);break;case"v3v":_gl.uniform3fv(uLoc,toTypedArray(uni));break;case"v4v":_gl.uniform4fv(uLoc,toTypedArray(uni));break;case"v2v":_gl.uniform2fv(uLoc,toTypedArray(uni));break;case"fv":_gl.uniform1fv(uLoc,toTypedArray(uni));break;case"m4":_gl.uniformMatrix4fv(uLoc,!1,uni.value.elements);break;case"m3":_gl.uniformMatrix3fv(uLoc,!1,uni.value.elements);break;case"tv":uniformTextureArray(uni,uLoc,shader);break;case"t":let texture=uni.value;texture.isTexture||(uni.value.rt&&(texture=uni.value.rt.overrideTexture||uni.value.rt.texture),uni.value.texture&&(texture=uni.value.texture)),!1===texture.loaded&&(texture=Utils3D.getEmptyTexture());let texIndex=shader._gl.texIndex++;uni.value.vrRT&&(shader._gl.vrRT=!0,uni.value._glTexIndex=texIndex),Texture.renderer.draw(texture,uLoc,key,texIndex)}}}var uniform;if(!shader.glCustomState){if(shader.polygonOffset){let key=shader.polygonOffsetFactor+"_"+shader.polygonOffsetUnits;_cached.polygonOffset!=key&&(_gl.enable(_gl.POLYGON_OFFSET_FILL),_gl.polygonOffset(shader.polygonOffsetFactor,shader.polygonOffsetUnits)),_cached.polygonOffset=key}else _cached.polygonOffset&&_gl.disable(_gl.POLYGON_OFFSET_FILL),_cached.polygonOffset=!1;if(shader.transparent||shader.opacity?(_cached.transparent||_gl.enable(_gl.BLEND),_cached.transparent=!0):(_cached.transparent&&_gl.disable(_gl.BLEND),_cached.transparent=!1),_cached.blending!=shader.blending){switch(shader.blending){case Shader.ADDITIVE_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE);break;case Shader.PREMULTIPLIED_ALPHA_BLENDING:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA);break;case Shader.ADDITIVE_COLOR_ALPHA:_gl.blendEquation(_gl.FUNC_ADD),_gl.blendFunc(_gl.ONE,_gl.ONE);break;case Shader.MAX:_gl.blendEquation(WEBGL2?_gl.MAX:Renderer.extensions.minMax.MAX_EXT),_gl.blendFunc(_gl.ONE,_gl.ONE);break;case Shader.MIN:_gl.blendEquation(WEBGL2?_gl.MIN:Renderer.extensions.minMax.MIN_EXT),_gl.blendFunc(_gl.ONE,_gl.ONE);break;default:_gl.blendEquationSeparate(_gl.FUNC_ADD,_gl.FUNC_ADD),_gl.blendFuncSeparate(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA,_gl.ONE,_gl.ONE_MINUS_SRC_ALPHA)}_cached.blending=shader.blending}shader.depthTest?(_cached.depthTest||_gl.enable(_gl.DEPTH_TEST),_cached.depthTest=!0):(_cached.depthTest&&_gl.disable(_gl.DEPTH_TEST),_cached.depthTest=!1);let depthFunc=_gl[DEPTH_FUNC_KEYS[shader.depthFunc||Shader.DEPTH_FUNC_LESS]];if(_cached.depthFunc!==depthFunc&&(_gl.depthFunc(depthFunc),_cached.depthFunc=depthFunc),shader.stencilTest)if(_cached.stencilTest||_gl.enable(_gl.STENCIL_TEST),_cached.stencilTest=!0,shader.stencilMask)_gl.stencilFunc(_gl.ALWAYS,1,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.REPLACE),_gl.stencilMask(255),_gl.colorMask(!1,!1,!1,!1),_gl.disable(_gl.DEPTH_TEST);else{_gl.colorMask(!0,!0,!0,!0),_gl.enable(_gl.DEPTH_TEST);let mode="inside";_gl.stencilFunc("inside"==mode?_gl.EQUAL:_gl.NOTEQUAL,1,255),_gl.stencilOp(_gl.KEEP,_gl.KEEP,_gl.KEEP)}else _cached.stencilTest&&_gl.disable(_gl.STENCIL_TEST),_cached.stencilTest=!1;switch(shader.side){case Shader.BACK_SIDE:_cached.side!=Shader.BACK_SIDE&&(_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.FRONT),_cached.side=Shader.BACK_SIDE);break;case Shader.DOUBLE_SIDE:_cached.side!=Shader.DOUBLE_SIDE&&(_gl.disable(_gl.CULL_FACE),_cached.side=Shader.DOUBLE_SIDE);break;default:_cached.side!=Shader.FRONT_SIDE&&(_gl.enable(_gl.CULL_FACE),_gl.cullFace(_gl.BACK),_cached.side=Shader.FRONT_SIDE)}if(_cached.depthMask!=shader.depthWrite&&(_gl.depthMask(!!shader.depthWrite),_cached.depthMask=shader.depthWrite),shader.colorMask&&shader.colorMask.push)_gl.colorMask(shader.colorMask[0]||!1,shader.colorMask[1]||!1,shader.colorMask[2]||!1,shader.colorMask[3]||!1);else switch(shader.colorMask){case Shader.COLOR_MASK_NONE:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!0,!0,!0,!0),_cached.colorMask=shader.colorMask);break;case Shader.COLOR_MASK_RGB:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!1,!1,!1,!0),_cached.colorMask=shader.colorMask);break;case Shader.COLOR_MASK_RGBA:_cached.colorMask!=shader.colorMask&&(_gl.colorMask(!1,!1,!1,!1),_cached.colorMask=shader.colorMask)}}if(shader.customState)for(let i=0;i<shader.customState.length;i++){let obj=shader.customState[i];_gl[obj.fn].apply(_gl,obj.params)}},this.destroy=function(shader){delete shader._gl,shader.ubo&&shader.ubo.destroy()},this.appendUniform=function(shader,key,value,hint){let loc=shader._gl[key];if(void 0===loc&&(loc=loc=_gl.getUniformLocation(shader._gl.program,key)),null!==loc)if(value.isMatrix4)_gl.uniformMatrix4fv(loc,!1,value.elements);else if(value.isMatrix3)_gl.uniformMatrix3fv(loc,!1,value.elements);else if(value.isVector4)_gl.uniform4f(loc,value.x,value.y,value.z,value.w);else if(value.isQuaternion)_gl.uniform4f(loc,value.x,value.y,value.z,value.w);else if(value.isVector3)_gl.uniform3f(loc,value.x,value.y,value.z);else if(value.isVector2)_gl.uniform2f(loc,value.x,value.y);else if(value instanceof Float32Array)switch(hint){case"matrix":_gl.uniformMatrix4fv(loc,!1,value);break;case"float":_gl.uniform1fv(loc,value);break;case"vec3":_gl.uniform3fv(loc,value)}else if(Array.isArray(value)){let array=shader._gl.texArray||[];array.length=0,shader._gl.texArray=array;for(let i=0;i<value.length;i++)array.push(shader._gl.texIndex),_gl.activeTexture(_gl["TEXTURE"+shader._gl.texIndex++]),_gl.bindTexture(_gl.TEXTURE_2D,value[i]._gl);_gl.uniform1iv(loc,array)}else _gl.uniform1f(loc,value)},this.resetState=function(){_cached.depthMask||(_gl.depthMask(!0),_cached.depthMask=!0),_cached.depthTest||_gl.enable(_gl.DEPTH_TEST),_cached.depthTest=!0,_cached.depthFunc!==_gl.LESS&&_gl.depthFunc(_gl.LESS),_cached.depthFunc=_gl.LESS,_cached.colorMask!=Shader.COLOR_MASK_NONE&&(_gl.colorMask(!0,!0,!0,!0),_cached.colorMask=Shader.COLOR_MASK_NONE),_cached.program=null},this.clearState=function(){_cached={}},this.hotReload=function(file){file=file.split(".")[0].trim();for(let key in _pool)if(key.includes(file)&&!["|instance","|Line3D","|MergedLine"].find((part=>key.includes(part)))){let obj=_pool[key],rootShader=obj.references[0];for(let i=0;i<obj.references.length;i++){let shader=obj.references[i];0===i?(shader.restoreFS=shader.restoreVS=null,shader.resetProgram(),shader._gl={},shader._gl.program=createProgram(shader),shader._gl._id=_programID++,obj.program=shader._gl.program,obj.id=shader._gl._id):(shader.destroy(),shader.restoreFS=rootShader.restoreFS,shader.restoreVS=rootShader.restoreVS,shader.vertexShader=rootShader.vertexShader,shader.fragmentShader=rootShader.fragmentShader,shader._gl={},shader._gl.program=obj.program,shader._gl._id=obj.id),setupShaders(rootShader)}}},this.hotReloadClearProgram=function(id){for(let key in _pool)key.includes(id)&&delete _pool[key]}})),Class((function TextureRendererWebGL(_gl){const _this=this;var _state={};const FLOAT_DATA=new Float32Array([0,0,0,0]),UINT_DATA=new Uint32Array([0,0,0,0]),INT_DATA=new Int32Array([0,0,0,0]),DATA=new Uint8Array([0,0,0,0]),{getFormat:getFormat,getProperty:getProperty,getType:getType,getFloatParams:getFloatParams,getInternalFormat:getInternalFormat}=require("GLTypes");function setTextureParams(texture,textureType=_gl.TEXTURE_2D){let format=getFormat(texture),internalFormat=getInternalFormat(texture),type=getType(texture),data=DATA;switch(texture.type){case Texture.FLOAT:data=FLOAT_DATA;break;case Texture.UNSIGNED_INTEGER:data=UINT_DATA;break;case Texture.INTEGER:data=INT_DATA;break;case Texture.HALF_FLOAT:data=null}textureType!=_gl.TEXTURE_2D||texture.compressed||_gl.texImage2D(textureType,0,internalFormat,1,1,0,format,type,data),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),texture.data||texture.format!=Texture.RGBAFormat?1==_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):!1===texture.premultiplyAlpha?(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),_state.premultiply=!0),texture.anisotropy>1&&_gl.texParameterf(textureType,Renderer.extensions.anisotropy.TEXTURE_MAX_ANISOTROPY_EXT,texture.anisotropy)}function updateDynamic(texture){if(texture.isDataTexture){if(!0===texture.flipY?_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0):_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_state.flipY=!1),_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1),!texture.glFormat){let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);texture.iformat=internalformat,texture.glFormat=format,texture.glType=type}_gl.texSubImage2D(_gl.TEXTURE_2D,0,0,0,texture.width,texture.height,texture.glFormat,texture.glType,texture.data)}else{_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0),texture.format==Texture.RGBAFormat?!1===texture.premultiplyAlpha?(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1):(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),_state.premultiply=!0):_state.premultiply&&(_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_state.premultiply=!1),texture.glFormat||(texture.glFormat=getFormat(texture));try{_gl.texImage2D(_gl.TEXTURE_2D,0,texture.glFormat,texture.glFormat,getType(texture),texture.image)}catch(e){}}}this.draw=function(texture,loc,key,id){if((void 0===texture._gl||texture.needsReupload)&&this.upload(texture),_gl.activeTexture(_gl[`TEXTURE${id}`]),texture.cube)_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture._gl);else if(texture.isTexture3D)_gl.bindTexture(_gl.TEXTURE_3D,texture._gl);else{let texType=texture.EXT_OES?_gl.TEXTURE_EXTERNAL_OES:_gl.TEXTURE_2D;_gl.bindTexture(texType,texture._gl)}_gl.uniform1i(loc,id),(texture.dynamic||texture.needsUpdate)&&updateDynamic(texture),texture.needsUpdate=!1},this.upload=function(texture){if(texture._gl&&!texture.needsReupload&&!texture.needsUpdate)return;let format=getFormat(texture);if(Utils.query("debugUpload")&&console.log("?debugUpload – upload texture",texture),texture.cube){if(texture.compressed){if(1!==texture.cube.length)throw"Compressed cube texture requires 1 file with 6 faces"}else if(6!==texture.cube.length)throw"Cube texture requires 6 images";return function uploadCube(texture){if(void 0===texture._gl){texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture._gl);let needsFlipY=!0===texture.flipY;needsFlipY!==!!_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,needsFlipY),_state.flipY=needsFlipY),setTextureParams(texture,_gl.TEXTURE_CUBE_MAP)}let format=getFormat(texture);if(texture.compressed){let image=texture.cube[0];for(let i=0;i<image.compressedData.length;i++){let size=image.sizes[i],data=image.compressedData[i],faceLength=data.length/6;for(let j=0;j<6;j++)if(image.uncompressed){let view=new Uint8Array(data.buffer,j*faceLength,faceLength);_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+j,i,_gl.RGBA,size.width,size.height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,view)}else{let view=new DataView(data.buffer,j*faceLength,faceLength);_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+j,i,image.gliFormat,size.width||size,size.height||size,0,view)}}}else{for(let i=0;i<6;i++)_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,format,format,getType(texture),texture.cube[i]);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()}(texture)}if(texture.isTexture3D)return function uploadTexture3D(texture){if(void 0===texture._gl){let format=getFormat(texture),internalFormat=getInternalFormat(texture),type=getType(texture);texture._gl=_gl.createTexture(),_gl.bindTexture(_gl.TEXTURE_3D,texture._gl),_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_S,getProperty(texture.wrapS)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_T,getProperty(texture.wrapT)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_WRAP_R,getProperty(texture.wrapR)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_MAG_FILTER,getProperty(texture.magFilter)),_gl.texParameteri(_gl.TEXTURE_3D,_gl.TEXTURE_MIN_FILTER,getProperty(texture.minFilter)),_gl.texImage3D(_gl.TEXTURE_3D,0,internalFormat,texture.width,texture.height,texture.depth,0,format,type,texture.image),texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()}}(texture);let texType=texture.EXT_OES?_gl.TEXTURE_EXTERNAL_OES:_gl.TEXTURE_2D;if(void 0===texture._gl?(texture._gl=_gl.createTexture(),RenderCount.add("texture"),_gl.bindTexture(texType,texture._gl),setTextureParams(texture,texType)):_gl.bindTexture(texType,texture._gl),texture.isDataTexture||texture.type&&texture.type.includes("float")){!0===texture.flipY?_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0):_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_state.flipY=!1),_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,1);let{internalformat:internalformat,format:format,type:type}=getFloatParams(texture);if("ie"===Device.system.browser)try{_gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,texture.width,texture.height,0,format,type,texture.distributeTextureData?null:texture.data)}catch(e){console.log(e)}else _gl.texImage2D(_gl.TEXTURE_2D,0,internalformat,texture.width,texture.height,0,format,type,texture.distributeTextureData?null:texture.data);texture.destroyDataAfterUpload&&(texture.data=null,delete texture.data)}else{let needsFlipY=!texture.compressed&&!1!==texture.flipY;if(needsFlipY!==!!_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,needsFlipY),_state.flipY=needsFlipY),texture.image&&texture.compressed){let data=texture.image.compressedData;for(let i=0;i<data.length;i++){let size=texture.image.sizes[i];texture.image.uncompressed?_gl.texImage2D(_gl.TEXTURE_2D,i,_gl.RGBA,size.width,size.height,0,_gl.RGBA,_gl.UNSIGNED_BYTE,data[i]):_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,texture.image.gliFormat,size.width||size,size.height||size,0,data[i])}data.length=0}else if(texture.image&&!(texture.image instanceof HTMLVideoElement))try{_gl.texImage2D(_gl.TEXTURE_2D,0,format,format,getType(texture),texture.image)}catch(e){console.log("error loading texture",e,texture.image)}texture.distributeTextureData||RenderCount.add("tex_upload",texture)}(texture.image||texture.data)&&texture.generateMipmaps&&!texture.compressed&&_gl.generateMipmap(_gl.TEXTURE_2D),texture.needsUpdate=texture.needsReupload=!1,texture.onUpdate&&texture.onUpdate()},this.manualUpdateDynamic=function(texture){(void 0===texture._gl||texture.needsReupload)&&this.upload(texture),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),updateDynamic(texture)},this.uploadAsync=function(texture){let{format:format,type:type}=getFloatParams(texture);if(texture._uploadAsyncPromise)return texture._uploadAsyncPromise;texture._uploadAsyncPromise=Promise.create(),RenderCount.add("tex_uploadAsync",texture),texture._gl||(texture.distributeTextureData=!0,_this.upload(texture));let pixelsPerChunk=texture.height/4,dataPerChunk=texture.data.length/4,i=0,worker=new Render.Worker((function workerUploadAsync(){let pixelOffset=pixelsPerChunk*i,dataOffset=dataPerChunk*i,subarray=texture.data.subarray(dataOffset,dataOffset+dataPerChunk);!0===texture.flipY?_state.flipY||(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!0),_state.flipY=!0):_state.flipY&&(_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,!1),_state.flipY=!1),_gl.bindTexture(_gl.TEXTURE_2D,texture._gl),_gl.texSubImage2D(_gl.TEXTURE_2D,0,0,pixelOffset,texture.width,pixelsPerChunk,format,type,subarray),_gl.bindTexture(_gl.TEXTURE_2D,null),4==++i&&(worker.stop(),texture._uploadAsyncPromise.resolve())}));return texture._uploadAsyncPromise},this.destroy=function(texture){texture._gl&&(_gl.deleteTexture(texture._gl),RenderCount.remove("texture"),RenderCount.add("tex_destroy",texture)),texture.data&&(texture.data=null,delete texture.data),delete texture._gl}}));class RenderTarget{constructor(width,height,options={}){this.width=width,this.height=height,this.options=options,this.viewport=new Vector2(0,0),void 0===options.minFilter&&(options.minFilter=Texture.LINEAR),this.stencil="boolean"==typeof options.stencil&&options.stencil,options.sharedRenderbuffer&&(this.sharedRenderbuffer=!0,this.clearDepth="boolean"!=typeof options.clearDepth||options.clearDepth,this._depthBuffer=options.sharedRenderbuffer.rt._depthBuffer),this.texture=new Texture(null),this.texture.generateMipmaps=options.generateMipmaps,this.texture.rt=this,this.texture.width=width,this.texture.height=height,this.texture.minFilter=options.minFilter||Texture.LINEAR,this.texture.magFilter=options.magFilter||Texture.LINEAR,this.texture.wrapS=options.wrapS||Texture.CLAMP_TO_EDGE,this.texture.wrapT=options.wrapT||Texture.CLAMP_TO_EDGE,this.texture.format=options.format||Texture.RGBFormat,options.type&&(this.texture.type=options.type),options.multisample&&(Renderer.type?Renderer.type==Renderer.WEBGL2:Device.graphics.webgl.webgl2)&&(options.multisample=!1,this.multisample=!0,this._rtMultisample=new RenderTarget(width,height,options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=void 0===options.samplesAmount?100:options.samplesAmount),this.isRT=!0}setSize(width,height){this.width=width,this.height=height,this.texture.width=width,this.texture.height=height,this.viewport.set(0,0),RenderTarget.renderer.resize(this),!this.multisample||this._rtMultisample.width===width&&this._rtMultisample.height===height||(this._rtMultisample.destroy(),this._rtMultisample=new RenderTarget(width,height,this.options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=void 0===this.options.samplesAmount?100:this.options.samplesAmount)}clone(){return new RenderTarget(this.width,this.height,{...this.options}).copy(this)}copy(source){this.width=source.width,this.height=source.height;let options={...this.options};return this.options=options,this.viewport.copy(source.viewport),this.stencil=source.stencil,source.sharedRenderbuffer&&(this.sharedRenderbuffer=!0,this.clearDepth=source.clearDepth,this._depthBuffer=source._depthBuffer),this.texture=source.texture.clone(),source.multisample&&(options.multisample=!1,this.multisample=!0,this._rtMultisample=new RenderTarget(this.width,this.height,options),this._rtMultisample.internalMultisample=!0,this._rtMultisample.parent=this,this._rtMultisample._samplesAmount=source._rtMultisample._samplesAmount),this}createDepthTexture(){return this.depth=new Texture(null),this.depth.generateMipmaps=!1,this.depth.minFilter=Texture.NEAREST,this.depth.magFilter=Texture.NEAREST,this.depth.wrapS=Texture.CLAMP_TO_EDGE,this.depth.wrapT=Texture.CLAMP_TO_EDGE,this.depth}destroy(){RenderTarget.renderer.destroy(this)}upload(){this._gl||RenderTarget.renderer.upload(this),this._rtMultisample&&this._rtMultisample.upload()}}class MultiRenderTarget extends RenderTarget{constructor(width,height,options={}){super(width,height,options),this.multi=!0,this.attachments=[this.texture]}}class CubeRenderTarget extends RenderTarget{constructor(width,height,options={}){super(width,height,options),this.activeFace=0,this.cube=!0}}Class((function Shader(_vertexShader,_fragmentShader,_params,_onBeforeBuild,_postfix){"object"==typeof _vertexShader&&(_fragmentShader=_vertexShader.uniforms,_vertexShader=_vertexShader.name);const _this=this;this.uniforms=Shader.createUniforms(this),this.side=Shader.FRONT_SIDE,this.blending=Shader.NORMAL_BLENDING,this.colorMask=Shader.COLOR_MASK_NONE,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=1,this.depthTest=!0,this.depthWrite=!0,this.ssReflections=_params?.ssReflections||!1,this.depthFunc=Shader.DEPTH_FUNC_LESS,this.stencilTest=!1,this.stencilMask=!1,this.wireframe=!1,this.transparent=!1,this.visible=!0,this.persists=!1,this.precision="high",this.customCompile=_params?.customCompile||"",this.onBeforePrecompilePromise=Promise.create(),"string"!=typeof _fragmentShader&&(_params=_fragmentShader,_fragmentShader=_vertexShader),_params=_params||{},_this.vsParam=_vertexShader,_this.fsParam=_fragmentShader,_this.params=_params,_this.onBeforeBuild=_onBeforeBuild,_this.vsName=_vertexShader,_this.fsName=(_fragmentShader||_vertexShader)+(_postfix||""),_params.vsName&&(_this.vsName=_params.vsName,delete _params.vsName),_params.precision&&(_this.precision=_params.precision),_params.receiveShadow&&(_this.receiveLight=!0,World.RENDERER.shadows&&(_this.precision="high"));let vs=_vertexShader,fs=_fragmentShader;_params.uilFrom&&(vs=_params.uilFrom,fs=_params.uilFrom,delete _params.uilFrom),_this.UILPrefix=_params.UILPrefix||`${vs}/${fs}/${_params.unique?_params.unique+"/":""}`,Shader.parseParams(_params,_this),Shader.renderer.findCachedProgram(_this)||Shader.hasAlreadyPreProcessed(_this)||Shader.runPreProcess(_this)}),(_=>{function getLightingCode(_this){if(!_this.receiveShadow&&Shader.shouldReceiveShadow(_this)&&(_this.receiveShadow=!0),!_this.receiveLight||_this.isShadow)return"";let numLights=Lighting.getLighting(_this).position.length/4;return 0==numLights?Lighting.getShadowUniforms(_this):[`#define NUM_LIGHTS ${numLights}`,"uniform lights {",`vec4 lightPos[${numLights}];`,`vec4 lightColor[${numLights}];`,`vec4 lightData[${numLights}];`,`vec4 lightData2[${numLights}];`,`vec4 lightData3[${numLights}];`,`vec4 lightProperties[${numLights}];`,"};"].join("\n")+Lighting.getShadowUniforms(_this)}function setupssReflections(code,type,_this){if("vs"==type){if(!code.includes("vec3 pos = position;"))throw`Shader ${_this.vsName} needs to have "vec3 pos = position;" in order for dynamic merging to work`;let vsDeferred="\n            vPosDeferred = modelViewMatrix * vec4(pos, 1.);\n            vNormalDeferred = normalMatrix * normal;\n            vST = uv;\n            ",main=code.split("vec3 pos = position;");main[1]="\n"+vsDeferred+main[1],code=main.join("vec3 pos = position;")}return code}Shader.FRONT_SIDE="shader_front_side",Shader.BACK_SIDE="shader_back_side",Shader.DOUBLE_SIDE="shader_double_side",Shader.DOUBLE_SIDE_TRANSPARENCY="shader_double_side_trasparency",Shader.ADDITIVE_BLENDING="shader_additive_blending",Shader.NORMAL_BLENDING="shader_normal_blending",Shader.PREMULTIPLIED_ALPHA_BLENDING="shader_premultiplied_alpha_blending",Shader.ADDITIVE_COLOR_ALPHA="shader_additive_color_alpha",Shader.MAX="shader_max",Shader.MIN="shader_min",Shader.CUSTOM_DEPTH="shader_custom_depth",Shader.COLOR_MASK_RGB="shader_colormask_rgb",Shader.COLOR_MASK_RGBA="shader_colormask_rgba",Shader.COLOR_MASK_NONE="shader_colormask_none",Shader.DEPTH_FUNC_NEVER="shader_depth_func_never",Shader.DEPTH_FUNC_LESS="shader_depth_func_less",Shader.DEPTH_FUNC_EQUAL="shader_depth_func_equal",Shader.DEPTH_FUNC_LEQUAL="shader_depth_func_lequal",Shader.DEPTH_FUNC_GREATER="shader_depth_func_greater",Shader.DEPTH_FUNC_NOTEQUAL="shader_depth_func_notequal",Shader.DEPTH_FUNC_GEQUAL="shader_depth_func_gequal",Shader.DEPTH_FUNC_ALWAYS="shader_depth_func_always",Shader.parseParams=function(_params,_this){for(let key in _params)if("receiveShadow"==key)_this.receiveShadow=_params[key];else if("receiveLight"==key)_this.receiveLight=_params[key];else if(_params[key]&&void 0!==_params[key].value)window.UILStorage&&UILStorage.hasData()?(_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key,_params[key].value)||_params[key],_params[key].ubo&&(_this.uniforms[key].ubo=!0)):_this.uniforms[key]=_params[key];else{if("unique"==key)continue;_this[key]=_params[key]}},Shader.runPreProcess=function(shader){if(shader.vertexShader=Shader.process(Shaders.getShader(shader.vsParam+".vs"),"vs",shader,shader.onBeforeBuild),shader.fragmentShader=Shader.process(Shaders.getShader(shader.fsParam+".fs"),"fs",shader,shader.onBeforeBuild),shader.vertexShader.includes("//js")&&!window[shader.vsName]){let code=shader.vertexShader.split("\n"),adders=[];code.forEach((line=>{if(line.includes("//js")){let name=line.split(" ")[2].replace(";",""),value=line.split("//js ")[1].replace(";","");adders.push((obj=>{obj[name]={value:eval(value)}}))}else if(line.includes("sampler2D")){let name=line.split(" ")[2].replace(";","");adders.push((obj=>{obj[name]={value:null}}))}})),window[shader.vsName]=function(_mesh,_shader){let uniforms={};adders.forEach((addTo=>addTo(uniforms))),_shader.addUniforms(uniforms)}}},Shader.process=function(code,type,_this,_onBeforeBuild){const WEBGL2=Renderer.type==Renderer.WEBGL2;if(!code)throw"No shader found! "+_this.vsName+" | "+_this.fsName;const externalOES=code.includes("samplerExternalOES")&&window.AURA&&"android"==Device.system.os,standardDeriv=!WEBGL2&&code.includes(["fwidth","dFdx","dFdy"]),drawBuffers=!WEBGL2&&code.includes(["gl_FragData","#drawbuffer"])&&window.World&&World.NUKE.useDrawBuffers;let levelOfDetail=!WEBGL2&&code.includes(["textureGrad","textureProjGrad","texture2DGrad","textureCubeGrad","texture2DProjGrad"]);levelOfDetail||WEBGL2||"fs"!==type||(levelOfDetail=code.includes(["textureLod","texture2DLod","textureCubeLod","texture2DProjLod"]));const layoutsDefined=code.includes("layout")||_this.ssReflections;let header;if(header="vs"==type?["#version 300 es",externalOES?"#extension GL_OES_EGL_image_external_essl3 : require":"",levelOfDetail?"#extension GL_EXT_shader_texture_lod : enable":"",`precision ${_this.precision}p float;`,`precision ${_this.precision}p int;`,WEBGL2?`precision ${_this.precision}p sampler3D;`:"",WEBGL2?`precision ${_this.precision}p usampler2D;`:"",WEBGL2?`precision ${_this.precision}p isampler2D;`:"","attribute vec2 uv;","attribute vec3 position;","attribute vec3 normal;","uniform mat3 normalMatrix;","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform global {","mat4 projectionMatrix;","mat4 viewMatrix;","vec3 cameraPosition;","vec4 cameraQuaternion;","vec2 resolution;","float time;","float timeScale;","};"].join("\n"):["#version 300 es",externalOES?"#extension GL_OES_EGL_image_external_essl3 : require":"",standardDeriv?"#extension GL_OES_standard_derivatives : enable":"",drawBuffers?"#extension GL_EXT_draw_buffers : require":"",levelOfDetail?"#extension GL_EXT_shader_texture_lod : enable":"",`precision ${_this.precision}p float;`,`precision ${_this.precision}p int;`,WEBGL2?`precision ${_this.precision}p sampler3D;`:"",WEBGL2?`precision ${_this.precision}p usampler2D;`:"",WEBGL2?`precision ${_this.precision}p isampler2D;`:"","uniform mat3 normalMatrix;","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform global {","mat4 projectionMatrix;","mat4 viewMatrix;","vec3 cameraPosition;","vec4 cameraQuaternion;","vec2 resolution;","float time;","float timeScale;","};",layoutsDefined?"":"out vec4 FragColor;"].join("\n"),header+="\n__ACTIVE_THEORY_LIGHTS__\n\n",window.AURA&&(header+="#define AURA\n"),_this.defines&&_this.defines.forEach((d=>header+=`#define ${d.toUpperCase()}\n`)),_onBeforeBuild&&(code=_onBeforeBuild(code,type)),_this.ssReflections){let GIVaryings=["uniform float ssReflectivity;","uniform float ssIORrefl;","uniform float ssRougness;","uniform float ssgiIntensity;","uniform sampler2D tReflectivity;","uniform sampler2D tRoughness;","varying vec4 vPosDeferred;","varying vec3 vNormalDeferred;","varying vec2 vST;"].join("\n");header+=GIVaryings}let split=code.split("\n");for(let i=split.length-1;i>-1;i--){let line=split[i];if(line.includes("uniform sampler2D")){let name=line.split("sampler2D ")[1].replace(";","").trim();_this.uniforms[name]||(_this.uniforms[name]={value:null})}}if(code=header+code,_this.ssReflections&&"fs"==type){let buffersDeferred="\n            float ssReflectionMap = texture(tReflectivity, vST).r;\n            float ssRougnessMap = texture(tRoughness, vST).r;\n            #drawbuffer PositionLayer gl_FragColor = vPosDeferred;\n            #drawbuffer NormalsLayer gl_FragColor = vec4(vNormalDeferred, 1.);\n            #drawbuffer ReflectivityLayer gl_FragColor = vec4(ssIORrefl, ssReflectivity * ssReflectionMap, ssRougness * ssRougnessMap, ssgiIntensity);\n            ",main=code.split("main() {");main[1]="\n"+buffersDeferred+main[1],code=main.join("main() {")}return code};const prototype=Shader.prototype;prototype.copyUniformsTo=function(shader,linked,ignore){for(let key in this.uniforms)void 0!==this.uniforms[key]&&(ignore&&ignore.includes?.(key)||(shader.uniforms[key]=linked?this.uniforms[key]:{type:this.uniforms[key].type,value:this.uniforms[key].value}))},prototype.replicateUniformsTo=function(shader){shader.uniforms=this.uniforms,shader._uniformKeys=this._uniformKeys,shader._uniformValues=this._uniformValues},prototype.addUniforms=function(uniforms){uniforms.UILPrefix&&(this.UILPrefix=uniforms.UILPrefix,delete uniforms.UILPrefix);for(let key in uniforms)this.hotReloading&&this.uniforms[key]||(this.uniforms[key]=uniforms[key])},prototype.draw=function(mesh,geom){this.receiveLight&&!this.__lighting&&Lighting.getLighting(this),Shader.renderer.draw(this,mesh,geom)},prototype.upload=function(mesh,geom){!this.receiveShadow&&Shader.shouldReceiveShadow(this)&&(this.receiveShadow=!0),Shader.renderer.upload(this,mesh,geom),this.receiveShadow&&!this.shadow&&Lighting.initShadowShader(this,mesh)},prototype.destroy=function(){this.persists||(Shader.renderer.destroy(this),this.shadow&&this.shadow.destroy()),this.receiveLight&&Lighting.destroyShader(this)},prototype.onBeforeCompile=function(code,type){const WEBGL2=Renderer.type==Renderer.WEBGL2;"}"!=(code=code.trim())[code.length-1]&&(code+="\n}");let p=this.mesh,scene=World.SCENE;for(;p;)p instanceof Scene&&(scene=p),p=p._parent;scene.nuke&&scene.nuke.onBeforeShaderCompile?scene.nuke.onBeforeShaderCompile(this.mesh):this.onBeforePrecompilePromise.resolve(),this.receiveShadow&&(this.receiveLight=!0);let varyings=[],uniforms=[];this.ssReflections&&(code=setupssReflections(code,type,this)),(code=code.split("\n")).forEach(((line,index)=>{"fs"==type&&line.includes("#drawbuffer")&&(line.includes("#drawbuffer Color")?code[index]=line.replace("#drawbuffer Color",""):code[index]=""),line.includes("varying")&&varyings.push(line.trim()),line.includes("uniform")&&uniforms.push(line.trim())})),code=code.join("\n");const process=function(array){let replace,counts=[];array.forEach((value=>{let count=0;array.forEach((v2=>{value==v2&&count++})),count>1&&(replace||(replace=[]),replace.includes(value)||(replace.push(value),counts.push(count)))})),replace&&replace.forEach(((value,i)=>{let count=counts[i];for(let j=0;j<count-1;j++){let index=code.lastIndexOf(value);code=code.substring(0,index)+code.substring(index+value.length)}}))};process(varyings),process(uniforms),"fs"==type&&(WEBGL2?code.includes("gl_FragColor")&&(code=code.replace(/gl_FragColor/g,"FragColor")):code.includes("#applyShadow")&&(code=code.replace("#applyShadow",""))),code=code.replace("__ACTIVE_THEORY_LIGHTS__",getLightingCode(this)),"fs"==type&&code.includes("SHADOW_MAPS")&&(code=require("GLSLOptimizer")(code.replaceAll("SHADOW_COUNT",Lighting.getShadowCount(this)))),this.preCompile&&(code=this.preCompile(code,type));let converter=require("ShaderCode");return code=WEBGL2?converter.convertWebGL2(code,type):converter.convertWebGL1(code,type)},prototype.set=function(key,value,ref){let _this=ref||this;return _this.uniforms[key]?(void 0!==value&&(TweenManager.clearTween(_this.uniforms[key]),_this.uniforms[key].value=value,_this.ubo&&(_this.ubo.needsUpdate=!0)),_this.uniforms[key].value):console.warn(`No key ${key} found on shader`,_this)},prototype.get=function(key,ref){let _this=ref||this;return _this.uniforms[key]&&_this.uniforms[key].value},prototype.tween=function(key,value,time,ease,delay,callback,update,scaledTime){return"number"==typeof value?tween(this.uniforms[key],{value:value},time,ease,delay,callback,update,null,scaledTime):tween(this.uniforms[key].value,value,time,ease,delay,callback,update,null,scaledTime)},prototype.clone=function(noShadows,postfix){const _this=this;noShadows&&(_this.params.receiveShadow=!1);let shader=new Shader(_this.vsParam,_this.fsParam,_this.params,null,postfix);for(let key in _this)key.includes(["vsName","fsName","uniforms","_uniform","_gl"])||"function"==typeof _this[key]||(shader[key]=_this[key]);for(let key in _this.uniforms)shader.uniforms[key]={type:_this.uniforms[key].type,value:_this.uniforms[key].value};return shader},prototype.resetProgram=function(){this.destroy(),this.vertexShader=this.restoreVS||Shader.process(Shaders.getShader(this.vsName+".vs"),"vs",this,this.onBeforeBuild),this.fragmentShader=this.restoreFS||Shader.process(Shaders.getShader(this.fsName+".fs"),"fs",this,this.onBeforeBuild)};var _shaderShadowMap={},_emptyShadowMap;Object.defineProperty(prototype,"receiveShadow",{set:function(v){_shaderShadowMap[this.vsName+"_"+this.fsName]=v,this._receiveShadow=v,v&&!this.uniforms.shadowMap&&(_emptyShadowMap||(_emptyShadowMap=[Utils3D.getEmptyTexture()]),this.uniforms.shadowMap={value:_emptyShadowMap})},get:function(){return this._receiveShadow}});let shaders={};Shader.hasAlreadyPreProcessed=function(shader){let key=shader.vsName+"_"+shader.vsName+"_"+shader.customCompile;return shaders[key]},Shader.registerPreProcess=function(shader){let key=shader.vsName+"_"+shader.vsName+"_"+shader.customCompile;shaders[key]=!0},Shader.shouldReceiveShadow=function(shader){return _shaderShadowMap[shader.vsName+"_"+shader.fsName]}})),Shader.createUniforms=function(shader){let uniforms={},handler={set(target,property,value){target[property]=value,shader._uniformKeys.length=0,shader._uniformValues.length=0;for(let key in uniforms)shader._uniformKeys.push(key),shader._uniformValues.push(uniforms[key]);return!0}};return shader._uniformValues=[],shader._uniformKeys=[],new Proxy(uniforms,handler)};class Texture{constructor(img){this.magFilter=Texture.LINEAR,this.minFilter=Texture.LINEAR_MIPMAP,this.format=Texture.RGBAFormat,this.wrapS=this.wrapT=Texture.CLAMP_TO_EDGE,this._image=img,this.needsUpdate=!0,this.generateMipmaps=!0,this.anisotropy=1,this.type=Texture.UNSIGNED_BYTE,this.isTexture=!0,img&&img.onCreateTexture&&img.onCreateTexture(this)}set image(img){this._image=img,img&&img.onCreateTexture&&img.onCreateTexture(this)}get image(){return this._image}upload(){this._gl||Texture.renderer.upload(this)}destroy(){Texture.renderer.destroy(this),this._image=null}clone(){let texture=new Texture(this.img);return texture.format=this.format,texture.type=this.type,texture.anisotropy=this.anisotropy,texture.wrapS=this.wrapS,texture.wrapT=this.wrapT,texture.generateMipmaps=this.generateMipmaps,texture.minFilter=this.minFilter,texture.magFilter=this.magFilter,texture}}class DataTexture extends Texture{constructor(data,width,height,format,type,filter=null){super(),format&&(this.format=format),this.width=width,this.height=height,this.data=data,this.minFilter=this.magFilter=filter||Texture.NEAREST,this.generateMipmaps=!1,this.type=type||Texture.FLOAT,this.isDataTexture=!0,this.destroyDataAfterUpload=!1}uploadAsync(){return Texture.renderer.uploadAsync(this)}}class Texture3D extends Texture{constructor(image,width,height,depth,format,type,filter=null){super(),this.format=format||Texture.RGBAFormat,this.width=width,this.height=height,this.depth=depth,this.image=image,this.minFilter=this.magFilter=filter||Texture.LINEAR,this.wrapS=this.wrapT=this.wrapR=Texture.CLAMP_TO_EDGE,this.generateMipmaps=!1,this.type=type||Texture.FLOAT,this.isTexture3D=!0}}Texture.NEAREST="texture_nearest",Texture.CLAMP_TO_EDGE="texture_clamp",Texture.REPEAT="texture_repeat",Texture.MIRROR_REPEAT="texture_mirror_repeat",Texture.LINEAR="texture_linear",Texture.LINEAR_MIPMAP="texture_linear_mip",Texture.LINEAR_MIPMAP_NEAREST="texture_linear_mip_nearest",Texture.NEAREST_MIPMAP="texture_nearest_mip",Texture.RFormat="texture_rFormat",Texture.RGFormat="texture_rgFormat",Texture.RGBFormat="texture_rgbFormat",Texture.RGBAFormat="texture_rgbaFormat",Texture.UNSIGNED_BYTE="texture_unsigned_byte",Texture.DEPTH="texture_depth",Texture.FLOAT="texture_float",Texture.HALF_FLOAT="texture_half_float",Texture.UNSIGNED_INTEGER="texture_unsigned_integer",Texture.INTEGER="texture_integer",Module((function GLSLOptimizer(){this.exports=function(code){return function unrollLoops(string){return string.replace(/#pragma unroll_loop[\s]+?for \(int i \= (\d+)\; i < (\d+)\; i\+\+\) \{([\s\S]+?)(?=\})\}/g,(function replace(match,start,end,snippet){let unroll="";for(let i=parseInt(start);i<parseInt(end);i++)unroll+=snippet.replace(/\[i\]/g,"["+i+"]");return unroll}))}(code)}})),Module((function GLTypes(){function getFormat(texture){let _gl=Renderer.context,integer=texture.type===Texture.UNSIGNED_INTEGER||texture.type===Texture.INTEGER;switch(texture.format){case Texture.RGBAFormat:return integer?_gl.RGBA_INTEGER:_gl.RGBA;case Texture.RGBFormat:return integer?_gl.RGB_INTEGER:_gl.RGB;case Texture.RGFormat:return integer?_gl.RG_INTEGER:_gl.RG;case Texture.RFormat:return integer?_gl.RED_INTEGER:_gl.RED}}function getInternalFormat(texture){let _gl=Renderer.context;if(Renderer.type!==Renderer.WEBGL2)return texture.format===Texture.RGBAFormat?_gl.RGBA:_gl.RGB;switch(texture.format){case Texture.RGBAFormat:switch(texture.type){case Texture.FLOAT:return _gl.RGBA32F;case Texture.HALF_FLOAT:return _gl.RGBA16F;case Texture.UNSIGNED_INTEGER:return _gl.RGBA32UI;case Texture.INTEGER:return _gl.RGBA32I;case Texture.UNSIGNED_BYTE:return _gl.RGBA8}break;case Texture.RGBFormat:switch(texture.type){case Texture.FLOAT:return _gl.RGB32F;case Texture.HALF_FLOAT:return _gl.RGB16F;case Texture.UNSIGNED_INTEGER:return _gl.RGB32UI;case Texture.INTEGER:return _gl.RGB32I;case Texture.UNSIGNED_BYTE:return _gl.RGB8}break;case Texture.RGFormat:switch(texture.type){case Texture.FLOAT:return _gl.RG32F;case Texture.HALF_FLOAT:return _gl.RG16F;case Texture.UNSIGNED_INTEGER:return _gl.RG32UI;case Texture.INTEGER:return _gl.RG32I;case Texture.UNSIGNED_BYTE:return _gl.RG8}break;case Texture.RFormat:switch(texture.type){case Texture.FLOAT:return _gl.R32F;case Texture.HALF_FLOAT:return _gl.R16F;case Texture.UNSIGNED_INTEGER:return _gl.R32UI;case Texture.INTEGER:return _gl.R32I;case Texture.UNSIGNED_BYTE:return _gl.R8}}}function getType(texture){let _gl=Renderer.context;switch(texture.type){case Texture.FLOAT:return _gl.FLOAT;case Texture.HALF_FLOAT:return Renderer.type==Renderer.WEBGL2?_gl.HALF_FLOAT:Renderer.extensions.halfFloat.HALF_FLOAT_OES;case Texture.UNSIGNED_INTEGER:return _gl.UNSIGNED_INT;case Texture.INTEGER:return _gl.INT;default:return _gl.UNSIGNED_BYTE}}this.exports={getFormat:getFormat,getInternalFormat:getInternalFormat,getProperty:function getProperty(property){let _gl=Renderer.context;switch(property){case Texture.NEAREST:return _gl.NEAREST;case Texture.LINEAR:return _gl.LINEAR;case Texture.LINEAR_MIPMAP:return _gl.LINEAR_MIPMAP_LINEAR;case Texture.NEAREST_MIPMAP:return _gl.NEAREST_MIPMAP_LINEAR;case Texture.LINEAR_MIPMAP_NEAREST:return _gl.LINEAR_MIPMAP_NEAREST;case Texture.CLAMP_TO_EDGE:return _gl.CLAMP_TO_EDGE;case Texture.REPEAT:return _gl.REPEAT;case Texture.MIRROR_REPEAT:return _gl.MIRRORED_REPEAT}},getType:getType,getFloatParams:function getFloatParams(texture){return{internalformat:getInternalFormat(texture),format:getFormat(texture),type:getType(texture)}}}})),Module((function ShaderCode(){let textureExpression=/texture(2D|Cube)?(\w+)?\s*\(/g;function removeUBO(code,name){let uniforms=code.split(`uniform ${name} {`)[1];uniforms=uniforms.split("};")[0],uniforms=uniforms.split("\n"),uniforms.forEach((u=>{(u=u.trim()).length&&(code=code.replace(u,"uniform "+u))}));let split=code.split(`uniform ${name} {`);return split[1]=split[1].replace("};",""),code=(code=split.join("")).replace(`uniform ${name} {`,"")}this.exports={convertWebGL1:function convertWebGL1(code,type){return(code=(code=code.replace("#version 300 es","")).replace("out vec4 FragColor;","")).includes("samplerExternalOES")&&(code=code.replace("samplerExternalOES","sampler2D")),(code=code.replace(textureExpression,(function(match,samplerType,suffix="",offset,origCode){if(!samplerType){let name=origCode.substring(offset+match.length).split(",",1)[0]?.trim();name&&(samplerType=new RegExp(`sampler(\\w+)\\s+${name}`).exec(origCode)?.[1]),samplerType||(samplerType="2D")}if(suffix.endsWith("EXT")&&(suffix=suffix.slice(0,-3)),"vs"===type&&["Lod","ProjLod"].includes(suffix))return`texture${samplerType}${suffix}(`;if(["Lod","Grad","ProjLod","ProjGrad"].includes(suffix)){if(Renderer.extensions.lod)return`texture${samplerType}${suffix}EXT(`;suffix.endsWith("Lod")&&(suffix=suffix.slice(0,-3))}return`texture${samplerType}${suffix}(`}))).includes("uniform global {")&&(code=removeUBO(code,"global")),code.includes("uniform ubo {")&&(code=removeUBO(code,"ubo")),code.includes("uniform lights {")&&(code=removeUBO(code,"lights")),code},convertWebGL2:function convertWebGL2(code,type){return!(code=(code="vs"==type?(code=code.replace(/attribute/g,"in")).replace(/varying/g,"out"):code.replace(/varying/g,"in")).replace(textureExpression,(function(match,samplerType,suffix=""){return suffix.endsWith("EXT")&&(suffix=suffix.slice(0,-3)),`texture${suffix}(`}))).includes("samplerExternalOES")||"android"==Device.system.os&&window.AURA||(code=code.replace("samplerExternalOES","sampler2D")),Renderer.UBO?(code.includes("uniform global {")&&(code=code.replace("uniform global","layout(std140) uniform global")),code.includes("uniform ubo {")&&(code=code.replace("uniform ubo","layout(std140) uniform ubo")),Lighting.UBO?code.includes("uniform lights {")&&(code=code.replace("uniform lights","layout(std140) uniform lights")):code.includes("uniform lights {")&&(code=removeUBO(code,"lights"))):(code.includes("uniform global {")&&(code=removeUBO(code,"global")),code.includes("uniform ubo {")&&(code=removeUBO(code,"ubo")),code.includes("uniform lights {")&&(code=removeUBO(code,"lights"))),code}}}));class UBO{constructor(location,gl=Renderer.context){this.gl=gl,this.arrays=[];for(let i=0;i<30;i++)this.arrays.push([]);this.arrayIndex=0,this.objects=[],this.location=location,this.data=null,this.lastUpdate=0}_getSize(uniform){let obj=uniform.value;return Array.isArray(obj)?uniform.components?obj.length/uniform.components*16:16*obj.length:obj instanceof Vector2?8:obj instanceof Vector3||obj instanceof Vector4||obj instanceof Color?16:obj instanceof Matrix4?64:obj instanceof Matrix3?48:obj instanceof Quaternion?16:4}_getValues(uniform){let obj=uniform.value;return Array.isArray(obj)?obj:obj instanceof Vector2?this._array(obj.x,obj.y):obj instanceof Vector3?this._array(obj.x,obj.y,obj.z):obj instanceof Matrix4||obj instanceof Matrix3?obj.elements:obj instanceof Color?this._array(obj.r,obj.g,obj.b):obj instanceof Quaternion?this._array(obj.x,obj.y,obj.z,obj.w):this._array(obj)}_array(){this.arrayIndex++>=this.arrays.length-1&&(this.arrayIndex=0);let array=this.arrays[this.arrayIndex];return array.length=0,array.push.apply(array,arguments),array}clear(){for(let i=0;i<this.arrays.length;i++)this.arrays[i].length=0}calculate(){let len=this.objects.length,chunk=16,tsize=0,offset=0,size=0;for(let i=0;i<len;i++){let obj=this.objects[i];size=this._getSize(obj),tsize=chunk-size,tsize<0&&chunk<16?(offset+=chunk,i>0&&(this.objects[i-1].chunkLen+=chunk),chunk=16):tsize<0&&16==chunk||(0==tsize?chunk=16:chunk-=size),obj.offset=offset/4,obj.chunkLen=size/4,obj.dataLen=size/4,offset+=size}return offset%16!=0&&(this.objects[this.objects.length-1].chunkLen+=chunk/4,offset+=chunk),offset/4}compileData(){let i,array=this._array(),len=this.calculate();for(i=0;i<len;i++)array[i]=0;for(i=0;i<this.objects.length;i++){let obj=this.objects[i],values=this._getValues(obj);for(let j=0;j<values.length;j++)array[obj.offset+j]=values[j]}return array}upload(){if(this.data)return;let gl=Renderer.context,array=this.compileData();array.length&&(this.data=new Float32Array(array),this.buffer=gl.createBuffer(),gl.bindBuffer(gl.UNIFORM_BUFFER,this.buffer),gl.bufferData(gl.UNIFORM_BUFFER,this.data,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.UNIFORM_BUFFER,null),gl.bindBufferBase(gl.UNIFORM_BUFFER,this.location,this.buffer))}bind(program,name){this.data||this.upload(),this.needsUpdate&&this.update();let location,gl=Renderer.context;location=program==this.lastProgram&&name==this.lastName&&void 0!==this.lastLocation?this.lastLocation:gl.getUniformBlockIndex(program,name),location>99999||-1==location||(gl.uniformBlockBinding(program,location,this.location),gl.bindBufferBase(gl.UNIFORM_BUFFER,this.location,this.buffer),this.lastProgram=program,this.lastName=name,this.lastLocation=location)}update(){if(this.data||this.upload(),!this.data)return;let gl=Renderer.context,array=this.compileData();array.length!=this.data.length&&(this.data=new Float32Array(array),this.upload()),this.data.set(array),gl.bindBuffer(gl.UNIFORM_BUFFER,this.buffer),gl.bufferSubData(gl.UNIFORM_BUFFER,0,this.data),gl.bindBuffer(gl.UNIFORM_BUFFER,null),this.needsUpdate=!1}unbind(){}push(){if(this.data)throw"Can't modify UBO after initial upload!";for(let i=0;i<arguments.length;i++)this.objects.push(arguments[i])}destroy(){this.gl.deleteBuffer(this.buffer)}}class VAO{constructor(gl){this.gl=gl,this.WEBGL2=Renderer.type==Renderer.WEBGL2,this.WEBGL2?this.vao=gl.createVertexArray():this.vao=Renderer.extensions.VAO.createVertexArrayOES()}bind(){const gl=this.gl;this.WEBGL2?gl.bindVertexArray(this.vao):Renderer.extensions.VAO.bindVertexArrayOES(this.vao)}unbind(){const gl=this.gl;this.WEBGL2?gl.bindVertexArray(null):Renderer.extensions.VAO.bindVertexArrayOES(null)}destroy(){const gl=this.gl;this.WEBGL2?gl.deleteVertexArray(this.vao):Renderer.extensions.VAO.deleteVertexArrayOES(this.vao),this.vao=null}}class BoxGeometry extends Geometry{constructor(width=1,height=1,depth=1,widthSegments=1,heightSegments=1,depthSegments=1){super(),widthSegments=Math.floor(widthSegments),heightSegments=Math.floor(heightSegments),depthSegments=Math.floor(depthSegments);let indices=[],vertices=[],normals=[],uvs=[],numberOfVertices=0;function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){let ix,iy,segmentWidth=width/gridX,segmentHeight=height/gridY,widthHalf=width/2,heightHalf=height/2,depthHalf=depth/2,gridX1=gridX+1,gridY1=gridY+1,vertexCounter=0,vector=new Vector3;for(iy=0;iy<gridY1;iy++){let y=iy*segmentHeight-heightHalf;for(ix=0;ix<gridX1;ix++){let x=ix*segmentWidth-widthHalf;vector[u]=x*udir,vector[v]=y*vdir,vector[w]=depthHalf,vertices.push(vector.x,vector.y,vector.z),vector[u]=0,vector[v]=0,vector[w]=depth>0?1:-1,normals.push(vector.x,vector.y,vector.z),uvs.push(ix/gridX),uvs.push(1-iy/gridY),vertexCounter+=1}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){let a=numberOfVertices+ix+gridX1*iy,b=numberOfVertices+ix+gridX1*(iy+1),c=numberOfVertices+(ix+1)+gridX1*(iy+1),d=numberOfVertices+(ix+1)+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d)}numberOfVertices+=vertexCounter}buildPlane("z","y","x",-1,-1,depth,height,width,depthSegments,heightSegments,0),buildPlane("z","y","x",1,-1,depth,height,-width,depthSegments,heightSegments,1),buildPlane("x","z","y",1,1,width,depth,height,widthSegments,depthSegments,2),buildPlane("x","z","y",1,-1,width,depth,-height,widthSegments,depthSegments,3),buildPlane("x","y","z",1,-1,width,height,depth,widthSegments,heightSegments,4),buildPlane("x","y","z",-1,-1,width,height,-depth,widthSegments,heightSegments,5),this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class CircleGeometry extends Geometry{constructor(radius=1,segments=8,thetaStart=0,thetaLength=2*Math.PI){super();var i,s,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,uv=new Vector2;for(vertices.push(0,0,0),normals.push(0,0,1),uvs.push(.5,.5),s=0,i=3;s<=segments;s++,i+=3){var segment=thetaStart+s/segments*thetaLength;vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertices[i]/radius+1)/2,uv.y=(vertices[i+1]/radius+1)/2,uvs.push(uv.x,uv.y)}for(i=1;i<=segments;i++)indices.push(i,i+1,0);this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class CylinderGeometry extends Geometry{constructor(radiusTop=1,radiusBottom=1,height=1,radialSegments=8,heightSegments=1,openEnded=!1,thetaStart=0,thetaLength=2*Math.PI,planarMapping=!1){super(),radialSegments=Math.floor(radialSegments),heightSegments=Math.floor(heightSegments);let indices=[],vertices=[],normals=[],uvs=[],index=0,indexArray=[],halfHeight=height/2;function generateCap(top){let x,centerIndexStart,centerIndexEnd,uv=new Vector2,vertex=new Vector3,radius=!0===top?radiusTop:radiusBottom,sign=!0===top?1:-1,signV=planarMapping?1:sign;for(centerIndexStart=index,x=1;x<=radialSegments;x++)vertices.push(0,halfHeight*sign,0),normals.push(0,sign,0),uvs.push(.5,.5),index++;for(centerIndexEnd=index,x=0;x<=radialSegments;x++){let theta=x/radialSegments*thetaLength+thetaStart,cosTheta=Math.cos(theta),sinTheta=Math.sin(theta);vertex.x=radius*sinTheta,vertex.y=halfHeight*sign,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,sign,0),uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta*signV+.5,uvs.push(uv.x,uv.y),index++}for(x=0;x<radialSegments;x++){let c=centerIndexStart+x,i=centerIndexEnd+x;!0===top?indices.push(i,i+1,c):indices.push(i+1,i,c)}}!function generateTorso(){let x,y,uv=new Vector2,normal=new Vector3,vertex=new Vector3,slope=(radiusBottom-radiusTop)/height;for(y=0;y<=heightSegments;y++){let indexRow=[],v=y/heightSegments,radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){let u=x/radialSegments,theta=u*thetaLength+thetaStart,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);vertex.x=radius*sinTheta,vertex.y=-v*height+halfHeight,vertex.z=radius*cosTheta,vertices.push(vertex.x,vertex.y,vertex.z),normal.set(sinTheta,slope,cosTheta).normalize(),normals.push(normal.x,normal.y,normal.z),planarMapping?(uv.x=.5*cosTheta+.5,uv.y=.5*sinTheta+.5,uvs.push(uv.x,uv.y)):uvs.push(u,1-v),indexRow.push(index++)}indexArray.push(indexRow)}for(x=0;x<radialSegments;x++)for(y=0;y<heightSegments;y++){let a=indexArray[y][x],b=indexArray[y+1][x],c=indexArray[y+1][x+1],d=indexArray[y][x+1];indices.push(a,b,d),indices.push(b,c,d)}}(),!1===openEnded&&(radiusTop>0&&generateCap(!0),radiusBottom>0&&generateCap(!1)),this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class ConeGeometry extends CylinderGeometry{constructor(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){super(0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength)}}class PlaneGeometry extends Geometry{constructor(width=1,height=1,widthSegments=1,heightSegments=1){super();let ix,iy,width_half=width/2,height_half=height/2,gridX=Math.floor(widthSegments)||1,gridY=Math.floor(heightSegments)||1,gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<gridY1;iy++){let y=iy*segment_height-height_half;for(ix=0;ix<gridX1;ix++){let x=ix*segment_width-width_half;vertices.push(x,-y,0),normals.push(0,0,1),uvs.push(ix/gridX),uvs.push(1-iy/gridY)}}for(iy=0;iy<gridY;iy++)for(ix=0;ix<gridX;ix++){let a=ix+gridX1*iy,b=ix+gridX1*(iy+1),c=ix+1+gridX1*(iy+1),d=ix+1+gridX1*iy;indices.push(a,b,d),indices.push(b,c,d)}this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class PolyhedronGeometry extends Geometry{constructor(vertices,indices=[],radius=1,detail=0){super();let vertexBuffer=[],uvBuffer=[];function subdivideFace(a,b,c,detail){var i,j,cols=Math.pow(2,detail),v=[];for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols),bj=b.clone().lerp(c,i/cols),rows=cols-i;for(j=0;j<=rows;j++)v[i][j]=0===j&&i===cols?aj:aj.clone().lerp(bj,j/rows)}for(i=0;i<cols;i++)for(j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);j%2==0?(pushVertex(v[i][k+1]),pushVertex(v[i+1][k]),pushVertex(v[i][k])):(pushVertex(v[i][k+1]),pushVertex(v[i+1][k+1]),pushVertex(v[i+1][k]))}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z)}function getVertexByIndex(index,vertex){let stride=3*index;vertex.x=vertices[stride+0],vertex.y=vertices[stride+1],vertex.z=vertices[stride+2]}function correctUV(uv,stride,vector,azimuth){azimuth<0&&1===uv.x&&(uvBuffer[stride]=uv.x-1),0===vector.x&&0===vector.z&&(uvBuffer[stride]=azimuth/2/Math.PI+.5)}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}!function subdivide(detail){let a=new Vector3,b=new Vector3,c=new Vector3;for(let i=0;i<indices.length;i+=3)getVertexByIndex(indices[i+0],a),getVertexByIndex(indices[i+1],b),getVertexByIndex(indices[i+2],c),subdivideFace(a,b,c,detail)}(detail),function appplyRadius(radius){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3)vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2],vertex.normalize().multiplyScalar(radius),vertexBuffer[i+0]=vertex.x,vertexBuffer[i+1]=vertex.y,vertexBuffer[i+2]=vertex.z}(radius),function generateUVs(){let vertex=new Vector3;for(let i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0],vertex.y=vertexBuffer[i+1],vertex.z=vertexBuffer[i+2];let u=azimuth(vertex)/2/Math.PI+.5,v=(vector=vertex,Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))/Math.PI+.5);uvBuffer.push(u,1-v)}var vector;(function correctUVs(){let a=new Vector3,b=new Vector3,c=new Vector3,centroid=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2;for(let i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]),b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]),c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]),uvA.set(uvBuffer[j+0],uvBuffer[j+1]),uvB.set(uvBuffer[j+2],uvBuffer[j+3]),uvC.set(uvBuffer[j+4],uvBuffer[j+5]),centroid.copy(a).add(b).add(c).divideScalar(3);let azi=azimuth(centroid);correctUV(uvA,j+0,a,azi),correctUV(uvB,j+2,b,azi),correctUV(uvC,j+4,c,azi)}})(),function correctSeam(){for(let i=0;i<uvBuffer.length;i+=6){let x0=uvBuffer[i+0],x1=uvBuffer[i+2],x2=uvBuffer[i+4],max=Math.max(x0,x1,x2),min=Math.min(x0,x1,x2);max>.9&&min<.1&&(x0<.2&&(uvBuffer[i+0]+=1),x1<.2&&(uvBuffer[i+2]+=1),x2<.2&&(uvBuffer[i+4]+=1))}}()}(),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertexBuffer),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(vertexBuffer.slice()),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvBuffer),2)),0===detail?this.computeVertexNormals():this.normalizeNormals()}}class IcosahedronGeometry extends PolyhedronGeometry{constructor(radius,detail){let t=(1+Math.sqrt(5))/2;super([-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],radius,detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(radius=1,detail=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],radius,detail),this.type="OctahedronGeometry",this.parameters={radius:radius,detail:detail}}}OctahedronGeometry.fromJSON=function(data){return new OctahedronGeometry(data.radius,data.detail)};class RingGeometry extends Geometry{constructor(innerRadius=.5,outerRadius=1,thetaSegments=8,phiSegments=1,thetaStart=0,thetaLength=2*Math.PI){super();var segment,j,i,indices=[],vertices=[],normals=[],uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments,vertex=new Vector3,uv=new Vector2;for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++)segment=thetaStart+i/thetaSegments*thetaLength,vertex.x=radius*Math.cos(segment),vertex.y=radius*Math.sin(segment),vertices.push(vertex.x,vertex.y,vertex.z),normals.push(0,0,1),uv.x=(vertex.x/outerRadius+1)/2,uv.y=(vertex.y/outerRadius+1)/2,uvs.push(uv.x,uv.y);radius+=radiusStep}for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){var a=segment=i+thetaSegmentLevel,b=segment+thetaSegments+1,c=segment+thetaSegments+2,d=segment+1;indices.push(a,b,d),indices.push(b,c,d)}}this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class SphereGeometry extends Geometry{constructor(radius=1,widthSegments=8,heightSegments=6,phiStart=0,phiLength=2*Math.PI,thetaStart=0,thetaLength=Math.PI){super(),widthSegments=Math.max(3,Math.floor(widthSegments)),heightSegments=Math.max(2,Math.floor(heightSegments));let ix,iy,thetaEnd=thetaStart+thetaLength,index=0,grid=[],vertex=new Vector3,normal=new Vector3,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<=heightSegments;iy++){let verticesRow=[],v=iy/heightSegments;for(ix=0;ix<=widthSegments;ix++){let u=ix/widthSegments;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertex.y=radius*Math.cos(thetaStart+v*thetaLength),vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength),vertices.push(vertex.x,vertex.y,vertex.z),normal.set(vertex.x,vertex.y,vertex.z).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(u,1-v),verticesRow.push(index++)}grid.push(verticesRow)}for(iy=0;iy<heightSegments;iy++)for(ix=0;ix<widthSegments;ix++){let a=grid[iy][ix+1],b=grid[iy][ix],c=grid[iy+1][ix],d=grid[iy+1][ix+1];(0!==iy||thetaStart>0)&&indices.push(a,b,d),(iy!==heightSegments-1||thetaEnd<Math.PI)&&indices.push(b,c,d)}this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}class TorusKnotGeometry extends Geometry{constructor(radius=1,tube=.4,tubularSegments=64,radialSegments=8,p=2,q=3){super();let i,j,indices=[],vertices=[],normals=[],uvs=[],vertex=new Vector3,normal=new Vector3,P1=new Vector3,P2=new Vector3,B=new Vector3,T=new Vector3,N=new Vector3;for(i=0;i<=tubularSegments;++i){let u=i/tubularSegments*p*Math.PI*2;for(calculatePositionOnCurve(u,p,q,radius,P1),calculatePositionOnCurve(u+.01,p,q,radius,P2),T.subVectors(P2,P1),N.addVectors(P2,P1),B.crossVectors(T,N),N.crossVectors(B,T),B.normalize(),N.normalize(),j=0;j<=radialSegments;++j){let v=j/radialSegments*Math.PI*2,cx=-tube*Math.cos(v),cy=tube*Math.sin(v);vertex.x=P1.x+(cx*N.x+cy*B.x),vertex.y=P1.y+(cx*N.y+cy*B.y),vertex.z=P1.z+(cx*N.z+cy*B.z),vertices.push(vertex.x,vertex.y,vertex.z),normal.subVectors(vertex,P1).normalize(),normals.push(normal.x,normal.y,normal.z),uvs.push(i/tubularSegments),uvs.push(j/radialSegments)}}for(j=1;j<=tubularSegments;j++)for(i=1;i<=radialSegments;i++){let a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d),indices.push(b,c,d)}function calculatePositionOnCurve(u,p,q,radius,position){let cu=Math.cos(u),su=Math.sin(u),quOverP=q/p*u,cs=Math.cos(quOverP);position.x=radius*(2+cs)*.5*cu,position.y=radius*(2+cs)*su*.5,position.z=radius*Math.sin(quOverP)*.5}this.index=new(Geometry.arrayNeedsUint32(indices)?Uint32Array:Uint16Array)(indices),this.addAttribute("position",new GeometryAttribute(new Float32Array(vertices),3)),this.addAttribute("normal",new GeometryAttribute(new Float32Array(normals),3)),this.addAttribute("uv",new GeometryAttribute(new Float32Array(uvs),2))}}Class((function Interaction3D(_camera){Inherit(this,Component);const _this=this;let _hover,_click;var _lastOnUpdate,_maximumVRHitDistance,_v3=new Vector3,_plane=new Plane,_input={},_cacheHits=[],_enabled=!0;_this.ID=Utils.timestamp(),_camera=_camera||World.CAMERA;var _ray=_this.initClass(Raycaster,_camera),_meshes=[],_test=[],_event={};const PROHIBITED_ELEMENTS=["hit","prevent_interaction3d"];function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}function parseMeshes(meshes){Array.isArray(meshes)||(meshes=[meshes]);let output=[];return meshes.forEach((function checkMesh(obj){if(obj.isOcclusionMesh)return;(obj.hitArea||obj.hitMesh)&&(obj=function initHitMesh(obj){obj.hitMesh||(obj.hitMesh=new Mesh(obj.hitArea));return obj.add(obj.hitMesh),(obj=obj.hitMesh).isHitMesh=!0,obj.shader.neverRender=!0,obj}(obj));"boolean"==typeof obj.isHitMesh?(obj.mouseEnabled=function(visible){visible?~_meshes.indexOf(obj)||_meshes.push(obj):_meshes.remove(obj)},output.push(obj)):output.push(obj);obj.children.length&&obj.children.forEach(checkMesh)})),output}function testObjects(){_test.length=0;for(let i=_meshes.length-1;i>-1;i--){let obj=_meshes[i];obj.determineVisible()&&_test.push(obj)}return _test}function start(e){if("2d"==_input.type){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element)||GLUI.HIT)return}if(!_enabled)return;let hit=move(e);"3d"==_input.type&&_this.events.fire(Interaction3D.EXTERNAL_PRESS),hit?(_click=hit.object,_click.time=Render.TIME):_click=null}function moveHand(e){if(!_enabled)return;_cacheHits.length=0;for(let i=0;i<_input.obj.length;i++){let obj=_input.obj[i];_v3.set(0,0,-1).applyQuaternion(obj.quaternion);let hit=_ray.checkFromValues(testObjects(),obj.position,_v3)[0];hit&&_cacheHits.push(hit)}_cacheHits.sort(((a,b)=>a.distance-b.distance));let hit=_cacheHits[0];if(hit&&hit.object==_lastOnUpdate||(_lastOnUpdate&&_lastOnUpdate.onMissUpdate&&_lastOnUpdate.onMissUpdate(),_lastOnUpdate=null),hit){let mesh=hit.object;if(mesh.onHitUpdate)return hit.usingFinger=!0,_lastOnUpdate=mesh,mesh.onHitUpdate(hit),!1;!mesh._debounceFingerClick||Render.TIME-mesh._debounceFingerClick>1e3?hit.distance<.01?(_click=mesh,triggerClick(mesh,hit),mesh._debounceFingerClick=Render.TIME):_hover||(_hover=mesh,triggerHover("over",mesh,hit)):_hover&&(triggerHover("out",_hover),_hover=null)}else _hover&&(triggerHover("out",_hover),_hover=null)}function move(e){if("2d"==_input.type){let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element))return}if(!_enabled)return void Interaction3D.requestCursor("auto",_this);let hit;if("2d"==_input.type?hit=_ray.checkHit(testObjects(),_input.position,_input.rect||Stage)[0]:(_input.obj.hideBeam(),_v3.set(0,0,-1).applyQuaternion(_input.obj.group.getWorldQuaternion()),hit=_ray.checkFromValues(testObjects(),_input.obj.group.getWorldPosition(),_v3)[0]),hit&&hit.object==_lastOnUpdate||(_lastOnUpdate&&_lastOnUpdate.onMissUpdate&&_lastOnUpdate.onMissUpdate(),_lastOnUpdate=null),hit){_this.intersecting=!0;let mesh=hit.object;if("3d"==_input.type){let max=_maximumVRHitDistance||Interaction3D.maximumVRHitDistance;if("number"==typeof mesh.maximumVRHitDistance&&mesh.maximumVRHitDistance>0&&(max=mesh.maximumVRHitDistance),mesh.onHitUpdate&&hit.distance>max)return!1;_input.obj.showBeam(),_input.obj.setHitPosition&&_input.obj.setHitPosition(hit)}return mesh.onHitUpdate?(mesh.onHitUpdate(hit),_lastOnUpdate=mesh,!1):(_hover!==mesh?(_hover&&triggerHover("out",_hover,hit),_hover=mesh,triggerHover("over",_hover,hit),_hover.__clickCallback?Interaction3D.requestCursor("pointer",_this):Interaction3D.requestCursor("auto",_this)):function triggerMove(mesh,hit){_event.action="move",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.MOVE,_event,!0),mesh["__moveCallback"+_this.ID]&&mesh["__moveCallback"+_this.ID](_event)}(_hover,hit),hit)}return _this.intersecting=!1,end(),_input.obj&&_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),!1}function end(){_hover&&(triggerHover("out",_hover,null),_hover=null,Interaction3D.requestCursor(_this.cursor,_this))}function click(e){if("3d"==_input.type&&_this.events.fire(Interaction3D.EXTERNAL_RELEASE),!_this.enabled)return;if(!_click)return;let hit,element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(!element||!checkIfProhibited(element)){if("2d"==_input.type){if(GLUI.HIT)return;hit=_ray.checkHit(testObjects(),_input.position,_input.rect)[0]}else _v3.set(0,0,-1).applyQuaternion(_input.obj.group.getWorldQuaternion()),hit=_ray.checkFromValues(testObjects(),_input.obj.group.getWorldPosition(),_v3)[0];hit&&hit.object===_click&&triggerClick(_click,hit),_click=null}}function triggerHover(action,mesh,hit){_event.action=action,_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.HOVER,_event,!0),_hover.__hoverCallback&&_hover.__hoverCallback(_event)}function triggerClick(mesh,hit){_event.action="click",_event.mesh=mesh,_event.hit=hit,_this.events.fire(Interaction3D.CLICK,_event,!0),_click.__clickCallback&&_click.__clickCallback(_event)}function vrInputButton(e){"trigger"==e.label&&(e.pressed?start(e):click(e))}this.cursor="auto",_ray.testVisibility=!0,this.set("camera",(c=>{_ray.camera=c})),this.add=function(meshes,hover,click,move,seo){let seoRoot;Array.isArray(meshes)||(meshes=parseMeshes(meshes)),move&&"function"!=typeof move&&(seo=move,move=null),seo&&seo.root&&(seoRoot=seo.root,seo=seo.seo),meshes.forEach(((mesh,i)=>{if(seo)try{mesh._divFocus=_=>hover({action:"over",seo:!0,mesh:mesh}),mesh._divBlur=_=>hover({action:"out",seo:!0,mesh:mesh}),mesh._divSelect=_=>click({action:"click",seo:!0,mesh:mesh});let{url:url,label:label,...options}=Array.isArray(seo)?seo[i]:seo;GLSEO.objectNode(mesh,seoRoot),mesh.seo.aLink(url,label,options)}catch(e){Hydra.LOCAL&&console.warn("Could not add SEO to Interaction3D meshes",e)}mesh.hitDestroy=_=>_meshes.remove(mesh),hover&&(mesh.__hoverCallback=hover),click&&(mesh.__clickCallback=click),move&&(mesh["__moveCallback"+_this.ID]=move),_meshes.push(mesh)}))},this.remove=function(meshes){Array.isArray(meshes)||(meshes=parseMeshes(meshes)),meshes.forEach((mesh=>{mesh===_hover&&(_hover=null,Interaction3D.requestCursor(_this.cursor,_this)),mesh.seo&&mesh.seo.unlink();for(let i=_meshes.length-1;i>=0;i--)mesh===_meshes[i]&&_meshes.splice(i,1)}))},this.set("testVisibility",(v=>_ray.testVisibility=v)),this.set("input",(obj=>{_input&&_input.obj&&(_input.obj.isVrController&&_this.events.unsub(_input.obj,VRInput.BUTTON,vrInputButton),_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),_input.obj.hideBeam&&_input.obj.hideBeam()),(_input={}).obj=obj,_input.position=obj.group?obj.group.position:obj,_input.quaternion=obj.group?obj.group.quaternion:null,_input.type="number"==typeof _input.position.z||Array.isArray(obj)?"3d":"2d",_input.rect=obj.rect,"3d"==_input.type?(new Vector3,new Vector3):(new Vector2,new Vector2),obj==Mouse?function addHandlers(){_this.events.sub(Mouse.input,Interaction.START,start),Device.mobile&&_this.events.sub(Mouse.input,Interaction.END,end),_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.CLICK,click)}():(!function removeHandlers(){_this.events.unsub(Mouse.input,Interaction.START,start),Device.mobile&&_this.events.unsub(Mouse.input,Interaction.END,end),_this.events.unsub(Mouse.input,Interaction.MOVE,move),_this.events.unsub(Mouse.input,Interaction.CLICK,click)}(),Array.isArray(obj)?(_this.startRender(moveHand),_this.stopRender(move)):(_this.events.sub(obj,VRInput.BUTTON,vrInputButton),_this.startRender(move),_this.stopRender(moveHand)))})),this.get("input",(_=>_input)),this.get("enabled",(_=>_enabled)),this.set("enabled",(v=>{(_enabled=v)||(_hover&&triggerHover("out",_hover,null),_hover=null,_input&&_input.obj&&(_input.obj.setHitPosition&&_input.obj.setHitPosition(!1),_input.obj.hideBeam&&_input.obj.hideBeam()))})),this.checkObjectHit=function(object,mouse,rect=Stage){return _ray.checkHit(object,mouse,rect)[0]},this.checkObjectFromValues=function(object,origin,direction){return _ray.checkFromValues(object,origin,direction)[0]},this.getObjectHitLocalCoords=function(v,object,mouse,rect=Stage){let hit=_this.checkObjectHit(object,mouse,rect);return hit?(v.copy(hit.point),hit.object.worldToLocal(v)):(_plane.normal.set(0,0,1).applyQuaternion(object.getWorldQuaternion()),_plane.constant=-object.getWorldPosition().dot(_plane.normal),_ray.ray.intersectPlane(_plane,v),object.worldToLocal(v))},this.get("maximumVRHitDistance",(()=>_maximumVRHitDistance)),this.set("maximumVRHitDistance",(value=>{value?"number"==typeof value&&value>0&&(_maximumVRHitDistance=value):_maximumVRHitDistance=void 0}))}),(()=>{Interaction3D.HOVER="interaction3d_hover",Interaction3D.CLICK="interaction3d_click",Interaction3D.MOVE="interaction3d_move",Interaction3D.EXTERNAL_PRESS="interaction3d_ext_press",Interaction3D.EXTERNAL_RELEASE="interaction3d_ext_release";var _cursorObj,_map=new Map,_input=Mouse,_maximumVRHitDistance=5;Interaction3D.find=function(camera){if(camera=camera.camera||camera,!_map.has(camera)){let interaction=new Interaction3D(camera);interaction.input=_input,_map.set(camera,interaction)}return _map.get(camera)},Interaction3D.useInput=function(obj){if(_input!=obj){for(let[camera,interaction]of _map)interaction.input=obj;_input=obj}},Interaction3D.requestCursor=function(cursor,obj){obj.forceCursor&&(cursor=obj.forceCursor),"pointer"==cursor&&(_cursorObj=obj,Stage.cursor(cursor)),"auto"==cursor&&_cursorObj==obj&&(Stage.cursor(cursor),_cursorObj=null)},Object.defineProperty(Interaction3D,"maximumVRHitDistance",{get:()=>_maximumVRHitDistance,set(value){value?"number"==typeof value&&value>0&&(_maximumVRHitDistance=value):_maximumVRHitDistance=5}})})),Class((function Lighting(){Inherit(this,Component);const _this=this;var _activeScene,_scenes={};function loop(){if(decomposeLights(_activeScene.lights),_this.UBO){let shader=_activeScene.shaders.start();shader&&(updateArrays(shader),_activeScene.ubo.created?_activeScene.ubo.update():createUBO(shader.uniforms))}else{let shader=_activeScene.shaders.start();for(;shader;)updateArrays(shader),shader=_activeScene.shaders.next()}}function createUBO(uniforms){uniforms.lightPos&&(_activeScene.ubo.created=!0,_activeScene.ubo.push(uniforms.lightPos),_activeScene.ubo.push(uniforms.lightColor),_activeScene.ubo.push(uniforms.lightData),_activeScene.ubo.push(uniforms.lightData2),_activeScene.ubo.push(uniforms.lightData3),_activeScene.ubo.push(uniforms.lightProperties),_activeScene.ubo.upload())}function decomposeLights(lights){for(let i=lights.length-1;i>-1;i--){let light=lights[i];light._decomposedTime&&Render.TIME-light._decomposedTime<8||(light._decomposedTime=Render.TIME,light._parent||light.updateMatrixWorld(),light._world||(light._world=new Vector3),light.lockToLocal?light._world.copy(light.position):light.getWorldPosition(light._world))}}function updateArrays(shader){let lighting=shader.__lighting;lighting.position.length=0,lighting.color.length=0,lighting.data.length=0,lighting.data2.length=0,lighting.data3.length=0,lighting.properties.length=0;for(let i=0;i<_activeScene.lights.length;i++){let light=_activeScene.lights[i];light._world||decomposeLights(_activeScene.lights),lighting.position.push(light._world.x,light._world.y,light._world.z,0),lighting.color.push(light.color.r,light.color.g,light.color.b,0),lighting.data.push(light.data.x,light.data.y,light.data.z,light.data.w),lighting.data2.push(light.data2.x,light.data2.y,light.data2.z,light.data2.w),lighting.data3.push(light.data3.x,light.data3.y,light.data3.z,light.data3.w),lighting.properties.push(light.properties.x,light.properties.y,light.properties.z,light.properties.w)}}function findParentScene(obj3d){if(!obj3d)return _activeScene;if(obj3d._lightingData)return obj3d._lightingData;let scene,p=obj3d._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent;return scene||(scene=_activeScene),scene}this.fallbackAreaToPoint=!1,this.scenes=_scenes,async function(){await Hydra.ready(),_this.createScene("default"),_this.useScene("default")}(),this.createScene=function(name,scene){if(_scenes[name])return this;let obj={lights:[],renderShadows:[],ubo:new(window.Metal?MetalUBO:UBO)(2),shaders:new LinkedList,name:name};return scene&&(scene._lightingData=obj),_scenes[name]=obj,this},this.useScene=function(name){if(!(_activeScene=_scenes[name]))throw`Scene ${name} not found`;return loop(),this},this.destroyScene=function(name){delete _scenes[name]},this.push=this.add=function(light){_this.UBO=Renderer.UBO&&!(window.AURA||RenderManager.type==RenderManager.WEBVR),window.Metal&&(_this.UBO=!0);let scene=findParentScene(light);scene.lights.push(light),light.isAreaLight&&(scene.hasAreaLight=!0),_this.startedLoop||(_this.startedLoop=!0,RenderManager.type==RenderManager.WEBVR?_this.startRender(loop,World.NUKE):Render.onDrawFrame(loop))},this.remove=function(light){_activeScene.lights.remove(light)},this.getLighting=function(shader,force){if(shader.__lighting&&!force)return shader.__lighting;let scene=findParentScene(shader.mesh);scene.shaders.push(shader),window.AreaLightUtil&&scene.hasAreaLight&&AreaLightUtil.append(shader);let lighting=shader.__lighting={position:[],color:[],data:[],data2:[],data3:[],properties:[]};if(!scene.lights.length)return shader.__lighting;let lightUBO=_this.UBO;return shader.uniforms.lightPos={type:"v4v",value:lighting.position,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightColor={type:"v4v",value:lighting.color,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData={type:"v4v",value:lighting.data,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData2={type:"v4v",value:lighting.data2,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightData3={type:"v4v",value:lighting.data3,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},shader.uniforms.lightProperties={type:"v4v",value:lighting.properties,ignoreUIL:!0,lightUBO:lightUBO,components:4,metalIgnore:!0},updateArrays(shader),_this.UBO&&!_activeScene.ubo.created&&createUBO(shader.uniforms),shader.__lighting},this.destroyShader=function(shader){findParentScene(shader.mesh);_activeScene.shaders.remove(shader)},this.sort=function(callback){_activeScene.lights.sort(callback)},this.addToShadowGroup=function(light){findParentScene(light).renderShadows.push(light)},this.removeFromShadowGroup=function(light){findParentScene(light);_activeScene.renderShadows.remove(light)},this.getShadowLights=function(){return _activeScene.renderShadows},this.getShadowCount=function(){return _activeScene.renderShadows.length},this.initShadowShader=function(object,mesh){let scene,shader=object.shader||object;if(shader.mesh){let p=shader.mesh._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent}if(scene||(scene=_activeScene),!World.RENDERER.shadows||0==scene.renderShadows.length)return"";shader._gl||shader.upload();let vsName=shader.vsName,fsName="ShadowDepth";shader.customShadowShader&&(fsName=shader.customShadowShader),shader.shadow=new Shader(vsName,fsName,{receiveLight:shader.receiveLight,UILPrefix:shader.UILPrefix,precision:"high"}),shader.vertexShader&&(shader.shadow.vertexShader=shader.vertexShader),shader.restoreVS&&(shader.shadow.vertexShader=shader.restoreVS),shader.customCompile&&(shader.shadow.customCompile=shader.customCompile+"_shadow"),shader.defines&&(shader.shadow.defines=shader.defines,shader.shadow.resetProgram()),shader.shadow.lights=shader.lights,shader.shadow.isShadow=!0,shader.copyUniformsTo(shader.shadow,!0),shader.shadow.upload()},this.getShadowUniforms=function(shader){let scene;if(shader.mesh){let p=shader.mesh._parent;for(;p;)p instanceof Scene&&p._lightingData&&(scene=p._lightingData),p=p._parent}return scene||(scene=_activeScene),World.RENDERER.shadows&&0!=scene.renderShadows.length?[`\n#define SHADOW_MAPS ${scene.renderShadows.length}`,World.RENDERER.shadows==Renderer.SHADOWS_LOW?"#define SHADOWS_LOW":"",World.RENDERER.shadows==Renderer.SHADOWS_MED?"#define SHADOWS_MED":"",World.RENDERER.shadows==Renderer.SHADOWS_HIGH?"#define SHADOWS_HIGH":"",`uniform sampler2D shadowMap[${scene.renderShadows.length}];`,`uniform mat4 shadowMatrix[${scene.renderShadows.length}];`,`uniform vec3 shadowLightPos[${scene.renderShadows.length}];`,`uniform float shadowSize[${scene.renderShadows.length}];`].join("\n"):""},this.bindUBO=function(shader){_activeScene.ubo.created&&_activeScene.ubo.bind(shader,"lights")},this.fallbackAreaToPointTest=function(){return _this.fallbackAreaToPoint},this.get("activeScene",(_=>_activeScene)),this.renderShadowsAllowLight=function(object,light){if(!object._renderShadowsAllowLights){let allowed=new WeakMap;object._renderShadowsAllowLights=allowed;let prevOnBeforeRenderShadow=object.onBeforeRenderShadow;object.onBeforeRenderShadow=function(renderLight){let result=prevOnBeforeRenderShadow&&prevOnBeforeRenderShadow.apply(this,arguments);return!allowed.has(renderLight)||result}}object._renderShadowsAllowLights.set(light.light||light,!0)}}),"static");class Shadow{constructor(light){this.light=light,this.camera=new PerspectiveCamera(60,1,.1,50),this.target=new Vector3,this.rt=new RenderTarget(1024,1024),this.rt.createDepthTexture(),this.enabled=!0,this._size=1024,this._fov=60,this._far=50,this._near=.1,light.add(this.camera)}destroy(){this.rt.destroy()}set fov(value){this._fov=value,this.camera.fov=value,this.camera.updateProjectionMatrix(),-1==value&&(this.camera=new OrthographicCamera(-5,5,5,-5,.1,50))}get fov(){return this._fov}set area(value){this._area=value,this.camera.left=-value,this.camera.right=value,this.camera.top=value,this.camera.bottom=-value,this.camera.updateProjectionMatrix()}get area(){return this._area}set far(value){this._far=value,this.camera.far=value,this.camera.updateProjectionMatrix()}get far(){return this._far}set near(value){this._near=value,this.camera.near=value,this.camera.updateProjectionMatrix()}get near(){return this._near}set size(value){this._size=value,this.rt.setSize(value,value)}get size(){return this._size}}class Box2{constructor(min,max){this.min=void 0!==min?min:new Vector2(1/0,1/0),this.max=void 0!==max?max:new Vector2(-1/0,-1/0)}set(min,max){return this.min.copy(min),this.max.copy(max),this}setFromPoints(points){this.makeEmpty();for(let i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this}setFromCenterAndSize(center,size){let v1=this.V1||new Vector2;this.V1=v1;let halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}clone(){return(new Box2).copy(this)}copy(box){return this.min.copy(box.min),this.max.copy(box.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(target){return this.isEmpty()?target.set(0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(target){return this.isEmpty()?target.set(0,0):target.subVectors(this.max,this.min)}expandByPoint(point){return this.min.min(point),this.max.max(point),this}expandByVector(vector){return this.min.sub(vector),this.max.add(vector),this}expandByScalar(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this}containsPoint(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y)}containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y}getParameter(point,target){return target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y)}clampPoint(point,target){return target.copy(point).clamp(this.min,this.max)}distanceToPoint(point){let v1=this.V1||new Vector2;return this.V1=v1,v1.copy(point).clamp(this.min,this.max).sub(point).length()}intersect(box){return this.min.max(box.min),this.max.min(box.max),this}union(box){return this.min.min(box.min),this.max.max(box.max),this}translate(offset){return this.min.add(offset),this.max.add(offset),this}equals(box){return box.min.equals(this.min)&&box.max.equals(this.max)}}class Box3{constructor(min,max){this.min=void 0!==min?min:new Vector3(1/0,1/0,1/0),this.max=void 0!==max?max:new Vector3(-1/0,-1/0,-1/0)}set(min,max){return this.min.copy(min),this.max.copy(max),this}setFromArray(array){let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0;for(let i=0,l=array.length;i<l;i+=3){let x=array[i],y=array[i+1],z=array[i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),x>maxX&&(maxX=x),y>maxY&&(maxY=y),z>maxZ&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this}setFromBufferAttribute(attribute){let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0;for(let i=0,l=attribute.count;i<l;i++){let x=attribute.array[3*i+0],y=attribute.array[3*i+1],z=attribute.array[3*i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),x>maxX&&(maxX=x),y>maxY&&(maxY=y),z>maxZ&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this}setFromPoints(points){this.makeEmpty();for(let i=0,il=points.length;i<il;i++)this.expandByPoint(points[i]);return this}setFromCenterAndSize(center,size){let v1=this.V1||new Vector3;this.V1=v1;let halfSize=v1.copy(size).multiplyScalar(.5);return this.min.copy(center).sub(halfSize),this.max.copy(center).add(halfSize),this}setFromObject(object){return this.makeEmpty(),this.expandByObject(object)}clone(){return(new Box3).copy(this)}copy(box){return this.min.copy(box.min),this.max.copy(box.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(target){return this.isEmpty()?target.set(0,0,0):target.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(target){return this.isEmpty()?target.set(0,0,0):target.subVectors(this.max,this.min)}expandByPoint(point){return this.min.min(point),this.max.max(point),this}expandByVector(vector){return this.min.sub(vector),this.max.add(vector),this}expandByScalar(scalar){return this.min.addScalar(-scalar),this.max.addScalar(scalar),this}expandByObject(object,local,onlyvisible){let scope,i,l,v1=this.V1||new Vector3;return this.V1=v1,scope=this,object.updateMatrixWorld(!0),object.traverse((node=>{if(onlyvisible&&!node.visible)return;if(node.isGizmo)return;let geometry=node.geometry;if(!geometry)return;let attribute=geometry.attributes.position;if(void 0!==attribute)for(i=0,l=attribute.count;i<l;i++)v1.fromBufferAttribute(attribute,i).applyMatrix4(local?node.matrix:node.matrixWorld),scope.expandByPoint(v1)})),this}containsPoint(point){return!(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z)}containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z}getParameter(point,target){return target.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(box){return!(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z)}intersectsSphere(sphere){let closestPoint=this.V1||new Vector3;return this.V1=closestPoint,this.clampPoint(sphere.center,closestPoint),closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius}intersectsPlane(plane){let min,max;return plane.normal.x>0?(min=plane.normal.x*this.min.x,max=plane.normal.x*this.max.x):(min=plane.normal.x*this.max.x,max=plane.normal.x*this.min.x),plane.normal.y>0?(min+=plane.normal.y*this.min.y,max+=plane.normal.y*this.max.y):(min+=plane.normal.y*this.max.y,max+=plane.normal.y*this.min.y),plane.normal.z>0?(min+=plane.normal.z*this.min.z,max+=plane.normal.z*this.max.z):(min+=plane.normal.z*this.max.z,max+=plane.normal.z*this.min.z),min<=plane.constant&&max>=plane.constant}intersectsTriangle(triangle){let v0=this.V0||new Vector3;this.V0=v0;let v1=this.V1||new Vector3;this.V1=v1;let v2=this.V2||new Vector3;this.V2=v2;let f0=this.F0||new Vector3;this.F0=f0;let f1=this.F1||new Vector3;this.F1=f1;let f2=this.F2||new Vector3;this.F2=f2;let testAxis=this.V3||new Vector3;this.V3=testAxis;let center=this.V4||new Vector3;this.V4=center;let extents=this.V5||new Vector3;this.V5=extents;let triangleNormal=this.V6||new Vector3;function satForAxes(axes){let i,j;for(i=0,j=axes.length-3;i<=j;i+=3){testAxis.fromArray(axes,i);let r=extents.x*Math.abs(testAxis.x)+extents.y*Math.abs(testAxis.y)+extents.z*Math.abs(testAxis.z),p0=v0.dot(testAxis),p1=v1.dot(testAxis),p2=v2.dot(testAxis);if(Math.max(-Math.max(p0,p1,p2),Math.min(p0,p1,p2))>r)return!1}return!0}if(this.V6=triangleNormal,this.isEmpty())return!1;this.getCenter(center),extents.subVectors(this.max,center),v0.subVectors(triangle.a,center),v1.subVectors(triangle.b,center),v2.subVectors(triangle.c,center),f0.subVectors(v1,v0),f1.subVectors(v2,v1),f2.subVectors(v0,v2);let axes=[0,-f0.z,f0.y,0,-f1.z,f1.y,0,-f2.z,f2.y,f0.z,0,-f0.x,f1.z,0,-f1.x,f2.z,0,-f2.x,-f0.y,f0.x,0,-f1.y,f1.x,0,-f2.y,f2.x,0];return!!satForAxes(axes)&&(axes=[1,0,0,0,1,0,0,0,1],!!satForAxes(axes)&&(triangleNormal.crossVectors(f0,f1),axes=[triangleNormal.x,triangleNormal.y,triangleNormal.z],satForAxes(axes)))}clampPoint(point,target){return target.copy(point).clamp(this.min,this.max)}distanceToPoint(point){let v1=this.V1||new Vector3;return this.V1=v1,v1.copy(point).clamp(this.min,this.max).sub(point).length()}getBoundingSphere(target=new Sphere){let v1=this.V1||new Vector3;return this.V1=v1,this.getCenter(target.center),target.radius=.5*this.getSize(v1).length(),target}intersect(box){return this.min.max(box.min),this.max.min(box.max),this.isEmpty()&&this.makeEmpty(),this}union(box){return this.min.min(box.min),this.max.max(box.max),this}applyMatrix4(matrix){if(this.isEmpty())return this;let m=matrix.elements,xax=m[0]*this.min.x,xay=m[1]*this.min.x,xaz=m[2]*this.min.x,xbx=m[0]*this.max.x,xby=m[1]*this.max.x,xbz=m[2]*this.max.x,yax=m[4]*this.min.y,yay=m[5]*this.min.y,yaz=m[6]*this.min.y,ybx=m[4]*this.max.y,yby=m[5]*this.max.y,ybz=m[6]*this.max.y,zax=m[8]*this.min.z,zay=m[9]*this.min.z,zaz=m[10]*this.min.z,zbx=m[8]*this.max.z,zby=m[9]*this.max.z,zbz=m[10]*this.max.z;return this.min.x=Math.min(xax,xbx)+Math.min(yax,ybx)+Math.min(zax,zbx)+m[12],this.min.y=Math.min(xay,xby)+Math.min(yay,yby)+Math.min(zay,zby)+m[13],this.min.z=Math.min(xaz,xbz)+Math.min(yaz,ybz)+Math.min(zaz,zbz)+m[14],this.max.x=Math.max(xax,xbx)+Math.max(yax,ybx)+Math.max(zax,zbx)+m[12],this.max.y=Math.max(xay,xby)+Math.max(yay,yby)+Math.max(zay,zby)+m[13],this.max.z=Math.max(xaz,xbz)+Math.max(yaz,ybz)+Math.max(zaz,zbz)+m[14],this}translate(offset){return this.min.add(offset),this.max.add(offset),this}equals(box){return box.min.equals(this.min)&&box.max.equals(this.max)}setFromBufferAttribute(attribute){let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0;for(let i=0,l=attribute.count;i<l;i++){let x=attribute.array[3*i+0],y=attribute.array[3*i+1],z=attribute.array[3*i+2];x<minX&&(minX=x),y<minY&&(minY=y),z<minZ&&(minZ=z),x>maxX&&(maxX=x),y>maxY&&(maxY=y),z>maxZ&&(maxZ=z)}return this.min.set(minX,minY,minZ),this.max.set(maxX,maxY,maxZ),this}}class Color{constructor(r,g,b){return null==r&&null==g&&null==b?this.setRGB(1,1,1):void 0===g&&void 0===b?this.set(r):void this.setRGB(r,g,b)}set(value){return value&&value instanceof Color?this.copy(value):"number"==typeof value?this.setHex(value):"string"==typeof value&&this.setStyle(value),this}setScalar(scalar){return this.r=scalar,this.g=scalar,this.b=scalar,this}setHex(hex){return hex=Math.floor(hex),this.r=(hex>>16&255)/255,this.g=(hex>>8&255)/255,this.b=(255&hex)/255,this}setStyle(string){return this.setHex(Number(string.replace("#","0x")))}setRGB(r,g,b){return this.r=r,this.g=g,this.b=b,this}setHSL(h,s,l){function hue2rgb(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+6*(q-p)*(2/3-t):p}if(h=Math.euclideanModulo(h,1),s=Math.clamp(s,0,1),l=Math.clamp(l,0,1),0===s)this.r=this.g=this.b=l;else{let p=l<=.5?l*(1+s):l+s-l*s,q=2*l-p;this.r=hue2rgb(q,p,h+1/3),this.g=hue2rgb(q,p,h),this.b=hue2rgb(q,p,h-1/3)}return this}clone(){return new Color(this.r,this.g,this.b)}copy(color){return this.r=color.r,this.g=color.g,this.b=color.b,this}copyGammaToLinear(color,gammaFactor){return void 0===gammaFactor&&(gammaFactor=2),this.r=Math.pow(color.r,gammaFactor),this.g=Math.pow(color.g,gammaFactor),this.b=Math.pow(color.b,gammaFactor),this}copyLinearToGamma(color,gammaFactor){void 0===gammaFactor&&(gammaFactor=2);let safeInverse=gammaFactor>0?1/gammaFactor:1;return this.r=Math.pow(color.r,safeInverse),this.g=Math.pow(color.g,safeInverse),this.b=Math.pow(color.b,safeInverse),this}convertGammaToLinear(gammaFactor){return this.copyGammaToLinear(this,gammaFactor),this}convertLinearToGamma(gammaFactor){return this.copyLinearToGamma(this,gammaFactor),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return"#"+("000000"+this.getHex().toString(16)).slice(-6)}getHSL(){let target=this.target||{};this.target=target;let hue,saturation,r=this.r,g=this.g,b=this.b,max=Math.max(r,g,b),min=Math.min(r,g,b),lightness=(min+max)/2;if(min===max)hue=0,saturation=0;else{let delta=max-min;switch(saturation=lightness<=.5?delta/(max+min):delta/(2-max-min),max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4}hue/=6}return target.h=hue,target.s=saturation,target.l=lightness,target}tween(color,time,ease,delay){const _this=this;_this.tweenObj||(_this.tweenObj={v:0}),_this.tweenObj.v=0;let clone=this.clone();return TweenManager.tween(_this.tweenObj,{v:1},time,ease,delay).onUpdate((_=>{_this.copy(clone).lerp(color,_this.tweenObj.v)}))}offsetHSL(h,s,l){let hsl=this.getHSL();return hsl.h+=h,hsl.s+=s,hsl.l+=l,this.setHSL(hsl.h,hsl.s,hsl.l),this}add(color){return this.r+=color.r,this.g+=color.g,this.b+=color.b,this}addColors(color1,color2){return this.r=color1.r+color2.r,this.g=color1.g+color2.g,this.b=color1.b+color2.b,this}addScalar(s){return this.r+=s,this.g+=s,this.b+=s,this}sub(color){return this.r=Math.max(0,this.r-color.r),this.g=Math.max(0,this.g-color.g),this.b=Math.max(0,this.b-color.b),this}multiply(color){return this.r*=color.r,this.g*=color.g,this.b*=color.b,this}multiplyScalar(s){return this.r*=s,this.g*=s,this.b*=s,this}invert(){return this.r=1-this.r,this.g=1-this.g,this.b=1-this.b,this}lerp(color,alpha,hz){return this.r=Math.lerp(color.r,this.r,alpha,hz),this.g=Math.lerp(color.g,this.g,alpha,hz),this.b=Math.lerp(color.b,this.b,alpha,hz),this}equals(c){return c.r===this.r&&c.g===this.g&&c.b===this.b}fromArray(array,offset){return void 0===offset&&(offset=0),this.r=array[offset],this.g=array[offset+1],this.b=array[offset+2],this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.r,array[offset+1]=this.g,array[offset+2]=this.b,array}toRGBA(alpha=1){return`rgba(${Math.floor(255*this.r)}, ${Math.floor(255*this.g)}, ${Math.floor(255*this.b)}, ${alpha})`}}class Cylindrical{constructor(radius=1,theta=0,y=0){this.radius=radius,this.theta=theta,this.y=y}set(radius,theta,y){return this.radius=radius,this.theta=theta,this.y=y,this}clone(){return(new this.constructor).copy(this)}copy(other){return this.radius=other.radius,this.theta=other.theta,this.y=other.y,this}setFromVector3(vec3){return this.radius=Math.sqrt(vec3.x*vec3.x+vec3.z*vec3.z),this.theta=Math.atan2(vec3.x,vec3.z),this.y=vec3.y,this}}class Euler{constructor(x,y,z,order){this._x=x||0,this._y=y||0,this._z=z||0,this._order=order||"XYZ",this.isEuler=!0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Euler::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}set order(value){this._order=value,this.onChangeCallback()}get order(){return this._order}set(x,y,z,order){return this._x=x,this._y=y,this._z=z,this._order=order||this._order,this.onChangeCallback(),this}clone(){return new Euler(this._x,this._y,this._z,this._order)}copy(euler){return this._x=euler.x,this._y=euler.y,this._z=euler.z,euler._order&&(this._order=euler._order),this.onChangeCallback(),this}setFromRotationMatrix(m,order,update){let clamp=Math.clamp,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];return"XYZ"===(order=order||this._order)?(this._y=Math.asin(clamp(m13,-1,1)),Math.abs(m13)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(-m23,m33),this._z=Math.atan2(-m12,m11)):(this._x=Math.atan2(m32,m22),this._z=0)):"YXZ"===order?(this._x=Math.asin(-clamp(m23,-1,1)),Math.abs(m23)<1-Base3D.DIRTY_EPSILON?(this._y=Math.atan2(m13,m33),this._z=Math.atan2(m21,m22)):(this._y=Math.atan2(-m31,m11),this._z=0)):"ZXY"===order?(this._x=Math.asin(clamp(m32,-1,1)),Math.abs(m32)<1-Base3D.DIRTY_EPSILON?(this._y=Math.atan2(-m31,m33),this._z=Math.atan2(-m12,m22)):(this._y=0,this._z=Math.atan2(m21,m11))):"ZYX"===order?(this._y=Math.asin(-clamp(m31,-1,1)),Math.abs(m31)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(m32,m33),this._z=Math.atan2(m21,m11)):(this._x=0,this._z=Math.atan2(-m12,m22))):"YZX"===order?(this._z=Math.asin(clamp(m21,-1,1)),Math.abs(m21)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(-m23,m22),this._y=Math.atan2(-m31,m11)):(this._x=0,this._y=Math.atan2(m13,m33))):"XZY"===order&&(this._z=Math.asin(-clamp(m12,-1,1)),Math.abs(m12)<1-Base3D.DIRTY_EPSILON?(this._x=Math.atan2(m32,m22),this._y=Math.atan2(m13,m11)):(this._x=Math.atan2(-m23,m33),this._y=0)),this._order=order,!1!==update&&this.onChangeCallback(),this}setFromQuaternion(q,order,update){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.makeRotationFromQuaternion(q),this.setFromRotationMatrix(matrix,order,update)}setFromVector3(v,order){return this.set(v.x,v.y,v.z,order||this._order)}reorder(newOrder){let q=this.Q1||new Quaternion;return this.Q1=q,q.setFromEuler(this),this.setFromQuaternion(q,newOrder)}lerp(euler,alpha){this._x+=(euler._x-this._x)*alpha,this._y+=(euler._y-this._y)*alpha,this._z+=(euler._z-this._z)*alpha,this.onChangeCallback()}equals(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order}fromArray(array){return this._x=array[0],this._y=array[1],this._z=array[2],void 0!==array[3]&&(this._order=array[3]),this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._order,array}toVector3(optionalResult){return optionalResult?optionalResult.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Frustum{constructor(p0,p1,p2,p3,p4,p5){this.planes=[void 0!==p0?p0:new Plane,void 0!==p1?p1:new Plane,void 0!==p2?p2:new Plane,void 0!==p3?p3:new Plane,void 0!==p4?p4:new Plane,void 0!==p5?p5:new Plane]}set(p0,p1,p2,p3,p4,p5){let planes=this.planes;return planes[0].copy(p0),planes[1].copy(p1),planes[2].copy(p2),planes[3].copy(p3),planes[4].copy(p4),planes[5].copy(p5),this}clone(){return(new Frustum).copy(this)}copy(frustum){let planes=this.planes;for(let i=0;i<6;i++)planes[i].copy(frustum.planes[i]);return this}setFromMatrix(m){let planes=this.planes,me=m.elements,me0=me[0],me1=me[1],me2=me[2],me3=me[3],me4=me[4],me5=me[5],me6=me[6],me7=me[7],me8=me[8],me9=me[9],me10=me[10],me11=me[11],me12=me[12],me13=me[13],me14=me[14],me15=me[15];return planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize(),planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize(),planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize(),planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize(),planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize(),planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize(),this}setFromCamera(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse),this.setFromMatrix(matrix)}intersectsObject(object){let sphere=this.S1||new Sphere;this.S1=sphere;let geometry=object.geometry;return!!geometry&&(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(sphere))}intersectsSphere(sphere){let planes=this.planes,center=sphere.center,negRadius=-sphere.radius;for(let i=0;i<6;i++){if(planes[i].distanceToPoint(center)<negRadius)return!1}return!0}intersectsBox(box){let p1=this.V1||new Vector3,p2=this.V2||new Vector3;this.V1=p1,this.V2=p2;let planes=this.planes;for(let i=0;i<6;i++){let plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x,p2.x=plane.normal.x>0?box.max.x:box.min.x,p1.y=plane.normal.y>0?box.min.y:box.max.y,p2.y=plane.normal.y>0?box.max.y:box.min.y,p1.z=plane.normal.z>0?box.min.z:box.max.z,p2.z=plane.normal.z>0?box.max.z:box.min.z;let d1=plane.distanceToPoint(p1),d2=plane.distanceToPoint(p2);if(d1<0&&d2<0)return!1}return!0}containsPoint(point){let planes=this.planes;for(let i=0;i<6;i++)if(planes[i].distanceToPoint(point)<0)return!1;return!0}}class Line3{constructor(start=new Vector3,end=new Vector3){this.start=start,this.end=end}set(start,end){return this.start.copy(start),this.end.copy(end),this}clone(){return(new this.constructor).copy(this)}copy(line){return this.start.copy(line.start),this.end.copy(line.end),this}getCenter(target=new Vector3){return target.addVectors(this.start,this.end).multiplyScalar(.5)}delta(target=new Vector3){return target.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,target=new Vector3){return this.delta(target).multiplyScalar(t).add(this.start)}closestPointToPointParameter(point,clampToLine){let startP=this.V1||new Vector3,startEnd=this.V2||new Vector3;this.V1=startP,this.V2=startEnd,startP.subVectors(point,this.start),startEnd.subVectors(this.end,this.start);let startEnd2=startEnd.dot(startEnd),t=startEnd.dot(startP)/startEnd2;return clampToLine&&(t=Math.clamp(t,0,1)),t}closestPointToPoint(point,clampToLine,target=new Vector3){let t=this.closestPointToPointParameter(point,clampToLine);return this.delta(target).multiplyScalar(t).add(this.start)}applyMatrix4(matrix){return this.start.applyMatrix4(matrix),this.end.applyMatrix4(matrix),this}equals(line){return line.start.equals(this.start)&&line.end.equals(this.end)}}class Matrix3{constructor(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1])}set(n11,n12,n13,n21,n22,n23,n31,n32,n33){let te=this.elements;return te[0]=n11,te[1]=n21,te[2]=n31,te[3]=n12,te[4]=n22,te[5]=n32,te[6]=n13,te[7]=n23,te[8]=n33,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}clone(){return(new Matrix3).fromArray(this.elements)}copy(m){let te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],this}setFromMatrix4(m){let me=m.elements;return this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]),this}multiply(m){return this.multiplyMatrices(this,m)}premultiply(m){return this.multiplyMatrices(m,this)}multiplyMatrices(a,b){let ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];return te[0]=a11*b11+a12*b21+a13*b31,te[3]=a11*b12+a12*b22+a13*b32,te[6]=a11*b13+a12*b23+a13*b33,te[1]=a21*b11+a22*b21+a23*b31,te[4]=a21*b12+a22*b22+a23*b32,te[7]=a21*b13+a22*b23+a23*b33,te[2]=a31*b11+a32*b21+a33*b31,te[5]=a31*b12+a32*b22+a33*b32,te[8]=a31*b13+a32*b23+a33*b33,this}multiplyScalar(s){let te=this.elements;return te[0]*=s,te[3]*=s,te[6]*=s,te[1]*=s,te[4]*=s,te[7]*=s,te[2]*=s,te[5]*=s,te[8]*=s,this}determinant(){let te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g}getInverse(matrix,throwOnDegenerate){let me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(0===det){let msg=".getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return this.identity()}let detInv=1/det;return te[0]=t11*detInv,te[1]=(n31*n23-n33*n21)*detInv,te[2]=(n32*n21-n31*n22)*detInv,te[3]=t12*detInv,te[4]=(n33*n11-n31*n13)*detInv,te[5]=(n31*n12-n32*n11)*detInv,te[6]=t13*detInv,te[7]=(n21*n13-n23*n11)*detInv,te[8]=(n22*n11-n21*n12)*detInv,this}transpose(){let tmp,m=this.elements;return tmp=m[1],m[1]=m[3],m[3]=tmp,tmp=m[2],m[2]=m[6],m[6]=tmp,tmp=m[5],m[5]=m[7],m[7]=tmp,this}getNormalMatrix(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose()}setUvTransform(tx,ty,sx,sy,rotation,cx,cy){let c=Math.cos(rotation),s=Math.sin(rotation);this.set(sx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,0,0,1)}scale(sx,sy){let te=this.elements;return te[0]*=sx,te[3]*=sx,te[6]*=sx,te[1]*=sy,te[4]*=sy,te[7]*=sy,this}rotate(theta){let c=Math.cos(theta),s=Math.sin(theta),te=this.elements,a11=te[0],a12=te[3],a13=te[6],a21=te[1],a22=te[4],a23=te[7];return te[0]=c*a11+s*a21,te[3]=c*a12+s*a22,te[6]=c*a13+s*a23,te[1]=-s*a11+c*a21,te[4]=-s*a12+c*a22,te[7]=-s*a13+c*a23,this}translate(tx,ty){let te=this.elements;return te[0]+=tx*te[2],te[3]+=tx*te[5],te[6]+=tx*te[8],te[1]+=ty*te[2],te[4]+=ty*te[5],te[7]+=ty*te[8],this}equals(matrix){let te=this.elements,me=matrix.elements;for(let i=0;i<9;i++)if(te[i]!==me[i])return!1;return!0}fromArray(array,offset){void 0===offset&&(offset=0);for(let i=0;i<9;i++)this.elements[i]=array[i+offset];return this}toArray(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);let te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array}applyToBufferAttribute(attribute){let v1=this.V1||new Vector3;this.V1=v1;for(let i=0,l=attribute.count;i<l;i++)v1.x=attribute.array[3*i+0],v1.y=attribute.array[3*i+1],v1.z=attribute.array[3*i+2],v1.applyMatrix3(this),attribute.array[3*i+0]=v1.x,attribute.array[3*i+1]=v1.y,attribute.array[3*i+2]=v1.z;return attribute}}class Matrix4{constructor(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){let te=this.elements;return te[0]=n11,te[4]=n12,te[8]=n13,te[12]=n14,te[1]=n21,te[5]=n22,te[9]=n23,te[13]=n24,te[2]=n31,te[6]=n32,te[10]=n33,te[14]=n34,te[3]=n41,te[7]=n42,te[11]=n43,te[15]=n44,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(m){let te=this.elements,me=m.elements;return te[0]=me[0],te[1]=me[1],te[2]=me[2],te[3]=me[3],te[4]=me[4],te[5]=me[5],te[6]=me[6],te[7]=me[7],te[8]=me[8],te[9]=me[9],te[10]=me[10],te[11]=me[11],te[12]=me[12],te[13]=me[13],te[14]=me[14],te[15]=me[15],this}copyPosition(m){let te=this.elements,me=m.elements;return te[12]=me[12],te[13]=me[13],te[14]=me[14],this}extractBasis(xAxis,yAxis,zAxis){return xAxis.setFromMatrixColumn(this,0),yAxis.setFromMatrixColumn(this,1),zAxis.setFromMatrixColumn(this,2),this}makeBasis(xAxis,yAxis,zAxis){return this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1),this}extractRotation(m){let v1=this.V1||new Vector3;this.V1=v1;let te=this.elements,me=m.elements,scaleX=1/v1.setFromMatrixColumn(m,0).length(),scaleY=1/v1.setFromMatrixColumn(m,1).length(),scaleZ=1/v1.setFromMatrixColumn(m,2).length();return te[0]=me[0]*scaleX,te[1]=me[1]*scaleX,te[2]=me[2]*scaleX,te[4]=me[4]*scaleY,te[5]=me[5]*scaleY,te[6]=me[6]*scaleY,te[8]=me[8]*scaleZ,te[9]=me[9]*scaleZ,te[10]=me[10]*scaleZ,this}makeRotationFromEuler(euler){let te=this.elements,x=euler.x,y=euler.y,z=euler.z,a=Math.cos(x),b=Math.sin(x),c=Math.cos(y),d=Math.sin(y),e=Math.cos(z),f=Math.sin(z);if("XYZ"===euler.order){let ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=-c*f,te[8]=d,te[1]=af+be*d,te[5]=ae-bf*d,te[9]=-b*c,te[2]=bf-ae*d,te[6]=be+af*d,te[10]=a*c}else if("YXZ"===euler.order){let ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b,te[4]=de*b-cf,te[8]=a*d,te[1]=a*f,te[5]=a*e,te[9]=-b,te[2]=cf*b-de,te[6]=df+ce*b,te[10]=a*c}else if("ZXY"===euler.order){let ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b,te[4]=-a*f,te[8]=de+cf*b,te[1]=cf+de*b,te[5]=a*e,te[9]=df-ce*b,te[2]=-a*d,te[6]=b,te[10]=a*c}else if("ZYX"===euler.order){let ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e,te[4]=be*d-af,te[8]=ae*d+bf,te[1]=c*f,te[5]=bf*d+ae,te[9]=af*d-be,te[2]=-d,te[6]=b*c,te[10]=a*c}else if("YZX"===euler.order){let ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=bd-ac*f,te[8]=bc*f+ad,te[1]=f,te[5]=a*e,te[9]=-b*e,te[2]=-d*e,te[6]=ad*f+bc,te[10]=ac-bd*f}else if("XZY"===euler.order){let ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e,te[4]=-f,te[8]=d*e,te[1]=ac*f+bd,te[5]=a*e,te[9]=ad*f-bc,te[2]=bc*f-ad,te[6]=b*e,te[10]=bd*f+ac}return te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this}makeRotationFromQuaternion(q){let te=this.elements,x=q._x,y=q._y,z=q._z,w=q._w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return te[0]=1-(yy+zz),te[4]=xy-wz,te[8]=xz+wy,te[1]=xy+wz,te[5]=1-(xx+zz),te[9]=yz-wx,te[2]=xz-wy,te[6]=yz+wx,te[10]=1-(xx+yy),te[3]=0,te[7]=0,te[11]=0,te[12]=0,te[13]=0,te[14]=0,te[15]=1,this}lookAt(eye,target,up){let x=this.V1||new Vector3,y=this.V2||new Vector3,z=this.V3||new Vector3;this.V1=x,this.V2=y,this.V3=z;let te=this.elements;return z.subVectors(eye,target),0===z.lengthSq()&&(z.z=1),z.normalize(),x.crossVectors(up,z),0===x.lengthSq()&&(1===Math.abs(up.z)?z.x+=1e-4:z.z+=1e-4,z.normalize(),x.crossVectors(up,z)),x.normalize(),y.crossVectors(z,x),te[0]=x.x,te[4]=y.x,te[8]=z.x,te[1]=x.y,te[5]=y.y,te[9]=z.y,te[2]=x.z,te[6]=y.z,te[10]=z.z,this}multiply(m){return this.multiplyMatrices(this,m)}premultiply(m){return this.multiplyMatrices(m,this)}multiplyMatrices(ae,be){let a=ae.elements,b=be.elements,out=this.elements,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,this}multiplyScalar(s){let te=this.elements;return te[0]*=s,te[4]*=s,te[8]*=s,te[12]*=s,te[1]*=s,te[5]*=s,te[9]*=s,te[13]*=s,te[2]*=s,te[6]*=s,te[10]*=s,te[14]*=s,te[3]*=s,te[7]*=s,te[11]*=s,te[15]*=s,this}determinant(){let te=this.elements,n11=te[0],n12=te[4],n13=te[8],n14=te[12],n21=te[1],n22=te[5],n23=te[9],n24=te[13],n31=te[2],n32=te[6],n33=te[10],n34=te[14];return te[3]*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+te[7]*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+te[11]*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+te[15]*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)}transpose(){let tmp,te=this.elements;return tmp=te[1],te[1]=te[4],te[4]=tmp,tmp=te[2],te[2]=te[8],te[8]=tmp,tmp=te[6],te[6]=te[9],te[9]=tmp,tmp=te[3],te[3]=te[12],te[12]=tmp,tmp=te[7],te[7]=te[13],te[13]=tmp,tmp=te[11],te[11]=te[14],te[14]=tmp,this}setPosition(v){let te=this.elements;return te[12]=v.x,te[13]=v.y,te[14]=v.z,this}getInverse(m,throwOnDegenerate){let te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0===det){let msg=".getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate)throw new Error(msg);return this.identity()}let detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this}invert(){const te=this.elements,n11=te[0],n21=te[1],n31=te[2],n41=te[3],n12=te[4],n22=te[5],n32=te[6],n42=te[7],n13=te[8],n23=te[9],n33=te[10],n43=te[11],n14=te[12],n24=te[13],n34=te[14],n44=te[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0===det)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const detInv=1/det;return te[0]=t11*detInv,te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv,te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv,te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv,te[4]=t12*detInv,te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv,te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv,te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv,te[8]=t13*detInv,te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv,te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv,te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv,te[12]=t14*detInv,te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv,te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv,te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv,this}scale(v){let te=this.elements,x=v.x,y=v.y,z=v.z;return te[0]*=x,te[4]*=y,te[8]*=z,te[1]*=x,te[5]*=y,te[9]*=z,te[2]*=x,te[6]*=y,te[10]*=z,te[3]*=x,te[7]*=y,te[11]*=z,this}getMaxScaleOnAxis(){let te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,scaleYSq,scaleZSq))}makeTranslation(x,y,z){return this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1),this}makeRotationX(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1),this}makeRotationY(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1),this}makeRotationZ(theta){let c=Math.cos(theta),s=Math.sin(theta);return this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(axis,angle){let c=Math.cos(angle),s=Math.sin(angle),t=1-c,x=axis.x,y=axis.y,z=axis.z,tx=t*x,ty=t*y;return this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1),this}makeScale(x,y,z){return this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1),this}makeShear(x,y,z){return this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1),this}compose(position,quaternion,scale){return this.makeRotationFromQuaternion(quaternion),this.scale(scale),this.setPosition(position),this}decompose(position,quaternion,scale){let vector=this.V1||new Vector3;this.V1=vector;let matrix=this.M1||new Matrix4;this.M1=matrix;let te=this.elements,sx=vector.set(te[0],te[1],te[2]).length(),sy=vector.set(te[4],te[5],te[6]).length(),sz=vector.set(te[8],te[9],te[10]).length();this.determinant()<0&&(sx=-sx),position.x=te[12],position.y=te[13],position.z=te[14],matrix.copy(this);let invSX=1/sx,invSY=1/sy,invSZ=1/sz;return matrix.elements[0]*=invSX,matrix.elements[1]*=invSX,matrix.elements[2]*=invSX,matrix.elements[4]*=invSY,matrix.elements[5]*=invSY,matrix.elements[6]*=invSY,matrix.elements[8]*=invSZ,matrix.elements[9]*=invSZ,matrix.elements[10]*=invSZ,quaternion.setFromRotationMatrix(matrix),scale.x=sx,scale.y=sy,scale.z=sz,this}makePerspective(left,right,top,bottom,near,far){let te=this.elements,x=2*near/(right-left),y=2*near/(top-bottom),a=(right+left)/(right-left),b=(top+bottom)/(top-bottom),c=-(far+near)/(far-near),d=-2*far*near/(far-near);return te[0]=x,te[4]=0,te[8]=a,te[12]=0,te[1]=0,te[5]=y,te[9]=b,te[13]=0,te[2]=0,te[6]=0,te[10]=c,te[14]=d,te[3]=0,te[7]=0,te[11]=-1,te[15]=0,this}makeOrthographic(left,right,top,bottom,near,far){let te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near),x=(right+left)*w,y=(top+bottom)*h,z=(far+near)*p;return te[0]=2*w,te[4]=0,te[8]=0,te[12]=-x,te[1]=0,te[5]=2*h,te[9]=0,te[13]=-y,te[2]=0,te[6]=0,te[10]=-2*p,te[14]=-z,te[3]=0,te[7]=0,te[11]=0,te[15]=1,this}equals(matrix){let te=this.elements,me=matrix.elements;return te[0]==me[0]&&(te[1]==me[1]&&(te[2]==me[2]&&(te[3]==me[3]&&(te[4]==me[4]&&(te[5]==me[5]&&(te[6]==me[6]&&(te[7]==me[7]&&(te[8]==me[8]&&(te[9]==me[9]&&(te[10]==me[10]&&(te[11]==me[11]&&(te[12]==me[12]&&(te[13]==me[13]&&(te[14]==me[14]&&te[15]==me[15]))))))))))))))}fromArray(array,offset=0){let te=this.elements;return te[0]=array[0+offset],te[1]=array[1+offset],te[2]=array[2+offset],te[3]=array[3+offset],te[4]=array[4+offset],te[5]=array[5+offset],te[6]=array[6+offset],te[7]=array[7+offset],te[8]=array[8+offset],te[9]=array[9+offset],te[10]=array[10+offset],te[11]=array[11+offset],te[12]=array[12+offset],te[13]=array[13+offset],te[14]=array[14+offset],te[15]=array[15+offset],this}toArray(array,offset){void 0===array&&(array=[]),void 0===offset&&(offset=0);let te=this.elements;return array[offset]=te[0],array[offset+1]=te[1],array[offset+2]=te[2],array[offset+3]=te[3],array[offset+4]=te[4],array[offset+5]=te[5],array[offset+6]=te[6],array[offset+7]=te[7],array[offset+8]=te[8],array[offset+9]=te[9],array[offset+10]=te[10],array[offset+11]=te[11],array[offset+12]=te[12],array[offset+13]=te[13],array[offset+14]=te[14],array[offset+15]=te[15],array}applyToBufferAttribute(attribute){let v1=this.V1||new Vector3;this.V1=v1;for(let i=0,l=attribute.count;i<l;i++)v1.x=attribute.array[3*i+0],v1.y=attribute.array[3*i+1],v1.z=attribute.array[3*i+2],v1.applyMatrix4(this),attribute.array[3*i+0]=v1.x,attribute.array[3*i+1]=v1.y,attribute.array[3*i+2]=v1.z;return attribute}isIdentity(){let te=this.elements;return 1==te[0]&&(0==te[1]&&(0==te[2]&&(0==te[3]&&(0==te[4]&&(1==te[5]&&(0==te[6]&&(0==te[7]&&(0==te[8]&&(0==te[9]&&(1==te[10]&&(0==te[11]&&(0==te[12]&&(0==te[13]&&(0==te[14]&&1==te[15]))))))))))))))}}Matrix4.__IDENTITY__=new Matrix4;class Plane{constructor(normal,constant){this.normal=void 0!==normal?normal:new Vector3(1,0,0),this.constant=void 0!==constant?constant:0}set(normal,constant){return this.normal.copy(normal),this.constant=constant,this}setComponents(x,y,z,w){return this.normal.set(x,y,z),this.constant=w,this}setFromNormalAndCoplanarPoint(normal,point){return this.normal.copy(normal),this.constant=-point.dot(this.normal),this}setFromCoplanarPoints(a,b,c){let v1=this.V1||new Vector3,v2=this.V2||new Vector3;this.V1=v1,this.V2=v2;var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(normal,a),this}clone(){return(new Plane).copy(this)}copy(plane){return this.normal.copy(plane.normal),this.constant=plane.constant,this}normalize(){var inverseNormalLength=1/this.normal.length();return this.normal.multiplyScalar(inverseNormalLength),this.constant*=inverseNormalLength,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(point){return this.normal.dot(point)+this.constant}distanceToSphere(sphere){return this.distanceToPoint(sphere.center)-sphere.radius}projectPoint(point,target){return target.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point)}intersectLine(line,target){let v1=this.V1||new Vector3;this.V1=v1;var direction=line.delta(v1),denominator=this.normal.dot(direction);if(0===denominator)return 0===this.distanceToPoint(line.start)?target.copy(line.start):void 0;var t=-(line.start.dot(this.normal)+this.constant)/denominator;return t<0||t>1?void 0:target.copy(direction).multiplyScalar(t).add(line.start)}intersectsLine(line){var startSign=this.distanceToPoint(line.start),endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0}intersectsBox(box){return box.intersectsPlane(this)}intersectsSphere(sphere){return sphere.intersectsPlane(this)}coplanarPoint(target){return target.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(matrix,optionalNormalMatrix){let v1=this.V1||new Vector3;this.V1=v1;let m1=this.M1||new Matrix3;this.M1=m1;var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix),referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix),normal=this.normal.applyMatrix3(normalMatrix).normalize();return this.constant=-referencePoint.dot(normal),this}translate(offset){return this.constant-=offset.dot(this.normal),this}equals(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}}class Quaternion{constructor(x,y,z,w){this._x=x||0,this._y=y||0,this._z=z||0,this._w=void 0!==w?w:1,this.isQuaternion=!0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}get w(){return this._w}set w(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Quaternion::NaN");let dirty=Math.abs(this._w-v)>Base3D.DIRTY_EPSILON;this._w=v,dirty&&this.onChangeCallback()}clone(){return new Quaternion(this._x,this._y,this._z,this._w)}copy(quaternion){const abs=Math.abs;let dirty=abs(this._x-quaternion.x)>Base3D.DIRTY_EPSILON||abs(this._y-quaternion.y)>Base3D.DIRTY_EPSILON||abs(this._z-quaternion.z)>Base3D.DIRTY_EPSILON||abs(this._w-quaternion.w)>Base3D.DIRTY_EPSILON;return this._x=quaternion.x,this._y=quaternion.y,this._z=quaternion.z,this._w=quaternion.w,dirty&&this.onChangeCallback(),this}set(x,y,z,w){const abs=Math.abs;let dirty=abs(this._x-x)>Base3D.DIRTY_EPSILON||abs(this._y-y)>Base3D.DIRTY_EPSILON||abs(this._z-z)>Base3D.DIRTY_EPSILON||abs(this._w-w)>Base3D.DIRTY_EPSILON;this._x=x,this._y=y,this._z=z,this._w=w,dirty&&this.onChangeCallback()}setFromEuler(euler,update){let x=euler._x,y=euler._y,z=euler._z,order=euler.order,cos=Math.cos,sin=Math.sin,c1=cos(x/2),c2=cos(y/2),c3=cos(z/2),s1=sin(x/2),s2=sin(y/2),s3=sin(z/2);return"XYZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"YXZ"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"ZXY"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"ZYX"===order?(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3):"YZX"===order?(this._x=s1*c2*c3+c1*s2*s3,this._y=c1*s2*c3+s1*c2*s3,this._z=c1*c2*s3-s1*s2*c3,this._w=c1*c2*c3-s1*s2*s3):"XZY"===order&&(this._x=s1*c2*c3-c1*s2*s3,this._y=c1*s2*c3-s1*c2*s3,this._z=c1*c2*s3+s1*s2*c3,this._w=c1*c2*c3+s1*s2*s3),!1!==update&&this.onChangeCallback(),this}setFromAxisAngle(axis,angle){let halfAngle=angle/2,s=Math.sin(halfAngle);return this._x=axis.x*s,this._y=axis.y*s,this._z=axis.z*s,this._w=Math.cos(halfAngle),this.onChangeCallback(),this}setFromRotationMatrix(m){let s,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33;return trace>0?(s=.5/Math.sqrt(trace+1),this._w=.25/s,this._x=(m32-m23)*s,this._y=(m13-m31)*s,this._z=(m21-m12)*s):m11>m22&&m11>m33?(s=2*Math.sqrt(1+m11-m22-m33),this._w=(m32-m23)/s,this._x=.25*s,this._y=(m12+m21)/s,this._z=(m13+m31)/s):m22>m33?(s=2*Math.sqrt(1+m22-m11-m33),this._w=(m13-m31)/s,this._x=(m12+m21)/s,this._y=.25*s,this._z=(m23+m32)/s):(s=2*Math.sqrt(1+m33-m11-m22),this._w=(m21-m12)/s,this._x=(m13+m31)/s,this._y=(m23+m32)/s,this._z=.25*s),this.onChangeCallback(),this}setFromUnitVectors(vFrom,vTo){let v1=this.V1||new Vector3;this.V1=v1;let r=vFrom.dot(vTo)+1;return r<1e-6?(r=0,Math.abs(vFrom.x)>Math.abs(vFrom.z)?v1.set(-vFrom.y,vFrom.x,0):v1.set(0,-vFrom.z,vFrom.y)):v1.crossVectors(vFrom,vTo),this._x=v1.x,this._y=v1.y,this._z=v1.z,this._w=r,this.normalize()}inverse(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this}dot(v){const w=void 0===v._w?1:v._w;return this._x*v._x+this._y*v._y+this._z*v._z+this._w*w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let l=this.length();return 0===l?(this._x=0,this._y=0,this._z=0,this._w=1):(l=1/l,this._x=this._x*l,this._y=this._y*l,this._z=this._z*l,this._w=this._w*l),this.onChangeCallback(),this}multiply(q){return this.multiplyQuaternions(this,q)}premultiply(q){return this.multiplyQuaternions(q,this)}multiplyQuaternions(a,b){let qax=a._x,qay=a._y,qaz=a._z,qaw=a._w,qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;return this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby,this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz,this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx,this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz,this.onChangeCallback(),this}slerp(qb,t,hz=!0){if(0===(t=hz?Math.framerateNormalizeLerpAlpha(t):Math.clamp(t)))return this;if(1===t)return this.copy(qb);let x=this._x,y=this._y,z=this._z,w=this._w,cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0?(this._w=-qb._w,this._x=-qb._x,this._y=-qb._y,this._z=-qb._z,cosHalfTheta=-cosHalfTheta):this.copy(qb),cosHalfTheta>=1)return this._w=w,this._x=x,this._y=y,this._z=z,this;let sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001)return this._w=.5*(w+this._w),this._x=.5*(x+this._x),this._y=.5*(y+this._y),this._z=.5*(z+this._z),this;let halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta),ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return this._w=w*ratioA+this._w*ratioB,this._x=x*ratioA+this._x*ratioB,this._y=y*ratioA+this._y*ratioB,this._z=z*ratioA+this._z*ratioB,this.onChangeCallback(),this}equals(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w}fromArray(array,offset){return void 0===offset&&(offset=0),this._x=array[offset],this._y=array[offset+1],this._z=array[offset+2],this._w=array[offset+3],this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array[offset+3]=this._w,array}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}class RayManager{constructor(origin,direction,near=0,far=1/0){this.ray=new Ray(origin,direction),this.near=near,this.far=far,this.params={Mesh:{},Points:{threshold:1}}}set(origin,direction){return this.ray.set(origin,direction),this}setFromCamera(coords,camera){camera.isPerspective?(this.ray.origin.setFromMatrixPosition(camera.matrixWorld),this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()):(this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera),this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld))}_ascSort(a,b){return a.distance-b.distance}_intersectObject(object,raycaster,intersects,recursive,forceAllVisible){if((!1!==object.visible||forceAllVisible)&&(object.raycast&&object.raycast(raycaster,intersects),!0===recursive)){let children=object.children;for(let i=0,l=children.length;i<l;i++)this._intersectObject(children[i],raycaster,intersects,!0)}}intersectObject(object,recursive,optionalTarget,forceAllVisible){let intersects=optionalTarget||[];return this._intersectObject(object,this,intersects,recursive,forceAllVisible),intersects.sort(this._ascSort),intersects}intersectObjects(objects,recursive,optionalTarget){let intersects=optionalTarget||[];for(let i=0,l=objects.length;i<l;i++)this._intersectObject(objects[i],this,intersects,recursive);return intersects.sort(this._ascSort),intersects}}class Ray{constructor(origin=new Vector3,direction=new Vector3){this.origin=origin,this.direction=direction}set(origin,direction){return this.origin.copy(origin),this.direction.copy(direction),this}clone(){return(new Ray).copy(this)}copy(ray){return this.origin.copy(ray.origin),this.direction.copy(ray.direction),this}at(t,target=new Vector3){return target.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(v){return this.direction.copy(v).sub(this.origin).normalize(),this}recast(t){let v1=this.V1||new Vector3;this.V1=v1,this.origin.copy(this.at(t,v1))}closestPointToPoint(point,target=new Vector3){target.subVectors(point,this.origin);let directionDistance=target.dot(this.direction);return directionDistance<0?target.copy(this.origin):target.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)}distanceToPoint(point){return Math.sqrt(this.distanceSqToPoint(point))}distanceSqToPoint(point){let v1=this.V1||new Vector3;this.V1=v1;let directionDistance=v1.subVectors(point,this.origin).dot(this.direction);return directionDistance<0?this.origin.distanceToSquared(point):(v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin),v1.distanceToSquared(point))}distanceSqToSegment(v0,v1,optionalPointOnRay,optionalPointOnSegment){let segCenter=this.V1||new Vector3,segDir=this.V2||new Vector3,diff=this.V3||new Vector3;this.V1=segCenter,this.V2=segDir,this.V3=diff,segCenter.copy(v0).add(v1).multiplyScalar(.5),segDir.copy(v1).sub(v0).normalize(),diff.copy(this.origin).sub(segCenter);let s0,s1,sqrDist,extDet,segExtent=.5*v0.distanceTo(v1),a01=-this.direction.dot(segDir),b0=diff.dot(this.direction),b1=-diff.dot(segDir),c=diff.lengthSq(),det=Math.abs(1-a01*a01);if(det>0)if(s0=a01*b1-b0,s1=a01*b0-b1,extDet=segExtent*det,s0>=0)if(s1>=-extDet)if(s1<=extDet){let invDet=1/det;s0*=invDet,s1*=invDet,sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else s1=segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;else s1=-segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;else s1<=-extDet?(s0=Math.max(0,-(-a01*segExtent+b0)),s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=-s0*s0+s1*(s1+2*b1)+c):s1<=extDet?(s0=0,s1=Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=s1*(s1+2*b1)+c):(s0=Math.max(0,-(a01*segExtent+b0)),s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent),sqrDist=-s0*s0+s1*(s1+2*b1)+c);else s1=a01>0?-segExtent:segExtent,s0=Math.max(0,-(a01*s1+b0)),sqrDist=-s0*s0+s1*(s1+2*b1)+c;return optionalPointOnRay&&optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin),optionalPointOnSegment&&optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter),sqrDist}intersectSphere(sphere,target){let v1=this.V1||new Vector3;this.V1=v1,v1.subVectors(sphere.center,this.origin);let tca=v1.dot(this.direction),d2=v1.dot(v1)-tca*tca,radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;let thc=Math.sqrt(radius2-d2),t0=tca-thc,t1=tca+thc;return t0<0&&t1<0?null:t0<0?this.at(t1,target):this.at(t0,target)}intersectsSphere(sphere){return this.distanceSqToPoint(sphere.center)<=sphere.radius*sphere.radius}distanceToPlane(plane){let denominator=plane.normal.dot(this.direction);if(0===denominator)return 0===plane.distanceToPoint(this.origin)?0:null;let t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null}intersectPlane(plane,target){let t=this.distanceToPlane(plane);return null===t?null:this.at(t,target)}intersectsPlane(plane){let distToPoint=plane.distanceToPoint(this.origin);return 0===distToPoint||plane.normal.dot(this.direction)*distToPoint<0}intersectBox(box,target){let tmin,tmax,tymin,tymax,tzmin,tzmax,invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z,origin=this.origin;return invdirx>=0?(tmin=(box.min.x-origin.x)*invdirx,tmax=(box.max.x-origin.x)*invdirx):(tmin=(box.max.x-origin.x)*invdirx,tmax=(box.min.x-origin.x)*invdirx),invdiry>=0?(tymin=(box.min.y-origin.y)*invdiry,tymax=(box.max.y-origin.y)*invdiry):(tymin=(box.max.y-origin.y)*invdiry,tymax=(box.min.y-origin.y)*invdiry),tmin>tymax||tymin>tmax?null:((tymin>tmin||tmin!=tmin)&&(tmin=tymin),(tymax<tmax||tmax!=tmax)&&(tmax=tymax),invdirz>=0?(tzmin=(box.min.z-origin.z)*invdirz,tzmax=(box.max.z-origin.z)*invdirz):(tzmin=(box.max.z-origin.z)*invdirz,tzmax=(box.min.z-origin.z)*invdirz),tmin>tzmax||tzmin>tmax?null:((tzmin>tmin||tmin!=tmin)&&(tmin=tzmin),(tzmax<tmax||tmax!=tmax)&&(tmax=tzmax),tmax<0?null:this.at(tmin>=0?tmin:tmax,target)))}intersectsBox(box){let v=this.V1||new Vector3;return this.V1=v,null!==this.intersectBox(box,v)}intersectsTriangle(a,b,c,backfaceCulling,target){let diff=this.V1||new Vector3,edge1=this.V2||new Vector3,edge2=this.V3||new Vector3,normal=this.V4||new Vector3;this.V1=diff,this.V2=edge1,this.V3=edge2,this.V4=normal,edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);let sign,DdN=this.direction.dot(normal);if(DdN>0){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);let DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;let DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdQxE2+DdE1xQ>DdN)return null;let QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,target)}applyMatrix4(matrix4){return this.origin.applyMatrix4(matrix4),this.direction.transformDirection(matrix4),this}equals(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}}class Sphere{constructor(center=new Vector3,radius=0){this.center=center,this.radius=radius}set(center,radius){return this.center.copy(center),this.radius=radius,this}setFromPoints(points,optionalCenter){let box=this.V1||new Box3;this.V1=box;let center=this.center;void 0!==optionalCenter?center.copy(optionalCenter):box.setFromPoints(points).getCenter(center);let maxRadiusSq=0;for(let i=0,il=points.length;i<il;i++)maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]));return this.radius=Math.sqrt(maxRadiusSq),this}clone(){return(new this.constructor).copy(this)}copy(sphere){return this.center.copy(sphere.center),this.radius=sphere.radius,this}empty(){return this.radius<=0}containsPoint(point){return point.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(point){return point.distanceTo(this.center)-this.radius}intersectsSphere(sphere){let radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum}intersectsBox(box){return box.intersectsSphere(this)}intersectsPlane(plane){return Math.abs(plane.distanceToPoint(this.center))<=this.radius}clampPoint(point,target=new Vector3){let deltaLengthSq=this.center.distanceToSquared(point);return target.copy(point),deltaLengthSq>this.radius*this.radius&&(target.sub(this.center).normalize(),target.multiplyScalar(this.radius).add(this.center)),target}getBoundingBox(target=new Box3){return target.set(this.center,this.center),target.expandByScalar(this.radius),target}applyMatrix4(matrix){return this.center.applyMatrix4(matrix),this.radius=this.radius*matrix.getMaxScaleOnAxis(),this}translate(offset){return this.center.add(offset),this}equals(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}}class Spherical{constructor(radius=1,phi=0,theta=0){this.radius=radius,this.phi=phi,this.theta=theta}set(radius,phi,theta){return this.radius=radius,this.phi=phi,this.theta=theta,this}clone(){return(new Spherical).copy(this)}copy(other){return this.radius=other.radius,this.phi=other.phi,this.theta=other.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(vec3){return this.radius=vec3.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(vec3.x,vec3.z),this.phi=Math.acos(Math.clamp(vec3.y/this.radius,-1,1))),this}}class Triangle{constructor(a=new Vector3,b=new Vector3,c=new Vector3){this.a=a,this.b=b,this.c=c}set(a,b,c){return this.a.copy(a),this.b.copy(b),this.c.copy(c),this}setFromPointsAndIndices(points,i0,i1,i2){return this.a.copy(points[i0]),this.b.copy(points[i1]),this.c.copy(points[i2]),this}clone(){return(new Triangle).copy(this)}copy(triangle){return this.a.copy(triangle.a),this.b.copy(triangle.b),this.c.copy(triangle.c),this}getArea(){let v0=this.V0||new Vector3,v1=this.V1||new Vector3;return this.V0=v0,this.V1=v1,v0.subVectors(this.c,this.b),v1.subVectors(this.a,this.b),.5*v0.cross(v1).length()}getMidpoint(target=new Vector3){return target.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(target){return Triangle.getNormal(this.a,this.b,this.c,target)}getPlane(target=new Vector3){return target.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(point,target){return Triangle.getBarycoord(point,this.a,this.b,this.c,target)}containsPoint(point){return Triangle.containsPoint(point,this.a,this.b,this.c)}intersectsBox(box){return box.intersectsTriangle(this)}equals(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}}class Vector2{constructor(x=0,y=0){this.x=x,this.y=y}set(x,y){return this.x=x,this.y=y,this}get width(){return this.x}get height(){return this.y}setScalar(s){return this.x=this.y=s,this}clone(){return new Vector2(this.x,this.y)}copy(v){return this.x=v.x,this.y=v.y,this}add(v){return this.x+=v.x,this.y+=v.y,this}addScalar(s){return this.x+=s,this.y+=s,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this}addScaledVector(v,s){return this.x+=v.x*s,this.y+=v.y*s,this}sub(v){return this.x-=v.x,this.y-=v.y,this}subScalar(s){return this.x-=s,this.y-=s,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this}multiply(v){return this.x*=v.x,this.y*=v.y,this}multiplyScalar(scalar){return this.x*=scalar,this.y*=scalar,this}divide(v){return this.x/=v.x,this.y/=v.y,this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}applyMatrix3(m){let x=this.x,y=this.y,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6],this.y=e[1]*x+e[4]*y+e[7],this}min(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this}max(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this}clamp(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this}clampScalar(minVal,maxVal){let min=new Vector2,max=new Vector2;return min.set(minVal,minVal),max.set(maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(v){return this.x*v.x+this.y*v.y}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let angle=Math.atan2(this.y,this.x);return angle<0&&(angle+=2*Math.PI),angle}angleTo(a,b){return b||(b=this),Math.atan2(a.y-b.y,a.x-b.x)}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy}manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)}setLength(length){return this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this}lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}equals(v){return v.x===this.x&&v.y===this.y}setAngleRadius(a,r){return this.x=Math.cos(a)*r,this.y=Math.sin(a)*r,this}addAngleRadius(a,r){return this.x+=Math.cos(a)*r,this.y+=Math.sin(a)*r,this}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array}rotateAround(center,angle){let c=Math.cos(angle),s=Math.sin(angle),x=this.x-center.x,y=this.y-center.y;return this.x=x*c-y*s+center.x,this.y=x*s+y*c+center.y,this}fromBufferAttribute(attribute,index){this.x=attribute.array[2*index+0],this.y=attribute.array[2*index+1]}}class Vector3{constructor(x,y,z){this.x=x||0,this.y=y||0,this.z=z||0}set(x,y,z){return this.x=x||0,this.y=y||0,this.z=z||0,this}setScalar(scalar){return this.x=scalar,this.y=scalar,this.z=scalar,this}clone(){return new Vector3(this.x,this.y,this.z)}copy(v){return this.x=v.x,this.y=v.y,this.z=v.z,this}add(v){return this.x+=v.x,this.y+=v.y,this.z+=v.z,this}addScalar(s){return this.x+=s,this.y+=s,this.z+=s,this}addVectors(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}addScaledVector(v,s){return this.x+=v.x*s,this.y+=v.y*s,this.z+=v.z*s,this}sub(v){return this.x-=v.x,this.y-=v.y,this.z-=v.z,this}subScalar(s){return this.x-=s,this.y-=s,this.z-=s,this}subVectors(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}multiply(v){return this.x*=v.x,this.y*=v.y,this.z*=v.z,this}multiplyScalar(scalar){return this.x*=scalar,this.y*=scalar,this.z*=scalar,this}multiplyVectors(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}applyEuler(euler){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromEuler(euler))}applyAxisAngle(axis,angle){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}applyMatrix3(m){let x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[3]*y+e[6]*z,this.y=e[1]*x+e[4]*y+e[7]*z,this.z=e[2]*x+e[5]*y+e[8]*z,this}applyMatrix4(m){let x=this.x,y=this.y,z=this.z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w,this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w,this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w,this}applyQuaternion(q){let x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w;if(0==qx&&0==qy&&0==qz&&1==qw)return this;let ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this}project(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld)),this.applyMatrix4(matrix)}unproject(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyMatrix4(matrix)}transformDirection(m){let x=this.x,y=this.y,z=this.z,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z,this.y=e[1]*x+e[5]*y+e[9]*z,this.z=e[2]*x+e[6]*y+e[10]*z,this.normalize()}divide(v){return this.x/=v.x,this.y/=v.y,this.z/=v.z,this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}min(v){return this.x=Math.min(this.x,v.x),this.y=Math.min(this.y,v.y),this.z=Math.min(this.z,v.z),this}max(v){return this.x=Math.max(this.x,v.x),this.y=Math.max(this.y,v.y),this.z=Math.max(this.z,v.z),this}clamp(min,max){return this.x=Math.max(min.x,Math.min(max.x,this.x)),this.y=Math.max(min.y,Math.min(max.y,this.y)),this.z=Math.max(min.z,Math.min(max.z,this.z)),this}clampScalar(minVal,maxVal){let min=new Vector3,max=new Vector3;return min.set(minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(length){return this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this.z=Math.lerp(v.z,this.z,alpha,hz),this}lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}cross(v){return this.crossVectors(this,v)}crossVectors(a,b){let ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this.x=ay*bz-az*by,this.y=az*bx-ax*bz,this.z=ax*by-ay*bx,this}projectOnVector(vector){let scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)}projectOnPlane(planeNormal){let v1=this.V1||new Vector3;return this.V1=v1,v1.copy(this).projectOnVector(planeNormal),this.sub(v1)}reflect(normal){let v1=this.V1||new Vector3;return this.V1=v1,this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}angleTo(v){let theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(Math.clamp(theta,-1,1))}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz}manhattanDistanceTo(v){return Math.abs(this.x-v.x)+Math.abs(this.y-v.y)+Math.abs(this.z-v.z)}setFromCylindrical(c){return this.x=c.radius*Math.sin(c.theta),this.y=c.y,this.z=c.radius*Math.cos(c.theta),this}setFromMatrixPosition(m){let e=m.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(m){let sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.x=sx,this.y=sy,this.z=sz,this}setFromMatrixColumn(m,index){return this.fromArray(m.elements,4*index)}setAngleRadius(a,r,dir="xy"){return this[dir[0]]=Math.cos(a)*r,this[dir[1]]=Math.sin(a)*r,this}addAngleRadius(a,r,dir="xy"){return this[dir[0]]+=Math.cos(a)*r,this[dir[1]]+=Math.sin(a)*r,this}equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this}setFromSpherical(s){this.setFromSphericalCoords(s.radius,s.phi,s.theta)}setFromSphericalCoords(radius,phi,theta){let sinPhiRadius=Math.sin(phi)*radius;return this.x=sinPhiRadius*Math.sin(theta),this.y=Math.cos(phi)*radius,this.z=sinPhiRadius*Math.cos(theta),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array}fromBufferAttribute(attribute,index){return this.x=attribute.array[3*index+0],this.y=attribute.array[3*index+1],this.z=attribute.array[3*index+2],this}}class Vector3D{constructor(x,y,z){this._x=x||0,this._y=y||0,this._z=z||0}get x(){return this._x}set x(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._x-v)>Base3D.DIRTY_EPSILON;this._x=v,dirty&&this.onChangeCallback()}get y(){return this._y}set y(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._y-v)>Base3D.DIRTY_EPSILON;this._y=v,dirty&&this.onChangeCallback()}get z(){return this._z}set z(v){if(zUtils3D.LOCAL&&isNaN(v))return console.trace("Vector3D::NaN");let dirty=Math.abs(this._z-v)>Base3D.DIRTY_EPSILON;this._z=v,dirty&&this.onChangeCallback()}onChangeCallback(){}set(x=0,y=0,z=0){const abs=Math.abs;let dirty=abs(this._x-x)>Base3D.DIRTY_EPSILON||abs(this._y-y)>Base3D.DIRTY_EPSILON||abs(this._z-z)>Base3D.DIRTY_EPSILON;return this._x=x,this._y=y,this._z=z,dirty&&this.onChangeCallback(),this}setScalar(scalar){const abs=Math.abs;let dirty=abs(this._x-scalar)>Base3D.DIRTY_EPSILON||abs(this._y-scalar)>Base3D.DIRTY_EPSILON||abs(this._z-scalar)>Base3D.DIRTY_EPSILON;return this._x=scalar,this._y=scalar,this._z=scalar,dirty&&this.onChangeCallback(),this}clone(){return new Vector3(this._x,this._y,this._z)}copy(v){const abs=Math.abs;let dirty=abs(this._x-v.x)>Base3D.DIRTY_EPSILON||abs(this._y-v.y)>Base3D.DIRTY_EPSILON||abs(this._z-v.z)>Base3D.DIRTY_EPSILON;return this._x=v.x,this._y=v.y,this._z=v.z,dirty&&this.onChangeCallback(),this}add(v){let nx=this._x+v.x,ny=this._y+v.y,nz=this._z+v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}addScalar(s){let nx=this._x+s,ny=this._y+s,nz=this._z+s;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}addVectors(a,b){return this._x=a.x+b.x,this._y=a.y+b.y,this._z=a.z+b.z,this.onChangeCallback(),this}addScaledVector(v){return this._x+=v.x*s,this._y+=v.y*s,this._z+=v.z*s,this.onChangeCallback(),this}sub(v){let nx=this._x-v.x,ny=this._y-v.y,nz=this._z-v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}subScalar(s){let nx=this._x-s,ny=this._y-s,nz=this._z-s;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}subVectors(a,b){return this._x=a.x-b.x,this._y=a.y-b.y,this._z=a.z-b.z,this.onChangeCallback(),this}multiply(v){let nx=this._x*v.x,ny=this._y*v.y,nz=this._z*v.z;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}multiplyScalar(scalar){let nx=this._x*scalar,ny=this._y*scalar,nz=this._z*scalar;const abs=Math.abs;let dirty=abs(this._x-nx)>Base3D.DIRTY_EPSILON||abs(this._y-ny)>Base3D.DIRTY_EPSILON||abs(this._z-nz)>Base3D.DIRTY_EPSILON;return this._x=nx,this._y=ny,this._z=nz,dirty&&this.onChangeCallback(),this}multiplyVectors(a,b){return this._x=a.x*b.x,this._y=a.y*b.y,this._z=a.z*b.z,this.onChangeCallback(),this}applyEuler(euler){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromEuler(euler))}applyAxisAngle(axis,angle){let quaternion=this.Q1||new Quaternion;return this.Q1=quaternion,this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}applyMatrix3(m){let x=this._x,y=this._y,z=this._z,e=m.elements;return this._x=e[0]*x+e[3]*y+e[6]*z,this._y=e[1]*x+e[4]*y+e[7]*z,this._z=e[2]*x+e[5]*y+e[8]*z,this.onChangeCallback(),this}applyMatrix4(m){let x=this._x,y=this._y,z=this._z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);return this._x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w,this._y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w,this._z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w,this.onChangeCallback(),this}applyQuaternion(q){let x=this._x,y=this._y,z=this._z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return this._x=ix*qw+iw*-qx+iy*-qz-iz*-qy,this._y=iy*qw+iw*-qy+iz*-qx-ix*-qz,this._z=iz*qw+iw*-qz+ix*-qy-iy*-qx,this.onChangeCallback(),this}project(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld)),this.applyMatrix4(matrix)}unproject(camera){let matrix=this.M1||new Matrix4;return this.M1=matrix,matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix)),this.applyMatrix4(matrix)}transformDirection(m){let x=this._x,y=this._y,z=this._z,e=m.elements;return this._x=e[0]*x+e[4]*y+e[8]*z,this._y=e[1]*x+e[5]*y+e[9]*z,this._z=e[2]*x+e[6]*y+e[10]*z,this.onChangeCallback(),this.normalize()}divide(v){return this._x/=v.x,this._y/=v.y,this._z/=v.z,this.onChangeCallback(),this}divideScalar(scalar){return this.multiplyScalar(1/scalar)}min(v){return this._x=Math.min(this._x,v.x),this._y=Math.min(this._y,v.y),this._z=Math.min(this._z,v.z),this.onChangeCallback(),this}max(v){return this._x=Math.max(this._x,v.x),this._y=Math.max(this._y,v.y),this._z=Math.max(this._z,v.z),this}clamp(min,max){return this._x=Math.max(min.x,Math.min(max.x,this._x)),this._y=Math.max(min.y,Math.min(max.y,this._y)),this._z=Math.max(min.z,Math.min(max.z,this._z)),this}clampScalar(minVal,maxVal){let min=new Vector3,max=new Vector3;return min.set(minVal,minVal,minVal),max.set(maxVal,maxVal,maxVal),this.clamp(min,max)}clampLength(min,max){let length=this.length();return this.divideScalar(length||1).multiplyScalar(Math.max(min,Math.min(max,length)))}floor(){return this._x=Math.floor(this._x),this._y=Math.floor(this._y),this._z=Math.floor(this._z),this.onChangeCallback(),this}ceil(){return this._x=Math.ceil(this._x),this._y=Math.ceil(this._y),this._z=Math.ceil(this._z),this.onChangeCallback(),this}round(){return this._x=Math.round(this._x),this._y=Math.round(this._y),this._z=Math.round(this._z),this.onChangeCallback(),this}roundToZero(){return this._x=this._x<0?Math.ceil(this._x):Math.floor(this._x),this._y=this._y<0?Math.ceil(this._y):Math.floor(this._y),this._z=this._z<0?Math.ceil(this._z):Math.floor(this._z),this.onChangeCallback(),this}negate(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this.onChangeCallback(),this}dot(v){return this._x*v.x+this._y*v.y+this._z*v.z}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)}manhattanLength(){return Math.abs(this._x)+Math.abs(this._y)+Math.abs(this._z)}normalize(){return this.onChangeCallback(),this.divideScalar(this.length()||1)}setLength(length){return this.onChangeCallback(),this.normalize().multiplyScalar(length)}lerp(v,alpha,hz){return this._x=Math.lerp(v.x,this._x,alpha,hz),this._y=Math.lerp(v.y,this._y,alpha,hz),this._z=Math.lerp(v.z,this._z,alpha,hz),this.onChangeCallback(),this}lerpVectors(v1,v2,alpha){return this.onChangeCallback(),this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)}cross(v){return this.crossVectors(this,v)}crossVectors(a,b){let ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;return this._x=ay*bz-az*by,this._y=az*bx-ax*bz,this._z=ax*by-ay*bx,this.onChangeCallback(),this}projectOnVector(vector){let scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)}projectOnPlane(planeNormal){let v1=this.V1||new Vector3;return this.V1=v1,this.onChangeCallback(),v1.copy(this).projectOnVector(planeNormal),this.sub(v1)}reflect(normal){let v1=this.V1||new Vector3;return this.V1=v1,this.onChangeCallback(),this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}angleTo(v){let theta=this.dot(v)/Math.sqrt(this.lengthSq()*v.lengthSq());return Math.acos(Math.clamp(theta,-1,1))}distanceTo(v){return Math.sqrt(this.distanceToSquared(v))}distanceToSquared(v){let dx=this._x-v.x,dy=this._y-v.y,dz=this._z-v.z;return dx*dx+dy*dy+dz*dz}manhattanDistanceTo(v){return Math.abs(this._x-v.x)+Math.abs(this._y-v.y)+Math.abs(this._z-v.z)}setFromSpherical(s){let sinPhiRadius=Math.sin(s.phi)*s.radius;return this._x=sinPhiRadius*Math.sin(s.theta),this._y=Math.cos(s.phi)*s.radius,this._z=sinPhiRadius*Math.cos(s.theta),this.onChangeCallback(),this}setFromCylindrical(c){return this._x=c.radius*Math.sin(c.theta),this._y=c.y,this._z=c.radius*Math.cos(c.theta),this.onChangeCallback(),this}setFromMatrixPosition(m){let e=m.elements;return this._x=e[12],this._y=e[13],this._z=e[14],this.onChangeCallback(),this}setFromMatrixScale(m){let sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();return this.onChangeCallback(),this._x=sx,this._y=sy,this._z=sz,this}setFromMatrixColumn(m,index){return this.onChangeCallback(),this.fromArray(m.elements,4*index)}equals(v){return v.x===this._x&&v.y===this._y&&v.z===this._z}fromArray(array,offset){return void 0===offset&&(offset=0),this._x=array[offset],this._y=array[offset+1],this._z=array[offset+2],this.onChangeCallback(),this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this._x,array[offset+1]=this._y,array[offset+2]=this._z,array}fromBufferAttribute(attribute,index){this._x=attribute.array[3*index+0],this._y=attribute.array[3*index+1],this._z=attribute.array[3*index+2],this.onChangeCallback()}onChange(callback){this.onChangeCallback=callback}onChangeCallback(){}}class Vector4{constructor(x=0,y=0,z=0,w=0){this.x=x,this.y=y,this.z=z,this.w=w}multiplyScalar(s){return this.x*=s,this.y*=s,this.z*=s,this.w*=s,this}set(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this}copy(v){return this.x=v.x,this.y=v.y,this.z=v.z,this.w=v.w,this}dot(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}equals(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w}lerp(v,alpha,hz){return this.x=Math.lerp(v.x,this.x,alpha,hz),this.y=Math.lerp(v.y,this.y,alpha,hz),this.z=Math.lerp(v.z,this.z,alpha,hz),this.w=Math.lerp(v.w,this.w,alpha,hz),this}applyMatrix4(m){let x=this.x,y=this.y,z=this.z,w=this.w,e=m.elements;return this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w,this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w,this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w,this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w,this}toArray(array,offset){return void 0===array&&(array=[]),void 0===offset&&(offset=0),array[offset]=this.x,array[offset+1]=this.y,array[offset+2]=this.z,array[offset+3]=this.w,array}fromArray(array,offset){return void 0===offset&&(offset=0),this.x=array[offset],this.y=array[offset+1],this.z=array[offset+2],this.w=array[offset+3],this}set width(v){this.z=v}set height(v){this.w=v}get width(){return this.z}get height(){return this.w}clone(){return new Vector4(this.x,this.y,this.z,this.w)}}class Face3{constructor(a,b,c,normal=new Vector3){this.a=a,this.b=b,this.c=c,this.normal=normal}}function NoGLPolyfill(){this.activeTexture=this.attachShader=this.bindAttribLocation=this.bindBuffer=this.bindFramebuffer=this.bindRenderbuffer=this.bindTexture=this.blendColor=this.blendEquation=this.blendEquationSeparate=this.blendFunc=this.blendFuncSeparate=this.bufferData=this.bufferSubData=this.checkFramebufferStatus=this.clear=this.clearColor=this.clearDepthf=this.clearStencil=this.colorMask=this.compileShader=this.compressedTexImage2D=this.compressedTexSubImage2D=this.copyTexImage2D=this.copyTexSubImage2D=this.createProgram=this.createShader=this.cullFace=this.deleteBuffers=this.deleteFramebuffers=this.deleteProgram=this.deleteRenderbuffers=this.deleteShader=this.deleteTextures=this.depthFunc=this.depthMask=this.depthRangef=this.detachShader=this.disable=this.disableVertexAttribArray=this.drawArrays=this.drawElements=this.enable=this.enableVertexAttribArray=this.finish=this.flush=this.framebufferRenderbuffer=this.framebufferTexture2D=this.frontFace=this.generateMipmap=this.getActiveAttrib=this.getActiveUniform=this.getAttachedShaders=this.getAttribLocation=this.getBooleanv=this.getBufferParameteriv=this.getError=this.getFloatv=this.getFramebufferAttachmentParameteriv=this.getIntegerv=this.getProgramiv=this.getProgramInfoLog=this.getRenderbufferParameteriv=this.getShaderiv=this.getShaderInfoLog=this.getShaderPrecisionFormat=this.getShaderSource=this.getString=this.getTexParameterfv=this.getTexParameteriv=this.getUniformfv=this.getUniformiv=this.getUniformLocation=this.getVertexAttribfv=this.getVertexAttribiv=this.getVertexAttribPointerv=this.isBuffer=this.isEnabled=this.isFramebuffer=this.isProgram=this.isRenderbuffer=this.isShader=this.isTexture=this.lineWidth=this.linkProgram=this.pixelStorei=this.polygonOffset=this.readPixels=this.releaseShaderCompiler=this.renderbufferStorage=this.sampleCoverage=this.scissor=this.shaderBinary=this.shaderSource=this.stencilFunc=this.stencilFuncSeparate=this.stencilMask=this.stencilMaskSeparate=this.stencilOp=this.stencilOpSeparate=this.texParameterf=this.texParameterfv=this.texParameteri=this.texParameteriv=this.texSubImage2D=this.uniform1f=this.uniform1fv=this.uniform1i=this.uniform1iv=this.uniform2f=this.uniform2fv=this.uniform2i=this.uniform2iv=this.uniform3f=this.uniform3fv=this.uniform3i=this.uniform3iv=this.uniform4f=this.uniform4fv=this.uniform4i=this.uniform4iv=this.uniformMatrix2fv=this.uniformMatrix3fv=this.uniformMatrix4fv=this.useProgram=this.validateProgram=this.vertexAttrib1f=this.vertexAttrib1fv=this.vertexAttrib2f=this.vertexAttrib2fv=this.vertexAttrib3f=this.vertexAttrib3fv=this.vertexAttrib4f=this.vertexAttrib4fv=this.vertexAttribPointer=this.viewport=this.getParameter=this.getExtension=this.drawElementsInstanced=this.drawArraysInstanced=this.vertexAttribDivisor=this.getUniformBlockIndex=this.uniformBlockBinding=this.bindBufferBase=this.createVertexArray=this.bindVertexArray=this.deleteVertexArray=this.drawBuffers=this.blitFramebuffer=this.texImage2D=this.getContextAttributes=this.isContextLost=this.clearDepth=this.depthRange=this.createTexture=this.createBuffer=this.createFramebuffer=this.createRenderbuffer=this.deleteTexture=this.deleteBuffer=this.deleteFramebuffer=this.getBufferParameter=this.getRenderbufferParameter=this.getProgramParameter=this.getVertexAttribOffset=this.getFramebufferAttachmentParemeter=this.getUniform=this.getTexParameter=this.getShaderParameter=this.getSupportedExtensions=this.activeTexture=this.attachShader=_=>{},this.getShaderParameter=this.getProgramParameter=function(){return!0}}Class((function zUtils3D(){var diff,edge1,edge2,normal,v1,v0;Math.euclideanModulo=function(n,m){return(n%m+m)%m},Math.isPowerOf2=function(w,h){let test=value=>0==(value&value-1);return test(w)&&test(h)},Math.floorPowerOf2=function(value){return Math.pow(2,Math.floor(Math.log(value)/Math.LN2))},Math.ceilPowerOf2=function(value){return Math.pow(2,Math.ceil(Math.log(value)/Math.LN2))},this.LOCAL=window.Hydra&&Hydra.LOCAL,Geometry.createAttributes=function(geom){let attributes={},handler={set(target,property,value){target[property]=value,geom._attributeKeys.length=0,geom._attributeValues.length=0;for(let key in attributes)geom._attributeKeys.push(key),geom._attributeValues.push(attributes[key]);return!0}};return geom._attributeKeys=[],geom._attributeValues=[],new Proxy(attributes,handler)},Geometry.TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array},Geometry.arrayNeedsUint32=function(array){for(let i=array.length-1;i>=0;--i)if(array[i]>65535)return!0;return!1},Geometry.TYPES={SphereGeometry:SphereGeometry,IcosahedronGeometry:IcosahedronGeometry,BoxGeometry:BoxGeometry,PlaneGeometry:PlaneGeometry,CylinderGeometry:CylinderGeometry},Matrix4.prototype.isMatrix4=!0,Matrix3.prototype.isMatrix3=!0,Vector3.prototype.isVector3=!0,Vector3D.prototype.isVector3=!0,Vector2.prototype.isVector2=!0,CameraBase3D.prototype.isCamera=!0,PerspectiveCamera.prototype.isPerspective=!0,Scene.FRONT_TO_BACK="sort_front_to_back",Scene.FRONT_TO_BACK_BOUNDING="sort_front_to_back_bounding",window.THREAD&&(Shader={FRONT_SIDE:"shader_front_side",BACK_SIDE:"shader_back_side",DOUBLE_SIDE:"shader_double_side"}),Ray.prototype.intersectTriangle=(diff=new Vector3,edge1=new Vector3,edge2=new Vector3,normal=new Vector3,function intersectTriangle(a,b,c,backfaceCulling,target){edge1.subVectors(b,a),edge2.subVectors(c,a),normal.crossVectors(edge1,edge2);var sign,DdN=this.direction.dot(normal);if(DdN>0){if(backfaceCulling)return null;sign=1}else{if(!(DdN<0))return null;sign=-1,DdN=-DdN}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0)return null;var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0)return null;if(DdQxE2+DdE1xQ>DdN)return null;var QdN=-sign*diff.dot(normal);return QdN<0?null:this.at(QdN/DdN,target)}),Mesh.prototype.raycast=function(){let inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,vA=new Vector3,vB=new Vector3,vC=new Vector3,uvA=(new Vector3,new Vector3,new Vector3,new Vector3,new Vector2),uvB=new Vector2,uvC=new Vector2,barycoord=new Vector3,intersectionPoint=new Vector3,intersectionPointWorld=new Vector3;function checkBufferGeometryIntersection(object,raycaster,ray,position,uv,a,b,c){if(vA.fromBufferAttribute(position,a),vB.fromBufferAttribute(position,b),vC.fromBufferAttribute(position,c),object.raycastLimit){let{radiusSq:radiusSq,position:position}=object.raycastLimit;if(vA.distanceToSquared(position)>radiusSq)return}let intersection=function checkIntersection(object,shader,raycaster,ray,pA,pB,pC,point){let intersect;if(intersect=shader.side===Shader.BACK_SIDE?ray.intersectTriangle(pC,pB,pA,!0,point):ray.intersectTriangle(pA,pB,pC,shader.side!==Shader.DOUBLE_SIDE,point),null===intersect)return null;intersectionPointWorld.copy(point),intersectionPointWorld.applyMatrix4(object.matrixWorld);let distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);return distance<raycaster.near||distance>raycaster.far?null:{distance:distance,point:intersectionPointWorld.clone(),object:object}}(object,object.shader,raycaster,ray,vA,vB,vC,intersectionPoint);if(intersection){uv&&(uvA.fromBufferAttribute(uv,a),uvB.fromBufferAttribute(uv,b),uvC.fromBufferAttribute(uv,c),intersection.uv=function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){return Triangle.getBarycoord(point,p1,p2,p3,barycoord),uv1.multiplyScalar(barycoord.x),uv2.multiplyScalar(barycoord.y),uv3.multiplyScalar(barycoord.z),uv1.add(uv2).add(uv3),uv1.clone()}(intersectionPoint,vA,vB,vC,uvA,uvB,uvC));let face=new Face3(a,b,c);Triangle.getNormal(vA,vB,vC,face.normal),intersection.face=face}return intersection}return function raycast(raycaster,intersects){let intersection,a,b,c,geometry=this.geometry,shader=this.shader,matrixWorld=this.matrixWorld;if(void 0===shader)return;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),0==this.scale.x)return;if(this.staticRaycast){if(this.raySphere||(this.raySphere=new Sphere,this.raySphere.copy(geometry.boundingSphere),this.raySphere.applyMatrix4(matrixWorld)),this.raycastNeedsUpdate&&(this.raySphere.copy(geometry.boundingSphere),this.raySphere.applyMatrix4(matrixWorld),this.raycastNeedsUpdate=!1),!1===raycaster.ray.intersectsSphere(this.raySphere))return}else if(sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),!1===raycaster.ray.intersectsSphere(sphere))return;if(inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix),null!==geometry.boundingBox&&!1===ray.intersectsBox(geometry.boundingBox))return;let i,l,index=geometry.index,position=geometry.attributes.position,uv=geometry.attributes.uv;if(null!==index)for(i=0,l=index.length;i<l;i+=3)a=index[i],b=index[i+1],c=index[i+2],intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c),intersection&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection));else if(void 0!==position)for(i=0,l=position.count;i<l;i+=3)a=i,b=i+1,c=i+2,intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c),intersection&&(intersection.faceIndex=Math.floor(i/3),intersects.push(intersection))}}(),Triangle.prototype.closestPointToPoint=function(){let plane=new Plane,edgeList=[new Line3,new Line3,new Line3],projectedPoint=new Vector3,closestPoint=new Vector3;return function closestPointToPoint(point,target=new Vector3){let minDistance=1/0;if(plane.setFromCoplanarPoints(this.a,this.b,this.c),plane.projectPoint(point,projectedPoint),!0===this.containsPoint(projectedPoint))target.copy(projectedPoint);else{edgeList[0].set(this.a,this.b),edgeList[1].set(this.b,this.c),edgeList[2].set(this.c,this.a);for(let i=0;i<edgeList.length;i++){edgeList[i].closestPointToPoint(projectedPoint,!0,closestPoint);let distance=projectedPoint.distanceToSquared(closestPoint);distance<minDistance&&(minDistance=distance,target.copy(closestPoint))}}return target}}(),Points.prototype.raycast=function(){let inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function raycast(raycaster,intersects){let object=this,geometry=this.geometry,matrixWorld=this.matrixWorld,threshold=raycaster.params.Points.threshold;if(null===geometry.boundingSphere&&geometry.computeBoundingSphere(),sphere.copy(geometry.boundingSphere),sphere.applyMatrix4(matrixWorld),sphere.radius+=threshold,!1===raycaster.ray.intersectsSphere(sphere))return;inverseMatrix.getInverse(matrixWorld),ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);let localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3),localThresholdSq=localThreshold*localThreshold,position=new Vector3,intersectPoint=new Vector3;function testPoint(point,index){let rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThresholdSq){ray.closestPointToPoint(point,intersectPoint),intersectPoint.applyMatrix4(matrixWorld);let distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:Math.sqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}let index=geometry.index,positions=geometry.attributes.position.array;if(null!==index){let indices=index.array;for(let i=0,il=indices.length;i<il;i++){let a=indices[i];position.fromArray(positions,3*a),testPoint(position,a)}}else for(let i=0,l=positions.length/3;i<l;i++)position.fromArray(positions,3*i),testPoint(position,i)}}(),Object.assign(Triangle,{getNormal:(v0=new Vector3,function getNormal(a,b,c,target=new Vector3){target.subVectors(c,b),v0.subVectors(a,b),target.cross(v0);var targetLengthSq=target.lengthSq();return targetLengthSq>0?target.multiplyScalar(1/Math.sqrt(targetLengthSq)):target.set(0,0,0)}),getBarycoord:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3;return function getBarycoord(point,a,b,c,target=new Vector3){v0.subVectors(c,a),v1.subVectors(b,a),v2.subVectors(point,a);var dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2),denom=dot00*dot11-dot01*dot01;if(0===denom)return target.set(-2,-1,-1);var invDenom=1/denom,u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return target.set(1-u-v,v,u)}}(),getUV:function(){let _v3=new Vector3;return function getUV(point,p1,p2,p3,uv1,uv2,uv3,target){return this.getBarycoord(point,p1,p2,p3,_v3),target.set(0,0),target.addScaledVector(uv1,_v3.x),target.addScaledVector(uv2,_v3.y),target.addScaledVector(uv3,_v3.z),target}}(),containsPoint:(v1=new Vector3,function containsPoint(point,a,b,c){return Triangle.getBarycoord(point,a,b,c,v1),v1.x>=0&&v1.y>=0&&v1.x+v1.y<=1})})}),"static"),Class((function FXLayer(_parentNuke,_type,_preventDrawBuffers=!1){Inherit(this,Component);var _nuke,_rt,_this=this,_scene=new Scene,_objects=[],_textureIndex=-1,_visible=!0,_id=Utils.timestamp(),_name=Utils.getConstructorName(_this),_useDrawBuffers=!_preventDrawBuffers;this.resolution=1,this.enabled=!0,this.renderShadows=!0;const CLEAR_COLOR=[0,0,0,1];function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr)}FXLayer.exists=!0,this.set("visible",(v=>_this.scene.visible=_visible=v)),this.get("visible",(_=>_visible)),this.onInvisible=function(){_this.scene.visible=!1},this.onVisible=function(){_this.scene.visible=!0},this.create=function(nuke=World.NUKE,type,rt){if(!nuke)return;let format,manualRender,mipmaps;_useDrawBuffers=nuke.useDrawBuffers,type&&"object"==typeof type&&("boolean"==typeof type.useDrawBuffers&&(_useDrawBuffers=type.useDrawBuffers),format=type.format,manualRender=type.manualRender,mipmaps=type.mipmaps,rt||(rt=type.rt),type=type.type),_this.rtType=type||Texture.UNSIGNED_BYTE,_this.rtFormat=format||Texture.RGBFormat,_this.rtMipmaps=mipmaps,(_this=this).scene=_scene,(_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,useDrawBuffers:!1})).parentNuke=nuke,_parentNuke=nuke,_this.nuke=_nuke,function initRT(rt){if(_useDrawBuffers){let texture=new Texture;texture.minFilter=Texture.LINEAR,texture.magFilter=Texture.LINEAR,texture.format=Texture.RGBAFormat,_this.rtType&&(texture.type=_this.rtType),_this.rtFormat&&(texture.format=_this.rtFormat),_this.rtMipmaps?(texture.generateMipmaps=!0,texture.minFilter=texture.magFilter=Texture.LINEAR_MIPMAP):texture.generateMipmaps=!1,texture.type==Texture.FLOAT&&(texture.format=Texture.RGBAFormat),texture.wrapS=texture.wrapT=Texture.CLAMP_TO_EDGE,texture.fxLayer=_this,_this.textureIndex=_textureIndex=_parentNuke.attachDrawBuffer(texture),_rt={texture:texture}}else _this.rtType&&_this.rtType==Texture.FLOAT&&"ios"==Device.system.os&&(_this.rtType=Texture.HALF_FLOAT),_rt=rt||Utils3D.createRT(Math.round(_nuke.stage.width*_this.resolution*_nuke.dpr),Math.round(_nuke.stage.height*_this.resolution*_nuke.dpr),_this.rtType,_this.rtFormat),_this.rtMipmaps?(_rt.texture.minFilter=_rt.texture.magFilter=Texture.LINEAR_MIPMAP,_rt.texture.generateMipmaps=!0):_rt.texture.generateMipmaps=!1;_this.rt=_rt,_this.nuke.setSize(_rt.width,_rt.height)}(rt),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),manualRender||FXScene.manualRender||_this.startRender((_=>_this.draw()),nuke)},this.addObject=this.add=function(object){if(_nuke){if(!_useDrawBuffers){let clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object),object.shader&&function editShader(mesh){let modifyShader=(shader,name)=>{let fs=shader._fragmentShader;if(!fs)return;let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" ");fs=split.join("")}for(;fs.includes("#drawbuffer");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#drawbuffer")&&(fs[i]="");fs=fs.join("\n")}shader.fragmentShader=fs},applyShadow=(shader,bool)=>{let fs=shader.fragmentShader;if(fs){for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)bool?fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow","")):fs[i].includes("#applyShadow")&&(fs[i]="");fs=fs.join("\n")}shader.fragmentShader=fs}};mesh.shader._fragmentShader||(mesh.shader._fragmentShader=mesh.shader.fragmentShader),modifyShader(mesh.shader,"Color");let shader=mesh.shader.clone(!_this.renderShadows,`-${_this.name||_name}`);modifyShader(shader,_this.name||_name),applyShadow(shader,_this.renderShadows),applyShadow(mesh.shader,!0),mesh.shader.copyUniformsTo(shader,!0),mesh.shader=shader}(clone);clone.children.length;)clone.remove(clone.children[0]);return clone}object.shader&&object.shader.fragmentShader&&(!function editDBShader(mesh){const WEBGL2=Renderer.type==Renderer.WEBGL2;let modifyMarker=(fs,name,index)=>{if(WEBGL2){if(fs.includes("layout(location=0) out vec4 reflectionsData"))return fs;if(!fs.includes(`layout(location=${index})`)){let mainAt=(fs=fs.replace("out vec4 FragColor;","")).indexOf("void main()"),before=fs.slice(0,mainAt),after=fs.slice(mainAt);fs=before+`layout(location=${index}) out vec4 ${name};\n`+after}}let marker="#drawbuffer "+name;if(fs.includes(marker)){let split=fs.split(marker+" "),finalOut=WEBGL2?name:`gl_FragData[${index}]`;for(let i=1;i<split.length;++i)split[i]=split[i].replace("gl_FragColor",finalOut);fs=split.join("")}for(;fs.includes("#applyShadow");){fs=fs.split("\n");for(let i=0;i<fs.length;i++)fs[i].includes("#applyShadow")&&(fs[i]=fs[i].replace("#applyShadow",""));fs=fs.join("\n")}return fs},shader=mesh.shader,fs=shader.fragmentShader,name=_this.name||_name;WEBGL2&&fs.includes("location=0")||(fs=modifyMarker(fs,"Color",0)),fs=modifyMarker(fs,name,_textureIndex),shader.fragmentShader=fs}(object),object.shader._attachmentData={format:_this.rtFormat,type:_this.rtType,attachments:_parentNuke.attachments})}},this.removeObject=function(object){_nuke&&(_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id])},this.render=this.draw=function(stage,camera){if(!_nuke||!_this.enabled||_useDrawBuffers)return;if(!_parentNuke.enabled||!_objects.length)return;const oldClear=Renderer.CLEAR;Renderer.CLEAR=CLEAR_COLOR,stage&&(_nuke.stage=stage,_this.setSize(stage.width,stage.height)),_nuke.camera=camera||_nuke.parentNuke.camera,_this.renderShadows||(_nuke.renderer.overridePreventShadows=!0);for(let i=_objects.length-1;i>-1;i--){let obj=_objects[i],clone=obj["clone_"+_id];_this.forceVisible?clone.visible=!0:clone.visible=obj.determineVisible(),clone.visible&&(obj.updateMatrixWorld(),obj.ignoreMatrix||Utils3D.decompose(obj,clone))}_nuke.rtt=_rt,_nuke.render(),RenderStats.update("FXLayer"),_nuke.renderer.overridePreventShadows=!1,Renderer.CLEAR=oldClear},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setSize=function(width,height){_nuke&&(_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_rt&&_rt.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr),_nuke.setSize(width*_this.resolution*_nuke.dpr,height*_this.resolution*_nuke.dpr)))},this.setDPR=function(dpr){_nuke&&(_nuke.dpr=dpr,resizeHandler())},this.setResolution=function(res){_this.resolution=res,resizeHandler()},this.getObjects=function(){return _objects},this.useRT=function(rt){_rt=_this.rt=rt},this.getName=function(){return _this.name||_name},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type)})),Namespace("FX"),Class((function FXScene(_parentNuke,_type,...rest){Inherit(this,Component);var _nuke,_rt,_rtPool,_showManualRenderWarning,_this=this,_scene=new Scene,_id=Utils.timestamp(),_objects=[],_renderTime=Render.TIME,_visible=!0;function resizeHandler(){_rt.setSize&&_rt.setSize(_nuke.stage.width*_this.resolution*_nuke.dpr,_nuke.stage.height*_this.resolution*_nuke.dpr),_this.nuke.setSize(_rt.width,_rt.height),_this.width=_rt.width,_this.height=_rt.height}this.resolution=1,this.autoVisible=!0,this.enabled=!0,this.scene=_scene,this.renderShadows=!0,this.set("visible",(v=>{_this.scene&&(_this.scene.visible=_visible=v,_this.onFXSceneVisibility?.(v))})),this.get("visible",(_=>_visible)),this.onInvisible=this.fxInvisible=function(){this.scene.visible&&(this.scene.visible=!1,_this.flag("needsOnVisible",!0)),_rtPool&&_rtPool.putRT(_this.rt)},this._bindOnDestroy((function(){_rtPool&&_rtPool.putRT(_this.rt)})),this.onVisible=this.fxVisible=function(){_this.flag("needsOnVisible")&&(this.scene.visible=!0,_this.flag("needsOnVisible",!1)),_rtPool&&(_this.useRT(_rtPool.getRT()),resizeHandler())},this.create=function(nuke=World.NUKE,rt,options){_this.nuke||(rt instanceof RTPool&&(rt=(_rtPool=rt).nullRT),nuke instanceof RTPool?(options=rt,rt=(_rtPool=nuke).nullRT,nuke=World.NUKE):rt&&"object"==typeof rt?rt.isRT||(options=rt,rt=void 0):!nuke||nuke instanceof Nuke||(options=nuke,nuke=World.NUKE),options||(options={}),_this.rtFormat=options.format||Texture.RGBFormat,_this.rtType=options.type||Texture.UNSIGNED_BYTE,options.vr&&(_this.vrRT=RenderManager.type==RenderManager.VR),options.parentNuke&&(nuke=options.parentNuke),(_this=this).scene=_scene,_this.nuke=_nuke=_this.initClass(Nuke,nuke.stage,{renderer:nuke.renderer,camera:nuke.camera,scene:_scene,dpr:nuke.dpr,format:options.format,vrRT:_this.vrRT,multisample:options.multisample,samplesAmount:options.samplesAmount}),_scene.nuke=_nuke,function initRT(rt,options={}){options.type==Texture.FLOAT&&(options.format=Texture.RGBAFormat,"ios"==Device.system.os&&(options.type=Texture.HALF_FLOAT,options.minFilter=Texture.NEAREST,options.magFilter=Texture.NEAREST));const RT=_this.nuke.useDrawBuffers&&options.multiRenderTarget?MultiRenderTarget:RenderTarget;_this.width=_nuke.stage.width*_this.resolution*_nuke.dpr,_this.height=_nuke.stage.height*_this.resolution*_nuke.dpr;let filter=options.mipmaps?Texture.LINEAR_MIPMAP:Texture.LINEAR;_rt=rt||new RT(_this.width,_this.height,Object.assign({minFilter:filter,magFilter:filter,generateMipmaps:options.mipmaps||!1},options)),_nuke.rtt=_this.rt=_rt,_rt.fxscene=_this,_this.vrRT&&(_rt.vrRT=!0)}(rt,options),rt?_this.flag("recycle_rt",!0):function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),FXScene.onCreate&&FXScene.onCreate(_this),options.manualRender||_this.manualRender||FXScene.manualRender||(Hydra.LOCAL&&(_showManualRenderWarning=!0),_this.vrRT?_this.startRender((({view:view})=>{0===view&&_this.draw()}),RenderManager.EYE_RENDER):_this.startRender((_=>{_this.draw()}),nuke)))},this.onDestroy=this.fxDestroy=function(){_this.scene.deleted=!0,_this.flag("recycle_rt")?_rtPool&&_rt&&_rtPool.putRT(_rt):_rt&&_rt.destroy&&_rt.destroy()},this.setSize=function(width,height,exact){_nuke&&(exact||(width=width*_this.resolution*_nuke.dpr,height=height*_this.resolution*_nuke.dpr),_rt.width==width&&_rt.height==height||(_this.events.unsub(Events.RESIZE,resizeHandler),_this.width=width,_this.height=height,_rt&&_rt.setSize(_this.width,_this.height),_nuke.setSize(_this.width,_this.height)))},this.add=this.addObject=function(object){if(!object)return console.error("FXScene addObject undefined!");let clone=object.clone();for(object["clone_"+_id]=clone,_scene.add(clone),_objects.push(object),object.shader._attachmentData={format:_this.rtFormat,type:_this.rtType,attachments:1};clone.children.length;)clone.remove(clone.children[0]);return clone},this.removeObject=function(object){_scene.remove(object["clone_"+_id]),_objects.remove(object),delete object["clone_"+_id]},this.setScissor=function(x,y,w,h){this.scissor||(this.scissor=new Vector4),this.scissor.x=x*_this.width,this.scissor.y=_this.height-h*_this.height-y*_this.height,this.scissor.width=w*_this.width,this.scissor.height=h*_this.height,this.rt.scissor=this.scissor},this.render=this.draw=function(stage,camera){if(_this.preventRender)return;if(_this.isVrWorldMode)return void(_this.onBeforeRender&&_this.onBeforeRender());if(_showManualRenderWarning&&Render.TIME-_renderTime<1e3/Render.REFRESH_RATE/2&&(console.warn(`FXScene ${Utils.getConstructorName(_this)} rendering early (${Math.round(Render.TIME-_renderTime,3)}ms elapsed, expected ~${Math.round(1e3/Render.REFRESH_RATE,3)}ms. Set manualRender option if using own render loop.`),_showManualRenderWarning=!1),_renderTime=Render.TIME,_this.isVrSceneMode){let rt=World.NUKE.enabled&&World.NUKE.passes.length?World.NUKE.rttBuffer:void 0,autoClear=_nuke.renderer.autoClear;return _nuke.renderer.autoClear=!1,_nuke.renderer.clearDepth(rt),_this.onBeforeRender&&_this.onBeforeRender(),_nuke.renderer.render(_scene,_nuke.camera,rt),void(_nuke.renderer.autoClear=autoClear)}stage&&(_this.events.unsub(Events.RESIZE,resizeHandler),_this.nuke.stage=stage,_this.setSize(stage.width,stage.height)),camera&&(_this.nuke.camera=camera);let clearColor=null,alpha=1;_this.clearColor&&(clearColor=_nuke.renderer.getClearColor().getHex(),_nuke.renderer.setClearColor(_this.clearColor)),_this.clearAlpha>-1&&(alpha=_nuke.renderer.getClearAlpha(),_nuke.renderer.setClearAlpha(_this.clearAlpha)),_this.renderShadows||(_nuke.renderer.overridePreventShadows=!0);for(let i=_objects.length-1;i>-1;i--){let obj=_objects[i],clone=obj["clone_"+_id];_this.forceVisible||obj.cloneVisible?clone.visible="boolean"!=typeof clone.isVisible||clone.isVisible:clone.visible=obj.determineVisible(),clone.visible&&(obj.updateMatrixWorld(!1===obj.visible||void 0),obj.ignoreMatrix||(Utils3D.decompose(obj,clone),clone.overrideScale&&clone.scale.setScalar(clone.overrideScale)))}_this.preventRTDraw||(RenderStats.update("FXScene",1,_this),_this.onBeforeRender&&_this.onBeforeRender(),_nuke.rtt=_rt,_nuke.render()),_nuke.renderer.overridePreventShadows=!1,_this.clearColor&&_nuke.renderer.setClearColor(clearColor),_this.clearAlpha>-1&&_nuke.renderer.setClearAlpha(_this.clearAlpha),RenderManager.fire(_this)},this.setDPR=function(dpr){return _nuke?(_nuke.dpr=dpr,resizeHandler(),_this):_this},this.addPass=function(pass){_nuke&&_nuke.add(pass)},this.removePass=function(pass){_nuke&&_nuke.remove(pass)},this.setResolution=function(res){return _this.resolution=res,resizeHandler(),this},this.useRT=function(rt){_rt=_this.rt=rt,_this.vrRT&&(rt.vrRT=!0)},this.upload=function(){_rt&&_rt.upload()},this.useCamera=function(camera){_this.nuke.camera=camera.camera||camera},this.useScene=function(scene){_this.nuke.scene=scene},this.vrWorldMode=function(){_this.isVrWorldMode=!0,_this.group=new Group;for(let i=0;i<this.scene.children.length;i++)this.group.add(this.scene.children[i]);_scene=_this.scene=_this.group,World.SCENE.add(_this.group)},this.vrSceneMode=function(){_this.isVrSceneMode=!0,World.NUKE.autoClear=!1,RenderManager.renderer.autoClear=!1},this.createDepthTexture=function(useRTTBuffer){return _this.depthTexture||(_this.nuke.passes.length||useRTTBuffer?(_this.nuke.rttBuffer.createDepthTexture(),_this.depthTexture=_this.nuke.rttBuffer.depth):(_this.rt.createDepthTexture(),_this.depthTexture=_this.rt.depth)),_this.depthTexture},_parentNuke instanceof Nuke&&this.create(_parentNuke,_type,...rest)})),Class((function FXSceneCompositor(_shader,_options={}){Inherit(this,Object3D);const _this=this;var _basicShader;function decorateShader(shader){shader.addUniforms({tFrom:{value:null},tTo:{value:null},uTransition:{value:0}})}function loop(){_this.mesh.shader=_shader.uniforms.uTransition.value>0?_shader:_basicShader,_shader.uniforms.uTransition.value>=1&&(_this.mesh.shader=_basicShader,_basicShader.set("tMap",_shader.get("tTo")),_shader.set("uTransition",0))}!function initOptions(){(null===_options||_options instanceof Texture||_options.texture||_options.rt&&_options.rt.texture)&&(_options={startTexture:_options})}(),decorateShader(_shader),function initMesh(){let uniforms={tMap:{value:_options.startTexture||null}};_options.basicShader?(_basicShader=_options.basicShader).addUniforms(uniforms):_basicShader=_this.initClass(Shader,"ScreenQuad",uniforms),_this.mesh=new Mesh(World.QUAD,_basicShader),_this.mesh.frustumCulled=!1,_this.add(_this.mesh)}(),_this.startRender(loop),this.useShader=function(shader){_shader=shader,decorateShader(shader)},this.useBasicShader=function(shader){_basicShader.copyUniformsTo(shader,!0),_basicShader=shader},this.swap=function(showTransition){showTransition?_this.mesh.shader=_shader:(_basicShader.set("tMap",_shader.get("tTo")),_this.mesh.shader=_basicShader,_shader.set("tFrom",_basicShader.get("tMap")))},this.set("manual",(v=>{v?_this.stopRender(loop):_this.startRender(loop)})),this.transition=async function(texture,time,ease,delay){let from=_shader.get("tFrom");_shader.set("tTo",texture),texture.visible=!0,from?await _shader.tween("uTransition",1,time,ease,delay).promise():_shader.set("uTransition",1),from&&(from.visible=!1),_shader.set("tFrom",texture)}})),Class((function BlitPass(_forceNuke){Inherit(this,NukePass);this.uniforms={},this.init("BlitPass"),_forceNuke||(this.blitFramebuffer=!0)})),Class((function Nuke(_stage,_params){Inherit(this,Component);var _width,_height,_nukeMesh,_this=this;_params.renderer||console.error("Nuke :: Must define renderer"),_this.stage=_stage,_this.renderer=_params.renderer,_this.camera=_params.camera,_this.scene=_params.scene,_this.rtt=_params.rtt,_this.enabled=0!=_params.enabled,_this.passes=_params.passes||[],_this.format=_params.format||Texture.RGBFormat,_this.useDrawBuffers=!Utils.query("noDrawBuffers")&&!Nuke.NO_DRAWBUFFERS&&(void 0!==_params.useDrawBuffers?_params.useDrawBuffers:!(Renderer.type!=Renderer.WEBGL2&&!window.Metal));var _rttPing,_rttPong,_rttBuffer,_dpr=_params.dpr||1,_drawBuffers=[],_enabledPasses=[],_multisample=_params.multisample||!1,_samplesAmount=_params.samplesAmount||4;function resizeHandler(){var width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing.setSize(width,height),_rttPong.setSize(width,height),_rttBuffer.setSize(width,height),Nuke.renameRT(_width,_height,width,height,!1,1,_this.format,!1,_samplesAmount),Nuke.renameRT(_width,_height,width,height,!1,2,_this.format,!1,_samplesAmount),Nuke.renameRT(_width,_height,width,height,_this.useDrawBuffers,-1,_this.format,_multisample,_samplesAmount),_width=width,_height=height}_this.scene.nuke=_this,function initDefaultPass(){if(Nuke.defaultPass)return;let upload=(Nuke.defaultPass=new BlitPass).upload;Nuke.defaultPass.upload=function(){upload.apply(this,arguments),Nuke.defaultPass.uploaded=!0}}(),function initNuke(){let width=_this.stage.width*_dpr,height=_this.stage.height*_dpr;_rttPing=Nuke.getRT(width,height,!1,1,_this.format,!1,_samplesAmount),_rttPong=Nuke.getRT(width,height,!1,2,_this.format,!1,_samplesAmount),_rttBuffer=Nuke.getRT(width,height,_this.useDrawBuffers,-1,_this.format,_multisample,_samplesAmount),(_nukeMesh=new Mesh(World.QUAD,null)).frustumCulled=!1,_nukeMesh.noMatrices=!0,_nukeMesh.transient=!0,_width=width,_height=height,_params.vrRT&&(_this.vrRT=!0,_rttBuffer.vrRT=!0)}(),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),_this.onBeforeShaderCompile=function(obj){if(!obj)return;let shader=obj.shader;if(!(shader&&shader.fragmentShader&&_this.useDrawBuffers&&_drawBuffers.length))return;const WEBGL2=Renderer.type==Renderer.WEBGL2;let matched=!1;if(_drawBuffers.forEach(((t,i)=>{let name=t.fxLayer.getName();if(!(WEBGL2?new RegExp(`\\b${name}\\s*=`):new RegExp(`\\bgl_FragData\\[${i+1}\\]\\s*=`)).test(shader.fragmentShader)&&_this.useDrawBuffers){let fs=shader.fragmentShader;if(!fs.includes(`#drawbuffer ${name} gl_FragColor`)){let idx=fs.lastIndexOf("}");fs=fs.slice(0,idx)+`#drawbuffer ${name} gl_FragColor = vec4(0.0);\n`+fs.slice(idx),shader.fragmentShader=fs}t.fxLayer.add(obj),matched=!0}})),!(WEBGL2?/\bColor\s*=/:/\bgl_FragData\[0\]\s*=/).test(shader.fragmentShader)){let fs=shader.fragmentShader;if(!fs.includes("layout(location=0) out vec4 reflectionsData")){WEBGL2||(fs="#extension GL_EXT_draw_buffers : require\n"+fs),fs=fs.split("void main() {"),fs=fs[0]+"void main() {\nvec4 tmpFragColor;\n"+fs[1],fs=fs.replace(/gl_FragColor/g,"tmpFragColor");let idx=fs.lastIndexOf("}");fs=matched?WEBGL2?fs.slice(0,idx)+"Color = tmpFragColor;\n"+fs.slice(idx):fs.slice(0,idx)+"gl_FragData[0] = tmpFragColor;\n"+fs.slice(idx):fs.slice(0,idx)+"#drawbuffer Color gl_FragColor = tmpFragColor;\n"+fs.slice(idx)}shader.fragmentShader=fs}shader.onBeforePrecompilePromise.resolve()},_this.add=function(pass,index){"number"!=typeof index?_this.passes.push(pass):_this.passes.splice(index,0,pass)},_this.remove=function(pass){"number"==typeof pass?_this.passes.splice(pass):_this.passes.remove(pass)},_this.render=function(directCallback){RenderStats.update("Nuke"),RenderManager.fire(_this),_this.events.fire(Nuke.RENDER,_this,!0),_this.onBeforeRender&&_this.onBeforeRender();let count=_this.passes.length;_enabledPasses.length=0;for(let i=0;i<count;i++){let pass=_this.passes[i];pass.disabled||_enabledPasses.push(pass)}if(_this.enabled&&0===_enabledPasses.length&&!_this.rtt&&(_dpr!==Device.pixelRatio||_multisample)&&Nuke.defaultPass&&_enabledPasses.push(Nuke.defaultPass),!_this.enabled||!_enabledPasses.length){let autoClear=_this.renderer.autoClear;return 0==_this.autoClear&&(_this.renderer.autoClear=!1),_this.renderer.render(_this.scene,_this.camera,_this.rtt,null,directCallback),_this.onBeforeProcess&&_this.onBeforeProcess(),_this.events.fire(Nuke.BEFORE_PASSES,_this,!0),_this.events.fire(Nuke.BEFORE_POST_RENDER,_this,!0),_this.postRender&&_this.postRender(),_this.events.fire(Nuke.POST_RENDER,_this,!0),void(0==_this.autoClear&&(_this.renderer.autoClear=autoClear,_this.renderer.clearColor()))}RenderStats.update("NukePass",_enabledPasses.length),_this.hasRendered=!0,_this.onBeforeProcess&&_this.onBeforeProcess();let autoClear=_this.renderer.autoClear;0==_this.autoClear&&(_this.renderer.autoClear=!1),_this.preventNewRender||_this.renderer.render(_this.scene,_this.camera,_rttBuffer),0==_this.autoClear&&(_this.renderer.autoClear=autoClear);let pingPong=!0,skipMultisample=_this.rtt&&_this.rtt.multisample;skipMultisample&&(_this.rtt.multisample=!1),count=_enabledPasses.length,_this.events.fire(Nuke.BEFORE_PASSES,_this,!0);for(var i=0;i<count;i++){let shader=_enabledPasses[i].pass,inTexture=0===i?_rttBuffer.texture:pingPong?_rttPing.texture:_rttPong.texture,outTexture=pingPong?_rttPong:_rttPing;i===count-1&&(outTexture=_this.rtt),_nukeMesh.shader=shader,_nukeMesh.shader.depthTest=!1,_nukeMesh.shader.depthWrite=!1,_nukeMesh.shader.uniforms.tDiffuse.value=inTexture,_this.renderer.renderSingle(_nukeMesh,_this.camera||World.CAMERA,outTexture,i===count-1?directCallback:null),_enabledPasses[i]?.onRenderCallBack?.(),pingPong=!pingPong}skipMultisample&&(_this.rtt.multisample=!0),_this.events.fire(Nuke.BEFORE_POST_RENDER,_this,!0),_this.postRender&&_this.postRender(),_this.events.fire(Nuke.POST_RENDER,_this,!0),0==_this.autoClear&&_this.renderer.clearColor(_rttBuffer)},_this.setSize=function(width,height){width==_width&&height==_height||(_width=width,_height=height,resizeHandler(),_this.events.unsub(Events.RESIZE,resizeHandler))},_this.attachDrawBuffer=function(texture){if(_this.hasRendered&&console.warn("Attempt to attach draw buffer after first render! Create FXLayer instance before first render."),_drawBuffers.push(texture),_rttBuffer&&_rttBuffer.attachments){_rttBuffer.attachments=[_this.rtt&&_this.rtt.attachments?_this.rtt.attachments[0]:_rttBuffer.attachments[0]];for(let i=0;i<_drawBuffers.length;i++)_rttBuffer.attachments.push(_drawBuffers[i]),_this.rtt&&_this.rtt.attachments&&_this.rtt.attachments.push(_drawBuffers[i])}return _drawBuffers.length},_this.upload=function(){_this.passes.length&&_this.enabled&&(_rttPing.upload(),_rttPong.upload(),_rttBuffer.upload()),_rttBuffer.depth&&_rttBuffer.depth.upload(),_this.rtt&&_this.rtt.upload()},_this.set("dpr",(function(v){_dpr=v,resizeHandler()})),_this.get("dpr",(function(){return _dpr})),_this.get("output",(function(){return _nukeMesh.shader&&_nukeMesh.shader.uniforms?_nukeMesh.shader.uniforms.tDiffuse.value:null})),_this.get("rttBuffer",(function(){return _rttBuffer})),this.set("rttBuffer",(function(v){_rttBuffer=v})),_this.get("prevFrameRT",(function(){return _rttBuffer&&_rttBuffer.texture?_rttBuffer.texture:null})),_this.get("nukeScene",(function(){return _nukeScene})),_this.get("ping",(function(){return _rttPing})),_this.get("pong",(function(){return _rttPong})),_this.get("attachments",(function(){return _rttBuffer.attachments?_rttBuffer.attachments.length:0})),this.onDestroy=function(){_rttBuffer.destroy()},this.clearMemory=function(){_rttBuffer.destroy(),_rttPing.destroy(),_rttPong.destroy()}}),(function(){Nuke.RENDER="nuke_render",Nuke.BEFORE_PASSES="nuke_before_passes",Nuke.BEFORE_POST_RENDER="nuke_before_post_render",Nuke.POST_RENDER="nuke_post_render";var _rts={};Nuke.getRT=function(width,height,multi,index,format,multisample,samplesAmount){let rt,exists=_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`];return exists||(rt=multi?Utils3D.createMultiRT(width,height,void 0,format,multisample,samplesAmount):Utils3D.createRT(width,height,void 0,format,multisample,samplesAmount),Nuke.recyclePingPong&&(_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]=rt),rt)},Nuke.renameRT=function(prevWidth,prevHeight,width,height,multi,index,format,multisample,samplesAmount){_rts[`${width}_${height}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]=_rts[`${prevWidth}_${prevHeight}_${multi}_${index}_${format}_${multisample}_${samplesAmount}`]}})),Class((function NukePass(_fs,_uniforms,_pass){Inherit(this,Component);var _this=this;if("object"==typeof _fs){let shader=_fs.shader;_uniforms=_fs.uniforms,_fs=shader}this.UILPrefix="string"==typeof _fs?_fs:Utils.getConstructorName(_fs),this.init=function(fs,vs){if(_this.pass)return;_this=this;fs||this.constructor.toString().match(/function ([^\(]+)/)[1],Array.isArray(fs)&&fs.join("");if(_this.uniforms=_uniforms||_this.uniforms||{},_this.uniforms.tDiffuse={type:"t",value:null,ignoreUIL:!0},_this.uniforms.unique&&(_this.UILPrefix+="_"+_this.uniforms.unique+"_"),window.UILStorage)for(let key in _this.uniforms)"unique"!==key&&(_this.uniforms[key]=UILStorage.parse(_this.UILPrefix+key,_this.uniforms[key].value)||_this.uniforms[key]);_this.pass=_this.initClass(Shader,vs||"NukePass",fs,Utils.mergeObject(_this.uniforms,{precision:"high"}),((code,type)=>"fs"==type?function prefix(code){if(!code)throw`No shader ${_fs} found`;let pre="";return code.includes("uniform sampler2D tDiffuse")||(pre+="uniform sampler2D tDiffuse;\n",pre+="varying vec2 vUv;\n"),pre+code}(code):code)),_this.uniforms=_this.pass.uniforms},this.set=function(key,value){TweenManager.clearTween(_this.uniforms[key]),_this.uniforms[key].value=value},this.get=function(key){return void 0===_this.uniforms[key]?null:_this.uniforms[key].value},this.tween=function(key,value,time,ease,delay,callback,update){return tween(_this.uniforms[key],{value:value},time,ease,delay,callback,update)},this.clone=function(){return _this.pass||_this.init(_fs),new NukePass(null,null,_this.pass.clone())},this.upload=function(){_this.pass.upload()},this.addUniforms=function(obj){for(let key in obj)_this.uniforms[key]=obj[key]},"string"==typeof _fs?_this.init(_fs):_pass&&(_this.pass=_pass,_this.uniforms=_pass.uniforms)})),Class((function Raycaster(_camera){Inherit(this,Component);const _this=this;let _mouse=new Vector3,_raycaster=new RayManager;function ascSort(a,b){return a.distance-b.distance}function intersectObject(object,raycaster,intersects,recursive){let obj=object;for(;obj&&_this.testVisibility;){if(!1===obj.visible&&!obj.forceRayVisible&&!1!==obj.testVisibility)return;obj=obj.parent}if(object.raycast&&(object.raycast(raycaster,intersects),!0===recursive)){let children=object.children;for(let i=0,l=children.length;i<l;i++)intersectObject(children[i],raycaster,intersects,!0)}}function intersect(objects){Array.isArray(objects)||(objects=[objects]);let intersects=[];return objects.forEach((object=>{intersectObject(object,_raycaster,intersects,!1)})),intersects.sort(ascSort),intersects}this.testVisibility=!0,this.set("camera",(function(camera){_camera=camera})),this.set("pointsThreshold",(function(value){_raycaster.params.Points.threshold=value})),this.get("ray",(()=>_raycaster.ray)),this.checkHit=function(objects,mouse,rect=Stage){return mouse=mouse||Mouse,_mouse.x=mouse.x/rect.width*2-1,_mouse.y=-mouse.y/rect.height*2+1,_raycaster.setFromCamera(_mouse,_camera),intersect(objects)},this.checkFromValues=function(objects,origin,direction){return _raycaster.set(origin,direction,0,Number.POSITIVE_INFINITY),intersect(objects)}}),(_=>{var _ray,_map=new WeakMap;Raycaster.checkHit=function(objects,mouse){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkHit(objects,mouse)},Raycaster.checkFromValues=function(objects,origin,direction){return _ray||(_ray=new Raycaster(World.CAMERA)),_ray.checkFromValues(objects,origin,direction)},Raycaster.find=function(camera){if(!_map.has(camera)){let ray=new Raycaster(camera);_map.set(camera,ray)}return _map.get(camera)}})),Class((function ScreenProjection(_camera){Inherit(this,Component);var _v3=new Vector3,_v32=new Vector3,_value=new Vector3;_camera=_camera.camera||_camera,this.set("camera",(function(v){_camera=v.camera||v})),this.get("camera",(_=>_camera)),this.unproject=function(mouse,rect=Stage,distance=1){"number"==typeof rect&&(distance=rect,rect=Stage),_v3.set(mouse.x/rect.width*2-1,-mouse.y/rect.height*2+1,.5),_v3.unproject(_camera);let pos=_camera.getWorldPosition();return _v3.sub(pos).normalize().multiplyScalar(distance),_value.copy(pos).add(_v3),_value},this.project=function(pos,screen){return screen=screen||Stage,pos instanceof Base3D?(pos.updateMatrixWorld(),_v32.set(0,0,0).setFromMatrixPosition(pos.matrixWorld)):_v32.copy(pos),_v32.project(_camera),_v32.x=(_v32.x+1)/2*screen.width,_v32.y=-(_v32.y-1)/2*screen.height,_v32}}),(_=>{var _screen,_map=new WeakMap;ScreenProjection.unproject=function(mouse,distance){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.unproject(mouse,distance)},ScreenProjection.project=function(pos,screen){return _screen||(_screen=new ScreenProjection(World.CAMERA)),_screen.project(pos,screen)},ScreenProjection.find=function(camera){if(!_map.has(camera)){let projection=new ScreenProjection(camera);_map.set(camera,projection)}return _map.get(camera)}})),Class((function Object3D(){Inherit(this,Component);var _this=this,_visible=!0;this.__element=!0,this.group=new Group,this.group.classRef=this,this.add=function(child){this.group.add(child.group||child)},this.remove=function(child){child&&this.group.remove(child.group||child)},this.onDestroy=function(){this.group.deleted=!0,this.group.classRef=null,this.group&&this.group._parent&&this.group._parent.remove(this.group)},this.set("visible",(v=>_this.group.visible=_visible=v)),this.get("visible",(_=>_visible))})),Class((function Utils3D(){const _this=this;var _emptyTexture,_q,_v3,_v3b,_v3c,_m4,_v4,_supportsKtx1,_textures={},_restorable={};function getTexture(key,params,loadTexture){if(!Device.graphics.webgl&&!window.AURA){let texture=new Texture;return texture.promise=Promise.resolve(),texture.dimensions={width:0,height:0},texture}let restorable=_restorable[key];if(restorable&&(restorable=restorable.deref(),delete _restorable[key]),restorable)restorable.restore();else if(_textures[key])_textures[key].exists++;else{let texture=new Texture;texture.exists=1,texture.loaded=!1,texture.promise=Promise.create(),texture._destroy=texture.destroy,texture.destroy=function(force){!force&&(texture.forcePersist||--texture.exists>0)||(texture.exists||texture._image||texture._gl||_textures[key])&&(delete _textures[key],RenderCount.remove(`tex_${texture?.dimensions?.width}_${texture?.dimensions?.height}`),RenderCount.remove("tex_"+(texture.compressed?"compressed":"uncompressed")),_restorable[key]=new WeakRef(this),this._destroy())},_textures[key]=texture,!1===params.premultiplyAlpha&&(texture.premultiplyAlpha=!1),_this.onTextureCreated&&_this.onTextureCreated(texture);let doLoadTexture=async()=>{try{await loadTexture(texture),texture.loaded=!0,texture.needsReupload=!0,RenderCount.add(`tex_${texture.dimensions.width}_${texture.dimensions.height}`),RenderCount.add("tex_"+(texture.compressed?"compressed":"uncompressed")),texture.onload&&(texture.onload(),texture.onload=null),texture.promise.resolve()}catch(e){texture.promise.reject(e)}};doLoadTexture(texture),texture.restore=function(){delete _restorable[key],texture.exists++,_textures[key]||(texture.promise=Promise.create(),texture.loaded=texture.needsReupload=!1,_textures[key]=texture,doLoadTexture(texture))}}return _textures[key]}function loadTextureSource(texture,path,params){let promise=Promise.create();return ImageDecoder.decode(path,params).then((imgBmp=>{imgBmp.crossOrigin="anonymous",texture.dimensions={width:imgBmp.width,height:imgBmp.height},texture.loaded=!0,texture.needsReupload=!0,texture.compressed&&!imgBmp.compressedData&&(texture.compressed=!1),World.RENDERER.type===Renderer.WEBGL2||Math.isPowerOf2(imgBmp.width,imgBmp.height)||(texture.minFilter=Texture.LINEAR,texture.generateMipmaps=!1),promise.resolve(imgBmp)})).catch((e=>{promise.reject(e)})),promise}function parseTexturePath(path){if(path.includes("://")){let guard=path.split("://");guard[1]=guard[1].replace(/\/\//g,"/"),path=guard.join("://")}else path=path.replace(/\/\//g,"/");let compressed,compressedIdentifier,cacheBust;if(({compressed:compressed,compressedIdentifier:compressedIdentifier,path:path}=parseCompressed(path)),window.URLSearchParams){if(path.includes("?")){let[withoutQuery,query]=path.split("?"),params=new URLSearchParams(query);for(const[key,value]of params.entries()){let check=key;key.includes("-compressedKtx")&&(check=key.substring(0,key.indexOf("-compressedKtx"))),Number.isInteger(Number(check))&&Number(check)>0&&""===value&&(params.delete(key),check!==key&&compressed&&(withoutQuery+=compressedIdentifier),cacheBust=!0)}cacheBust&&(path=withoutQuery,query=params.toString(),query&&(path+="?"+query))}}else path.includes("?")&&(cacheBust=!0,path=path.split("?")[0]);Hydra.LOCAL||(cacheBust=!1);let imgPath=path;return cacheBust&&(imgPath+=(imgPath.includes("?")?"&":"?")+Date.now()),compressed&&!imgPath.includes("compressed")&&(imgPath+=compressedIdentifier),{plainPath:path,imgPath:imgPath,compressed:compressed}}function parseCompressed(path){let compressedIdentifier=/-compressedKtx2?/.exec(path)?.[0],compressed=!1;compressedIdentifier&&(Utils.query("noKtx")||(compressedIdentifier.endsWith("2")?"undefined"!=typeof Ktx2Transcoder&&(compressed="ktx2"):compressed="ktx1"),path=path.replace(compressedIdentifier,""));let requiresKtx=!1;return/\.ktx2(?:\?|#|$)/.test(path)&&(compressed="ktx2",compressedIdentifier="",requiresKtx=!0),{compressed:compressed,compressedIdentifier:compressedIdentifier,path:path,requiresKtx:requiresKtx}}function splitCubemapPath(url){let path=url.replace(/-compressedKtx2?/,"").split(/[#?]/)[0],match=/(\d+)(?!.*\d+)/.exec(path);if(!match)throw new Error("Cubemap texture path must include a numeric pattern");let prefix=url.substring(0,match.index),pattern=match[1];return{prefix:prefix,pattern:pattern,suffix:url.substring(match.index+pattern.length),start:+pattern}}function getCubemapFacePaths(pathinfo){let padChar,{prefix:prefix,pattern:pattern,suffix:suffix,start:start}=pathinfo;return pattern.length>String(start).length&&(padChar=pattern.charAt(0)),Array.from(Array(6).keys(),(i=>{let n=String(start+i);return padChar&&(n=n.padStart(pattern.length,padChar)),`${prefix}${n}${suffix}`}))}window.Vec2=window.Vector2,window.Vec3=window.Vector3,this.localDebug=window.Hydra&&Hydra.LOCAL,async function(){await Hydra.ready();let threads=Thread.shared(!0);for(let i=0;i<threads.array.length;i++)_this.loadEngineOnThread(threads.array[i])}(),this.decompose=function(local,world){local.decomposeCache||(local.decomposeCache={position:new Vector3,quaternion:new Quaternion,scale:new Vector3}),local.decomposeDirty&&(local.matrixWorld.decompose(local.decomposeCache.position,local.decomposeCache.quaternion,local.decomposeCache.scale),local.decomposeDirty=!1),world.position.copy(local.decomposeCache.position),world.quaternion.copy(local.decomposeCache.quaternion),world.scale.copy(local.decomposeCache.scale)},this.createDebug=function(size=1,color){return new Mesh(new IcosahedronGeometry(size,1),_this.getTestShader(color))},this.getTestShader=function(color){return color?new Shader("ColorMaterial",{color:{value:color instanceof Color?color:new Color(color)},alpha:{value:1}}):new Shader("TestMaterial")},this.createMultiRT=function(width,height,type,format,multisample=!1,samplesAmount=4){let rt=new MultiRenderTarget(width,height,{minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:format||Texture.RGBFormat,type:type,multisample:multisample,samplesAmount:samplesAmount});return rt.texture.generateMipmaps=!1,rt},this.createRT=function(width,height,type,format,multisample=!1,samplesAmount=4){let rt=new RenderTarget(width,height,{minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:format||Texture.RGBFormat,type:type,multisample:multisample,samplesAmount:samplesAmount});return rt.texture.generateMipmaps=!1,rt},this.getFloatType=function(){return"android"==Device.system.os?Texture.FLOAT:Texture.HALF_FLOAT},this.getTexture=function(path,params={}){let{imgPath:imgPath,plainPath:plainPath,compressed:compressed}=parseTexturePath(path);return getTexture(plainPath,params,(async texture=>{texture.compressed=compressed,texture.format=plainPath.match(/\.jpe?g/)?Texture.RGBFormat:Texture.RGBAFormat,texture.src=plainPath;let imgBmp=await loadTextureSource(texture,imgPath,params);texture.image=imgBmp,imgBmp.sizes&&1===imgBmp.sizes.length&&(texture.minFilter=Texture.LINEAR),params.findDominantColors&&(texture.dominantColors=_this.findDominantColors(path)),texture.onUpdate=function(){!params.preserveData&&imgBmp.close&&imgBmp.close(),texture.onUpdate=null}}))},this.getCubeTexture=function(paths,params={}){let parsed=(paths=function getCubePaths(url){if(Array.isArray(url))return url;let{compressed:compressed,compressedIdentifier:compressedIdentifier,path:path,requiresKtx:requiresKtx}=parseCompressed(url);if(requiresKtx)return[path];"ktx1"===compressed&&(void 0===_supportsKtx1&&(_supportsKtx1=!!(Renderer.extensions.s3tc||Renderer.extensions.etc1||Renderer.extensions.pvrtc||Renderer.extensions.astc)),_supportsKtx1||(compressed=!1));!compressed&&compressedIdentifier&&(url=url.replace(compressedIdentifier,""));let info=splitCubemapPath(url);if(compressed)return[`${info.prefix}${info.suffix}`];return getCubemapFacePaths(info)}(paths)).map(parseTexturePath);return getTexture(`cube:${parsed.map((({plainPath:plainPath})=>plainPath)).join("|")}`,params,(async texture=>{texture.cube=await Promise.all(parsed.map((({imgPath:imgPath,compressed:compressed})=>(texture.compressed=compressed,texture.format=imgPath.match(/\.jpe?g/)?Texture.RGBFormat:Texture.RGBAFormat,loadTextureSource(texture,imgPath,params))))),texture.compressed||1!==texture.cube.length||(texture.cube=[...Array(6).keys()].map((_=>texture.cube[0]))),texture.compressed&&1===texture.cube[0].sizes.length&&(texture.minFilter=Texture.LINEAR),texture.onUpdate=function(){params.preserveData||texture.cube.forEach((imgBmp=>{imgBmp.close&&imgBmp.close()})),texture.onUpdate=null}}))},this.splitCubemapPath=splitCubemapPath,this.getCubemapFacePaths=getCubemapFacePaths,this.getLookupTexture=function(path){let texture=_this.getTexture(path);return texture.minFilter=texture.magFilter=Texture.NEAREST,texture.generateMipmaps=!1,texture},this.clearTextureCache=function(){for(let key in _textures)_textures[key].destroy();_textures={}},this.makeDataTexturePowerOf2=function(texture,itemSize){let[maxDimension,minDimension]=[texture.width,texture.height].sort();maxDimension=Math.ceilPowerOf2(maxDimension);const totalLength=maxDimension*maxDimension*itemSize,remainder=[];let j;for(let i=0;i<totalLength-texture.data.length;i++)j=i%texture.data.length,remainder.push(texture.data[j]);const totalData=new Float32Array(totalLength);totalData.set(texture.data),totalData.set(remainder,texture.data.length),texture.data=totalData,texture.width=texture.height=maxDimension,texture.powerOfTwoScale=minDimension/maxDimension},this.loadCurve=function(obj){"string"==typeof obj&&((obj=Assets.JSON[obj]).curves=obj.curves[0]);let data=obj.curves,points=[];for(let j=0;j<data.length;j+=3)points.push(new Vector3(data[j+0],data[j+1],data[j+2]));if("undefined"==typeof CatmullRomCurve)throw"loadCurve requires curve3d module";return new CatmullRomCurve(points)},this.getEmptyTexture=function(){return _emptyTexture||(_emptyTexture=new Texture),_emptyTexture},this.getRepeatTexture=function(src,scale){let texture=_this.getTexture(src,scale);return texture.promise.then((_=>{Math.isPowerOf2(texture.dimensions.width,texture.dimensions.height)||console.warn(`getRepeatTexture :: ${src} not power of two!`)})),texture.wrapS=texture.wrapT=Texture.REPEAT,texture},this.findTexturesByPath=function(path){let array=[];for(let key in _textures)key.includes(path)&&array.push(_textures[key]);return array},this.getHeightFromCamera=function(camera,dist){camera=camera.camera||camera,dist||(dist=camera.position.length());let fov=camera.fov;return 2*dist*Math.tan(.5*Math.radians(fov))},this.getWidthFromCamera=function(camera,dist){camera=camera.camera||camera;return _this.getHeightFromCamera(camera,dist)*camera.aspect},this.getPositionFromCameraSize=function(camera,size){camera=camera.camera||camera;let fov=Math.radians(camera.fov);return Math.abs(size/Math.sin(fov/2))},this.loadEngineOnThread=function(thread){["Base3D","CameraBase3D","Mesh","OrthographicCamera","PerspectiveCamera","Geometry","GeometryAttribute","Points","Scene","BoxGeometry","CylinderGeometry","PlaneGeometry","PolyhedronGeometry","IcosahedronGeometry","SphereGeometry","Box2","Box3","Face3","Color","Cylindrical","Euler","Frustum","Line3","Matrix3","Matrix4","Plane","Quaternion","Ray","Sphere","Spherical","Triangle","Vector2","Vector3","Vector4","RayManager","Vector3D","Group"].forEach((name=>{thread.importES6Class(name)})),thread.importCode(`Class(${zUtils3D.constructor.toString()}, 'static')`)},this.billboard=function(mesh,camera=World.CAMERA){_q||(_q=new Quaternion),_q.copy(camera.quaternion),mesh.customRotation&&mesh.quaternion.multiply(mesh.customRotation),mesh._parent&&_q.premultiply(mesh._parent.getWorldQuaternion().inverse()),mesh.quaternion.copy(_q)},this.billboardYAxis=function(mesh,camera=World.CAMERA){_q||(_q=new Quaternion),_q.copy(camera.quaternion);let angle=Math.atan2(_q.y,_q.w)+Math.PI;angle=-angle,_q.set(0,Math.sin(angle),0,Math.cos(angle)),mesh.customRotation&&mesh.quaternion.multiply(mesh.customRotation),mesh._parent&&_q.premultiply(mesh._parent.getWorldQuaternion().inverse()),mesh.quaternion.copy(_q)},this.positionInFrontOfCamera=function(object,distance,alpha=1,camera=World.CAMERA){_v3||(_v3=new Vector3),_v3b||(_v3b=new Vector3),_m4||(_m4=new Matrix4),_q||(_q=new Quaternion);let cameraPosition=_v3b,cameraQuaternion=_q;camera.updateMatrixWorld(),camera.matrixWorld.decompose(cameraPosition,cameraQuaternion,_v3),_v3.set(0,0,-distance).applyQuaternion(cameraQuaternion).add(cameraPosition),_m4.lookAt(cameraPosition,_v3,object.up),_q.setFromRotationMatrix(_m4),object.position.lerp(_v3,alpha),object.quaternion.slerp(_q,alpha)},this.getSignedQuaternionAngleToPlane=function(quaternion,direction,planeNormal,axis){_v3c||(_v3c=new Vector3);let vector=_v3c.copy(direction).applyQuaternion(quaternion);return _this.getSignedAngleToPlane(vector,planeNormal,axis)},this.getSignedAngleToPlane=function(vector,planeNormal,axis){_v3||(_v3=new Vector3),_v3b||(_v3b=new Vector3);let projected=_v3.copy(vector).projectOnPlane(planeNormal).normalize();if(0===projected.length())return Math.PI/2;axis?vector=_v3b.copy(vector).projectOnPlane(axis).normalize():axis=_v3b.crossVectors(projected,planeNormal);let dot=vector.dot(projected),det=axis.dot(projected.cross(vector));return Math.atan2(det,dot)},this.getQuad=function(){let geom=new Geometry,position=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),uv=new Float32Array([0,0,2,0,0,2]);return geom.addAttribute("position",new GeometryAttribute(position,3)),geom.addAttribute("uv",new GeometryAttribute(uv,2)),geom},this.findParentCamera=function(group){let parent=group.parent;for(;parent;){if(parent.nuke)return parent.nuke.camera;parent=parent.parent}return World.CAMERA},this.cameraIntrinsicsToObject=function(camera,object){object.fov=camera.fov,object.aspect=camera.aspect,object.near=camera.near,object.far=camera.far,object.p||(object.p=[],object.q=[],object.projectionMatrix=[]),camera.getWorldPosition().toArray(object.p),camera.getWorldQuaternion().toArray(object.q),camera.projectionMatrix.toArray(object.projectionMatrix),object.width=Stage.width,object.height=Stage.height},this.createFXLayer=function(name,nuke=World.NUKE,options){let layer=new FXLayer(nuke,options);return layer.name=name,layer},this.ensureAttributes=function(mesh){const vs=Shaders.getShader(mesh.shader.vsName+".vs"),attrib_regex=/attribute (\w+) (\w+);/g,attribs=mesh.geometry.attributes,firstCount=attribs[Object.keys(attribs)[0]].count;let attrib;for(;null!==(attrib=attrib_regex.exec(vs));){const name=attrib[2];if(name&&!attribs[name]){const size=parseInt(attrib[1][attrib[1].length-1])||1;mesh.geometry.addAttribute(name,new GeometryAttribute(new Float32Array(size*firstCount),size)),mesh.geometry.needsUpdate=!0}}},this.findDominantColors=async function(path){let colors=[new Color,new Color,new Color,new Color],ready=Promise.create();return fetch(Assets.getPath(path),{mode:"cors"}).then((async data=>{let blob=await data.blob(),bitmap=await createImageBitmap(blob),canvas=document.createElement("canvas");canvas.context=canvas.getContext("2d"),canvas.width=Math.round(bitmap.width),canvas.height=Math.round(bitmap.height),ww=canvas.width,hh=canvas.height,canvas.context.drawImage(bitmap,0,0,canvas.width,canvas.height);let imageData=canvas.context.getImageData(0,0,canvas.width,canvas.height);imageData=imageData.data;let result=await ImageDecoder.parseColors(imageData);colors=result.colors.map((e=>new Color(e.r,e.g,e.b))),ready.resolve()})).catch((er=>{ready.resolve()})),await ready,colors},this.renderToTexture3D=function(texture,shader){if(void 0===texture._renderTargets){let depth=texture.depth/4;texture._renderTargets=[];let offset=0;for(let i=0;i<depth;i++){offset=4*i;let renderTarget=new RenderTarget(texture.width,texture.height);renderTarget.texture=texture,renderTarget.indices=[offset,offset+1,offset+2,offset+3],texture._renderTargets.push(renderTarget)}let mesh=new Mesh(World.QUAD,shader);texture._meshFor3D=mesh}try{_v4||(_v4=new Vector4),texture._renderTargets.forEach((rt=>{shader.set("indices",_v4.set(...rt.indices)),World.RENDERER.renderSingle(texture._meshFor3D,World.CAMERA,rt)}))}catch(e){console.warn("the 3d texture can not be updated correctly, the shader requires the indices uniform to be declared")}}}),"static"),window.WebGLRenderingContext&&function(){"use strict";var e={};function r(r,t){var i;e[r]=!0,void 0!==t&&(i=t,window.console&&window.console.error&&window.console.error(i))}var t=function e(r){var t=r.gl;this.ext=r,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(r.maxVertexAttribs);for(var i=0;i<this.attribs.length;i++){var a=new e.VertexAttrib(t);this.attribs[i]=a}this.maxAttrib=0};(t.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var i=function(r){var t,i,a=this;this.gl=r,i=(t=r).getError,t.getError=function(){do{(r=i.apply(t))!=t.NO_ERROR&&(e[r]=!0)}while(r!=t.NO_ERROR);for(var r in e)if(e[r])return delete e[r],parseInt(r);return t.NO_ERROR};var n=this.original={getParameter:r.getParameter,enableVertexAttribArray:r.enableVertexAttribArray,disableVertexAttribArray:r.disableVertexAttribArray,bindBuffer:r.bindBuffer,getVertexAttrib:r.getVertexAttrib,vertexAttribPointer:r.vertexAttribPointer};r.getParameter=function(e){return e==a.VERTEX_ARRAY_BINDING_OES?a.currentVertexArrayObject==a.defaultVertexArrayObject?null:a.currentVertexArrayObject:n.getParameter.apply(this,arguments)},r.enableVertexAttribArray=function(e){var r=a.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,e),r.attribs[e].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},r.disableVertexAttribArray=function(e){var r=a.currentVertexArrayObject;return r.maxAttrib=Math.max(r.maxAttrib,e),r.attribs[e].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},r.bindBuffer=function(e,t){switch(e){case r.ARRAY_BUFFER:a.currentArrayBuffer=t;break;case r.ELEMENT_ARRAY_BUFFER:a.currentVertexArrayObject.elementArrayBuffer=t}return n.bindBuffer.apply(this,arguments)},r.getVertexAttrib=function(e,t){var i=a.currentVertexArrayObject.attribs[e];switch(t){case r.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return i.buffer;case r.VERTEX_ATTRIB_ARRAY_ENABLED:return i.enabled;case r.VERTEX_ATTRIB_ARRAY_SIZE:return i.size;case r.VERTEX_ATTRIB_ARRAY_STRIDE:return i.stride;case r.VERTEX_ATTRIB_ARRAY_TYPE:return i.type;case r.VERTEX_ATTRIB_ARRAY_NORMALIZED:return i.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},r.vertexAttribPointer=function(e,r,t,i,s,A){var o=a.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,e);var c=o.attribs[e];return c.buffer=a.currentArrayBuffer,c.size=r,c.type=t,c.normalized=i,c.stride=s,c.offset=A,c.recache(),n.vertexAttribPointer.apply(this,arguments)},r.instrumentExtension&&r.instrumentExtension(this,"OES_vertex_array_object"),r.canvas.addEventListener("webglcontextrestored",(function(){window.console&&window.console.log&&window.console.log("OESVertexArrayObject emulation library context restored"),a.reset_()}),!0),this.reset_()};i.prototype.VERTEX_ARRAY_BINDING_OES=34229,i.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(var e=0;e<this.vertexArrayObjects.length;++e)this.vertexArrayObjects.isAlive=!1;var r=this.gl;this.maxVertexAttribs=r.getParameter(r.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new t(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},i.prototype.createVertexArrayOES=function(){var e=new t(this);return this.vertexArrayObjects.push(e),e},i.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject==e&&this.bindVertexArrayOES(null)},i.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof t&&e.hasBeenBound&&e.ext==this)},i.prototype.bindVertexArrayOES=function(e){var t=this.gl;if(!e||e.isAlive){var i=this.original,a=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;var n=this.currentVertexArrayObject;if(a!=n){a&&n.elementArrayBuffer==a.elementArrayBuffer||i.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,n.elementArrayBuffer);for(var s=this.currentArrayBuffer,A=Math.max(a?a.maxAttrib:0,n.maxAttrib),o=0;o<=A;o++){var c=n.attribs[o],b=a?a.attribs[o]:null;if(a&&c.enabled==b.enabled||(c.enabled?i.enableVertexAttribArray.call(t,o):i.disableVertexAttribArray.call(t,o)),c.enabled){var u=!1;a&&c.buffer==b.buffer||(s!=c.buffer&&(i.bindBuffer.call(t,t.ARRAY_BUFFER,c.buffer),s=c.buffer),u=!0),(u||c.cached!=b.cached)&&i.vertexAttribPointer.call(t,o,c.size,c.type,c.normalized,c.stride,c.offset)}}this.currentArrayBuffer!=s&&i.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)}}else r(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject")},function(){var e=WebGLRenderingContext.prototype.getSupportedExtensions;WebGLRenderingContext.prototype.getSupportedExtensions=function(){var r=e.call(this)||[];return r.indexOf("OES_vertex_array_object")<0&&r.push("OES_vertex_array_object"),r};var r=WebGLRenderingContext.prototype.getExtension;WebGLRenderingContext.prototype.getExtension=function(e){return r.call(this,e)||("OES_vertex_array_object"!==e?null:(this.__OESVertexArrayObject||(console.log("Setup OES_vertex_array_object polyfill"),this.__OESVertexArrayObject=new i(this)),this.__OESVertexArrayObject))}}()}(),Class((function DracoThread(){let decoderConfig,decoderPending;function onError(opts){opts.message.preloading&&console.warn(opts.er);let plane=new PlaneGeometry(1,1).toNonIndexed(),buff=[],data={};for(let key in plane.attributes)data[key]=plane.attributes[key].array,buff.push(data[key].buffer);computeBounding(data),opts?.resolve(data,opts.id,buff)}function decodeGeometry(draco,decoder,decoderBuffer,taskConfig){const attributeIDs=taskConfig.attributeIDs,attributeTypes=taskConfig.attributeTypes;let dracoGeometry,decodingStatus;const geometryType=decoder.GetEncodedGeometryType(decoderBuffer);if(geometryType===draco.TRIANGULAR_MESH)dracoGeometry=new draco.Mesh,decodingStatus=decoder.DecodeBufferToMesh(decoderBuffer,dracoGeometry);else{if(geometryType!==draco.POINT_CLOUD)throw new Error("DRACOLoader: Unexpected geometry type.");dracoGeometry=new draco.PointCloud,decodingStatus=decoder.DecodeBufferToPointCloud(decoderBuffer,dracoGeometry)}if(!decodingStatus.ok()||0===dracoGeometry.ptr)throw new Error("DRACOLoader: Decoding failed: "+decodingStatus.error_msg());const geometry={index:null,attributes:[]};for(const attributeName in attributeIDs){const attributeType=attributeTypes[attributeName];let attribute,attributeID;if(taskConfig.useUniqueIDs)attributeID=attributeIDs[attributeName],attribute=decoder.GetAttributeByUniqueId(dracoGeometry,attributeID);else{if(attributeID=decoder.GetAttributeId(dracoGeometry,draco[attributeIDs[attributeName]]),-1===attributeID)continue;attribute=decoder.GetAttribute(dracoGeometry,attributeID)}geometry.attributes.push(decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute))}return geometryType===draco.TRIANGULAR_MESH&&(geometry.index=decodeIndex(draco,decoder,dracoGeometry)),draco.destroy(dracoGeometry),geometry}function decodeIndex(draco,decoder,dracoGeometry){const numIndices=3*dracoGeometry.num_faces(),byteLength=4*numIndices,ptr=draco._malloc(byteLength);decoder.GetTrianglesUInt32Array(dracoGeometry,byteLength,ptr);const index=new Uint32Array(draco.HEAPF32.buffer,ptr,numIndices).slice();return draco._free(ptr),{array:index,itemSize:1}}function decodeAttribute(draco,decoder,dracoGeometry,attributeName,attributeType,attribute){const numComponents=attribute.num_components(),numValues=dracoGeometry.num_points()*numComponents,byteLength=numValues*attributeType.BYTES_PER_ELEMENT,dataType=getDracoDataType(draco,attributeType),ptr=draco._malloc(byteLength);decoder.GetAttributeDataArrayForAllPoints(dracoGeometry,attribute,dataType,byteLength,ptr);const array=new attributeType(draco.HEAPF32.buffer,ptr,numValues).slice();return draco._free(ptr),{name:attributeName,array:array,itemSize:numComponents}}function getDracoDataType(draco,attributeType){switch(attributeType){case Float32Array:return draco.DT_FLOAT32;case Int8Array:return draco.DT_INT8;case Int16Array:return draco.DT_INT16;case Int32Array:return draco.DT_INT32;case Uint8Array:return draco.DT_UINT8;case Uint16Array:return draco.DT_UINT16;case Uint32Array:return draco.DT_UINT32}}this.loadDraco=function(e,id){const message=e;switch(message.type){case"init":decoderConfig=message.decoderConfig,decoderPending=new Promise((function(pendingResolve){decoderConfig.onModuleLoaded=function(draco){pendingResolve({draco:draco}),resolve({},id)},DracoDecoderModule(decoderConfig)}));break;case"decode_buffer_gltf":((dracoBuffer,dataAttrib)=>{const buffer=dracoBuffer,attributeIDs={},attributeTypes={},TYPE_ARRAY={5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array,"image/jpeg":Uint8Array,"image/png":Uint8Array};dataAttrib.forEach((att=>{const name=att.name;attributeIDs[name]=att.id,attributeTypes[name]=TYPE_ARRAY[att.type]}));const taskConfig={attributeIDs:attributeIDs,attributeTypes:attributeTypes,useUniqueIDs:!0};decoderPending.then((module=>{const draco=module.draco,decoder=new draco.Decoder,decoderBuffer=new draco.DecoderBuffer;decoderBuffer.Init(new Int8Array(buffer),buffer.byteLength);try{const geometry=decodeGeometry(draco,decoder,decoderBuffer,taskConfig),buffers=geometry.attributes.map((attr=>attr.array.buffer));geometry.index&&buffers.push(geometry.index.array.buffer);const response={};geometry.index&&(response.index=geometry.index.array),geometry.attributes.forEach((att=>{response[att.name]=att.array,response[`${att.name}ItemSize`]=att.itemSize})),response.position&&computeBounding(response),resolve(response,id,buffers)}catch(error){onError({message:message,er:`Parsing error on Draco file ${message.path}.`,resolve:resolve,id:id})}finally{draco.destroy(decoderBuffer),draco.destroy(decoder)}}))})(message.buffer,message.dataAttrib);break;case"decode":fetch(message.path).then((res=>{if(!res.ok)throw new Error;return res.arrayBuffer()})).then((dracoBuffer=>{const decoder=new TextDecoder,jsonSize=parseInt(decoder.decode(dracoBuffer.slice(0,10))),jsonData=JSON.parse(decoder.decode(dracoBuffer.slice(10,10+jsonSize))),buffer=dracoBuffer.slice(10+jsonSize),TYPED_ARRAYS=Object.values(Geometry.TYPED_ARRAYS),attributeIDs={},attributeTypes={};jsonData.attributes.forEach(((att,i)=>{const name=att[0];attributeIDs[name]=i,attributeTypes[name]=TYPED_ARRAYS[att[1]]}));const taskConfig={attributeIDs:attributeIDs,attributeTypes:attributeTypes,useUniqueIDs:!0},isMesh=0===jsonData.type;decoderPending.then((module=>{const draco=module.draco,decoder=new draco.Decoder,decoderBuffer=new draco.DecoderBuffer;decoderBuffer.Init(new Int8Array(buffer),buffer.byteLength);try{const geometry=decodeGeometry(draco,decoder,decoderBuffer,taskConfig),buffers=geometry.attributes.map((attr=>attr.array.buffer));isMesh&&geometry.index&&buffers.push(geometry.index.array.buffer);const response={_type:"BufferGeometry",userData:jsonData.userData||{}};response.userData.dracoType=jsonData.type,isMesh&&geometry.index&&(response.index=geometry.index.array),geometry.attributes.forEach((att=>{response[att.name]=att.array,response[`${att.name}ItemSize`]=att.itemSize})),isMesh&&response.position&&computeBounding(response),resolve(response,id,buffers)}catch(error){onError({message:message,er:`Parsing error on Draco file ${message.path}.`,resolve:resolve,id:id})}finally{draco.destroy(decoderBuffer),draco.destroy(decoder)}}))})).catch((()=>{onError({message:message,er:`Network error: Draco file (${message.path}) could not be loaded.`,resolve:resolve,id:id})}))}},this.decodeGeometry=decodeGeometry,this.decodeIndex=decodeIndex,this.decodeAttribute=decodeAttribute,this.getDracoDataType=getDracoDataType,this.onError=onError}),"static"),Class((function GeomThread(){Inherit(this,Component);const _this=this;var _cache={},_cacheWait={},_receive={},_dracoLoaded=null;function computeBounding(data){let geom=new Geometry;geom.addAttribute("position",new GeometryAttribute(data.position,3)),data.index&&geom.setIndex(data.index),geom.computeBoundingBox(),geom.computeBoundingSphere(),data.boundingBox=geom.boundingBox,data.boundingSphere=geom.boundingSphere}function loadGeometry(e,id){get(e.path).then((data=>{let buffers=[];if(data.data&&data.metadata?.type){let bufferList={_type:data.metadata.type},jsonData=data.data;jsonData.index&&(bufferList.index=new Geometry.TYPED_ARRAYS[jsonData.index.type](jsonData.index.array),buffers.push(bufferList.index.buffer));for(let key in jsonData.attributes){let attrib=jsonData.attributes[key];bufferList[key]=new Geometry.TYPED_ARRAYS[attrib.type](attrib.array),bufferList[`${key}ItemSize`]=attrib.itemSize,buffers.push(bufferList[key].buffer)}bufferList.position&&computeBounding(bufferList),data.userData&&(bufferList.userData=data.userData),resolve(bufferList,id,buffers)}else{for(let key in data)if("bones"!=key)if(Array.isArray(data[key])){const ArrayType="index"==key?Geometry.arrayNeedsUint32(data[key])?Uint32Array:Uint16Array:Float32Array;data[key]=new ArrayType(data[key]),buffers.push(data[key].buffer)}else data[key].length>0&&buffers.push(data[key].buffer);computeBounding(data),e.custom&&self[e.custom](data),resolve(data,id,buffers)}})).catch((er=>{e.preloading||console.error(er);let plane=new PlaneGeometry(1,1).toNonIndexed(),buffers=[],data={};for(let key in plane.attributes)data[key]=plane.attributes[key].array,buffers.push(data[key].buffer);computeBounding(data),resolve(data,id,buffers)}))}function geom_useFn(e){Global.FNS||(Global.FNS=[]),Global.FNS.push(e.name)}function loadDracoLib(){_dracoLoaded=Promise.create();const useJS="object"!=typeof WebAssembly,libFolder="~assets/js/lib/_draco/",libs=useJS?[`${libFolder}draco_decoder.js`]:[`${libFolder}draco_wasm_wrapper.js`,`${libFolder}draco_decoder.wasm`];Promise.all(libs.map(((url,i)=>fetch(Assets.getPath(url)).then((res=>{if(!res.ok)throw new Error;return 0===i?res.text():res.arrayBuffer()}))))).then((async loadedLibs=>{Thread.upload(["function loadDraco() {","/* draco decoder */",loadedLibs[0],"","/* worker */","","let decoderConfig, decoderPending;","",DracoThread.onError.toString(),DracoThread.decodeGeometry.toString(),DracoThread.decodeIndex.toString(),DracoThread.decodeAttribute.toString(),DracoThread.getDracoDataType.toString(),"","return "+DracoThread.loadDraco.toString(),"};"].join("\n"));const pool=Thread.shared(!0).array,decoderConfig=useJS?{}:{wasmBinary:loadedLibs[1]};pool.forEach((t=>t.importCode("self.loadDraco = loadDraco();"))),await Promise.all(pool.map((t=>t.loadDraco({type:"init",decoderConfig:decoderConfig})))),_dracoLoaded.resolve()})).catch((()=>{console.warn("Draco libs could not be loaded. Fallback to .json"),_dracoLoaded.reject()}))}function parseGeometry(data,path,custom){let geometry;if(custom&&_receive[custom])geometry=_receive[custom](data);else{let geom=new Geometry;if(data._type){for(key in data)if("_type"!==key&&!key.endsWith("ItemSize"))switch(key){case"userData":geom.userData=data.userData;break;case"boundingBox":geom.boundingBox=new Box3((new Vector3).set(data.boundingBox.min.x,data.boundingBox.min.y,data.boundingBox.min.z),(new Vector3).set(data.boundingBox.max.x,data.boundingBox.max.y,data.boundingBox.max.z));break;case"boundingSphere":geom.boundingSphere=new Sphere((new Vector3).set(data.boundingSphere.center.x,data.boundingSphere.center.y,data.boundingSphere.center.z),data.boundingSphere.radius);break;case"index":geom.setIndex(data.index);break;default:data[`${key}ItemSize`]&&geom.addAttribute(key,new GeometryAttribute(data[key],data[`${key}ItemSize`]))}}else geom.addAttribute("position",new GeometryAttribute(data.position,3)),geom.addAttribute("normal",new GeometryAttribute(data.normal||data.position.length,3)),geom.addAttribute("uv",new GeometryAttribute(data.uv||data.position.length/3*2,2)),data.uv2&&geom.addAttribute("uv2",new GeometryAttribute(data.uv2,2)),data.vdata&&geom.addAttribute("vdata",new GeometryAttribute(data.vdata,3)),data.index&&geom.setIndex(data.index),data.skinIndex&&geom.addAttribute("skinIndex",new GeometryAttribute(data.skinIndex,4)),data.skinWeight&&geom.addAttribute("skinWeight",new GeometryAttribute(data.skinWeight,4)),(data.rig||data.bones)&&(geom.bones=(data.rig?data.rig.bones:data.bones).slice(0)),geom.boundingBox=new Box3((new Vector3).set(data.boundingBox.min.x,data.boundingBox.min.y,data.boundingBox.min.z),(new Vector3).set(data.boundingBox.max.x,data.boundingBox.max.y,data.boundingBox.max.z)),geom.boundingSphere=new Sphere((new Vector3).set(data.boundingSphere.center.x,data.boundingSphere.center.y,data.boundingSphere.center.z),data.boundingSphere.radius);geometry=geom,geom._src=path}if(!geometry.attributes.position)throw`GeomThread :: Malformed geometry is missing position data. ${path}`;_this.caching&&(_cache[path]=geometry),_cacheWait[path]?.resolve(geometry)}this.caching=!0,async function(){await Hydra.ready(),Thread.upload(loadGeometry,geom_useFn,computeBounding)}(),this.loadGeometry=function(path,custom,preloading){if(!Device.graphics.gpu)return Promise.resolve(new PlaneGeometry(1,1));if(_cache[path])return Promise.resolve(_cache[path]);let cacheBust=!1;path.includes("?")&&(path=path.split("?")[0],cacheBust="?"+Utils.timestamp());let isBinary=path.endsWith(".bin");if(path.includes("http")||(Hydra.LOCAL||(cacheBust=!1),path.includes("assets/geometry/")||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),cacheBust&&(path+=cacheBust)),path=Thread.absolutePath(Assets.getPath(path)),_this.caching){if(_cacheWait[path])return _cacheWait[path];_cacheWait[path]=Promise.create()}return isBinary?(_dracoLoaded||loadDracoLib(),_dracoLoaded.then((()=>{Thread.shared().loadDraco({type:"decode",path:path,custom:custom,preloading:preloading}).then((data=>parseGeometry(data,path,custom)))})).catch((()=>{path=path.replace(".bin",".json"),Thread.shared().loadGeometry({path:path,custom:custom,preloading:preloading}).then((data=>parseGeometry(data,path,custom)))}))):Thread.shared().loadGeometry({path:path,custom:custom,preloading:preloading}).then((data=>parseGeometry(data,path,custom))),_cacheWait[path]},this.removeFromCache=function(path){path.includes("assets/geometry/")||(path="assets/geometry/"+path),path.includes(".")||(path+=".json"),path=Thread.absolutePath(Assets.getPath(path)),delete _cache[path],delete _cacheWait[path]},this.loadDracoLib=function(){return _dracoLoaded||loadDracoLib(),_dracoLoaded},this.loadSkinnedGeometry=function(path,custom,preloading){return this.loadGeometry(path,custom,preloading)},this.customFunction=function(fn,receive){let name=Thread.upload(fn);name=name[0],t.geom_useFn({name:name}),_receive[name]=receive}}),"static"),Class((function InstanceMesh(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _config,_shaderKey;function initHotReload(){_mesh.cacheGeom=_mesh.geometry.clone(),_this.events.sub(SceneLayout.HOTLOAD_GEOMETRY,(({file:file})=>{_mesh.geometry?._src?.includes(file)&&GeomThread.loadGeometry(file).then((_=>{createInstanceMesh(_config.getFilePath("json"))})),file.includes(_config.getFilePath("json"))&&createInstanceMesh(_config.getFilePath("json"))})),_this.events.sub(ShaderUIL.SHADER_UPDATE,(({shader:shader})=>{if(shader.includes(_shader.vsName)){let newShader=new Shader(_shader.vsName,_shader.fsName);delete MeshBatch.shaders[`${_shader.vsName}|${_shader.fsName}`],updateShader(newShader),Shader.renderer.hotReloadClearProgram(_shader.vsName),newShader.upload(_mesh,_mesh.cacheGeom),_shader._gl&&(_shader._gl=newShader._gl),_shader._gpu&&(_shader._gpu=newShader._gpu),_shader._metal&&(_shader._metal=newShader._metal)}}))}function updateShader(shader){let prefetchCode=Shaders.getShader(shader.vsName+".vs");shader.customCompile=`${shader.vsName}|${shader.fsName}|instance`,shader.resetProgram();let cached=MeshBatch.shaders[`${shader.vsName}|${shader.fsName}`];if(cached)return shader.fragmentShader=cached.fragment,void(shader.vertexShader=cached.vertex);let vsSplit=shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__");if(!vsSplit[1].includes("vec3 pos = position;")&&!vsSplit[1].includes("pos = pos;")&&!shader.vertexShader.includes("vec3 transformPosition"))throw`Shader ${shader.vsName} needs to have "vec3 pos = position;" in order for batching to work`;vsSplit[1]=vsSplit[1].replace(/vec3 pos = position;/g,"vec3 pos = transformPosition(position, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/pos = pos;/g,"pos = transformPosition(pos, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/vNormal = normalMatrix \* normal;/g,"vNormal = normalMatrix * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vec3 transformedNormal = normal;/g,"vec3 transformedNormal = transformNormal(normal, orientation);"),vsSplit[0]+="\n",vsSplit[0]+="#define INSTANCED 1\n",prefetchCode&&prefetchCode.includes("attribute vec3 offset")||(vsSplit[0]+="\n",vsSplit[0]+="attribute vec3 offset;\n",vsSplit[0]+="attribute vec3 scale;\n",vsSplit[0]+="attribute vec4 orientation;\n"),shader.vertexShader.includes("vec3 transformPosition")||(vsSplit[0]+=Shaders.getShader("instance.vs")+"\n"),vsSplit=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),fsSplit=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),shader.vertexShader=vsSplit,shader.fragmentShader=fsSplit,_shaderKey=`${shader.vsName}|${shader.fsName}`,MeshBatch.shaders[_shaderKey]={fragment:shader.fragmentShader,vertex:shader.vertexShader}}async function createInstanceMesh(json){if(!json)return;json.includes("assets/geometry")||(json=`assets/geometry/${json}`),json.includes(".json")||(json+=".json"),_mesh.cacheGeom&&(json+="?"+Utils.timestamp()),_mesh.instanceMesh&&(_mesh.instanceMesh.visible=!1);let geom=(new Geometry).instanceFrom(_mesh.cacheGeom||_mesh.geometry),buffers=await Thread.shared().parseInstanceMesh({url:Thread.absolutePath(Assets.getPath(json))});for(let key in buffers){let b=buffers[key];geom.addAttribute(key,new GeometryAttribute(b.buffer,b.components,1))}let test=_config.get("test");test&&(_this.instanceMultiplier=eval(test)),void 0===_this.maxInstancedCount&&(_this.maxInstancedCount=geom.maxInstancedCount);let shader=_mesh.shader;updateShader(shader);let mesh=new Mesh(geom,shader);mesh.renderOrder=_mesh.renderOrder,mesh.castShadow=_mesh.castShadow,mesh.frustumCulled=!1,mesh.renderOrder=_mesh.renderOrder,mesh.castShadow=_mesh.castShadow,mesh.receiveLight=_mesh.receiveLight,_this.frustumCulled=!0,_mesh._parent.add(mesh),_mesh.instanceMesh=mesh,_mesh.instanceMeshReady.resolve(),_this.startRender((_=>{mesh.renderOrder=_mesh.renderOrder,mesh.castShadow=_mesh.castShadow,mesh.depthWrite=_mesh.depthWrite,mesh.depthTest=_mesh.depthTest,mesh.receiveLight=_mesh.receiveLight,mesh.geometry.maxInstancedCount=_this.maxInstancedCount*_this.instanceMultiplier}),10)}this.instanceMultiplier=1,(_config=InputUIL.create("im_"+_input.prefix,_group)).addFile("json",{relative:"assets/geometry"}),_config.add("test"),_config.setLabel("Instance"),!1!==_input.get("visible")&&(_mesh._parent.remove(_mesh),_mesh.visible=!1,_mesh.instanceMeshReady=Promise.create(),_mesh.instanceMeshBeforeReady=Promise.create(),createInstanceMesh(_config.getFilePath("json")),_config.onUpdate=_=>{createInstanceMesh(_config.getFilePath("json"))},Hydra.LOCAL&&initHotReload()),this.applyToShader=function(shader){updateShader(shader)},this.onDestroy=function(){_mesh.instanceMesh&&_mesh.instanceMesh.destroy(),delete MeshBatch.shaders[_shaderKey]},this.set("frustumCulled",(async _=>{await _mesh.instanceMeshReady;let buffers=[],obj={};for(let key in _mesh.instanceMesh.geometry.attributes){if(!key.includes(["position","scale","offset","orientation"]))continue;let attrib=_mesh.instanceMesh.geometry.attributes[key],array=new Float32Array(attrib.array);obj[key]=array,buffers.push(array.buffer)}let bounding=await Thread.shared().generateBoundingInstanceMesh(obj,buffers);_mesh.instanceMesh.geometry.boundingBox=bounding.boundingBox,_mesh.instanceMesh.geometry.boundingSphere=bounding.boundingSphere,_mesh.instanceMesh.frustumCulled=!0}))}),(_=>{Thread.upload((function parseInstanceMesh({url:url},id){get(url).then((data=>{let buffers=[];for(let key in data)data[key].buffer=new Float32Array(data[key].buffer),buffers.push(data[key].buffer.buffer);resolve(data,id,buffers)}))})),Thread.upload((function generateBoundingInstanceMesh(e,id){let geom=new Geometry;geom.addAttribute("position",new GeometryAttribute(e.position,3));let box=new Box3,mesh=new Mesh(geom),count=e.offset.length/3;for(let i=0;i<count;i++)mesh.position.fromArray(e.offset,3*i),mesh.quaternion.fromArray(e.orientation,4*i),mesh.scale.fromArray(e.scale,3*i),box.expandByObject(mesh);let boundingBox=box,boundingSphere=box.getBoundingSphere();resolve({boundingBox:boundingBox,boundingSphere:boundingSphere},id)}))})),Class((function MeshBatch(_input,_config){Inherit(this,Object3D);const _this=this;var _geom,_shader,_mesh,_firstRender,_shaderKey,_availableIndices,_packedData,_packedTexture,_maxIndices,_static=!1,_renderOrder=0,_objects=[],_offset=[],_quaternion=[],_scale=[],_attributes={},_uniformToAttrib=[],_uniformNoAttrib=[],_frustumCulled=!0,_v1=new Vector3,_v2=new Vector3,_q=new Quaternion,_list=new LinkedList;async function initFromSceneLayout(){let wildcard=_input.get("wildcard");if(!wildcard||!wildcard.length)return;let groupName=wildcard.split("|")[0],group=await _this.parent.getLayer(groupName);await _this.wait(group.children,"length");let children=[...group.children];children.sort(((a,b)=>a.renderOrder-b.renderOrder)),children.forEach((mesh=>_this.add(mesh))),wildcard.includes("static")&&(_this.static=!0),_this.group.renderOrder=children[0].renderOrder,group.add(_this.group)}function updateShader(shader,castShadow){let prefetchCode=Shaders.getShader(shader.vsName+".vs");shader.customCompile=`${shader.vsName}|${shader.fsName}|instance`,shader.castShadow=castShadow,shader.resetProgram();let cached=MeshBatch.shaders[`${shader.vsName}|${shader.fsName}`];if(cached)return shader.fragmentShader=shader.restoreFS=cached.fragment,void(shader.vertexShader=shader.restoreVS=cached.vertex);let vsSplit=shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__");if(!vsSplit[1].includes("vec3 pos = position;")&&!vsSplit[1].includes("pos = pos;")&&!shader.vertexShader.includes("vec3 transformPosition"))throw`Shader ${shader.vsName} needs to have "vec3 pos = position;" in order for batching to work`;let definitions=[];vsSplit[1].split("\n").forEach((line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" "),uni=data[2].replace(";","");(function uniformToAttrib(key){key=key.trim();for(let i=0;i<_uniformToAttrib.length;i++){let val=_uniformToAttrib[i];if(key.includes(val)||val.includes(key))return!_uniformNoAttrib.includes(key)}return!1})(uni)&&(definitions.push(`${uni} = a_${data[2]}`),vsSplit[1]=vsSplit[1].replace(line,`attribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`))}})),vsSplit[1]=vsSplit[1].replace(/vec3 pos = position;/g,"vec3 pos = transformPosition(position, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/pos = pos;/g,"pos = transformPosition(pos, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/vNormal = normalMatrix \* normal;/g,"vNormal = normalMatrix * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vWorldNormal = transpose(inverse(mat3(modelMatrix))) \* normal;/g,"vWorldNormal = transpose(inverse(mat3(modelMatrix))) * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vec3 transformedNormal = normal;/g,"vec3 transformedNormal = transformNormal(normal, orientation);");let main=vsSplit[1].split("main() {");main[1]="\n"+definitions.join("\n")+main[1],vsSplit[1]=main.join("main() {"),vsSplit[0]+="#define INSTANCED 1\n",fsSplit[0]+="#define INSTANCED 1\n",prefetchCode&&prefetchCode.includes("attribute vec3 offset")||(vsSplit[0]+="\n",vsSplit[0]+="attribute float instance;\n",vsSplit[0]+="attribute vec3 offset;\n",vsSplit[0]+="attribute vec3 scale;\n",vsSplit[0]+="attribute vec4 orientation;\n"),shader.vertexShader.includes("vec3 transformPosition")||(vsSplit[0]+=Shaders.getShader("instance.vs")+"\n"),_packedData&&(vsSplit[0]+="\n            attribute float batchIndex;\n            uniform vec3 uPackedInfo;\n            uniform sampler2D tPackedTexture;\n            vec2 getPackedUV(float index, float offset) {\n                float pixel = (index*uPackedInfo.x) + offset;\n            \n                float size = uPackedInfo.y;\n                float p0 = pixel / size;\n                float y = floor(p0);\n                float x = p0 - y;\n            \n                vec2 uv = vec2(0.0);\n                uv.x = x;\n                uv.y = y / size;\n                return uv;\n            }\n            \n            vec4 getPackedData(float offset) {\n                return texture2D(tPackedTexture, getPackedUV(batchIndex, offset));\n            }\n            "),vsSplit=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),fsSplit=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),shader.vertexShader=shader.restoreVS=vsSplit,shader.fragmentShader=shader.restoreFS=fsSplit,_shaderKey=`${shader.vsName}|${shader.fsName}`,MeshBatch.shaders[_shaderKey]={fragment:shader.fragmentShader,vertex:shader.vertexShader}}function modifyGeometry(dir){if(!_geom||!_geom.attributes||!_geom.attributes.offset)return;let count=_geom.attributes.offset.count+dir;_offset=new Float32Array(3*count),_scale=new Float32Array(3*count),_quaternion=new Float32Array(4*count),_geom.attributes.offset.setArray(new Float32Array(3*count)),_geom.attributes.scale.setArray(new Float32Array(3*count)),_geom.attributes.orientation.setArray(new Float32Array(4*count));for(let key in _attributes){let components=_geom.attributes[key].itemSize;_attributes[key]=new Float32Array(count*components),_geom.attributes[key].setArray(new Float32Array(count*components))}_geom.maxInstancedCount=_objects.length,loop()}function dirty(a,b){for(let i=a.length-1;i>-1;i--)if(a[i]!=b[i])return!0;return!1}function prepareMesh(mesh,i){let pos=_v1,scale=_v2,quaternion=_q;if(_config.worldCoords)try{if(_config.parent>0)switch(_config.parent){case 1:pos.copy(mesh._parent.position),scale.copy(mesh._parent.scale),quaternion.copy(mesh._parent.quaternion);break;case 2:pos.copy(mesh._parent._parent.position),scale.copy(mesh._parent._parent.scale),quaternion.copy(mesh._parent._parent.quaternion)}else _config.addParentPosition?(pos.copy(mesh.position).add(mesh._parent.position),2==_config.addParentPosition&&pos.add(mesh._parent._parent.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion)):(pos.copy(mesh.getWorldPosition()),scale.copy(mesh.getWorldScale()),quaternion.copy(mesh.getWorldQuaternion()));_config.bypassVisibilityCheck||mesh.determineVisible()||(scale.x=scale.y=scale.z=0)}catch(e){pos.copy(mesh.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion)}else pos.copy(mesh.position),scale.copy(mesh.scale),quaternion.copy(mesh.quaternion),_config.visibilityCheck&&!mesh.determineVisible()&&scale.setScalar(0);mesh.batchOffsetPos&&pos.add(mesh.batchOffsetPos);let i3=3*i,i4=4*i;if(_offset[i3+0]=pos.x,_offset[i3+1]=pos.y,_offset[i3+2]=pos.z,_scale[i3+0]=scale.x,_scale[i3+1]=scale.y,_scale[i3+2]=scale.z,_quaternion[i4+0]=quaternion.x,_quaternion[i4+1]=quaternion.y,_quaternion[i4+2]=quaternion.z,_quaternion[i4+3]=quaternion.w,mesh.attributes)for(let key in mesh.attributes){let attr=mesh.attributes[key],value=void 0===attr.value?attr:attr.value;value instanceof Color?(_attributes[key][3*i+0]=value.r,_attributes[key][3*i+1]=value.g,_attributes[key][3*i+2]=value.b):value instanceof Vector3?(_attributes[key][3*i+0]=value.x,_attributes[key][3*i+1]=value.y,_attributes[key][3*i+2]=value.z):value instanceof Vector4||value instanceof Quaternion?(_attributes[key][4*i+0]=value.x,_attributes[key][4*i+1]=value.y,_attributes[key][4*i+2]=value.z,_attributes[key][4*i+3]=value.w):value instanceof Vector2?(_attributes[key][2*i+0]=value.x,_attributes[key][2*i+1]=value.y):_attributes[key][i]=value}if(_packedTexture){let batchIndex=mesh.batchIndex,stride=4*_packedTexture.keys;for(let key in _packedData){let offset=4*_packedData[key],value=mesh.packedData[key].value,index=batchIndex*stride+offset,r=g=b=a=1;value instanceof Color?(r=value.r,g=value.g,b=value.b):value instanceof Vector3?(r=value.x,g=value.y,b=value.z):value instanceof Vector4||value instanceof Quaternion?(r=value.x,g=value.y,b=value.z,a=value.w):value instanceof Vector2?(r=value.x,g=value.y):r=value,_packedTexture.data[index+0]=r,_packedTexture.data[index+1]=g,_packedTexture.data[index+2]=b,_packedTexture.data[index+3]=a}_packedTexture.needsUpdate=!0}}function updateBuffers(){if(_mesh){dirty(_quaternion,_geom.attributes.orientation.array)&&(_geom.attributes.orientation.array.set(_quaternion),_geom.attributes.orientation.needsUpdate=!0),dirty(_offset,_geom.attributes.offset.array)&&(_geom.attributes.offset.array.set(_offset),_geom.attributes.offset.needsUpdate=!0),dirty(_scale,_geom.attributes.scale.array)&&(_geom.attributes.scale.array.set(_scale),_geom.attributes.scale.needsUpdate=!0);for(let key in _attributes)dirty(_attributes[key],_geom.attributes[key].array)&&(_geom.attributes[key].array.set(_attributes[key]),_geom.attributes[key].needsUpdate=!0)}else!function initMesh(){if(_geom.addAttribute("offset",new GeometryAttribute(new Float32Array(_offset),3,1,_this.useDynamic)),_geom.addAttribute("scale",new GeometryAttribute(new Float32Array(_scale),3,1,_this.useDynamic)),_geom.addAttribute("orientation",new GeometryAttribute(new Float32Array(_quaternion),4,1,_this.useDynamic)),_frustumCulled){let box=new Box3;_objects.forEach((mesh=>box.expandByObject(mesh,!0))),_geom.boundingBox=box,_geom.boundingSphere=box.getBoundingSphere()}_mesh=new Mesh(_geom,_shader),_shader.castShadow&&(_mesh.castShadow=!0),_mesh.asyncPromise=_this.group.asyncPromise,_this.group.asyncPromise.resolve(),_this.mesh=_mesh,_this.shader=_mesh.shader,_this.mesh.isMeshBatch=!0,_this.group.add(_mesh),_mesh.frustumCulled=_frustumCulled,_renderOrder&&(_mesh.renderOrder=_renderOrder),_offset=new Float32Array(_offset),_quaternion=new Float32Array(_quaternion),_scale=new Float32Array(_scale);for(let key in _attributes){_attributes[key]=new Float32Array(_attributes[key]);let components=1,attr=_objects[0].attributes[key],value=attr.value||attr;value instanceof Vector3?components=3:value instanceof Vector4||value instanceof Quaternion?components=4:value instanceof Color?components=3:value instanceof Vector2&&(components=2),_geom.addAttribute(key,new GeometryAttribute(new Float32Array(_attributes[key]),components,1,_this.useDynamic))}_this.onMeshCreated&&_this.onMeshCreated(_mesh)}()}async function initializeStatic(){let wasVisible=_this.group.determineVisible();if(await(_=>{let promise=Promise.create(),mesh=_list.start(),i=0,worker=new Render.Worker((_=>{mesh.updateMatrixWorld(!0),prepareMesh(mesh,i),i++,mesh=_list.next(),mesh||(worker.stop(),promise.resolve())}),1);return promise})(),updateBuffers(),wasVisible){if(_frustumCulled){let box=new Box3;_objects.forEach((mesh=>box.expandByObject(mesh,!0))),_geom.boundingBox=box,_geom.boundingSphere=box.getBoundingSphere()}_this.flag("isStaticReady",!0)}else await _this.wait((()=>_this.group.determineVisible())),_static&&initializeStatic()}function loop(){_static&&_this.stopRender(loop,RenderManager.AFTER_LOOPS);let first=!_firstRender;_firstRender=!0;let i=0,mesh=_list.start();for(;mesh;)(!1!==mesh.batchNeedsUpdate||first)&&(first&&mesh.updateMatrixWorld(!0),prepareMesh(mesh,i)),mesh=_list.next(),i++;updateBuffers()}function firstLoop(){_static||_this.startRender(loop,RenderManager.AFTER_LOOPS),loop()}_this.useDynamic=!1,_input instanceof InputUILConfig||(_config=_input,_input=null),_config=_config||{},_input&&_this.parent.ready(!0).then(initFromSceneLayout),_this.group.asyncPromise=Promise.create(),Hydra.LOCAL&&function initHotReload(){_this.events.sub(ShaderUIL.SHADER_UPDATE,(({shader:shader})=>{if(_shader&&_shader.vsName&&shader.includes(_shader.vsName)){let newShader=new Shader(_shader.vsName,_shader.fsName);delete MeshBatch.shaders[`${_shader.vsName}|${_shader.fsName}`],updateShader(newShader),Shader.renderer.hotReloadClearProgram(_shader.vsName),newShader.upload(_mesh,_geom),_shader._gl&&(_shader._gl=newShader._gl),_shader._gpu&&(_shader._gpu=newShader._gpu),_shader._metal&&(_shader._metal=newShader._metal)}}))}(),this.add=function(mesh){_objects.push(mesh),_list.push(mesh),mesh.uploadIgnore=!0,mesh.batch=_this,_availableIndices&&!mesh.batchIndex&&(mesh.batchIndex=_availableIndices.shift(),mesh.attributes||(mesh.attributes={}),mesh.attributes.batchIndex={value:mesh.batchIndex});let shader=mesh.shader;for(let key in shader.uniforms){let uniform=shader.uniforms[key];if(uniform.value instanceof Color||uniform.value instanceof Vector2||uniform.value instanceof Vector3||uniform.value instanceof Vector4||uniform.value instanceof Quaternion||"number"==typeof uniform.value)if(uniform.batchUnique||_config.batchUnique)_uniformToAttrib.push(key),mesh.attributes||(mesh.attributes={}),mesh.attributes["a_"+key]=uniform;else if(_uniformNoAttrib.includes(key)||_uniformNoAttrib.push(key),void 0!==uniform.packedIndex){if(_packedData||(_packedData={}),!_availableIndices)throw"Can't use packedData without first setting .maxIndices";_packedData[key]||(_packedData[key]=uniform.packedIndex),mesh.packedData||(mesh.packedData={}),mesh.packedData[key]=uniform}}_geom||function initGeometry(mesh){if(_geom=(new Geometry).instanceFrom(mesh.geometry),_this.geom=_geom,!_shader){if((_shader=mesh.shader.clone()).debug=!0,mesh.shader.replicateUniformsTo(_shader),_packedData){let total=Object.keys(_packedData).length,pixels=Math.sqrt(_maxIndices*total),size=Math.pow(2,Math.ceil(Math.log(pixels)/Math.log(2)));(_packedTexture=new DataTexture(new Float32Array(size*size*4),size,size,Texture.RGBAFormat,Texture.FLOAT)).keys=total,_shader.addUniforms({tPackedTexture:{value:_packedTexture},uPackedInfo:{value:new Vector3(total,size,_maxIndices)}})}updateShader(_shader,mesh.castShadow)}if(mesh.attributes)for(let key in mesh.attributes)_attributes[key]=[];_static&&defer(initializeStatic)}(mesh),_mesh&&(modifyGeometry(1),_static&&console.error("Don't add more meshes to a static MeshBatch")),mesh.shader.neverRender=!0,_static||RenderManager.scheduleOne(firstLoop,RenderManager.AFTER_LOOPS)},this.remove=function(mesh){_objects.includes(mesh)&&(_objects.remove(mesh),_list.remove(mesh),mesh.batchIndex>-1&&!mesh.persistBatchIndex&&(_availableIndices.push(mesh.batchIndex),_availableIndices.sort(((a,b)=>a-b))),modifyGeometry(-1))},this.onDestroy=function(){_this.mesh&&_this.mesh.destroy&&_this.mesh.destroy(),delete MeshBatch.shaders[_shaderKey]},this.loadFromFile=async function(shader,geomFile,instanceFile){geomFile.includes("assets/geometry")||(geomFile="assets/geometry/"+geomFile),geomFile.includes(".json")||(geomFile+=".json"),instanceFile.includes("assets/geometry")||(instanceFile="assets/geometry/"+instanceFile),instanceFile.includes(".json")||(instanceFile+=".json");let[geom,data]=await Promise.all([GeomThread.loadGeometry(Assets.getPath(geomFile)),get(Assets.getPath(instanceFile))]),array=[],count=data.offset.buffer.length/3;for(let i=0;i<count;i++){let mesh=new Mesh(geom,shader);mesh.position.fromArray(data.offset.buffer,3*i),mesh.scale.fromArray(data.scale.buffer,3*i),mesh.quaternion.fromArray(data.orientation.buffer,4*i),array.push(mesh),_this.add(mesh)}return await _this.ready(),array},this.ready=function(){return _this.wait("mesh")},this.staticReady=function(){if(_static)return _this.wait("isStaticReady")},this.getMeshByIndex=function(index){return _objects[index]},this.getMeshCount=function(){return _objects.length},this.get("static",(()=>_static)),this.set("static",(b=>{!!b!==_static&&(_static=!!b,_objects.length&&(_static&&console.warn("For better initialization performance, set meshBatch.static before adding any meshes"),_this.stopRender(loop,RenderManager.AFTER_LOOPS),RenderManager.scheduleOne(firstLoop,RenderManager.AFTER_LOOPS)))})),this.set("maxIndices",(value=>{if(_maxIndices=value,!(_availableIndices=_config.availableIndices||[]).length)for(let i=0;i<value;i++)_availableIndices[i]=i})),this.get("attributes",(_=>_attributes)),this.get("maxIndices",(_=>_maxIndices)),this.set("renderOrder",(v=>{_renderOrder=v,_mesh&&(_mesh.renderOrder=v)})),this.get("renderOrder",(_=>_renderOrder)),this.set("frustumCulled",(b=>{_frustumCulled=b,_mesh&&(_mesh.frustumCulled=b)})),this.applyToShader=function(shader,castShadow=shader.mesh?.castShadow??!1){updateShader(shader,castShadow)}}),(_=>{MeshBatch.shaders={}})),Class((function MeshMerge(_input,_dynamic){Inherit(this,Object3D);const _this=this;var _mesh,_geom,_texture,_shaderKey,_meshes=[],_pending=[],_index=0;function initDynamic(){let array=new Float32Array(1024);(_texture=new DataTexture(array,16,16,Texture.RGBAFormat,Texture.FLOAT)).dynamic=!0,_texture.promise=Promise.resolve(),function updateShader(shader){shader.customCompile=`${shader.vsName}|${shader.fsName}|dynamicMerge`,shader.addUniforms({tDynamicMerge:{value:_texture}});let cached=MeshMerge.shaders[`${shader.vsName}|${shader.fsName}`];if(cached)return shader.fragmentShader=cached.fragment,shader.resetProgram();shader.resetProgram();let vsSplit=shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__");if(!vsSplit[1].includes("vec3 pos = position;"))throw`Shader ${shader.vsName} needs to have "vec3 pos = position;" in order for dynamic merging to work`;vsSplit[0]+="attribute float mIndex;\n",vsSplit[0]+="uniform sampler2D tDynamicMerge;\n",vsSplit[0]+="vec3 offset;\n",vsSplit[0]+="vec3 scale;\n",vsSplit[0]+="vec4 orientation;\n",shader.vertexShader.includes("vec3 transformPosition")||(vsSplit[0]+=Shaders.getShader("instance.vs")+"\n");vsSplit[0]+="\n        vec2 getDMUV(float index, float offset) {\n            float pixel = (index*3.0) + offset;\n        \n            float size = 16.0;\n            float p0 = pixel / size;\n            float y = floor(p0);\n            float x = p0 - y;\n        \n            vec2 uv = vec2(0.0);\n            uv.x = x;\n            uv.y = y / size;\n            return uv;\n        }\n        \n",vsSplit[1]=vsSplit[1].replace(/vec3 pos = position;/g,"vec3 pos = transformPosition(position, offset, scale, orientation);"),vsSplit[1]=vsSplit[1].replace(/vNormal = normalMatrix \* normal;/g,"vNormal = normalMatrix * transformNormal(normal, orientation);"),vsSplit[1]=vsSplit[1].replace(/vec3 transformedNormal = normal;/g,"vec3 transformedNormal = transformNormal(normal, orientation);");let oso="\n        offset = texture2D(tDynamicMerge, getDMUV(mIndex, 0.0)).xyz;\n        scale = texture2D(tDynamicMerge, getDMUV(mIndex, 1.0)).xyz;\n        orientation = texture2D(tDynamicMerge, getDMUV(mIndex, 2.0));\n        ",main=vsSplit[1].split("main() {");main[1]="\n"+oso+main[1],vsSplit[1]=main.join("main() {"),vsSplit=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),shader.vertexShader=vsSplit,_shaderKey=`${shader.vsName}|${shader.fsName}`,MeshMerge.shaders[_shaderKey]={vertex:shader.vertexShader}}(_mesh.shader);let loop=_=>{for(let i=_meshes.length-1;i>-1;i--){let mesh=_meshes[i],index=mesh.mergeIndex;array[12*index+0]=mesh.position.x,array[12*index+1]=mesh.position.y,array[12*index+2]=mesh.position.z,array[12*index+3]=1,array[12*index+4]=mesh.scale.x,array[12*index+5]=mesh.scale.y,array[12*index+6]=mesh.scale.z,array[12*index+7]=1,array[12*index+8]=mesh.quaternion.x,array[12*index+9]=mesh.quaternion.y,array[12*index+10]=mesh.quaternion.z,array[12*index+11]=mesh.quaternion.w}};defer(loop),_this.startRender(loop)}function completeMerge(){_mesh.geometry=_geom,_mesh.asyncPromise.resolve(),_this.onMeshCreated&&_this.onMeshCreated(_mesh),_this.mesh=_mesh}async function initFromSceneLayout(){let wildcard=_input.get("wildcard");if(!wildcard||!wildcard.length)return;let[groupName,dynamic]=wildcard.split("|");await _this.parent.loadedAllLayers();let group=await _this.parent.getLayer(groupName);_dynamic="dynamic"==dynamic;let children=[...group.children];children.sort(((a,b)=>a.renderOrder-b.renderOrder)),children.forEach((mesh=>_this.add(mesh))),group.add(_this.group),MeshMerge.cache[_input.prefix]||(MeshMerge.cache[_input.prefix]=Promise.create())}!function(){if("object"==typeof _input){if(!1===_input.get("visible"))return;_this.parent.ready().then(initFromSceneLayout)}else"boolean"==typeof _input&&(_dynamic=_input)}(),this.onDestroy=function(){_mesh.destroy(),delete MeshBatch.shaders[_shaderKey]},this.ready=function(){return _this.wait("mesh")},this.add=function(mesh){if(mesh.uploadIgnore=!0,!mesh.visible)return;if(mesh.merge=_this,mesh.updateMatrixWorld(!0),_mesh||async function initMesh(mesh){if((_mesh=new Mesh(World.QUAD,mesh.shader)).asyncPromise=Promise.create(),_this.group.add(_mesh),_input?.get&&(_mesh.castShadow=_input.get("castShadow"),_mesh.shader.receiveShadow=_input.get("receiveShadow")),_dynamic&&initDynamic(),_input?.prefix){let cached=MeshMerge.cache[_input.prefix];if(cached)return _geom=await cached,void completeMerge()}await defer();let data=await Promise.all(_pending),buffers=[];data.forEach((obj=>{for(let key in obj)obj[key].buffer&&buffers.push(obj[key].buffer)}));let merged=await Thread.shared().meshMergeComplete({data:data},buffers);_geom=new Geometry;for(let key in merged)"components"!==key&&_geom.addAttribute(key,new GeometryAttribute(merged[key],merged.components[key]));merged.indexBuffer&&(_geom.index=merged.indexBuffer),_input?.prefix&&MeshMerge.cache[_input.prefix].resolve(_geom),completeMerge()}(mesh),_input?.prefix){if(MeshMerge.cache[_input.prefix])return mesh.visible=!1,_meshes.push(mesh),void(mesh.mergeIndex=_index++)}let geom=mesh.geometry;if(mesh.attributes)for(let key in mesh.attributes){let attr=mesh.attributes[key];attr instanceof Vector4&&(attr.isVector4=!0),attr instanceof Vector3&&(attr.isVector3=!0),attr instanceof Vector2&&(attr.isVector2=!0),attr instanceof Color&&(attr.isColor=!0)}let data={},components={},buffers=[];for(let key in geom.attributes)data[key]=new Float32Array(geom.attributes[key].array),buffers.push(data[key].buffer),components[key]=geom.attributes[key].itemSize;geom.index&&(data.indexBuffer=new Uint32Array(geom.index),buffers.push(data.indexBuffer.buffer)),data.attributes=mesh.attributes,data.components=components,data.matrix="world"==_input?mesh.matrixWorld.elements:mesh.matrix.elements,_dynamic&&(data.matrix=null),data.dynamic=_dynamic,data.index=mesh.mergeIndex=_index++,mesh.visible=!1,_meshes.push(mesh),_pending.push(Thread.shared().meshMergeTransform(data,buffers))},this.onDestroy=function(){_input?.prefix&&delete MeshMerge.cache[_input.prefix]}}),(_=>{Thread.upload((function meshMergeTransform(e,id){let geom=new Geometry;for(let key in e)!key.includes(["components","matrix"])&&e[key]instanceof Float32Array&&geom.addAttribute(key,new GeometryAttribute(e[key],e.components[key]));if(e.indexBuffer&&(geom.index=e.indexBuffer),e.attributes)for(let key in e.attributes){let components=1,attr=e.attributes[key];attr.isVector4?components=4:attr.isVector3||attr.isColor?components=3:attr.isVector2&&(components=2);let buffer=new Float32Array(geom.attributes.position.count*components),step=buffer.length/components;for(let i=0;i<step;i++)4==components?(buffer[4*i+0]=attr.x,buffer[4*i+1]=attr.y,buffer[4*i+2]=attr.z,buffer[4*i+3]=attr.w):3==components?(buffer[3*i+0]=attr.x||attr.r||0,buffer[3*i+1]=attr.y||attr.g||0,buffer[3*i+2]=attr.z||attr.b||0):2==components?(buffer[2*i+0]=attr.x,buffer[2*i+1]=attr.y):buffer[i]=attr;geom.addAttribute(key,new GeometryAttribute(buffer,components))}e.matrix&&geom.applyMatrix((new Matrix4).fromArray(e.matrix));let indexBuffer=new Float32Array(geom.attributes.position.count);for(let i=0;i<indexBuffer.length;i++)indexBuffer[i]=e.index;geom.addAttribute("mIndex",new GeometryAttribute(indexBuffer,1));let data={},buffers=[],components={};for(let key in geom.attributes)data[key]=geom.attributes[key].array,components[key]=geom.attributes[key].itemSize,buffers.push(data[key].buffer);geom.index&&(data.indexBuffer=geom.index,buffers.push(data.indexBuffer.buffer)),data.components=components,resolve(data,id,buffers)})),Thread.upload((function meshMergeComplete({data:data},id){let _geom;data.forEach((data=>{let geom=new Geometry;for(let key in data)"components"!=key&&("indexBuffer"==key?geom.index=data[key]:geom.addAttribute(key,new GeometryAttribute(data[key],data.components[key])));_geom?_geom.merge(geom):_geom=geom}));let result={},components={},buffers=[];for(let key in _geom.attributes)result[key]=_geom.attributes[key].array,components[key]=_geom.attributes[key].itemSize,buffers.push(result[key].buffer);_geom.index&&(result.indexBuffer=_geom.index,buffers.push(result.indexBuffer.buffer)),result.components=components,resolve(result,id,buffers)})),MeshMerge.shaders={},MeshMerge.cache={}})),Class((function RTPool(_type,_size=3,_format,_multisample=!1,_samplesAmount=4){Inherit(this,Component);const _this=this;var _pool,_indexed={};this.nullRT=Utils3D.createRT(2,2),this.nullRT.setSize=()=>{};var _array=[],_resizeDisabled=!1;function createRT(){let rt=Utils3D.createRT(Stage.width*World.DPR,Stage.height*World.DPR,_type,_format,_multisample,_samplesAmount);return rt.index=_pool.length(),rt}function addListeners(){_resizeDisabled||_this.events.sub(Events.RESIZE,resizeHandler)}function resizeHandler(){_array.forEach((rt=>{rt.setSize(Stage.width*World.DPR,Stage.height*World.DPR)}))}!function initPool(){_pool=new ObjectPool;for(let i=0;i<_size;i++){let rt=createRT();_pool.put(rt),_array.push(rt)}}(),defer(addListeners),this.get("array",(_=>_array)),this.getRT=function(index){return index?(_indexed[index]||(_indexed[index]=createRT()),_indexed[index]):_pool.get()||createRT()},this.putRT=function(rt){rt.scissor&&delete rt.scissor,rt!==_this.nullRT&&_pool.put(rt)},this.setSize=function(width,height){_this.disableResize(),_array.forEach((rt=>{rt.setSize(width,height)}))},this.onDestroy=function(){let p=_pool.get();for(;p;)p.dispose(),p=_pool.get()},this.clone=function(type=_type,size=_size,format=_format,multisample=_multisample,samplesAmount=_samplesAmount){return new RTPool(type,size,format,multisample,samplesAmount)},this.disableResize=function(){_resizeDisabled=!0,_this.events.unsub(Events.RESIZE,resizeHandler)}}),"singleton"),Class((function RenderCount(){const _this=this;var $container,LOG,_map={},_display={};!async function(){await Hydra.ready(),_this.active=Utils.query("renderCount"),LOG=_this.active&&Utils.query("log"),_this.active&&async function initUIL(){await Hydra.ready(),($container=Stage.create("RenderCount")).css({width:175,height:"auto",paddingBottom:5,bottom:0,maxHeight:400,overflowY:"scroll"}).bg("#111").setZ(9999999)}()}(),this.add=function(name,detail,amt=1){if(_this.active){if(void 0===_map[name]&&(_map[name]=0,$container)){let $wrapper=$container.create("wrapper");$wrapper.css({position:"relative",width:"100%",height:20}),$wrapper.label=$wrapper.create("label"),$wrapper.label.fontStyle("Arial",12,"#fff").text(name).css({left:10}),$wrapper.value=$wrapper.create("value"),$wrapper.value.fontStyle("Arial",12,"#fff").text(0).css({right:10}),_display[name]=$wrapper}LOG&&(console.groupCollapsed(name),detail&&console.log(detail),console.trace(),console.groupEnd()),_map[name]+=amt,_display[name]?.value?.text?.(_map[name]||"0")}},this.remove=function(name,amt=1){_this.active&&_map[name]&&(_map[name]-=amt,_display[name]?.value?.text?.(_map[name]||"0"))}}),"static"),Class((function RenderStats(){const _this=this;var _trace,_filter,$container,_map={},_display={};function flush(){for(let key in _map)_this.stats[key]=_map[key],_display[key]&&_display[key].value.text(_map[key]||"0"),_map[key]=0;_trace=null}_this.stats={},async function(){await Hydra.ready(),_this.active=Utils.query("renderStats"),Utils.query("renderStats")&&async function initUIL(){if(await Hydra.ready(),($container=Stage.create("RenderStats")).css({position:"fixed",width:150,height:"auto",paddingTop:5}).bg("#111").setZ(99999),Utils.query("uil")){const left=RenderCount.active?150:0;$container.css({bottom:0,left:left})}}(),Render.drawFrame=flush;let frames=0,prevTime=0,fps=Render.REFRESH_RATE;Render.start((_=>{frames+=1,Render.TIME>=prevTime+1e3&&(fps=1e3*frames/(Render.TIME-prevTime),fps=Math.round(fps,fps>=1?0:2),prevTime=Render.TIME,frames=0),_this.update("FPS",fps)}))}(),this.update=function(name,amt=1,detail,detail2){if(Hydra.LOCAL){if(_trace==name){if(_filter&&detail){if(!("string"==typeof detail?detail:Utils.getConstructorName(detail)).toLowerCase().includes(_filter.toLowerCase()))return}console.groupCollapsed(name),detail&&console.log("string"==typeof detail?detail:Utils.getConstructorName(detail)),detail2&&console.log(detail2),console.trace(),console.groupEnd()}if(void 0===_map[name]&&(_map[name]=0,$container)){let $wrapper=$container.create("wrapper");$wrapper.css({position:"relative",width:"100%",height:20}),$wrapper.label=$wrapper.create("label"),$wrapper.label.fontStyle("Arial",12,"#fff").text(name).css({left:10}),$wrapper.value=$wrapper.create("value"),$wrapper.value.fontStyle("Arial",12,"#fff").text(0).css({right:10}),_display[name]=$wrapper}_map[name]+=amt}},this.trace=function(name,filter=null){_trace=name,_filter=filter},this.log=function(){for(let key in _this.stats)console.log(key,_this.stats[key]);console.log("----")}}),"static"),Class((function Fluid(_simSize=128,_dyeSize=512,_rect=Stage){Inherit(this,Component);const _this=this;var _fbos={},_scenes={},_tmpVec=new Vector2,_lastSplat=Render.TIME;const DYE_WIDTH=_dyeSize,DYE_HEIGHT=_dyeSize,SIM_WIDTH=_simSize,SIM_HEIGHT=_simSize,config={DENSITY_DISSIPATION:.97,VELOCITY_DISSIPATION:.98,PRESSURE_DISSIPATION:.8,PRESSURE_ITERATIONS:20,CURL:30,DEBUG_MOUSE:!0,SPLAT_RADIUS:.25};function loop(){config.DEBUG_MOUSE&&function drawMouse(){_this.drawInput(Mouse.x,Mouse.y,10*Mouse.delta.x,10*Mouse.delta.y,new Color("#777777"))}(),_scenes.curl.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.curl.render(_fbos.curl.fbo),_scenes.vorticity.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.vorticity.uniforms.uCurl.value=_fbos.curl.fbo,_scenes.vorticity.uniforms.curl.value=config.CURL,_scenes.vorticity.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.divergence.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.divergence.render(_fbos.divergence.fbo),_scenes.clear.uniforms.uTexture.value=_fbos.pressure.read,_scenes.clear.uniforms.value.value=config.PRESSURE_DISSIPATION,_scenes.clear.render(_fbos.pressure.write),_fbos.pressure.swap(),_scenes.pressure.uniforms.uDivergence.value=_fbos.divergence.fbo;for(let i=0;i<config.PRESSURE_ITERATIONS;i++)_scenes.pressure.uniforms.uPressure.value=_fbos.pressure.read,_scenes.pressure.render(_fbos.pressure.write),_fbos.pressure.swap();_scenes.gradientSubtract.uniforms.uPressure.value=_fbos.pressure.read,_scenes.gradientSubtract.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.gradientSubtract.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.advection.uniforms.texelSize.value.set(1/SIM_WIDTH,1/SIM_HEIGHT),_scenes.advection.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.advection.uniforms.uSource.value=_fbos.velocity.read,_scenes.advection.uniforms.dissipation.value=config.VELOCITY_DISSIPATION,_scenes.advection.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.advection.uniforms.texelSize.value.set(1/DYE_WIDTH,1/DYE_HEIGHT),_scenes.advection.uniforms.uVelocity.value=_fbos.velocity.read,_scenes.advection.uniforms.uSource.value=_fbos.density.read,_scenes.advection.uniforms.dissipation.value=config.DENSITY_DISSIPATION,_scenes.advection.render(_fbos.density.write),_fbos.density.swap(),_scenes.display.uniforms.uTexture.value=_fbos.density.read,_scenes.display.uniforms.texelSize.value.set(1/_rect.width,1/_rect.height),_scenes.display.render(_this.rt)}this.rt=Utils3D.createRT(_rect.width,_rect.height),this.fbos=_fbos,this.additiveBlending=!0,_this.rt.disableDepth=!0,function initFBOs(){_fbos.density=_this.initClass(FluidFBO,DYE_WIDTH,DYE_HEIGHT,Texture.LINEAR),_fbos.velocity=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.LINEAR),_fbos.divergence=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST),_fbos.curl=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST),_fbos.pressure=_this.initClass(FluidFBO,SIM_WIDTH,SIM_HEIGHT,Texture.NEAREST)}(),function initScenes(){_scenes.curl=_this.initClass(FluidScene,"fluidBase","curlShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},depthWrite:!1}),_scenes.vorticity=_this.initClass(FluidScene,"fluidBase","vorticityShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},uCurl:{value:null},curl:{value:config.CURL},dt:{value:Render.REFRESH_RATE/1e3/100}}),_scenes.divergence=_this.initClass(FluidScene,"fluidBase","divergenceShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null}}),_scenes.clear=_this.initClass(FluidScene,"fluidBase","clearShader",{uTexture:{value:null},value:{value:config.PRESSURE_DISSIPATION}}),_scenes.pressure=_this.initClass(FluidScene,"fluidBase","pressureShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uPressure:{value:null},uDivergence:{value:null}}),_scenes.gradientSubtract=_this.initClass(FluidScene,"fluidBase","gradientSubtractShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uPressure:{value:null},uVelocity:{value:null}}),_scenes.advection=_this.initClass(FluidScene,"fluidBase","advectionShader",{texelSize:{value:new Vector2(1/SIM_WIDTH,1/SIM_HEIGHT)},uVelocity:{value:null},uSource:{value:null},dt:{value:Render.REFRESH_RATE/1e3/100},dissipation:{value:config.VELOCITY_DISSIPATION}}),_scenes.display=_this.initClass(FluidScene,"fluidBase","displayShader",{texelSize:{value:new Vector2(1/_rect.width,1/_rect.height)},uTexture:{value:null}}),_scenes.splat=_this.initClass(FluidScene,"fluidBase","splatShader",{uTarget:{value:null},aspectRatio:{value:_rect.width/_rect.height},point:{value:new Vector2},prevPoint:{value:new Vector2},color:{value:new Vector3},bgColor:{value:new Color("#000000")},radius:{value:config.SPLAT_RADIUS/100},canRender:{value:0},uAdd:{value:1}})}(),_this.startRender(loop),this.updateConfig=function(key,value){config[key]=value},this.drawInput=function(x,y,dx,dy,color,radius=config.SPLAT_RADIUS){_scenes.splat.uniforms.uTarget.value=_fbos.velocity.read,_scenes.splat.uniforms.radius.value=radius/200,_scenes.splat.uniforms.aspectRatio.value=_rect.width/_rect.height,_tmpVec.set(x/_rect.width,1-y/_rect.height);let now=Render.TIME,delta=now-_lastSplat;_lastSplat=now,delta>50?_scenes.splat.uniforms.prevPoint.value.copy(_tmpVec):_scenes.splat.uniforms.prevPoint.value.copy(_scenes.splat.uniforms.point.value),_scenes.splat.uniforms.point.value.copy(_tmpVec),_scenes.splat.uniforms.color.value.set(dx,-dy,1),_scenes.splat.uniforms.uAdd.value=1,_scenes.splat.render(_fbos.velocity.write),_fbos.velocity.swap(),_scenes.splat.uniforms.uTarget.value=_fbos.density.read,_scenes.splat.uniforms.color.value.set(color.r,color.g,color.b),_scenes.splat.uniforms.uAdd.value=_this.additiveBlending?1:0,_scenes.splat.render(_fbos.density.write,!0),_fbos.density.swap(),_scenes.splat.uniforms.canRender.value=1}})),Class((function FluidFBO(_width,_height,_filter){Inherit(this,Component);const _this=this,type=Device.mobile||Renderer.type!=Renderer.WEBGL1?Texture.HALF_FLOAT:Texture.FLOAT;var _fbo1=new RenderTarget(_width,_height,{minFilter:_filter,magFilter:_filter,format:Texture.RGBAFormat,type:type}),_fbo2=new RenderTarget(_width,_height,{minFilter:_filter,magFilter:_filter,format:Texture.RGBAFormat,type:type});this.fbo=_fbo1,this.uniform={value:_fbo1},_fbo1.disableDepth=!0,_fbo2.disableDepth=!0,_fbo1.generateMipmaps=!1,_fbo2.generateMipmaps=!1,this.swap=function(){let temp=_fbo1;_fbo1=_fbo2,_fbo2=temp,_this.uniform.value=_fbo1},this.get("read",(_=>_fbo1)),this.get("write",(_=>_fbo2))})),Class((function FluidLayer(_input,_group){Inherit(this,Object3D);var _fluid,_config,_this=this;!function initConfig(){(_config=InputUIL.create(_input.prefix+"fluid",_group)).setLabel("Fluid Config"),_config.add("dyeSize",512),_config.add("simSize",128),_config.add("velocity",.98),_config.add("density",.97),_config.add("pressure",.8),_config.add("iterations",5),_config.add("curl",30),_config.add("defaultRadius",25),_config.addToggle("debugMouse",!1)}(),function initFluid(){let rect=Stage,wildcard=_input.get("wildcard");if(wildcard&&wildcard.includes("x")){let split=wildcard.split("x");rect={width:Number(split[0]),height:Number(split[1])}}_fluid=_this.initClass(Fluid,_config.getNumber("simSize"),_config.getNumber("dyeSize"),rect),_this.rt=_fluid.rt,_this.fbos=_fluid.fbos,_config.onUpdate=key=>{switch(key){case"velocity":_fluid.updateConfig("VELOCITY_DISSIPATION",_config.getNumber(key));break;case"density":_fluid.updateConfig("DENSITY_DISSIPATION",_config.getNumber(key));break;case"pressure":_fluid.updateConfig("PRESSURE_DISSIPATION",_config.getNumber(key));break;case"iterations":_fluid.updateConfig("PRESSURE_ITERATIONS",_config.getNumber(key));break;case"curl":_fluid.updateConfig("CURL",_config.getNumber(key));break;case"defaultRadius":_fluid.updateConfig("SPLAT_RADIUS",_config.getNumber(key));break;case"debugMouse":_fluid.updateConfig("DEBUG_MOUSE",_config.get(key))}},["velocity","density","pressure","iterations","curl","defaultRadius","debugMouse"].forEach(_config.onUpdate)}(),this.initMesh=function initMesh(){let shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:_fluid.rt}}),mesh=new Mesh(World.QUAD,shader);_this.add(mesh),_this.mesh=mesh},this.drawInput=_fluid.drawInput,this.set("additiveBlending",(v=>_fluid.additiveBlending=v)),this.applyTo=function(shader){shader.uniforms.tFluid=_this.fbos.velocity.uniform,shader.uniforms.tFluidMask={value:_this}}})),Class((function FluidScene(_vs,_fs,_uniforms){Inherit(this,Component);const _this=this;var _scene=new Scene;!function(){_uniforms.depthWrite=!1;let shader=_this.initClass(Shader,_vs,_fs,_uniforms),mesh=new Mesh(World.QUAD,shader);shader.depthWrite=!1,mesh.noMatrices=!0,_scene.add(mesh),_this.uniforms=shader.uniforms}(),this.render=function(rt){World.RENDERER.autoClear=!1,World.RENDERER.renderSingle(_scene.children[0],World.CAMERA,rt),World.RENDERER.autoClear=!0}})),Class((function Fullscreen(){Inherit(this,Events);const _this=this;function update(){const isOpen=!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement);isOpen!==_this.isOpen&&(_this.isOpen=isOpen,_this.events.fire(Events.FULLSCREEN,{fullscreen:_this.isOpen}))}this.isOpen=!1,function addHandlers(){["onfullscreenchange","onwebkitfullscreenchange","onmozfullscreenchange","onmsfullscreenchange","onfullscreenerror","onwebkitfullscreenerror","onmozfullscreenerror","onmsfullscreenerror"].forEach((evt=>{void 0!==document[evt]&&(document[evt]=update)}))}(),this.open=function(element){element=element||document.body,["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"].every((method=>{if(void 0===element[method])return!0;element[method]({navigationUI:"hide"})}))},this.close=function(){["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"].every((method=>{if(void 0===document[method])return!0;document[method]()}))},Object.defineProperty(this,"enabled",{get:()=>["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"].some((prop=>Boolean(document[prop])))})}),"static"),Class((function FXAA(){Inherit(this,NukePass);this.uniforms={tMask:{value:null}},this.init("FXAA","FXAA"),this.setMask=function(texture){this.uniforms.tMask.value=texture}})),Class((function JoystickInteraction(_config={}){Inherit(this,Events);const _this=this;var _joystick,_hitObject;function loop(t,delta){if(!_joystick)return;let e={target:{}};Math.abs(_joystick.x)<.001&&Math.abs(_joystick.y)<.001?(e.x=_this.move.x,e.y=_this.move.y,_this.delta.x=0,_this.delta.y=0,_this.move.x=0,_this.move.y=0,_this.isTouching&&(_this.isTouching=!1,_this.events.fire(Interaction.END,e,!0))):_this.isTouching?(_this.delta.x=_joystick.x*delta,_this.delta.y=_joystick.y*delta,_this.move.x+=_this.delta.x,_this.move.y+=_this.delta.y,e.x=_this.move.x,e.y=_this.move.y,_this.velocity.x=Math.abs(_this.delta.x)/delta,_this.velocity.y=Math.abs(_this.delta.y)/delta,_this.events.fire(Interaction.MOVE,e,!0),_this.events.fire(Interaction.DRAG,e,!0)):(_this.isTouching=!0,e.x=_this.move.x=0,e.y=_this.move.y=0,_this.delta.x=0,_this.delta.y=0,_this.events.fire(Interaction.START,e,!0))}this.delta=new Vector2,this.move=new Vector2,_this.velocity=new Vector2,function(){if(Device.system.xr.vr){if(_config&&_config.raycast?(_hitObject=_config,World.CAMERA):_config&&(_hitObject=_config.hit,_config.hitCamera||World.CAMERA),!_hitObject)throw"JoystickInteraction requires a Mesh for hit testing";!async function addHandlers(){await VRInput.ready(),_joystick={x:0,y:0},VRInput.controllers.forEach((controller=>_this.events.sub(controller,VRInput.JOYSTICK,(e=>{!function handleJoystick(e,controller){!function checkHit(controller){return _hitObject.interaction.checkObjectFromValues(_hitObject,controller.group.worldPos,controller.pointer,_config.hitCamera)}(controller)?(_joystick.x=0,_joystick.y=0):(_joystick.x=e.x,_joystick.y=e.y)}(e,controller)}))))}(),Render.start(loop)}}()})),Interaction.Class((function Renderer(_object){var _hydraObject=_object instanceof HydraObject;this.needsUpdate=!!_hydraObject,_hydraObject&&(_object.x=_object.x||0,_object.y=_object.y||0,_object.z=_object.z||0,_object.pos={x:0,y:0,z:0}),this.update=function(){_object.transform()}})),Interaction.Class((function Slider(_object,_direction,_config){Inherit(this,Component);var _input,_values,_renderer,_side,_addInput,_axis,_views,_dragging,_lockMove,_cacheStart,_hitObject,_this=this,_holdOffset=0,_lastSign=1;function copyFromTo(o1,o2){_this.interpolate||(void 0!==o1.x&&(o2.x=o1.x),void 0!==o1.y&&(o2.y=o1.y),void 0!==o1.z&&(o2.z=o1.z))}function loop(){_this.interpolate&&(void 0!==_values.x&&(_object.x=Math.lerp(_values.x,_object.x,_this.interpolate)),void 0!==_values.y&&(_object.y=Math.lerp(_values.y,_object.y,_this.interpolate)),void 0!==_values.z&&(_object.z=Math.lerp(_values.z,_object.z,_this.interpolate))),function getFullElapsed(){if(!_this.preventVisible&&(_this.elapsed=Math.abs(_object[_axis])/Math.abs(-_this[_side]*(_this.maxSlides-1)),_views))for(var i=0;i<_views.length;i++){var view=_views[i],pos=_this[_side]*i,offset=(_object[_axis]+pos)/_this[_side];view.sliderOffset=offset,view.updatePosition&&view.updatePosition(offset,_dragging)}}()}function tweenObj(_to){var css=_this.cssTransitions;if(_this.needsRender=!0,_this.interpolate&&void 0===_values[_axis]&&(_values[_axis]=_object[_axis]),copyFromTo(_object,_values),tween(_values,_to,_this.easeTime,_this.ease).onUpdate((()=>{copyFromTo(_values,css?_object.pos:_object),!css&&_this.autoRender&&_renderer.needsUpdate&&_renderer.update(),_this.onUpdate&&_this.onUpdate(_this.elapsed)})).onComplete((_=>_this.needsRender=!1)),css){var cssTo={};cssTo[_axis]=_to[_axis],_object.tween(cssTo,_this.easeTime,_this.ease)}}function incSlide(){_this.currentSlide++,_this.repeatable&&_this.currentSlide>_this.maxSlides-1&&(_this.currentSlide=0),!_this.infinite&&_this.currentSlide>_this.maxSlides-1&&(_this.currentSlide=_this.maxSlides-1),onUpdateSlide(_this.currentSlide)}function decSlide(){_this.currentSlide--,_this.repeatable&&_this.currentSlide<0&&(_this.currentSlide=_this.maxSlides-1),!_this.infinite&&_this.currentSlide<0&&(_this.currentSlide=0),onUpdateSlide(_this.currentSlide)}function onUpdateSlide(slide){_this.events.fire(Interaction.Slider.UPDATE,{slide:slide})}function inputUpdate(e,delta=_input.move,override){if(!Device.mobile&&!_this.desktopDrag||!_dragging&&!override||_this.preventMovement||_this.preventVisible)return;(_this.interpolate?_values:_object)[_axis]=-_this[_side]*_this.currentSlide+delta[_axis]*_this.multiplier+_holdOffset,!_this.infinite&&function outOfBounds(){return _object[_axis]>0||_this.currentSlide==_this.maxSlides-1&&_object[_axis]<-_this[_side]*_this.currentSlide}()&&function clampWithFriction(){let obj=_this.interpolate?_values:_object;var val=obj[_axis],max=-_this[_side]*_this.currentSlide;val>0?obj[_axis]=val*_this.friction:val<max&&(obj[_axis]=max+(val-max)*_this.friction)}(),_this.cssTransitions&&_object.stopTween(),e.elapsed=_this.elapsed,_this.events.fire(Interaction.MOVE,e,!0),_this.autoRender&&_renderer.needsUpdate&&(_this.cssTransitions&&(_object.pos[_axis]=_object[_axis]),_renderer.update()),delta}function lockStart(e){_cacheStart=e}function lockMove(e){Math.abs(_input.move[_axis])>_lockMove&&!_this.flag("overrideLock")&&!_this.flag("preventMove")&&(inputStart(_cacheStart),_this.flag("overrideLock",!0),_this.events.fire(Interaction.Slider.OVERRIDE_LOCK,{action:"start"})),Math.abs(_input.move["x"==_axis?"y":"x"])>_lockMove&&_this.flag("preventMove",!0)}function lockEnd(e){_cacheStart=null,_this.flag("overrideLock")&&_this.events.fire(Interaction.Slider.OVERRIDE_LOCK,{action:"end"}),_this.flag("overrideLock",!1),_this.flag("preventMove",!1)}function inputStart(e){!Device.mobile&&!_this.desktopDrag||"hit"==e.target.className&&1!=_config.allowHit||_this.preventMovement||_this.preventVisible||!function checkHit(e){return!_hitObject||_hitObject.interaction.checkObjectHit(_hitObject,e,_config.hitCamera)}(e)||(_dragging=!0,clearTween(_values),_holdOffset=_values[_axis]+_this[_side]*_this.currentSlide||0,Date.now(),0,_this.needsRender=!0,_this.events.fire(Interaction.Slider.START_INTERACTION,null,!0))}function inputEnd(e,override){if((Device.mobile||_this.desktopDrag)&&(_dragging||override)&&!_this.preventMovement&&!_this.preventVisible){var velocity,target={},delta=_input.delta[_axis];0===delta&&0!==_input.velocity[_axis]||(_lastSign=Math.sign(delta)),velocity=_input.velocity[_axis]*_lastSign;Date.now();if(RenderManager.type!=RenderManager.VR&&(Math.abs(velocity)>.1||override)){(override||velocity)>0?decSlide():incSlide()}else{let currentSlide=Math.clamp(Math.round(-_object[_axis]/_this[_side]),0,_this.maxSlides-1);if(currentSlide!==_this.currentSlide){_this.currentSlide;_this.currentSlide=currentSlide,onUpdateSlide(_this.currentSlide)}}target[_axis]=-_this[_side]*_this.currentSlide,_dragging=!1,tweenObj(target),_this.events.fire(Interaction.Slider.END_INTERACTION,null,!0)}}this.autoRender=!0,this.currentSlide=0,this.maxSlides=_config.slides,this.width=_config.width,this.height=_config.height,this.snapPoint=.3,this.ease="easeOutCubic",this.easeTime=500,this.friction=.3,this.infinite=!1,this.desktopDrag="boolean"!=typeof _config.desktopDrag||_config.desktopDrag,this.preventMovement=!1,this.cssTransitions=!1,this.multiplier=1,this.elapsed=0,this.interpolate=!1,function initHelpers(){if(RenderManager.type==RenderManager.VR)_input=_this.initClass(JoystickInteraction,{hit:_config.vrHit||_config.hit||_object,hitCamera:_config.hitCamera});else{let object=_config.hit||_object;object instanceof GLUIObject&&(_hitObject=object,object=Stage),_input=_this.initClass(Interaction,object)}_this.events.sub(_input,Interaction.MOVE,inputUpdate),_this.events.sub(_input,Interaction.START,inputStart),_this.events.sub(_input,Interaction.END,inputEnd),_this.input=_input,_values={},_renderer=_config.renderer||_this.initClass(Interaction.Renderer,_object)}(),function initDirection(){_side=_direction.x?"width":"height",_axis=_direction.x?"x":"y"}(),_this.startRender(loop),this.set("views",(function(v){_views=v})),this.set("lockMove",(function(v){_lockMove=v})),this.lockDirection=function(move=50){_lockMove=move,_this.events.unsub(_input,Interaction.START,inputStart),_this.events.sub(_input,Interaction.START,lockStart),_this.events.sub(_input,Interaction.MOVE,lockMove),_this.events.sub(_input,Interaction.END,lockEnd)},this.moveTo=function(slide){_this.infinite||(slide<0&&(slide=0),slide>=_this.maxSlides&&(slide=_this.maxSlides-1)),_this.currentSlide=slide;var target={};target[_axis]=-_this[_side]*_this.currentSlide,tweenObj(target),onUpdateSlide(_this.currentSlide)},this.jumpTo=function(slide){_this.infinite||(slide<0&&(slide=0),slide>=_this.maxSlides&&(slide=_this.maxSlides-1)),_this.currentSlide=slide,_values[_axis]=-_this[_side]*_this.currentSlide,copyFromTo(_values,_object),_this.autoRender&&_renderer.needsUpdate&&(_object.pos[_axis]=_object[_axis],_renderer.update()),onUpdateSlide(_this.currentSlide)},this.next=function(){incSlide();var target={};target[_axis]=-_this[_side]*_this.currentSlide,tweenObj(target)},this.prev=function(){decSlide();var target={};target[_axis]=-_this[_side]*_this.currentSlide,tweenObj(target)},this.clearTween=function(){clearTween(_values)},this.onInvisible=function(){_this.preventVisible=!0},this.onVisible=function(){_this.preventVisible=!1},this.addInput=function(x=0,y=0){if(!_this.flag("preventInput")&&(_addInput||((_addInput={}).delta={}),_addInput.delta.x=x,_addInput.delta.y=y,_addInput.total||(_addInput.total=0),inputUpdate(_addInput,_addInput.delta,!0),Math.abs(_object[_axis])>.2*Math.abs(_this[_side]))){let val=Math.abs(y)>Math.abs(x)?y:x;_this.moveTo(_this.currentSlide+Math.sign(val)),_this.flag("preventInput",!0,_this.easeTime)}}}),(_=>{Interaction.Slider.OVERRIDE_LOCK="slider_override_lock",Interaction.Slider.UPDATE="slider_update",Interaction.Slider.START_INTERACTION="slider_start_interaction",Interaction.Slider.END_INTERACTION="slider_end_interaction"})),Class((function GLA11y(){Inherit(this,Element);const _this=this;var $this,_groups=[],_links=[];function isVisible(group){if(group.__glseoParent){const seoHidden=!!group.__glseoParent.seoHidden,hidden=!!group.__glseoParent.hidden;return!seoHidden&&!hidden}return group.seo.enabled&&group.determineVisible()}function isDeleted(group){return group.__glseoParent?group.__glseoParent.deleted:group.deleted}function loop(){for(let i=_groups.length-1;i>-1;i--){let group=_groups[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?(group.seo&&group.seo.hidden&&(group.seo.hidden=!1,$this.add(group.seo)),seo=group.seo,Array.prototype.slice.call(seo.div.children).forEach((div=>{let seo=div.hydraObject,group=seo&&seo.group;if(!seo||!group)return;let hidden=!group.determineVisible();hidden!==seo.hidden&&(hidden?seo.hide():seo.show(),seo.hidden=hidden)}))):group.seo&&!group.seo.hidden&&(group.seo.hidden=!0,$this.removeChild(group.seo,!0))}var seo;for(let i=_links.length-1;i>-1;i--){let group=_links[i];if(isDeleted(group))return $this.removeChild(group.seo),_groups.splice(i,1);isVisible(group)?group.seoHidden&&(group.seoHidden=!1,group.seoDOM.forEach((obj=>obj.show()))):group.seoHidden||(group.seoHidden=!0,group.seoDOM.forEach((obj=>obj.hide())))}}function aLink($object,url,label,options={}){let seo=$("link","a");return seo.group=$object.group,seo.attr("href","#"===url?url:Hydra.absolutePath(url)),seo.text(label),seo.accessible(),seo.div.onfocus=_=>$object._divFocus(),seo.div.onblur=_=>$object._divBlur(),seo.div.onclick=e=>{e.preventDefault(),$object._divSelect()},options.role&&(seo.attr("role",options.role),seo.div.onkeydown=e=>{switch(e.key){case" ":case"Spacebar":e.preventDefault(),e.stopPropagation(),$object._divSelect()}}),seo}!async function(){window.GLSEO=_this,await Hydra.ready(),function initHTML(){($this=_this.element).setZ(-1),Stage.add($this)}(),HydraCSS.style(".GLA11y *",{position:"relative"})}(),this.registerPage=function(group,name){let topLevel=group;!(group=group instanceof GLUIObject?group:group.group||group.scene||group).determineVisible&&group.group&&(group.determineVisible=group.group.determineVisible.bind(group.group)),Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$(name),group.seo.hidden=!0,group.seo.enabled=!0;let remove=group.seo.remove.bind(group.seo);group.seo.remove=_=>{_groups.remove(group),remove()},_groups.push(group),_this.startRender(loop,10)},this.setPageH1=function(group,title){let $h1=group.seo.h1;$h1||($h1=group.seo.create("title","h1"),defer((()=>{let el=$h1.div;el.parentNode.insertBefore(el,el.parentNode.firstChild)}))),$h1.text(title)},this.registerPersist=function(group,name){let topLevel=group;group=group instanceof GLUIObject?group:group.group||group.scene||group,Global.PLAYGROUND||World.ELEMENT.mouseEnabled(!1),topLevel.seo=group.seo=$this.create(name)},this.link=function($dom,group){$dom instanceof HydraObject&&((group=group.group||group.scene||group).seoDOM||(group.seoDOM=[]),group.seoDOM.push($dom),_links.push(group)),$dom instanceof GLUIObject&&($dom.seo=group.seo)},this.textNode=function($text,text){let parent=($text._3d?$text.anchor||$text.group:$text)._parent;if($text.parentSeo){let parentSeo=$text.parentSeo;parent=parentSeo.group&&parentSeo.group.seo?parentSeo.group:parentSeo}else if(parent)for(;parent&&!parent.seo;)parent=parent._parent;parent&&parent.seo&&($text.seo?($text.seo.text(text),$text.seo.accessible()):($text.seo=$("text"),$text.seo.group=$text.group,$text.seo.text(text),$text.seo.accessible(),parent.seo.add($text.seo),$text.seo.aLink=function(url,options){let index=Array.prototype.slice.call(parent.seo.div.children).indexOf($text.seo.div);$text.seo.remove(),$text.seo=aLink($text,url,text,options),parent.seo.div.insertBefore($text.seo.div,parent.seo.div.children[index])},$text.seo.unlink=function(){parent.seo.div.removeChild($text.seo.div),$text.seo.group=null,$text.seo=null}))},this.bindToPage=function(parent,child,name){child.__glseoParent=parent,_this.registerPage(child,name)},this.objectNode=function($object,$parent){let parent=$parent||($object._3d?$object.group:$object)._parent;if($object.parentSeo)parent=$object.parentSeo.group||$object.parentSeo;else{if(!parent)return;for(;parent&&!parent.seo;)parent=parent._parent}parent&&parent.seo&&($object.seo||($object.seo={},$object.seo.group=$object.group,$object.seo.aLink=function(url,label,options){let index=Array.prototype.slice.call(parent.seo.div.children).indexOf($object.seo.div);$object.seo=aLink($object,url,label,options),parent.seo.div.insertBefore($object.seo.div,parent.seo.div.children[index]),$object.seo.unlink=function(){parent.seo.div.removeChild($object.seo.div),$object.seo.group=null,$object.seo=null}}))}}),"static"),Class((function GlassShader(_mesh,_shader){_shader||(_shader=_mesh),_shader.addUniforms({tEnv:{value:null},uRefractionRatio:{value:1},uReflectScale:{value:1},uEnvBlend:{value:1},uRatio:{value:.5},uAttenuation:{value:.5},uAlpha:{value:1},uShininess:{value:1},uFresnelPow:{value:1},uFresnelAlpha:{value:1},uDistortStrength:{value:1},uSpecAdd:{value:new Vector2(1,0)},uPhongColor:{value:new Color},uFresnelColor:{value:new Color},uLightDir:{value:new Vector3(0,0,1)},uTransparent:{value:1}})})),Class((function GLScreenProjection(_camera=World.CAMERA,_target=new Vector2){Inherit(this,Object3D);var _this=this,_projection=new ScreenProjection(_camera),_m0=new Matrix4,_m1=new Matrix4;function loop(){_this.pos.set(_target.x,_target.y),_this.pos3D.copy(_projection.unproject(_this.pos)),_this.group.updateMatrixWorld(),_m0.copy(_camera.projectionMatrix),_m1.getInverse(_camera.matrixWorld),_this.matrix.multiplyMatrices(_m0,_m1),_this.uniforms.normalMatrix.value.copy(_camera.matrixWorld),_this.uniforms.modelMatrix.value.copy(_this.group.matrixWorld)}this.resolution=new Vector2,this.pos=new Vector2,this.pos3D=new Vector3,this.matrix=new Matrix4,this.uniforms={projMatrix:{type:"m4",value:this.matrix},pos:{type:"v2",value:this.pos},pos3D:{type:"v3",value:this.pos3D},normalMatrix:{type:"m4",value:new Matrix4},modelMatrix:{type:"m4",value:new Matrix4}},this.set("camera",(v=>{_camera=v,_projection.camera=_camera})),this.set("target",(v=>{_target=v})),this.update=loop,this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)}})),Class((function GLText({font:font,italic:italic=!1,bold:bold=!1,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,paragraphSpacing:paragraphSpacing=1,color:color=new Color("#000000"),alpha:alpha=1,shader:shader="DefaultText",customCompile:customCompile=!1}){const _this=this;var _override,_promise=Promise.create();const config=GLText.FONT_CONFIG[font];function overrideParams(){if(GLText.overrideParams){_override={letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight};let obj=GLText.overrideParams({letterSpacing:letterSpacing,size:size,wordSpacing:wordSpacing,lineHeight:lineHeight});letterSpacing=obj.letterSpacing,size=obj.size,wordSpacing=obj.wordSpacing,lineHeight=obj.lineHeight}}function resetOverride(){_override&&(letterSpacing=_override.letterSpacing,size=_override.size,wordSpacing=_override.wordSpacing,lineHeight=_override.lineHeight)}!function init(){overrideParams(),_this.charLength=text.length,_this.text=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config}),_this.string=text,resetOverride(),_this.text.loaded.then((({buffers:buffers,image:image,imageBold:imageBold,imageItalic:imageItalic,height:height,numLines:numLines})=>{_this.texture=GLText.getTexture(image),bold&&(_this.textureBold=GLText.getTexture(imageBold)),italic&&(_this.textureItalic=GLText.getTexture(imageItalic)),_this.shader=new Shader(shader,{tMap:{value:_this.texture,ignoreUIL:!0},tMapBold:{value:_this.textureBold||Utils3D.getEmptyTexture(),ignoreUIL:!0},tMapItalic:{value:_this.textureItalic||Utils3D.getEmptyTexture(),ignoreUIL:!0},uColor:{value:color,ignoreUIL:!0},uAlpha:{value:alpha,ignoreUIL:!0},transparent:!0,customCompile:customCompile}),_this.onCreateShader&&_this.onCreateShader(_this.shader),function createGeometry(buffers){_this.geometry=new Geometry,_this.geometry.addAttribute("position",new GeometryAttribute(buffers.position,3)),_this.geometry.addAttribute("uv",new GeometryAttribute(buffers.uv,2)),_this.geometry.addAttribute("animation",new GeometryAttribute(buffers.animation,3)),_this.geometry.addAttribute("weight",new GeometryAttribute(buffers.weight,1)),_this.geometry.setIndex(new GeometryAttribute(buffers.index,1)),_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.mesh=new Mesh(_this.geometry,_this.shader),_this.height=height,_promise.resolve()}))}(),void 0===font&&console.log(font,text),this.destroy=function(){_this.mesh&&_this.mesh.destroy&&_this.mesh.destroy()},this.ready=this.loaded=function(){return _promise},this.centerY=function(){_this.mesh.position.y=.5*_this.height,_this.needsCenterY=!0},this.resize=function(options){return this.setText(text,options)},this.tweenColor=function(c,time=300,ease="easeOutCubic"){c&&color.tween(c,time,ease)},this.setColor=function(c){c&&color.set(c)},this.setText=function(txt,options){if((text!=txt||!function match(options){return!options||options.font==font&&options.italic==italic&&options.bold==bold&&options.width==width&&options.align==align&&options.direction==direction&&!(options.wordSpacing>0&&options.wordSpacing!=wordSpacing)&&options.letterSpacing==letterSpacing&&options.paragraphSpacing==paragraphSpacing&&options.size==size&&options.lineHeight==lineHeight&&!(!0===options.wordBreak&&!options.wordBreak||0==options.wordBreak&&options.wordBreak)}(options))&&(text=txt))return function setVars(options){font=options.font||font,bold=options.bold||bold,italic=options.italic||italic,width=options.width||width,align=options.align||align,wordSpacing=options.wordSpacing||wordSpacing,letterSpacing=options.letterSpacing||letterSpacing,paragraphSpacing=options.paragraphSpacing||paragraphSpacing,size=options.size||size,lineHeight=options.lineHeight||lineHeight,wordBreak=options.wordBreak||wordBreak,langBreak=options.langBreak||langBreak,direction=options.direction||direction}(options||{}),overrideParams(),_this.string=text,_this.charLength=text.length,_this.text=new GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,config:config}),resetOverride(),_promise=Promise.create(),_this.text.loaded.then((({buffers:buffers,image:image,imageBold:imageBold,imageItalic:imageItalic,height:height,numLines:numLines})=>{!function updateGeometry(buffers){_this.geometry.attributes.position.setArray(buffers.position),_this.geometry.attributes.uv.setArray(buffers.uv),_this.geometry.attributes.animation.setArray(buffers.animation),_this.geometry.attributes.weight.setArray(buffers.weight),_this.geometry.index=buffers.index,_this.geometry.indexNeedsUpdate=!0,_this.geometry.boundingBox=buffers.boundingBox,_this.geometry.boundingSphere=buffers.boundingSphere,_this.geometry.letterCount=buffers.letterCount+1,_this.geometry.wordCount=buffers.wordCount+1,_this.geometry.lineCount=buffers.lineCount+1}(buffers),_this.height=height,_this.needsCenterY&&_this.centerY(),_promise.resolve()})),_promise},this.getData=function(){return{font:font,italic:italic,bold:bold,text:text,width:width,align:align,direction:direction,wordSpacing:wordSpacing,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,size:size,lineHeight:lineHeight,wordBreak:wordBreak,langBreak:langBreak,color:color}}}),(_=>{GLText.FONT_CONFIG={};var _map=new Map;GLText.getTexture=function(image){if(!_map.get(image)){let texture=new Texture(image);texture.generateMipmaps=!1,texture.minFilter=Texture.LINEAR,_map.set(image,texture)}return _map.get(image)}})),Class((function GLTextGeometry({font:font,italic:italic,bold:bold,text:text,width:width=1/0,align:align="left",size:size=1,direction:direction="ltr",letterSpacing:letterSpacing=0,paragraphSpacing:paragraphSpacing=1,lineHeight:lineHeight=1.4,wordSpacing:wordSpacing=0,wordBreak:wordBreak=!1,langBreak:langBreak=!1,config:config={}}){let json,image,glyphs,bJson,bImage,bGlyphs,iJson,iImage,iGlyphs,_this=this;_this.loaded=Promise.create(),_this.fontLoaded=Promise.create(),async function init(){await async function loadFont(){[json,image,glyphs]=await GLTextGeometry.loadFont(font),bold&&([bJson,bImage,bGlyphs]=await GLTextGeometry.loadFont(bold));italic&&([iJson,iImage,iGlyphs]=await GLTextGeometry.loadFont(italic));_this.fontLoaded.resolve()}(),async function createGeometry(){let buffers=await GLTextThread.generate({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,config:config});_this.buffers=buffers,_this.image=image,_this.imageBold=bImage,_this.imageItalic=iImage,_this.numLines=buffers.lineLength,_this.height=_this.numLines*size*lineHeight,_this.onLayout&&_this.onLayout(buffers,image,_this.height,_this.numLines),_this.loaded.resolve({buffers:buffers,image:image,imageBold:bImage,imageItalic:iImage,height:_this.height,numLines:_this.numLines})}()}()}),(_=>{async function loadJSON(font){return await get(getPathTo(font,"json"))}async function loadImage(font){return await new Promise((resolve=>{let img=new Image;img.onload=()=>resolve(img),img.crossOrigin="anonymous",img.src=getPathTo(font,"png")}))}function getPathTo(font,ext){let mapped=!1,fontName=function(){for(let key in GLTextGeometry.fontMapping){let mapping=GLTextGeometry.fontMapping[key];if(key==font)return mapped=!0,mapping}return font}(),path=mapped&&GLTextGeometry.fontPath?GLTextGeometry.fontPath:"assets/fonts/";return Assets.getPath(path+fontName+"."+ext+`?${window._CACHE_||Date.now()}`)}let _promises={};GLTextGeometry.fontMapping={},GLTextGeometry.chars={},GLTextGeometry.loadFont=function(font){if(!_promises[font]){let promise=Promise.create();_promises[font]=promise,async function(){let[json,image]=await Promise.all([loadJSON(font),loadImage(font)]);glyphs={},json.chars.forEach((d=>glyphs[d.char]=d)),promise.resolve([json,image,glyphs]),GLTextGeometry.chars[font]=json.chars}()}return _promises[font]}})),Class((function GLTextThread(){function loadTextGeometry({font:font,bold:bold,italic:italic,text:text,width:width,align:align,size:size,direction:direction,letterSpacing:letterSpacing,paragraphSpacing:paragraphSpacing,lineHeight:lineHeight,wordSpacing:wordSpacing,wordBreak:wordBreak,langBreak:langBreak,json:json,glyphs:glyphs,bJson:bJson,bGlyphs:bGlyphs,iJson:iJson,iGlyphs:iGlyphs,config:config},pid){const newline=/\n/,whitespace=/\s/,langbreak=!!langBreak&&new RegExp(langBreak),dir="rtl"===direction?-1:1;config||(config={}),config.boldBaseOffset=config.boldBaseOffset?config.boldBaseOffset:0,config.italicBaseOffset=config.italicBaseOffset?config.italicBaseOffset:0;let weights=[],weight={0:glyphs,1:bGlyphs,2:iGlyphs};var buffers;function getKernPairOffset(id1,id2){for(let i=0;i<json.kernings.length;i++){let k=json.kernings[i];if(!(k.first<id1)&&!(k.second<id2))return k.first>id1||k.first===id1&&k.second>id2?0:k.amount}return 0}!function setWeights(){let i=0,w=0;for(;i<text.length;){let code=text.substring(i,i+3).toLowerCase(),endcode=text.substring(i,i+4).toLowerCase();"<b>"!==code&&"<i>"!==code||(w="<b>"===code?1:2,text=text.substr(0,i)+text.substr(i+3)),"</b>"!==endcode&&"</i>"!==endcode||(w=0,text=text.substr(0,i)+text.substr(i+4)),weights.push(w),i++}}(),function createGeometry(){fontHeight=json.common.lineHeight,baseline=json.common.base,scale=size/baseline;let numChars=text.replace(/[ \n]/g,"").length;buffers={position:new Float32Array(4*numChars*3),uv:new Float32Array(4*numChars*2),animation:new Float32Array(3*numChars*4),index:new Uint16Array(6*numChars),weight:new Float32Array(4*numChars)};for(let i=0;i<numChars;i++)buffers.index.set([4*i,4*i+2,4*i+1,4*i+1,4*i+2,4*i+3],6*i);!function layout(){const lines=[];let cursor=0,wordCursor=0,wordWidth=0,line=newLine();function newLine(br=!1){const line={width:0,glyphs:[]};return lines.last()&&(lines.last().br=br),lines.push(line),wordCursor=cursor,wordWidth=0,line}for(;cursor<text.length;){let prev=text[cursor-1],char=text[cursor];text[cursor+1];if(!line.width&&whitespace.test(char)&&!(prev&&newline.test(char)&&newline.test(prev))){cursor++,wordCursor=cursor,wordWidth=0;continue}if(newline.test(char)){cursor++,line=newLine(!0);continue}let style=weight[weights[cursor]]||weight[0],glyph=style[char];glyph||(console.warn(`font ${font} missing character '${char}'`),char=Object.keys(style)[0],glyph=style[char]),glyph.weight=weights[cursor];let charScale=glyph.scale?glyph.scale:1;if(line.glyphs.length){const prevGlyph=line.glyphs[line.glyphs.length-1][0];let kern=getKernPairOffset(glyph.id,prevGlyph.id)*scale;line.width+=kern,wordWidth+=kern*dir}let gl=Object.assign({},glyph);gl.weight=weights[cursor],line.glyphs.push([gl,line.width]);let advance=0;if(whitespace.test(char)?(gl.whitespace=!0,wordCursor=cursor,wordWidth=0,advance+=wordSpacing*size):advance+=letterSpacing*size,advance+=glyph.xadvance*scale*charScale,line.width+=advance,wordWidth+=advance,line.width>width){if((wordBreak||char&&langBreak&&!langbreak.test(char))&&line.glyphs.length>1){line.width-=advance,line.glyphs.pop(),line=newLine();continue}if(!wordBreak&&wordWidth!==line.width){let numGlyphs=cursor-wordCursor+1;line.glyphs.splice(-numGlyphs,numGlyphs),cursor=wordCursor,line.width-=wordWidth,line=newLine();continue}}cursor++}line.width||lines.pop();if("justify"===align){let max=-1/0;lines.forEach((l=>{l.whitespaces=0,max<l.width&&(max=l.width),l.glyphs.forEach((g=>{g[0].whitespace&&l.whitespaces++}))})),lines.forEach((l=>{let totalToAdd=max-l.width,addToWhitespace=0===l.whitespaces?0:totalToAdd/l.whitespaces;l.width=max;let additionalOffset=0;l.glyphs.forEach((g=>{g[1]+=additionalOffset,g[0].whitespace&&(additionalOffset+=addToWhitespace)}))}))}!function populateBuffers(lines){const texW=json.common.scaleW,texH=json.common.scaleH;let geom,y=(config.baseOffset?config.baseOffset:.07)*size,j=0,glyphIndex=0,wordIndex=-1,lineId=-1;for(let lineIndex=0;lineIndex<lines.length;lineIndex++){let line=lines[lineIndex];wordIndex++,lineId++;for(let i=0;i<line.glyphs.length;i++){const glyph=line.glyphs[i][0];let x=line.glyphs[i][1];if(-1===dir&&(x=line.width-x),"center"===align||"justify"===align?x-=.5*line.width:"right"===align&&(x-=line.width*dir),whitespace.test(glyph.char)){wordIndex++;continue}let charScale=glyph.scale?glyph.scale:1;1===glyph.weight&&(y+=config.boldBaseOffset*scale),2===glyph.weight&&(y+=config.italicBaseOffset*scale),x+=glyph.xoffset*scale*dir*charScale,y-=glyph.yoffset*scale*charScale,buffers.weight.set([glyph.weight,glyph.weight,glyph.weight,glyph.weight],4*glyphIndex);let w=glyph.width*scale*charScale,h=glyph.height*scale*charScale;-1===dir?buffers.position.set([x-w,y-h,0,x-w,y,0,x,y-h,0,x,y,0],4*j*3):buffers.position.set([x,y-h,0,x,y,0,x+w,y-h,0,x+w,y,0],4*j*3),buffers.animation.set([glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId,glyphIndex,wordIndex,lineId],3*glyphIndex*4),glyphIndex++;let u=glyph.x/texW,uw=glyph.width/texW,v=1-glyph.y/texH,vh=glyph.height/texH;buffers.uv.set([u,v-vh,u,v,u+uw,v-vh,u+uw,v],4*j*2),1===glyph.weight&&(y-=config.boldBaseOffset*scale),2===glyph.weight&&(y-=config.italicBaseOffset*scale),y+=glyph.yoffset*scale*charScale,j++}y-=size*lineHeight*(line.br?paragraphSpacing:1)}window.zUtils3D&&(geom=new Geometry,geom.addAttribute("position",new GeometryAttribute(buffers.position,3)),geom.computeBoundingBox());let backing=[];for(let key in buffers)backing.push(buffers[key].buffer);buffers.lineLength=lines.length,geom&&(buffers.boundingBox=geom.boundingBox,buffers.boundingSphere=geom.boundingSphere);buffers.letterCount=glyphIndex,buffers.lineCount=lineId,buffers.wordCount=wordIndex,resolve(buffers,pid,backing)}(lines)}()}()}Thread.upload(loadTextGeometry),this.generate=async function(obj){return Thread.shared().loadTextGeometry(obj)}}),"static"),Class((function GLUI(){Inherit(this,Component);const _this=this,hasMetal=!!window.Metal,hasAuraAR=!!window.AURA_AR;function loop(){hasMetal||(hasAuraAR&&AURA_AR.active&&(World.NUKE.postRender=null,AURA_AR.postRender=loop),_this.Scene&&_this.Scene.render(),_this.Stage&&_this.Stage.render())}window.$gl=function(width,height,map,customCompile){return new GLUIObject(width,height,map,customCompile)},window.$glText=function(text,fontName,fontSize,options,customCompile){return new GLUIText(text,fontName,fontSize,options,customCompile)},this.init=async function(is2D,is3D){_this.initialized||(void 0===is2D&&(is2D=!0,is3D=!0),await AssetLoader.waitForLib("zUtils3D"),is2D&&(_this.Stage=new GLUIStage),is3D&&(_this.Scene=new GLUIStage3D,_this.Scene.interaction.input=Mouse),_this.wait(World,"NUKE",(_=>{_this.initialized=!0,_this.Scene&&(World.NUKE.onBeforeRender=_this.Scene.mark),World.NUKE.postRender=loop})))},this.clear=function(){_this.Stage.clear(),_this.Scene.clear()},this.ready=function(){return _this.wait(_this,"initialized")},this.renderDirect=function(render){_this.Scene&&_this.Scene.renderDirect(render),_this.Stage&&_this.Stage.renderDirect(render)}}),"static"),Class((function GLUIElement(){Inherit(this,Component);this.element=$gl(),this.create=function(w,h,t){return this.element.create(w,h,t)}})),Class((function GLUIUtils(){const _this=this;_this.setRetinaMode=function($obj,retinaMode,parent){if(RenderManager.type===RenderManager.WEBVR&&(retinaMode=!1),parent||(parent=$obj.anchor&&$obj.anchor._parent||$obj.group._parent))if(retinaMode){let gluiToRTScene,p=parent;for(;p;)p.glSceneEnabled&&(gluiToRTScene=p),p=p.parent;gluiToRTScene?gluiToRTScene.glScene.add($obj):GLUI.Scene.add($obj),parent.add($obj.anchor),$obj.anchor.retinaAnchorFor=$obj,$obj.group.asyncPromise&&!$obj.anchor.asyncPromise&&($obj.anchor.asyncPromise=$obj.group.asyncPromise),1===$obj.scaleX&&1===$obj.scaleY||($obj.isDirty=!0,$obj.mesh&&$obj.mesh.onBeforeRender&&$obj.mesh.onBeforeRender())}else _this.isRetinaMode($obj)&&(parent.remove($obj.anchor),GLUI.Scene.remove($obj),$obj.anchor._parent=null,$obj.group.visible=parent.determineVisible(),"boolean"==typeof $obj.isDirty&&$obj.mesh&&$obj.mesh.onBeforeRender?($obj.isDirty=!0,$obj.mesh.onBeforeRender()):($obj.group.position.setScalar(0),$obj.group.quaternion.set(0,0,0,1),$obj.group.scale.setScalar(1)),$obj.deferred=!1,$obj.parent=null),parent.add($obj.group)},_this.isRetinaMode=function($obj){return RenderManager.type!==RenderManager.WEBVR&&$obj.anchor&&$obj.anchor._parent&&$obj.parent===GLUI.Scene}}),"static"),Class((function GLUIBatch(globalUniforms={},_useWorldCoords){Inherit(this,Component);const _this=this;var _timer,_geometry,_shader,_objects=[];function loop(){if(_geometry)for(let i=0;i<_objects.length;i++){let obj=_objects[i];obj._buffers&&(obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale)),obj._buffers.forEach((buffer=>{let dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let attribute=_geometry.attributes[buffer.key],array=attribute.array;switch(buffer.key){case"scale":_useWorldCoords?(array[2*i+0]=obj.worldScale.x,array[2*i+1]=obj.worldScale.y):(array[2*i+0]=obj.group.scale.x*obj.mesh.scale.x,array[2*i+1]=obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":array[i]=buffer.lookup.z;break;default:_useWorldCoords?(array[3*i+0]=obj.worldPosition.x,array[3*i+1]=obj.worldPosition.y):(array[3*i+0]=obj.group.position.x,array[3*i+1]=obj.group.position.y),array[3*i+2]=obj.mesh.renderOrder}attribute.needsUpdate=!0}})),obj._uniforms.forEach((uniform=>{let dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty){let attribute=_geometry.attributes["a_"+uniform.key],array=attribute.array;"f"==uniform.type?array[i]=uniform.value:uniform.value.toArray(array,i*uniform.components),attribute.needsUpdate=!0}})))}}function getTypeFromSize(size){switch(size){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}}function createMesh(){let shader=_objects[0].mesh.shader;_geometry=(new Geometry).instanceFrom(_objects[0].mesh.geometry.clone());let map={},arrays={};_objects.forEach(((obj,i)=>{obj.mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform&&(uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1}))}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),uniforms.forEach((uniform=>{arrays["a_"+uniform.key]||(arrays["a_"+uniform.key]=[]),map["a_"+uniform.key]||(map["a_"+uniform.key]=uniform);let value=shader.uniforms[uniform.key].value;"object"==typeof value?(uniform.value=value.clone(),uniform.value.toArray(arrays["a_"+uniform.key],i*uniform.components)):(uniform.value=shader.uniforms[uniform.key].value,arrays["a_"+uniform.key].push(uniform.value))})),buffers.forEach((buffer=>{switch(arrays[buffer.key]||(arrays[buffer.key]=[]),map[buffer.key]||(map[buffer.key]=buffer),buffer.value=buffer.lookup.clone(),buffer.key){case"scale":arrays[buffer.key].push(obj.group.scale.x*obj.mesh.scale.x,obj.group.scale.y*obj.mesh.scale.y);break;case"rotation":arrays[buffer.key].push(buffer.lookup.z);break;default:arrays[buffer.key].push(buffer.lookup.x,buffer.lookup.y,obj.mesh.renderOrder)}})),obj._buffers=buffers,obj._uniforms=uniforms,obj.shader.neverRender=!0}));let attributes=[],defines=[];for(let key in map)key.includes("a_")&&(attributes.push(`% ${getTypeFromSize(map[key].components)} ${key};`),defines.push(`${key.replace("a_","v_")} = ${key};`));attributes=attributes.join("\n"),defines=defines.join("\n");for(let key in arrays)_geometry.addAttribute(key,new GeometryAttribute(new Float32Array(arrays[key]),map[key].components,1));if(GLUIBatch.cache[shader.fsName])_shader=GLUIBatch.cache[shader.fsName];else{let vsSplit=(_shader=_this.initClass(Shader,"GLUIBatch",shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,depthTest:!1},globalUniforms))).vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[];fsSplit[1].split("\n").forEach((line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}})),vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),GLUIBatch.cache[shader.fsName]=_shader}shader.copyUniformsTo(_shader),_this.mesh=new Mesh(_geometry,_shader),_this.mesh.frustumCulled=!1,_this.group.add(_this.mesh)}this.group=new Group,"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),GLUIBatch.cache||(GLUIBatch.cache={}),_this.startRender(loop),this.add=function(obj){if(clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent.add(obj);_objects.push(obj)},this.setZ=async function(z){await _this.wait("mesh"),_this.mesh.renderOrder=z},this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}})),Class((function GLUIBatchText(globalUniforms={},_useWorldCoords){Inherit(this,Component);const _this=this;var _geometry,_shader,_timer,_forceUpdate,_promises=[],_toSplice=[],_objects=[],_offset=0;function loop(){if(!_geometry)return;let updated=!1;for(let key in _geometry.attributes){let attrib=_geometry.attributes[key];attrib.updateRange.length&&(attrib.updateRange.length=0)}let len=_objects.length;for(let i=0;i<len;i++){let obj=_objects[i];obj.mesh.onBeforeRender(),_useWorldCoords&&(obj.group.updateMatrixWorld(),obj.mesh.getWorldPosition(obj.worldPosition),obj.worldRotation.setFromQuaternion(obj.mesh.getWorldQuaternion()),obj.mesh.getWorldScale(obj.worldScale));let offset=obj._offset,count=obj._count,end=offset+count;obj._buffers.forEach((buffer=>{let dirty=!1;if(dirty=!buffer.value.equals(buffer.lookup),buffer.value.copy(buffer.lookup),dirty){let array=_geometry.attributes[buffer.key].array;for(let j=offset;j<end;j++)switch(buffer.components){case 4:array[4*j+0]=buffer.lookup.x,array[4*j+1]=buffer.lookup.y,array[4*j+2]=buffer.lookup.z,array[4*j+3]=buffer.lookup.w;break;case 3:array[3*j+0]=buffer.lookup.x,array[3*j+1]=buffer.lookup.y,array[3*j+2]=buffer.lookup.z;break;case 2:array[2*j+0]=buffer.lookup.x,array[2*j+1]=buffer.lookup.y;break;case 1:array[j]=buffer.lookup.z}updated=!0,buffer.updateRange.offset=offset*buffer.components,buffer.updateRange.count=count*buffer.components,_geometry.attributes[buffer.key].updateRange.push(buffer.updateRange),_geometry.attributes[buffer.key].needsUpdate=!0}})),obj._uniforms.forEach((uniform=>{let dirty=!1;if("f"==uniform.type?(dirty=obj.mesh.shader.uniforms[uniform.key].value!=uniform.value,uniform.value=obj.mesh.shader.uniforms[uniform.key].value):(dirty=!obj.mesh.shader.uniforms[uniform.key].value.equals(uniform.value),uniform.value.copy(obj.mesh.shader.uniforms[uniform.key].value)),dirty||_forceUpdate){let array=_geometry.attributes["a_"+uniform.key].array;for(let j=offset;j<end;j++)"f"==uniform.type?array[j]=obj.mesh.shader.uniforms[uniform.key].value:obj.mesh.shader.uniforms[uniform.key].value.toArray(array,j*uniform.components);updated=!0,uniform.updateRange.offset=offset*uniform.components,uniform.updateRange.count=count*uniform.components,_geometry.attributes["a_"+uniform.key].updateRange.push(uniform.updateRange),_geometry.attributes["a_"+uniform.key].needsUpdate=!0}}))}if(updated)for(let key in _geometry.attributes){let bottom,attrib=_geometry.attributes[key];if(!attrib.updateRange.length)continue;let toSplice=_toSplice;toSplice.length=0;for(let i=0;i<attrib.updateRange.length;i++){let current=attrib.updateRange[i],prev=attrib.updateRange[i-1];prev?prev.offset+prev.count==current.offset?(bottom.count+=current.count,toSplice.push(i)):bottom=current:bottom=current}for(let i=toSplice.length-1;i>-1;i--)attrib.updateRange.splice(toSplice[i],1)}_forceUpdate=!1}async function createMesh(){if(_this.flag("mesh"))return;_this.flag("mesh",!0),await Promise.all(_promises),await _this.wait(100);let mesh=new Mesh(_geometry,_shader);_this.mesh=mesh,mesh.frustumCulled=!1,_this.group.add(mesh)}this.group=new Group,"boolean"==typeof globalUniforms&&(_useWorldCoords=globalUniforms,globalUniforms={}),_this.flag("canLoad",!0),_this.startRender(loop),_this.add=async function(obj){if(await _this.flag("canLoad"),_this.flag("canLoad",!1),await obj.loaded(),obj.mesh.shader.neverRender=!0,_promises.push(obj.loaded()),function addAttributes(obj,mesh){let{geometry:geometry,shader:shader}=mesh,count=geometry.attributes.uv.count;mesh.onBeforeRender();let buffers=[],uniforms=[];for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform.value instanceof Color&&uniforms.push({key:key,type:"c",components:3}),uniform.value instanceof Vector3&&uniforms.push({key:key,type:"v3",components:3}),uniform.value instanceof Vector4&&uniforms.push({key:key,type:"v4",components:4}),uniform.value instanceof Vector2&&uniforms.push({key:key,type:"v",components:2}),"number"==typeof uniform.value&&uniforms.push({key:key,type:"f",components:1})}_useWorldCoords&&(obj.worldScale=new Vector3,obj.worldRotation=new Euler,obj.worldPosition=new Vector3),buffers.push({key:"offset",lookup:_useWorldCoords?obj.worldPosition:obj.group.position,components:3}),buffers.push({key:"scale",lookup:_useWorldCoords?obj.worldScale:obj.group.scale,components:2}),buffers.push({key:"rotation",lookup:_useWorldCoords?obj.worldRotation:obj.group.rotation,components:1}),uniforms.forEach((uniform=>{uniform.updateRange={},uniform.value=shader.uniforms[uniform.key].value,"object"==typeof uniform.value&&(uniform.value=uniform.value.clone()),uniform.buffer=new Float32Array(count*uniform.components)})),buffers.forEach((buffer=>{buffer.updateRange={},buffer.value=buffer.lookup.clone(),buffer.buffer=new Float32Array(count*buffer.components)}));for(let i=0;i<count;i++)buffers.forEach((buffer=>{switch(buffer.components){case 4:buffer.buffer[4*i+0]=buffer.lookup.x,buffer.buffer[4*i+1]=buffer.lookup.y,buffer.buffer[4*i+2]=buffer.lookup.z,buffer.buffer[4*i+3]=buffer.lookup.w;break;case 3:buffer.buffer[3*i+0]=buffer.lookup.x,buffer.buffer[3*i+1]=buffer.lookup.y,buffer.buffer[3*i+2]=buffer.lookup.z;break;case 2:buffer.buffer[2*i+0]=buffer.lookup.x,buffer.buffer[2*i+1]=buffer.lookup.y;break;case 1:buffer.buffer[i]=buffer.lookup.z}})),uniforms.forEach((uniform=>{"f"==uniform.type?uniform.buffer[i]=shader.uniforms[uniform.key].value:shader.uniforms[uniform.key].value.toArray(uniform.buffer,i*uniform.components)}));buffers.forEach((buffer=>{geometry.addAttribute(buffer.key,new GeometryAttribute(buffer.buffer,buffer.components))})),uniforms.forEach((uniform=>{geometry.addAttribute("a_"+uniform.key,new GeometryAttribute(uniform.buffer,uniform.components))})),obj._offset=_offset,obj._count=count,obj._uniforms=uniforms,obj._buffers=buffers,_objects.push(obj),_offset+=count}(obj,obj.mesh),_useWorldCoords){let getAlpha=obj.getAlpha;getAlpha&&(obj.getAlpha=()=>(_this.parent?_this.parent.getAlpha():1)*getAlpha.call(obj))}else _this.parent.add(obj);_geometry?_geometry.merge(obj.mesh.geometry):function initGeometry(mesh){(_shader=_this.initClass(Shader,"GLUIBatchText",mesh.shader.fsName,Object.assign({},{transparent:!0,depthWrite:!1,customCompile:`${mesh.shader.vsName}|${mesh.shader.fsName}|instance`},globalUniforms))).vertexShader||_shader.resetProgram();let vsSplit=_shader.vertexShader.split("__ACTIVE_THEORY_LIGHTS__"),fsSplit=_shader.fragmentShader.split("__ACTIVE_THEORY_LIGHTS__"),definitions=[],definitionSplit=[];fsSplit[1].split("\n").forEach((line=>{if(line.includes("uniform")){if(line.includes("sampler2D"))return;let data=line.split(" ");definitions.push(`${data[2].replace(";","")} = a_${data[2]}`),vsSplit[1]=`\nattribute ${data[1]} a_${data[2]}\nvarying ${data[1]} ${data[2]}`+vsSplit[1],vsSplit[1]=vsSplit[1].replace(line,""),fsSplit[1]=fsSplit[1].replace(line,`varying ${data[1]} ${data[2]}`)}})),definitions.forEach((def=>definitionSplit.push(def.split(" =")[0].trim())));let baseVS=Shaders.getShader(mesh.shader.vsName+".vs");if(baseVS.includes("//start batch main")){let main=baseVS.split("//start batch main")[1].split("//end batch main")[0];vsSplit[1]=vsSplit[1].replace("//custommain",main);let beforeMain=baseVS.split("void main() {")[0];beforeMain=beforeMain.replace("uniform sampler2D tMap;",""),beforeMain=beforeMain.replace("varying vec2 vUv;",""),beforeMain.split("\n").forEach((line=>{definitionSplit.forEach((def=>{line.includes(def)&&line.includes(["uniform","varying"])&&(beforeMain=beforeMain.replace(line,""))}))})),vsSplit[0]+=beforeMain}vsSplit[1]=vsSplit[1].replace("//vdefines","\n"+definitions.join("\n")),_shader.vertexShader=vsSplit.join("__ACTIVE_THEORY_LIGHTS__"),_shader.fragmentShader=fsSplit.join("__ACTIVE_THEORY_LIGHTS__"),mesh.shader.copyUniformsTo(_shader),_geometry=mesh.geometry.clone();for(let key in _geometry.attributes)_geometry.attributes[key].updateRange=[]}(obj.mesh),_this.flag("canLoad",!0),clearTimeout(_timer),_timer=_this.delayedCall(createMesh,50),obj.isDirty=!0},_this.forceUpdate=function(){_forceUpdate=!0},_this.onDestroy=function(){_this.mesh&&_this.mesh.destroy()}})),Class((function GLUIStageInteraction2D(_camera,_scene,_stage,_custom){Inherit(this,Component);const _this=this;var _ray,_over,_click,_customTest,_disabled,_blocked,_test=[],_objects=this.objects=[],_hold=new Vector2,_lastTestedPoint=(new Vector2,new Vector2),_plane=new Plane;function cacheTopScene(obj){let p=obj;for(;p;)p instanceof Scene&&(obj.interactionScene=p),p=p._parent}function testObjects(){let objects=GLUI.Stage.interaction.objects;_test.length=0;for(let i=objects.length-1;i>-1;i--){let obj=objects[i];obj.interactionScene||cacheTopScene(obj),(obj.forceGLUIInteraction||obj.determineVisible()&&_scene==obj.interactionScene)&&_test.push(obj)}return _test}function externalStart(){_this._invisible||start(_lastTestedPoint)}function externalRelease(){_this._invisible||end(_lastTestedPoint)}function move(e){if(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)return;_ray||((_ray=new Raycaster(_camera)).testVisibility=!1);let objects=testObjects();if(!objects.length)return void(_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")));let hit=_ray.checkHit(objects,e,_stage);try{if(hit[0]){_customTest||(GLUI.HIT=!0);let obj=hit[0].object.glui;_over||((_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer")),_over!=obj&&(_over._onOver({action:"out",object:_over}),(_over=obj)._onOver({action:"over",object:obj}),Stage.cursor("pointer"))}else _customTest||(GLUI.HIT=!1),_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}function start(e){let handlingEvent=!(e instanceof Vector2),checkDefault=GLUI.PREVENT_DEFAULT_INTERACTION&&handlingEvent,checkPrevention=GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked;checkDefault||checkPrevention||(_custom&&handlingEvent||!Device.mobile&&RenderManager.type!=RenderManager.WEBVR||move(e),_over&&!_click&&(_click=_over,_hold.copy(e),_hold.time=Date.now()))}function end(e){if(!(GLUI.PREVENT_INTERACTION||_this._invisible||_disabled||_blocked)){if(_customTest&&Device.mobile&&_click&&null==_over&&(_over=_click),GLUI.HIT=!1,_click){if(Date.now()-_hold.time>750)return _click=null;if(_click==_over)try{_blocked=!0,_this.delayedCall((_=>{_blocked=!1}),_this.preventDoubleClickTime),_click._onClick({action:"click",object:_click}),(Device.mobile||_custom)&&_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}catch(e){console.warn(e)}}_click=null}}function findCapture(object){let capture=object.__slc;return void 0===capture?object.__slc=UI3D.findStageLayoutCapture(object)||null:capture}this.preventDoubleClickTime=300,function addListeners(){_custom||_this.events.sub(Mouse.input,Interaction.MOVE,move),_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end),_this.events.sub(Interaction3D.EXTERNAL_PRESS,externalStart),_this.events.sub(Interaction3D.EXTERNAL_RELEASE,externalRelease)}(),_this.startRender((_=>{})),this.add=function(obj){obj&&_objects.push(obj.mesh||obj)},this.remove=function(obj){obj&&_objects.remove(obj.mesh||obj)},this.testWith=function(point,id){point.customTest=!0,_lastTestedPoint.copy(point),_lastTestedPoint.customTest=!0,_customTest=!0,move(point),Device.mobile&&RenderManager.type!=RenderManager.WEBVR&&_over&&start(point)},this.testWithFinger=function(point,distance,minDistance){_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_customTest=!0;let objects=testObjects();if(objects.length)if(distance<.02){let hit=_ray.checkHit(objects,point,_stage);try{if(hit[0]){let obj=hit[0].object.glui;(!obj._preventClickTime||Render.TIME-obj._preventClickTime>_this.preventDoubleClickTime)&&(obj._requiresClear||(_over=obj,obj._onOver({action:"over",object:obj}),obj._onClick({action:"click",object:obj}),obj._preventClickTime=Render.TIME,obj._requiresClear=!0))}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)}catch(e){console.warn(e)}}else _over&&(_over._requiresClear=!1,_over._onOver({action:"out",object:_over}),_over=null)},this.checkObjectHit=function(object,mouse){let capture=findCapture(object);return capture?capture.checkObjectHit(object.mesh||object,mouse):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkHit(object.mesh||object,mouse,_stage)[0])},this.checkObjectFromValues=function(object,origin,direction){let capture=findCapture(object);return capture?capture.checkObjectFromValues(object.mesh||object,origin,direction):(_ray||((_ray=new Raycaster(_camera)).testVisibility=!1),_ray.checkFromValues(object.mesh||object,origin,direction)[0])},this.getObjectHitLocalCoords=function(v,object,mouse){let capture=findCapture(object);if(capture)return capture.getObjectHitLocalCoords(v,object,mouse);let hit=_this.checkObjectHit(object,mouse);if(hit)return v.copy(hit.point),hit.object.worldToLocal(v);{let mesh=object.mesh||object;return _plane.normal.set(0,0,1).applyQuaternion(mesh.getWorldQuaternion()),_plane.constant=-mesh.getWorldPosition().dot(_plane.normal),_ray.ray.intersectPlane(_plane,v),mesh.worldToLocal(v)}},this.set("_disabled",(v=>{(_disabled=v)&&(_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto")))})),this.onInvisible=()=>{_click=null,_over&&(_over._onOver({action:"out",object:_over}),_over=null,Stage.cursor("auto"))}})),Class((function GLUIStageInteraction3D(){Inherit(this,Component);function onHover(e){e.mesh.glui._onOver({action:e.action,object:e.mesh.glui})}function onClick(e){e.mesh.glui._onClick({action:e.action,object:e.mesh.glui})}this.add=function(obj,camera=World.CAMERA){Interaction3D.find(camera).add(obj.mesh||obj,onHover,onClick)},this.remove=function(obj,camera=World.CAMERA){Interaction3D.find(camera).remove(obj.mesh||obj)},this.checkObjectHit=function(object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectHit(object.mesh,mouse)},this.checkObjectFromValues=function(object,origin,direction,camera=World.CAMERA){return Interaction3D.find(camera).checkObjectFromValues(object.mesh,origin,direction)},this.getObjectHitLocalCoords=function(v,object,mouse,camera=World.CAMERA){return Interaction3D.find(camera).getObjectHitLocalCoords(v,object.mesh,mouse)}})),Class((function GLUICornerPin($obj){Inherit(this,Component);const _this=this;var _geom,_vertices,_last;function loop(){_vertices[0]=_this.tl.x,_vertices[1]=-_this.tl.y,_vertices[3]=_vertices[9]=_this.bl.x,_vertices[4]=_vertices[10]=-_this.bl.y,_vertices[6]=_vertices[15]=_this.tr.x,_vertices[7]=_vertices[16]=-_this.tr.y,_vertices[12]=_this.br.x,_vertices[13]=-_this.br.y,function dirty(){let a=_vertices,b=_last;for(let i=a.length-1;i>-1;i--)if(a[i]!=b[i])return!0;return!1}()&&(_geom.attributes.position.needsUpdate=!0),_last.set(_vertices)}this.tl=new Vector2(0,0),this.tr=new Vector2($obj.width,0),this.bl=new Vector2(0,$obj.height),this.br=new Vector2($obj.width,$obj.height),function initGeometry(){_geom=$obj.mesh.geometry.toNonIndexed(),$obj.useGeometry(_geom),$obj.mesh.scale.set(1,1,1),_vertices=_geom.attributes.position.array,_last=new Float32Array(_vertices)}(),_this.startRender(loop),this.update=function(){this.tl.set(0,0),this.tr.set($obj.width,0),this.bl.set(0,$obj.height),this.br.set($obj.width,$obj.height)},this.tween=function(type,val,time,ease,delay){return val=val instanceof Vector2?val:new Vector2(val.x,val.y),tween(_this[type],val,time,ease,delay)}}));class GLUIObject{constructor(width,height,map,customCompile){let shader=this.textureShader=new Shader("GLUIObject",{tMap:{value:null},uAlpha:{type:"f",value:1},transparent:!0,depthTest:!1,customCompile:customCompile});shader.persists=!0,map||(shader.visible=!1),this.usingMap=null!=map&&"empty"!=map&&""!=map,this.tMap=shader.uniforms.tMap,this.group=new Group,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0,this.children=[],this.dimensions=new Vector3(width,height,1),this._shader=shader,this.mesh=new Mesh(GLUIObject.getGeometry("2d"),shader),this.mesh.glui=this,this.group.add(this.mesh),shader.mesh=this.mesh,window.GLSEO&&GLSEO.objectNode(this),this.bg("string"==typeof map?map.includes(["#","0x"])?map:"empty"===map||""===map?null:Utils3D.getTexture(map,{premultiplyAlpha:!1}):map);const _this=this;this.mesh.onBeforeRender=_=>{if(!_this.mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(_this.mesh.shader.uniforms.uAlpha&&(_this.mesh.shader.uniforms.uAlpha.value=alpha),_this.usingMap)if(alpha<.001){if(_this.mesh.hidden=!0,_this.mesh.shader.visible=!1,!_this.isDirty&&_this.firstRender)return}else _this.mesh.hidden=!1,_this.mesh.shader.visible=!0;if(!_this.isDirty&&_this.firstRender)return;RenderStats.active&&RenderStats.update("GLUIObject",1,_this.mesh.shader.vsName+"|"+_this.mesh.shader.fsName,_this.mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,1!=_this.scale&&(_this.group.position.x+=(_this.dimensions.x-_this.dimensions.x*_this.scale)/2,_this.group.position.y-=(_this.dimensions.y-_this.dimensions.y*_this.scale)/2);_this.mesh.shader;if(_this.calcMask){let v=_this.isMasked;v.copy(v.origin),_this.group.localToWorld(v),v.z=v.width,v.w=v.height}map?_this.corners||(_this.mesh.scale.set(1,1,1).multiply(_this.dimensions),_this.group.scale.x=_this._scaleX*_this._scale,_this.group.scale.y=_this._scaleY*_this._scale):_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation),_this.anchor.isDirty=!0):(_this.group.quaternion.setFromEuler(_this._rotation),_this.group.matrixDirty=!0):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0),_this.isDirty=!1},_this.isDirty=!0}get width(){return this.dimensions.x}set width(w){let dirty=Math.abs(this.dimensions.x-w)>1e-4;this.dimensions.x=w,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get height(){return this.dimensions.y}set height(h){let dirty=Math.abs(this.dimensions.y-h)>1e-4;this.dimensions.y=h,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get x(){return this._x}set x(v){let dirty=Math.abs(this._x-v)>1e-4;this._x=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get y(){return this._y}set y(v){let dirty=Math.abs(this._y-v)>1e-4;this._y=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get z(){return this._z}set z(v){let dirty=Math.abs(this._z-v)>1e-4;this._z=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scale(){return this._scale}set scale(v){let dirty=Math.abs(this._scale-v)>1e-4;this._scale=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleX(){return this._scaleX}set scaleX(v){let dirty=Math.abs(this._scaleX-v)>1e-4;this._scaleX=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get scaleY(){return this._scaleY}set scaleY(v){let dirty=Math.abs(this._scaleY-v)>1e-4;this._scaleY=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}get rotation(){return this._rotation}set rotation(v){let dirty=Math.abs(this._rotation-v)>1e-4;this._rotation=v,dirty&&(this.isDirty=!0,this.__internalDirty&&this.__internalDirty())}style(props){for(let prop in props)void 0!==this[prop]&&(this[prop]=props[prop]);return this}size(w,h){return this.width=w,this.height=h,this.corners&&this.corners.update(),this}add($obj){return $obj?.parent?.children?.remove($obj),$obj.parent=this,this.group.add($obj.group),this.children.push($obj),this.isMasked&&$obj.mask(this.isMasked,this.maskShader),this._3d&&!$obj._3d&&$obj.enable3D(),this.deferred&&($obj.deferRender(!0),$obj.anchor&&this.anchor&&this.anchor.add($obj.anchor)),this}interact(over,click,camera=World.CAMERA,url,label,options){"string"==typeof camera&&(options=label,label=url,url=camera,camera=World.CAMERA);const bubble=(e,fn)=>{e.stopPropagation=function(){e._stopProp=!0};let parent=this._parent;for(;parent;){if(e._stopProp)return;parent[fn]?.(e),parent=parent.parent}};if(this._onOver=e=>{bubble(e,"_onChildHover"),over(e)},this._onClick=e=>{bubble(e,"_onChildClick"),click(e)},this._interactCamera=camera,over?this.interaction.add(this,camera):this.interaction.remove(this,camera),"string"==typeof url&&"string"==typeof label){const _this=this;defer((_=>{!_this.seo&&window.GLSEO&&GLSEO.objectNode(_this),_this.seo&&_this.seo.aLink&&_this.seo.aLink(url,label,options)}))}return this}clearInteract(){return this._onOver&&(this.interaction.remove(this,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop),this.seo&&this.seo.unlink(),this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead"),this.children.slice().forEach((child=>{child.remove?child.remove():child.destroy&&child.destroy()})),this.clearInteract(),this.parent&&(this.parent.children?this.parent.children?.remove(this):GLUI.Stage.remove(this)),this.mesh._parent?this.group._parent?.remove(this.group):this._3d?GLUI.Scene.remove(this):GLUI.Stage.remove(this);let textureShader=this.textureShader;for(let key in textureShader.uniforms){let uniform=textureShader.uniforms[key];uniform&&uniform.value&&uniform.value.destroy&&uniform.value.destroy()}}create(width,height,map,customCompile){let $obj=$gl(width,height,map,customCompile);return this.add($obj),this._3d&&$obj.enable3D(),$obj}removeChild(obj){return this.group.remove(obj.group),this}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this.mesh.geometry=GLUIObject.getGeometry(style2d?"2d":"3d"),this.mesh.shader.depthTest=!0,this._rotation=new Euler,this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0};const _this=this;return _this._rotation.onChange((_=>{_this.isDirty=!0})),this}loaded(){return!0}setZ(z){return this.mesh.renderOrder=z,this}bg(path){if(void 0!==path)return"string"==typeof path?path.includes(["#","0x"])?(this.colorShader||(this.colorShader=new Shader("GLUIColor",{transparent:!0,uAlpha:{type:"f",value:1},uColor:{value:new Color(path)}})),this.colorShader.set("uColor",new Color(path)),this._shader!=this.colorShader&&this.useShader(this.colorShader)):(this.textureShader.uniforms.tMap.value=Utils3D.getTexture(path,{premultiplyAlpha:!1}),this._shader!=this.textureShader&&this.useShader(this.textureShader)):this._shader.uniforms.tMap.value=path,this}show(){return this.group.matrixDirty=!0,this.mesh.matrixDirty=!0,this.group.visible=!0,this.anchor&&(this.anchor.visible=!0),this}hide(){return this.group.visible=!1,this.anchor&&(this.anchor.visible=!1),this}useShader(shader){return shader&&(shader!=this.textureShader&&shader!=this.colorShader&&(shader.uniforms.tMap=this.mesh.shader.uniforms.tMap,shader.uniforms.uAlpha=this.mesh.shader.uniforms.uAlpha),this._3d||(shader.depthTest=!1),shader.transparent=!0),this._shader=shader,this.mesh.shader=shader||this._shader,shader.mesh=this.mesh,this}depthTest(bool){this.mesh.shader.depthTest=bool}childInteract(hover,click){this._onChildHover=hover,this._onChildClick=click}useGeometry(geom){return this.mesh.geometry=geom,this}updateMap(src){this._shader.uniforms.tMap.value="string"==typeof src?Utils3D.getTexture(src):src}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse((o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)}))}deferRender(parent){this.deferred=!0,parent||(this.anchor=new Group,GLUI.Scene.addDeferred(this))}clearTween(){return this._mathTweens&&this._mathTweens.forEach((t=>{t.tween.stop()})),this}createCorners(){this.corners=new GLUICornerPin(this)}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}get shader(){return this._shader}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivSelect&&this.onDivSelect()}get _parent(){return this.parent}get interaction(){return(this._3d?GLUI.Scene:GLUI.Stage).interaction}forceUpdate(){this.firstRender=!1,this.mesh.onBeforeRender()}}!function(){var _geom2d,_geom3d;GLUIObject.getGeometry=function(type){return"2d"==type?(_geom2d||(_geom2d=new PlaneGeometry(1,1)).applyMatrix((new Matrix4).makeTranslation(.5,-.5,0)),_geom2d):(_geom3d||(_geom3d=World.PLANE),_geom3d)},GLUIObject.clear=function(){_geom2d=_geom3d=null},GLUIObject.noop=_=>{}}();class GLUIText{constructor(text,fontName,fontSize,options={},customCompile){options.font=fontName||options.font,options.text=text,options.width=options.width,options.align=options.align||"left",options.size=fontSize||options.size,options.lineHeight=options.lineHeight,options.letterSpacing=options.letterSpacing,options.wordSpacing=options.wordSpacing,options.wordBreak=options.wordBreak,options.langBreak=options.langBreak,options.color=new Color(options.color),options.customCompile=customCompile,this.text=new GLText(options),this.group=new Group,this.group.asyncPromise=this.text.text.fontLoaded,this.alpha=1,this._x=0,this._y=0,this._z=0,this._scaleX=1,this._scaleY=1,this._scale=1,this._rotation=0,this.multiTween=!0;const _this=this;text&&defer((_=>{_this.seo||_this.seoText(text)})),this.text.ready().then((_=>{let mesh=_this.text.mesh;mesh.glui=_this,mesh.shader.visible=!1,_this.mesh=mesh,_this.group.add(mesh),_this._3d&&!_this._style2d&&_this.text.centerY(),_this._3d||(_this.text.mesh.shader.depthTest=!1),mesh.shader.mesh=mesh,mesh.onBeforeRender=_=>{if(!mesh.determineVisible()&&_this.firstRender)return;let alpha=_this.getAlpha();if(mesh.shader.uniforms.uAlpha&&(mesh.shader.uniforms.uAlpha.value=alpha),alpha<.001){if(mesh.shader.visible=!1,mesh.hidden=!1,!_this.isDirty&&_this.firstRender)return}else mesh.hidden=!1,mesh.shader.visible=!0;!_this.isDirty&&_this.firstRender||(RenderStats.active&&RenderStats.update("GLUIText",1,mesh.shader.vsName+"|"+mesh.shader.fsName,mesh),_this.group.position.x=_this._x,_this.group.position.y=_this._3d?_this._y:-_this._y,_this.group.position.z=_this._z,_this.group.scale.set(_this._scaleX*_this._scale,_this._scaleY*_this._scale,1),_this._3d?_this.anchor&&_this.anchor._parent?(_this.anchor.position.copy(_this.group.position),_this.anchor.scale.copy(_this.group.scale),_this.anchor.quaternion.setFromEuler(_this._rotation)):_this.group.quaternion.setFromEuler(_this._rotation):_this.group.rotation.z=Math.radians(_this._rotation),_this.firstRender||(_this.group.updateMatrixWorld(!0),_this.firstRender=!0,mesh.shader.visible=!0),_this.onInternalUpdate&&_this.onInternalUpdate(),_this.isDirty=!1)}}))}get x(){return this._x}set x(v){Math.abs(this._x-v)>1e-4&&(this.isDirty=!0),this._x=v}get y(){return this._y}set y(v){Math.abs(this._y-v)>1e-4&&(this.isDirty=!0),this._y=v}get z(){return this._z}set z(v){Math.abs(this._z-v)>1e-4&&(this.isDirty=!0),this._z=v}get scale(){return this._scale}set scale(v){Math.abs(this._scale-v)>1e-4&&(this.isDirty=!0),this._scale=v}get scaleX(){return this._scaleX}set scaleX(v){Math.abs(this._scaleX-v)>1e-4&&(this.isDirty=!0),this._scaleX=v}get scaleY(){return this._scaleY}set scaleY(v){Math.abs(this._scaleY-v)>1e-4&&(this.isDirty=!0),this._scaleY=v}get rotation(){return this._rotation}set rotation(v){Math.abs(this._rotation-v)>1e-4&&(this.isDirty=!0),this._rotation=v}get dimensions(){return this._dimensions||(this._dimensions={}),this.text&&this.text.geometry&&!this._dimensions.max&&(this._dimensions=this.text.geometry.boundingBox,this._dimensions.width=Math.abs(this._dimensions.min.x-this._dimensions.max.x),this._dimensions.height=Math.abs(this._dimensions.min.y-this._dimensions.max.y)),this._dimensions}interact(over,click,camera=World.CAMERA,seoLink,options){"string"==typeof camera&&(options=seoLink,seoLink=camera,camera=World.CAMERA),this._onOver=over,this._onClick=click,this._interactCamera=camera;let stage=this._3d?GLUI.Scene:GLUI.Stage;const _this=this;return _this.text.ready().then((_=>{if(over){if(_this.text.geometry.boundingBox||_this.text.geometry.computeBoundingBox(),!_this.hitArea){let bb=_this.text.geometry.boundingBox,shader=Utils3D.getTestShader();if(shader.visible=!1,_this.hitArea=new Mesh(World.PLANE,shader),_this.hitArea.glui=_this,_this.hitArea.scale.set(Math.abs(bb.min.x)+Math.abs(bb.max.x),Math.abs(bb.min.y)+Math.abs(bb.max.y),1),_this._3d&&!_this._style2d||(_this.hitArea.position.x=(bb.max.x-bb.min.x)/2),_this.hitArea.position.y=(bb.min.y-bb.max.y)/2,_this._3d)switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=(bb.min.x-bb.max.x)/2}else switch(_this.text.getData().align){case"center":_this.hitArea.position.x=0;break;case"right":_this.hitArea.position.x=-(bb.max.x-bb.min.x)/2}_this.text.mesh.add(_this.hitArea)}stage.interaction.add(_this.hitArea,camera)}else stage.interaction.remove(_this.hitArea,camera)})),defer((_=>{seoLink&&_this.seo&&_this.seo.aLink&&_this.seo.aLink(seoLink,options)})),this}clearInteract(){if(this._onOver){(this._3d?GLUI.Scene:GLUI.Stage).interaction.remove(this.hitArea,this._interactCamera),this._onClick=GLUIObject.noop,this._onOver=GLUIObject.noop}return this}remove(param){param&&console.warn("GLUIObject.remove removes ITSELF from its parent. use removeChild instead");let stage=this._3d?GLUI.Scene:GLUI.Stage;this.mesh&&this.mesh.parent?this.group.parent.remove(this.group):stage.remove(this),this.hitArea&&stage.interaction.remove(this.hitArea,this._interactCamera),this.text&&this.text.destroy&&this.text.destroy(),Utils.nullObject(this.mesh),Utils.nullObject(this)}tween(obj,time,ease,delay){return tween(this,obj,time,ease,delay)}enable3D(style2d){this._3d=!0,this._style2d=style2d,this._rotation=new Euler;const _this=this;return _this._rotation.onChange((_=>{_this.isDirty=!0})),_this.text.ready().then((_=>{_this.text.mesh.shader.depthTest=!0})),this.anchor||(this.anchor=new Group),this.anchor.onMatrixDirty=_=>{_this.isDirty=!0},_this.isDirty=!0,this}depthTest(bool){const _this=this;return _this.text.ready().then((_=>{_this.text.mesh.shader.depthTest=bool})),this}setZ(z){const _this=this;return _this.text.ready().then((_=>{_this.text.mesh.renderOrder=z})),this}height(){return this.mesh?this.text.height:0}async setText(text,options){return text&&(text=text.toString(),this.seoText(text)),await this.text.ready(),await this.text.setText(text,options),this._dimensions=null,this}seoText(text){window.GLSEO&&GLSEO.textNode(this,text)}getTextString(){return this.text.string}setColor(color){const _this=this;return _this.text.ready().then((_=>_this.text.setColor(color))),this}tweenColor(color,time,ease,delay){const _this=this;return _this.text.ready().then((_=>_this.text.tweenColor(color,time,ease,delay))),this}async resize(options){await this.text.ready(),await this.text.resize(options),this._dimensions=null}show(){return this.text.ready().then((_=>{this.text.mesh.visible=!0,this.text.mesh.updateMatrixWorld(!0)})),this}async mask(obj,shader){await defer();let dimensions={},p=this._parent;for(;p;)p.stageLayoutCapture&&(dimensions.width=p.stageLayoutCapture.width,dimensions.height=p.stageLayoutCapture.height),p=p._parent;dimensions.width||(dimensions.width=Stage.width,dimensions.height=Stage.height),obj.group.updateMatrixWorld(!0),obj.mesh.onBeforeRender();let box=(new Box3).setFromObject(obj.mesh),minX=box.min.x/dimensions.width,minY=box.max.y/dimensions.height,maxX=box.max.x/dimensions.width,maxY=-box.min.y/dimensions.height;this.shader&&(this.useShader(shader),this.shader.addUniforms({uMaskValues:{value:new Vector4(minX,minY,maxX,maxY)}})),obj.hide(),this.group.traverse((o=>{o.glui&&o.glui!=this&&o.glui.mask(obj,shader)}))}hide(){const _this=this;return _this.text.ready().then((_=>_this.text.mesh.visible=!1)),this}loaded(){return this.text.ready()}length(){return this.text.charLength}deferRender(parent){this.deferred=!0,parent||(this.anchor||(this.anchor=new Group),GLUI.Scene.addDeferred(this))}getAlpha(){if(this._gluiParent){let alpha=this._gluiParent.getAlpha();return this.alpha=alpha,alpha}let alpha=this.alpha,$parent=this.parent;for(;$parent;)alpha*=$parent.alpha,$parent=$parent.parent;return alpha}size(){}upload(){const _this=this;return _this.text.ready().then((_=>_this.text.mesh.upload())),this}_divFocus(){this._onOver&&this._onOver({action:"over",object:this}),this.onDivFocus&&this.onDivFocus()}_divBlur(){this._onOver&&this._onOver({action:"out",object:this}),this.onDivBlur&&this.onDivBlur()}_divSelect(){this._onClick&&this._onClick({action:"click",object:this}),this.onDivBlurSelect&&this.onDivSelect()}get _parent(){return this.parent}async useShader(shader){await this.text.ready(),shader.uniforms.tMap=this.text.shader.uniforms.tMap,shader.uniforms.uAlpha=this.text.shader.uniforms.uAlpha,shader.uniforms.uColor=this.text.shader.uniforms.uColor,shader.transparent=!0,(!this._3d||this._3d||this.parent)&&(shader.depthTest=!1),this.text.mesh.shader=shader||this.text.shader,this.text.shader=shader,this.text.mesh.shader.mesh=this.text.mesh}}Class((function GLUIStage(){Inherit(this,Component);const _this=this;var _scene=new Scene,_camera=new OrthographicCamera(1,1,1,1,.1,1);function resizeHandler(){_camera.left=Stage.width/-2,_camera.right=Stage.width/2,_camera.top=Stage.height/2,_camera.bottom=Stage.height/-2,_camera.near=.01,_camera.far=1e3,_camera.updateProjectionMatrix(),_camera.position.x=Stage.width/2,_camera.position.y=-Stage.height/2}this.interaction=new GLUIStageInteraction2D(_camera,_scene,Stage),this.alpha=1,this.scene=_scene,_scene.disableAutoSort=!0,_camera.position.z=1,function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler)}(),resizeHandler(),this.add=function($obj){$obj.parent=_this,_scene.add($obj.group||$obj.mesh)},this.remove=function($obj){$obj.parent=null,_scene.remove($obj.group)},this.clear=function(){_scene.traverse((obj=>{obj.geometry&&obj.shader&&obj.destroy()})),_scene.children.length=_scene.childrenLength=0},this.renderToRT=function(scene,rt){let clearAlpha;rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,_camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.resize=resizeHandler,this.render=function loop(){if(!_scene.children.length)return;let clear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera,null,!0),World.RENDERER.autoClear=clear},this.renderDirect=callback=>{_scene.children.length&&(_scene.traverse((obj=>{obj.shader&&(obj.shader.depthTest=!1)})),callback(_scene,_camera))}})),Class((function GLUIStage3D(){Inherit(this,Object3D);const _this=this;var _camera,_externalRenders=[],_scene=new Scene,_list=new LinkedList;this.alpha=1,this.interaction=new GLUIStageInteraction3D,this.add=function(obj,parent){obj.parent=_this,obj._gluiParent=parent,obj.anchor&&(obj.anchor._gluiParent=parent),obj._3d||obj.enable3D(),obj.deferRender()},this.clear=function(){_scene.traverse((obj=>{obj.geometry&&obj.shader&&obj.destroy()})),_scene.children.length=_scene.childrenLength=0},this.addDeferred=function(obj){_list.push(obj),_scene.add(obj.group||obj.mesh)},this.remove=function(obj){_scene.remove(obj.group||obj.mesh),_list.remove(obj)},this.disableAutoSort=function(){_scene.disableAutoSort=!0},this.renderToRT=function(scene,camera){camera=camera.camera||camera,scene.traverse((mesh=>{let obj=mesh.glui||mesh;obj&&obj.anchor&&obj.anchor.determineVisible()&&Utils3D.decompose(obj.anchor,obj.group||obj)})),scene._textRenderCamera=camera,_externalRenders.push(scene)},this.renderToRT2=function(scene,rt,camera){let clearAlpha;rt.fxscene&&rt.fxscene.clearAlpha>-1&&(clearAlpha=World.RENDERER.getClearAlpha(),World.RENDERER.setClearAlpha(0));let autoClear=World.RENDERER.autoClear;World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera,rt),World.RENDERER.autoClear=autoClear,clearAlpha&&World.RENDERER.setClearAlpha(clearAlpha)},this.render=function loop(){if(!window.Metal){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();let clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(_scene,_camera||World.CAMERA),World.RENDERER.autoClear=clear}if(_externalRenders.length)for(;_externalRenders.length;){let scene=_externalRenders.shift(),camera=scene._textRenderCamera,clear=World.RENDERER.autoClear;Renderer.context.clear(Renderer.context.DEPTH_BUFFER_BIT),World.RENDERER.autoClear=!1,World.RENDERER.render(scene,camera),World.RENDERER.autoClear=clear}}},this.mark=function mark(){let obj=_list.start();for(;obj;)obj.anchor._parent&&(obj.group.visible=obj.anchor.determineVisible()),obj.mesh&&obj.mesh.determineVisible()&&obj.anchor._parent&&(obj._marked=!0),obj=_list.next()},this.renderDirect=function(callback){if(_list.length){let obj=_list.start();for(;obj;)obj._marked&&(obj._marked=!1,Utils3D.decompose(obj.anchor,obj.group)),obj=_list.next();_scene.traverse((obj=>{obj.shader&&(obj.shader.depthTest=!1)})),callback(_scene,_camera||World.CAMERA)}},this.set("camera",(c=>{_camera=c.camera||c}))})),Class((function GLUIToRT(){const _this=this;if(!_this.addObject)throw"GLUIToRT must decorate inheritance on an FXScene";var _gluiScene=new Scene,_glui3DScene=new Scene,_3dlist=[];this.glui=$gl(),this.glScene=$gl(),this.glScene.gluiToRT=_this,GLUI.Stage.add(_this.glui),_this.startRender((_=>{for(let i=0;i<_3dlist.length;i++){let obj=_3dlist[i];obj.anchor._parent&&(obj.group.visible=obj.anchor.determineVisible()),obj.mesh&&obj.mesh.determineVisible()&&obj.anchor._parent&&Utils3D.decompose(obj.anchor,obj.group)}}),World.NUKE),_this.startRender((_=>{_this.preventRTDraw||(_this.flag("gluiActive")&&(GLUI.Stage.renderToRT(_gluiScene,_this.rt),_this.glSceneEnabled&&GLUI.Scene.renderToRT2(_glui3DScene,_this.rt,_this.nuke.camera)),_this.glSceneEnabled&&(GLUI.Scene.camera=_this.nuke.camera))}),_this),this.gluiToRT=function(){_this.flag("gluiActive")||(_this.flag("gluiActive",!0),GLUI.Stage.remove(_this.glui),_gluiScene.add(_this.glui.group),_this.glSceneEnabled&&(GLUI.Scene.remove(_this.glScene),_glui3DScene.add(_this.glScene.group)))},this.gluiToScreen=function(){_this.flag("gluiActive")&&(GLUI.Stage.add(_this.glui),_gluiScene.remove(_this.glui.group),_this.flag("gluiActive",!1),_this.glSceneEnabled&&(_this.flag("fxSceneHidden")||GLUI.Scene.add(_this.glScene),_glui3DScene.remove(_this.glScene.group)))},this.displayGLUI=async function(retina){await defer(),_this.gluiToRT(),retina&&_this.gluiToScreen()},this.onFXSceneVisibility=function(v){_this.flag("fxSceneHidden",!v),_this.glSceneEnabled&&(v?_this.flag("gluiActive")||GLUI.Scene.add(_this.glScene):GLUI.Scene.remove(_this.glScene))},this.addGLUI3D=function(obj){_3dlist.push(obj),_this.glScene.add(obj)}})),Module((function FirefoxGPUFixer(){this.exports=function(){GPU.detect("radeon r9 200")&&("mac"==Device.system.os||Device.pixelRatio>1)&&(Device.graphics.webgl.gpu="radeon pro 455")}})),Class((function GPU(){Inherit(this,Component);var _this=this,_split={};Hydra.ready((async()=>{for(var key in _this.detect=function(match){if(Device.graphics.gpu)return Device.graphics.gpu.detect(match)},_this.detectAll=function(){if(Device.graphics.gpu){for(var match=!0,i=0;i<arguments.length;i++)Device.graphics.gpu.detect(arguments[i])||(match=!1);return match}},_this.matchGPU=function(str,min,max=99999){let num=function splitGPU(string){if(_split[string])return _split[string];if(!_this.detect(string))return-1;try{var num=Number(_this.gpu.split(string)[1].split(" ")[0]);return _split[string]=num,num}catch(e){return-1}}(str);return num>=min&&num<max},_this.gpu=Device.graphics.gpu?Device.graphics.gpu.identifier:"","apple gpu"==_this.gpu&&(Device.mobile?await require("iOSGPUTest")():require("MacOSPerformanceTest")()),"firefox"===Device.system.browser&&require("FirefoxGPUFixer")(),_this.BLACKLIST=require("GPUBlacklist").match(),_this.T0=!(Device.mobile||!_this.BLACKLIST&&!_this.detect("radeon(tm) r5")&&!_this.detect("radeon r9 200")&&!_this.detect("hd graphics family")&&!_this.detect("intel(r) uhd graphics direct")&&!_this.matchGPU("hd graphics ",1e3,5001)&&!(_this.matchGPU("hd graphics ",0,618)&&Device.pixelRatio>1)&&!(_this.detect(["hd graphics","iris"])&&Math.max(Stage.width,Stage.height)>1800)&&!_this.detect(["intel iris opengl engine"])&&!_this.matchGPU("iris(tm) graphics ",1e3)),_this.T1=!(_this.BLACKLIST||Device.mobile||_this.T0||!_this.matchGPU("iris(tm) graphics ",540,1e3)&&!_this.matchGPU("hd graphics ",514,1e3)&&!_this.matchGPU("intel(r) uhd graphics ",600,1e3)&&_this.detect(["nvidia","amd","radeon","geforce"])&&!_this.detect(["vega 8"])),_this.T2=!_this.BLACKLIST&&!Device.mobile&&!(!_this.detect(["nvidia","amd","radeon","geforce"])||_this.T1||_this.T0),_this.T3=!(_this.BLACKLIST||Device.mobile||!_this.detect(["titan","amd radeon pro","quadro"])&&!_this.matchGPU("gtx ",940)&&!_this.matchGPU("radeon (tm) rx ",400)&&!_this.detect("amd radeon(tm) graphics direct3d11 vs_5_0")&&!_this.matchGPU("radeon rx ",400)&&!_this.matchGPU("radeon pro ",420)),_this.T4=!(_this.BLACKLIST||Device.mobile||!_this.detect(["titan","quadro","radeon vii","apple m"])&&!_this.matchGPU("gtx ",1060)&&!_this.matchGPU("rtx")&&!_this.matchGPU("radeon rx ",500)&&!_this.matchGPU("vega ",50)&&!_this.detect(["radeon pro 5300m","radeon pro 5500m","radeon pro 5600m","amd radeon unknown prototype"])),_this.T5=!(_this.BLACKLIST||Device.mobile||!_this.detect(["titan","radeon vii"])&&!_this.matchGPU("gtx ",1080)&&!_this.matchGPU("rtx ",2060)&&!_this.matchGPU("radeon rx ",5500)&&(!_this.detect("apple m")||!_this.detect("max"))),_this.MT0=!!Device.mobile&&(!!_this.BLACKLIST||!("ios"!=Device.system.os||!_this.detect("a7"))||!("android"!=Device.system.os||!_this.detect("sgx"))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",0,415):_this.detect("mali")?_this.matchGPU("mali-t",0,628):!("ios"!=Device.system.os||!_this.detect(["a8","a9"]))||!!_this.detect("mali-g")||!!_this.matchGPU("adreno (tm) ",420))),_this.MT1=function(){if(!Device.mobile)return!1;if(_this.BLACKLIST)return!1;if("ios"==Device.system.os&&_this.detect("a10"))return!0;if("android"==Device.system.os&&!_this.MT0)return!0;if(_this.detect("nvidia tegra")&&Device.detect("pixel c"))return!0;if(_this.detect("mali-g"))return _this.matchGPU("mali-g",73);if(_this.detect("adreno")){if(_this.matchGPU("adreno (tm) ",600,616))return!0;if(_this.matchGPU("adreno (tm) ",530,600))return!0}return!1}(),_this.MT2=!!Device.mobile&&!_this.BLACKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a11","a12"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",630):_this.detect("mali-g")?_this.matchGPU("mali-g",74):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT3=!!Device.mobile&&!_this.BLACKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a12","a13","a14","a15","a16","a17","a18"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",640):_this.detect("mali-g")?_this.matchGPU("mali-g",76):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.MT4=!!Device.mobile&&!_this.BLACKLIST&&(!("ios"!=Device.system.os||!_this.detect(["a14","a15","a16","a17","a18","a19","a20","apple m"]))||(_this.detect("adreno")?_this.matchGPU("adreno (tm) ",650):_this.detect("mali-g")?_this.matchGPU("mali-g",78):!(!navigator.platform.toLowerCase().includes(["mac","windows"])||"chrome"!=Device.system.browser))),_this.lt=function(num){return _this.TIER>-1&&_this.TIER<=num},_this.gt=function(num){return _this.TIER>-1&&_this.TIER>=num},_this.eq=function(num){return _this.TIER>-1&&_this.TIER==num},_this.mobileEq=function(num){return _this.M_TIER>-1&&_this.M_TIER==num},_this.mobileLT=function(num){return _this.M_TIER>-1&&_this.M_TIER<=num},_this.mobileGT=function(num){return _this.M_TIER>-1&&_this.M_TIER>=num},_this)"T"==key.charAt(0)&&!0===_this[key]&&(_this.TIER=Number(key.charAt(1))),"MT"==key.slice(0,2)&&!0===_this[key]&&(_this.M_TIER=Number(key.charAt(2)));!1!==Utils.query("gpu")&&(Device.mobile||Utils.query("gpu").toString().includes("m")?(_this.TIER=-1,_this.M_TIER=Number(Utils.query("gpu").slice(1))):_this.TIER=Number(Utils.query("gpu"))),"ios"==Device.system.os&&Render.REFRESH_RATE<40&&(_this.M_TIER-=1),_this.OVERSIZED=!Device.mobile&&_this.TIER<=0&&Math.max(window.innerWidth,window.innerHeight)>1400||!Device.mobile&&_this.TIER<=1&&Math.max(window.innerWidth,window.innerHeight)>1600,"ie"==Device.system.browser&&(_this.OVERSIZED=!0),_this.initialized=!0})),this.ready=function(){return this.wait("initialized")}}),"static"),Module((function MacOSPerformanceTest(){function test(){let results=[];function getPrime(){return function largest_prime_factor(n){return factors(n).filter(primep).pop()}(1e12)}function factors(n){var i,out=[],sqrt_n=Math.sqrt(n);for(i=2;i<=sqrt_n;i++)n%i==0&&out.push(i);return out}function primep(n){return 0===factors(n).length}for(let i=0;i<3;i++){let time=performance.now();getPrime(),results.push(10*(performance.now()-time))}return results.sort(((a,b)=>a-b)),results[0]}this.exports=function(){let result=test();screen.width<=1440&&screen.height<=900?Device.graphics.webgl.gpu=result>540?"intel iris opengl engine":"safari tier 1":Device.graphics.webgl.gpu=result>475?result>540?"intel iris opengl engine":"safari tier 1":result<375?"amd radeon pro 455 opengl engine":"nvidia geforce 750m opengl engine"}})),Module((function iOSGPUTest(){function getRenderer(complete,takUrl){var nodes=[{x:"Unknown",m:function(n){return function family(){var segments=/iPhone|iPad|Macintosh/.exec(navigator.userAgent);if(segments&&segments.length>0)return segments[0];return""}()},n:[4,2,1,3]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU",m:function(n){return height()},n:[15,10,11,12,14,6,7,8,13,5,9],v:["iPhone"]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8X GPU|Apple M1 GPU|Apple A14 GPU|Apple A12Z GPU",m:function(n){return height()},n:[21,20,18,19,17,16],v:["iPad"]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A12X GPU|Apple A12 GPU|Apple A8 GPU|Apple A8X GPU|Apple A13 GPU|Apple A14 GPU|Apple M1 GPU|Apple A12Z GPU|Apple A15 GPU",m:function(n){return height()},n:[20,18,27,10,11,12,14,19,23,26,24,17,25,13,9,22],v:["Macintosh"]},{x:"Apple A10 GPU",v:["iPod Touch"]},{x:"Apple A7 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A8 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[29,28],v:[1136]},{x:"Apple A8 GPU|Apple A10 GPU|Apple A11 GPU|Apple A9 GPU",m:function(n){return mediacolorgamut()},n:[30,31],v:[2001]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:function(n){return mediacolorgamut()},n:[32,33],v:[2208]},{x:"Apple A8 GPU|Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[34,35],v:[1334]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A13 GPU|Apple A14 GPU|Apple A15 GPU",m:function(n){return hash3d()},n:[37,38,39,40,36,41],v:[2436]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[42,36],v:[2688]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[44,43],v:[1624]},{x:"Apple A12 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[44,36],v:[1792]},{x:"Apple A11 GPU|Apple A12 GPU|Apple A14 GPU|Apple A13 GPU|Apple A15 GPU",m:function(n){return hash3d()},n:[47,45,36,46,41],v:[2079]},{x:"Apple A14 GPU",v:[2532]},{x:"Apple A14 GPU",v:[2778]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8X GPU|Apple M1 GPU",m:function(n){return mediacolorgamut()},n:[49,48],v:[2048]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return mediacolorgamut()},n:[50,51],v:[2732]},{x:"Apple A10X GPU|Apple A12 GPU",m:function(n){return hash()},n:[53,52],v:[2224]},{x:"Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return hash3d()},n:[55,54],v:[2388]},{x:"Apple A10 GPU|Apple A12 GPU",m:function(n){return hash()},n:[56,57],v:[2160]},{x:"Apple A14 GPU",v:[2360]},{x:"Apple A9X GPU|Apple A10X GPU|Apple A9 GPU|Apple A12X GPU|Apple A10 GPU|Apple A12 GPU|Apple A8 GPU|Apple A8X GPU|Apple M1 GPU",m:function(n){return mediacolorgamut()},n:[58,49],v:[2048]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU",m:function(n){return mediacolorgamut()},n:[59,33],v:[2208]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[59,35],v:[1334]},{x:"Apple A9 GPU|Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return mediacolorgamut()},n:[60,29],v:[1136]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A9 GPU",m:function(n){return mediacolorgamut()},n:[59,31],v:[2001]},{x:"Apple A14 GPU",v:[2360,2778]},{x:"Apple A7 GPU|Apple A9 GPU|Apple A8 GPU",m:function(n){return hash()},n:[61,63,62,64,65],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[66,37,67],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[68,69],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:function(n){return hash()},n:[70,71],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[72,73],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU",m:function(n){return hash()},n:[70,74],v:["p3"]},{x:"Apple A8 GPU|Apple A9 GPU",m:function(n){return hash()},n:[75,76],v:["srgb"]},{x:"Apple A10 GPU|Apple A11 GPU|Apple A13 GPU",m:function(n){return hash3d()},n:[66,37,67],v:["p3"]},{x:"Apple A12 GPU",v:[958581112,2301174800,4085158452]},{x:"Apple A11 GPU",v:[367695777,411650080,1220644697]},{x:"Apple A13 GPU",v:[4193218782]},{x:"Apple A14 GPU",v:[105985484]},{x:"Apple A14 GPU",v:[3403189785]},{x:"Apple A14 GPU|Apple A15 GPU",v:[2364051618]},{x:"Apple A13 GPU",v:[352823931,4193218782]},{x:"Apple A12 GPU",v:[958581112,2301174800,3403189785,4085158452]},{x:"Apple A13 GPU",v:[352823931,3335845976,4193218782]},{x:"Apple A11 GPU",v:[367695777,411650080]},{x:"Apple A14 GPU",v:[105985484,679860869,3403189785]},{x:"Apple A13 GPU",v:[352823931]},{x:"Apple A7 GPU|Apple A8 GPU|Apple A9X GPU|Apple A9 GPU|Apple A10 GPU|Apple A8X GPU",m:function(n){return hash()},n:[80,77,81,82,83,85,78,79,84,61],v:["srgb"]},{x:"Apple A10X GPU|Apple A9X GPU|Apple A12X GPU|Apple A12 GPU|Apple M1 GPU",m:function(n){return hash3d()},n:[55,87,86,88,89],v:["p3"]},{x:"Apple A9X GPU",v:["srgb"]},{x:"Apple A10X GPU|Apple A12X GPU|Apple M1 GPU|Apple A12Z GPU",m:function(n){return hash3d()},n:[91,90,94,92,93],v:["p3"]},{x:"Apple A10X GPU",v:[63583436,2114570256,3129316290]},{x:"Apple A12 GPU",v:[1349146759,2917249763]},{x:"Apple A12X GPU|Apple A12Z GPU",v:[4085158452]},{x:"Apple M1 GPU",v:[105985484,3403189785]},{x:"Apple A10 GPU",v:[2114570256]},{x:"Apple A12 GPU",v:[1349146759,2206992415]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU|Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[101,96,98,97,95,99,100],v:["srgb"]},{x:"Apple A9 GPU",v:["srgb"]},{x:"Apple A9 GPU|Apple A10 GPU",m:function(n){return hash()},n:[102,64,65],v:["srgb"]},{x:"Apple A7 GPU",v:[857422828,1915583345]},{x:"Apple A9 GPU",v:[46663968,3129316290]},{x:"Apple A8 GPU",v:[839732043,3816812018,4125234388]},{x:"Apple A9 GPU",v:[2114570256]},{x:"Apple A9 GPU",v:[63583436]},{x:"Apple A10 GPU",v:[583354101,3458129248,3928876783]},{x:"Apple A13 GPU",v:[352823931,3335845976,3403189785,4193218782]},{x:"Apple A8 GPU",v:[1411440593,1924197914,4125234388]},{x:"Apple A9 GPU",v:[2114570256,3129316290]},{x:"Apple A10 GPU",v:[63583436,2114570256,3129316290]},{x:"Apple A11 GPU",v:[1349146759,2917249763]},{x:"Apple A8 GPU",v:[1411440593,1913250432,3074367344,4125234388]},{x:"Apple A9 GPU",v:[46663968,2114570256,3129316290]},{x:"Apple A11 GPU",v:[2917249763,3237505312]},{x:"Apple A8 GPU",v:[3128296539,3816812018,4125234388]},{x:"Apple A9 GPU",v:[46663968,63583436,2114570256,3129316290]},{x:"Apple A8 GPU",v:[2656686317,3710391565]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",v:[3129316290]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:function(n){return hash3d()},n:[103,95,99],v:[2114570256]},{x:"Apple A10 GPU",v:[46663968]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpuavg(n)},n:[105,104],v:[4125234388]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[106,107,108],v:[4005673483]},{x:"Apple A8 GPU|Apple A8X GPU",v:[1350183384,1361285941,3816812018]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",m:function(n){return hash3d()},n:[101,100],v:[63583436]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return hash3d()},n:[110,109],v:[2870741841]},{x:"Apple A10X GPU|Apple A9X GPU",v:[3458129248]},{x:"Apple A12X GPU|Apple A12 GPU",v:[4085158452]},{x:"Apple A10X GPU|Apple A9X GPU",m:function(n){return benchmarkcpuavg(n)},n:[111,112],v:[583354101]},{x:"Apple A10X GPU|Apple A9X GPU",m:function(n){return benchmarkcpuavg(n)},n:[113,114],v:[3928876783]},{x:"Apple A12X GPU",v:[4085158452]},{x:"Apple A10X GPU",v:[583354101,3458129248,3928876783]},{x:"Apple M1 GPU",v:[105985484]},{x:"Apple M1 GPU|Apple A10X GPU",m:function(n){return hash()},n:[116,115],v:[3403189785]},{x:"Apple A12Z GPU",v:[958581112]},{x:"Apple A9X GPU|Apple A10 GPU",v:[3458129248]},{x:"Apple A8X GPU",v:[1480368425,1783160115]},{x:"Apple A8X GPU|Apple A10 GPU",m:function(n){return hash()},n:[56,117],v:[3403189785]},{x:"Apple A8 GPU",v:[3312905059,3928382683]},{x:"Apple A9 GPU|Apple A9X GPU|Apple A10 GPU",m:function(n){return benchmarkcpuavg(n)},n:[118,119],v:[583354101]},{x:"Apple A9X GPU|Apple A9 GPU|Apple A10 GPU",m:function(n){return benchmarkcpuavg(n)},n:[120,122,121],v:[3928876783]},{x:"Apple A10 GPU",v:[1058363647,2015944978]},{x:"Apple A9 GPU",v:[46663968]},{x:"Apple A10 GPU",v:[3403189785]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpustd(n)},n:[123,124],r:[{a:29.78,b:30.87}]},{x:"Apple A8 GPU",r:[{a:31.19,b:31.59}]},{x:"Apple A8X GPU",v:[1783160115]},{x:"Apple A8 GPU",v:[3928382683]},{x:"Apple A8 GPU|Apple A8X GPU",m:function(n){return benchmarkcpustd(n)},n:[125,126],v:[3403189785]},{x:"Apple A8 GPU",v:[3312905059]},{x:"Apple A8X GPU",v:[1480368425]},{x:"Apple A10X GPU",r:[{a:14.16,b:17.21}]},{x:"Apple A9X GPU",r:[{a:18.44,b:35.94}]},{x:"Apple A10X GPU",r:[{a:12.34,b:15.6}]},{x:"Apple A9X GPU",r:[{a:16.8,b:121.37}]},{x:"Apple M1 GPU",v:[1349146759]},{x:"Apple A10X GPU",v:[2114570256]},{x:"Apple A8X GPU",v:[4005673483]},{x:"Apple A9X GPU|Apple A9 GPU",r:[{a:24.38,b:31.67}]},{x:"Apple A10 GPU|Apple A9X GPU",r:[{a:16.82,b:22.52}]},{x:"Apple A9 GPU|Apple A9X GPU",r:[{a:19.79,b:21.64}]},{x:"Apple A10 GPU|Apple A9X GPU",m:function(n){return benchmarkcpustd(n)},n:[127],r:[{a:14.44,b:19.65}]},{x:"Apple A9 GPU|Apple A9X GPU",r:[{a:22.74,b:24.91}]},{x:"Apple A8X GPU",r:[{a:.26,b:5.62}]},{x:"Apple A8 GPU",r:[{a:6.32,b:161.36}]},{x:"Apple A8X GPU",r:[{a:.53,b:13.31}]},{x:"Apple A8 GPU",r:[{a:83.08,b:2952.42}]},{x:"Apple A9X GPU|Apple A10 GPU",r:[{a:29.8,b:228.33}]}];function hash3d(){var gl,program,canvas,mat4={create:function(){for(var result=new Array(16),i=0;i<16;i++)result[i]=i%5==0?1:0;return result},perspective:function(out,fovy,aspect,near,far){var nf,f=1/Math.tan(fovy/2);return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(nf=1/(near-far),out[10]=(far+near)*nf,out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out},lookAt:function(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<1e-6&&Math.abs(eyey-centery)<1e-6&&Math.abs(eyez-centerz)<1e-6?mat4.identity(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.hypot(z0,z1,z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.hypot(x0,x1,x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.hypot(y0,y1,y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)},multiply:function(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[4],b1=b[5],b2=b[6],b3=b[7],out[4]=b0*a00+b1*a10+b2*a20+b3*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[8],b1=b[9],b2=b[10],b3=b[11],out[8]=b0*a00+b1*a10+b2*a20+b3*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,b0=b[12],b1=b[13],b2=b[14],b3=b[15],out[12]=b0*a00+b1*a10+b2*a20+b3*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}};var imageHash=0;if(null!=(canvas=document.createElement("canvas"))){var imageData=function generate(){if(gl=function getRenderingContext(){canvas.width=67,canvas.height=67;var gl=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");return gl&&(gl.viewport(0,0,67,67),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT)),gl}()){var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,"attribute vec3 c,d; uniform vec4 e; uniform vec3 f,g;uniform mat4 h,i;varying vec3 j;void main(){vec3 a=normalize(d);vec4 b=h*vec4(c,1.);vec3 k=normalize(vec3(e-b));j=g*f*max(dot(k,a),0.),gl_Position=i*vec4(c,1.);}"),gl.compileShader(vertexShader);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,"#ifdef GL_ES\nprecision mediump float;\n#endif\nvarying vec3 j;void main(){gl_FragColor = vec4(j, 1.0);}"),gl.compileShader(fragmentShader),program=gl.createProgram(),gl.attachShader(program,vertexShader),gl.attachShader(program,fragmentShader),gl.linkProgram(program),gl.detachShader(program,vertexShader),gl.detachShader(program,fragmentShader),gl.deleteShader(vertexShader),gl.deleteShader(fragmentShader),gl.useProgram(program);var n=function initVertexBuffers(gl){var latNumber,longNumber,vertexPositionData=[],normalData=[],textureCoordData=[],indexData=[];for(latNumber=0;latNumber<=50;++latNumber){var theta=latNumber*Math.PI/50,sinTheta=Math.sin(theta),cosTheta=Math.cos(theta);for(longNumber=0;longNumber<=50;++longNumber){var phi=2*longNumber*Math.PI/50,sinPhi=Math.sin(phi),x=Math.cos(phi)*sinTheta,y=cosTheta,z=sinPhi*sinTheta,u=1-longNumber/50,v=1-latNumber/50;vertexPositionData.push(2*x),vertexPositionData.push(2*y),vertexPositionData.push(2*z),normalData.push(x),normalData.push(y),normalData.push(z),textureCoordData.push(u),textureCoordData.push(v)}}for(latNumber=0;latNumber<50;++latNumber)for(longNumber=0;longNumber<50;++longNumber){var first=51*latNumber+longNumber,second=first+50+1;indexData.push(first),indexData.push(second),indexData.push(first+1),indexData.push(second),indexData.push(second+1),indexData.push(first+1)}vertexPositionData=new Float32Array(vertexPositionData),normalData=new Float32Array(normalData),textureCoordData=new Float32Array(textureCoordData),indexData=new Uint16Array(indexData);var vertexPositionBuffer=gl.createBuffer(),vertexNormalBuffer=gl.createBuffer(),indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexPositionBuffer),gl.bufferData(gl.ARRAY_BUFFER,vertexPositionData,gl.STATIC_DRAW);var VertexPosition=gl.getAttribLocation(program,"c");gl.vertexAttribPointer(VertexPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexPosition),gl.bindBuffer(gl.ARRAY_BUFFER,vertexNormalBuffer),gl.bufferData(gl.ARRAY_BUFFER,normalData,gl.STATIC_DRAW);var VertexNormal=gl.getAttribLocation(program,"d");return gl.vertexAttribPointer(VertexNormal,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(VertexNormal),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indexData,gl.STATIC_DRAW),indexData.length}(gl);gl.clearColor(0,0,0,1),gl.enable(gl.DEPTH_TEST);var projection=mat4.create();mat4.perspective(projection,Math.PI/6,1,.1,100);var modelView=mat4.create();mat4.lookAt(modelView,[0,0,10],[0,0,0],[0,1,0]);var mvpMatrix=mat4.create();mat4.multiply(mvpMatrix,projection,modelView);var ModelViewMatrix=gl.getUniformLocation(program,"h");gl.uniformMatrix4fv(ModelViewMatrix,!1,modelView);var MVP=gl.getUniformLocation(program,"i");gl.uniformMatrix4fv(MVP,!1,mvpMatrix);var LightPosition=gl.getUniformLocation(program,"e");gl.uniform4fv(LightPosition,[10,10,10,1]);var Kd=gl.getUniformLocation(program,"f");gl.uniform3fv(Kd,[.9,.5,.3]);var Ld=gl.getUniformLocation(program,"g");return gl.uniform3fv(Ld,[1,1,1]),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.drawElements(gl.TRIANGLES,n,gl.UNSIGNED_SHORT,0),function cleanup(){gl.useProgram(null),program&&gl.deleteProgram(program)}(),canvas.toDataURL()}}();imageData&&(imageHash=fnvHash(imageData))}return imageHash}var benchmarkValues=null;function benchmarkcpu(){function workerState(){this.samples=[],this.active=0}function timerComplete(worker){worker.terminate(),finished(worker.state)}function workerComplete(source){clearTimeout(source.currentTarget.timeout);var state=source.currentTarget.state;source.currentTarget.terminate(),state.samples=state.samples.concat(source.data),finished(state)}function finished(state){state.active--,0===state.active&&(benchmarkValues=state.samples,state.resolve(benchmarkValues))}function workerFetchUrl(resolve,reject,url){fetch(url,{mode:"same-origin"}).then((function(response){if(response.ok)!function workersStart(resolve,reject,url){var workers=[],state=new workerState;state.resolve=resolve,state.reject=reject;try{for(var i=0;i<2;i++){var worker=new Worker(url);worker.state=state,worker.onmessage=workerComplete,worker.onerror=function(error){reject(error)},workers.push(worker)}for(i=0;i<workers.length;i++)state.active++,workers[i].postMessage(80),workers[i].timeout=setTimeout(timerComplete,4e3,workers[i])}catch(ex){reject(new Error(ex))}}(resolve,reject,response.url);else{var error=new Error("Url could not be reached");error.response=response,reject(error)}})).catch((function(error){reject(error)}))}return new Promise((function(resolve,reject){null!=benchmarkValues?resolve(benchmarkValues):setTimeout((function(){workerFetchUrl(resolve,reject,takUrl)}),1e3)}))}function benchmarkcpuavg(node){return benchmarkcpu().then((function(values){var average=0;values.length>0&&(average=values.reduce((function(previous,current){return current+previous}))/values.length);resolveNode(node,average,0)})).catch((function(error){complete(node.x)}))}function benchmarkcpustd(node){return benchmarkcpu().then((function(values){var std=0;if(values.length>0){var sum=values.reduce((function(previous,current){return current+previous})),average=values.length>0?sum/values.length:0;std=values.reduce((function(sq,n){return sq+Math.pow(n-average,2)}),0)/(values.length-1)}resolveNode(node,std,0)})).catch((function(error){complete(node.x)}))}function fnvHash(str){for(var h=2166136261,i=0;i<str.length;++i)h^=str.charCodeAt(i),h+=(h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24);return h>>>0}function hash(){var imageHash=0,canvas=document.createElement("canvas");if(null!=canvas){var imageData=function drawImage(canvas){canvas.width=67,canvas.height=67;var ctx=canvas.getContext("2d",{alpha:!0});if(null!=ctx)return ctx.imageSmoothingQuality="low",ctx.imageSmoothingEnabled=!0,ctx.globalCompositeOperation="source-over",ctx.globalAlpha=1,ctx.miterLimit=1/0,ctx.filter="none",ctx.lineCap="butt",ctx.lineDashOffset=0,ctx.lineJoin="miter",ctx.font="10pt Arial",ctx.lineWidth=2,void 0!==ctx.setLineDash&&ctx.setLineDash([10,20]),ctx.shadowColor="black",ctx.shadowOffsetX=-3,ctx.shadowOffsetY=-5,ctx.translate(canvas.width/2,canvas.height/2),ctx.rotate(.8901179),ctx.fillStyle="green",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("*51Degrees*",0,0),ctx.beginPath(),ctx.shadowColor="yellow",ctx.shadowBlur=1,ctx.shadowOffsetX=1,ctx.shadowOffsetY=1,ctx.strokeStyle="red",ctx.fillStyle="rgba(0, 0, 255, 0.6)",void 0===ctx.ellipse?ctx.arc(0,0,25,0,2*Math.PI):ctx.ellipse(0,0,25,15,Math.PI/4,0,2*Math.PI),ctx.fill(),ctx.stroke(),canvas.toDataURL()}(canvas);imageData&&(imageHash=fnvHash(imageData))}return imageHash}function height(){return window.screen.height*window.devicePixelRatio}function mediacolorgamut(){return function getMediaSingleValue(name,possibleValues){for(var i=0;i<possibleValues.length;i++)if(query="("+name+": "+possibleValues[i]+")",window.matchMedia(query).matches)return possibleValues[i];var query;return"n/a"}("color-gamut",["p3","srgb"])}function resolveNode(node,value,iterations){for(var i=0;i<node.n.length;i++){var child=nodes[node.n[i]];if(child.r)for(var c=0;c<child.r.length;c++){var range=child.r[c];if((null===range.a||value>=range.a)&&(null===range.b||value<=range.b))return void evaluateNode(child,0)}else if(child.v&&-1!=child.v.indexOf(value))return void evaluateNode(child,0)}node.n.length>0&&iterations<10&&setTimeout((function(){evaluateNode(node,iterations+1)}),10),complete(node.x)}function evaluateNode(node,iterations){if(node.m){var result=node.m(node);result||""===result?result.then||resolveNode(node,result,iterations):node.x&&complete(node.x)}else complete(node.x)}evaluateNode(nodes[0],0),complete("done")}function test(){let results=[];function getPrime(){return function largest_prime_factor(n){return factors(n).filter(primep).pop()}(1e11)}function factors(n){var i,out=[],sqrt_n=Math.sqrt(n);for(i=2;i<=sqrt_n;i++)n%i==0&&out.push(i);return out}function primep(n){return 0===factors(n).length}for(let i=0;i<3;i++){let time=performance.now();getPrime(),results.push(10*(performance.now()-time))}return results.sort(((a,b)=>a-b)),results[0]}function fallbackTest(){let res=Math.min(screen.width,screen.height)+"x"+Math.max(screen.width,screen.height),time=test();switch(res){case"320x480":Device.graphics.webgl.gpu="legacy";break;case"320x568":Device.graphics.webgl.gpu=time<=400?"apple a8":time<=500?"apple a7":"legacy";break;case"375x812":case"414x896":Device.graphics.webgl.gpu=time<=150?"apple a13":time<=180?"apple a12":"apple a11";break;case"414x736":case"375x667":Device.graphics.webgl.gpu=time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";break;default:case"768x1024":Device.graphics.webgl.gpu=time<=140?"apple a14":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":time<=360?"apple a9":time<=400?"apple a8":time<=600?"apple a7":"legacy";break;case"834x1112":Device.graphics.webgl.gpu=time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":"apple a10";break;case"834x1194":time<=140?Device.graphics.webgl.gpu="apple m1 gpu":time<=160?Device.graphics.webgl.gpu="apple a13":time<=180&&(Device.graphics.webgl.gpu="apple a12");break;case"810x1080":time<=160?Device.graphics.webgl.gpu="apple a13":time<=220?Device.graphics.webgl.gpu="apple a11":time<=250&&(Device.graphics.webgl.gpu="apple a10");break;case"820x1180":Device.graphics.webgl.gpu="apple a14";break;case"428x926":case"390x844":Device.graphics.webgl.gpu="apple a15";break;case"1024x1366":Device.graphics.webgl.gpu=time<=140?"apple m1 gpu":time<=160?"apple a13":time<=180?"apple a12":time<=220?"apple a11":time<=250?"apple a10":"apple a9"}}this.exports=function(){let _value,promise=Promise.create();return getRenderer((value=>{if("done"==value){if(_value.includes("|"))try{let split=_value.split("|");if(1==split.length&&split[0].includes("Apple M"))Device.graphics.webgl.gpu="apple m1 gpu";else{let output=split.filter((v=>!v.includes("Apple M"))).map((v=>Number(v.replace("Apple","").replace("X","").replace("Z","").split("A")[1].split(" ")[0])));if(output.sort(((a,b)=>a-b)),output[output.length-1]-output[0]>2?fallbackTest():Device.graphics.webgl.gpu=split[0].toLowerCase(),"apple a14 gpu"==Device.graphics.webgl.gpu){let res=Math.min(screen.width,screen.height)+"x"+Math.max(screen.width,screen.height);"428x926"!=res&&"390x844"!=res||(Device.graphics.webgl.gpu="apple a15 gpu")}}}catch(e){fallbackTest()}else Device.graphics.webgl.gpu=_value.toLowerCase();promise.resolve()}else _value=value})),promise}})),Module((function GPUBlacklist(){this.exports={match:function(){return!Device.graphics.gpu||Device.graphics.gpu.detect(["radeon hd 6970m","radeon hd 6770m","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 5750","radeon hd 5670","radeon hd 4850","radeon hd 4870","radeon hd 4670","geforce 9400m","geforce 320m","geforce 330m","geforce gt 130","geforce gt 120","geforce gtx 285","geforce 8600","geforce 9600m","geforce 9400m","geforce 8800 gs","geforce 8800 gt","quadro fx 5","quadro fx 4","radeon hd 2600","radeon hd 2400","radeon hd 2600","mali-4","mali-3","mali-2","swiftshader","basic render driver","generic renderer","sgx543","legacy","sgx 543"])}}})),Class((function HierarchyAnimation(_data,createObjects,_isLayout){Inherit(this,Object3D);const _this=this;var _objects,_lastElapsed=-1;this.elapsed=0,this.weight=1,this.scale=1,this.duration=0,this.loop=!1;const prevPos=new Vector3,prevRot=new Quaternion,prevScl=new Vector3,nextPos=new Vector3,nextRot=new Quaternion,nextScl=new Vector3,DEFAULT_QUAT=new Quaternion(0,0,0,1),DEFAULT_POS=new Vector3(0,0,0),DEFAULT_SCALE=new Vector3(1,1,1);function loop(){_this.update()}!async function(){if("function"!=typeof createObjects)throw"HierarchyAnimation :: Second parameter requires callback function to create objects";if("string"==typeof _data&&(_data=await get(Assets.getPath(`assets/geometry/${_data}.json`))),_objects=await createObjects(_data.hierarchy),!Array.isArray(_objects))throw"HierarchyAnimation :: Object creation function requires an array to be returned";!function nestObjects(){try{if(_data.hierarchy.length!=_objects.length)throw"HierarchyAnimation :: Number of objects in hierarchy does not match number of objects created.";_data.hierarchy.forEach(((d,i)=>{if(d.parent>-1){"null"!=_data.hierarchy[Number(d.parent)].name&&_objects[d.parent].add(_objects[i])}else"null"!=d.name&&_this.add(_objects[i])}))}catch(e){throw console.error("HierarchyAnimation :: Could not successfully nest objects -- check your names!"),e}}(),_this.duration=_data.frames.length,_this.fps=_data.fps}(),this.update=function(totalWeight=1,isSet){if(!_objects)return;const weight=isSet?1:_this.weight/totalWeight,elapsed=Math.clamp(_this.elapsed,0,.99)*_this.duration;if(Math.abs(elapsed-_lastElapsed)<.001)return;_lastElapsed=elapsed;const floorFrame=Math.floor(elapsed),blend=elapsed-floorFrame,prevKey=_data.frames[floorFrame],nextKey=_data.frames[_this.loop?(floorFrame+1)%_this.duration:floorFrame+1];prevKey&&nextKey&&_objects.forEach(((object,i)=>{prevPos.fromArray(prevKey.position,3*i).multiplyScalar(_this.scale),prevRot.fromArray(prevKey.quaternion,4*i),prevScl.fromArray(prevKey.scale,3*i),nextPos.fromArray(nextKey.position,3*i).multiplyScalar(_this.scale),nextRot.fromArray(nextKey.quaternion,4*i),nextScl.fromArray(nextKey.scale,3*i),prevPos.lerp(nextPos,blend,!1),prevRot.slerp(nextRot,blend,!1),prevScl.lerp(nextScl,blend,!1),_isLayout?(prevPos.equals(DEFAULT_POS)||object.position.lerp(prevPos,weight,!1),prevRot.equals(DEFAULT_QUAT)||object.quaternion.slerp(prevRot,weight,!1),prevScl.equals(DEFAULT_SCALE)||object.scale.lerp(prevScl,weight,!1)):(object.position.lerp(prevPos,weight,!1),object.quaternion.slerp(prevRot,weight,!1),object.scale.lerp(prevScl,weight,!1))}))},this.start=function(){_this.startRender(loop)},this.stop=function(){_this.stopRender(loop)},this.ready=function(){return _this.wait(_this,"duration")},this.set("data",(data=>{_data=data,_this.duration=_data.frames.length,_this.fps=_data.fps,_this.elapsed=0}))})),Class((function HierarchyLayout(_data,createObjects){Inherit(this,Component);const _this=this;var _animation;!async function(){_animation=new HierarchyAnimation(_data,createObjects,!0),_this.group=_animation.group,_animation.loop=!0,await _animation.ready(),_animation.update()}(),this.ready=function(){return _animation.ready()},this.set("scale",(s=>_animation.scale=s))})),Class((function LayerAnimation(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _config,_active,_hierarchy,_map={};!async function(){_mesh.animation=_this,function initConfig(){(_config=InputUIL.create(_input.prefix+"anim",_group)).setLabel("Animation Files"),_config.add("path"),_config.addTextarea("jsonFiles")}(),await async function initFiles(){let path=`assets/geometry/${_config.get("path")}/`,files=_config.get("jsonFiles").split("\n"),load=files.map((f=>path+f+".json")).map((path=>get(path))),data=await Promise.all(load);for(let i=0;i<files.length;i++)_map[files[i]]=data[i];_active=files[0]}(),async function initHierarchy(){_hierarchy=_this.initClass(HierarchyAnimation,_map[_active],(data=>{let array=[];for(let i=0;i<data.length;i++){data[i].name==_input.get("name")?array.push(_mesh):array.push(new Group)}return array})),await _hierarchy.ready(),_hierarchy.update(),_this.flag("initialized",!0)}()}(),this.play=async function(name,time,ease,delay){if(await _this.wait("initialized"),!_map[name])throw"No animation file found for "+name;ease||(ease="linear"),time||(time=_map[name].frames.length/_map[name].fps*1e3),_hierarchy.data=_map[name],_active=name,_hierarchy.start(),await tween(_hierarchy,{elapsed:1},time,ease,delay).promise(),_hierarchy.stop()}})),Class((function Initializer3D(){Inherit(this,Component);const _this=this;let _loader,_working,_promises=[],_queue=[];async function resolve(){await Promise.all(_promises),clearTimeout(_this.fire),_this.fire=_this.delayedCall((_=>{_this.events.fire(_this.READY),_this.resolved=!0,Utils3D.onTextureCreated=null,_loader&&_loader.trigger(50)}),100)}async function workQueue(){clearTimeout(_this.warningTimer),_working=!0;let promise=_queue.shift();if(!promise)return _working=!1;promise.resolve(workQueue),Hydra.LOCAL&&(_this.warningTimer=_this.delayedCall((_=>{console.warn("Long running queue has taken more than 5 seconds.")}),5e3))}function incCompleted(){_loader&&_loader.trigger(1)}this.READY="initializer_ready",this.bundle=function(){return new function PromiseBundler(){const promises=[],ready=Promise.create();let timer;function run(){clearTimeout(timer),timer=_this.delayedCall((_=>{Promise.all(promises).then((_=>ready.resolve()))}),100)}this.capture=function(promise){promises.push(promise),run()},this.ready=function(){return run(),ready}}},this.promise=this.capture=function(promise){return _loader&&_loader.add(1),promise.then(incCompleted),_promises.push(promise),clearTimeout(_this.timer),_this.timer=_this.delayedCall(resolve,100),promise},this.ready=this.loaded=function(){return _this.wait(_this,"resolved")},this.createWorld=async function(){await Promise.all([AssetLoader.waitForLib("zUtils3D"),Shaders.ready(),GPU.ready(),UILStorage.ready()]),World.instance()},this.linkSceneLayout=function(loader){_this.captureTextures(),SceneLayout.initializer=_this.capture,_loader=loader},this.queue=function(immediate){if(immediate)return Promise.resolve((_=>{}));let promise=Promise.create();return _queue.push(promise),_working||workQueue(),promise},this.captureTextures=function(){Utils3D.onTextureCreated=texture=>{_this.promise(texture.promise)}},this.uploadAll=async function(group){if(!group)throw"Undefined passed to uploadAll";let sceneLayout;if(group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.uploadSync&&layer.uploadSync()}}group.traverse((obj=>{if(obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value&&uniform.value.promise&&(textures.push(uniform.value),promises.push(uniform.value.promise.then(uniform.value.upload.bind(uniform.value)).catch((e=>{}))))}obj.asyncPromise?promises.push(obj.asyncPromise.then(obj.upload.bind(obj))):obj.upload&&obj.upload()}})),await Promise.catchAll(promises),textures.forEach((t=>t.upload()));for(let i=0;i<layouts.length;i++)await _this.uploadAll(layouts[i]);sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!0),sceneLayout&&delete sceneLayout.textures},this.uploadAllDistributed=this.uploadAllAsync=async function(group,releaseQueue){if(!group)throw"Undefined passed to uploadAllDistributed";let sceneLayout;if(releaseQueue||"boolean"==typeof releaseQueue||(releaseQueue=await _this.queue()),group instanceof SceneLayout||window.StageLayout&&group instanceof StageLayout){if(sceneLayout=group,sceneLayout.uploaded)return"function"==typeof releaseQueue?releaseQueue():void 0;sceneLayout.uploaded=!0,await sceneLayout.loadedAllLayers(),group=group.group}let uploads=[],_async=[],promises=[],layouts=[],textures=[];if(sceneLayout){sceneLayout.textures=textures;for(let key in sceneLayout.layers){let layer=sceneLayout.layers[key];layer.upload&&!layer.uploadIgnore&&layer.upload()}}group.traverse((obj=>{if(obj.sceneLayout&&obj!=group&&layouts.push(obj.sceneLayout),obj.stageLayout&&obj!=group&&layouts.push(obj.stageLayout),!obj.uploadIgnore&&0!=obj.visible){if(obj.shader)for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value&&uniform.value.promise&&(textures.push(uniform.value),promises.push(uniform.value.promise.then((_=>uploads.push(uniform.value.upload.bind(uniform.value)))).catch((e=>{}))))}if(obj.asyncPromise)promises.push(obj.asyncPromise.then((_=>{obj.geometry&&(obj.geometry.distributeBufferData=!0),uploads.push(obj.upload.bind(obj)),obj.geometry&&_async.push(obj.geometry.uploadBuffersAsync.bind(obj.geometry))})));else if(obj.upload){if(obj.geometry){if(obj.geometry.uploaded)return;obj.geometry.distributeBufferData=!0}uploads.push(obj.upload.bind(obj)),obj.geometry&&_async.push(obj.geometry.uploadBuffersAsync.bind(obj.geometry))}}}));let canFinish=!1,promise=Promise.create(),worker=new Render.Worker((_=>{let upload=uploads.shift();upload?upload():canFinish?((async _=>{for(let i=0;i<_async.length;i++)await _async[i]();for(let i=0;i<layouts.length;i++)await _this.uploadAllAsync(layouts[i],!!releaseQueue);"function"==typeof releaseQueue&&releaseQueue(),promise.resolve()})(),worker.stop()):worker.pause()}),1);return Promise.catchAll(promises).then((_=>{worker.resume(),canFinish=!0})),sceneLayout&&sceneLayout._completeInitialization&&sceneLayout._completeInitialization(!1),sceneLayout&&promise.then((_=>{delete sceneLayout.textures})),promise},this.detectUploadAll=function(group,sync,releaseQueue){return sync?_this.uploadAll(group):_this.uploadAllDistributed(group,releaseQueue)},this.detectUploadNuke=function(nuke,sync){return sync?_this.uploadNukeAsync(nuke):_this.uploadNuke(nuke)},this.uploadNuke=async function(nuke){for(let i=0;i<nuke.passes.length;i++){let pass=nuke.passes[i],uniforms=pass.uniforms;for(let key in uniforms)uniforms[key].value&&uniforms[key].value.promise&&await uniforms[key].value.promise,uniforms[key].value&&uniforms[key].value.upload&&uniforms[key].value.upload();pass.upload()}Nuke.defaultPass.uploaded||Nuke.defaultPass.upload()},this.uploadNukeAsync=function(nuke){return this.uploadNuke(nuke)},this.destroyAll=function(scene){scene.traverse((obj=>{if(obj.geometry&&obj.shader){for(let key in obj.shader.uniforms){let uniform=obj.shader.uniforms[key];uniform&&uniform.value instanceof Texture&&uniform.value.destroy()}obj.destroy()}}))},this.set("loader",(loader=>{_loader=loader}))}),"static"),Class((function Webcam(_width,_height,_audio){Inherit(this,Component);var _this=this;let _stream,_cameras={},_config={},_back=!1,_attempts=0;function establishWebcam(){if(_attempts>=2||!navigator.mediaDevices)return error();(function lookupDevices(){let promise=Promise.create();return Device.mobile?(navigator.mediaDevices.enumerateDevices().then((devices=>{devices.forEach((device=>{device.label.includes("front")&&(_cameras.front={deviceId:{exact:device.deviceId}}),device.label.includes("back")&&(_cameras.back={deviceId:{exact:device.deviceId}},_back=!0)})),_cameras.front||(_cameras.front={facingMode:"user"}),_cameras.back||(_cameras.back={facingMode:"environment"},_back=!1),promise.resolve()})),promise):Promise.resolve()})().then((()=>{_stream&&_config.back&&_stream.getTracks()[0].stop(),Device.mobile.phone&&(_cameras&&_cameras.back&&(_cameras.back.frameRate={ideal:60}),_cameras&&_cameras.front&&(_cameras.front.frameRate={ideal:60})),navigator.mediaDevices.getUserMedia({video:_config.back?_cameras.back:_cameras.front||!0,audio:_audio}).then(success).catch(error)})),_attempts+=1}function success(stream){_this.denied=!1,_stream=stream,_config.back&&!_back?establishWebcam():(_this.div.srcObject=stream,_this.events.fire(Events.READY,null,!0))}function error(){_this.denied=!0,_this.events.fire(Events.ERROR,null,!0)}_this.facing="back",function createVideo(){_this.div=window.AURA?document.createElement():document.createElement("video"),_this.div.width=_width,_this.div.height=_height,_this.div.autoplay=!0,_this.div.controls=!0,_this.div.playsinline=!0,_this.div.setAttribute("playsinline",!0),_this.div.setAttribute("controls",!0),Stage.add(_this.div),_this.element=$(_this.div),_this.element.transformPoint(0,0).transform({scaleX:Device.mobile?1:-1,scale:.25}).setZ(-1)}(),function initNavigator(){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia}(),this.createStream=function(config={}){_attempts=0,_config=config,establishWebcam()},this.flip=function(){if(!_back)return;let direction;"front"===_this.facing?(_this.facing="back",direction=_cameras.back):(_this.facing="front",direction=_cameras.front),_stream.getTracks()[0].stop(),navigator.getUserMedia({video:direction||!0,audio:_audio},success,error)},this.get("width",(function(){return _width})),this.get("height",(function(){return _height})),this.size=function(w,h){_this.div.width=_width=w,_this.div.height=_height=h,_this.element.size(w,h)},this.getPixels=function(width=_width,height=_height){return _this.canvas||(_this.canvas=document.createElement("canvas"),_this.canvas.width=width,_this.canvas.height=height,_this.canvas.context=_this.canvas.getContext("2d")),_this.canvas.context.drawImage(_this.div,0,0,width,height),_this.canvas.context.getImageData(0,0,width,height)},this.getCanvas=function(){return _this.canvas||(_this.canvas=document.createElement("canvas"),_this.canvas.width=_width,_this.canvas.height=_height,_this.canvas.context=_this.canvas.getContext("2d")),_this.canvas.context.drawImage(_this.div,0,0,_width,_height),_this.canvas},this.ready=function(){return _this.div.readyState>0},this.end=function(){_this.active=!1,_this.div.pause(),_stream&&(_stream.getTracks()[0].enabled=!1)},this.restart=function(){_this.div.play(),_stream&&(_stream.getTracks()[0].enabled=!0),_this.active=!0},this.deviceCount=async function(kind){if(!navigator.mediaDevices)return 0;let devices=await navigator.mediaDevices.enumerateDevices(),count=0;return devices.forEach((d=>{d.kind.includes(kind)&&count++})),count}})),Namespace("FX"),FX.Class((function Mirror(_mesh,_params={}){Inherit(this,FXScene);const _this=this;var _renderer,_frustum=new Frustum;function loop({stage:stage,camera:camera,view:view}){if(!_this.visible||!_this.enabled||!_mesh)return;if(stage){if(view>0)return;_renderer.camera=camera,_this.nuke.camera=camera,_this.nuke.stage=stage}else _params.nuke&&_params.nuke.camera!=_this.nuke.camera&&(_this.nuke.camera=_params.nuke.camera),_this.nuke.camera!=_renderer.camera&&(_renderer.camera=_this.nuke.camera);if(_this.frustumCulled&&(_frustum.setFromCamera(_this.nuke.camera),!_frustum.intersectsObject(_mesh)))return;_this.draw(),_mesh.matrixWorld.decompose(_renderer.position,_renderer.quaternion,_renderer.scale);let clearColor=null;_this.clearColor&&(clearColor=World.RENDERER.getClearColor().getHex(),World.RENDERER.setClearColor(_this.clearColor)),World.RENDERER.overridePreventShadows=!0,_renderer.render(_this.scene),World.RENDERER.overridePreventShadows=!1,_this.clearColor&&World.RENDERER.setClearColor(clearColor),_this.postRender&&_this.postRender()}function decorateShader(){_mesh&&(_params.shader.uniforms.tMirrorReflection={value:_renderer.renderTarget.texture,ignoreUIL:!0},_params.shader.uniforms.uMirrorMatrix={value:_renderer.textureMatrix,ignoreUIL:!0},_params.shader.uniforms.uIsMirror=FX.Mirror.isMirrorUniform)}this.visible=!0,this.enabled="boolean"!=typeof _params.enabled||_params.enabled,this.frustumCulled=!0,this.manualRender=!0,_mesh&&_mesh.isGroup&&_mesh.traverse((obj=>{obj.shader&&"TestMaterial"!==obj.shader.fsName&&(_mesh=obj)})),_mesh&&!_params.shader&&(_params.shader=_mesh.shader),_params.nuke=_params.nuke||World.NUKE,_this.create(_params.nuke),_this.preventRTDraw=!0,function initMirror(){let width=_params.width||512,height=_params.height||512;_params.size&&(width=height=_params.size),_renderer=new MirrorRenderer(_params.nuke.camera,{width:width,height:height,clipBias:_params.clipBias||.01,format:_params.format,mipmaps:_params.mipmaps}),_params.normal&&(_renderer.normalDir=_params.normal)}(),decorateShader(),this.onDestroy=function(){_renderer.destroy()},this.start=function(nuke=_params.nuke){_this.startRender(loop,RenderManager.type!=RenderManager.VR?nuke:RenderManager.EYE_RENDER)},this.stop=function(){_this.stopRender(loop,RenderManager.type!=RenderManager.VR?nuke:RenderManager.EYE_RENDER)},this.decorate=function(shader){shader.uniforms.tMirrorReflection={value:_renderer.renderTarget.texture,ignoreUIL:!0},shader.uniforms.uMirrorMatrix={value:_renderer.textureMatrix,ignoreUIL:!0},shader.uniforms.uIsMirror=FX.Mirror.isMirrorUniform},this.useMesh=function(mesh){_mesh=mesh,_params.shader||(_params.shader=_mesh.shader),decorateShader()},this.useCamera=function(camera){camera=camera.camera||camera,_renderer.camera=camera,_this.nuke.camera=camera},this.add=async function(obj){_params.nuke.attachments>1?(await obj.shader.onBeforePrecompilePromise,_this.addObject(obj)):_this.addObject(obj)},this.render=loop,this.set("clipBias",(v=>_renderer.clipBias=v))}),(()=>{FX.Mirror.isMirrorUniform={value:1,type:"f",ignoreUIL:!0}}));class MirrorRenderer extends Base3D{constructor(camera,options={}){super(),this._camera=camera,this.width=options.width||512,this.height=options.height||512,this.clipBias=options.clipBias||0,this.renderer=World.RENDERER,this.mirrorPlane=new Plane,this.normalDir=new Vector3(0,0,1),this.normal=new Vector3(0,0,1),this.mirrorWorldPosition=new Vector3,this.cameraWorldPosition=new Vector3,this.rotationMatrix=new Matrix4,this.lookAtPosition=new Vector3(0,0,-1),this.clipPlane=new Vector4,this.textureMatrix=new Matrix4,this.mirrorCamera=this._camera.clone();let filter=options.mipmaps?Texture.LINEAR_MIPMAP:Texture.LINEAR;this.renderTarget=new RenderTarget(this.width,this.height,{minFilter:filter,magFilter:filter,format:options.format||Texture.RGBFormat,generateMipmaps:options.mipmaps||!1}),this.viewVec=new Vector3,this.targetVec=new Vector3,this.q=new Quaternion,this.updateTextureMatrix()}updateTextureMatrix(){this.updateMatrixWorld(),this._camera.updateMatrixWorld(),this.mirrorWorldPosition.setFromMatrixPosition(this.matrixWorld),this.cameraWorldPosition.setFromMatrixPosition(this._camera.matrixWorld),this.rotationMatrix.extractRotation(this.matrixWorld),this.normal.copy(this.normalDir),this.normal.applyMatrix4(this.rotationMatrix),this.viewVec.copy(this.mirrorWorldPosition).sub(this.cameraWorldPosition),this.viewVec.reflect(this.normal).negate(),this.viewVec.add(this.mirrorWorldPosition),this.rotationMatrix.extractRotation(this._camera.matrixWorld),this.lookAtPosition.set(0,0,-1),this.lookAtPosition.applyMatrix4(this.rotationMatrix),this.lookAtPosition.add(this.cameraWorldPosition),this.targetVec.copy(this.mirrorWorldPosition).sub(this.lookAtPosition),this.targetVec.reflect(this.normal).negate(),this.targetVec.add(this.mirrorWorldPosition),this.up.set(0,-1,0),this.up.applyMatrix4(this.rotationMatrix),this.up.reflect(this.normal).negate(),this.mirrorCamera.position.copy(this.viewVec),this.mirrorCamera.up=this.up,this.mirrorCamera.lookAt(this.targetVec),this.mirrorCamera.updateMatrixWorld(),this.mirrorCamera.projectionMatrix.copy(this._camera.projectionMatrix),this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.mirrorCamera.projectionMatrix),this.textureMatrix.multiply(this.mirrorCamera.matrixWorldInverse),this.mirrorPlane.setFromNormalAndCoplanarPoint(this.normal,this.mirrorWorldPosition),this.mirrorPlane.applyMatrix4(this.mirrorCamera.matrixWorldInverse),this.clipPlane.set(this.mirrorPlane.normal.x,this.mirrorPlane.normal.y,this.mirrorPlane.normal.z,this.mirrorPlane.constant);let projectionMatrix=this.mirrorCamera.projectionMatrix,q=this.q;q.x=(Math.sign(this.clipPlane.x)+projectionMatrix.elements[8])/projectionMatrix.elements[0],q.y=(Math.sign(this.clipPlane.y)+projectionMatrix.elements[9])/projectionMatrix.elements[5],q.z=-1,q.w=(1+projectionMatrix.elements[10])/projectionMatrix.elements[14];let c=this.clipPlane.multiplyScalar(2/this.clipPlane.dot(q));projectionMatrix.elements[2]=c.x,projectionMatrix.elements[6]=c.y,projectionMatrix.elements[10]=c.z+1-this.clipBias,projectionMatrix.elements[14]=c.w}render(scene){this.updateTextureMatrix(),FX.Mirror.isMirrorUniform.value=1;let autoClear=this.renderer.autoClear;this.renderer.autoClear=!0,this.renderer.render(scene,this.mirrorCamera,this.renderTarget),this.renderer.autoClear=autoClear,FX.Mirror.isMirrorUniform.value=1}destroy(){this.renderTarget.destroy()}set camera(c){this._camera=c,this.mirrorCamera=c.clone()}get camera(){return this._camera}}Class((function MouseFluid(_params={active:!0}){Inherit(this,Object3D);const _this=this;var _fluid,_custom;this.scale=1;var _scale=1,_last=new Vector2,_mouse=new Vector2,_white=new Color("#ffffff");function loop(){_scale+=.05*(_this.scale-_scale),_custom||_mouse.copy(Mouse);let len=_mouse.distanceTo(_last),size=_this.scaleBasedOnVelocity?Math.range(len,0,5,0,60,!0):25;size*=.8;let delta=Math.range(len,0,15,0,10,!0);len>.01&&_fluid.drawInput(_mouse.x,_mouse.y,(_mouse.x-_last.x)*delta,(_mouse.y-_last.y)*delta,_white,size*_scale),_last.copy(_mouse)}this.scaleBasedOnVelocity=!0,async function(){let layout=_this.initClass(SceneLayout,"mousefluid");_fluid=await layout.getLayer("fluid"),_this.isPlayground()&&_fluid.initMesh(),_this.fluid=_fluid,_params.active?_this.startRender(loop,RenderManager.AFTER_LOOPS):_fluid.visible=!1}(),this.applyTo=async function(shader){await _this.wait("fluid"),shader.uniforms.tFluid=_fluid.fbos.velocity.uniform,shader.uniforms.tFluidMask={value:_fluid}},this.useCustomMouse=function(){_custom=!0},this.getFluid=async function(){return await _this.wait("fluid"),_this.fluid},this.get("mouse",(_=>_mouse))}),"singleton"),Class((function ParticleDistributor(){Inherit(this,Component);const _this=this;function init(){_this.flag("initGenerate")||(_this.flag("initGenerate",!0),Thread.upload(distributeParticles),Thread.upload(generatePointCloud),Thread.upload(generatePointGrid))}function distributeParticles(e,id){let{position:position,count:count,normal:normal,uv:uv,skinIndex:skinIndex,skinWeight:skinWeight,offset:offset,scale:scale,orientation:orientation}=e,vertices=position.length/3,v3=new Vector3,v32=new Vector3,v33=new Vector3,q=new Quaternion,outputPosition=new Float32Array(3*count),outputNormal=normal?new Float32Array(3*count):null,outputUV=uv?new Float32Array(3*count):null,outputSkinIndex=skinIndex?new Float32Array(4*count):null,outputSkinWeight=skinWeight?new Float32Array(4*count):null;for(let i=0;i<count;i++){let j=3*Math.random(0,vertices/3);v3.set(Math.random(0,100),Math.random(0,100),Math.random(0,100));let m=1/(v3.x+v3.y+v3.z);if(v3.set(v3.x*m,v3.y*m,v3.z*m),outputPosition[3*i+0]=position[3*j+0]*v3.x+position[3*j+3]*v3.y+position[3*j+6]*v3.z,outputPosition[3*i+1]=position[3*j+1]*v3.x+position[3*j+4]*v3.y+position[3*j+7]*v3.z,outputPosition[3*i+2]=position[3*j+2]*v3.x+position[3*j+5]*v3.y+position[3*j+8]*v3.z,offset){let randomInstance=Math.random(0,offset.length/3-1);v32.fromArray(outputPosition,3*i),v33.fromArray(scale,3*randomInstance),v32.multiplyScalar(v33),q.fromArray(orientation,4*randomInstance),v32.applyQuaternion(q),v33.fromArray(offset,3*randomInstance),v32.add(v33),v32.toArray(outputPosition,3*i)}if(outputNormal&&(outputNormal[3*i+0]=normal[3*j+0]*v3.x+normal[3*j+3]*v3.y+normal[3*j+6]*v3.z,outputNormal[3*i+1]=normal[3*j+1]*v3.x+normal[3*j+4]*v3.y+normal[3*j+7]*v3.z,outputNormal[3*i+2]=normal[3*j+2]*v3.x+normal[3*j+5]*v3.y+normal[3*j+8]*v3.z),outputUV&&(outputUV[3*i+0]=uv[2*j+0]*v3.x+uv[2*j+2]*v3.y+uv[2*j+4]*v3.z,outputUV[3*i+1]=uv[2*j+1]*v3.x+uv[2*j+3]*v3.y+uv[2*j+5]*v3.z),outputSkinIndex){let skinCluster1={};skinCluster1[skinIndex[4*j+0]]=skinWeight[4*j+0],skinCluster1[skinIndex[4*j+1]]=skinWeight[4*j+1],skinCluster1[skinIndex[4*j+2]]=skinWeight[4*j+2],skinCluster1[skinIndex[4*j+3]]=skinWeight[4*j+3];let skinCluster2={};skinCluster2[skinIndex[4*j+4]]=skinWeight[4*j+4],skinCluster2[skinIndex[4*j+5]]=skinWeight[4*j+5],skinCluster2[skinIndex[4*j+6]]=skinWeight[4*j+6],skinCluster2[skinIndex[4*j+7]]=skinWeight[4*j+7];let skinCluster3={};skinCluster3[skinIndex[4*j+8]]=skinWeight[4*j+8],skinCluster3[skinIndex[4*j+9]]=skinWeight[4*j+9],skinCluster3[skinIndex[4*j+10]]=skinWeight[4*j+10],skinCluster3[skinIndex[4*j+11]]=skinWeight[4*j+11];let indices=[];for(let k=0;k<12;k++){let index=skinIndex[4*j+k];-1===indices.indexOf(index)&&indices.push(index)}let clusters=[];for(let k=0;k<indices.length;k++){let index=indices[k];clusters.push([index,(skinCluster1[index]||0)*v3.x+(skinCluster2[index]||0)*v3.y+(skinCluster3[index]||0)*v3.z])}clusters.sort((function(a,b){return b[1]-a[1]}));for(let l=clusters.length-1;l<4;l++)clusters.push([0,0]);let sum=clusters[0][1]+clusters[1][1]+clusters[2][1]+clusters[3][1];outputSkinIndex[4*i+0]=clusters[0][0],outputSkinIndex[4*i+1]=clusters[1][0],outputSkinIndex[4*i+2]=clusters[2][0],outputSkinIndex[4*i+3]=clusters[3][0],outputSkinWeight[4*i+0]=clusters[0][1]*(1/sum),outputSkinWeight[4*i+1]=clusters[1][1]*(1/sum),outputSkinWeight[4*i+2]=clusters[2][1]*(1/sum),outputSkinWeight[4*i+3]=clusters[3][1]*(1/sum)}}let output={},buffer=[];output.position=outputPosition,buffer.push(outputPosition.buffer),outputNormal&&(output.normal=outputNormal,buffer.push(outputNormal.buffer)),outputUV&&(output.uv=outputUV,buffer.push(outputUV.buffer)),outputSkinIndex&&(output.skinIndex=outputSkinIndex,output.skinWeight=outputSkinWeight,buffer.push(outputSkinIndex.buffer),buffer.push(outputSkinWeight.buffer)),resolve(output,id,buffer)}function generatePointCloud({path:path,textureSize:textureSize},id){!async function(){try{let data=await get(path),totalParticles=textureSize*textureSize,positions=new Float32Array(3*totalParticles),colors=new Float32Array(3*totalParticles);for(let i=0;i<totalParticles;i++){positions[3*i+0]=data.positions[3*i+0],positions[3*i+1]=data.positions[3*i+1],positions[3*i+2]=data.positions[3*i+2];let hex=Math.floor(Number("0x"+data.colors[i])),r=(hex>>16&255)/255,g=(hex>>8&255)/255,b=(255&hex)/255;colors[3*i+0]=r,colors[3*i+1]=g,colors[3*i+2]=b}data.positions=positions,data.colors=colors,resolve(data,id,[data.positions.buffer,data.colors.buffer])}catch(e){throw console.log(e),`Could not load Point Cloud for ${path}`}}()}function generatePointGrid({path:path,particleCount:particleCount},id){let split=path.split("generateGrid-")[1].split("-"),dir=split[0],scale=Number(split[1]),textureSize=(Number(split[2]),Number(split[split.length-1].split(".")[0])),totalParticles=particleCount,positions=new Float32Array(3*totalParticles),colors=new Float32Array(3*totalParticles);for(let i=0;i<totalParticles;i++){let p0=i/textureSize,y=Math.floor(p0),x=p0-y;y/=textureSize,x=Math.range(x,0,1,-scale/2,scale/2),y=Math.range(y,0,1,-scale/2,scale/2),"xz"==dir?(positions[3*i+0]=x,positions[3*i+1]=0,positions[3*i+2]=y):(positions[3*i+0]=x,positions[3*i+1]=y,positions[3*i+2]=0),colors[3*i+0]=1,colors[3*i+1]=1,colors[3*i+2]=1}resolve({colors:colors,positions:positions},id,[colors.buffer,positions.buffer])}this.generate=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array);return(await Thread.shared().distributeParticles({position:position,count:count},[position.buffer])).position},this.generateInstanced=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),offset=new Float32Array(geom.attributes.offset.array),scale=new Float32Array(geom.attributes.scale.array),orientation=new Float32Array(geom.attributes.orientation.array);return(await Thread.shared().distributeParticles({position:position,offset:offset,scale:scale,orientation:orientation,count:count},[position.buffer,offset.buffer,scale.buffer,orientation.buffer])).position},this.generateAll=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),normal=new Float32Array(geom.attributes.normal.array),uv=new Float32Array(geom.attributes.uv.array);return await Thread.shared().distributeParticles({position:position,normal:normal,uv:uv,count:count},[position.buffer,normal.buffer,uv.buffer])},this.generateSkinned=async function(geom,count){init();let position=new Float32Array(geom.attributes.position.array),normal=new Float32Array(geom.attributes.normal.array),uv=new Float32Array(geom.attributes.uv.array),skinIndex=new Float32Array(geom.attributes.skinIndex.array),skinWeight=new Float32Array(geom.attributes.skinWeight.array);return await Thread.shared().distributeParticles({position:position,normal:normal,uv:uv,skinIndex:skinIndex,skinWeight:skinWeight,count:count},[position.buffer,normal.buffer,uv.buffer,skinIndex.buffer,skinWeight.buffer])},this.generatePointCloud=async function(path,textureSize){path.includes("assets/geometry")||(path="assets/geometry/"+path),path.includes(".json")||(path+=".json"),init();let fn=path.includes("generateGrid")?Thread.shared().generatePointGrid:Thread.shared().generatePointCloud,data=await fn({path:Thread.absolutePath(path),textureSize:textureSize});return{positions:new AntimatterAttribute(data.positions,3),colors:new AntimatterAttribute(data.colors,3)}}}),"static"),Class((function PBRShader(_vertexShader,_fragmentShader,_params){const _this=this;function defineSetter(prop){Object.defineProperty(_this,prop,{set:function(v){_this.shader[prop]=v},get:function(){return _this.shader[prop]}})}"object"==typeof _vertexShader&&(_params=_vertexShader,_vertexShader=_fragmentShader="PBR"),"object"==typeof _fragmentShader&&(_params=_fragmentShader,_fragmentShader=_vertexShader),_vertexShader||(_vertexShader=_fragmentShader="PBR"),function initShader(){let lookup=Utils3D.getLookupTexture("assets/images/pbr/lut.png");lookup.forcePersist=!0,_this.shader=new Shader(_vertexShader,_fragmentShader,Utils.mergeObject(_params||{},{tBaseColor:{value:null,getTexture:Utils3D.getRepeatTexture},tMRO:{value:null,getTexture:Utils3D.getRepeatTexture},tNormal:{value:null,getTexture:Utils3D.getRepeatTexture},tEnvDiffuse:{value:null,premultiplyAlpha:!1},tEnvSpecular:{value:null,premultiplyAlpha:!1},tLightmap:{value:null,premultiplyAlpha:!1},tLUT:{value:lookup,ignoreUIL:!0},uTint:{value:new Color("#FFFFFF")},uTiling:{value:new Vector2(1,1)},uOffset:{value:new Vector2(0,0)},uMRON:{value:new Vector4(1,1,1,1)},uEnv:{value:new Vector2(1,0)},uUseLightmap:{value:0},uHDR:{value:0,ignoreUIL:!0},uUseTonemapping:{value:1,ignoreUIL:!0},uUseLinearOutput:{value:0},receiveLight:!0})),_this.shader.parent=_this,_this.lights=_this.shader.lights,_this.uniforms=_this.shader.uniforms,["side","blending","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","receiveShadow","vertexShader","fragmentShader","depthTest","depthWrite","wireframe","transparent","visible","persists","material","customShadowShader"].forEach(defineSetter)}()}),(_=>{const prototype=PBRShader.prototype;PBRShader.webgl1=function(){return World.RENDERER.type==Renderer.WEBGL1},prototype.set=function(key,value){return void 0!==value&&(this.shader.uniforms[key].value=value),this.shader.uniforms[key].value},prototype.get=function(key){return this.shader.uniforms[key].value},prototype.tween=function(key,value,time,ease,delay,callback,update){return tween(this.shader.uniforms[key],{value:value},time,ease,delay,callback,update)},prototype.setPBR=prototype.setOverride=function(key,value,ref=this){switch(ref.parent instanceof PBRShader&&(ref=ref.parent),ref.set(key,value),key){case"tEnvDiffuse":case"tEnvSpecular":case"tLUT":value.generateMipmaps=!1,value.minFilter=Texture.LINEAR}let src=value.src;src&&src.toLowerCase().includes("rgbm")&&(ref.shader.set("uHDR",1),ref.shader.set("uEnv",new Vector2(1,0)))},prototype.destroy=function(){this.shader.destroy()},prototype.copyUniformsTo=function(shader,linked){for(let key in this.uniforms)shader.uniforms[key]=linked?this.uniforms[key]:{type:this.uniforms[key].type,value:this.uniforms[key].value}},prototype.addUniforms=function(uniforms){uniforms.UILPrefix&&(this.UILPrefix=uniforms.UILPrefix,delete uniforms.UILPrefix);for(let key in uniforms)this.uniforms[key]=uniforms[key]}})),Class((function Performance(){Inherit(this,Component);var _overrides=Storage.get("performance_override")||{};function save(key,value){_overrides[key]=value,Storage.set("performance_override",_overrides)}function convert(tier){if(GPU.BLACKLIST)return"F";switch(tier){case 5:return"A++";case 4:return"A+";case 3:return"A";case 2:return"B";case 1:return"C";case 0:return"D"}}!async function(){if(Utils.query("performance")&&Utils.query("edit")||Utils.query("custom")){await Hydra.ready();for(let key in _overrides)Tests[key]=_=>_overrides[key]}}(),this.displayResults=async function(){let editing=Utils.query("edit");await GPU.ready(),__body.bg("#000");let $results=__body.create("PerformanceResults");__body.css({overflowY:"scroll",background:"#000"}),$results.fontStyle("Arial",16,"#fff").css({marginLeft:50,marginRight:50,"user-select":"auto"}),Mobile.allowNativeScroll(),HydraCSS.style(".PerformanceResults *",{position:"relative","user-select":"auto"});Tests.constructor.toString();let tests="";for(let key in Tests){let result=Tests[key]();tests+=`<p><b>${key}:</b> `,editing?("number"==typeof result&&(tests+=`<input class="${key}" value="${result.toString()}" /></p>`),"boolean"==typeof result&&(tests+=`<input class="${key}" type="checkbox" ${result?"checked":""}/></p>`)):tests+=result+"</p>"}let html=`<h1>Performance Results</h1>\n                    <p><b>GPU:</b> ${Device.graphics.webgl?Device.graphics.webgl.gpu:"WEBGL UNAVAILABLE"}</p>\n                    <p><b>WebGL Version:</b> ${Device.graphics.webgl?Device.graphics.webgl.version:"WEBGL UNAVAILABLE"}</p>\n                    <p><b>GPU Tier:</b> ${Device.mobile?convert(GPU.M_TIER):convert(GPU.TIER)} [${Device.mobile?GPU.M_TIER:GPU.TIER}]</p>\n                    <p><b>Mobile:</b> ${Device.mobile?Object.keys(Device.mobile).filter((key=>Device.mobile[key])):"false"} </p>\n                    <p><b>User Agent:</b> ${Device.agent}</p>\n                    <p><b>OS:</b> ${Device.system.os}</p>\n                    <p><b>DPR:</b> ${Device.pixelRatio}</p>\n                    <p><b>Screen Size:</b> ${screen.width} x ${screen.height}</p>\n                    <p><b>Stage Size:</b> ${Stage.width} x ${Stage.height}</p>\n                    \n                    <h2>Project-Specific Tests</h2>\n                    ${editing?'<button class="resetBtn">Reset All</button>':""}\n                    ${tests}\n        `;if($results.html(html),editing){await defer(),document.querySelector(".resetBtn").onclick=_=>{Storage.set("performance_override",null),location.reload()};for(let key in Tests){!function(div,key){div.onchange=_=>{let value=div.value;value=isNaN(value)?div.checked:Number(value),save(key,value)}}(document.querySelector(`.${key}`),key)}}}}),"static"),Class((function Proton(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_size,_antimatter,_behaviorInput;const prefix=this.prefix=`P_${_input.prefix}`;async function initConfig(){(_config=_this.uilConfig=InputUIL.create(prefix+"_config",_group)).setLabel("Config"),_config.addButton("load-values",{label:"Values",actions:[{title:"Load",callback:loadValues},{title:"Save",callback:saveValues}]}).addButton("save",{label:"Configuration",actions:[{title:"Load",callback:loadConfig},{title:"Save",callback:saveConfig}]}).addButton("load-shader",{label:"Shader",actions:[{title:"Load",callback:()=>loadShader()}]}).addButton("load-behavior",{label:"Behavior",actions:[{title:"Load",callback:()=>loadBehavior()}]});_config.addSelect("type",[{label:"Permanent",value:"permanent"},{label:"Lifecycle",value:"lifecycle"}]),window.ProtonPhysics&&_config.addToggle("enablePhysics",!1),_config.add("particleCount",1e3),window.ProtonVolumeShadows&&_config.addToggle("volumeShadows",!1);let output=[{label:"Particles",value:"particles"},{label:"Custom",value:"custom"}];window.ProtonTubes&&output.push({label:"Tubes",value:"tubes"}),window.ProtonMarchingCubes&&output.push({label:"IsoSurface",value:"isosurface"}),_config.addSelect("output",output),_config.add("shader"),_config.get("shader")&&_config.addTextarea("uniforms"),_config.add("class");_config.get("type");try{if(!1===_input.get("visible"))throw"Layer set to invisible";_this.particleCount=_size=getSize(),initAntimatter()}catch(e){console.warn("Proton skipped",e),_this.disabled=!0}}function loadValues(){const name=prompt("Name of values to be loaded");if(null===name)return;let data=UILStorage.get(`proton_values_${name}`);data||alert(`No values ${name} found`),data=JSON.parse(data);let apply=(shader,obj)=>{for(let key in obj)UILStorage.set(shader.UILPrefix+key,obj[key])};apply(_this.behavior,data.behavior),apply(_this.shader,data.shader),_this.customClass&&_this.customClass.saveValues&&apply(_this.customClass.saveValues(),data.custom),alert("Values imported. Save and refresh.")}function saveValues(){const name=prompt("Name of values to be saved");if(null===name)return;let store=(shader,to)=>{for(let key in shader.uniforms){if(shader.uniforms[key].ignoreUIL)continue;let uilValue=UILStorage.get(shader.UILPrefix+key);void 0!==uilValue&&(to[key]=uilValue)}},output={behavior:{},shader:{}};store(_this.behavior,output.behavior),store(_this.shader,output.shader),_this.customClass&&_this.customClass.saveValues&&(output.custom={},store(_this.customClass.saveValues(),output.custom)),UILStorage.setWrite(`proton_values_${name}`,JSON.stringify(output))}function loadConfig(){const name=prompt("Name of configuration to be loaded");if(null===name)return;let toLoad=UILStorage.get(`proton_config_${name}`);loadBehavior(toLoad),loadShader(toLoad),alert("Loaded. Save and refresh")}function saveConfig(){let name=prompt("Name of configuration to be saved");null!==name&&UILStorage.setWrite(`proton_config_${name}`,prefix)}function loadShader(toLoad){let shouldNotify=!toLoad;if(!toLoad){const name=prompt("Name of shader to be loaded");if(null===name)return;toLoad=UILStorage.get(`proton_config_${name}`)}let copyConfig=InputUIL.create(toLoad+"_config",null);_config.copyFrom(copyConfig,["shader","uniforms"]),(_config.get("uniforms")||"").split("\n").forEach((line=>{if(!line.includes(":"))return;let name=(line=line.replace(/ /g,"")).split(":")[0],shaderName=copyConfig.get("shader"),store=`${shaderName}/${shaderName}/${prefix}/`,lookup=`${shaderName}/${shaderName}/${toLoad}/`,val=UILStorage.get(lookup+name);val?UILStorage.set(store+name,val):(val=UILStorage.get(lookup+"_tx_"+name),val&&UILStorage.set(store+"_tx_"+name,val))})),shouldNotify&&alert("Loaded. Save and refresh")}function loadBehavior(toLoad){let shouldNotify=!toLoad;if(!toLoad){const name=prompt("Name of behavior to be loaded");if(null===name)return;toLoad=UILStorage.get(`proton_config_${name}`)}let copyConfig=InputUIL.create(toLoad+"_config",null);_config.copyFrom(copyConfig,["type","particleCount","output","class"]);let copyBehavior=InputUIL.create(toLoad+"_behavior",null);InputUIL.create(prefix+"_behavior",null).copyFrom(copyBehavior,["uniforms","data","codeCount"]);let data=copyBehavior.get("data")||[],buniformString=copyBehavior.get("uniforms")+"\n";ListUIL.create(prefix+"_code",null).internalAddItems(data.length),data.forEach((postfix=>{let toCode=InputUIL.create(prefix+postfix,null),fromCode=InputUIL.create(toLoad+postfix,null);toCode.copyFrom(fromCode,["name","code","uniforms","preset"]),buniformString+=fromCode.get("uniforms")+"\n"})),buniformString.split("\n").forEach((line=>{if(!line.includes(":"))return;let name=(line=line.replace(/ /g,"")).split(":")[0],lookup="am_ProtonAntimatter_"+toLoad,store="am_ProtonAntimatter_"+prefix,val=UILStorage.get(lookup+name);val&&UILStorage.set(store+name,val)}));let className=copyConfig.get("class");className&&(_this.customClass=_this.parent.initClass(window[className],_this,_group,_input),_this.customClass.loadConfig&&_this.customClass.loadConfig(toLoad,prefix)),shouldNotify&&alert("Loaded. Save and refresh")}function getSize(){if(_this.parent.data&&_this.parent.data.particleCount)return"string"==typeof _this.parent.data.particleCount?eval(_this.parent.data.particleCount):_this.parent.data.particleCount;let size=_config.getNumber("particleCount");if(isNaN(size))try{size=eval(_config.get("particleCount"))}catch(e){throw"Proton particleCount is not a number or valid test function"}if(isNaN(size))throw"Proton particleCount is falsy!";return _this.particleCount=size,size}async function initCustomClass(){_this.shader.addUniforms({DPR:{value:World.DPR,ignoreUIL:!0}});let className=_config.get("class");className&&(_this.customClass=_this.parent.initClass(window[className],_this,_group,_input))}function parseUniforms(text,predefined){if(!text)return{};let split=text.split("\n"),output={};return split.forEach((line=>{if(!(line=line.replace(/ /g,"")).length||!line.includes(":"))return;let split=line.split(":"),name=split[0],val=split[1];if(val.includes("[")){let array=JSON.parse(val);switch(array.length){case 2:output[name]={value:(new Vector2).fromArray(array)};break;case 3:output[name]={value:(new Vector3).fromArray(array)};break;case 4:output[name]={value:(new Vector4).fromArray(array)};break;default:throw`Unknown uniform type ${line}`}}else"C"==val.charAt(0)?predefined[name]=val.slice(1):"T"===val?output[name]={value:null}:"OEST"===val?output[name]={value:null,oes:!0}:val.includes(["0x","#"])?output[name]={value:new Color(val)}:output[name]={value:Number(val)}})),output}function getUniformGLSLType(obj){return"number"==typeof obj.value?"float":obj.oes?"samplerExternalOES":null===obj.value||obj.value instanceof Texture?"sampler2D":obj.value instanceof Vector2?"vec2":obj.value instanceof Vector3||obj.value instanceof Vector3D?"vec3":obj.value instanceof Vector4?"vec4":obj.value instanceof Color?"vec3":void 0}async function initBehavior(behavior){let glsl=[],predefinedUniforms={HZ:"float"},input;_behaviorInput?input=_behaviorInput:(input=InputUIL.create(prefix+"_behavior",_group),input.setLabel("Behavior Uniforms"),input.addTextarea("uniforms"),input.add("data","hidden"),input.add("codeCount","hidden"),_behaviorInput=input);let map={},list=[],count=input.getNumber("codeCount")||0,data=input.get("data")||[],panel=ListUIL.create(prefix+"_code",_group);panel.setLabel("Behavior Code"),panel.onAdd(((name,input,index)=>{list[index]||addCode(),input.group.add(list[index].group),list[index].mapId=name,map[name]=list[index],input.setLabel(map[name].get("name")||"Code")})),panel.onRemove((name=>{let postfix=map[name].postfix;list.remove(map[name]),data.remove(postfix),input.setValue("data",JSON.stringify(data))})),panel.onSort((array=>{let arr=[];array.forEach((name=>{arr.push(map[name].postfix)})),data=arr,input.setValue("data",JSON.stringify(data))}));let uniforms=parseUniforms(input.get("uniforms")),createCode=postfix=>{let input=InputUIL.create(prefix+postfix,_group,!0);if(input.prefix=prefix+postfix,input.postfix=postfix,input.setLabel("Editor"),input.add("name","hidden"),Proton.ignorePresets&&Proton.ignorePresets.includes(input.get("name")))return;ProtonPresets.bind(input),input.customPresetCallback&&input.customPresetCallback(_this);let code=input.get("code")||"";if(!input.disabled&&code.length){for(uniforms=Utils.mergeObject(uniforms,parseUniforms(input.get("uniforms"),predefinedUniforms));code.includes("#test ");)try{let test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+e}glsl.push(code)}list.push(input)};data.forEach(createCode);let addCode=_=>{count++,data.push(`code_${count}`),input.setValue("data",JSON.stringify(data)),input.setValue("codeCount",count),createCode(`code_${count}`)};behavior instanceof AntimatterPass&&(behavior.addInput("tOrigin",_antimatter.vertices),behavior.addInput("tAttribs",_antimatter.attribs),behavior.addUniforms(uniforms));let filledRequire=[],insertUniform=(code,line)=>code.split("//uniforms").join(line+"\n//uniforms"),insertCode=(code,line)=>code.split("//code").join(line+"\n//code"),insertRequire=(code,line)=>{let name=line.split("require(")[1].split(")")[0];return filledRequire.includes(name)?code:(filledRequire.push(name),code.split("//require").join(Shaders.getShader(name)+"\n//require"))},insertGLSL=(code,line)=>{if(line.includes("#require")){let split=line.split("\n");for(let l of split)code=l.includes("#require")?insertRequire(code,l):insertCode(code,l);return code}return insertCode(code,line)};behavior.onCreateShader=code=>{for(let name in uniforms)code=insertUniform(code,`uniform ${getUniformGLSLType(uniforms[name])} ${name};`);for(let name in predefinedUniforms)code=insertUniform(code,`uniform ${predefinedUniforms[name]} ${name};`);for(let str of glsl)code=insertGLSL(code,str);return _this.tubes&&(code=_this.tubes.overrideShader(code)),Renderer.type==Renderer.WEBGL2&&(code=code.replace(/gl_FragColor/g,"FragColor")),code.includes("samplerExternalOES")&&window.AURA&&"android"==Device.system.os&&(code="#version 300 es\n#extension GL_OES_EGL_image_external_essl3 : require\n"+code.replace("#version 300 es","")),code},behavior.uniforms.uMaxCount={value:_this.particleCount,ignoreUIL:!0},ShaderUIL.add(behavior,_group).setLabel("Behavior Shader"),behavior.uniforms.HZ={value:1},_this.startRender((_=>{behavior.uniforms.HZ.value=Render.HZ_MULTIPLIER}),10),ProtonPresets.onCodeEdit=rebuildShader}async function rebuildShader(){let lifecycle="lifecycle"==_config.get("type"),behavior=_this.initClass(AntimatterPass,"ProtonAntimatter"+(lifecycle?"Lifecycle":""),{unique:prefix,customCompile:prefix+Utils.uuid()});await initBehavior(behavior),behavior.initialize(64),behavior.upload(),_this.behavior.shader._gl&&(_this.behavior.shader._gl=behavior.shader._gl),_this.behavior.shader._metal&&(_this.behavior.shader._metal=behavior.shader._metal),_this.behavior.shader._gpu&&(_this.behavior.shader._gpu=behavior.shader._gpu)}function completeShader(shader){let transparent=_input.get("transparent"),depthWrite=_input.get("depthWrite"),depthTest=_input.get("depthTest"),blending=_input.get("blending"),castShadow=_input.get("castShadow"),receiveShadow=_input.get("receiveShadow");"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite),"boolean"==typeof depthTest&&(shader.depthTest=depthTest),"boolean"==typeof transparent&&(shader.transparent=transparent),"boolean"==typeof castShadow&&(_this.mesh.castShadow=castShadow),"boolean"==typeof receiveShadow&&(shader.receiveShadow=receiveShadow),blending&&(shader.blending=blending),shader.uniforms.tRandom={value:_antimatter.attribs}}function update(){_this.preventUpdate||_antimatter.update()}async function initAntimatter(){let lifecycle="lifecycle"==_config.get("type");_config.get("enablePhysics")?(_config.addVector("width",[0,128]),_config.addVector("height",[0,128]),_config.addVector("depth",[0,128])):(_config.addVector("width",[-1,1]),_config.addVector("height",[-1,1]),_config.addVector("depth",[-1,1]));let dimensions={w:_config.get("width")||[-1,1],h:_config.get("height")||[-1,1],d:_config.get("depth")||[-1,1],pot:"tubes"===_config.get("output")||!0===_config.get("volumeShadows")||"isosurface"===_config.get("output")};_antimatter=_this.initClass(Antimatter,_size,dimensions),Proton.forceCloneVertices.includes(_config.get("class"))&&(_antimatter.cloneVertices=!0),_this.antimatter=_antimatter,await _antimatter.ready();let output=_config.get("output");"tubes"==output&&(_this.tubes=_this.initClass(ProtonTubes,_this)),"isosurface"==output&&(_this.surface=_this.initClass(ProtonMarchingCubes,_this));let overrideShader,wildcard=_input.get("wildcard");if(wildcard&&wildcard.includes(".behavior")){let layer=await _this.parent.getLayer(wildcard.split(".")[0]);await _this.wait(layer,"behavior"),_this.behavior=layer.behavior}else{let behavior=_this.initClass(AntimatterPass,"ProtonAntimatter"+(lifecycle?"Lifecycle":""),{unique:prefix,customCompile:prefix});_this.behavior=behavior,initBehavior(behavior)}let shaderName=_config.get("shader");if(shaderName)if(shaderName.includes(".shader")){let layer=await _this.parent.getLayer(shaderName.split(".")[0]);await _this.wait(layer,"shader"),overrideShader=layer.shader}else{let uniforms=parseUniforms(_config.get("uniforms"));uniforms.unique=prefix+(_this.onGenerateUniqueShader?_this.onGenerateUniqueShader():""),_antimatter.useShader(shaderName,uniforms)}_antimatter.addPass(_this.behavior),_this.mesh=_antimatter.getMesh(),_this.onCreateMesh&&_this.onCreateMesh(_this.mesh),output&&"particles"!=output||_this.delayedCall((_=>{_this.add(_antimatter.mesh)}),480),Utils.query("uilOnly")||_this.startRender(update,RenderManager.AFTER_LOOPS),shaderName&&!shaderName.includes(".shader")&&(ShaderUIL.add(_antimatter.shader,_group).setLabel("Shader"),completeShader(_antimatter.shader)),overrideShader&&_antimatter.overrideShader(overrideShader),_this.shader=_antimatter.shader,_this.initialized=!0,lifecycle&&(_this.spawn=_this.initClass(AntimatterSpawn,_this,_group,_input)),initCustomClass(),_config.get("volumeShadows")&&_this.initClass(ProtonVolumeShadows,_this,_group,_input),_config.get("enablePhysics")&&_this.initClass(ProtonPhysics,_this,_group,_input)}this.uilInput=_input,this.uilGroup=_group,this.prefix=prefix,initConfig(),this.parseUniforms=parseUniforms,this.ready=function(){return this.wait(this,"initialized")},this.applyToInstancedGeometry=function(geometry){geometry.addAttribute("lookup",new GeometryAttribute(_antimatter.getLookupArray(),3,1)),geometry.addAttribute("random",new GeometryAttribute(_antimatter.getRandomArray(),4,1))},this.applyToShader=function(shader){shader.addUniforms({tPos:_antimatter.getOutput(),tPrevPos:_antimatter.getPrevOutput()})},this.upload=async function(){if(_this.disabled)return;let groupVisible=_this.group.visible;_this.group.visible=!1,await this.ready();let output=_config.get("output");await _antimatter.upload(!output||"particles"===output),_this.spawn&&await _this.spawn.upload(),_this.tubes&&await _this.tubes.upload(),_this.group.visible=groupVisible},this.uploadSync=async function(){if(_this.disabled)return;await this.ready();let output=_config.get("output");await _antimatter.uploadSync(!output||"particles"===output),_this.spawn&&await _this.spawn.upload(),_this.tubes&&await _this.tubes.uploadSync()},this.stopUpdating=function(){_this.stopRender(update)},this.set("renderOrder",(async v=>{await _this.ready(),await _antimatter.ready(),_antimatter.mesh.renderOrder=v})),this.get("renderOrder",(v=>_antimatter.mesh.renderOrder))}),(_=>{Proton.forceCloneVertices=[],Proton.ignore=function(name){Proton.ignorePresets||(Proton.ignorePresets=[]),Proton.ignorePresets.push(name)}})),Class((function ProtonPresets(){const _this=this,LIST=[{label:"Custom Code",value:"custom"},{label:"Curl Noise",value:"curl"},{label:"Sine Move",value:"sine"},{label:"Plane Shape",value:"planeshape"},{label:"3D Shape",value:"3dshape"},{label:"Point Cloud",value:"pointcloud"},{label:"Force",value:"force"},{label:"Follow",value:"follow"},{label:"Mouse Fluid",value:"fluid"}],CALLBACKS={custom:function customCode(input){input.setValue("name","Custom Code"),input.setLabel("Custom Code")},curl:function curlNoise(input){input.setValue("name","Curl Noise"),input.setLabel("Curl Noise");input.setValue("uniforms","\n        uCurlNoiseScale: 1\n        uCurlTimeScale: 0\n        uCurlNoiseSpeed: 0\n        "),setPresetCodeIfRequired(input,"#require(curl.glsl)\n\nvec3 curl = curlNoise(pos * uCurlNoiseScale*0.1 + (time * uCurlTimeScale * 0.1));\npos += curl * uCurlNoiseSpeed * 0.01 * HZ;","uCurlNoise")},sine:function sineMove(input){input.setValue("name","Sine Move"),input.setLabel("Sine Move");input.setValue("uniforms","\n        uSinSpeed: 1\n        uSinMovement: 0\n        "),setPresetCodeIfRequired(input,"pos = origin;\npos.x += sin(time*uSinSpeed + radians(360.0 * random.x)) * 0.03 * random.z * uSinMovement;\npos.y += sin(time*uSinSpeed + radians(360.0 * random.y)) * 0.03 * random.w * uSinMovement;\npos.z += sin(time*uSinSpeed + radians(360.0 * random.w)) * 0.03 * random.x * uSinMovement;","uSinSpeed")},planeshape:function planeShape(input){input.setValue("name","Plane Shape"),input.setLabel("Plane Shape");input.setValue("uniforms","\n        uTakePlaneShape: 1\n        uPlaneScale: 1\n        tPlaneTexture: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec2 planeLookup = texture2D(tPlaneTexture, uv).xy;\nvec3 plane;\nplane.x = uPlaneScale * 0.5 * range(planeLookup.x, 0.0, 1.0, -1.0, 1.0);\nplane.y = uPlaneScale * 0.5 * -range(planeLookup.y, 0.0, 1.0, -1.0, 1.0);\nif (uTakePlaneShape > 0.5) pos = plane;","uPlaneScale"),input.customPresetCallback=proton=>{proton.behavior.addUniforms({tPlaneTexture:{value:null}})}},"3dshape":function shape3D(input){input.setValue("name","3D Shape"),input.setLabel("3D Shape"),input.add("geometry");let geometry=input.get("geometry");input.setValue("uniforms","\n        tShape3D: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec3 shape3d = texture2D(tShape3D, uv).xyz;","tShape3D"),input.customPresetCallback=proton=>{let create=async g=>{let geom=await GeomThread.loadGeometry(g),distribution=await ParticleDistributor.generate(geom,proton.antimatter.particleCount),attribute=new AntimatterAttribute(distribution,3);proton.behavior.addInput("tShape3D",attribute)};geometry&&create(geometry),proton.set3DShape=create}},pointcloud:function pointCloud(input){input.setValue("name","Point Cloud"),input.setLabel("Point Cloud"),input.add("file");let file=input.get("file");input.setValue("uniforms","\n        tPointCloud: Csampler2D\n        "),setPresetCodeIfRequired(input,"vec3 pointShape = texture2D(tPointCloud, uv).xyz;","tPointCloud"),input.customPresetCallback=proton=>{let create=async filePath=>{let data;"string"==typeof filePath?(filePath+="-"+proton.antimatter.powerOf2,data=await ParticleDistributor.generatePointCloud(filePath,proton.antimatter.textureSize)):data=filePath,proton.behavior.shader.uniforms.tPointCloud&&(proton.behavior.shader.uniforms.tPointCloud.value.destroy(),proton.shader.uniforms.tPointColor.value.destroy()),proton.behavior.addInput("tPointCloud",data.positions),proton.shader.addUniforms({tPointColor:{value:data.colors}})};file||(file=proton.parent.data?proton.parent.data.pointCloudFile:void 0),file&&create(file),proton.setPointCloud=create}},force:function force(input){input.setValue("name","Force"),input.setLabel("Force");input.setValue("uniforms","\n        uForceDir: [0, 1, 0]\n        uForceScale: 1\n        "),setPresetCodeIfRequired(input,"vec3 force = normalize(uForceDir) * uForceScale * 0.1;\npos += force * HZ;","uForceDir")},follow:function follow(input){input.setValue("name","Follow"),input.setLabel("Follow");input.setValue("uniforms","\n        uFollowPos: [0, 0, 0]\n        uFollowRadius: 2\n        uFollowLerp: 0.7\n        "),setPresetCodeIfRequired(input,"float speed = range(random.x, 0.0, 1.0, 0.5, 1.5);\nvec3 followPos = uFollowPos;\nfollowPos.x += range(random.y, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\nfollowPos.y += range(random.z, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\nfollowPos.z += range(random.w, 0.0, 1.0, -1.0, 1.0) * uFollowRadius;\npos += (followPos - pos) * (uFollowLerp*0.1*speed*HZ);","followPos")},fluid:function fluid(input){input.setValue("name","Mouse Fluid"),input.setLabel("Mouse Fluid");input.setValue("uniforms","\n        uProjMatrix: Cmat4\n        uProjNormalMatrix: Cmat4\n        uModelMatrix: Cmat4\n        tFluidMask: Csampler2D\n        tFluid: Csampler2D\n        uMouseStrength: 1\n        "),setPresetCodeIfRequired(input,"#require(glscreenprojection.glsl)\n\nvec3 mpos = vec3(uModelMatrix * vec4(pos, 1.0));\nvec2 screenUV = getProjection(mpos, uProjMatrix);\nvec3 flow = vec3(texture2D(tFluid, screenUV).xy, 0.0);\napplyNormal(flow, uProjNormalMatrix);\npos += flow * 0.0001 * uMouseStrength * texture2D(tFluidMask, screenUV).r;","glscreenprojection");let findCamera=proton=>{let camera=World.CAMERA,p=proton.group._parent;for(;p;)p instanceof Scene&&p.nuke&&(camera=p.nuke.camera),p=p._parent;return camera};input.customPresetCallback=async proton=>{if(!("MouseFluid"in window))return void alert("'mousefluid' module not found. To use Mouse Fluid preset, import module, load the MouseFluid class, and add a layer named 'fluid' with customCLass FluidLayer.");let camera=findCamera(proton),projection=proton.initClass(GLScreenProjection,camera);projection.start(),proton.projection=projection,Global.PLAYGROUND&&Render.start((_=>{let newCamera=findCamera(proton);newCamera!=camera&&(camera=newCamera,projection.camera=camera)}),10),proton.wait("behavior").then((_=>{proton.behavior.addUniforms({uProjMatrix:projection.uniforms.projMatrix,uModelMatrix:projection.uniforms.modelMatrix,uProjNormalMatrix:projection.uniforms.normalMatrix}),MouseFluid.instance().applyTo(proton.behavior)}))}}};function setPresetCodeIfRequired(input,presetCode,keyShaderComponentString){const editorCode=input.get("code");editorCode&&editorCode.includes(keyShaderComponentString)||input.setValue("code",presetCode)}this.register=function(name,callback){let key=name.replace(/ /g,"").toLowerCase();LIST.push({label:name,value:key}),CALLBACKS[key]=callback},this.bind=function(input){input.add("code","hidden");input.add("uniforms","hidden"),input.addSelect("preset",LIST);let callback=CALLBACKS[input.get("preset")];callback&&callback(input),input.addButton("btn",{actions:[{title:"Edit Code",callback:_=>{let editor=new UILExternalEditor(input.get("name")||"Code",300);editor.setCode(input.get("code"),"c"),editor.onSave=value=>{input.setValue("code",value),_this.onCodeEdit?.()},UIL.add(editor)}}],hideLabel:!0})}}),"static"),Class((function RenderManager(){Inherit(this,Component);const _this=this;var _hasGLUI,_hasMetal,_firingEvt,_dpr=null,_schedules=new Map,_needsDeletion=!1;function fire(evt,data){let array=_schedules.get(evt);if(array){_firingEvt=evt;let len=array.length;for(let i=0;i<len;i++){let cb=array[i];cb.markedForDeletion||(data?cb(data):cb(Render.TIME,Render.DELTA))}if(_firingEvt=void 0,_needsDeletion){for(let i=0;i<array.length;i++)array[i].markedForDeletion&&(delete array[i].markedForDeletion,array.splice(i,1),--i);_needsDeletion=!1}}}function startFrame(){fire(_this.FRAME_BEGIN)}function resizeHandler(){_this.renderer&&_this.renderer.setSize(Stage.width,Stage.height)}function getDPR(){return window.AURA?Device.pixelRatio:GPU.OVERSIZED?1:GPU.lt(0)?Math.min(1.3,Device.pixelRatio):GPU.lt(1)?Math.min(1.8,Device.pixelRatio):GPU.mobileLT(2)?Math.min(2,Device.pixelRatio):GPU.gt(4)?Math.max(1.5,Device.pixelRatio):Math.max(1.25,Device.pixelRatio)}function directRenderCallback(render){_hasGLUI&&_hasMetal&&GLUI.renderDirect(render)}this.NORMAL="normal",this.MAGIC_WINDOW="magic_window",this.VR=this.WEBVR="webvr",this.AR=this.WEBAR="webar",this.RENDER="RenderManager_render",this.BEFORE_RENDER="RenderManager_before_render",this.POST_RENDER=this.FRAME_END="RenderManager_post_render",this.EYE_RENDER="RenderManager_eye_render",this.FRAME_BEGIN="RenderManager_frame_begin",this.AFTER_LOOPS="RenderManager_after_loops",this.NATIVE_FRAMERATE="RenderManager_native_framerate",this.READY="render_gl_ready",this.initialized=Promise.create(),_this.events.sub(Events.RESIZE,resizeHandler),Render.startFrame=startFrame,Hydra.ready((_=>{_hasGLUI=!!window.GLUI,_hasMetal=!!window.Metal})),this.get("DPR",(v=>getDPR())),this.initialize=function(type,params={}){if(_this.camera&&_this.camera.destroy(),_this.renderer&&_this.renderer.destroy(),type!=_this.WEBVR&&type!=_this.WEBAR||(params.xrCompatible=!0,params.alpha=!1),!_this.gl){let camera=new PerspectiveCamera(45,Stage.width/Stage.height,.01,200);_this.gl=function(){"safari"==Device.system.browser&&Device.system.browserVersion<13&&delete params.powerPreference,Utils.query("compat")&&(params.forceWebGL1=!0);let renderer=new(window.Metal?MetalRenderer:Renderer)(params);return renderer.setSize(Stage.width,Stage.height),renderer.setPixelRatio(getDPR()),renderer}(),_this.scene=new Scene,_this.nuke=_this.initClass(Nuke,Stage,Object.assign({renderer:_this.gl,scene:_this.scene,camera:camera,dpr:World.DPR},params))}switch(_dpr=_dpr||World.DPR||1,type){case _this.WEBVR:_this.renderer=_this.initClass(VRRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.WEBAR:_this.renderer=_this.initClass(window.Metal?MetalARRenderer:ARRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(ARCamera);break;case _this.MAGIC_WINDOW:_this.renderer=_this.initClass(MagicWindowRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(VRCamera);break;case _this.NORMAL:_this.renderer=_this.initClass(RenderManagerRenderer,_this.gl,_this.nuke),_this.camera=_this.initClass(RenderManagerCamera)}_this.type=type,_this.nuke.camera=_this.camera.worldCamera,_this.initialized.resolve()},this.render=function(scene,camera,renderTarget,forceClear){fire(_this.AFTER_LOOPS),_this.type==_this.VR&&fire(World.NUKE),fire(_this.BEFORE_RENDER),_this.renderer.render(scene||_this.scene,_this.nuke.camera,renderTarget,forceClear,directRenderCallback),_this.events.fire(_this.POST_RENDER),fire(_this.POST_RENDER)},this.schedule=function(callback,slot){_schedules.has(slot)||_schedules.set(slot,[]);let array=_schedules.get(slot),index=array.indexOf(callback);index>=0&&!array[index].markedForDeletion||array.push(callback)},this.scheduleOne=function(callback,slot){let result;"function"!=typeof callback&&(slot=callback,result=Promise.create(),callback=result.resolve);let handler=function(){return _this.unschedule(handler,slot),callback.apply(this,arguments)};return _this.schedule(handler,slot),result},this.unschedule=function(callback,slot){_schedules.has(slot)||_schedules.set(slot,[]);const array=_schedules.get(slot);array.indexOf(callback)<0||(_firingEvt==slot?(callback.markedForDeletion=!0,_needsDeletion=!0):array.remove(callback))},this.setSize=function(width,height){_this.events.unsub(Events.RESIZE,resizeHandler),_this.renderer.setSize(width,height)},this.fire=fire}),"static"),Class((function RenderManagerCamera(){Inherit(this,Component);const _this=this;this.worldCamera=window.THREE?new THREE.PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3):new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3),_this.events.sub(Events.RESIZE,(()=>{_this.worldCamera.aspect=Stage.width/Stage.height,_this.worldCamera.updateProjectionMatrix()}))})),Class((function RenderManagerRenderer(_renderer,_nuke){Inherit(this,Component);const _this=this;var _evt={};_nuke.onBeforeProcess=_=>{_evt.stage=Stage,_evt.camera=_nuke.camera,_this.events.fire(RenderManager.RENDER,_evt)},this.render=function(scene,camera,_1,_2,directRender){_nuke.camera=camera,_nuke?_nuke.render(directRender):_renderer.render(scene,camera,null,null,directRender)},this.setSize=function(width,height){_renderer.setSize(width,height)}})),Class((function RichText(){this.parse=async function(_data){let node=document.createElement("article");new Quill(node,{}).setContents(_data.ops),await defer();let html=node.firstChild.innerHTML;return html=html.replace(/&lt;/g,"<").replace(/&gt;/g,">"),html}}),"static"),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Quill=e():t.Quill=e()}("undefined"!=typeof self?self:this,(function(){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=45)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(17),o=n(18),i=n(19),l=n(48),a=n(49),s=n(50),u=n(51),c=n(52),f=n(11),h=n(29),p=n(30),d=n(28),y=n(1),v={Scope:y.Scope,create:y.create,find:y.find,query:y.query,register:y.register,Container:r.default,Format:o.default,Leaf:i.default,Embed:u.default,Scroll:l.default,Block:s.default,Inline:a.default,Text:c.default,Attributor:{Attribute:f.default,Class:h.default,Style:p.default,Store:d.default}};e.default=v},function(t,e,n){"use strict";function i(t,e){var n;if(void 0===e&&(e=p.ANY),"string"==typeof t)n=h[t]||u[t];else if(t instanceof Text||t.nodeType===Node.TEXT_NODE)n=h.text;else if("number"==typeof t)t&p.LEVEL&p.BLOCK?n=h.block:t&p.LEVEL&p.INLINE&&(n=h.inline);else if(t instanceof HTMLElement){var r=(t.getAttribute("class")||"").split(/\s+/);for(var o in r)if(n=c[r[o]])break;n=n||f[t.tagName]}return null==n?null:e&p.LEVEL&n.scope&&e&p.TYPE&n.scope?n:null}var a=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(e){var n=this;return e="[Parchment] "+e,(n=t.call(this,e)||this).message=e,n.name=n.constructor.name,n}return a(e,t),e}(Error);e.ParchmentError=s;var p,u={},c={},f={},h={};e.DATA_KEY="__blot",function(t){t[t.TYPE=3]="TYPE",t[t.LEVEL=12]="LEVEL",t[t.ATTRIBUTE=13]="ATTRIBUTE",t[t.BLOT=14]="BLOT",t[t.INLINE=7]="INLINE",t[t.BLOCK=11]="BLOCK",t[t.BLOCK_BLOT=10]="BLOCK_BLOT",t[t.INLINE_BLOT=6]="INLINE_BLOT",t[t.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",t[t.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",t[t.ANY=15]="ANY"}(p=e.Scope||(e.Scope={})),e.create=function r(t,e){var n=i(t);if(null==n)throw new s("Unable to create "+t+" blot");var r=n;return new r(t instanceof Node||t.nodeType===Node.TEXT_NODE?t:r.create(e),e)},e.find=function o(t,n){return void 0===n&&(n=!1),null==t?null:null!=t[e.DATA_KEY]?t[e.DATA_KEY].blot:n?o(t.parentNode,n):null},e.query=i,e.register=function l(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(t.length>1)return t.map((function(t){return l(t)}));var n=t[0];if("string"!=typeof n.blotName&&"string"!=typeof n.attrName)throw new s("Invalid definition");if("abstract"===n.blotName)throw new s("Cannot register abstract class");if(h[n.blotName||n.attrName]=n,"string"==typeof n.keyName)u[n.keyName]=n;else if(null!=n.className&&(c[n.className]=n),null!=n.tagName){Array.isArray(n.tagName)?n.tagName=n.tagName.map((function(t){return t.toUpperCase()})):n.tagName=n.tagName.toUpperCase();var r=Array.isArray(n.tagName)?n.tagName:[n.tagName];r.forEach((function(t){null!=f[t]&&null!=n.className||(f[t]=n)}))}return n}},function(t,e){"use strict";var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===r.call(t)},i=function(t){if(!t||"[object Object]"!==r.call(t))return!1;var i,e=n.call(t,"constructor"),o=t.constructor&&t.constructor.prototype&&n.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!e&&!o)return!1;for(i in t);return void 0===i||n.call(t,i)};t.exports=function t(){var e,n,r,l,a,s,u=arguments[0],c=1,f=arguments.length,h=!1;for("boolean"==typeof u&&(h=u,u=arguments[1]||{},c=2),(null==u||"object"!=typeof u&&"function"!=typeof u)&&(u={});c<f;++c)if(null!=(e=arguments[c]))for(n in e)r=u[n],u!==(l=e[n])&&(h&&l&&(i(l)||(a=o(l)))?(a?(a=!1,s=r&&o(r)?r:[]):s=r&&i(r)?r:{},u[n]=t(h,s,l)):void 0!==l&&(u[n]=l));return u}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==t?e:("function"==typeof t.formats&&(e=(0,f.default)(e,t.formats())),null==t.parent||"scroll"==t.parent.blotName||t.parent.statics.scope!==t.statics.scope?e:a(t.parent,e))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BlockEmbed=e.bubbleFormats=void 0;var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},f=r(n(2)),p=r(n(4)),y=r(n(0)),b=r(n(14)),m=r(n(5)),O=r(n(8)),w=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),s(e,[{key:"attach",value:function(){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"attach",this).call(this),this.attributes=new y.default.Attributor.Store(this.domNode)}},{key:"delta",value:function(){return(new p.default).insert(this.value(),(0,f.default)(this.formats(),this.attributes.values()))}},{key:"format",value:function(t,e){var n=y.default.query(t,y.default.Scope.BLOCK_ATTRIBUTE);null!=n&&this.attributes.attribute(n,e)}},{key:"formatAt",value:function(t,e,n,r){this.format(n,r)}},{key:"insertAt",value:function(t,n,r){if("string"==typeof n&&n.endsWith("\n")){var o=y.default.create(x.blotName);this.parent.insertBefore(o,0===t?this:this.next),o.insertAt(0,n.slice(0,-1))}else u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertAt",this).call(this,t,n,r)}}]),e}(y.default.Embed);w.scope=y.default.Scope.BLOCK_BLOT;var x=function(t){function e(t){o(this,e);var n=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.cache={},n}return l(e,t),s(e,[{key:"delta",value:function(){return null==this.cache.delta&&(this.cache.delta=this.descendants(y.default.Leaf).reduce((function(t,e){return 0===e.length()?t:t.insert(e.value(),a(e))}),new p.default).insert("\n",a(this))),this.cache.delta}},{key:"deleteAt",value:function(t,n){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deleteAt",this).call(this,t,n),this.cache={}}},{key:"formatAt",value:function(t,n,r,o){n<=0||(y.default.query(r,y.default.Scope.BLOCK)?t+n===this.length()&&this.format(r,o):u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"formatAt",this).call(this,t,Math.min(n,this.length()-t-1),r,o),this.cache={})}},{key:"insertAt",value:function(t,n,r){if(null!=r)return u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertAt",this).call(this,t,n,r);if(0!==n.length){var o=n.split("\n"),i=o.shift();i.length>0&&(t<this.length()-1||null==this.children.tail?u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertAt",this).call(this,Math.min(t,this.length()-1),i):this.children.tail.insertAt(this.children.tail.length(),i),this.cache={});var l=this;o.reduce((function(t,e){return(l=l.split(t,!0)).insertAt(0,e),e.length}),t+i.length)}}},{key:"insertBefore",value:function(t,n){var r=this.children.head;u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertBefore",this).call(this,t,n),r instanceof b.default&&r.remove(),this.cache={}}},{key:"length",value:function(){return null==this.cache.length&&(this.cache.length=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"length",this).call(this)+1),this.cache.length}},{key:"moveChildren",value:function(t,n){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"moveChildren",this).call(this,t,n),this.cache={}}},{key:"optimize",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t),this.cache={}}},{key:"path",value:function(t){return u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"path",this).call(this,t,!0)}},{key:"removeChild",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"removeChild",this).call(this,t),this.cache={}}},{key:"split",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(n&&(0===t||t>=this.length()-1)){var r=this.clone();return 0===t?(this.parent.insertBefore(r,this),this):(this.parent.insertBefore(r,this.next),r)}var o=u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"split",this).call(this,t,n);return this.cache={},o}}]),e}(y.default.Block);x.blotName="block",x.tagName="P",x.defaultChild="break",x.allowedChildren=[m.default,y.default.Embed,O.default],e.bubbleFormats=a,e.BlockEmbed=w,e.default=x},function(t,e,n){var r=n(54),o=n(12),i=n(2),l=n(20),a=String.fromCharCode(0),s=function(t){Array.isArray(t)?this.ops=t:null!=t&&Array.isArray(t.ops)?this.ops=t.ops:this.ops=[]};s.prototype.insert=function(t,e){var n={};return 0===t.length?this:(n.insert=t,null!=e&&"object"==typeof e&&Object.keys(e).length>0&&(n.attributes=e),this.push(n))},s.prototype.delete=function(t){return t<=0?this:this.push({delete:t})},s.prototype.retain=function(t,e){if(t<=0)return this;var n={retain:t};return null!=e&&"object"==typeof e&&Object.keys(e).length>0&&(n.attributes=e),this.push(n)},s.prototype.push=function(t){var e=this.ops.length,n=this.ops[e-1];if(t=i(!0,{},t),"object"==typeof n){if("number"==typeof t.delete&&"number"==typeof n.delete)return this.ops[e-1]={delete:n.delete+t.delete},this;if("number"==typeof n.delete&&null!=t.insert&&(e-=1,"object"!=typeof(n=this.ops[e-1])))return this.ops.unshift(t),this;if(o(t.attributes,n.attributes)){if("string"==typeof t.insert&&"string"==typeof n.insert)return this.ops[e-1]={insert:n.insert+t.insert},"object"==typeof t.attributes&&(this.ops[e-1].attributes=t.attributes),this;if("number"==typeof t.retain&&"number"==typeof n.retain)return this.ops[e-1]={retain:n.retain+t.retain},"object"==typeof t.attributes&&(this.ops[e-1].attributes=t.attributes),this}}return e===this.ops.length?this.ops.push(t):this.ops.splice(e,0,t),this},s.prototype.chop=function(){var t=this.ops[this.ops.length-1];return t&&t.retain&&!t.attributes&&this.ops.pop(),this},s.prototype.filter=function(t){return this.ops.filter(t)},s.prototype.forEach=function(t){this.ops.forEach(t)},s.prototype.map=function(t){return this.ops.map(t)},s.prototype.partition=function(t){var e=[],n=[];return this.forEach((function(r){(t(r)?e:n).push(r)})),[e,n]},s.prototype.reduce=function(t,e){return this.ops.reduce(t,e)},s.prototype.changeLength=function(){return this.reduce((function(t,e){return e.insert?t+l.length(e):e.delete?t-e.delete:t}),0)},s.prototype.length=function(){return this.reduce((function(t,e){return t+l.length(e)}),0)},s.prototype.slice=function(t,e){t=t||0,"number"!=typeof e&&(e=1/0);for(var n=[],r=l.iterator(this.ops),o=0;o<e&&r.hasNext();){var i;o<t?i=r.next(t-o):(i=r.next(e-o),n.push(i)),o+=l.length(i)}return new s(n)},s.prototype.compose=function(t){for(var e=l.iterator(this.ops),n=l.iterator(t.ops),r=new s;e.hasNext()||n.hasNext();)if("insert"===n.peekType())r.push(n.next());else if("delete"===e.peekType())r.push(e.next());else{var o=Math.min(e.peekLength(),n.peekLength()),i=e.next(o),a=n.next(o);if("number"==typeof a.retain){var u={};"number"==typeof i.retain?u.retain=o:u.insert=i.insert;var c=l.attributes.compose(i.attributes,a.attributes,"number"==typeof i.retain);c&&(u.attributes=c),r.push(u)}else"number"==typeof a.delete&&"number"==typeof i.retain&&r.push(a)}return r.chop()},s.prototype.concat=function(t){var e=new s(this.ops.slice());return t.ops.length>0&&(e.push(t.ops[0]),e.ops=e.ops.concat(t.ops.slice(1))),e},s.prototype.diff=function(t,e){if(this.ops===t.ops)return new s;var n=[this,t].map((function(e){return e.map((function(n){if(null!=n.insert)return"string"==typeof n.insert?n.insert:a;throw new Error("diff() called "+(e===t?"on":"with")+" non-document")})).join("")})),i=new s,u=r(n[0],n[1],e),c=l.iterator(this.ops),f=l.iterator(t.ops);return u.forEach((function(t){for(var e=t[1].length;e>0;){var n=0;switch(t[0]){case r.INSERT:n=Math.min(f.peekLength(),e),i.push(f.next(n));break;case r.DELETE:n=Math.min(e,c.peekLength()),c.next(n),i.delete(n);break;case r.EQUAL:n=Math.min(c.peekLength(),f.peekLength(),e);var a=c.next(n),s=f.next(n);o(a.insert,s.insert)?i.retain(n,l.attributes.diff(a.attributes,s.attributes)):i.push(s).delete(n)}e-=n}})),i.chop()},s.prototype.eachLine=function(t,e){e=e||"\n";for(var n=l.iterator(this.ops),r=new s,o=0;n.hasNext();){if("insert"!==n.peekType())return;var i=n.peek(),a=l.length(i)-n.peekLength(),u="string"==typeof i.insert?i.insert.indexOf(e,a)-a:-1;if(u<0)r.push(n.next());else if(u>0)r.push(n.next(u));else{if(!1===t(r,n.next(1).attributes||{},o))return;o+=1,r=new s}}r.length()>0&&t(r,{},o)},s.prototype.transform=function(t,e){if(e=!!e,"number"==typeof t)return this.transformPosition(t,e);for(var n=l.iterator(this.ops),r=l.iterator(t.ops),o=new s;n.hasNext()||r.hasNext();)if("insert"!==n.peekType()||!e&&"insert"===r.peekType())if("insert"===r.peekType())o.push(r.next());else{var i=Math.min(n.peekLength(),r.peekLength()),a=n.next(i),u=r.next(i);if(a.delete)continue;u.delete?o.push(u):o.retain(i,l.attributes.transform(a.attributes,u.attributes,e))}else o.retain(l.length(n.next()));return o.chop()},s.prototype.transformPosition=function(t,e){e=!!e;for(var n=l.iterator(this.ops),r=0;n.hasNext()&&r<=t;){var o=n.peekLength(),i=n.peekType();n.next(),"delete"!==i?("insert"===i&&(r<t||!e)&&(t+=o),r+=o):t-=Math.min(o,t-r)}return t},t.exports=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=r(n(8)),h=r(n(0)),p=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"formatAt",value:function(t,n,r,o){if(e.compare(this.statics.blotName,r)<0&&h.default.query(r,h.default.Scope.BLOT)){var i=this.isolate(t,n);o&&i.wrap(r,o)}else s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"formatAt",this).call(this,t,n,r,o)}},{key:"optimize",value:function(t){if(s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t),this.parent instanceof e&&e.compare(this.statics.blotName,this.parent.statics.blotName)>0){var n=this.parent.isolate(this.offset(),this.length());this.moveChildren(n),n.wrap(this)}}}],[{key:"compare",value:function(t,n){var r=e.order.indexOf(t),o=e.order.indexOf(n);return r>=0||o>=0?r-o:t===n?0:t<n?-1:1}}]),e}(h.default.Inline);p.allowedChildren=[p,h.default.Embed,c.default],p.order=["cursor","inline","underline","strike","italic","bold","script","link","code"],e.default=p},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if((e=(0,N.default)(!0,{container:t,modules:{clipboard:!0,keyboard:!0,history:!0}},e)).theme&&e.theme!==S.DEFAULTS.theme){if(e.theme=S.import("themes/"+e.theme),null==e.theme)throw new Error("Invalid theme "+e.theme+". Did you register it?")}else e.theme=T.default;var n=(0,N.default)(!0,{},e.theme.DEFAULTS);[n,e].forEach((function(t){t.modules=t.modules||{},Object.keys(t.modules).forEach((function(e){!0===t.modules[e]&&(t.modules[e]={})}))}));var o=Object.keys(n.modules).concat(Object.keys(e.modules)).reduce((function(t,e){var n=S.import("modules/"+e);return null==n?P.error("Cannot load "+e+" module. Are you sure you registered it?"):t[e]=n.DEFAULTS||{},t}),{});return null!=e.modules&&e.modules.toolbar&&e.modules.toolbar.constructor!==Object&&(e.modules.toolbar={container:e.modules.toolbar}),e=(0,N.default)(!0,{},S.DEFAULTS,{modules:o},n,e),["bounds","container","scrollingContainer"].forEach((function(t){"string"==typeof e[t]&&(e[t]=document.querySelector(e[t]))})),e.modules=Object.keys(e.modules).reduce((function(t,n){return e.modules[n]&&(t[n]=e.modules[n]),t}),{}),e}function a(t,e,n,r){if(this.options.strict&&!this.isEnabled()&&e===g.default.sources.USER)return new d.default;var o=null==n?null:this.getSelection(),i=this.editor.delta,l=t();if(null!=o&&(!0===n&&(n=o.index),null==r?o=u(o,l,e):0!==r&&(o=u(o,n,r,e)),this.setSelection(o,g.default.sources.SILENT)),l.length()>0){var a,c,s=[g.default.events.TEXT_CHANGE,l,i,e];if((a=this.emitter).emit.apply(a,[g.default.events.EDITOR_CHANGE].concat(s)),e!==g.default.sources.SILENT)(c=this.emitter).emit.apply(c,s)}return l}function s(t,e,n,r,o){var i={};return"number"==typeof t.index&&"number"==typeof t.length?"number"!=typeof e?(o=r,r=n,n=e,e=t.length,t=t.index):(e=t.length,t=t.index):"number"!=typeof e&&(o=r,r=n,n=e,e=0),"object"===(void 0===n?"undefined":c(n))?(i=n,o=r):"string"==typeof n&&(null!=r?i[n]=r:o=n),[t,e,i,o=o||g.default.sources.API]}function u(t,e,n,r){if(null==t)return null;var o=void 0,i=void 0;if(e instanceof d.default){var l=[t.index,t.index+t.length].map((function(t){return e.transformPosition(t,r!==g.default.sources.USER)})),a=f(l,2);o=a[0],i=a[1]}else{var s=[t.index,t.index+t.length].map((function(t){return t<e||t===e&&r===g.default.sources.USER?t:n>=0?t+n:Math.max(e,t+n)})),u=f(s,2);o=u[0],i=u[1]}return new x.Range(o,i-o)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.overload=e.expandConfig=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n(53);var d=r(n(4)),v=r(n(57)),g=r(n(9)),_=r(n(7)),w=r(n(0)),x=n(22),k=r(x),N=r(n(2)),A=r(n(10)),T=r(n(32)),P=(0,A.default)("quill"),S=function(){function t(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(i(this,t),this.options=l(e,r),this.container=this.options.container,null==this.container)return P.error("Invalid Quill container",e);this.options.debug&&t.debug(this.options.debug);var o=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",this.container.__quill=this,this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.root.setAttribute("data-gramm",!1),this.scrollingContainer=this.options.scrollingContainer||this.root,this.emitter=new g.default,this.scroll=w.default.create(this.root,{emitter:this.emitter,whitelist:this.options.formats}),this.editor=new v.default(this.scroll),this.selection=new k.default(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.theme.init(),this.emitter.on(g.default.events.EDITOR_CHANGE,(function(t){t===g.default.events.TEXT_CHANGE&&n.root.classList.toggle("ql-blank",n.editor.isBlank())})),this.emitter.on(g.default.events.SCROLL_UPDATE,(function(t,e){var r=n.selection.lastRange,o=r&&0===r.length?r.index:void 0;a.call(n,(function(){return n.editor.update(null,e,o)}),t)}));var s=this.clipboard.convert("<div class='ql-editor' style=\"white-space: normal;\">"+o+"<p><br></p></div>");this.setContents(s),this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable()}return h(t,null,[{key:"debug",value:function(t){!0===t&&(t="log"),A.default.level(t)}},{key:"find",value:function(t){return t.__quill||w.default.find(t)}},{key:"import",value:function(t){return null==this.imports[t]&&P.error("Cannot import "+t+". Are you sure it was registered?"),this.imports[t]}},{key:"register",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("string"!=typeof t){var o=t.attrName||t.blotName;"string"==typeof o?this.register("formats/"+o,t,e):Object.keys(t).forEach((function(r){n.register(r,t[r],e)}))}else null==this.imports[t]||r||P.warn("Overwriting "+t+" with",e),this.imports[t]=e,(t.startsWith("blots/")||t.startsWith("formats/"))&&"abstract"!==e.blotName?w.default.register(e):t.startsWith("modules")&&"function"==typeof e.register&&e.register()}}]),h(t,[{key:"addContainer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if("string"==typeof t){var n=t;(t=document.createElement("div")).classList.add(n)}return this.container.insertBefore(t,e),t}},{key:"blur",value:function(){this.selection.setRange(null)}},{key:"deleteText",value:function(t,e,n){var r=this,o=s(t,e,n),i=f(o,4);return t=i[0],e=i[1],n=i[3],a.call(this,(function(){return r.editor.deleteText(t,e)}),n,t,-1*e)}},{key:"disable",value:function(){this.enable(!1)}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.scroll.enable(t),this.container.classList.toggle("ql-disabled",!t)}},{key:"focus",value:function(){var t=this.scrollingContainer.scrollTop;this.selection.focus(),this.scrollingContainer.scrollTop=t,this.scrollIntoView()}},{key:"format",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.default.sources.API;return a.call(this,(function(){var r=n.getSelection(!0),i=new d.default;if(null==r)return i;if(w.default.query(t,w.default.Scope.BLOCK))i=n.editor.formatLine(r.index,r.length,o({},t,e));else{if(0===r.length)return n.selection.format(t,e),i;i=n.editor.formatText(r.index,r.length,o({},t,e))}return n.setSelection(r,g.default.sources.SILENT),i}),r)}},{key:"formatLine",value:function(t,e,n,r,o){var l,i=this,u=s(t,e,n,r,o),c=f(u,4);return t=c[0],e=c[1],l=c[2],o=c[3],a.call(this,(function(){return i.editor.formatLine(t,e,l)}),o,t,0)}},{key:"formatText",value:function(t,e,n,r,o){var l,i=this,u=s(t,e,n,r,o),c=f(u,4);return t=c[0],e=c[1],l=c[2],o=c[3],a.call(this,(function(){return i.editor.formatText(t,e,l)}),o,t,0)}},{key:"getBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=void 0;n="number"==typeof t?this.selection.getBounds(t,e):this.selection.getBounds(t.index,t.length);var r=this.container.getBoundingClientRect();return{bottom:n.bottom-r.top,height:n.height,left:n.left-r.left,right:n.right-r.left,top:n.top-r.top,width:n.width}}},{key:"getContents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getLength()-t,n=s(t,e),r=f(n,2);return t=r[0],e=r[1],this.editor.getContents(t,e)}},{key:"getFormat",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelection(!0),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"number"==typeof t?this.editor.getFormat(t,e):this.editor.getFormat(t.index,t.length)}},{key:"getIndex",value:function(t){return t.offset(this.scroll)}},{key:"getLength",value:function(){return this.scroll.length()}},{key:"getLeaf",value:function(t){return this.scroll.leaf(t)}},{key:"getLine",value:function(t){return this.scroll.line(t)}},{key:"getLines",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return"number"!=typeof t?this.scroll.lines(t.index,t.length):this.scroll.lines(t,e)}},{key:"getModule",value:function(t){return this.theme.modules[t]}},{key:"getSelection",value:function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this.focus(),this.update(),this.selection.getRange()[0]}},{key:"getText",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getLength()-t,n=s(t,e),r=f(n,2);return t=r[0],e=r[1],this.editor.getText(t,e)}},{key:"hasFocus",value:function(){return this.selection.hasFocus()}},{key:"insertEmbed",value:function(e,n,r){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.sources.API;return a.call(this,(function(){return o.editor.insertEmbed(e,n,r)}),i,e)}},{key:"insertText",value:function(t,e,n,r,o){var l,i=this,u=s(t,0,n,r,o),c=f(u,4);return t=c[0],l=c[2],o=c[3],a.call(this,(function(){return i.editor.insertText(t,e,l)}),o,t,e.length)}},{key:"isEnabled",value:function(){return!this.container.classList.contains("ql-disabled")}},{key:"off",value:function(){return this.emitter.off.apply(this.emitter,arguments)}},{key:"on",value:function(){return this.emitter.on.apply(this.emitter,arguments)}},{key:"once",value:function(){return this.emitter.once.apply(this.emitter,arguments)}},{key:"pasteHTML",value:function(t,e,n){this.clipboard.dangerouslyPasteHTML(t,e,n)}},{key:"removeFormat",value:function(t,e,n){var r=this,o=s(t,e,n),i=f(o,4);return t=i[0],e=i[1],n=i[3],a.call(this,(function(){return r.editor.removeFormat(t,e)}),n,t)}},{key:"scrollIntoView",value:function(){this.selection.scrollIntoView(this.scrollingContainer)}},{key:"setContents",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.default.sources.API;return a.call(this,(function(){t=new d.default(t);var n=e.getLength(),r=e.editor.deleteText(0,n),o=e.editor.applyDelta(t),i=o.ops[o.ops.length-1];return null!=i&&"string"==typeof i.insert&&"\n"===i.insert[i.insert.length-1]&&(e.editor.deleteText(e.getLength()-1,1),o.delete(1)),r.compose(o)}),n)}},{key:"setSelection",value:function(e,n,r){if(null==e)this.selection.setRange(null,n||t.sources.API);else{var o=s(e,n,r),i=f(o,4);e=i[0],n=i[1],r=i[3],this.selection.setRange(new x.Range(e,n),r),r!==g.default.sources.SILENT&&this.selection.scrollIntoView(this.scrollingContainer)}}},{key:"setText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.default.sources.API,n=(new d.default).insert(t);return this.setContents(n,e)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.default.sources.USER,e=this.scroll.update(t);return this.selection.update(t),e}},{key:"updateContents",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g.default.sources.API;return a.call(this,(function(){return t=new d.default(t),e.editor.applyDelta(t,n)}),n,!0)}}]),t}();S.DEFAULTS={bounds:null,formats:null,modules:{},placeholder:"",readOnly:!1,scrollingContainer:null,strict:!0,theme:"default"},S.events=g.default.events,S.sources=g.default.sources,S.version="1.3.6",S.imports={delta:d.default,parchment:w.default,"core/module":_.default,"core/theme":T.default},e.expandConfig=l,e.overload=s,e.default=S},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,t),this.quill=e,this.options=n};o.DEFAULTS={},e.default=o},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(0)).default.Text);e.default=s},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=r(n(58)),p=(0,r(n(10)).default)("quill:events");["selectionchange","mousedown","mouseup","click"].forEach((function(t){document.addEventListener(t,(function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];[].slice.call(document.querySelectorAll(".ql-container")).forEach((function(t){var n;t.__quill&&t.__quill.emitter&&(n=t.__quill.emitter).handleDOM.apply(n,e)}))}))}));var d=function(t){function e(){!function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.listeners={},t.on("error",p.error),t}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"emit",value:function(){p.log.apply(p,arguments),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"emit",this).apply(this,arguments)}},{key:"handleDOM",value:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];(this.listeners[t.type]||[]).forEach((function(e){var r=e.node,o=e.handler;(t.target===r||r.contains(t.target))&&o.apply(void 0,[t].concat(n))}))}},{key:"listenDOM",value:function(t,e,n){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push({node:e,handler:n})}}]),e}(c.default);d.events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change"},d.sources={API:"api",SILENT:"silent",USER:"user"},e.default=d},function(t,e,n){"use strict";function r(t){if(i.indexOf(t)<=i.indexOf(l)){for(var e,n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];(e=console)[t].apply(e,r)}}function o(t){return i.reduce((function(e,n){return e[n]=r.bind(console,n,t),e}),{})}Object.defineProperty(e,"__esModule",{value:!0});var i=["error","warn","log","info"],l="warn";r.level=o.level=function(t){l=t},e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=function(){function t(t,e,n){void 0===n&&(n={}),this.attrName=t,this.keyName=e;var o=r.Scope.TYPE&r.Scope.ATTRIBUTE;null!=n.scope?this.scope=n.scope&r.Scope.LEVEL|o:this.scope=r.Scope.ATTRIBUTE,null!=n.whitelist&&(this.whitelist=n.whitelist)}return t.keys=function(t){return[].map.call(t.attributes,(function(t){return t.name}))},t.prototype.add=function(t,e){return!!this.canAdd(t,e)&&(t.setAttribute(this.keyName,e),!0)},t.prototype.canAdd=function(t,e){return null!=r.query(t,r.Scope.BLOT&(this.scope|r.Scope.TYPE))&&(null==this.whitelist||("string"==typeof e?this.whitelist.indexOf(e.replace(/["']/g,""))>-1:this.whitelist.indexOf(e)>-1))},t.prototype.remove=function(t){t.removeAttribute(this.keyName)},t.prototype.value=function(t){var e=t.getAttribute(this.keyName);return this.canAdd(t,e)&&e?e:""},t}();e.default=o},function(t,e,n){function r(t){return null==t}function o(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length||"function"!=typeof t.copy||"function"!=typeof t.slice||t.length>0&&"number"!=typeof t[0])}var l=Array.prototype.slice,a=n(55),s=n(56),u=t.exports=function(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?n.strict?t===e:t==e:function i(t,e,n){var i,c;if(r(t)||r(e))return!1;if(t.prototype!==e.prototype)return!1;if(s(t))return!!s(e)&&(t=l.call(t),e=l.call(e),u(t,e,n));if(o(t)){if(!o(e))return!1;if(t.length!==e.length)return!1;for(i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}try{var f=a(t),h=a(e)}catch(t){return!1}if(f.length!=h.length)return!1;for(f.sort(),h.sort(),i=f.length-1;i>=0;i--)if(f[i]!=h[i])return!1;for(i=f.length-1;i>=0;i--)if(c=f[i],!u(t[c],e[c],n))return!1;return typeof t==typeof e}(t,e,n))}},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.Code=void 0;var a=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},f=r(n(4)),p=r(n(0)),y=r(n(3)),b=r(n(5)),m=r(n(8)),_=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),e}(b.default);_.blotName="code",_.tagName="CODE";var O=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),s(e,[{key:"delta",value:function(){var t=this,e=this.domNode.textContent;return e.endsWith("\n")&&(e=e.slice(0,-1)),e.split("\n").reduce((function(e,n){return e.insert(n).insert("\n",t.formats())}),new f.default)}},{key:"format",value:function(t,n){if(t!==this.statics.blotName||!n){var r=this.descendant(m.default,this.length()-1),i=a(r,1)[0];null!=i&&i.deleteAt(i.length()-1,1),u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n)}}},{key:"formatAt",value:function(t,n,r,o){if(0!==n&&null!=p.default.query(r,p.default.Scope.BLOCK)&&(r!==this.statics.blotName||o!==this.statics.formats(this.domNode))){var i=this.newlineIndex(t);if(!(i<0||i>=t+n)){var l=this.newlineIndex(t,!0)+1,a=i-l+1,s=this.isolate(l,a),u=s.next;s.format(r,o),u instanceof e&&u.formatAt(0,t-l+n-a,r,o)}}}},{key:"insertAt",value:function(t,e,n){if(null==n){var r=this.descendant(m.default,t),o=a(r,2),i=o[0],l=o[1];i.insertAt(l,e)}}},{key:"length",value:function(){var t=this.domNode.textContent.length;return this.domNode.textContent.endsWith("\n")?t:t+1}},{key:"newlineIndex",value:function(t){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1])return this.domNode.textContent.slice(0,t).lastIndexOf("\n");var e=this.domNode.textContent.slice(t).indexOf("\n");return e>-1?t+e:-1}},{key:"optimize",value:function(t){this.domNode.textContent.endsWith("\n")||this.appendChild(p.default.create("text","\n")),u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t);var n=this.next;null!=n&&n.prev===this&&n.statics.blotName===this.statics.blotName&&this.statics.formats(this.domNode)===n.statics.formats(n.domNode)&&(n.optimize(t),n.moveChildren(this),n.remove())}},{key:"replace",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"replace",this).call(this,t),[].slice.call(this.domNode.querySelectorAll("*")).forEach((function(t){var e=p.default.find(t);null==e?t.parentNode.removeChild(t):e instanceof p.default.Embed?e.remove():e.unwrap()}))}}],[{key:"create",value:function(t){var n=u(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return n.setAttribute("spellcheck",!1),n}},{key:"formats",value:function(){return!0}}]),e}(y.default);O.blotName="code-block",O.tagName="PRE",O.TAB="  ",e.Code=_,e.default=O},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"insertInto",value:function(t,n){0===t.children.length?a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertInto",this).call(this,t,n):this.remove()}},{key:"length",value:function(){return 0}},{key:"value",value:function(){return""}}],[{key:"value",value:function(){}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(0)).default.Embed);c.blotName="break",c.tagName="BR",e.default=c},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){var n=document.createElement("a");n.href=t;var r=n.href.slice(0,n.href.indexOf(":"));return e.indexOf(r)>-1}Object.defineProperty(e,"__esModule",{value:!0}),e.sanitize=e.default=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},f=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"format",value:function(t,n){if(t!==this.statics.blotName||!n)return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n);n=this.constructor.sanitize(n),this.domNode.setAttribute("href",n)}}],[{key:"create",value:function(t){var n=s(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return t=this.sanitize(t),n.setAttribute("href",t),n.setAttribute("target","_blank"),n}},{key:"formats",value:function(t){return t.getAttribute("href")}},{key:"sanitize",value:function(t){return l(t,this.PROTOCOL_WHITELIST)?t:this.SANITIZED_URL}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(5)).default);f.blotName="link",f.tagName="A",f.SANITIZED_URL="about:blank",f.PROTOCOL_WHITELIST=["http","https","mailto","tel"],e.default=f,e.sanitize=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){t.setAttribute(e,!("true"===t.getAttribute(e)))}Object.defineProperty(e,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=r(n(25)),f=r(n(106)),h=0,p=function(){function t(e){var n=this;(function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",(function(){n.togglePicker()})),this.label.addEventListener("keydown",(function(t){switch(t.keyCode){case u.default.keys.ENTER:n.togglePicker();break;case u.default.keys.ESCAPE:n.escape(),t.preventDefault()}})),this.select.addEventListener("change",this.update.bind(this))}return a(t,[{key:"togglePicker",value:function(){this.container.classList.toggle("ql-expanded"),i(this.label,"aria-expanded"),i(this.options,"aria-hidden")}},{key:"buildItem",value:function(t){var e=this,n=document.createElement("span");return n.tabIndex="0",n.setAttribute("role","button"),n.classList.add("ql-picker-item"),t.hasAttribute("value")&&n.setAttribute("data-value",t.getAttribute("value")),t.textContent&&n.setAttribute("data-label",t.textContent),n.addEventListener("click",(function(){e.selectItem(n,!0)})),n.addEventListener("keydown",(function(t){switch(t.keyCode){case u.default.keys.ENTER:e.selectItem(n,!0),t.preventDefault();break;case u.default.keys.ESCAPE:e.escape(),t.preventDefault()}})),n}},{key:"buildLabel",value:function(){var t=document.createElement("span");return t.classList.add("ql-picker-label"),t.innerHTML=f.default,t.tabIndex="0",t.setAttribute("role","button"),t.setAttribute("aria-expanded","false"),this.container.appendChild(t),t}},{key:"buildOptions",value:function(){var t=this,e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id="ql-picker-options-"+h,h+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,[].slice.call(this.select.options).forEach((function(n){var r=t.buildItem(n);e.appendChild(r),!0===n.selected&&t.selectItem(r)})),this.container.appendChild(e)}},{key:"buildPicker",value:function(){var t=this;[].slice.call(this.select.attributes).forEach((function(e){t.container.setAttribute(e.name,e.value)})),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}},{key:"escape",value:function(){var t=this;this.close(),setTimeout((function(){return t.label.focus()}),1)}},{key:"close",value:function(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}},{key:"selectItem",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this.container.querySelector(".ql-selected");if(t!==n&&(null!=n&&n.classList.remove("ql-selected"),null!=t&&(t.classList.add("ql-selected"),this.select.selectedIndex=[].indexOf.call(t.parentNode.children,t),t.hasAttribute("data-value")?this.label.setAttribute("data-value",t.getAttribute("data-value")):this.label.removeAttribute("data-value"),t.hasAttribute("data-label")?this.label.setAttribute("data-label",t.getAttribute("data-label")):this.label.removeAttribute("data-label"),e))){if("function"==typeof Event)this.select.dispatchEvent(new Event("change"));else if("object"===("undefined"==typeof Event?"undefined":l(Event))){var r=document.createEvent("Event");r.initEvent("change",!0,!0),this.select.dispatchEvent(r)}this.close()}}},{key:"update",value:function(){var t=void 0;if(this.select.selectedIndex>-1){var e=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];t=this.select.options[this.select.selectedIndex],this.selectItem(e)}else this.selectItem(null);var n=null!=t&&t!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",n)}}]),t}();e.default=p},function(t,e,n){"use strict";function r(t){var e=a.find(t);if(null==e)try{e=a.create(t)}catch(n){e=a.create(a.Scope.INLINE),[].slice.call(t.childNodes).forEach((function(t){e.domNode.appendChild(t)})),t.parentNode&&t.parentNode.replaceChild(e.domNode,t),e.attach()}return e}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(47),l=n(27),a=n(1),s=function(t){function e(e){var n=t.call(this,e)||this;return n.build(),n}return o(e,t),e.prototype.appendChild=function(t){this.insertBefore(t)},e.prototype.attach=function(){t.prototype.attach.call(this),this.children.forEach((function(t){t.attach()}))},e.prototype.build=function(){var t=this;this.children=new i.default,[].slice.call(this.domNode.childNodes).reverse().forEach((function(e){try{var n=r(e);t.insertBefore(n,t.children.head||void 0)}catch(t){if(t instanceof a.ParchmentError)return;throw t}}))},e.prototype.deleteAt=function(t,e){if(0===t&&e===this.length())return this.remove();this.children.forEachAt(t,e,(function(t,e,n){t.deleteAt(e,n)}))},e.prototype.descendant=function(t,n){var r=this.children.find(n),o=r[0],i=r[1];return null==t.blotName&&t(o)||null!=t.blotName&&o instanceof t?[o,i]:o instanceof e?o.descendant(t,i):[null,-1]},e.prototype.descendants=function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=Number.MAX_VALUE);var o=[],i=r;return this.children.forEachAt(n,r,(function(n,r,l){(null==t.blotName&&t(n)||null!=t.blotName&&n instanceof t)&&o.push(n),n instanceof e&&(o=o.concat(n.descendants(t,r,i))),i-=l})),o},e.prototype.detach=function(){this.children.forEach((function(t){t.detach()})),t.prototype.detach.call(this)},e.prototype.formatAt=function(t,e,n,r){this.children.forEachAt(t,e,(function(t,e,o){t.formatAt(e,o,n,r)}))},e.prototype.insertAt=function(t,e,n){var r=this.children.find(t),o=r[0],i=r[1];if(o)o.insertAt(i,e,n);else{var l=null==n?a.create("text",e):a.create(e,n);this.appendChild(l)}},e.prototype.insertBefore=function(t,e){if(null!=this.statics.allowedChildren&&!this.statics.allowedChildren.some((function(e){return t instanceof e})))throw new a.ParchmentError("Cannot insert "+t.statics.blotName+" into "+this.statics.blotName);t.insertInto(this,e)},e.prototype.length=function(){return this.children.reduce((function(t,e){return t+e.length()}),0)},e.prototype.moveChildren=function(t,e){this.children.forEach((function(n){t.insertBefore(n,e)}))},e.prototype.optimize=function(e){if(t.prototype.optimize.call(this,e),0===this.children.length)if(null!=this.statics.defaultChild){var n=a.create(this.statics.defaultChild);this.appendChild(n),n.optimize(e)}else this.remove()},e.prototype.path=function(t,n){void 0===n&&(n=!1);var r=this.children.find(t,n),o=r[0],i=r[1],l=[[this,t]];return o instanceof e?l.concat(o.path(i,n)):(null!=o&&l.push([o,i]),l)},e.prototype.removeChild=function(t){this.children.remove(t)},e.prototype.replace=function(n){n instanceof e&&n.moveChildren(this),t.prototype.replace.call(this,n)},e.prototype.split=function(t,e){if(void 0===e&&(e=!1),!e){if(0===t)return this;if(t===this.length())return this.next}var n=this.clone();return this.parent.insertBefore(n,this.next),this.children.forEachAt(t,this.length(),(function(t,r,o){t=t.split(r,e),n.appendChild(t)})),n},e.prototype.unwrap=function(){this.moveChildren(this.parent,this.next),this.remove()},e.prototype.update=function(t,e){var n=this,o=[],i=[];t.forEach((function(t){t.target===n.domNode&&"childList"===t.type&&(o.push.apply(o,t.addedNodes),i.push.apply(i,t.removedNodes))})),i.forEach((function(t){if(!(null!=t.parentNode&&"IFRAME"!==t.tagName&&document.body.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)){var e=a.find(t);null!=e&&(null!=e.domNode.parentNode&&e.domNode.parentNode!==n.domNode||e.detach())}})),o.filter((function(t){return t.parentNode==n.domNode})).sort((function(t,e){return t===e?0:t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1})).forEach((function(t){var e=null;null!=t.nextSibling&&(e=a.find(t.nextSibling));var o=r(t);o.next==e&&null!=o.next||(null!=o.parent&&o.parent.removeChild(n),n.insertBefore(o,e||void 0))}))},e}(l.default);e.default=s},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(11),i=n(28),l=n(17),a=n(1),s=function(t){function e(e){var n=t.call(this,e)||this;return n.attributes=new i.default(n.domNode),n}return r(e,t),e.formats=function(t){return"string"==typeof this.tagName||(Array.isArray(this.tagName)?t.tagName.toLowerCase():void 0)},e.prototype.format=function(t,e){var n=a.query(t);n instanceof o.default?this.attributes.attribute(n,e):e&&(null==n||t===this.statics.blotName&&this.formats()[t]===e||this.replaceWith(t,e))},e.prototype.formats=function(){var t=this.attributes.values(),e=this.statics.formats(this.domNode);return null!=e&&(t[this.statics.blotName]=e),t},e.prototype.replaceWith=function(e,n){var r=t.prototype.replaceWith.call(this,e,n);return this.attributes.copy(r),r},e.prototype.update=function(e,n){var r=this;t.prototype.update.call(this,e,n),e.some((function(t){return t.target===r.domNode&&"attributes"===t.type}))&&this.attributes.build()},e.prototype.wrap=function(n,r){var o=t.prototype.wrap.call(this,n,r);return o instanceof e&&o.statics.scope===this.statics.scope&&this.attributes.move(o),o},e}(l.default);e.default=s},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(27),i=n(1),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.value=function(t){return!0},e.prototype.index=function(t,e){return this.domNode===t||this.domNode.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(e,1):-1},e.prototype.position=function(t,e){var n=[].indexOf.call(this.parent.domNode.childNodes,this.domNode);return t>0&&(n+=1),[this.parent.domNode,n]},e.prototype.value=function(){return(t={})[this.statics.blotName]=this.statics.value(this.domNode)||!0,t;var t},e.scope=i.Scope.INLINE_BLOT,e}(o.default);e.default=l},function(t,e,n){function r(t){this.ops=t,this.index=0,this.offset=0}var o=n(12),i=n(2),l={attributes:{compose:function(t,e,n){"object"!=typeof t&&(t={}),"object"!=typeof e&&(e={});var r=i(!0,{},e);for(var o in n||(r=Object.keys(r).reduce((function(t,e){return null!=r[e]&&(t[e]=r[e]),t}),{})),t)void 0!==t[o]&&void 0===e[o]&&(r[o]=t[o]);return Object.keys(r).length>0?r:void 0},diff:function(t,e){"object"!=typeof t&&(t={}),"object"!=typeof e&&(e={});var n=Object.keys(t).concat(Object.keys(e)).reduce((function(n,r){return o(t[r],e[r])||(n[r]=void 0===e[r]?null:e[r]),n}),{});return Object.keys(n).length>0?n:void 0},transform:function(t,e,n){if("object"!=typeof t)return e;if("object"==typeof e){if(!n)return e;var r=Object.keys(e).reduce((function(n,r){return void 0===t[r]&&(n[r]=e[r]),n}),{});return Object.keys(r).length>0?r:void 0}}},iterator:function(t){return new r(t)},length:function(t){return"number"==typeof t.delete?t.delete:"number"==typeof t.retain?t.retain:"string"==typeof t.insert?t.insert.length:1}};r.prototype.hasNext=function(){return this.peekLength()<1/0},r.prototype.next=function(t){t||(t=1/0);var e=this.ops[this.index];if(e){var n=this.offset,r=l.length(e);if(t>=r-n?(t=r-n,this.index+=1,this.offset=0):this.offset+=t,"number"==typeof e.delete)return{delete:t};var o={};return e.attributes&&(o.attributes=e.attributes),"number"==typeof e.retain?o.retain=t:"string"==typeof e.insert?o.insert=e.insert.substr(n,t):o.insert=e.insert,o}return{retain:1/0}},r.prototype.peek=function(){return this.ops[this.index]},r.prototype.peekLength=function(){return this.ops[this.index]?l.length(this.ops[this.index])-this.offset:1/0},r.prototype.peekType=function(){return this.ops[this.index]?"number"==typeof this.ops[this.index].delete?"delete":"number"==typeof this.ops[this.index].retain?"retain":"insert":"retain"},t.exports=l},function(t,e){var n=function(){"use strict";function t(t,e){return null!=e&&t instanceof e}function e(n,r,o,i,c){"object"==typeof r&&(o=r.depth,i=r.prototype,c=r.includeNonEnumerable,r=r.circular);var h=[],p=[],d="undefined"!=typeof Buffer;return void 0===r&&(r=!0),void 0===o&&(o=1/0),function f(n,o){if(null===n)return null;if(0===o)return n;var y,v;if("object"!=typeof n)return n;if(t(n,a))y=new a;else if(t(n,s))y=new s;else if(t(n,u))y=new u((function(t,e){n.then((function(e){t(f(e,o-1))}),(function(t){e(f(t,o-1))}))}));else if(e.__isArray(n))y=[];else if(e.__isRegExp(n))y=new RegExp(n.source,l(n)),n.lastIndex&&(y.lastIndex=n.lastIndex);else if(e.__isDate(n))y=new Date(n.getTime());else{if(d&&Buffer.isBuffer(n))return y=new Buffer(n.length),n.copy(y),y;t(n,Error)?y=Object.create(n):void 0===i?(v=Object.getPrototypeOf(n),y=Object.create(v)):(y=Object.create(i),v=i)}if(r){var b=h.indexOf(n);if(-1!=b)return p[b];h.push(n),p.push(y)}for(var g in t(n,a)&&n.forEach((function(t,e){var n=f(e,o-1),r=f(t,o-1);y.set(n,r)})),t(n,s)&&n.forEach((function(t){var e=f(t,o-1);y.add(e)})),n){var m;v&&(m=Object.getOwnPropertyDescriptor(v,g)),m&&null==m.set||(y[g]=f(n[g],o-1))}if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(n);for(g=0;g<_.length;g++){var O=_[g];(!(w=Object.getOwnPropertyDescriptor(n,O))||w.enumerable||c)&&(y[O]=f(n[O],o-1),w.enumerable||Object.defineProperty(y,O,{enumerable:!1}))}}if(c){var x=Object.getOwnPropertyNames(n);for(g=0;g<x.length;g++){var w,k=x[g];(w=Object.getOwnPropertyDescriptor(n,k))&&w.enumerable||(y[k]=f(n[k],o-1),Object.defineProperty(y,k,{enumerable:!1}))}}return y}(n,o)}function n(t){return Object.prototype.toString.call(t)}function l(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}var a,s,u;try{a=Map}catch(t){a=function(){}}try{s=Set}catch(t){s=function(){}}try{u=Promise}catch(t){u=function(){}}return e.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},e.__objToStr=n,e.__isDate=function r(t){return"object"==typeof t&&"[object Date]"===n(t)},e.__isArray=function o(t){return"object"==typeof t&&"[object Array]"===n(t)},e.__isRegExp=function i(t){return"object"==typeof t&&"[object RegExp]"===n(t)},e.__getRegExpFlags=l,e}();"object"==typeof t&&t.exports&&(t.exports=n)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){try{e.parentNode}catch(t){return!1}return e instanceof Text&&(e=e.parentNode),t.contains(e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.Range=void 0;var a=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=r(n(0)),h=r(n(21)),d=r(n(12)),v=r(n(9)),m=(0,r(n(10)).default)("quill:selection"),_=function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i(this,t),this.index=e,this.length=n},O=function(){function t(e,n){var r=this;i(this,t),this.emitter=n,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=c.default.create("cursor",this),this.lastRange=this.savedRange=new _(0,0),this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,(function(){r.mouseDown||setTimeout(r.update.bind(r,v.default.sources.USER),1)})),this.emitter.on(v.default.events.EDITOR_CHANGE,(function(t,e){t===v.default.events.TEXT_CHANGE&&e.length()>0&&r.update(v.default.sources.SILENT)})),this.emitter.on(v.default.events.SCROLL_BEFORE_UPDATE,(function(){if(r.hasFocus()){var t=r.getNativeRange();null!=t&&t.start.node!==r.cursor.textNode&&r.emitter.once(v.default.events.SCROLL_UPDATE,(function(){try{r.setNativeRange(t.start.node,t.start.offset,t.end.node,t.end.offset)}catch(t){}}))}})),this.emitter.on(v.default.events.SCROLL_OPTIMIZE,(function(t,e){if(e.range){var n=e.range,o=n.startNode,i=n.startOffset,l=n.endNode,a=n.endOffset;r.setNativeRange(o,i,l,a)}})),this.update(v.default.sources.SILENT)}return s(t,[{key:"handleComposition",value:function(){var t=this;this.root.addEventListener("compositionstart",(function(){t.composing=!0})),this.root.addEventListener("compositionend",(function(){if(t.composing=!1,t.cursor.parent){var e=t.cursor.restore();if(!e)return;setTimeout((function(){t.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)}),1)}}))}},{key:"handleDragging",value:function(){var t=this;this.emitter.listenDOM("mousedown",document.body,(function(){t.mouseDown=!0})),this.emitter.listenDOM("mouseup",document.body,(function(){t.mouseDown=!1,t.update(v.default.sources.USER)}))}},{key:"focus",value:function(){this.hasFocus()||(this.root.focus(),this.setRange(this.savedRange))}},{key:"format",value:function(t,e){if(null==this.scroll.whitelist||this.scroll.whitelist[t]){this.scroll.update();var n=this.getNativeRange();if(null!=n&&n.native.collapsed&&!c.default.query(t,c.default.Scope.BLOCK)){if(n.start.node!==this.cursor.textNode){var r=c.default.find(n.start.node,!1);if(null==r)return;if(r instanceof c.default.Leaf){var o=r.split(n.start.offset);r.parent.insertBefore(this.cursor,o)}else r.insertBefore(this.cursor,n.start.node);this.cursor.attach()}this.cursor.format(t,e),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}}},{key:"getBounds",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.scroll.length();t=Math.min(t,n-1),e=Math.min(t+e,n-1)-t;var r=void 0,o=this.scroll.leaf(t),i=a(o,2),l=i[0],s=i[1];if(null==l)return null;var u=l.position(s,!0),c=a(u,2);r=c[0],s=c[1];var f=document.createRange();if(e>0){f.setStart(r,s);var h=this.scroll.leaf(t+e),p=a(h,2);if(l=p[0],s=p[1],null==l)return null;var d=l.position(s,!0),y=a(d,2);return r=y[0],s=y[1],f.setEnd(r,s),f.getBoundingClientRect()}var v="left",b=void 0;return r instanceof Text?(s<r.data.length?(f.setStart(r,s),f.setEnd(r,s+1)):(f.setStart(r,s-1),f.setEnd(r,s),v="right"),b=f.getBoundingClientRect()):(b=l.domNode.getBoundingClientRect(),s>0&&(v="right")),{bottom:b.top+b.height,height:b.height,left:b[v],right:b[v],top:b.top,width:0}}},{key:"getNativeRange",value:function(){var t=document.getSelection();if(null==t||t.rangeCount<=0)return null;var e=t.getRangeAt(0);if(null==e)return null;var n=this.normalizeNative(e);return m.info("getNativeRange",n),n}},{key:"getRange",value:function(){var t=this.getNativeRange();return null==t?[null,null]:[this.normalizedToRange(t),t]}},{key:"hasFocus",value:function(){return document.activeElement===this.root}},{key:"normalizedToRange",value:function(t){var e=this,n=[[t.start.node,t.start.offset]];t.native.collapsed||n.push([t.end.node,t.end.offset]);var r=n.map((function(t){var n=a(t,2),r=n[0],o=n[1],i=c.default.find(r,!0),l=i.offset(e.scroll);return 0===o?l:i instanceof c.default.Container?l+i.length():l+i.index(r,o)})),i=Math.min(Math.max.apply(Math,o(r)),this.scroll.length()-1),l=Math.min.apply(Math,[i].concat(o(r)));return new _(l,i-l)}},{key:"normalizeNative",value:function(t){if(!l(this.root,t.startContainer)||!t.collapsed&&!l(this.root,t.endContainer))return null;var e={start:{node:t.startContainer,offset:t.startOffset},end:{node:t.endContainer,offset:t.endOffset},native:t};return[e.start,e.end].forEach((function(t){for(var e=t.node,n=t.offset;!(e instanceof Text)&&e.childNodes.length>0;)if(e.childNodes.length>n)e=e.childNodes[n],n=0;else{if(e.childNodes.length!==n)break;n=(e=e.lastChild)instanceof Text?e.data.length:e.childNodes.length+1}t.node=e,t.offset=n})),e}},{key:"rangeToNative",value:function(t){var e=this,n=t.collapsed?[t.index]:[t.index,t.index+t.length],r=[],o=this.scroll.length();return n.forEach((function(t,n){t=Math.min(o-1,t);var i,l=e.scroll.leaf(t),s=a(l,2),u=s[0],c=s[1],f=u.position(c,0!==n),h=a(f,2);i=h[0],c=h[1],r.push(i,c)})),r.length<2&&(r=r.concat(r)),r}},{key:"scrollIntoView",value:function(t){var e=this.lastRange;if(null!=e){var n=this.getBounds(e.index,e.length);if(null!=n){var r=this.scroll.length()-1,o=this.scroll.line(Math.min(e.index,r)),l=a(o,1)[0],s=l;if(e.length>0){var u=this.scroll.line(Math.min(e.index+e.length,r));s=a(u,1)[0]}if(null!=l&&null!=s){var c=t.getBoundingClientRect();n.top<c.top?t.scrollTop-=c.top-n.top:n.bottom>c.bottom&&(t.scrollTop+=n.bottom-c.bottom)}}}}},{key:"setNativeRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(m.info("setNativeRange",t,e,n,r),null==t||null!=this.root.parentNode&&null!=t.parentNode&&null!=n.parentNode){var i=document.getSelection();if(null!=i)if(null!=t){this.hasFocus()||this.root.focus();var l=(this.getNativeRange()||{}).native;if(null==l||o||t!==l.startContainer||e!==l.startOffset||n!==l.endContainer||r!==l.endOffset){"BR"==t.tagName&&(e=[].indexOf.call(t.parentNode.childNodes,t),t=t.parentNode),"BR"==n.tagName&&(r=[].indexOf.call(n.parentNode.childNodes,n),n=n.parentNode);var a=document.createRange();a.setStart(t,e),a.setEnd(n,r),i.removeAllRanges(),i.addRange(a)}}else i.removeAllRanges(),this.root.blur(),document.body.focus()}}},{key:"setRange",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v.default.sources.API;if("string"==typeof e&&(n=e,e=!1),m.info("setRange",t),null!=t){var r=this.rangeToNative(t);this.setNativeRange.apply(this,o(r).concat([e]))}else this.setNativeRange(null);this.update(n)}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.default.sources.USER,e=this.lastRange,n=this.getRange(),r=a(n,2),o=r[0],i=r[1];if(this.lastRange=o,null!=this.lastRange&&(this.savedRange=this.lastRange),!(0,d.default)(e,this.lastRange)){var l;!this.composing&&null!=i&&i.native.collapsed&&i.start.node!==this.cursor.textNode&&this.cursor.restore();var u,s=[v.default.events.SELECTION_CHANGE,(0,h.default)(this.lastRange),(0,h.default)(e),t];if((l=this.emitter).emit.apply(l,[v.default.events.EDITOR_CHANGE].concat(s)),t!==v.default.sources.SILENT)(u=this.emitter).emit.apply(u,s)}}}]),t}();e.Range=_,e.default=O},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=r(n(0)),u=n(3),c=r(u),f=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(s.default.Container);f.allowedChildren=[c.default,u.BlockEmbed,f],e.default=f},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.ColorStyle=e.ColorClass=e.ColorAttributor=void 0;var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"value",value:function(t){var n=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"value",this).call(this,t);return n.startsWith("rgb(")?"#"+(n=n.replace(/^[^\d]+/,"").replace(/[^\d]+$/,"")).split(",").map((function(t){return("00"+parseInt(t).toString(16)).slice(-2)})).join(""):n}}]),e}(u.default.Attributor.Style),f=new u.default.Attributor.Class("color","ql-color",{scope:u.default.Scope.INLINE}),h=new c("color","color",{scope:u.default.Scope.INLINE});e.ColorAttributor=c,e.ColorClass=f,e.ColorStyle=h},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){var n,r=t===D.keys.LEFT?"prefix":"suffix";return o(n={key:t,shiftKey:e,altKey:null},r,/^$/),o(n,"handler",(function(n){var r=n.index;t===D.keys.RIGHT&&(r+=n.length+1);var o=this.quill.getLeaf(r);return!(b(o,1)[0]instanceof T.default.Embed&&(t===D.keys.LEFT?e?this.quill.setSelection(n.index-1,n.length+1,S.default.sources.USER):this.quill.setSelection(n.index-1,S.default.sources.USER):e?this.quill.setSelection(n.index,n.length+1,S.default.sources.USER):this.quill.setSelection(n.index+n.length+1,S.default.sources.USER),1))})),n}function u(t,e){if(!(0===t.index||this.quill.getLength()<=1)){var n=this.quill.getLine(t.index),o=b(n,1)[0],i={};if(0===e.offset){var l=this.quill.getLine(t.index-1),s=b(l,1)[0];if(null!=s&&s.length()>1){var u=o.formats(),c=this.quill.getFormat(t.index-1,1);i=A.default.attributes.diff(u,c)||{}}}var f=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(e.prefix)?2:1;this.quill.deleteText(t.index-f,f,S.default.sources.USER),Object.keys(i).length>0&&this.quill.formatLine(t.index-f,f,i,S.default.sources.USER),this.quill.focus()}}function c(t,e){var n=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(e.suffix)?2:1;if(!(t.index>=this.quill.getLength()-n)){var r={},o=0,i=this.quill.getLine(t.index),a=b(i,1)[0];if(e.offset>=a.length()-1){var s=this.quill.getLine(t.index+1),c=b(s,1)[0];if(c){var f=a.formats(),h=this.quill.getFormat(t.index,1);r=A.default.attributes.diff(f,h)||{},o=c.length()}}this.quill.deleteText(t.index,n,S.default.sources.USER),Object.keys(r).length>0&&this.quill.formatLine(t.index+o-1,n,r,S.default.sources.USER)}}function f(t){var e=this.quill.getLines(t),n={};if(e.length>1){var r=e[0].formats(),o=e[e.length-1].formats();n=A.default.attributes.diff(o,r)||{}}this.quill.deleteText(t,S.default.sources.USER),Object.keys(n).length>0&&this.quill.formatLine(t.index,1,n,S.default.sources.USER),this.quill.setSelection(t.index,S.default.sources.SILENT),this.quill.focus()}function h(t,e){var n=this;t.length>0&&this.quill.scroll.deleteAt(t.index,t.length);var r=Object.keys(e.format).reduce((function(t,n){return T.default.query(n,T.default.Scope.BLOCK)&&!Array.isArray(e.format[n])&&(t[n]=e.format[n]),t}),{});this.quill.insertText(t.index,"\n",r,S.default.sources.USER),this.quill.setSelection(t.index+1,S.default.sources.SILENT),this.quill.focus(),Object.keys(e.format).forEach((function(t){null==r[t]&&(Array.isArray(e.format[t])||"link"!==t&&n.quill.format(t,e.format[t],S.default.sources.USER))}))}function p(t){return{key:D.keys.TAB,shiftKey:!t,format:{"code-block":!0},handler:function(e){var n=T.default.query("code-block"),r=e.index,o=e.length,i=this.quill.scroll.descendant(n,r),l=b(i,2),a=l[0],s=l[1];if(null!=a){var u=this.quill.getIndex(a),c=a.newlineIndex(s,!0)+1,f=a.newlineIndex(u+s+o),h=a.domNode.textContent.slice(c,f).split("\n");s=0,h.forEach((function(e,i){t?(a.insertAt(c+s,n.TAB),s+=n.TAB.length,0===i?r+=n.TAB.length:o+=n.TAB.length):e.startsWith(n.TAB)&&(a.deleteAt(c+s,n.TAB.length),s-=n.TAB.length,0===i?r-=n.TAB.length:o-=n.TAB.length),s+=e.length+1})),this.quill.update(S.default.sources.USER),this.quill.setSelection(r,o,S.default.sources.SILENT)}}}}function d(t){return{key:t[0].toUpperCase(),shortKey:!0,handler:function(e,n){this.quill.format(t,!n.format[t],S.default.sources.USER)}}}function y(t){if("string"==typeof t||"number"==typeof t)return y({key:t});if("object"===(void 0===t?"undefined":v(t))&&(t=(0,_.default)(t,!1)),"string"==typeof t.key)if(null!=D.keys[t.key.toUpperCase()])t.key=D.keys[t.key.toUpperCase()];else{if(1!==t.key.length)return null;t.key=t.key.toUpperCase().charCodeAt(0)}return t.shortKey&&(t[B]=t.shortKey,delete t.shortKey),t}Object.defineProperty(e,"__esModule",{value:!0}),e.SHORTKEY=e.default=void 0;var v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},b=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),_=r(n(21)),w=r(n(12)),k=r(n(2)),N=r(n(4)),A=r(n(20)),T=r(n(0)),S=r(n(6)),L=r(n(10)),R=r(n(7)),I=(0,L.default)("quill:keyboard"),B=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey",D=function(t){function e(t,n){!function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.bindings={},Object.keys(r.options.bindings).forEach((function(e){("list autofill"!==e||null==t.scroll.whitelist||t.scroll.whitelist.list)&&r.options.bindings[e]&&r.addBinding(r.options.bindings[e])})),r.addBinding({key:e.keys.ENTER,shiftKey:null},h),r.addBinding({key:e.keys.ENTER,metaKey:null,ctrlKey:null,altKey:null},(function(){})),/Firefox/i.test(navigator.userAgent)?(r.addBinding({key:e.keys.BACKSPACE},{collapsed:!0},u),r.addBinding({key:e.keys.DELETE},{collapsed:!0},c)):(r.addBinding({key:e.keys.BACKSPACE},{collapsed:!0,prefix:/^.?$/},u),r.addBinding({key:e.keys.DELETE},{collapsed:!0,suffix:/^.?$/},c)),r.addBinding({key:e.keys.BACKSPACE},{collapsed:!1},f),r.addBinding({key:e.keys.DELETE},{collapsed:!1},f),r.addBinding({key:e.keys.BACKSPACE,altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},u),r.listen(),r}return function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),g(e,null,[{key:"match",value:function(t,e){return e=y(e),!["altKey","ctrlKey","metaKey","shiftKey"].some((function(n){return!!e[n]!==t[n]&&null!==e[n]}))&&e.key===(t.which||t.keyCode)}}]),g(e,[{key:"addBinding",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=y(t);if(null==r||null==r.key)return I.warn("Attempted to add invalid keyboard binding",r);"function"==typeof e&&(e={handler:e}),"function"==typeof n&&(n={handler:n}),r=(0,k.default)(r,e,n),this.bindings[r.key]=this.bindings[r.key]||[],this.bindings[r.key].push(r)}},{key:"listen",value:function(){var t=this;this.quill.root.addEventListener("keydown",(function(n){if(!n.defaultPrevented){var r=n.which||n.keyCode,o=(t.bindings[r]||[]).filter((function(t){return e.match(n,t)}));if(0!==o.length){var i=t.quill.getSelection();if(null!=i&&t.quill.hasFocus()){var l=t.quill.getLine(i.index),a=b(l,2),s=a[0],u=a[1],c=t.quill.getLeaf(i.index),f=b(c,2),h=f[0],p=f[1],d=0===i.length?[h,p]:t.quill.getLeaf(i.index+i.length),y=b(d,2),g=y[0],m=y[1],_=h instanceof T.default.Text?h.value().slice(0,p):"",O=g instanceof T.default.Text?g.value().slice(m):"",x={collapsed:0===i.length,empty:0===i.length&&s.length()<=1,format:t.quill.getFormat(i),offset:u,prefix:_,suffix:O};o.some((function(e){if(null!=e.collapsed&&e.collapsed!==x.collapsed)return!1;if(null!=e.empty&&e.empty!==x.empty)return!1;if(null!=e.offset&&e.offset!==x.offset)return!1;if(Array.isArray(e.format)){if(e.format.every((function(t){return null==x.format[t]})))return!1}else if("object"===v(e.format)&&!Object.keys(e.format).every((function(t){return!0===e.format[t]?null!=x.format[t]:!1===e.format[t]?null==x.format[t]:(0,w.default)(e.format[t],x.format[t])})))return!1;return!(null!=e.prefix&&!e.prefix.test(x.prefix)||null!=e.suffix&&!e.suffix.test(x.suffix)||!0===e.handler.call(t,i,x))}))&&n.preventDefault()}}}}))}}]),e}(R.default);D.keys={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46},D.DEFAULTS={bindings:{bold:d("bold"),italic:d("italic"),underline:d("underline"),indent:{key:D.keys.TAB,format:["blockquote","indent","list"],handler:function(t,e){if(e.collapsed&&0!==e.offset)return!0;this.quill.format("indent","+1",S.default.sources.USER)}},outdent:{key:D.keys.TAB,shiftKey:!0,format:["blockquote","indent","list"],handler:function(t,e){if(e.collapsed&&0!==e.offset)return!0;this.quill.format("indent","-1",S.default.sources.USER)}},"outdent backspace":{key:D.keys.BACKSPACE,collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler:function(t,e){null!=e.format.indent?this.quill.format("indent","-1",S.default.sources.USER):null!=e.format.list&&this.quill.format("list",!1,S.default.sources.USER)}},"indent code-block":p(!0),"outdent code-block":p(!1),"remove tab":{key:D.keys.TAB,shiftKey:!0,collapsed:!0,prefix:/\t$/,handler:function(t){this.quill.deleteText(t.index-1,1,S.default.sources.USER)}},tab:{key:D.keys.TAB,handler:function(t){this.quill.history.cutoff();var e=(new N.default).retain(t.index).delete(t.length).insert("\t");this.quill.updateContents(e,S.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index+1,S.default.sources.SILENT)}},"list empty enter":{key:D.keys.ENTER,collapsed:!0,format:["list"],empty:!0,handler:function(t,e){this.quill.format("list",!1,S.default.sources.USER),e.format.indent&&this.quill.format("indent",!1,S.default.sources.USER)}},"checklist enter":{key:D.keys.ENTER,collapsed:!0,format:{list:"checked"},handler:function(t){var e=this.quill.getLine(t.index),n=b(e,2),r=n[0],o=n[1],i=(0,k.default)({},r.formats(),{list:"checked"}),l=(new N.default).retain(t.index).insert("\n",i).retain(r.length()-o-1).retain(1,{list:"unchecked"});this.quill.updateContents(l,S.default.sources.USER),this.quill.setSelection(t.index+1,S.default.sources.SILENT),this.quill.scrollIntoView()}},"header enter":{key:D.keys.ENTER,collapsed:!0,format:["header"],suffix:/^$/,handler:function(t,e){var n=this.quill.getLine(t.index),r=b(n,2),o=r[0],i=r[1],l=(new N.default).retain(t.index).insert("\n",e.format).retain(o.length()-i-1).retain(1,{header:null});this.quill.updateContents(l,S.default.sources.USER),this.quill.setSelection(t.index+1,S.default.sources.SILENT),this.quill.scrollIntoView()}},"list autofill":{key:" ",collapsed:!0,format:{list:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler:function(t,e){var n=e.prefix.length,r=this.quill.getLine(t.index),o=b(r,2),i=o[0],l=o[1];if(l>n)return!0;var a=void 0;switch(e.prefix.trim()){case"[]":case"[ ]":a="unchecked";break;case"[x]":a="checked";break;case"-":case"*":a="bullet";break;default:a="ordered"}this.quill.insertText(t.index," ",S.default.sources.USER),this.quill.history.cutoff();var s=(new N.default).retain(t.index-l).delete(n+1).retain(i.length()-2-l).retain(1,{list:a});this.quill.updateContents(s,S.default.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(t.index-n,S.default.sources.SILENT)}},"code exit":{key:D.keys.ENTER,collapsed:!0,format:["code-block"],prefix:/\n\n$/,suffix:/^\s+$/,handler:function(t){var e=this.quill.getLine(t.index),n=b(e,2),r=n[0],o=n[1],i=(new N.default).retain(t.index+r.length()-o-2).retain(1,{"code-block":null}).delete(1);this.quill.updateContents(i,S.default.sources.USER)}},"embed left":s(D.keys.LEFT,!1),"embed left shift":s(D.keys.LEFT,!0),"embed right":s(D.keys.RIGHT,!1),"embed right shift":s(D.keys.RIGHT,!0)}},e.default=D,e.SHORTKEY=B},function(t,e,n){"use strict";t.exports={align:{"":n(75),center:n(76),right:n(77),justify:n(78)},background:n(79),blockquote:n(80),bold:n(81),clean:n(82),code:n(40),"code-block":n(40),color:n(83),direction:{"":n(84),rtl:n(85)},float:{center:n(86),full:n(87),left:n(88),right:n(89)},formula:n(90),header:{1:n(91),2:n(92)},italic:n(93),image:n(94),indent:{"+1":n(95),"-1":n(96)},link:n(97),list:{ordered:n(98),bullet:n(99),check:n(100)},script:{sub:n(101),super:n(102)},strike:n(103),underline:n(104),video:n(105)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),o=function(){function t(t){this.domNode=t,this.domNode[r.DATA_KEY]={blot:this}}return Object.defineProperty(t.prototype,"statics",{get:function(){return this.constructor},enumerable:!0,configurable:!0}),t.create=function(t){if(null==this.tagName)throw new r.ParchmentError("Blot definition missing tagName");var e;return Array.isArray(this.tagName)?("string"==typeof t&&(t=t.toUpperCase(),parseInt(t).toString()===t&&(t=parseInt(t))),e="number"==typeof t?document.createElement(this.tagName[t-1]):this.tagName.indexOf(t)>-1?document.createElement(t):document.createElement(this.tagName[0])):e=document.createElement(this.tagName),this.className&&e.classList.add(this.className),e},t.prototype.attach=function(){null!=this.parent&&(this.scroll=this.parent.scroll)},t.prototype.clone=function(){var t=this.domNode.cloneNode(!1);return r.create(t)},t.prototype.detach=function(){null!=this.parent&&this.parent.removeChild(this),delete this.domNode[r.DATA_KEY]},t.prototype.deleteAt=function(t,e){this.isolate(t,e).remove()},t.prototype.formatAt=function(t,e,n,o){var i=this.isolate(t,e);if(null!=r.query(n,r.Scope.BLOT)&&o)i.wrap(n,o);else if(null!=r.query(n,r.Scope.ATTRIBUTE)){var l=r.create(this.statics.scope);i.wrap(l),l.format(n,o)}},t.prototype.insertAt=function(t,e,n){var o=null==n?r.create("text",e):r.create(e,n),i=this.split(t);this.parent.insertBefore(o,i)},t.prototype.insertInto=function(t,e){void 0===e&&(e=null),null!=this.parent&&this.parent.children.remove(this);var n=null;t.children.insertBefore(this,e),null!=e&&(n=e.domNode),this.domNode.parentNode==t.domNode&&this.domNode.nextSibling==n||t.domNode.insertBefore(this.domNode,n),this.parent=t,this.attach()},t.prototype.isolate=function(t,e){var n=this.split(t);return n.split(e),n},t.prototype.length=function(){return 1},t.prototype.offset=function(t){return void 0===t&&(t=this.parent),null==this.parent||this==t?0:this.parent.children.offset(this)+this.parent.offset(t)},t.prototype.optimize=function(t){null!=this.domNode[r.DATA_KEY]&&delete this.domNode[r.DATA_KEY].mutations},t.prototype.remove=function(){null!=this.domNode.parentNode&&this.domNode.parentNode.removeChild(this.domNode),this.detach()},t.prototype.replace=function(t){null!=t.parent&&(t.parent.insertBefore(this,t.next),t.remove())},t.prototype.replaceWith=function(t,e){var n="string"==typeof t?r.create(t,e):t;return n.replace(this),n},t.prototype.split=function(t,e){return 0===t?this:this.next},t.prototype.update=function(t,e){},t.prototype.wrap=function(t,e){var n="string"==typeof t?r.create(t,e):t;return null!=this.parent&&this.parent.insertBefore(n,this.next),n.appendChild(this),n},t.blotName="abstract",t}();e.default=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(11),o=n(29),i=n(30),l=n(1),a=function(){function t(t){this.attributes={},this.domNode=t,this.build()}return t.prototype.attribute=function(t,e){e?t.add(this.domNode,e)&&(null!=t.value(this.domNode)?this.attributes[t.attrName]=t:delete this.attributes[t.attrName]):(t.remove(this.domNode),delete this.attributes[t.attrName])},t.prototype.build=function(){var t=this;this.attributes={};var e=r.default.keys(this.domNode),n=o.default.keys(this.domNode),a=i.default.keys(this.domNode);e.concat(n).concat(a).forEach((function(e){var n=l.query(e,l.Scope.ATTRIBUTE);n instanceof r.default&&(t.attributes[n.attrName]=n)}))},t.prototype.copy=function(t){var e=this;Object.keys(this.attributes).forEach((function(n){var r=e.attributes[n].value(e.domNode);t.format(n,r)}))},t.prototype.move=function(t){var e=this;this.copy(t),Object.keys(this.attributes).forEach((function(t){e.attributes[t].remove(e.domNode)})),this.attributes={}},t.prototype.values=function(){var t=this;return Object.keys(this.attributes).reduce((function(e,n){return e[n]=t.attributes[n].value(t.domNode),e}),{})},t}();e.default=a},function(t,e,n){"use strict";function r(t,e){return(t.getAttribute("class")||"").split(/\s+/).filter((function(t){return 0===t.indexOf(e+"-")}))}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.keys=function(t){return(t.getAttribute("class")||"").split(/\s+/).map((function(t){return t.split("-").slice(0,-1).join("-")}))},e.prototype.add=function(t,e){return!!this.canAdd(t,e)&&(this.remove(t),t.classList.add(this.keyName+"-"+e),!0)},e.prototype.remove=function(t){r(t,this.keyName).forEach((function(e){t.classList.remove(e)})),0===t.classList.length&&t.removeAttribute("class")},e.prototype.value=function(t){var n=(r(t,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(t,n)?n:""},e}(n(11).default);e.default=l},function(t,e,n){"use strict";function r(t){var e=t.split("-"),n=e.slice(1).map((function(t){return t[0].toUpperCase()+t.slice(1)})).join("");return e[0]+n}var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.keys=function(t){return(t.getAttribute("style")||"").split(";").map((function(t){return t.split(":")[0].trim()}))},e.prototype.add=function(t,e){return!!this.canAdd(t,e)&&(t.style[r(this.keyName)]=e,!0)},e.prototype.remove=function(t){t.style[r(this.keyName)]="",t.getAttribute("style")||t.removeAttribute("style")},e.prototype.value=function(t){var e=t.style[r(this.keyName)];return this.canAdd(t,e)?e:""},e}(n(11).default);e.default=l},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=r(n(0)),p=r(n(8)),d=function(t){function e(t,n){!function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.selection=n,r.textNode=document.createTextNode(e.CONTENTS),r.domNode.appendChild(r.textNode),r._length=0,r}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),u(e,null,[{key:"value",value:function(){}}]),u(e,[{key:"detach",value:function(){null!=this.parent&&this.parent.removeChild(this)}},{key:"format",value:function(t,n){if(0!==this._length)return s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n);for(var r=this,o=0;null!=r&&r.statics.scope!==f.default.Scope.BLOCK_BLOT;)o+=r.offset(r.parent),r=r.parent;null!=r&&(this._length=e.CONTENTS.length,r.optimize(),r.formatAt(o,e.CONTENTS.length,t,n),this._length=0)}},{key:"index",value:function(t,n){return t===this.textNode?0:s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"index",this).call(this,t,n)}},{key:"length",value:function(){return this._length}},{key:"position",value:function(){return[this.textNode,this.textNode.data.length]}},{key:"remove",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"remove",this).call(this),this.parent=null}},{key:"restore",value:function(){if(!this.selection.composing&&null!=this.parent){var t=this.textNode,n=this.selection.getNativeRange(),r=void 0,o=void 0,i=void 0;if(null!=n&&n.start.node===t&&n.end.node===t){var l=[t,n.start.offset,n.end.offset];r=l[0],o=l[1],i=l[2]}for(;null!=this.domNode.lastChild&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);if(this.textNode.data!==e.CONTENTS){var s=this.textNode.data.split(e.CONTENTS).join("");this.next instanceof p.default?(r=this.next.domNode,this.next.insertAt(0,s),this.textNode.data=e.CONTENTS):(this.textNode.data=s,this.parent.insertBefore(f.default.create(this.textNode),this),this.textNode=document.createTextNode(e.CONTENTS),this.domNode.appendChild(this.textNode))}if(this.remove(),null!=o){var u=[o,i].map((function(t){return Math.max(0,Math.min(r.data.length,t-1))})),c=a(u,2);return o=c[0],i=c[1],{startNode:r,startOffset:o,endNode:r,endOffset:i}}}}},{key:"update",value:function(t,e){var n=this;if(t.some((function(t){return"characterData"===t.type&&t.target===n.textNode}))){var r=this.restore();r&&(e.range=r)}}},{key:"value",value:function(){return""}}]),e}(f.default.Embed);d.blotName="cursor",d.className="ql-cursor",d.tagName="span",d.CONTENTS="\ufeff",e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,n){(function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.quill=e,this.options=n,this.modules={}}return o(t,[{key:"init",value:function(){var t=this;Object.keys(this.options.modules).forEach((function(e){null==t.modules[e]&&t.addModule(e)}))}},{key:"addModule",value:function(t){var e=this.quill.constructor.import("modules/"+t);return this.modules[t]=new e(this.quill,this.options.modules[t]||{}),this.modules[t]}}]),t}();i.DEFAULTS={modules:{}},i.themes={default:i},e.default=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=r(n(0)),h=r(n(8)),p="\ufeff",d=function(t){function e(t){!function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.contentNode=document.createElement("span"),n.contentNode.setAttribute("contenteditable",!1),[].slice.call(n.domNode.childNodes).forEach((function(t){n.contentNode.appendChild(t)})),n.leftGuard=document.createTextNode(p),n.rightGuard=document.createTextNode(p),n.domNode.appendChild(n.leftGuard),n.domNode.appendChild(n.contentNode),n.domNode.appendChild(n.rightGuard),n}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),a(e,[{key:"index",value:function(t,n){return t===this.leftGuard?0:t===this.rightGuard?1:s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"index",this).call(this,t,n)}},{key:"restore",value:function(t){var e=void 0,n=void 0,r=t.data.split(p).join("");if(t===this.leftGuard)if(this.prev instanceof h.default){var o=this.prev.length();this.prev.insertAt(o,r),e={startNode:this.prev.domNode,startOffset:o+r.length}}else n=document.createTextNode(r),this.parent.insertBefore(c.default.create(n),this),e={startNode:n,startOffset:r.length};else t===this.rightGuard&&(this.next instanceof h.default?(this.next.insertAt(0,r),e={startNode:this.next.domNode,startOffset:r.length}):(n=document.createTextNode(r),this.parent.insertBefore(c.default.create(n),this.next),e={startNode:n,startOffset:r.length}));return t.data=p,e}},{key:"update",value:function(t,e){var n=this;t.forEach((function(t){if("characterData"===t.type&&(t.target===n.leftGuard||t.target===n.rightGuard)){var r=n.restore(t.target);r&&(e.range=r)}}))}}]),e}(c.default.Embed);e.default=d},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AlignStyle=e.AlignClass=e.AlignAttribute=void 0;var o=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),i={scope:o.default.Scope.BLOCK,whitelist:["right","center","justify"]},l=new o.default.Attributor.Attribute("align","align",i),a=new o.default.Attributor.Class("align","ql-align",i),s=new o.default.Attributor.Style("align","text-align",i);e.AlignAttribute=l,e.AlignClass=a,e.AlignStyle=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BackgroundStyle=e.BackgroundClass=void 0;var o=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),i=n(24),l=new o.default.Attributor.Class("background","ql-bg",{scope:o.default.Scope.INLINE}),a=new i.ColorAttributor("background","background-color",{scope:o.default.Scope.INLINE});e.BackgroundClass=l,e.BackgroundStyle=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DirectionStyle=e.DirectionClass=e.DirectionAttribute=void 0;var o=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),i={scope:o.default.Scope.BLOCK,whitelist:["rtl"]},l=new o.default.Attributor.Attribute("direction","dir",i),a=new o.default.Attributor.Class("direction","ql-direction",i),s=new o.default.Attributor.Style("direction","direction",i);e.DirectionAttribute=l,e.DirectionClass=a,e.DirectionStyle=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.FontClass=e.FontStyle=void 0;var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),c={scope:u.default.Scope.INLINE,whitelist:["serif","monospace"]},f=new u.default.Attributor.Class("font","ql-font",c),p=new(function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"value",value:function(t){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"value",this).call(this,t).replace(/["']/g,"")}}]),e}(u.default.Attributor.Style))("font","font-family",c);e.FontStyle=p,e.FontClass=f},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SizeStyle=e.SizeClass=void 0;var o=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),i=new o.default.Attributor.Class("size","ql-size",{scope:o.default.Scope.INLINE,whitelist:["small","large","huge"]}),l=new o.default.Attributor.Style("size","font-size",{scope:o.default.Scope.INLINE,whitelist:["10px","18px","32px"]});e.SizeClass=i,e.SizeStyle=l},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"optimize",value:function(t){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}],[{key:"create",value:function(){return a(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this)}},{key:"formats",value:function(){return!0}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(5)).default);c.blotName="bold",c.tagName=["STRONG","B"],e.default=c},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"></polyline> <polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"></polyline> <line class=ql-stroke x1=10 x2=8 y1=5 y2=13></line> </svg>'},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=function(t){function e(t,n){!function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.label.innerHTML=n,i.container.classList.add("ql-color-picker"),[].slice.call(i.container.querySelectorAll(".ql-picker-item"),0,7).forEach((function(t){t.classList.add("ql-primary")})),i}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"buildItem",value:function(t){var n=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"buildItem",this).call(this,t);return n.style.backgroundColor=t.getAttribute("value")||"",n}},{key:"selectItem",value:function(t,n){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selectItem",this).call(this,t,n);var r=this.label.querySelector(".ql-color-label"),o=t&&t.getAttribute("data-value")||"";r&&("line"===r.tagName?r.style.stroke=o:r.style.fill=o)}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(16)).default);e.default=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=function(t){function e(t,n){!function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var i=function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return i.container.classList.add("ql-icon-picker"),[].forEach.call(i.container.querySelectorAll(".ql-picker-item"),(function(t){t.innerHTML=n[t.getAttribute("data-value")||""]})),i.defaultItem=i.container.querySelector(".ql-selected"),i.selectItem(i.defaultItem),i}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"selectItem",value:function(t,n){a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"selectItem",this).call(this,t,n),t=t||this.defaultItem,this.label.innerHTML=t.innerHTML}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(16)).default);e.default=c},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(e,n){var o=this;(function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.quill=e,this.boundsContainer=n||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,this.quill.root===this.quill.scrollingContainer&&this.quill.root.addEventListener("scroll",(function(){o.root.style.marginTop=-1*o.quill.root.scrollTop+"px"})),this.hide()}return o(t,[{key:"hide",value:function(){this.root.classList.add("ql-hidden")}},{key:"position",value:function(t){var e=t.left+t.width/2-this.root.offsetWidth/2,n=t.bottom+this.quill.root.scrollTop;this.root.style.left=e+"px",this.root.style.top=n+"px",this.root.classList.remove("ql-flip");var r=this.boundsContainer.getBoundingClientRect(),o=this.root.getBoundingClientRect(),i=0;if(o.right>r.right&&(i=r.right-o.right,this.root.style.left=e+i+"px"),o.left<r.left&&(i=r.left-o.left,this.root.style.left=e+i+"px"),o.bottom>r.bottom){var l=o.bottom-o.top,a=t.bottom-t.top+l;this.root.style.top=n-a+"px",this.root.classList.add("ql-flip")}return i}},{key:"show",value:function(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}]),t}();e.default=i},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.forEach((function(e){var r=document.createElement("option");e===n?r.setAttribute("selected","selected"):r.setAttribute("value",e),t.appendChild(r)}))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BaseTooltip=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},h=r(n(2)),d=r(n(4)),v=r(n(9)),g=r(n(25)),_=r(n(32)),w=r(n(41)),k=r(n(42)),N=r(n(16)),A=r(n(43)),q=[!1,"center","right","justify"],T=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],P=[!1,"serif","monospace"],S=["1","2","3",!1],C=["small",!1,"large","huge"],L=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return t.emitter.listenDOM("click",document.body,(function e(n){if(!document.body.contains(t.root))return document.body.removeEventListener("click",e);null==r.tooltip||r.tooltip.root.contains(n.target)||document.activeElement===r.tooltip.textbox||r.quill.hasFocus()||r.tooltip.hide(),null!=r.pickers&&r.pickers.forEach((function(t){t.container.contains(n.target)||t.close()}))})),r}return l(e,t),u(e,[{key:"addModule",value:function(t){var n=c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"addModule",this).call(this,t);return"toolbar"===t&&this.extendToolbar(n),n}},{key:"buildButtons",value:function(t,e){t.forEach((function(t){(t.getAttribute("class")||"").split(/\s+/).forEach((function(n){if(n.startsWith("ql-")&&(n=n.slice("ql-".length),null!=e[n]))if("direction"===n)t.innerHTML=e[n][""]+e[n].rtl;else if("string"==typeof e[n])t.innerHTML=e[n];else{var r=t.value||"";null!=r&&e[n][r]&&(t.innerHTML=e[n][r])}}))}))}},{key:"buildPickers",value:function(t,e){var n=this;this.pickers=t.map((function(t){if(t.classList.contains("ql-align"))return null==t.querySelector("option")&&s(t,q),new k.default(t,e.align);if(t.classList.contains("ql-background")||t.classList.contains("ql-color")){var n=t.classList.contains("ql-background")?"background":"color";return null==t.querySelector("option")&&s(t,T,"background"===n?"#ffffff":"#000000"),new w.default(t,e[n])}return null==t.querySelector("option")&&(t.classList.contains("ql-font")?s(t,P):t.classList.contains("ql-header")?s(t,S):t.classList.contains("ql-size")&&s(t,C)),new N.default(t)}));this.quill.on(v.default.events.EDITOR_CHANGE,(function(){n.pickers.forEach((function(t){t.update()}))}))}}]),e}(_.default);L.DEFAULTS=(0,h.default)(!0,{},_.default.DEFAULTS,{modules:{toolbar:{handlers:{formula:function(){this.quill.theme.tooltip.edit("formula")},image:function(){var t=this,e=this.container.querySelector("input.ql-image[type=file]");null==e&&((e=document.createElement("input")).setAttribute("type","file"),e.setAttribute("accept","image/png, image/gif, image/jpeg, image/bmp, image/x-icon"),e.classList.add("ql-image"),e.addEventListener("change",(function(){if(null!=e.files&&null!=e.files[0]){var n=new FileReader;n.onload=function(n){var r=t.quill.getSelection(!0);t.quill.updateContents((new d.default).retain(r.index).delete(r.length).insert({image:n.target.result}),v.default.sources.USER),t.quill.setSelection(r.index+1,v.default.sources.SILENT),e.value=""},n.readAsDataURL(e.files[0])}})),this.container.appendChild(e)),e.click()},video:function(){this.quill.theme.tooltip.edit("video")}}}}});var M=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.textbox=r.root.querySelector('input[type="text"]'),r.listen(),r}return l(e,t),u(e,[{key:"listen",value:function(){var t=this;this.textbox.addEventListener("keydown",(function(e){g.default.match(e,"enter")?(t.save(),e.preventDefault()):g.default.match(e,"escape")&&(t.cancel(),e.preventDefault())}))}},{key:"cancel",value:function(){this.hide()}},{key:"edit",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"link",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),null!=e?this.textbox.value=e:t!==this.root.getAttribute("data-mode")&&(this.textbox.value=""),this.position(this.quill.getBounds(this.quill.selection.savedRange)),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute("data-"+t)||""),this.root.setAttribute("data-mode",t)}},{key:"restoreFocus",value:function(){var t=this.quill.scrollingContainer.scrollTop;this.quill.focus(),this.quill.scrollingContainer.scrollTop=t}},{key:"save",value:function(){var t=this.textbox.value;switch(this.root.getAttribute("data-mode")){case"link":var e=this.quill.root.scrollTop;this.linkRange?(this.quill.formatText(this.linkRange,"link",t,v.default.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",t,v.default.sources.USER)),this.quill.root.scrollTop=e;break;case"video":t=function a(t){var e=t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||t.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?(e[1]||"https")+"://www.youtube.com/embed/"+e[2]+"?showinfo=0":(e=t.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?(e[1]||"https")+"://player.vimeo.com/video/"+e[2]+"/":t}(t);case"formula":if(!t)break;var n=this.quill.getSelection(!0);if(null!=n){var r=n.index+n.length;this.quill.insertEmbed(r,this.root.getAttribute("data-mode"),t,v.default.sources.USER),"formula"===this.root.getAttribute("data-mode")&&this.quill.insertText(r+1," ",v.default.sources.USER),this.quill.setSelection(r+2,v.default.sources.USER)}}this.textbox.value="",this.hide()}}]),e}(A.default);e.BaseTooltip=M,e.default=L},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(46)),l=n(34),a=n(36),s=n(62),c=r(n(63)),h=r(n(64)),p=n(65),d=r(p),y=n(35),v=n(24),b=n(37),g=n(38),_=r(n(39)),w=r(n(66)),k=r(n(15)),N=r(n(67)),A=r(n(68)),T=r(n(69)),S=r(n(70)),L=r(n(71)),M=n(13),R=r(M),B=r(n(72)),U=r(n(73)),H=r(n(74)),z=r(n(26)),V=r(n(16)),G=r(n(41)),X=r(n(42)),Q=r(n(43)),tt=r(n(107)),nt=r(n(108));i.default.register({"attributors/attribute/direction":a.DirectionAttribute,"attributors/class/align":l.AlignClass,"attributors/class/background":y.BackgroundClass,"attributors/class/color":v.ColorClass,"attributors/class/direction":a.DirectionClass,"attributors/class/font":b.FontClass,"attributors/class/size":g.SizeClass,"attributors/style/align":l.AlignStyle,"attributors/style/background":y.BackgroundStyle,"attributors/style/color":v.ColorStyle,"attributors/style/direction":a.DirectionStyle,"attributors/style/font":b.FontStyle,"attributors/style/size":g.SizeStyle},!0),i.default.register({"formats/align":l.AlignClass,"formats/direction":a.DirectionClass,"formats/indent":s.IndentClass,"formats/background":y.BackgroundStyle,"formats/color":v.ColorStyle,"formats/font":b.FontClass,"formats/size":g.SizeClass,"formats/blockquote":c.default,"formats/code-block":R.default,"formats/header":h.default,"formats/list":d.default,"formats/bold":_.default,"formats/code":M.Code,"formats/italic":w.default,"formats/link":k.default,"formats/script":N.default,"formats/strike":A.default,"formats/underline":T.default,"formats/image":S.default,"formats/video":L.default,"formats/list/item":p.ListItem,"modules/formula":B.default,"modules/syntax":U.default,"modules/toolbar":H.default,"themes/bubble":tt.default,"themes/snow":nt.default,"ui/icons":z.default,"ui/picker":V.default,"ui/icon-picker":X.default,"ui/color-picker":G.default,"ui/tooltip":Q.default},!0),e.default=i.default},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=r(n(0)),a=r(n(6)),s=n(3),u=r(s),f=r(n(14)),p=r(n(23)),y=r(n(31)),b=r(n(33)),m=r(n(5)),O=r(n(59)),x=r(n(8)),E=r(n(60)),j=r(n(61)),q=r(n(25));a.default.register({"blots/block":u.default,"blots/block/embed":s.BlockEmbed,"blots/break":f.default,"blots/container":p.default,"blots/cursor":y.default,"blots/embed":b.default,"blots/inline":m.default,"blots/scroll":O.default,"blots/text":x.default,"modules/clipboard":E.default,"modules/history":j.default,"modules/keyboard":q.default}),i.default.register(u.default,f.default,y.default,m.default,O.default,x.default),e.default=a.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.head=this.tail=null,this.length=0}return t.prototype.append=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.insertBefore(t[0],null),t.length>1&&this.append.apply(this,t.slice(1))},t.prototype.contains=function(t){for(var e,n=this.iterator();e=n();)if(e===t)return!0;return!1},t.prototype.insertBefore=function(t,e){t&&(t.next=e,null!=e?(t.prev=e.prev,null!=e.prev&&(e.prev.next=t),e.prev=t,e===this.head&&(this.head=t)):null!=this.tail?(this.tail.next=t,t.prev=this.tail,this.tail=t):(t.prev=null,this.head=this.tail=t),this.length+=1)},t.prototype.offset=function(t){for(var e=0,n=this.head;null!=n;){if(n===t)return e;e+=n.length(),n=n.next}return-1},t.prototype.remove=function(t){this.contains(t)&&(null!=t.prev&&(t.prev.next=t.next),null!=t.next&&(t.next.prev=t.prev),t===this.head&&(this.head=t.next),t===this.tail&&(this.tail=t.prev),this.length-=1)},t.prototype.iterator=function(t){return void 0===t&&(t=this.head),function(){var e=t;return null!=t&&(t=t.next),e}},t.prototype.find=function(t,e){void 0===e&&(e=!1);for(var n,r=this.iterator();n=r();){var o=n.length();if(t<o||e&&t===o&&(null==n.next||0!==n.next.length()))return[n,t];t-=o}return[null,0]},t.prototype.forEach=function(t){for(var e,n=this.iterator();e=n();)t(e)},t.prototype.forEachAt=function(t,e,n){if(!(e<=0))for(var r,o=this.find(t),i=o[0],a=t-o[1],s=this.iterator(i);(r=s())&&a<t+e;){var u=r.length();t>a?n(r,t-a,Math.min(e,a+u-t)):n(r,0,Math.min(u,t+e-a)),a+=u}},t.prototype.map=function(t){return this.reduce((function(e,n){return e.push(t(n)),e}),[])},t.prototype.reduce=function(t,e){for(var n,r=this.iterator();n=r();)e=t(e,n);return e},t}();e.default=r},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(17),i=n(1),l={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},a=function(t){function e(e){var n=t.call(this,e)||this;return n.scroll=n,n.observer=new MutationObserver((function(t){n.update(t)})),n.observer.observe(n.domNode,l),n.attach(),n}return r(e,t),e.prototype.detach=function(){t.prototype.detach.call(this),this.observer.disconnect()},e.prototype.deleteAt=function(e,n){this.update(),0===e&&n===this.length()?this.children.forEach((function(t){t.remove()})):t.prototype.deleteAt.call(this,e,n)},e.prototype.formatAt=function(e,n,r,o){this.update(),t.prototype.formatAt.call(this,e,n,r,o)},e.prototype.insertAt=function(e,n,r){this.update(),t.prototype.insertAt.call(this,e,n,r)},e.prototype.optimize=function(e,n){var r=this;void 0===e&&(e=[]),void 0===n&&(n={}),t.prototype.optimize.call(this,n);for(var l=[].slice.call(this.observer.takeRecords());l.length>0;)e.push(l.pop());for(var a=function(t,e){void 0===e&&(e=!0),null!=t&&t!==r&&null!=t.domNode.parentNode&&(null==t.domNode[i.DATA_KEY].mutations&&(t.domNode[i.DATA_KEY].mutations=[]),e&&a(t.parent))},s=function(t){null!=t.domNode[i.DATA_KEY]&&null!=t.domNode[i.DATA_KEY].mutations&&(t instanceof o.default&&t.children.forEach(s),t.optimize(n))},u=e,c=0;u.length>0;c+=1){if(c>=100)throw new Error("[Parchment] Maximum optimize iterations reached");for(u.forEach((function(t){var e=i.find(t.target,!0);null!=e&&(e.domNode===t.target&&("childList"===t.type?(a(i.find(t.previousSibling,!1)),[].forEach.call(t.addedNodes,(function(t){var e=i.find(t,!1);a(e,!1),e instanceof o.default&&e.children.forEach((function(t){a(t,!1)}))}))):"attributes"===t.type&&a(e.prev)),a(e))})),this.children.forEach(s),l=(u=[].slice.call(this.observer.takeRecords())).slice();l.length>0;)e.push(l.pop())}},e.prototype.update=function(e,n){var r=this;void 0===n&&(n={}),(e=e||this.observer.takeRecords()).map((function(t){var e=i.find(t.target,!0);return null==e?null:null==e.domNode[i.DATA_KEY].mutations?(e.domNode[i.DATA_KEY].mutations=[t],e):(e.domNode[i.DATA_KEY].mutations.push(t),null)})).forEach((function(t){null!=t&&t!==r&&null!=t.domNode[i.DATA_KEY]&&t.update(t.domNode[i.DATA_KEY].mutations||[],n)})),null!=this.domNode[i.DATA_KEY].mutations&&t.prototype.update.call(this,this.domNode[i.DATA_KEY].mutations,n),this.optimize(e,n)},e.blotName="scroll",e.defaultChild="block",e.scope=i.Scope.BLOCK_BLOT,e.tagName="DIV",e}(o.default);e.default=a},function(t,e,n){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(18),l=n(1),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.formats=function(n){if(n.tagName!==e.tagName)return t.formats.call(this,n)},e.prototype.format=function(n,r){var o=this;n!==this.statics.blotName||r?t.prototype.format.call(this,n,r):(this.children.forEach((function(t){t instanceof i.default||(t=t.wrap(e.blotName,!0)),o.attributes.copy(t)})),this.unwrap())},e.prototype.formatAt=function(e,n,r,o){null!=this.formats()[r]||l.query(r,l.Scope.ATTRIBUTE)?this.isolate(e,n).format(r,o):t.prototype.formatAt.call(this,e,n,r,o)},e.prototype.optimize=function(n){t.prototype.optimize.call(this,n);var o=this.formats();if(0===Object.keys(o).length)return this.unwrap();var i=this.next;i instanceof e&&i.prev===this&&function r(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(t[n]!==e[n])return!1;return!0}(o,i.formats())&&(i.moveChildren(this),i.remove())},e.blotName="inline",e.scope=l.Scope.INLINE_BLOT,e.tagName="SPAN",e}(i.default);e.default=a},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(18),i=n(1),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.formats=function(n){var r=i.query(e.blotName).tagName;if(n.tagName!==r)return t.formats.call(this,n)},e.prototype.format=function(n,r){null!=i.query(n,i.Scope.BLOCK)&&(n!==this.statics.blotName||r?t.prototype.format.call(this,n,r):this.replaceWith(e.blotName))},e.prototype.formatAt=function(e,n,r,o){null!=i.query(r,i.Scope.BLOCK)?this.format(r,o):t.prototype.formatAt.call(this,e,n,r,o)},e.prototype.insertAt=function(e,n,r){if(null==r||null!=i.query(n,i.Scope.INLINE))t.prototype.insertAt.call(this,e,n,r);else{var o=this.split(e),l=i.create(n,r);o.parent.insertBefore(l,o)}},e.prototype.update=function(e,n){navigator.userAgent.match(/Trident/)?this.build():t.prototype.update.call(this,e,n)},e.blotName="block",e.scope=i.Scope.BLOCK_BLOT,e.tagName="P",e}(o.default);e.default=l},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.formats=function(t){},e.prototype.format=function(e,n){t.prototype.formatAt.call(this,0,this.length(),e,n)},e.prototype.formatAt=function(e,n,r,o){0===e&&n===this.length()?this.format(r,o):t.prototype.formatAt.call(this,e,n,r,o)},e.prototype.formats=function(){return this.statics.formats(this.domNode)},e}(n(19).default);e.default=i},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var o=n(19),i=n(1),l=function(t){function e(e){var n=t.call(this,e)||this;return n.text=n.statics.value(n.domNode),n}return r(e,t),e.create=function(t){return document.createTextNode(t)},e.value=function(t){var e=t.data;return e.normalize&&(e=e.normalize()),e},e.prototype.deleteAt=function(t,e){this.domNode.data=this.text=this.text.slice(0,t)+this.text.slice(t+e)},e.prototype.index=function(t,e){return this.domNode===t?e:-1},e.prototype.insertAt=function(e,n,r){null==r?(this.text=this.text.slice(0,e)+n+this.text.slice(e),this.domNode.data=this.text):t.prototype.insertAt.call(this,e,n,r)},e.prototype.length=function(){return this.text.length},e.prototype.optimize=function(n){t.prototype.optimize.call(this,n),this.text=this.statics.value(this.domNode),0===this.text.length?this.remove():this.next instanceof e&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())},e.prototype.position=function(t,e){return void 0===e&&(e=!1),[this.domNode,t]},e.prototype.split=function(t,e){if(void 0===e&&(e=!1),!e){if(0===t)return this;if(t===this.length())return this.next}var n=i.create(this.domNode.splitText(t));return this.parent.insertBefore(n,this.next),this.text=this.statics.value(this.domNode),n},e.prototype.update=function(t,e){var n=this;t.some((function(t){return"characterData"===t.type&&t.target===n.domNode}))&&(this.text=this.statics.value(this.domNode))},e.prototype.value=function(){return this.text},e.blotName="text",e.scope=i.Scope.INLINE_BLOT,e}(o.default);e.default=l},function(t,e,n){"use strict";var r=document.createElement("div");if(r.classList.toggle("test-class",!1),r.classList.contains("test-class")){var o=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return arguments.length>1&&!this.contains(t)==!e?e:o.call(this,t)}}String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.substr(e,t.length)===t}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){var n=this.toString();("number"!=typeof e||!isFinite(e)||Math.floor(e)!==e||e>n.length)&&(e=n.length),e-=t.length;var r=n.indexOf(t,e);return-1!==r&&r===e}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var e,n=Object(this),r=n.length>>>0,o=arguments[1],i=0;i<r;i++)if(e=n[i],t.call(o,e,i,n))return e}}),document.addEventListener("DOMContentLoaded",(function(){document.execCommand("enableObjectResizing",!1,!1),document.execCommand("autoUrlDetect",!1,!1)}))},function(t,e){function n(t,e,n){if(t==e)return t?[[v,t]]:[];(n<0||t.length<n)&&(n=null);var o=l(t,e),i=t.substring(0,o);o=a(t=t.substring(o),e=e.substring(o));var s=t.substring(t.length-o),c=r(t=t.substring(0,t.length-o),e=e.substring(0,e.length-o));return i&&c.unshift([v,i]),s&&c.push([v,s]),u(c),null!=n&&(c=f(c,n)),function h(t){for(var e=!1,n=function(t){return t.charCodeAt(0)>=56320&&t.charCodeAt(0)<=57343},r=2;r<t.length;r+=1)t[r-2][0]===v&&function(t){return t.charCodeAt(t.length-1)>=55296&&t.charCodeAt(t.length-1)<=56319}(t[r-2][1])&&t[r-1][0]===d&&n(t[r-1][1])&&t[r][0]===y&&n(t[r][1])&&(e=!0,t[r-1][1]=t[r-2][1].slice(-1)+t[r-1][1],t[r][1]=t[r-2][1].slice(-1)+t[r][1],t[r-2][1]=t[r-2][1].slice(0,-1));if(!e)return t;var o=[];for(r=0;r<t.length;r+=1)t[r][1].length>0&&o.push(t[r]);return o}(c)}function r(t,e){var r;if(!t)return[[y,e]];if(!e)return[[d,t]];var i=t.length>e.length?t:e,l=t.length>e.length?e:t,a=i.indexOf(l);if(-1!=a)return r=[[y,i.substring(0,a)],[v,l],[y,i.substring(a+l.length)]],t.length>e.length&&(r[0][0]=r[2][0]=d),r;if(1==l.length)return[[d,t],[y,e]];var u=s(t,e);if(u){var c=u[0],f=u[1],h=u[2],p=u[3],b=u[4],g=n(c,h),m=n(f,p);return g.concat([[v,b]],m)}return o(t,e)}function o(t,e){for(var n=t.length,r=e.length,o=Math.ceil((n+r)/2),l=o,a=2*o,s=new Array(a),u=new Array(a),c=0;c<a;c++)s[c]=-1,u[c]=-1;s[l+1]=0,u[l+1]=0;for(var f=n-r,h=f%2!=0,p=0,v=0,b=0,g=0,m=0;m<o;m++){for(var _=-m+p;_<=m-v;_+=2){for(var w=l+_,x=(O=_==-m||_!=m&&s[w-1]<s[w+1]?s[w+1]:s[w-1]+1)-_;O<n&&x<r&&t.charAt(O)==e.charAt(x);)O++,x++;if(s[w]=O,O>n)v+=2;else if(x>r)p+=2;else if(h){if((k=l+f-_)>=0&&k<a&&-1!=u[k])if(O>=(E=n-u[k]))return i(t,e,O,x)}}for(var N=-m+b;N<=m-g;N+=2){for(var E,k=l+N,j=(E=N==-m||N!=m&&u[k-1]<u[k+1]?u[k+1]:u[k-1]+1)-N;E<n&&j<r&&t.charAt(n-E-1)==e.charAt(r-j-1);)E++,j++;if(u[k]=E,E>n)g+=2;else if(j>r)b+=2;else if(!h){if((w=l+f-N)>=0&&w<a&&-1!=s[w]){var O;x=l+(O=s[w])-w;if(O>=(E=n-E))return i(t,e,O,x)}}}}return[[d,t],[y,e]]}function i(t,e,r,o){var i=t.substring(0,r),l=e.substring(0,o),a=t.substring(r),s=e.substring(o),u=n(i,l),c=n(a,s);return u.concat(c)}function l(t,e){if(!t||!e||t.charAt(0)!=e.charAt(0))return 0;for(var n=0,r=Math.min(t.length,e.length),o=r,i=0;n<o;)t.substring(i,o)==e.substring(i,o)?i=n=o:r=o,o=Math.floor((r-n)/2+n);return o}function a(t,e){if(!t||!e||t.charAt(t.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,r=Math.min(t.length,e.length),o=r,i=0;n<o;)t.substring(t.length-o,t.length-i)==e.substring(e.length-o,e.length-i)?i=n=o:r=o,o=Math.floor((r-n)/2+n);return o}function s(t,e){function n(t,e,n){for(var r,o,i,s,u=t.substring(n,n+Math.floor(t.length/4)),c=-1,f="";-1!=(c=e.indexOf(u,c+1));){var h=l(t.substring(n),e.substring(c)),p=a(t.substring(0,n),e.substring(0,c));f.length<p+h&&(f=e.substring(c-p,c)+e.substring(c,c+h),r=t.substring(0,n-p),o=t.substring(n+h),i=e.substring(0,c-p),s=e.substring(c+h))}return 2*f.length>=t.length?[r,o,i,s,f]:null}var r=t.length>e.length?t:e,o=t.length>e.length?e:t;if(r.length<4||2*o.length<r.length)return null;var i,c,f,h,p,s=n(r,o,Math.ceil(r.length/4)),u=n(r,o,Math.ceil(r.length/2));return s||u?(i=u?s&&s[4].length>u[4].length?s:u:s,t.length>e.length?(c=i[0],f=i[1],h=i[2],p=i[3]):(h=i[0],p=i[1],c=i[2],f=i[3]),[c,f,h,p,i[4]]):null}function u(t){t.push([v,""]);for(var e,n=0,r=0,o=0,i="",s="";n<t.length;)switch(t[n][0]){case y:o++,s+=t[n][1],n++;break;case d:r++,i+=t[n][1],n++;break;case v:r+o>1?(0!==r&&0!==o&&(0!==(e=l(s,i))&&(n-r-o>0&&t[n-r-o-1][0]==v?t[n-r-o-1][1]+=s.substring(0,e):(t.splice(0,0,[v,s.substring(0,e)]),n++),s=s.substring(e),i=i.substring(e)),0!==(e=a(s,i))&&(t[n][1]=s.substring(s.length-e)+t[n][1],s=s.substring(0,s.length-e),i=i.substring(0,i.length-e))),0===r?t.splice(n-o,r+o,[y,s]):0===o?t.splice(n-r,r+o,[d,i]):t.splice(n-r-o,r+o,[d,i],[y,s]),n=n-r-o+(r?1:0)+(o?1:0)+1):0!==n&&t[n-1][0]==v?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,o=0,r=0,i="",s=""}""===t[t.length-1][1]&&t.pop();var c=!1;for(n=1;n<t.length-1;)t[n-1][0]==v&&t[n+1][0]==v&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)==t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),c=!0):t[n][1].substring(0,t[n+1][1].length)==t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),c=!0)),n++;c&&u(t)}function f(t,e){var n=function c(t,e){if(0===e)return[v,t];for(var n=0,r=0;r<t.length;r++){var o=t[r];if(o[0]===d||o[0]===v){var i=n+o[1].length;if(e===i)return[r+1,t];if(e<i){t=t.slice();var l=e-n,a=[o[0],o[1].slice(0,l)],s=[o[0],o[1].slice(l)];return t.splice(r,1,a,s),[r+1,t]}n=i}}throw new Error("cursor_pos is out of bounds!")}(t,e),r=n[1],o=n[0],i=r[o],l=r[o+1];if(null==i)return t;if(i[0]!==v)return t;if(null!=l&&i[1]+l[1]===l[1]+i[1])return r.splice(o,2,l,i),p(r,o,2);if(null!=l&&0===l[1].indexOf(i[1])){r.splice(o,2,[l[0],i[1]],[0,i[1]]);var a=l[1].slice(i[1].length);return a.length>0&&r.splice(o+2,0,[l[0],a]),p(r,o,3)}return t}function p(t,e,n){for(var r=e+n-1;r>=0&&r>=e-1;r--)if(r+1<t.length){var o=t[r],i=t[r+1];o[0]===i[1]&&t.splice(r,2,[o[0],o[1]+i[1]])}return t}var d=-1,y=1,v=0,b=n;b.INSERT=y,b.DELETE=d,b.EQUAL=v,t.exports=b},function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n},function(t,e){function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function r(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}var o="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();(e=t.exports=o?n:r).supported=n,e.unsupported=r},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e){return Object.keys(e).reduce((function(n,r){return null==t[r]||(e[r]===t[r]?n[r]=e[r]:Array.isArray(e[r])?e[r].indexOf(t[r])<0&&(n[r]=e[r].concat([t[r]])):n[r]=[e[r],t[r]]),n}),{})}Object.defineProperty(e,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=r(n(4)),d=r(n(20)),v=r(n(0)),g=r(n(13)),_=r(n(31)),O=n(3),w=r(O),k=r(n(14)),N=r(n(21)),A=r(n(12)),T=r(n(2)),P=/^[ -~]*$/,S=function(){function t(e){(function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.scroll=e,this.delta=this.getDelta()}return c(t,[{key:"applyDelta",value:function(t){var e=this,n=!1;this.scroll.update();var r=this.scroll.length();return this.scroll.batchStart(),(t=function a(t){return t.reduce((function(t,e){if(1===e.insert){var n=(0,N.default)(e.attributes);return delete n.image,t.insert({image:e.attributes.image},n)}if(null==e.attributes||!0!==e.attributes.list&&!0!==e.attributes.bullet||((e=(0,N.default)(e)).attributes.list?e.attributes.list="ordered":(e.attributes.list="bullet",delete e.attributes.bullet)),"string"==typeof e.insert){var r=e.insert.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return t.insert(r,e.attributes)}return t.push(e)}),new h.default)}(t)).reduce((function(t,o){var i=o.retain||o.delete||o.insert.length||1,l=o.attributes||{};if(null!=o.insert){if("string"==typeof o.insert){var a=o.insert;a.endsWith("\n")&&n&&(n=!1,a=a.slice(0,-1)),t>=r&&!a.endsWith("\n")&&(n=!0),e.scroll.insertAt(t,a);var c=e.scroll.line(t),f=u(c,2),h=f[0],p=f[1],y=(0,T.default)({},(0,O.bubbleFormats)(h));if(h instanceof w.default){var b=h.descendant(v.default.Leaf,p),m=u(b,1)[0];y=(0,T.default)(y,(0,O.bubbleFormats)(m))}l=d.default.attributes.diff(y,l)||{}}else if("object"===s(o.insert)){var _=Object.keys(o.insert)[0];if(null==_)return t;e.scroll.insertAt(t,_,o.insert[_])}r+=i}return Object.keys(l).forEach((function(n){e.scroll.formatAt(t,i,n,l[n])})),t+i}),0),t.reduce((function(t,n){return"number"==typeof n.delete?(e.scroll.deleteAt(t,n.delete),t):t+(n.retain||n.insert.length||1)}),0),this.scroll.batchEnd(),this.update(t)}},{key:"deleteText",value:function(t,e){return this.scroll.deleteAt(t,e),this.update((new h.default).retain(t).delete(e))}},{key:"formatLine",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.scroll.update(),Object.keys(r).forEach((function(o){if(null==n.scroll.whitelist||n.scroll.whitelist[o]){var i=n.scroll.lines(t,Math.max(e,1)),l=e;i.forEach((function(e){var i=e.length();if(e instanceof g.default){var a=t-e.offset(n.scroll),s=e.newlineIndex(a+l)-a+1;e.formatAt(a,s,o,r[o])}else e.format(o,r[o]);l-=i}))}})),this.scroll.optimize(),this.update((new h.default).retain(t).retain(e,(0,N.default)(r)))}},{key:"formatText",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Object.keys(r).forEach((function(o){n.scroll.formatAt(t,e,o,r[o])})),this.update((new h.default).retain(t).retain(e,(0,N.default)(r)))}},{key:"getContents",value:function(t,e){return this.delta.slice(t,t+e)}},{key:"getDelta",value:function(){return this.scroll.lines().reduce((function(t,e){return t.concat(e.delta())}),new h.default)}},{key:"getFormat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[],r=[];0===e?this.scroll.path(t).forEach((function(t){var o=u(t,1)[0];o instanceof w.default?n.push(o):o instanceof v.default.Leaf&&r.push(o)})):(n=this.scroll.lines(t,e),r=this.scroll.descendants(v.default.Leaf,t,e));var o=[n,r].map((function(t){if(0===t.length)return{};for(var e=(0,O.bubbleFormats)(t.shift());Object.keys(e).length>0;){var n=t.shift();if(null==n)return e;e=l((0,O.bubbleFormats)(n),e)}return e}));return T.default.apply(T.default,o)}},{key:"getText",value:function(t,e){return this.getContents(t,e).filter((function(t){return"string"==typeof t.insert})).map((function(t){return t.insert})).join("")}},{key:"insertEmbed",value:function(t,e,n){return this.scroll.insertAt(t,e,n),this.update((new h.default).retain(t).insert(function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},e,n)))}},{key:"insertText",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"),this.scroll.insertAt(t,e),Object.keys(r).forEach((function(o){n.scroll.formatAt(t,e.length,o,r[o])})),this.update((new h.default).retain(t).insert(e,(0,N.default)(r)))}},{key:"isBlank",value:function(){if(0==this.scroll.children.length)return!0;if(this.scroll.children.length>1)return!1;var t=this.scroll.children.head;return t.statics.blotName===w.default.blotName&&!(t.children.length>1)&&t.children.head instanceof k.default}},{key:"removeFormat",value:function(t,e){var n=this.getText(t,e),r=this.scroll.line(t+e),o=u(r,2),i=o[0],l=o[1],a=0,s=new h.default;null!=i&&(a=i instanceof g.default?i.newlineIndex(l)-l+1:i.length()-l,s=i.delta().slice(l,l+a-1).insert("\n"));var f=this.getContents(t,e+a).diff((new h.default).insert(n).concat(s)),p=(new h.default).retain(t).concat(f);return this.applyDelta(p)}},{key:"update",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=this.delta;if(1===e.length&&"characterData"===e[0].type&&e[0].target.data.match(P)&&v.default.find(e[0].target)){var o=v.default.find(e[0].target),i=(0,O.bubbleFormats)(o),l=o.offset(this.scroll),a=e[0].oldValue.replace(_.default.CONTENTS,""),s=(new h.default).insert(a),u=(new h.default).insert(o.value());t=(new h.default).retain(l).concat(s.diff(u,n)).reduce((function(t,e){return e.insert?t.insert(e.insert,i):t.push(e)}),new h.default),this.delta=r.compose(t)}else this.delta=this.getDelta(),t&&(0,A.default)(r.compose(t),this.delta)||(t=r.diff(this.delta,n));return t}}]),t}();e.default=S},function(t,e){"use strict";function n(){}function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(){this._events=new n,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,l="~";Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(l=!1)),o.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)i.call(t,e)&&n.push(l?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},o.prototype.listeners=function(t,e){var n=l?l+t:t,r=this._events[n];if(e)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,a=new Array(i);o<i;o++)a[o]=r[o].fn;return a},o.prototype.emit=function(t,e,n,r,o,i){var a=l?l+t:t;if(!this._events[a])return!1;var s,u,c=this._events[a],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,n),!0;case 4:return c.fn.call(c.context,e,n,r),!0;case 5:return c.fn.call(c.context,e,n,r,o),!0;case 6:return c.fn.call(c.context,e,n,r,o,i),!0}for(u=1,s=new Array(f-1);u<f;u++)s[u-1]=arguments[u];c.fn.apply(c.context,s)}else{var h,p=c.length;for(u=0;u<p;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),f){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,n);break;case 4:c[u].fn.call(c[u].context,e,n,r);break;default:if(!s)for(h=1,s=new Array(f-1);h<f;h++)s[h-1]=arguments[h];c[u].fn.apply(c[u].context,s)}}return!0},o.prototype.on=function(t,e,n){var o=new r(e,n||this),i=l?l+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},o.prototype.once=function(t,e,n){var o=new r(e,n||this,!0),i=l?l+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],o]:this._events[i].push(o):(this._events[i]=o,this._eventsCount++),this},o.prototype.removeListener=function(t,e,r,o){var i=l?l+t:t;if(!this._events[i])return this;if(!e)return 0==--this._eventsCount?this._events=new n:delete this._events[i],this;var a=this._events[i];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||(0==--this._eventsCount?this._events=new n:delete this._events[i]);else{for(var s=0,u=[],c=a.length;s<c;s++)(a[s].fn!==e||o&&!a[s].once||r&&a[s].context!==r)&&u.push(a[s]);u.length?this._events[i]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new n:delete this._events[i]}return this},o.prototype.removeAllListeners=function(t){var e;return t?(e=l?l+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new n:delete this._events[e])):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.prefixed=l,o.EventEmitter=o,void 0!==t&&(t.exports=o)},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function a(t){return t instanceof v.default||t instanceof y.BlockEmbed}Object.defineProperty(e,"__esModule",{value:!0});var s=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},h=r(n(0)),d=r(n(9)),y=n(3),v=r(y),g=r(n(14)),_=r(n(13)),w=r(n(23)),x=function(t){function e(t,n){!function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return r.emitter=n.emitter,Array.isArray(n.whitelist)&&(r.whitelist=n.whitelist.reduce((function(t,e){return t[e]=!0,t}),{})),r.domNode.addEventListener("DOMNodeInserted",(function(){})),r.optimize(),r.enable(),r}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),u(e,[{key:"batchStart",value:function(){this.batch=!0}},{key:"batchEnd",value:function(){this.batch=!1,this.optimize()}},{key:"deleteAt",value:function(t,n){var r=this.line(t),o=s(r,2),i=o[0],l=o[1],a=this.line(t+n),f=s(a,1)[0];if(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"deleteAt",this).call(this,t,n),null!=f&&i!==f&&l>0){if(i instanceof y.BlockEmbed||f instanceof y.BlockEmbed)return void this.optimize();if(i instanceof _.default){var h=i.newlineIndex(i.length(),!0);if(h>-1&&(i=i.split(h+1))===f)return void this.optimize()}else if(f instanceof _.default){var p=f.newlineIndex(0);p>-1&&f.split(p+1)}var d=f.children.head instanceof g.default?null:f.children.head;i.moveChildren(f,d),i.remove()}this.optimize()}},{key:"enable",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.domNode.setAttribute("contenteditable",t)}},{key:"formatAt",value:function(t,n,r,o){(null==this.whitelist||this.whitelist[r])&&(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"formatAt",this).call(this,t,n,r,o),this.optimize())}},{key:"insertAt",value:function(t,n,r){if(null==r||null==this.whitelist||this.whitelist[n]){if(t>=this.length())if(null==r||null==h.default.query(n,h.default.Scope.BLOCK)){var o=h.default.create(this.statics.defaultChild);this.appendChild(o),null==r&&n.endsWith("\n")&&(n=n.slice(0,-1)),o.insertAt(0,n,r)}else{var i=h.default.create(n,r);this.appendChild(i)}else c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertAt",this).call(this,t,n,r);this.optimize()}}},{key:"insertBefore",value:function(t,n){if(t.statics.scope===h.default.Scope.INLINE_BLOT){var r=h.default.create(this.statics.defaultChild);r.appendChild(t),t=r}c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertBefore",this).call(this,t,n)}},{key:"leaf",value:function(t){return this.path(t).pop()||[null,-1]}},{key:"line",value:function(t){return t===this.length()?this.line(t-1):this.descendant(a,t)}},{key:"lines",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;return function t(e,n,r){var o=[],i=r;return e.children.forEachAt(n,r,(function(e,n,r){a(e)?o.push(e):e instanceof h.default.Container&&(o=o.concat(t(e,n,i))),i-=r})),o}(this,t,e)}},{key:"optimize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!0!==this.batch&&(c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t,n),t.length>0&&this.emitter.emit(d.default.events.SCROLL_OPTIMIZE,t,n))}},{key:"path",value:function(t){return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"path",this).call(this,t).slice(1)}},{key:"update",value:function(t){if(!0!==this.batch){var n=d.default.sources.USER;"string"==typeof t&&(n=t),Array.isArray(t)||(t=this.observer.takeRecords()),t.length>0&&this.emitter.emit(d.default.events.SCROLL_BEFORE_UPDATE,n,t),c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"update",this).call(this,t.concat([])),t.length>0&&this.emitter.emit(d.default.events.SCROLL_UPDATE,n,t)}}}]),e}(h.default.Scroll);x.blotName="scroll",x.className="ql-editor",x.tagName="DIV",x.defaultChild="block",x.allowedChildren=[v.default,y.BlockEmbed,w.default],e.default=x},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e,n){return"object"===(void 0===e?"undefined":x(e))?Object.keys(e).reduce((function(t,n){return s(t,n,e[n])}),t):t.reduce((function(t,r){return r.attributes&&r.attributes[e]?t.push(r):t.insert(r.insert,(0,j.default)({},o({},e,n),r.attributes))}),new q.default)}function u(t){return t.nodeType!==Node.ELEMENT_NODE?{}:t["__ql-computed-style"]||(t["__ql-computed-style"]=window.getComputedStyle(t))}function c(t,e){for(var n="",r=t.ops.length-1;r>=0&&n.length<e.length;--r){var o=t.ops[r];if("string"!=typeof o.insert)break;n=o.insert+n}return n.slice(-1*e.length)===e}function f(t){return 0!==t.childNodes.length&&["block","list-item"].indexOf(u(t).display)>-1}function h(t,e,n){return t.nodeType===t.TEXT_NODE?n.reduce((function(e,n){return n(t,e)}),new q.default):t.nodeType===t.ELEMENT_NODE?[].reduce.call(t.childNodes||[],(function(r,o){var i=h(o,e,n);return o.nodeType===t.ELEMENT_NODE&&(i=e.reduce((function(t,e){return e(o,t)}),i),i=(o[W]||[]).reduce((function(t,e){return e(o,t)}),i)),r.concat(i)}),new q.default):new q.default}function p(t,e,n){return s(n,t,!0)}function d(t,e){var n=P.default.Attributor.Attribute.keys(t),r=P.default.Attributor.Class.keys(t),o=P.default.Attributor.Style.keys(t),i={};return n.concat(r).concat(o).forEach((function(e){var n=P.default.query(e,P.default.Scope.ATTRIBUTE);null!=n&&(i[n.attrName]=n.value(t),i[n.attrName])||(null==(n=Y[e])||n.attrName!==e&&n.keyName!==e||(i[n.attrName]=n.value(t)||void 0),null==(n=X[e])||n.attrName!==e&&n.keyName!==e||(n=X[e],i[n.attrName]=n.value(t)||void 0))})),Object.keys(i).length>0&&(e=s(e,i)),e}function y(t,e){var n=P.default.query(t);if(null==n)return e;if(n.prototype instanceof P.default.Embed){var r={},o=n.value(t);null!=o&&(r[n.blotName]=o,e=(new q.default).insert(r,n.formats(t)))}else"function"==typeof n.formats&&(e=s(e,n.blotName,n.formats(t)));return e}function m(t,e){return c(e,"\n")||(f(t)||e.length()>0&&t.nextSibling&&f(t.nextSibling))&&e.insert("\n"),e}function _(t,e){if(f(t)&&null!=t.nextElementSibling&&!c(e,"\n\n")){var n=t.offsetHeight+parseFloat(u(t).marginTop)+parseFloat(u(t).marginBottom);t.nextElementSibling.offsetTop>t.offsetTop+1.5*n&&e.insert("\n")}return e}function w(t,e){var n=t.data;if("O:P"===t.parentNode.tagName)return e.insert(n.trim());if(0===n.trim().length&&t.parentNode.classList.contains("ql-clipboard"))return e;if(!u(t.parentNode).whiteSpace.startsWith("pre")){var r=function(t,e){return(e=e.replace(/[^\u00a0]/g,"")).length<1&&t?" ":e};n=(n=n.replace(/\r\n/g," ").replace(/\n/g," ")).replace(/\s\s+/g,r.bind(r,!0)),(null==t.previousSibling&&f(t.parentNode)||null!=t.previousSibling&&f(t.previousSibling))&&(n=n.replace(/^\s+/,r.bind(r,!1))),(null==t.nextSibling&&f(t.parentNode)||null!=t.nextSibling&&f(t.nextSibling))&&(n=n.replace(/\s+$/,r.bind(r,!1)))}return e.insert(n)}Object.defineProperty(e,"__esModule",{value:!0}),e.matchText=e.matchSpacing=e.matchNewline=e.matchBlot=e.matchAttributor=e.default=void 0;var x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},k=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},E=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),j=r(n(2)),q=r(n(4)),P=r(n(0)),C=r(n(6)),M=r(n(10)),I=r(n(7)),B=n(34),D=n(35),F=r(n(13)),H=n(24),K=n(36),z=n(37),Z=n(38),V=(0,M.default)("quill:clipboard"),W="__ql-matcher",G=[[Node.TEXT_NODE,w],[Node.TEXT_NODE,m],["br",function v(t,e){return c(e,"\n")||e.insert("\n"),e}],[Node.ELEMENT_NODE,m],[Node.ELEMENT_NODE,y],[Node.ELEMENT_NODE,_],[Node.ELEMENT_NODE,d],[Node.ELEMENT_NODE,function O(t,e){var n={},r=t.style||{};return r.fontStyle&&"italic"===u(t).fontStyle&&(n.italic=!0),r.fontWeight&&(u(t).fontWeight.startsWith("bold")||parseInt(u(t).fontWeight)>=700)&&(n.bold=!0),Object.keys(n).length>0&&(e=s(e,n)),parseFloat(r.textIndent||0)>0&&(e=(new q.default).insert("\t").concat(e)),e}],["li",function g(t,e){var n=P.default.query(t);if(null==n||"list-item"!==n.blotName||!c(e,"\n"))return e;for(var r=-1,o=t.parentNode;!o.classList.contains("ql-clipboard");)"list"===(P.default.query(o)||{}).blotName&&(r+=1),o=o.parentNode;return r<=0?e:e.compose((new q.default).retain(e.length()-1).retain(1,{indent:r}))}],["b",p.bind(p,"bold")],["i",p.bind(p,"italic")],["style",function b(){return new q.default}]],Y=[B.AlignAttribute,K.DirectionAttribute].reduce((function(t,e){return t[e.keyName]=e,t}),{}),X=[B.AlignStyle,D.BackgroundStyle,H.ColorStyle,K.DirectionStyle,z.FontStyle,Z.SizeStyle].reduce((function(t,e){return t[e.keyName]=e,t}),{}),$=function(t){function e(t,n){!function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.quill.root.addEventListener("paste",r.onPaste.bind(r)),r.container=r.quill.addContainer("ql-clipboard"),r.container.setAttribute("contenteditable",!0),r.container.setAttribute("tabindex",-1),r.matchers=[],G.concat(r.options.matchers).forEach((function(t){var e=k(t,2),o=e[0],i=e[1];(n.matchVisual||i!==_)&&r.addMatcher(o,i)})),r}return function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),E(e,[{key:"addMatcher",value:function(t,e){this.matchers.push([t,e])}},{key:"convert",value:function(t){if("string"==typeof t)return this.container.innerHTML=t.replace(/\>\r?\n +\</g,"><"),this.convert();var e=this.quill.getFormat(this.quill.selection.savedRange.index);if(e[F.default.blotName]){var n=this.container.innerText;return this.container.innerHTML="",(new q.default).insert(n,o({},F.default.blotName,e[F.default.blotName]))}var r=this.prepareMatching(),i=k(r,2),l=i[0],a=i[1],s=h(this.container,l,a);return c(s,"\n")&&null==s.ops[s.ops.length-1].attributes&&(s=s.compose((new q.default).retain(s.length()-1).delete(1))),V.log("convert",this.container.innerHTML,s),this.container.innerHTML="",s}},{key:"dangerouslyPasteHTML",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:C.default.sources.API;if("string"==typeof t)this.quill.setContents(this.convert(t),e),this.quill.setSelection(0,C.default.sources.SILENT);else{var r=this.convert(e);this.quill.updateContents((new q.default).retain(t).concat(r),n),this.quill.setSelection(t+r.length(),C.default.sources.SILENT)}}},{key:"onPaste",value:function(t){var e=this;if(!t.defaultPrevented&&this.quill.isEnabled()){var n=this.quill.getSelection(),r=(new q.default).retain(n.index),o=this.quill.scrollingContainer.scrollTop;this.container.focus(),this.quill.selection.update(C.default.sources.SILENT),setTimeout((function(){r=r.concat(e.convert()).delete(n.length),e.quill.updateContents(r,C.default.sources.USER),e.quill.setSelection(r.length()-n.length,C.default.sources.SILENT),e.quill.scrollingContainer.scrollTop=o,e.quill.focus()}),1)}}},{key:"prepareMatching",value:function(){var t=this,e=[],n=[];return this.matchers.forEach((function(r){var o=k(r,2),i=o[0],l=o[1];switch(i){case Node.TEXT_NODE:n.push(l);break;case Node.ELEMENT_NODE:e.push(l);break;default:[].forEach.call(t.container.querySelectorAll(i),(function(t){t[W]=t[W]||[],t[W].push(l)}))}})),[e,n]}}]),e}(I.default);$.DEFAULTS={matchers:[],matchVisual:!0},e.default=$,e.matchAttributor=d,e.matchBlot=y,e.matchNewline=m,e.matchSpacing=_,e.matchText=w},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=t.reduce((function(t,e){return t+(e.delete||0)}),0),n=t.length()-e;return function a(t){var e=t.ops[t.ops.length-1];return null!=e&&(null!=e.insert?"string"==typeof e.insert&&e.insert.endsWith("\n"):null!=e.attributes&&Object.keys(e.attributes).some((function(t){return null!=f.default.query(t,f.default.Scope.BLOCK)})))}(t)&&(n-=1),n}Object.defineProperty(e,"__esModule",{value:!0}),e.getLastChangeIndex=e.default=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=r(n(0)),p=r(n(6)),v=function(t){function e(t,n){!function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var r=function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.lastRecorded=0,r.ignoreChange=!1,r.clear(),r.quill.on(p.default.events.EDITOR_CHANGE,(function(t,e,n,o){t!==p.default.events.TEXT_CHANGE||r.ignoreChange||(r.options.userOnly&&o!==p.default.sources.USER?r.transform(e):r.record(e,n))})),r.quill.keyboard.addBinding({key:"Z",shortKey:!0},r.undo.bind(r)),r.quill.keyboard.addBinding({key:"Z",shortKey:!0,shiftKey:!0},r.redo.bind(r)),/Win/i.test(navigator.platform)&&r.quill.keyboard.addBinding({key:"Y",shortKey:!0},r.redo.bind(r)),r}return function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),u(e,[{key:"change",value:function(t,e){if(0!==this.stack[t].length){var n=this.stack[t].pop();this.stack[e].push(n),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(n[t],p.default.sources.USER),this.ignoreChange=!1;var r=s(n[t]);this.quill.setSelection(r)}}},{key:"clear",value:function(){this.stack={undo:[],redo:[]}}},{key:"cutoff",value:function(){this.lastRecorded=0}},{key:"record",value:function(t,e){if(0!==t.ops.length){this.stack.redo=[];var n=this.quill.getContents().diff(e),r=Date.now();if(this.lastRecorded+this.options.delay>r&&this.stack.undo.length>0){var o=this.stack.undo.pop();n=n.compose(o.undo),t=o.redo.compose(t)}else this.lastRecorded=r;this.stack.undo.push({redo:t,undo:n}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift()}}},{key:"redo",value:function(){this.change("redo","undo")}},{key:"transform",value:function(t){this.stack.undo.forEach((function(e){e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0)})),this.stack.redo.forEach((function(e){e.undo=t.transform(e.undo,!0),e.redo=t.transform(e.redo,!0)}))}},{key:"undo",value:function(){this.change("undo","redo")}}]),e}(r(n(7)).default);v.DEFAULTS={delay:1e3,maxStack:100,userOnly:!1},e.default=v,e.getLastChangeIndex=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0}),e.IndentClass=void 0;var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),f=new(function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"add",value:function(t,n){if("+1"===n||"-1"===n){var r=this.value(t)||0;n="+1"===n?r+1:r-1}return 0===n?(this.remove(t),!0):a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"add",this).call(this,t,n)}},{key:"canAdd",value:function(t,n){return a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"canAdd",this).call(this,t,n)||a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"canAdd",this).call(this,t,parseInt(n))}},{key:"value",value:function(t){return parseInt(a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"value",this).call(this,t))||void 0}}]),e}(u.default.Attributor.Class))("indent","ql-indent",{scope:u.default.Scope.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});e.IndentClass=f},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(3)).default);s.blotName="blockquote",s.tagName="blockquote",e.default=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,null,[{key:"formats",value:function(t){return this.tagName.indexOf(t.tagName)+1}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(3)).default);u.blotName="header",u.tagName=["H1","H2","H3","H4","H5","H6"],e.default=u},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.ListItem=void 0;var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},f=r(n(0)),p=r(n(3)),y=r(n(23)),v=function(t){function e(){return i(this,e),l(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return a(e,t),s(e,[{key:"format",value:function(t,n){t!==b.blotName||n?u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n):this.replaceWith(f.default.create(this.statics.scope))}},{key:"remove",value:function(){null==this.prev&&null==this.next?this.parent.remove():u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"remove",this).call(this)}},{key:"replaceWith",value:function(t,n){return this.parent.isolate(this.offset(this.parent),this.length()),t===this.parent.statics.blotName?(this.parent.replaceWith(t,n),this):(this.parent.unwrap(),u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"replaceWith",this).call(this,t,n))}}],[{key:"formats",value:function(t){return t.tagName===this.tagName?void 0:u(e.__proto__||Object.getPrototypeOf(e),"formats",this).call(this,t)}}]),e}(p.default);v.blotName="list-item",v.tagName="LI";var b=function(t){function e(t){i(this,e);var n=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),r=function(e){if(e.target.parentNode===t){var r=n.statics.formats(t),o=f.default.find(e.target);"checked"===r?o.format("list","unchecked"):"unchecked"===r&&o.format("list","checked")}};return t.addEventListener("touchstart",r),t.addEventListener("mousedown",r),n}return a(e,t),s(e,null,[{key:"create",value:function(t){var n="ordered"===t?"OL":"UL",r=u(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,n);return"checked"!==t&&"unchecked"!==t||r.setAttribute("data-checked","checked"===t),r}},{key:"formats",value:function(t){return"OL"===t.tagName?"ordered":"UL"===t.tagName?t.hasAttribute("data-checked")?"true"===t.getAttribute("data-checked")?"checked":"unchecked":"bullet":void 0}}]),s(e,[{key:"format",value:function(t,e){this.children.length>0&&this.children.tail.format(t,e)}},{key:"formats",value:function(){return function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},this.statics.blotName,this.statics.formats(this.domNode))}},{key:"insertBefore",value:function(t,n){if(t instanceof v)u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"insertBefore",this).call(this,t,n);else{var r=null==n?this.length():n.offset(this),o=this.split(r);o.parent.insertBefore(t,o)}}},{key:"optimize",value:function(t){u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"optimize",this).call(this,t);var n=this.next;null!=n&&n.prev===this&&n.statics.blotName===this.statics.blotName&&n.domNode.tagName===this.domNode.tagName&&n.domNode.getAttribute("data-checked")===this.domNode.getAttribute("data-checked")&&(n.moveChildren(this),n.remove())}},{key:"replace",value:function(t){if(t.statics.blotName!==this.statics.blotName){var n=f.default.create(this.statics.defaultChild);t.moveChildren(n),this.appendChild(n)}u(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"replace",this).call(this,t)}}]),e}(y.default);b.blotName="list",b.scope=f.default.Scope.BLOCK_BLOT,b.tagName=["OL","UL"],b.defaultChild="list-item",b.allowedChildren=[v],e.ListItem=v,e.default=b},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(39)).default);s.blotName="italic",s.tagName=["EM","I"],e.default=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,null,[{key:"create",value:function(t){return"super"===t?document.createElement("sup"):"sub"===t?document.createElement("sub"):a(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t)}},{key:"formats",value:function(t){return"SUB"===t.tagName?"sub":"SUP"===t.tagName?"super":void 0}}]),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(5)).default);c.blotName="script",c.tagName=["SUB","SUP"],e.default=c},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(5)).default);s.blotName="strike",s.tagName="S",e.default=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(function(t){return t&&t.__esModule?t:{default:t}}(n(5)).default);s.blotName="underline",s.tagName="U",e.default=s},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(t){return t&&t.__esModule?t:{default:t}}(n(0)),c=n(15),f=["alt","height","width"],h=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"format",value:function(t,n){f.indexOf(t)>-1?n?this.domNode.setAttribute(t,n):this.domNode.removeAttribute(t):a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n)}}],[{key:"create",value:function(t){var n=a(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return"string"==typeof t&&n.setAttribute("src",this.sanitize(t)),n}},{key:"formats",value:function(t){return f.reduce((function(e,n){return t.hasAttribute(n)&&(e[n]=t.getAttribute(n)),e}),{})}},{key:"match",value:function(t){return/\.(jpe?g|gif|png)$/.test(t)||/^data:image\/.+;base64/.test(t)}},{key:"sanitize",value:function(t){return(0,c.sanitize)(t,["http","https","data"])?t:"//:0"}},{key:"value",value:function(t){return t.getAttribute("src")}}]),e}(u.default.Embed);h.blotName="image",h.tagName="IMG",e.default=h},function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},s=n(3),c=function(t){return t&&t.__esModule?t:{default:t}}(n(15)),f=["height","width"],h=function(t){function e(){return r(this,e),o(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),l(e,[{key:"format",value:function(t,n){f.indexOf(t)>-1?n?this.domNode.setAttribute(t,n):this.domNode.removeAttribute(t):a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"format",this).call(this,t,n)}}],[{key:"create",value:function(t){var n=a(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return n.setAttribute("frameborder","0"),n.setAttribute("allowfullscreen",!0),n.setAttribute("src",this.sanitize(t)),n}},{key:"formats",value:function(t){return f.reduce((function(e,n){return t.hasAttribute(n)&&(e[n]=t.getAttribute(n)),e}),{})}},{key:"sanitize",value:function(t){return c.default.sanitize(t)}},{key:"value",value:function(t){return t.getAttribute("src")}}]),e}(s.BlockEmbed);h.blotName="video",h.className="ql-video",h.tagName="IFRAME",e.default=h},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.FormulaBlot=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=r(n(33)),h=r(n(6)),d=r(n(7)),y=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),a(e,null,[{key:"create",value:function(t){var n=s(e.__proto__||Object.getPrototypeOf(e),"create",this).call(this,t);return"string"==typeof t&&(window.katex.render(t,n,{throwOnError:!1,errorColor:"#f00"}),n.setAttribute("data-value",t)),n}},{key:"value",value:function(t){return t.getAttribute("data-value")}}]),e}(c.default);y.blotName="formula",y.className="ql-formula",y.tagName="SPAN";var v=function(t){function e(){o(this,e);var t=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(null==window.katex)throw new Error("Formula module requires KaTeX.");return t}return l(e,t),a(e,null,[{key:"register",value:function(){h.default.register(y,!0)}}]),e}(d.default);e.FormulaBlot=y,e.default=v},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.CodeToken=e.CodeBlock=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},c=r(n(0)),h=r(n(6)),d=r(n(7)),b=function(t){function e(){return o(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return l(e,t),a(e,[{key:"replaceWith",value:function(t){this.domNode.textContent=this.domNode.textContent,this.attach(),s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"replaceWith",this).call(this,t)}},{key:"highlight",value:function(t){var e=this.domNode.textContent;this.cachedText!==e&&((e.trim().length>0||null==this.cachedText)&&(this.domNode.innerHTML=t(e),this.domNode.normalize(),this.attach()),this.cachedText=e)}}]),e}(r(n(13)).default);b.className="ql-syntax";var g=new c.default.Attributor.Class("token","hljs",{scope:c.default.Scope.INLINE}),m=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));if("function"!=typeof r.options.highlight)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");var l=null;return r.quill.on(h.default.events.SCROLL_OPTIMIZE,(function(){clearTimeout(l),l=setTimeout((function(){r.highlight(),l=null}),r.options.interval)})),r.highlight(),r}return l(e,t),a(e,null,[{key:"register",value:function(){h.default.register(g,!0),h.default.register(b,!0)}}]),a(e,[{key:"highlight",value:function(){var t=this;if(!this.quill.selection.composing){this.quill.update(h.default.sources.USER);var e=this.quill.getSelection();this.quill.scroll.descendants(b).forEach((function(e){e.highlight(t.options.highlight)})),this.quill.update(h.default.sources.SILENT),null!=e&&this.quill.setSelection(e,h.default.sources.SILENT)}}}]),e}(d.default);m.DEFAULTS={highlight:null==window.hljs?null:function(t){return window.hljs.highlightAuto(t).value},interval:1e3},e.CodeBlock=b,e.CodeToken=g,e.default=m},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e,n){var r=document.createElement("button");r.setAttribute("type","button"),r.classList.add("ql-"+e),null!=n&&(r.value=n),t.appendChild(r)}function u(t,e){Array.isArray(e[0])||(e=[e]),e.forEach((function(e){var n=document.createElement("span");n.classList.add("ql-formats"),e.forEach((function(t){if("string"==typeof t)s(n,t);else{var e=Object.keys(t)[0],r=t[e];Array.isArray(r)?function c(t,e,n){var r=document.createElement("select");r.classList.add("ql-"+e),n.forEach((function(t){var e=document.createElement("option");!1!==t?e.setAttribute("value",t):e.setAttribute("selected","selected"),r.appendChild(e)})),t.appendChild(r)}(n,e,r):s(n,e,r)}})),t.appendChild(n)}))}Object.defineProperty(e,"__esModule",{value:!0}),e.addControls=e.default=void 0;var f=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),d=r(n(4)),v=r(n(0)),g=r(n(6)),_=r(n(10)),w=r(n(7)),x=(0,_.default)("quill:toolbar"),k=function(t){function e(t,n){!function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a,r=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));if(Array.isArray(r.options.container)){var o=document.createElement("div");u(o,r.options.container),t.container.parentNode.insertBefore(o,t.container),r.container=o}else"string"==typeof r.options.container?r.container=document.querySelector(r.options.container):r.container=r.options.container;return r.container instanceof HTMLElement?(r.container.classList.add("ql-toolbar"),r.controls=[],r.handlers={},Object.keys(r.options.handlers).forEach((function(t){r.addHandler(t,r.options.handlers[t])})),[].forEach.call(r.container.querySelectorAll("button, select"),(function(t){r.attach(t)})),r.quill.on(g.default.events.EDITOR_CHANGE,(function(t,e){t===g.default.events.SELECTION_CHANGE&&r.update(e)})),r.quill.on(g.default.events.SCROLL_OPTIMIZE,(function(){var t=r.quill.selection.getRange(),n=f(t,1)[0];r.update(n)})),r):(a=x.error("Container required for toolbar",r.options),l(r,a))}return function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),h(e,[{key:"addHandler",value:function(t,e){this.handlers[t]=e}},{key:"attach",value:function(t){var e=this,n=[].find.call(t.classList,(function(t){return 0===t.indexOf("ql-")}));if(n){if(n=n.slice("ql-".length),"BUTTON"===t.tagName&&t.setAttribute("type","button"),null==this.handlers[n]){if(null!=this.quill.scroll.whitelist&&null==this.quill.scroll.whitelist[n])return void x.warn("ignoring attaching to disabled format",n,t);if(null==v.default.query(n))return void x.warn("ignoring attaching to nonexistent format",n,t)}var r="SELECT"===t.tagName?"change":"click";t.addEventListener(r,(function(r){var i=void 0;if("SELECT"===t.tagName){if(t.selectedIndex<0)return;var l=t.options[t.selectedIndex];i=!l.hasAttribute("selected")&&(l.value||!1)}else i=!t.classList.contains("ql-active")&&(t.value||!t.hasAttribute("value")),r.preventDefault();e.quill.focus();var a=e.quill.selection.getRange(),u=f(a,1)[0];if(null!=e.handlers[n])e.handlers[n].call(e,i);else if(v.default.query(n).prototype instanceof v.default.Embed){if(!(i=prompt("Enter "+n)))return;e.quill.updateContents((new d.default).retain(u.index).delete(u.length).insert(function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}({},n,i)),g.default.sources.USER)}else e.quill.format(n,i,g.default.sources.USER);e.update(u)})),this.controls.push([n,t])}}},{key:"update",value:function(t){var e=null==t?{}:this.quill.getFormat(t);this.controls.forEach((function(n){var r=f(n,2),o=r[0],i=r[1];if("SELECT"===i.tagName){var l=void 0;if(null==t)l=null;else if(null==e[o])l=i.querySelector("option[selected]");else if(!Array.isArray(e[o])){var a=e[o];"string"==typeof a&&(a=a.replace(/\"/g,'\\"')),l=i.querySelector('option[value="'+a+'"]')}null==l?(i.value="",i.selectedIndex=-1):l.selected=!0}else if(null==t)i.classList.remove("ql-active");else if(i.hasAttribute("value")){var s=e[o]===i.getAttribute("value")||null!=e[o]&&e[o].toString()===i.getAttribute("value")||null==e[o]&&!i.getAttribute("value");i.classList.toggle("ql-active",s)}else i.classList.toggle("ql-active",null!=e[o])}))}}]),e}(w.default);k.DEFAULTS={},k.DEFAULTS={container:null,handlers:{clean:function(){var t=this,e=this.quill.getSelection();if(null!=e)if(0==e.length){var n=this.quill.getFormat();Object.keys(n).forEach((function(e){null!=v.default.query(e,v.default.Scope.INLINE)&&t.quill.format(e,!1)}))}else this.quill.removeFormat(e,g.default.sources.USER)},direction:function(t){var e=this.quill.getFormat().align;"rtl"===t&&null==e?this.quill.format("align","right",g.default.sources.USER):t||"right"!==e||this.quill.format("align",!1,g.default.sources.USER),this.quill.format("direction",t,g.default.sources.USER)},indent:function(t){var e=this.quill.getSelection(),n=this.quill.getFormat(e),r=parseInt(n.indent||0);if("+1"===t||"-1"===t){var o="+1"===t?1:-1;"rtl"===n.direction&&(o*=-1),this.quill.format("indent",r+o,g.default.sources.USER)}},link:function(t){!0===t&&(t=prompt("Enter link URL:")),this.quill.format("link",t,g.default.sources.USER)},list:function(t){var e=this.quill.getSelection(),n=this.quill.getFormat(e);"check"===t?"checked"===n.list||"unchecked"===n.list?this.quill.format("list",!1,g.default.sources.USER):this.quill.format("list","unchecked",g.default.sources.USER):this.quill.format("list",t,g.default.sources.USER)}}},e.default=k,e.addControls=u},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=13 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=9 y1=4 y2=4></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=14 x2=4 y1=14 y2=14></line> <line class=ql-stroke x1=12 x2=6 y1=4 y2=4></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=5 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=9 y1=4 y2=4></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=15 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=15 x2=3 y1=14 y2=14></line> <line class=ql-stroke x1=15 x2=3 y1=4 y2=4></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <g class="ql-fill ql-color-label"> <polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"></polygon> <rect height=1 width=1 x=4 y=4></rect> <polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"></polygon> <rect height=1 width=1 x=2 y=6></rect> <rect height=1 width=1 x=3 y=5></rect> <rect height=1 width=1 x=4 y=7></rect> <polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"></polygon> <rect height=1 width=1 x=2 y=12></rect> <rect height=1 width=1 x=2 y=9></rect> <rect height=1 width=1 x=2 y=15></rect> <polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"></polygon> <rect height=1 width=1 x=3 y=8></rect> <path d=M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z></path> <path d=M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z></path> <path d=M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z></path> <rect height=1 width=1 x=12 y=2></rect> <rect height=1 width=1 x=11 y=3></rect> <path d=M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z></path> <rect height=1 width=1 x=2 y=3></rect> <rect height=1 width=1 x=6 y=2></rect> <rect height=1 width=1 x=3 y=2></rect> <rect height=1 width=1 x=5 y=3></rect> <rect height=1 width=1 x=9 y=2></rect> <rect height=1 width=1 x=15 y=14></rect> <polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"></polygon> <rect height=1 width=1 x=13 y=7></rect> <rect height=1 width=1 x=15 y=5></rect> <rect height=1 width=1 x=14 y=6></rect> <rect height=1 width=1 x=15 y=8></rect> <rect height=1 width=1 x=14 y=9></rect> <path d=M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z></path> <rect height=1 width=1 x=14 y=3></rect> <polygon points="12 6.868 12 6 11.62 6 12 6.868"></polygon> <rect height=1 width=1 x=15 y=2></rect> <rect height=1 width=1 x=12 y=5></rect> <rect height=1 width=1 x=13 y=4></rect> <polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"></polygon> <rect height=1 width=1 x=9 y=14></rect> <rect height=1 width=1 x=8 y=15></rect> <path d=M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z></path> <rect height=1 width=1 x=5 y=15></rect> <path d=M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z></path> <rect height=1 width=1 x=11 y=15></rect> <path d=M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z></path> <rect height=1 width=1 x=14 y=15></rect> <rect height=1 width=1 x=15 y=11></rect> </g> <polyline class=ql-stroke points="5.5 13 9 5 12.5 13"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=11 y2=11></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <rect class="ql-fill ql-stroke" height=3 width=3 x=4 y=5></rect> <rect class="ql-fill ql-stroke" height=3 width=3 x=11 y=5></rect> <path class="ql-even ql-fill ql-stroke" d=M7,8c0,4.031-3,5-3,5></path> <path class="ql-even ql-fill ql-stroke" d=M14,8c0,4.031-3,5-3,5></path> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z></path> <path class=ql-stroke d=M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z></path> </svg>'},function(t,e){t.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=5 x2=13 y1=3 y2=3></line> <line class=ql-stroke x1=6 x2=9.35 y1=12 y2=3></line> <line class=ql-stroke x1=11 x2=15 y1=11 y2=15></line> <line class=ql-stroke x1=15 x2=11 y1=11 y2=15></line> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=7 x=2 y=14></rect> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class="ql-color-label ql-stroke ql-transparent" x1=3 x2=15 y1=15 y2=15></line> <polyline class=ql-stroke points="5.5 11 9 3 12.5 11"></polyline> <line class=ql-stroke x1=11.63 x2=6.38 y1=9 y2=9></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"></polygon> <line class="ql-stroke ql-fill" x1=15 x2=11 y1=4 y2=4></line> <path class=ql-fill d=M11,3a3,3,0,0,0,0,6h1V3H11Z></path> <rect class=ql-fill height=11 width=1 x=11 y=4></rect> <rect class=ql-fill height=11 width=1 x=13 y=4></rect> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"></polygon> <line class="ql-stroke ql-fill" x1=9 x2=5 y1=4 y2=4></line> <path class=ql-fill d=M5,3A3,3,0,0,0,5,9H6V3H5Z></path> <rect class=ql-fill height=11 width=1 x=5 y=4></rect> <rect class=ql-fill height=11 width=1 x=7 y=4></rect> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M14,16H4a1,1,0,0,1,0-2H14A1,1,0,0,1,14,16Z /> <path class=ql-fill d=M14,4H4A1,1,0,0,1,4,2H14A1,1,0,0,1,14,4Z /> <rect class=ql-fill x=3 y=6 width=12 height=6 rx=1 ry=1 /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M13,16H5a1,1,0,0,1,0-2h8A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H5A1,1,0,0,1,5,2h8A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=2 y=6 width=14 height=6 rx=1 ry=1 /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15,8H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,8Z /> <path class=ql-fill d=M15,12H13a1,1,0,0,1,0-2h2A1,1,0,0,1,15,12Z /> <path class=ql-fill d=M15,16H5a1,1,0,0,1,0-2H15A1,1,0,0,1,15,16Z /> <path class=ql-fill d=M15,4H5A1,1,0,0,1,5,2H15A1,1,0,0,1,15,4Z /> <rect class=ql-fill x=2 y=6 width=8 height=6 rx=1 ry=1 /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M5,8H3A1,1,0,0,1,3,6H5A1,1,0,0,1,5,8Z /> <path class=ql-fill d=M5,12H3a1,1,0,0,1,0-2H5A1,1,0,0,1,5,12Z /> <path class=ql-fill d=M13,16H3a1,1,0,0,1,0-2H13A1,1,0,0,1,13,16Z /> <path class=ql-fill d=M13,4H3A1,1,0,0,1,3,2H13A1,1,0,0,1,13,4Z /> <rect class=ql-fill x=8 y=6 width=8 height=6 rx=1 ry=1 transform="translate(24 18) rotate(-180)"/> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z></path> <rect class=ql-fill height=1.6 rx=0.8 ry=0.8 width=5 x=5.15 y=6.2></rect> <path class=ql-fill d=M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z></path> </svg>'},function(t,e){t.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z /> </svg>'},function(t,e){t.exports='<svg viewBox="0 0 18 18"> <path class=ql-fill d=M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=13 y1=4 y2=4></line> <line class=ql-stroke x1=5 x2=11 y1=14 y2=14></line> <line class=ql-stroke x1=8 x2=10 y1=14 y2=4></line> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=10 width=12 x=3 y=4></rect> <circle class=ql-fill cx=6 cy=7 r=1></circle> <polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"></polyline> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"></polyline> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=3 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="5 7 5 11 3 9 5 7"></polyline> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=11 y1=7 y2=11></line> <path class="ql-even ql-stroke" d=M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z></path> <path class="ql-even ql-stroke" d=M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z></path> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=7 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=7 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=7 x2=15 y1=14 y2=14></line> <line class="ql-stroke ql-thin" x1=2.5 x2=4.5 y1=5.5 y2=5.5></line> <path class=ql-fill d=M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z></path> <path class="ql-stroke ql-thin" d=M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156></path> <path class="ql-stroke ql-thin" d=M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109></path> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class=ql-stroke x1=6 x2=15 y1=4 y2=4></line> <line class=ql-stroke x1=6 x2=15 y1=9 y2=9></line> <line class=ql-stroke x1=6 x2=15 y1=14 y2=14></line> <line class=ql-stroke x1=3 x2=3 y1=4 y2=4></line> <line class=ql-stroke x1=3 x2=3 y1=9 y2=9></line> <line class=ql-stroke x1=3 x2=3 y1=14 y2=14></line> </svg>'},function(t,e){t.exports='<svg class="" viewbox="0 0 18 18"> <line class=ql-stroke x1=9 x2=15 y1=4 y2=4></line> <polyline class=ql-stroke points="3 4 4 5 6 3"></polyline> <line class=ql-stroke x1=9 x2=15 y1=14 y2=14></line> <polyline class=ql-stroke points="3 14 4 15 6 13"></polyline> <line class=ql-stroke x1=9 x2=15 y1=9 y2=9></line> <polyline class=ql-stroke points="3 9 4 10 6 8"></polyline> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z /> <path class=ql-fill d=M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-fill d=M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z /> <path class=ql-fill d=M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z /> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <line class="ql-stroke ql-thin" x1=15.5 x2=2.5 y1=8.5 y2=9.5></line> <path class=ql-fill d=M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z></path> <path class=ql-fill d=M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z></path> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <path class=ql-stroke d=M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3></path> <rect class=ql-fill height=1 rx=0.5 ry=0.5 width=12 x=3 y=15></rect> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <rect class=ql-stroke height=12 width=12 x=3 y=3></rect> <rect class=ql-fill height=12 width=1 x=5 y=3></rect> <rect class=ql-fill height=12 width=1 x=12 y=3></rect> <rect class=ql-fill height=2 width=8 x=5 y=8></rect> <rect class=ql-fill height=1 width=3 x=3 y=5></rect> <rect class=ql-fill height=1 width=3 x=3 y=7></rect> <rect class=ql-fill height=1 width=3 x=3 y=10></rect> <rect class=ql-fill height=1 width=3 x=3 y=12></rect> <rect class=ql-fill height=1 width=3 x=12 y=5></rect> <rect class=ql-fill height=1 width=3 x=12 y=7></rect> <rect class=ql-fill height=1 width=3 x=12 y=10></rect> <rect class=ql-fill height=1 width=3 x=12 y=12></rect> </svg>'},function(t,e){t.exports='<svg viewbox="0 0 18 18"> <polygon class=ql-stroke points="7 11 9 13 11 11 7 11"></polygon> <polygon class=ql-stroke points="7 7 9 5 11 7 7 7"></polygon> </svg>'},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=e.BubbleTooltip=void 0;var a=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=r(n(2)),h=r(n(9)),p=n(44),d=r(p),y=n(22),b=r(n(26)),g=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]],m=function(t){function e(t,n){o(this,e),null!=n.modules.toolbar&&null==n.modules.toolbar.container&&(n.modules.toolbar.container=g);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.quill.container.classList.add("ql-bubble"),r}return l(e,t),s(e,[{key:"extendToolbar",value:function(t){this.tooltip=new _(this.quill,this.options.bounds),this.tooltip.root.appendChild(t.container),this.buildButtons([].slice.call(t.container.querySelectorAll("button")),b.default),this.buildPickers([].slice.call(t.container.querySelectorAll("select")),b.default)}}]),e}(d.default);m.DEFAULTS=(0,c.default)(!0,{},d.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(t){t?this.quill.theme.tooltip.edit():this.quill.format("link",!1)}}}}});var _=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.quill.on(h.default.events.EDITOR_CHANGE,(function(t,e,n,o){if(t===h.default.events.SELECTION_CHANGE)if(null!=e&&e.length>0&&o===h.default.sources.USER){r.show(),r.root.style.left="0px",r.root.style.width="",r.root.style.width=r.root.offsetWidth+"px";var i=r.quill.getLines(e.index,e.length);if(1===i.length)r.position(r.quill.getBounds(e));else{var l=i[i.length-1],a=r.quill.getIndex(l),s=Math.min(l.length()-1,e.index+e.length-a),u=r.quill.getBounds(new y.Range(a,s));r.position(u)}}else document.activeElement!==r.textbox&&r.quill.hasFocus()&&r.hide()})),r}return l(e,t),s(e,[{key:"listen",value:function(){var t=this;a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"listen",this).call(this),this.root.querySelector(".ql-close").addEventListener("click",(function(){t.root.classList.remove("ql-editing")})),this.quill.on(h.default.events.SCROLL_OPTIMIZE,(function(){setTimeout((function(){if(!t.root.classList.contains("ql-hidden")){var e=t.quill.getSelection();null!=e&&t.position(t.quill.getBounds(e))}}),1)}))}},{key:"cancel",value:function(){this.show()}},{key:"position",value:function(t){var n=a(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"position",this).call(this,t),r=this.root.querySelector(".ql-tooltip-arrow");if(r.style.marginLeft="",0===n)return n;r.style.marginLeft=-1*n-r.offsetWidth/2+"px"}}]),e}(p.BaseTooltip);_.TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join(""),e.BubbleTooltip=_,e.default=m},function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var l,a=t[Symbol.iterator]();!(r=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var l=o.get;return void 0!==l?l.call(r):void 0},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=r(n(2)),p=r(n(9)),d=n(44),y=r(d),b=r(n(15)),g=n(22),_=r(n(26)),O=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]],w=function(t){function e(t,n){o(this,e),null!=n.modules.toolbar&&null==n.modules.toolbar.container&&(n.modules.toolbar.container=O);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.quill.container.classList.add("ql-snow"),r}return l(e,t),u(e,[{key:"extendToolbar",value:function(t){t.container.classList.add("ql-snow"),this.buildButtons([].slice.call(t.container.querySelectorAll("button")),_.default),this.buildPickers([].slice.call(t.container.querySelectorAll("select")),_.default),this.tooltip=new x(this.quill,this.options.bounds),t.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"K",shortKey:!0},(function(e,n){t.handlers.link.call(t,!n.format.link)}))}}]),e}(y.default);w.DEFAULTS=(0,f.default)(!0,{},y.default.DEFAULTS,{modules:{toolbar:{handlers:{link:function(t){if(t){var e=this.quill.getSelection();if(null==e||0==e.length)return;var n=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(n)&&0!==n.indexOf("mailto:")&&(n="mailto:"+n),this.quill.theme.tooltip.edit("link",n)}else this.quill.format("link",!1)}}}}});var x=function(t){function e(t,n){o(this,e);var r=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));return r.preview=r.root.querySelector("a.ql-preview"),r}return l(e,t),u(e,[{key:"listen",value:function(){var t=this;s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"listen",this).call(this),this.root.querySelector("a.ql-action").addEventListener("click",(function(e){t.root.classList.contains("ql-editing")?t.save():t.edit("link",t.preview.textContent),e.preventDefault()})),this.root.querySelector("a.ql-remove").addEventListener("click",(function(e){if(null!=t.linkRange){var n=t.linkRange;t.restoreFocus(),t.quill.formatText(n,"link",!1,p.default.sources.USER),delete t.linkRange}e.preventDefault(),t.hide()})),this.quill.on(p.default.events.SELECTION_CHANGE,(function(e,n,r){if(null!=e){if(0===e.length&&r===p.default.sources.USER){var o=t.quill.scroll.descendant(b.default,e.index),i=a(o,2),l=i[0],s=i[1];if(null!=l){t.linkRange=new g.Range(e.index-s,l.length());var u=b.default.formats(l.domNode);return t.preview.textContent=u,t.preview.setAttribute("href",u),t.show(),void t.position(t.quill.getBounds(t.linkRange))}}else delete t.linkRange;t.hide()}}))}},{key:"show",value:function(){s(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"show",this).call(this),this.root.removeAttribute("data-mode")}}]),e}(d.BaseTooltip);x.TEMPLATE=['<a class="ql-preview" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join(""),e.default=w}]).default})),Class((function SceneLayout(_name,_options={}){Inherit(this,Object3D);const _this=this;var _dataStore,_data,_timeline,_breakpoint,_gizmo;const ZERO=new Vector3;var _initializers=[],_promises=[],_breakpoints=[],_folders={},_groups={},_custom={},_meshes={},_exists={},_layers={},_uil=UIL.sidebar,_graph,_config,_groupIndex=0,_groupsSynced=Promise.create();function initialize(promise){_promises.push(promise)}function initGizmo(){Utils.query("nogizmo")||(_gizmo=_this.initClass(SceneLayoutGizmo))}function createFolder(name){let folder=new UILFolder(`sl_${_name}_${name}`,{label:name,closed:!0});return folder.hide(),_folders[`sl_${_name}_${name}`]=folder,folder}async function initConfig(){let input=InputUIL.create(`CONFIG_sl_${_name}`,_uil);input.add("Animation"),input.add("Layout"),input.add("Cinema Config"),_graph&&_graph.addSpecial("Config",`Config (${_name})`,"Config"),input.setLabel("Config");let animation=input.get("Animation"),layout=input.get("Layout");animation&&(await ready(),_groupsSynced.then((async()=>{if(animation=animation.replace(/^\//g,""),_this.animation=_this.initClass(HierarchyAnimation,animation,linkObjects),_timeline)_this.startRender((_=>{_this.animation.elapsed=_timeline.elapsed,_this.animation.update()}));else if(_uil){let range=new UILControlRange("Animation",{min:0,max:1,step:.001});range.onChange((val=>{_this.animation.elapsed=val,_this.animation.update()})),_uil.add(range)}await _this.animation.ready(),_this.animation.update()}))),layout&&(await ready(),_this.layout=_this.initClass(HierarchyLayout,layout,linkObjects),await _this.layout.ready()),_config=input,await defer(),_this.configured=!0}async function linkObjects(data){let array=[];for(let i=0;i<data.length;i++){let name=data[i].name,exists=_this.exists(name);exists||"null"==name.toLowerCase()||console.warn(`linkAnimation :: ${name} does not exist`);let group=new Group,mesh=exists?await _this.getLayer(name):null;mesh&&(_this.layout&&mesh instanceof Mesh?(mesh._parent.add(group),group.add(mesh)):group=mesh.group||mesh),group.name=name,array.push(group)}return array}async function initGraph(){if(_options.noGraph||!window.UILGraph||SceneLayout.noGraph)return _uil=null,void _groupsSynced.resolve();(_graph=UILGraph.instance().getGraph(_name,_this))?(UIL.sidebar.element.show(),await _this.ready(),_graph.syncVisibility(_layers),_graph.syncGroupNames(_groups,_folders),_groupsSynced.resolve(),Global.PLAYGROUND&&Utils.getConstructorName(_this.parent)==Global.PLAYGROUND&&_graph.open()):_groupsSynced.resolve()}function initParams(){if(_options.rootPath?"/"!=_options.rootPath.charAt(_options.rootPath.length-1)&&(_options.rootPath+="/"):_options.rootPath="",_this.timeline=_timeline=_options.timeline,_timeline&&(_timeline.add({v:0},{v:1},100,"linear"),_uil)){let range=new UILControlRange("Timeline",{min:0,max:1,step:.001});range.onChange((val=>{_timeline.elapsed=val,_timeline.update()})),_uil.add(range),range.hide(),_graph&&_graph.addSpecial("Timeline","Timeline")}_this.baseRenderOrder=_options.baseRenderOrder||0,_this.data=_options.data,_breakpoint=_options.breakpoint||SceneLayout.breakpoint,_options.breakpoint&&(_this.localBreakpoint=!0),_options.uil&&(_uil=_options.uil)}async function initData(){if(await UILStorage.ready(),_dataStore=InputUIL.create(`scenelayout_${_name}`,null),void 0===(_data=JSON.parse(_dataStore.get("data")||"{}")).layers&&(_data.layers=-1),_options.perFrame)_data.layers>0?createLayers():_this.loaded=!0;else{for(let i=0,c=_data.layers+1;i<c;i++)initialize(createLayer(i));_this.loaded=!0}}function createLayers(){let index=0,renderWorker=new Render.Worker((function(){initialize(createLayer(index)),index++==_data.layers&&(renderWorker.stop(),_this.loaded=!0)}),_options.perFrame)}function getGroup(name){if(!name)return _this.group;if(name==_name)return _this.group;if(!_groups[name]){let uilGroup=_uil?createFolder(name):null;uilGroup&&(uilGroup.setLabel(`${name} (Group)`),_uil.add(uilGroup),_graph&&_graph.addGroup(uilGroup.id,name));let config=InputUIL.create(`GROUP_${_name}_${name}`,uilGroup);config.setLabel("Parameters"),_timeline&&config.add("tween"),config.addToggle("billboard"),config.add("breakpoints"),config.add("name","hidden");let breakpoints=config.get("breakpoints");breakpoints&&(breakpoints=breakpoints.replace(/ /g,"").split(","));let breakpoint=breakpoints&&_breakpoint?"-"+_breakpoint:"";"-"==breakpoint.charAt(breakpoint.length-1)&&(breakpoint="");let group=new Group;_groups[name]=group,_layers[name]=group,_exists[name]="group",group.prefix=`${name}_${_name}${breakpoint}`;let meshUIL=MeshUIL.add(group,uilGroup);meshUIL.setLabel("Mesh"),_this.add(group),UIL.global&&(group._meshUIL=meshUIL),uilGroup&&(uilGroup.params=config),breakpoints&&_breakpoints.push(group),config.get("billboard")&&updateBillboard(!0,mesh)}return _groupIndex++,_groups[name]}async function createLayer(index,groupName){let id="number"==typeof index?index:++_data.layers,graphGroupName=groupName;if(graphGroupName){let nameLabel=UILStorage.get(`INPUT_GROUP_${_name}_${groupName}_name`);nameLabel&&(groupName=nameLabel)}if(UILStorage.get(`sl_${_name}_${id}_deleted`))return;if(_this.preventLayerCreation&&_this.preventLayerCreation(UILStorage.get(`INPUT_Config_${id}_${_name}_name`)))return;let group=_uil?createFolder(id):null,shader,mesh,input=InputUIL.create(`Config_${id}_${_name}`,group);input.setLabel("Parameters"),input.add("name","hidden").addFile("geometry",{relative:"assets/geometry"}).addToggle("visible",!0).addToggle("transparent").addToggle("depthWrite",!0).addToggle("depthTest",!0).addToggle("castShadow").addToggle("receiveShadow").addToggle("receiveLight").addToggle("billboard").add("shader").add("customClass").add("scriptClass").add("wildcard").add("renderOrder","hidden").add("group","hidden").add("breakpoints").addSelect("side",[{label:"Front Side",value:"shader_front_side"},{label:"Back Side",value:"shader_back_side"},{label:"Double Side",value:"shader_double_side"},{label:"Double Side Transparent",value:"shader_double_side_trasparency"}]).addSelect("blending",[{label:"Normal",value:"shader_normal_blending"},{label:"Additive",value:"shader_additive_blending"},{label:"Premultiplied Alpha",value:"shader_premultiplied_alpha_blending"}]),input.name=_name,input.prefix=`Element_${id}_${_name}`,input.id=id,group&&(group.params=input),_timeline&&input.addToggle("tween"),_options.physics&&(input.addToggle("physics"),input.add("physicsCode"));let name=input.get("name")||id,shaderName=input.get("shader")||"SceneLayout",geomPath=input.getFilePath("geometry"),visible=input.get("visible"),transparent=input.get("transparent"),depthWrite=input.get("depthWrite"),depthTest=input.get("depthTest"),billboard=input.get("billboard"),doTween=input.get("tween"),renderOrder=input.getNumber("renderOrder"),blending=input.get("blending"),side=input.get("side"),physics=input.get("physics"),castShadow=input.get("castShadow"),receiveShadow=input.get("receiveShadow"),receiveLight=input.get("receiveLight"),breakpoints=input.get("breakpoints");breakpoints&&(breakpoints=breakpoints.replace(/ /g,"").split(","));let breakpoint=breakpoints&&_breakpoint?"-"+_breakpoint:"";"-"==breakpoint.charAt(breakpoint.length-1)&&(breakpoint=""),name&&group&&group.setLabel(name),groupName&&input.setValue("group",groupName);let groupParent=getGroup(input.get("group"));if(group){let groupName=input.get("group"),groupId=groupName?`sl_${_name}_${graphGroupName||groupName}`:void 0;_graph&&_graph.addLayer(group.id,name||id+"",groupId)}if(_uil&&_uil.add(group),"ignore"==name)return;let customClass=input.get("customClass"),scriptClass=input.get("scriptClass"),customCompile;if(shaderName.includes("|")&&([shaderName,customCompile]=shaderName.split("|")),_exists[name]=customClass?"custom":"mesh",customClass){if(customClass===_this.parent.constructor.name)return console.warn(`Tried to recursively initialize ${customClass}`);if(!window[customClass])return console.warn(`Tried to initialize ${customClass} but it doesn't  exist!`);let obj=_this.initClass(window[customClass],input,group,id,null);if(mesh=obj.group,obj.wildcard=input.get("wildcard"),"boolean"==typeof visible&&mesh&&(mesh.visible=visible),_custom[name]=obj,_layers[name]=obj,_this.onCreateLayer){let capture=cb=>(_this.delayedCall((_=>cb(obj,name)),32),!0);if(!0===_this.onCreateLayer(name,group,capture))return}if(obj.group&&groupParent.add(obj.group),obj.renderOrder=_this.baseRenderOrder+renderOrder,mesh){if(!obj.camera){mesh.prefix=`Element_${id}_${_name}${breakpoint}`;let meshUIL=MeshUIL.add(mesh,group);meshUIL.setLabel("Mesh"),UIL.global&&(mesh._meshUIL=meshUIL)}_breakpoints.push(mesh),scriptClass&&!1!==visible&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(","),scriptClass.forEach((script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,shader,group,input))):console.warn(`scriptClass ${script} not found`)}))):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,shader,group,input):console.warn(`scriptClass ${scriptClass} not found`))}return}if(_this.onCreateLayer){let capture=cb=>{let mesh=new Group;return mesh.prefix=`Element_${id}_${_name}${breakpoint}`,MeshUIL.add(mesh,group),_meshes[name]=mesh,_layers[name]=mesh,_this.delayedCall((_=>cb(mesh,name)),32),!0};if(!0===_this.onCreateLayer(name,group,capture))return}let geom=World.PLANE;if(geomPath&&geomPath.includes(["World","SceneLayout"])&&(geom=eval(geomPath),geomPath=null),shaderName.includes(".shader")){let shaderLayer=shaderName.split(".shader")[0],layer=await _this.getLayer(shaderLayer);shader=layer.shader,shader._copied=layer}else if(shaderName.includes("PBR"))shader=_this.initClass(PBRShader,shaderName,{unique:`Element_${id}_${_name}`});else{let texturePath=input.getImage("texture");texturePath?texturePath.includes("assets/images")||(texturePath=_options.rootPath+texturePath):texturePath="assets/images/_scenelayout/uv.jpg",shader=_this.initClass(Shader,shaderName,{unique:`Element_${id}_${_name}`,customCompile:customCompile}),"SceneLayout"!=shaderName&&window[shaderName]||shader.addUniforms({tMap:{value:Utils3D.getTexture(texturePath)},uAlpha:{value:1}}),defer((_=>{for(let key in shader.uniforms){let uniform=shader.uniforms[key];uniform.value instanceof Texture&&initialize(uniform.value.promise)}}))}"boolean"==typeof depthWrite&&(shader.depthWrite=depthWrite),"boolean"==typeof depthTest&&(shader.depthTest=depthTest),"boolean"==typeof transparent&&(shader.transparent=transparent),_this.onCreateGeometry&&(geomPath=_this.onCreateGeometry(geomPath,input.get("wildcard"))),geomPath&&(geom=await GeomThread.loadGeometry(geomPath)),mesh=new Mesh(geom,shader),"boolean"==typeof _options.frustumCulled&&(mesh.frustumCulled=_options.frustumCulled),"boolean"==typeof visible&&(mesh.visible=visible),groupParent.add(mesh),mesh.prefix=`Element_${id}_${_name}${breakpoint}`,mesh.uilName=name,mesh.wildcard=input.get("wildcard");let meshUIL=MeshUIL.add(mesh,group);if(meshUIL.setLabel("Mesh"),UIL.global&&(mesh._meshUIL=meshUIL),physics){let obj=Physics.instance().create(mesh);obj.prefix=`Physics_${id}_${_name}`,PhysicsUIL.add(obj,group).setLabel("Physics");let code=input.get("physicsCode");code&&_this.initClass(window[code],obj,mesh,group,input)}if(_meshes[name]=mesh,_layers[name]=mesh,breakpoints&&_breakpoints.push(mesh),mesh.renderOrder=_this.baseRenderOrder+(renderOrder||0),billboard&&updateBillboard(!0,mesh),"SceneLayout"!=shaderName&&window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),shader._copied||shader!==mesh.shader&&!shaderName.includes("PBR")||ShaderUIL.add(shader,group).setLabel("Shader"),shader._copied&&shader._copied.shaderClass&&shader._copied.shaderClass.applyClone&&shader._copied.shaderClass.applyClone(mesh),"number"!=typeof index&&_dataStore.setValue("data",JSON.stringify(_data)),blending&&(shader.blending=blending),side&&(shader.side=side),castShadow&&(mesh.castShadow=castShadow),receiveShadow&&(shader.receiveShadow=receiveShadow),receiveLight&&(shader.receiveLight=receiveLight),scriptClass&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(","),scriptClass.forEach((script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,shader,group,input))):console.warn(`scriptClass ${script} not found`)}))):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,shader,group,input):console.warn(`scriptClass ${scriptClass} not found`)),input.onUpdate=key=>{switch(key){case"name":group.setLabel(input.get(key));break;case"visible":mesh.visible=input.get(key);break;case"renderOrder":mesh.renderOrder=_this.baseRenderOrder+input.getNumber(key);break;case"transparent":shader.transparent=input.get(key);break;case"depthWrite":shader.depthWrite=input.get(key);break;case"depthTest":shader.depthTest=input.get(key);break;case"side":shader.side=input.get(key);break;case"blending":shader.blending=input.get(key);break;case"geometry":updateGeometry(input.getFilePath(key),mesh);break;case"shader":updateShader(input.get(key),mesh,id,group,input);break;case"scriptClass":updateScriptClass(input.get(key),mesh,group,input);break;case"receiveShadow":updateShadow(input.get(key),mesh);break;case"receiveLight":updateLighting(input.get(key),mesh);break;case"billboard":updateBillboard(input.get(key),mesh)}},Hydra.LOCAL&&Global.PLAYGROUND){_this.events.sub(SceneLayout.HOTLOAD_GEOMETRY,(({file:file})=>{mesh.geometry?._src?.includes(file)&&updateGeometry(file,mesh)}));const scriptClassNeedsUpdate=(inst,file)=>(inst.__cacheName||(inst.__cacheName=Utils.getConstructorName(inst)),!!file.includes(inst.__cacheName)&&inst.__cacheName);_this.events.sub(SceneLayout.HOTLOAD_SCRIPT,(({file:file})=>{if(file.includes(mesh.shader?.vsName)&&(shader.hotReloading=!0,window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),group.remove(shader.UILPrefix),delete ShaderUIL.exists[shader.UILPrefix],ShaderUIL.add(shader,group).setLabel("Shader"),shader.hotReloading=!1),mesh.scriptClass)if(Array.isArray(mesh.scriptClass))mesh.scriptClass.every(((inst,index)=>{let name=scriptClassNeedsUpdate(inst,file);return!name||(mesh.scriptClass.remove(inst),updateScriptClass(name,mesh,group,input),!1)}));else{let name=scriptClassNeedsUpdate(mesh.scriptClass,file);name&&updateScriptClass(name,mesh,group,input)}}))}}async function updateGeometry(geomPath,mesh){let geom=World.PLANE;geomPath&&geomPath.includes(["World","SceneLayout"])?(geom=eval(geomPath),geomPath=null):geomPath&&(geom=await GeomThread.loadGeometry(geomPath+"?"+Utils.timestamp())),mesh.geometry=geom}async function updateShader(shaderName,mesh,id,group,input){let shader;if(shaderName.includes(".shader")){let shaderLayer=shaderName.split(".shader")[0],layer=await _this.getLayer(shaderLayer);shader=layer.shader,shader._copied=layer}else shader=shaderName.includes("PBR")?_this.initClass(PBRShader,shaderName,{unique:`Element_${id}_${_name}`}):_this.initClass(Shader,shaderName,{unique:`Element_${id}_${_name}`});group.remove(mesh.shader.UILPrefix),mesh.shader=shader,window[shaderName]&&(mesh.shaderClass=_this.initClass(window[shaderName],mesh,shader,group,input)),ShaderUIL.add(shader,group).setLabel("Shader")}function updateLighting(bool,mesh){mesh.shader.customCompile=Utils.uuid(),mesh.shader.receiveLight=bool,mesh.shader.resetProgram(),mesh.shader.upload()}function updateShadow(bool,mesh){mesh.shader.customCompile=Utils.uuid(),mesh.shader.receiveShadow=bool,mesh.shader.resetProgram(),mesh.shader.upload()}function updateBillboard(bool,mesh){bool?(mesh._billboardLoop=_=>Utils3D.billboard(mesh),_this.startRender(mesh._billboardLoop)):(mesh.rotation.set(0,0,0),_this.stopRender(mesh._billboardLoop))}function updateScriptClass(scriptClass,mesh,group,input){scriptClass&&(scriptClass.includes(",")?(scriptClass=scriptClass.replace(/ /g,"").split(",")).forEach((script=>{window[script]?(mesh.scriptClass=mesh.scriptClass||[],mesh.scriptClass.push(_this.initClass(window[script],mesh,mesh.shader,group,input))):console.warn(`scriptClass ${script} not found`)})):window[scriptClass]?mesh.scriptClass=_this.initClass(window[scriptClass],mesh,mesh.shader,group,input):console.warn(`scriptClass ${scriptClass} not found`))}function addListeners(){_this.events.sub(SceneLayout.BREAKPOINT,(e=>_this.localBreakpoint?null:setBreakpoint(e)))}function setBreakpoint({value:value}){value!=_breakpoint&&(_breakpoint=value,_breakpoints.forEach((mesh=>{if(!mesh.prefix)return;mesh.prefix=mesh.prefix.split("-")[0]+"-"+_breakpoint,"-"==mesh.prefix.charAt(mesh.prefix.length-1)&&(mesh.prefix=mesh.prefix.slice(0,-1));let meshUIL=new MeshUILConfig(mesh);UIL.global&&(mesh._meshUIL=meshUIL)})))}async function ready(){await _this.wait(_this,"loaded"),UIL.sidebar&&UIL.sidebar.toolbar.hideAll()}function copyFolderProps(from,to){let mesh,params,shader;to.forEachFolder((child=>{switch(child.label){case"Parameters":params=child;break;case"Mesh":mesh=child;break;case"Shader":shader=child}}));let allowed=["Parameters","Mesh","Shader"];from.forEachFolder((child=>{if(!(allowed.indexOf(child.label)<0))switch(child.toClipboard(),child.label){case"Parameters":params.fromClipboard();break;case"Mesh":mesh.fromClipboard();break;case"Shader":shader.fromClipboard()}}))}this.isSceneLayout=!0,this.name=_name,async function(){_this.group.sceneLayout=_this,await initialize(defer()),SceneLayout.getTexture||(SceneLayout.getTexture=Utils3D.getTexture),initGraph(),initParams(),initialize(initConfig()),initData(),addListeners(),ready(),UIL.global&&initGizmo()}(),this.ready=async function(early){if(await _this.wait(_this,"loaded"),await _this.wait(_this,"configured"),early)return!0;await defer(),await defer()},this.getLayer=async function(name){let timer;return Hydra.LOCAL&&(timer=_this.delayedCall((_=>{_exists[name]||console.warn(`${name} doesn't exist in SceneLayout ${_name}`)}),1e3)),await _this.wait(_layers,name),timer&&clearTimeout(timer),_layers[name]},this.getLayers=async function(){let array=[];for(let i=0;i<arguments.length;i++)array.push(_this.getLayer(arguments[i]));return Promise.all(array)},this.getAllLayers=async function(){return await this.ready(),await this.loadedAllLayers(),_layers},this.getAllMatching=async function(label){let layers=await _this.getAllLayers(),array=[];for(let key in layers)key.includes(label)&&(layers[key].layerName=key,array.push(layers[key]));return array},this.exists=function(name){return _exists[name]},this._createLayer=function(parentId){createLayer(null,parentId)},this._createGroup=function(parentId){getGroup(`group_${_groupIndex}`,parentId)},this._rename=function(id,name,value){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];folder&&(folder.setLabel(value),folder.params&&folder.params.setValue("name",value),[_groups,_custom,_meshes,_exists,_layers].forEach((function(store){store[name]&&(store[value]=store[name],store[name]=null,delete store[name])})))},this._deleteLayer=function(id,name){id.includes("_")&&(id=(id=id.split("_"))[id.length-1]);let folder=_folders[id]||_folders[`sl_${_name}_${id}`],layer=_layers[id]||_layers[name];return layer&&layer.isGroup&&layer.length>1?(alert("Can't delete a group that has nested layers."),!1):!!confirm("Are you sure you want to delete this layer?")&&(layer&&layer._parent&&(layer._parent.remove(layer),layer._parent=null),folder&&folder.parent&&folder.parent.remove(folder),UILStorage.set(`sl_${_name}_${id}_deleted`,!0),!0)},this._changeParent=function(childId,childName,parentId,parentName){let child=_layers[childId]||_layers[childName],parent=_layers[parentId]||_layers[parentName]||_this;if(!child)return;let folder=_folders[childId]||_folders[`sl_${_name}_${childName}`];folder&&folder.params&&folder.params.setValue("group",parentName||null);let parentObject=parent.group||parent,childObject=child.group||child;parentObject.isObject3D&&childObject.isObject3D&&parentObject.add(childObject),child.updateMatrix&&child.updateMatrix()},this._visible=function(name,visible){let mesh=_layers[name];mesh&&(mesh.group&&(mesh=mesh.group),mesh.visible=visible)},this._focus=function(name){UIL.sidebar.toolbar.filterSingle(name)},this._blur=function(name){let folder=_folders[name]||_folders[`sl_${_name}_${name}`];folder&&folder.forEachFolder&&(folder.forEachFolder((f=>f.close())),folder.close())},this._sort=function(order){order.forEach(((label,index)=>{label.children&&label.children.forEach((function(child,j,all){let folder=_folders[child];if(!folder||!folder.params)return;let renderOrder=_this.baseRenderOrder+index+(j+1)/(all.length+1);folder.params.setValue("renderOrder",renderOrder-_this.baseRenderOrder);let mesh=_layers[child]||_layers[folder.label];mesh&&(mesh.renderOrder=renderOrder)}));let folder=_folders[label];if(!folder||!folder.params)return;let renderOrder=_this.baseRenderOrder+index;folder.params.setValue("renderOrder",renderOrder-_this.baseRenderOrder);let mesh=_layers[label]||_layers[folder.label];mesh&&(mesh.renderOrder=renderOrder)}))},this._duplicateLayer=function(id,parentId){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];folder&&(createLayer(null,parentId),copyFolderProps(folder,Object.values(_folders).last()))},this._duplicateGroup=function(id,children){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];if(!folder)return;let copyId=`group_${_groupIndex+1}`;getGroup(copyId),copyFolderProps(folder,Object.values(_folders).last()),children.forEach((childId=>{_this._duplicateLayer(childId,copyId)}))},this._getCinemaConfig=async function(){let _cinemaConfig=_config.get("Cinema Config").replace(".json","");return await get(Assets.getPath(`assets/geometry/${_cinemaConfig}.json`))},this._applyCinemaConfig=function(id,params){let folder=_folders[id]||_folders[`sl_${_name}_${id}`];if(!folder)return;let mesh=folder.getAll().filter((sub=>"Mesh"==sub.label))[0];if(params.geometry&&folder.params.setValue("geometry",params.geometry.replace("assets/geometry/","")),["position","quaternion","scale"].forEach((transform=>{if(params[transform]){let value=JSON.parse(params[transform]);if("quaternion"==transform){let quat=(new Quaternion).fromArray(value);value=(new Euler).setFromQuaternion(quat).toArray().slice(0,3).map((angle=>180*angle/Math.PI)),transform="rotation"}mesh.getAll().filter((control=>control.label==transform))[0].force(value)}})),params.visible&&"false"===params.visible&&!params.geometry&&(folder.params.setValue("geometry","World.PLANE"),folder.params.setValue("side","shader_double_side"),!Global.PLAYGROUND)){_meshes[folder.params.get("name")].shader.neverRender=!0}params.shader&&folder.params.setValue("shader",params.shader)},this.loadedAllLayers=async function(){return await _this.ready(),Promise.all(_promises)},this.set("breakpoint",(value=>{_this.localBreakpoint=!0,setBreakpoint({value:value})})),this.get("breakpoint",(_=>_breakpoint)),this.get("layers",(_=>_layers)),this.get("layerCount",(_=>_data.layers)),this.onDestroy=function(){_this.textures&&!_options.persistTextures&&_this.textures.forEach((t=>{t.destroy&&t.destroy()}))},this.addInitializer=function(callback){_initializers.push(callback)},this._completeInitialization=async function(sync){if(!_initializers.length)return!0;for(let i=0;i<_initializers.length;i++)await _initializers[i](sync);_initializers.length=0}}),(_=>{SceneLayout.BREAKPOINT="sl_breakpoint",SceneLayout.HOTLOAD_GEOMETRY="sl_hotload_geom",SceneLayout.HOTLOAD_SCRIPT="sl_hotload_script",SceneLayout.setBreakpoint=function(value){SceneLayout.breakpoint!==value&&(SceneLayout.breakpoint=value,Events.emitter._fireEvent(SceneLayout.BREAKPOINT,{value:value}))}})),Class((function SceneLayoutGizmo(){Inherit(this,Object3D);const _this=this;var _controls,_update,_attached,_lastVal;function findCamera(){let camera=World.CAMERA,p=_this.group._parent;for(;p;)p instanceof Scene&&p.nuke&&(camera=p.nuke.camera),p=p._parent;return camera}function update(){let uil=_attached._cameraUIL||_attached._meshUIL,key="translate"==_controls.getMode()?"position":"scale",value=_attached[key].toArray();(function same(a,b){return!(!a||!b||Math.abs(a[0]-b[0])>1e-4||Math.abs(a[1]-b[1])>1e-4||Math.abs(a[2]-b[2])>1e-4)})(value,_lastVal)||(_lastVal=value,_attached._cameraUIL&&"position"==key&&(key="groupPos"),uil?.[`forceUpdate${key.toUpperCase()}`]?.(value))}function startMoving(){_update=setInterval(update,250)}function stopMoving(){clearInterval(_update),update()}function keyDown(e){document.activeElement.tagName.toLowerCase().includes(["textarea","input"])||("."==e.key&&_controls.setMode("translate"),"/"==e.key&&_controls.setMode("scale"))}function playgroundEvent(camera){camera||(camera=findCamera()),_controls.camera=camera}async function nodeFocused(e){if(_controls.visible=!1,"Config"!=e.name&&e.layoutInstance==_this.parent){let layer=await _this.parent.getLayer(e.name),group=layer.group||layer;if(!group||!group.updateMatrixWorld)return;_controls.attach(group),_attached=group,_controls.visible=!0}}(_controls=new TransformControls(findCamera(),World.ELEMENT.div)).onChange=_controls.onMouseDown=_controls.onMouseUp=_controls.onObjectChange=e=>{},_controls.onMouseDown=startMoving,_controls.onMouseUp=stopMoving,_controls.draggingChanged=e=>{let activeControls=Playground.instance().activeControls;activeControls&&(activeControls.enabled=!e.value)},SceneLayoutGizmo.initialized?_controls.visible=!1:SceneLayoutGizmo.initialized=!0,_this.group.add(_controls),AppState.bind("playground_camera_active",playgroundEvent),function addListeners(){_this.events.sub(Keyboard.DOWN,keyDown),_this.events.sub(UILGraphNode.FOCUSED,nodeFocused)}(),_this.delayedCall((_=>{_controls.camera=findCamera()}),500)})),Class((function SceneLayoutPreloader(_name){Inherit(this,Component);function findMatch(src){if(!src)return!1;src=src.trim();for(let i=ASSETS.length-1;i>-1;i--)if(ASSETS[i].includes(src))return!0;return!1}this.load=function(name){let ext,promise=Promise.create(),array=[],settings_dxt=!!Renderer.extensions.s3tc,settings_etc=!!Renderer.extensions.etc1,settings_pvrtc=!!Renderer.extensions.pvrtc,settings_astc=!!Renderer.extensions.astc;settings_dxt?ext="dxt":settings_etc?ext="astc":settings_pvrtc?ext="pvrtc":settings_astc&&(ext="astc");let keys=UILStorage.getKeys(),i=0,worker=new Render.Worker((_=>{let key=keys[i];if(!key)return worker.stop(),void Promise.all(array).then(promise.resolve);if(key.includes(name)){let val=UILStorage.get(key);if(!val||!val.includes)return i++;if(key.includes("geometry")&&("{"==val.charAt(0)&&(val=JSON.parse(val).src),val.includes(".json")||(val+=".json"),val.includes("assets/")||(val="assets/geometry/"+val),array.push(GeomThread.loadGeometry(val,null,!0))),val.includes(".json"))val.includes("assets/")||(val="assets/geometry/"+val),findMatch(val.split("assets/")[1])&&array.push(fetch(Assets.getPath(val)).catch((e=>{})));else if(val.includes("src")){let obj=JSON.parse(val),src=obj.src;if(obj.compressed){let src0=src.split(".")[0],src1=src0.split("/");src=src0+"/"+src1[src1.length-1]+"-"+ext+".ktx"}findMatch(src.split("assets/")[1])&&array.push(fetch(Assets.getPath(src)).catch((e=>{})))}}i++}),1);return promise}}),"static"),Class((function Scroll(_object,_params){Inherit(this,Component);const _this=this,PROHIBITED_ELEMENTS=["prevent_interactionScroll"];this.x=0,this.y=0,this.max={x:0,y:0},this.delta={x:0,y:0},this.enabled=!0,_this.bounds=null;const _scrollTarget={x:0,y:0},_scrollInertia={x:0,y:0};let _axes=["x","y"];var _lastDelta,_deltaChange=0;function checkIfProhibited(element){let el=element;for(;el;){if(el.classList)for(let i=0;i<PROHIBITED_ELEMENTS.length;i++)if(el.classList.contains(PROHIBITED_ELEMENTS[i]))return!0;el=el.parentNode}return!1}function loop(){_this.object&&(Math.round(_this.object.div.scrollLeft)===Math.round(_this.x)&&Math.round(_this.object.div.scrollTop)===Math.round(_this.y)||(_this.x=_scrollTarget.x=_this.object.div.scrollLeft,_this.y=_scrollTarget.y=_this.object.div.scrollTop,stopInertia())),_axes.forEach((axis=>{_this.isInertia&&(_scrollInertia[axis]*=.9,_scrollTarget[axis]+=_scrollInertia[axis]),_this.limit&&(_scrollTarget[axis]=Math.max(_scrollTarget[axis],0)),_this.limit&&(_scrollTarget[axis]=Math.min(_scrollTarget[axis],_this.max[axis]/_this.scale)),_this.delta[axis]=_this.flag("block")?0:.5*(_scrollTarget[axis]*_this.scale-_this[axis]),_this[axis]+=_this.delta[axis],Math.abs(_this.delta[axis])<.01&&(_this.delta[axis]=0),Math.abs(_this[axis])<.001&&(_this[axis]=0),_this.flag("block")&&(_scrollTarget[axis]=0,_this.delta[axis]=0,_this[axis]=0),_this.object&&("x"==axis&&(_this.object.div.scrollLeft=Math.round(_this.x)),"y"==axis&&(_this.object.div.scrollTop=Math.round(_this.y)))}))}function stopInertia(){_this.isInertia=!1,clearTween(_scrollTarget)}function edgeScroll(e){let element=document.elementFromPoint(Math.clamp(Mouse.x,0,Stage.width),Math.clamp(Mouse.y,0,Stage.height));element&&checkIfProhibited(element)||_params.lockMouseX&&Mouse.x>Stage.width||"touch"===e.pointerType&&_this.enabled&&(e.preventDefault&&e.preventDefault(),_axes.forEach((axis=>{let dir=axis.toUpperCase(),delta=`offset${dir}`,diff=(_this[`ieDelta${dir}`]||e[delta])-e[delta];_scrollTarget[axis]+=diff,_scrollInertia[axis]=diff,_this.isInertia=!0,_this[`ieDelta${dir}`]=e[delta]})),_this.onUpdate&&_this.onUpdate(),_this.events.fire(Events.UPDATE,_scrollInertia))}function edgeScrollEnd(){_this.ieDeltaX=!1,_this.ieDeltaY=!1}function scroll(e){let element=document.elementFromPoint(Math.clamp(Mouse.x,0,Stage.width),Math.clamp(Mouse.y,0,Stage.height));if(element&&checkIfProhibited(element))return;if(_params.lockMouseX&&Mouse.x>Stage.width)return;if(!_this.enabled)return;if(!checkBounds(e))return;if(_this.object&&_this.limit&&e.preventDefault&&e.preventDefault(),!_this.mouseWheel)return;stopInertia();let newDelta=0;_axes.forEach((axis=>{let delta="delta"+axis.toUpperCase();if("mac"==Device.system.os){if("firefox"==Device.system.browser)return 1===e.deltaMode?(_scrollTarget[axis]+=4*e[delta],_scrollInertia[axis]=4*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])):void(_scrollTarget[axis]+=e[delta]);if(Device.system.browser.includes(["chrome","safari"]))return _scrollTarget[axis]+=.33*e[delta],_scrollInertia[axis]=.33*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}if("windows"==Device.system.os){if("firefox"==Device.system.browser&&1===e.deltaMode)return _scrollTarget[axis]+=10*e[delta],_scrollInertia[axis]=10*e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis]);if(Device.system.browser.includes(["chrome"])){let s=.25;return _scrollTarget[axis]+=e[delta]*s,_scrollInertia[axis]=e[delta]*s,_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}if("ie"==Device.system.browser)return _scrollTarget[axis]+=e[delta],_scrollInertia[axis]=e[delta],_this.isInertia=!0,void(newDelta=_scrollInertia[axis])}_scrollTarget[axis]+=e[delta],newDelta=_scrollInertia[axis]})),newDelta=Math.abs(newDelta),newDelta!=_lastDelta&&_deltaChange++,_this.flag("hardBlock")||(_deltaChange>3?newDelta>_lastDelta&&_this.flag("block",!1):newDelta>=_lastDelta&&_this.flag("block",!1)),_lastDelta=newDelta,_this.onUpdate&&_this.onUpdate(),_this.events.fire(Events.UPDATE,_scrollInertia),_this.events.fire(Scroll.EVENT,e)}function down(e){if(!_this.enabled)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||stopInertia()}function drag(e){if(!_this.enabled)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||(_axes.forEach((axis=>{let newDelta=Math.abs(Mouse.delta[axis]);_this.flag("hardBlock")||newDelta>_lastDelta&&_this.flag("block",!1),_lastDelta=newDelta,_scrollTarget[axis]-=Mouse.delta[axis]})),_this.events.fire(Events.UPDATE))}function up(e){if(!_this.enabled||_this.preventInertia)return;if(!checkBounds(e))return;let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));if(element&&checkIfProhibited(element))return;const m="android"==Device.system.os?35:25,obj={};_axes.forEach((axis=>{obj[axis]=_scrollTarget[axis]-Mouse.delta[axis]*m})),tween(_scrollTarget,obj,2500,"easeOutQuint")}function resize(){if(!_this.enabled)return;if(stopInertia(),!_this.object)return;const p={};Device.mobile&&_axes.forEach((axis=>p[axis]=_this.max[axis]?_scrollTarget[axis]/_this.max[axis]:0)),void 0===_params.height&&(_this.max.y=_this.object.div.scrollHeight-_this.object.div.clientHeight),void 0===_params.width&&(_this.max.x=_this.object.div.scrollWidth-_this.object.div.clientWidth),Device.mobile&&_axes.forEach((axis=>_this[axis]=_scrollTarget[axis]=p[axis]*_this.max[axis]))}function checkBounds(e){return!_this.bounds||!(e.x/Stage.width>_this.bounds.x.y||e.x/Stage.width<_this.bounds.x.x||e.y/Stage.height>_this.bounds.y.y||e.y/Stage.height<_this.bounds.y.x)}!function initParams(){_object&&_object.div||(_params=_object,_object=null),_params||(_params={}),_this.object=_object,_this.hitObject=_params.hitObject||_this.object,_this.max.y=_params.height||0,_this.max.x=_params.width||0,_this.scale=_params.scale||1,_this.drag=void 0!==_params.drag?_params.drag:!!Device.mobile,_this.mouseWheel=!1!==_params.mouseWheel,_this.limit="boolean"==typeof _params.limit&&_params.limit,_this.bounds=_params.bounds||null,Array.isArray(_params.axes)&&(_axes=_params.axes)}(),_this.object&&function style(){_this.object.css({overflow:"auto"})}(),function addHandlers(){if(Device.mobile||("ie"===Device.system.browser&&Device.system.browserVersion>=17&&(document.body.addEventListener("pointermove",edgeScroll,!0),document.body.addEventListener("pointerup",edgeScrollEnd,!0)),"ie"==Device.system.browser?document.body.addEventListener("wheel",scroll,!0):__window.bind("wheel",scroll)),_this.drag){_this.hitObject&&_this.hitObject.bind("touchstart",(e=>{let element=document.elementFromPoint(Math.clamp(e.x||0,0,Stage.width),Math.clamp(e.y||0,0,Stage.height));element&&checkIfProhibited(element)||e.preventDefault()}));let input=_this.hitObject?_this.initClass(Interaction,_this.hitObject):Mouse.input;_this.events.sub(input,Interaction.START,down),_this.events.sub(input,Interaction.DRAG,drag),_this.events.sub(input,Interaction.END,up)}_this.events.sub(Events.RESIZE,resize)}(),resize(),_this.startRender(loop),this.reset=function(){return _this.object&&_this.object.div&&(_this.object.div.scrollLeft=_this.x=0,_this.object.div.scrollTop=_this.y=0),_scrollTarget.x=_scrollTarget.y=0,_scrollInertia.x=_scrollInertia.y=0,stopInertia(),this},this.onDestroy=function(){__window.unbind("wheel",scroll)},this.resize=resize,this.scrollTo=function(value,axis="y"){let values={};values[axis]=value,tween(_scrollTarget,values,800,"easeInOutCubic")},this.setTarget=function(value,axis="y"){_scrollTarget[axis]=value},this.blockUntilNewScroll=function(){return _this.reset(),_this.flag("block",!0),_this.flag("hardBlock",!0,200),this},this.stopInertia=stopInertia}),(_=>{var _scroll;Scroll.EVENT="scroll_event",Scroll.createUnlimited=Scroll.getUnlimited=function(options){return _scroll||(_scroll=new Scroll({limit:!1,drag:Device.mobile})),_scroll}})),Class((function ScrollCamera(_input,_group){Inherit(this,Object3D);const _this=this;var _scroll,_config,_visible,_breakpoints,_breakpoint,_observables=[],_target=new Vector3,_velocity=new VelocityTracker(_target),_frustum=new Frustum,_dynamic={};function createConfig(initialConfig=!1){let suffix=_breakpoint?`-${_breakpoint}`:"",name=`${_input.prefix}_scroll${suffix}`,config=InputUIL.create(name,initialConfig?_group:null);return config.setLabel("Config"+(_breakpoint?` (${_breakpoint})`:"")),config.add("multiplier",1),config.add("lerp",.2),config.add("zLerp",.02),config.add("zMove",3),config.addNumber("top",0,.05),config.addNumber("bottom",-10,.05),config}function loop(){_velocity.update(),_target.y-=.003*_scroll.delta.y*_this.multiplier;let top=_this.top,bottom=_this.bottom;_target.y>top&&(_target.y=top),_target.y<bottom&&(_target.y=bottom),_target.z=Math.range(Math.abs(_velocity.value.y),0,.1,0,1,!0)*_this.zMove,_this.group.position.y=Math.lerp(_target.y,_this.group.position.y,_this.lerp),_this.baseCamera.group.position.z=Math.lerp(_target.z,_this.baseCamera.group.position.z,_this.zLerp)}function runObservables(){_frustum.setFromCamera(_this.baseCamera.camera);for(let i=_observables.length-1;i>-1;i--){let obj=_observables[i];_frustum.intersectsObject(obj.mesh)?obj.intersecting||(obj.intersecting=!0,obj.callback(!0)):obj.intersecting&&(obj.intersecting=!1,obj.callback(!1))}}function handleBreakpoint({value:breakpoint}){_breakpoint!==breakpoint&&_breakpoints.includes(breakpoint)&&(_breakpoint=breakpoint,_config=createConfig(!1))}function handleKeyDown({key:key,shiftKey:shiftKey}){if(_visible)switch(key){case"Up":case"ArrowUp":_this.scrollTo(_target.y+getLineHeight());break;case"Down":case"ArrowDown":_this.scrollTo(_target.y-getLineHeight());break;case"Home":_this.scrollTo(_this.top);break;case"End":_this.scrollTo(_this.bottom);break;case"PageUp":_this.scrollTo(_target.y+getPageHeight());break;case"PageDown":_this.scrollTo(_target.y-getPageHeight());break;case" ":case"Spacebar":handleKeyDown(shiftKey?{key:"PageUp"}:{key:"PageDown"})}}function getLineHeight(){return getPageHeight()/Stage.height*40}function getPageHeight(){return Utils3D.getHeightFromCamera(_this.baseCamera.camera,_this.group.getWorldPosition().z)}this.baseCamera=_this.initClass(BaseCamera,_input,_group,void 0),this.velocity=_velocity,function initConfig(){(_breakpoints=_input.get("breakpoints"))&&(_breakpoints=_breakpoints.replace(/ /g,"").split(",")),_breakpoints||(_breakpoints=[]),_breakpoints.includes("")||_breakpoints.push(""),_breakpoint=_breakpoints.includes(SceneLayout.breakpoint)?SceneLayout.breakpoint:"",_config=createConfig(!0),_this.events.sub(SceneLayout.BREAKPOINT,handleBreakpoint)}(),function addHandlers(){_this.events.sub(Keyboard.DOWN,handleKeyDown)}(),_scroll=Scroll.createUnlimited(),_this.startRender(loop),_this.startRender(runObservables,24),function initDynamicOverrides(){["multiplier","lerp","zLerp","zMove","top","bottom"].forEach((key=>{_this.get(key,(_=>void 0===_dynamic[key]?_config.getNumber(key):_dynamic[key])),_this.set(key,(value=>_dynamic[key]=value))}))}(),this.observe=function(mesh,callback){_observables.push({callback:callback,mesh:mesh})},this.scrollTo=function(y,animate=!0){_target.y=y;let top=_this.top,bottom=_this.bottom;_target.y>top&&(_target.y=top),_target.y<bottom&&(_target.y=bottom),animate||(_this.group.position.y=_target.y)},this.reset=function(animate=!1){_this.scrollTo(_this.top,animate)},this.onVisible=function(){_visible=!0},this.onInvisible=function(){_visible=!1}})),Class((function Shaders(){Inherit(this,Component);var _this=this;function parseSingleShader(code,fileName){let uniforms=code.split("#!UNIFORMS")[1].split("#!")[0],varyings=code.split("#!VARYINGS")[1].split("#!")[0],attributes=code.split("#!ATTRIBUTES")[1].split("#!")[0];for(;code.includes("#!SHADER");){let split=(code=code.slice(code.indexOf("#!SHADER"))).split("#!SHADER")[1],br=split.indexOf("\n"),name=split.slice(0,br).split(": ")[1];name.slice(0,6).includes("Vertex")&&(name=fileName.split(".")[0]+".vs"),name.slice(0,8).includes("Fragment")&&(name=fileName.split(".")[0]+".fs");let glsl=split.slice(br);glsl=name.includes(".vs")?attributes+uniforms+varyings+glsl:uniforms+varyings+glsl;let splitName=name.split(".");_this[splitName[0]+(splitName[1].includes("vs")?".vs":".fs")]=glsl,code=code.replace("#!SHADER","$")}}function parseCompiled(shaders){var split=shaders.split("{@}");split.shift();for(var i=0;i<split.length;i+=2){var name=split[i],text=split[i+1];text.includes("#!UNIFORMS")?parseSingleShader(text,name):_this[name]=text}}function parseRequirements(){for(var key in _this){var obj=_this[key];"string"==typeof obj&&(_this[key]=require(obj))}}function require(shader){if(!shader.includes("require"))return shader;for(shader=shader.replace(/# require/g,"#require");shader.includes("#require");){var name=shader.split("#require(")[1].split(")")[0];if(name=name.replace(/ /g,""),!_this[name])throw"Shader required "+name+", but not found in compiled shaders.\n"+shader;shader=shader.replace("#require("+name+")",_this[name])}return shader}this.parse=function(code,file){code.includes("{@}")?(parseCompiled(code),parseRequirements()):(file=(file=file.split("/"))[file.length-1],_this[file]=code),_this.shadersParsed=!0},this.parseSingle=parseSingleShader,this.onReady=this.ready=function(callback){let promise=Promise.create();return callback&&promise.then(callback),_this.wait((()=>promise.resolve()),_this,"shadersParsed"),promise},this.getShader=function(string){_this.FALLBACKS&&_this.FALLBACKS[string]&&(string=_this.FALLBACKS[string]);var code=_this[string];if(!code)throw`No shader ${string} found`;for(;code.includes("#test ");)try{var test=code.split("#test ")[1],name=test.split("\n")[0],glsl=code.split("#test "+name+"\n")[1].split("#endtest")[0];eval(name)||(code=code.replace(glsl,"")),code=code.replace("#test "+name+"\n",""),code=code.replace("#endtest","")}catch(e){throw"Error parsing test :: "+string}return code}}),"static"),Class((function Smooth(_object,_params){Inherit(this,Component);const _this=this;var _current,_views;this.position=0,this.last=0,this.delta=0,this.direction=0,this.index1=0,this.index2=0,this.progress=0;var _index=0,_bottomScrolled=!1,_topScrolled=!1,_timer=null,_totalHeight=0,_config,_lerpSpeed=75e-5,_retryTimer=null,_initLoaded=!1;function initParams(){_params||(_params={}),_this.object=_object,_this.smoothScroll=!1!==_params.smoothScroll,_this.relativePositioning=_params.relativePositioning}function initConfig(){(_config=InputUIL.create("Smooth")).setLabel("Smooth"),_config.add("lerpSpeed",_lerpSpeed),_config.onUpdate=readConfig,readConfig()}function readConfig(){_lerpSpeed=_config.getNumber("lerpSpeed"),isNaN(_lerpSpeed)&&(_lerpSpeed=eval(_config.get("lerpSpeed")))}function style(){_this.smoothScroll?_this.object.css({position:"fixed",top:0,left:0,width:"100%",height:"100%",overflow:"hidden"}):_this.object.css({width:"100%"})}function addHandlers(){_this.events.sub(Events.RESIZE,resize),_this.events.sub(ViewController.NEWS_TRANSITION_ANIMATING,newsAnimating),_this.events.sub(ViewController.NEWS_TRANSITION_IDLE,newsIdle),_this.events.sub(InteractiveSection.INITIAL_LOADED,onLoaded),_this.startRender(loop),_this.smoothScroll&&_this.events.sub(Keyboard.DOWN,keydown)}function onLoaded(){_this.delayedCall((_=>{_initLoaded=!0}),1e3)}function removeHandlers(){_this.events.unsub(Events.RESIZE,resize),_this.stopRender(loop),_this.smoothScroll&&_this.events.unsub(Keyboard.DOWN,keydown)}async function keydown(e){if(_views&&"Tab"===e.code){if(await defer(),_this.object.div.scrollTop=0,!_this.object.div.contains(document.activeElement))return;_this.scroll=document.activeElement.getBoundingClientRect().top+document.scrollingElement.scrollTop+-Stage.height/2}}async function resize(){if(_views){await defer(),await defer(),_totalHeight=0;for(let i=0,l=_views.length;i<l;i++){let view=_views[i],layout=view.ui||view;if(!layout.element)return;_this.relativePositioning||layout.element.css({top:_totalHeight}),view.start=_totalHeight,layout.start=_totalHeight;let height=layout.element.div.getBoundingClientRect().height;view.height=height,layout.height=height,_totalHeight+=height,layout.parallax&&layout.element.willChange("transform")}0!=_totalHeight?(__body.css({height:_totalHeight}),update()):_retryTimer=_this.delayedCall((()=>{resize()}),100)}}function newsAnimating(){_this.flag("newsAnimating",!0)}function newsIdle(){_this.flag("newsAnimating",!1)}function loop(){_this.smoothScroll?_this.flag("newsAnimating")?_this.position=document.scrollingElement.scrollTop:_this.position=Math.lerp(document.scrollingElement.scrollTop,_this.position,_lerpSpeed):_this.position=document.scrollingElement.scrollTop,_this.delta=_this.position-_this.last,_this.last=_this.position,_this.direction=Math.sign(_this.delta),Math.abs(_this.delta)<.001&&_initLoaded||update()}function update(){if(!_views)return;_this.smoothScroll&&(_current.element.y=-Math.floor(_this.position),_current.element.transform());let height=0;for(let i=0,l=_views.length;i<l;i++){if(height+=_views[i].height,_this.position<height&&Math.abs(_this.position-height)>1){_this.index1=i,_this.index2=i+1,_this.index2>l-1&&(_this.index2=l-1);break}}if(_views[_this.index1]?.height<Stage.height)_this.progress=(_this.position-_views[_this.index1].start)/_views[_this.index1].height;else{let current=_this.position+Stage.height-_views[_this.index2].start;_this.progress=Math.clamp(current/Stage.height,0,1)}if(parallax(_views[_this.index1]),parallax(_views[_this.index2]),_index!==_this.index1){_index=_this.index1;let event={};event.index=_index,event.direction=_this.direction,event.view=_views[_index],_this.events.fire(Smooth.VIEW_CHANGE,event)}Math.abs(_totalHeight-Stage.height-_this.position)<.2*Stage.height?_bottomScrolled||(_bottomScrolled=!0,_timer=_this.delayedCall((()=>{let event={};event.index=_this.index2,event.direction=1,event.view=_views[_this.index2],_this.events.fire(Smooth.BOTTOM,event)}),850)):(_timer&&(clearTimeout(_timer),_timer=null),_bottomScrolled&&(_bottomScrolled=!1))}function parallax(view){let current=_this.position+Stage.height-view.start,progress=Math.clamp(current/(view.height+Stage.height),0,1);view.progress=progress,view.direction=_this.direction;let layout=view.ui;layout&&(layout.progress=progress,layout.parallax&&(current=view.height*layout.parallax-view.height,layout.element.y=Math.floor(.5*current-current*progress),layout.element.transform()))}initParams(),initConfig(),style(),addHandlers(),Mobile.allowNativeScroll(),Tests.generatePreview()&&_this.delayedCall((_=>{_this.startRender((_=>{_this.scroll+=30}))}),5e3),this.get("scroll",(_=>document.scrollingElement.scrollTop)),this.set("scroll",(s=>document.scrollingElement.scrollTop=Math._round(s))),this.show=async function(page){_this.smoothScroll&&page.element.willChange("transform"),_current=page,_views=page.views,await _this.wait(10),_this.scroll=0,_this.position=0,resize()},this.lock=function(){__body.css({overflow:"hidden"})},this.unlock=function(){__body.css({overflow:""})},this.resize=function(){resize()},this.onDestroy=function(){removeHandlers()},Dev.expose("lock",this.lock),Dev.expose("unlock",this.unlock)}),(_=>{Smooth.VIEW_CHANGE="smooth_view_change",Smooth.BOTTOM="smooth_bottom",Smooth.TOP="smooth_top"})),Class((function SmoothRenderManager(){Inherit(this,Component);const _this=this;var _object,_mesh,_transitionShader,_smooth,_views,_index1=0,_index2=0,_renderCount=0;function onSmoothViewChange(e){_this.events.fire(_this.VIEW_CHANGE,e)}function onSmoothBottom(e){_this.events.fire(_this.BOTTOM,e)}function onSmoothTop(e){_this.events.fire(_this.TOP,e)}function loop(){_views&&(_index1!==_smooth.index1||_index2!==_smooth.index2?(_views[_index1].rt&&_index1!=_smooth.index2&&_index1!=_smooth.index2&&(_views[_index1]._smoothShowing=!1,_views[_index1].hide()),_views[_index2].rt&&_index2!=_smooth.index1&&_index2!=_smooth.index2&&(_views[_index2].hide(),_views[_index2]._smoothShowing=!1),_index1=_smooth.index1,_index2=_smooth.index2,_views[_index1].rt&&(_views[_index1].show(),_views[_index1]._smoothShowing=!0),_views[_index2].rt&&_smooth.progress>.01&&(_views[_index2].show(),_views[_index2]._smoothShowing=!0)):_views[_index1]._smoothShowing&&_views[_index2]._smoothShowing||(_views[_index1].rt&&(_views[_index1].show(),_views[_index1]._smoothShowing=!0),_index1!=_index2&&_views[_index2].rt&&_smooth.progress>.01&&(_views[_index2].show(),_views[_index2]._smoothShowing=!0)),_transitionShader.set("tMap1",_views[_index1].rt?_views[_index1]:null),_transitionShader.set("tMap2",_views[_index2].rt?_views[_index2]:null),_transitionShader.set("uTransition",_smooth.progress),_this.pingPong&&_views.length>1&&_index1!=_index2?(0===(_renderCount=Math.abs(_renderCount-1))&&_views[_index1].rt&&(_views[_index1].preventRTDraw=!1,_views[_index2].preventRTDraw=!0),1===_renderCount&&_views[_index2].rt&&(_views[_index2].preventRTDraw=!1,_views[_index1].preventRTDraw=!0)):(_views[_index2].preventRTDraw=!1,_views[_index1].preventRTDraw=!1))}this.VIEW_CHANGE="SmoothRenderManager_view_change",this.BOTTOM="SmoothRenderManager_bottom",this.TOP="SmoothRenderManager_top",this.initialize=function(object,transitionShader,params={}){_transitionShader=transitionShader,(_mesh=new Mesh(World.QUAD,_transitionShader)).frustumCulled=!1,(_object=object).add(_mesh),_smooth=_this.initClass(Smooth,params.container,params),_this.events.sub(_smooth,Smooth.VIEW_CHANGE,onSmoothViewChange),_this.events.sub(_smooth,Smooth.BOTTOM,onSmoothBottom),_this.events.sub(_smooth,Smooth.TOP,onSmoothTop),_this.object=object,_this.transitionShader=transitionShader,_this.pingPong=params.pingPong,_this.pingPong&&Render.setRefreshScale(2),_this.smooth=_smooth},this.show=function(page){_smooth.show(page),(_views=page.views).forEach((view=>{view._smoothShowing=!1})),_this.startRender(loop)},this.hide=function(){_this.stopRender(loop)},this.lock=function(){_smooth.lock()},this.unlock=function(){_smooth.unlock()},this.createLocal=function(){return new SmoothRenderManager},this.resize=function(){_smooth.resize()},this.onDestroy=function(){_object&&_object.remove&&_object.remove(_mesh)}}),"static"),Class((function StageLayout(_name,_options={}){Inherit(this,Component);const _this=this;var _dataStore,_data,$create;const GLUI=void 0===_options.glui||_options.glui;var _uil=getTopLevelUIL(),_folders={},_layers={},_exists={},_resize=[],_graph,_config;function getTopLevelUIL(){let uil=UIL.sidebar;return!_options.uil&&_this.parent&&uil&&Utils.getConstructorName(_this.parent)!=Global.PLAYGROUND&&(uil=new UILFolder(`stl_${_name}_nested`,{label:`${_name.capitalize()} (Nested)`,closed:!0}),UIL.sidebar&&UIL.sidebar.add(uil)),uil}function createFolder(name){let folder=new UILFolder(`stl_${_name}_${name}`,{label:name,closed:!0});return _folders[`stl_${_name}_${name}`]=folder,folder}async function initGraph(){_options.noGraph||!window.UILGraph||StageLayout.noGraph||(_graph=UILGraph.instance().getGraph(_name,_this,!!GLUI))&&(UIL.sidebar.element.show(),Global.PLAYGROUND&&(Utils.getConstructorName(_this.parent),Global.PLAYGROUND),_graph.open())}function initParams(){_options.rootPath?"/"!=_options.rootPath.charAt(_options.rootPath.length-1)&&(_options.rootPath+="/"):_options.rootPath="",_this.baseZ=_options.baseZ||0,_this.data=_options.data,_options.uil&&(_uil=_options.uil),GLUI?(_this.element=$gl(1,1),_this.element.stageLayout=_this):(_this.element=$("StageLayout_"+_name),_this.element.size("100%"))}async function initData(){if(await UILStorage.ready(),_dataStore=InputUIL.create(`stagelayout_${_name}`,null),void 0===(_data=JSON.parse(_dataStore.get("data")||"{}")).layers&&(_data.layers=-1),_options.perFrame)_data.layers>0&&createLayers();else{for(let i=0,c=_data.layers+1;i<c;i++)createLayer(i);_this.loaded=!0}}function initRoot(){let name=_name+"Root",group=_uil?createFolder(name):null,$obj=_this.element,input=InputUIL.create(`Config_${name}_${_name}`,group);if(input.setLabel("Parameters"),input.add("size").addTextarea("fontStyle").addTextarea("css",GLUI?"hidden":void 0).add("onResize","hidden"),input.add("compiled","hidden"),input.add("Figma Config"),_config=input,!group)return createCompiledLayer(`${name}_${_name}`,input);StageLayoutUtil.create(`${name}_${_name}`),group.hide(),group.setLabel(name);let size=input.get("size"),css=input.get("css"),resizeCode=(input.get("fontStyle"),input.get("onResize")),doCSS=change=>{if(GLUI)return;css=css||"";let obj={},objSave={};css=css.split("\n"),css.forEach((line=>{let key=(line=line.split(":"))[0],val=line[1],valSave=val;val&&(val=parseData(val.replace(/ /g,""))),key.length&&(obj[key]=isNaN(Number(val))?val:Number(val),valSave&&(valSave=valSave.replace(/ /g,"")),objSave[key]=isNaN(Number(valSave))?valSave:Number(valSave))})),change&&StageLayoutUtil.save("css",objSave,input),$obj.css(obj)},doSize=change=>{if(size){let s=parseData(size).replace(/ /g,"").split(","),s0=s[0].includes("%")?s[0]:Number(s[0])||s[0],s1=s[1].includes("%")?s[1]:Number(s[1])||s[1];$obj.size(s0,s1),change&&StageLayoutUtil.save("size",[s0,s1],input)}else $obj.size(100,100)},doResize=change=>{if(resizeCode){let fn=new Function("$this",resizeCode);_resize.push({fn:fn,$obj:$obj}),fn($obj)}},doFont=change=>{let fontStyle=parseData(input.get("fontStyle"));fontStyle&&(fontStyle=fontStyle.split("\n"),$obj.fontStyle(fontStyle[0],Number(fontStyle[1]),fontStyle[2],fontStyle[3]),change&&StageLayoutUtil.save("fontStyle",fontStyle,input))};doCSS(),doSize(),doFont(),doResize(),input.onUpdate=key=>{switch(key){case"css":css=input.get("css"),doCSS(!0);break;case"size":size=input.get("size"),doSize(!0);break;case"onResize":resizeCode=input.get("onResize"),doResize();break;case"fontStyle":doFont(!0)}},group.params=input,_graph&&_graph.addSpecial(group.id,name,"Root"),_uil.add(group),(_=>{let folder=new UILFolder(`stl_${_name}_${name}_resize`,{label:"Resize Logic",closed:!0}),button=new UILControlButton("button",{actions:[{title:"Open Editor",callback:_=>{let editor=new UILWindow(_name,{label:"Resize Logic",height:"auto",drag:!0}),text=new UILControlTextarea(`stl_${_name}_${name}_resize`,{label:"Resize",value:input.get("onResize"),monospace:!0,rows:10,resize:"both",minWidth:400,hideLabel:!0,tab:!0});editor.add(text),text.onFinishChange((value=>input.setValue("onResize",value))),UIL.add(editor)}}],hideLabel:!0});folder.add(button),group.add(folder)})()}function createLayers(){let index=0,renderWorker=new Render.Worker((function(){createLayer(index),index++==_data.layers&&(renderWorker.stop(),_this.loaded=!0)}),_options.perFrame)}function parseData(text){if(!text||"string"!=typeof text||!text.includes("$DATA"))return text;for(;text.includes("$DATA");){let code=text.split("$DATA")[1].split(" ")[0].split("\n")[0],line="$DATA"+code;text=text.replace(line,eval(line.replace("$DATA","_options.data")))}return text}async function createCompiledLayer(key,input){let compiled=StageLayoutUtil.getCompiled(key);if(!compiled)return;let $obj,name=input.get("name"),text=input.get("text");$obj=GLUI?text?$glText(parseData(text),null,null,compiled.fontStyle):$gl(1,1,parseData(input.get("bg"))):key==`${_name}Root_${_name}`?_this.element:$(name||"Layer",parseData(input.get("type")||"div"));let nestedGroup=input.get("group");if(nestedGroup){let layer;layer=nestedGroup===_name?_this.element:await _this.getLayer(nestedGroup),layer.add($obj)}else _this.element!=$obj&&_this.element.add($obj);if(Global.PLAYGROUND&&($obj._input=input),_layers[name]=$obj,_exists[name]=!0,checkNameHook($obj,name),compiled.css&&$obj.css){for(let key in compiled.css)compiled.css[key]=parseData(compiled.css[key]);$obj.css(compiled.css)}if(compiled.transform){for(let key in compiled.transform)$obj[key]=compiled.transform[key];$obj.transform&&$obj.transform()}if(compiled.size&&$obj.size(compiled.size[0],compiled.size[1]),compiled.attributes&&$obj.attr)for(let key in compiled.attributes)$obj.attr(key,parseData(compiled.attributes[key]));if(!GLUI){let bg=input.get("bg");bg&&$obj.bg(parseData(bg)||"#ff0000")}if(!GLUI){if(text){text=parseData(text);let helper=compiled.helper;if(helper){let helperName=helper.split("(")[0],args=helper.split("(")[1];args?(args=args.replace(")","").replace(/,\ /g,",").split(","),args.forEach((function(arg,i){"$text"==arg&&(args[i]=text)})),args.indexOf(text)<0&&args.unshift(text)):args=[text];let helperFn=_options[helperName]||StageLayout.helpers[helperName];return helperFn?void $obj.html(helperFn.apply(null,args)):console.warn(`No helper function ${helperName} found.`)}text.includes(["</","/>"])?$obj.html(text):$obj.text(text)}let fs=compiled.fontStyle;fs&&$obj.fontStyle(fs[0],Number(fs[1]),fs[2],fs[3])}let zIndex=input.getNumber("zIndex");"number"==typeof zIndex&&$obj&&$obj.setZ&&!isNaN(zIndex)&&$obj.setZ(zIndex),compiled.resize&&(_resize.push({$obj:$obj,fn:compiled.resize}),compiled.resize($obj));let customClass=input.get("customClass");if(customClass){let Class=window[customClass];if(customClass.includes(".")){let split=customClass.split(".");Class=window[split[0]]&&window[split[0]][split[1]]}if(!Class)return console.warn(`No custom class ${customClass} found.`);_layers[name]=_this.initClass(Class,$obj,_options.data,input)}}function checkNameHook($obj,name){if(_this.layerHooks)for(let i=0,l=_this.layerHooks.length;i<l;i++){console.log(i);let{test:test,callback:callback,classConstructor:classConstructor}=_this.layerHooks[i];test&&test(name)&&(classConstructor&&_this.initClass(classConstructor,$obj,name),callback&&callback($obj,name))}for(let i=0,l=StageLayout.LAYER_HOOKS.length;i<l;i++){let{test:test,callback:callback,classConstructor:classConstructor}=StageLayout.LAYER_HOOKS[i];test&&test(name)&&(classConstructor&&_this.initClass(classConstructor,$obj,name),callback&&callback($obj,name))}}async function createLayer(index,groupName){let id="number"==typeof index?index:++_data.layers;if(UILStorage.get(`stl_${_name}_${id}_deleted`))return;let $obj,group=_uil?createFolder(id):null,input=InputUIL.create(`Config_${id}_${_name}`,group);if(input.setLabel("Parameters"),input.add("name").add("type",GLUI?"hidden":void 0).add("bg").add("size").add("group").add("customClass").add("wildcard").add("helper",GLUI?"hidden":void 0).add("zIndex","hidden").addTextarea("attributes",GLUI?"hidden":void 0).addTextarea("text").addTextarea("fontStyle").addTextarea("css",GLUI?"hidden":void 0).addTextarea("transform").add("onResize","hidden"),input.add("compiled","hidden"),!group)return createCompiledLayer(`${id}_${_name}`,input);StageLayoutUtil.create(`${id}_${_name}`),groupName&&input.setValue("group",groupName);let name=input.get("name")||id+"",size=input.get("size"),bg=input.get("bg"),css=input.get("css"),transform=input.get("transform"),type=input.get("type"),attributes=input.get("attributes"),text=input.get("text"),nestedGroup=(input.get("fontStyle"),input.get("group")),resizeCode=input.get("onResize"),zIndex=input.getNumber("zIndex"),customClass=input.get("customClass"),helper=input.get("helper");input.get("wildcard");group.setLabel(name),group.params=input;let getGLUIFontObject=_=>{let font=input.get("fontStyle")||"",obj={};return font=font.split("\n"),font.forEach((line=>{let key=(line=line.split(":"))[0],val=line[1];val&&(val=val.replace(/ /g,"")),key.length&&(obj[key]=isNaN(Number(val))?val:Number(val),"false"===val&&(obj[key]=!1),"true"===val&&(obj[key]=!0))})),obj};if($obj=GLUI?text?$glText(parseData(text),null,null,getGLUIFontObject()):$gl(1,1,bg?parseData(bg):bg||name?void 0:"assets/images/_scenelayout/uv.jpg"):$(name||"Layer",parseData(type)),$obj._uil=group,nestedGroup){let layer;layer=nestedGroup===_name?_this.element:await _this.getLayer(nestedGroup),layer.add&&layer.add($obj),group&&_uil.add(group)}else _this.element.add($obj),group&&_uil.add(group);_graph&&_graph.addGroup(group.id,name||id+"",nestedGroup),(_=>{let folder=new UILFolder(`stl_${_name}_${name}_resize`,{label:"Resize Logic",closed:!0}),button=new UILControlButton("button",{actions:[{title:"Open Editor",callback:_=>{let editor=new UILWindow(_name,{label:"Resize Logic",height:"auto",drag:!0}),text=new UILControlTextarea(`stl_${_name}_${name}_resize`,{label:"Resize",value:input.get("onResize"),monospace:!0,rows:10,resize:"both",minWidth:400,hideLabel:!0,tab:!0});editor.add(text),text.onFinishChange((value=>input.setValue("onResize",value))),UIL.add(editor)}}],hideLabel:!0});folder.add(button),group.add(folder)})(),Global.PLAYGROUND&&($obj._input=input),_layers[name]=$obj,_exists[name]=!0,checkNameHook($obj,name);let doBG=change=>{GLUI?change&&$obj.bg(parseData(bg)):(bg||!bg&&!name)&&$obj.bg(parseData(bg)||"#ff0000")},doType=change=>{GLUI||change&&StageLayoutUtil.save("type",{type:type},input)},doCSS=change=>{if(GLUI)return;css=css||"";let obj={};css=css.split("\n"),css.forEach((line=>{let key=(line=line.split(":"))[0],val=line[1];val&&(val=parseData(val.replace(/ /g,""))),key.length&&(obj[key]=isNaN(Number(val))?val:Number(val))})),change&&StageLayoutUtil.save("css",obj,input),$obj.css(obj)},doTransform=change=>{transform=transform||"";let obj={};transform=transform.split("\n"),transform.forEach((line=>{let key=(line=line.split(":"))[0],val=line[1];val&&(val=val.replace(/ /g,"")),key.length&&(obj[key]=$obj[key]=isNaN(Number(val))?val:Number(val))})),change&&StageLayoutUtil.save("transform",obj,input),GLUI||$obj.transform()},doResize=change=>{if(resizeCode){let fn=new Function("$this",resizeCode);_resize.push({fn:fn,$obj:$obj}),fn($obj)}},doSize=change=>{if(size){let s=parseData(size).replace(/ /g,"").split(","),s0=Number(s[0])||s[0],s1=Number(s[1])||s[1];$obj.size(s0,s1),change&&StageLayoutUtil.save("size",[s0,s1],input)}else $obj.size(100,100)},doAttributes=change=>{if(GLUI)return;attributes=attributes||"";let obj={};attributes.split("\n").forEach((function(line,i){let key=(line=line.split(":"))[0],val=line[1];val&&(val=val.replace(/ /g,"")),obj[key]=val,val=parseData(val),$obj.attr(key,val)})),change&&StageLayoutUtil.save("attributes",obj,input)},doText=change=>{if(text=parseData(text),GLUI){if(!text)return $obj;if($obj instanceof GLUIObject)return $obj;let fontStyle=getGLUIFontObject();change&&StageLayoutUtil.save("fontStyle",fontStyle,input),$obj.setText(text,fontStyle),fontStyle.color&&$obj.setColor(fontStyle.color)}else{let fontStyle=parseData(input.get("fontStyle"));if(fontStyle?(fontStyle=fontStyle.split("\n"),$obj.fontStyle(fontStyle[0]||"",Number(fontStyle[1]),fontStyle[2],fontStyle[3]),change&&StageLayoutUtil.save("fontStyle",fontStyle,input)):change&&StageLayoutUtil.save("fontStyle","",input),!text)return;if(helper){let helperName=helper.split("(")[0],args=helper.split("(")[1];args?(args=args.replace(")","").replace(/,\ /g,",").split(","),args.forEach((function(arg,i){"$text"==arg&&(args[i]=text)})),args.indexOf(text)<0&&args.unshift(text)):args=[text];let helperFn=_options[helperName]||StageLayout.helpers[helperName];return helperFn?($obj.html(helperFn.apply(null,args)),void StageLayoutUtil.save("helper",helper,input)):console.warn(`No helper function ${helperName} found.`)}text.includes(["</","/>"])?$obj.html(text):$obj.text(text)}},doZ=_=>{"number"==typeof zIndex&&$obj.setZ(zIndex)};if(doType(),doCSS(),doBG(),doSize(),doAttributes(),doTransform(),doText(),doResize(),doZ(),input.onUpdate=key=>{switch(key){case"name":group.setLabel(input.get("name"));break;case"type":type=input.get("type"),doType(!0);break;case"css":css=input.get("css"),doCSS(!0);break;case"size":size=input.get("size"),doSize(!0);break;case"attributes":attributes=input.get("attributes"),doAttributes(!0);break;case"transform":transform=input.get("transform"),doTransform(!0);break;case"onResize":resizeCode=input.get("onResize"),doResize();break;case"text":case"fontStyle":text=input.get("text"),doText(!0);break;case"bg":bg=input.get("bg"),doBG(!0);break;case"zIndex":zIndex=input.getNumber("zIndex")||0,doZ()}},customClass){let Class=window[customClass];if(customClass.includes(".")){let split=customClass.split(".");Class=window[split[0]]&&window[split[0]][split[1]]}if(!Class)return console.warn(`No custom class ${customClass} found.`);_layers[name]=_this.initClass(Class,$obj,_options.data,input,group)}return"number"!=typeof index&&_dataStore.setValue("data",JSON.stringify(_data)),$obj}function resizeHandler(){_resize.forEach((({$obj:$obj,fn:fn})=>fn($obj)))}function sortChild(label,index=0,parent,baseZ,step){let folder=_folders[label.id||label];if(!folder||!folder.params)return;let zIndex=0;zIndex=GLUI&&baseZ!=_this.baseZ?baseZ+(index+1)*step:baseZ+index,folder.params.setValue("zIndex",zIndex),label.children&&label.children.forEach((function(child,j,all){sortChild(child,j,all,zIndex,step/(parent.length+1))}))}function copyFolderProps(from,to){let params;to.forEachFolder((child=>{switch(child.label){case"Parameters":params=child}}));let allowed=["Parameters"];from.forEachFolder((child=>{if(!(allowed.indexOf(child.label)<0))switch(child.toClipboard(),child.label){case"Parameters":params.fromClipboard()}}))}this.isStageLayout=!0,this.name=_name,this.layers=_layers,_options.layerHooks&&(_this.layerHooks=_options.layerHooks),_this.onResize(resizeHandler),initParams(),initGraph(),initData(),defer((()=>{initRoot()})),this._createLayer=function(parentId){return createLayer(null,parentId)},this._createGroup=function(parentId){return createLayer(null,parentId)},this._rename=function(id,name,value){if(name==value)return;let folder=_folders[id]||_folders[`stl_${_name}_${name}`];folder&&(folder.setLabel(value),folder.params&&folder.params.setValue("name",value),Object.values(_layers).filter((layer=>layer._uil.params.get("group")==name)).forEach((layer=>layer._uil.params.setValue("group",value))),[_exists,_layers].forEach((function(store){store[name]&&(store[value]=store[name],store[name]=null,delete store[name])})))},this._deleteLayer=function(id,name){let $obj=_layers[name];if(!$obj)return!1;if($obj.div&&$obj.div.children.length)return alert("Can't delete a group that has nested layers."),!1;if(!confirm("Are you sure you want to delete this layer?"))return;let folder=_folders[id];return _uil.remove(folder),($obj.element||$obj).remove(),UILStorage.set(`${id}_deleted`,!0),!0},this._changeParent=function(childId,childName,parentId,parentName){let child=_layers[childId]||_layers[childName],parent=_layers[parentId]||_layers[parentName]||_this;if(!child)return;child=child.element||child,parent==_this&&(parent=_this.element);let folder=_folders[childId]||_folders[`sl_${_name}_${childName}`];folder&&folder.params&&folder.params.setValue("group",parentName||null),("function"==typeof child.parent?child.parent():child.parent).removeChild(child,!0),parent.add(child)},this._visible=function(name,visible){let $obj=_layers[name];$obj&&$obj.css&&(visible?$obj.css({opacity:1}):$obj.css({opacity:0}))},this._focus=function(name){UIL.sidebar.toolbar.filterSingle(name)},this._blur=function(name){let folder=_folders[name];folder&&folder.forEachFolder&&(folder.forEachFolder((f=>f.close())),folder.close())},this._sort=function(order){order.forEach((function(item,i,all){sortChild(item,i,all,_this.baseZ,1)}))},this._duplicateLayer=function(id,parentId){let folder=_folders[id];if(!folder)return;createLayer(null,parentId);let copy=Object.values(_folders).last();copyFolderProps(folder,copy),parentId&&copy.params.setValue("group",parentId)},this._duplicateGroup=function(id,children,parentId){_this._duplicateLayer(id,parentId);let pid=_data.layers;children.forEach((childId=>{_this._duplicateGroup(childId,_graph.listChildren(childId),pid)}))},this._getFigmaConfig=async function(){let _figmaConfig=_config.get("Figma Config").replace(".json","");return await get(Assets.getPath(`assets/data/${_figmaConfig}.json`))},this._applyFigmaConfig=function(id,params,$obj){if("TEXT"===params.type){$obj._input.setValue("text",params.characters);let figmaConfig,lineHeight,fontStyle="",align=params.textAlignHorizontal.toLowerCase(),fontName=StageLayout.FIGMA_FONT.DEFAULT,fontScale=1,ptToPixel=.75,family=StageLayout.FIGMA_FONT[params.fontName.family];if(family){let font=family[params.fontName.style.toLowerCase()];font&&(fontName=font.name,Stage.FIGMA_FONT_CONFIG&&Stage.FIGMA_FONT_CONFIG[fontName]&&(figmaConfig=Stage.FIGMA_FONT_CONFIG[fontName]),font.scale&&(fontScale=font.scale),figmaConfig&&figmaConfig.fontScale&&figmaConfig.fontScale>.1&&(fontScale=figmaConfig.fontScale))}fontName&&(fontStyle+=`font: ${fontName}\n`),fontStyle+=`size: ${params.fontSize*ptToPixel*fontScale}\n`,fontStyle+=`align: ${align}\n`,"PERCENT"===params.letterSpacing.unit&&params.letterSpacing.value&&(fontStyle+=`letterSpacing: ${params.letterSpacing.value/100*fontScale}\n`),figmaConfig&&figmaConfig.lineHeight&&(lineHeight=figmaConfig.lineHeight),"PERCENT"===params.lineHeight.unit&&params.lineHeight.value&&(lineHeight*=params.lineHeight.value/100),lineHeight&&(fontStyle+=`lineHeight: ${lineHeight}\n`),fontStyle+=`width: ${params.width}\n`,fontStyle+=`height: ${params.height}\n`;let fill=params.fills[0];if(fill&&fill.color){let c=fill.color;fontStyle+=`color: ${new Color(c.r,c.g,c.b).getHexString()}\n`}$obj._input.setValue("fontStyle",fontStyle);let x=params.x;"center"===align?x+=params.width/2:"right"===align&&(x+=params.width);let transform=`x: ${x}\ny: ${params.y}`;params.rotation&&(transform+=`\nrotation: ${params.rotation}`),$obj._input.setValue("transform",transform)}else if("RECTANGLE"===params.type){$obj._input.setValue("size",`${params.width}, ${params.height}`);let fill=params.fills[0];if(!fill)return;if("IMAGE"===fill.type)$obj._input.setValue("bg","assets/images/_scenelayout/uv.jpg");else if("SOLID"===fill.type){let c=fill.color,color=new Color(c.r,c.g,c.b);$obj._input.setValue("bg",color.getHexString())}let transform=`x: ${params.x}\ny: ${params.y}`;params.rotation&&(transform+=`\nrotation: ${params.rotation}`),$obj._input.setValue("transform",transform)}},this.getLayer=async function(name){let timer;Hydra.LOCAL&&(timer=_this.delayedCall((_=>{_exists[name]||"mockup"===name||console.warn(`${name} doesn't exist in StageLayout ${_name}`)}),1e3));for(let key in _layers){let layer=_layers[key];if(layer._uil){let uil=layer._uil;if(uil.id===name||uil.label===name)return timer&&clearTimeout(timer),layer}}return await _this.wait(_layers,name),timer&&clearTimeout(timer),_layers[name]},this.getLayers=async function(){let array=[];for(let i=0;i<arguments.length;i++)array.push(_this.getLayer(arguments[i]));return Promise.all(array)},this.getAllLayers=async function(){return await this.ready(),_layers},this.ready=this.loadedAllLayers=async function(){await _this.wait(_this,"loaded"),await defer()},this.exists=function(key){return!!_exists[key]},this.get("graph",(_=>_graph)),this.get("config",(_=>_config)),this.get("layerCount",(_=>_data.layers))}),(()=>{StageLayout.FIGMA_FONT={},StageLayout.LAYER_HOOKS=[],StageLayout.helpers={},StageLayout.loadFontConfig=async(path,json)=>{if(!json){path=path||"assets/data/figma-font.json";try{json=await get("assets/data/figma-font.json")}catch(e){return}}Stage.FIGMA_FONT_CONFIG=json.config}})),Class((function StageLayoutCapture(_layout,_w,_h,_rtPool,_strict){Inherit(this,Component);const _this=this;var _rt,_camera,_hitCamera,_interaction,_ray,_needsRender,_rendered,_hitEvt,_usingFingers,$glObj,_scene=new Scene,_mouse=new Vector2,_stage=new Vector2,_v3=new Vector3,_enabled=!0,_width=_w,_height=_h,_cacheHits=[];function loop(){if(!_enabled)return;if(_this.manualRender&&!_needsRender)return;let clearAlpha=World.RENDERER.getClearAlpha(),autoClear=World.RENDERER.autoClear;_this.disableClear&&(World.RENDERER.autoClear=!1);let clearColor=World.RENDERER.getClearColor().getHex();clearColor>0?World.RENDERER.setClearColor(0,0):World.RENDERER.setClearAlpha(0),World.RENDERER.render(_scene,_camera,_rt),clearColor>0?World.RENDERER.setClearColor(clearColor,clearAlpha):World.RENDERER.setClearAlpha(clearAlpha),_this.disableClear&&(World.RENDERER.autoClear=autoClear),_rendered=!0}function noop(){}function hitUpdate(hit){let x=hit.uv.x*_width,y=(1-hit.uv.y)*_height;_usingFingers=hit.usingFinger,_this.isHitting=!0,_mouse.set(x,y),_enabled&&_interaction&&(hit.usingFinger?_interaction.testWithFinger(_mouse,hit.distance):_interaction.testWith(_mouse))}function missUpdate(){_this.isHitting=!1,_mouse.set(9999,9999),_interaction&&(_usingFingers?_interaction.testWithFinger(_mouse,9999):_interaction.testWith(_mouse))}function raycastMove(e){_ray||(_ray=_this.initClass(Raycaster,_hitCamera));let hit,input=Interaction3D.find(_hitCamera).input;if(Array.isArray(input.obj)){_cacheHits.length=0;for(let i=0;i<input.obj.length;i++){let obj=input.obj[i];_v3.set(0,0,-1).applyQuaternion(obj.quaternion);let hit=_ray.checkFromValues($glObj.mesh,obj.position,_v3)[0];hit&&_cacheHits.push(hit)}_cacheHits.sort(((a,b)=>a.distance-b.distance)),hit=_cacheHits[0]}else"2d"==input.type?hit=_ray.checkHit($glObj.mesh,input.position,input.rect||Stage)[0]:(_v3.set(0,0,-1).applyQuaternion(input.quaternion),hit=_ray.checkFromValues($glObj.mesh,input.position,_v3)[0]);_hitEvt||(_hitEvt={normal:new Vector2,tilt:new Vector2,pos:new Vector2}),hit?(_hitEvt.normal.set(hit.uv.x,1-hit.uv.y),_hitEvt.tilt.set(Math.range(_hitEvt.normal.x,0,1,-1,1),Math.range(_hitEvt.normal.y,0,1,-1,1)),_hitEvt.pos.set(_hitEvt.normal.x*_width,_hitEvt.normal.y*_height),_hitEvt.hit=hit,_this.onDragMove&&_this.onDragMove(_hitEvt)):_this.onDragMove&&_this.onDragMove(null)}function flipNeedsRender(){if(_needsRender&&!_rendered)return callAfterAtLeast(flipNeedsRender,1);_needsRender=!1}function callAfterAtLeast(callback,ms){let callAt=Date.now()+ms;callAt>(callback.__intervalExpiry||0)&&(clearTimeout(callback.__interval),callback.__interval=Timer.create(callback,ms),callback.__intervalExpiry=callAt)}function doCheckObjectHit(object,callback){let hit=callback(Interaction3D.find(_hitCamera));if(hit){let x=hit.uv.x*_width,y=(1-hit.uv.y)*_height;return _interaction.checkObjectHit(object,{x:x,y:y})}}this.disableClear=!1,function(){"number"==typeof _layout&&(_strict=_rtPool,_rtPool=_h,_h=_w,_w=_layout,_layout={element:$gl()}),_width=_w,_height=_h,"boolean"==typeof _rtPool&&(_strict=_rtPool,_rtPool=null);let dpr=_strict?1:RenderManager.DPR;_rtPool?_this.rt=_rtPool.nullRT:(_rt=Utils3D.createRT(_width*dpr,_height*dpr,null,Texture.RGBAFormat),_this.rt=_rt),_this.root=_layout.element,_this.root.stageLayoutCapture=_this,_scene.add(_layout.element.group),(_camera=new OrthographicCamera).setViewport(_width,_height),_camera.position.z=1,_camera.position.x=_width/2,_camera.position.y=-_height/2,_scene.disableAutoSort=!0,_stage.set(_width,_height),function findHitCamera(){let p=_this.parent;for(;p;){if(_hitCamera=p.nuke?.camera)return;p=p.parent}_hitCamera=World.CAMERA}(),_interaction=_this.initClass(GLUIStageInteraction2D,_camera,_scene,_stage,!0),_this.startRender(loop,RenderManager.AFTER_LOOPS)}(),this.onVisible=function(){_rtPool&&(_rt=_this.rt=_rtPool.getRT())},this.onInvisible=function(){_rtPool&&_rtPool.putRT(_rt)},this.setSize=function(width,height){_width=width,_height=height,_camera.setViewport(_width,_height),_camera.position.z=1,_camera.position.x=_width/2,_camera.position.y=-_height/2,_stage.set(width,height)},this.render=function(){loop()},this.get("object3d",(()=>$glObj)),this.set("object3d",(gl=>{gl.mesh||(gl={mesh:gl}),($glObj=gl).mesh.onHitUpdate=hitUpdate,$glObj.mesh.onMissUpdate=missUpdate,_hitCamera&&Interaction3D.find(_hitCamera).add($glObj.mesh,noop,noop)})),this.get("camera",(()=>_camera)),this.set("hitCamera",(camera=>{camera!=_hitCamera&&($glObj&&Interaction3D.find(_hitCamera).remove($glObj.mesh),_hitCamera=camera,$glObj&&Interaction3D.find(_hitCamera).add($glObj.mesh,noop,noop),_ray&&(_ray.camera=_hitCamera))})),this.set("enabled",(v=>{_interaction._disabled=!v,_enabled=v})),this.get("enabled",(_=>_enabled)),this.set("mouseEnabled",(v=>{v?(_interaction._disabled=!1,$glObj.mesh.onHitUpdate=hitUpdate,$glObj.mesh.onMissUpdate=missUpdate,_hitCamera&&Interaction3D.find(_hitCamera).add($glObj.mesh,noop,noop)):(_interaction._disabled=!0,$glObj&&(_hitCamera&&Interaction3D.find(_hitCamera).remove($glObj.mesh),delete $glObj.mesh.onHitUpdate,delete $glObj.mesh.onMissUpdate))})),this.set("layout",(layout=>{_layout&&_scene.remove(_layout.element.group),_scene.add(layout.element.group),_layout=layout})),this.get("layout",(_=>_layout)),this.get("scene",(_=>_scene)),this.get("width",(_=>_width)),this.get("height",(_=>_height)),this.onVisible=function(){_rtPool&&(_rt=_this.rt=_rtPool.getRT())},this.onInvisible=function(){_rtPool&&_this.rt!=_rtPool.nullRT&&(_rtPool.putRT(_this.rt),_rt=_this.rt=_rtPool.nullRT)},this.onDestroy=function(){_rtPool?_this.onInvisible():_this.rt.destroy(),$glObj&&(Interaction3D.find(_hitCamera).remove($glObj.mesh),delete $glObj.mesh.onHitUpdate,delete $glObj.mesh.onMissUpdate)},this.bindMove=function(){_this.startRender(raycastMove)},this.unbindMove=function(){_this.stopRender(raycastMove)},this.set("needsRender",(value=>{_needsRender=!0,_rendered=!1,callAfterAtLeast(flipNeedsRender,"number"==typeof value?value:1e3)})),_this.checkObjectHit=function(object,mouse){return doCheckObjectHit(object,(interaction=>interaction.checkObjectHit($glObj.mesh,mouse)))},_this.checkObjectFromValues=function(object,origin,direction){return doCheckObjectHit(object,(interaction=>interaction.checkObjectFromValues($glObj.mesh,origin,direction)))},_this.getObjectHitLocalCoords=function(v,object,mouse){return Interaction3D.find(_hitCamera).getObjectHitLocalCoords(v,$glObj.mesh,mouse),mouse={x:(.5+v.x)*_width,y:(.5-v.y)*_height},_interaction.getObjectHitLocalCoords(v,object.mesh,mouse)}}),(_=>{StageLayoutCapture.createRTPool=function(width,height,strict){let pool=RTPool.instance().clone({format:Texture.RGBAFormat}),dpr=strict?1:RenderManager.DPR;return pool.setSize(width*dpr,height*dpr),pool}})),Class((function StageLayoutUtil(){Inherit(this,Component);var _data;const KEY="stagelayoututil_keys";var _compiled={};async function init(){await UILStorage.ready(),_data=JSON.parse(UILStorage.get(KEY)||"[]"),function compile(){_data.forEach((key=>{_compiled[key]=JSON.parse(UILStorage.get(`INPUT_Config_${key}_compiled`)||"{}");let resizeCode=UILStorage.get(`INPUT_Config_${key}_onResize`);resizeCode&&(_compiled[key].resize=new Function("$this",resizeCode))}))}()}!async function(){await Hydra.ready(),window.Platform&&Platform.isPlatform||init()}(),this.save=function(key,data,input){let compiled=JSON.parse(input.get("compiled")||"{}");compiled[key]=data,input.setValue("compiled",JSON.stringify(compiled))},this.create=function(key){_data.includes(key)||(_data.push(key),UILStorage.set(KEY,JSON.stringify(_data)))},this.getCompiled=function(key){return _compiled[key]},this.reload=function(){return init()}}),"static"),Class((function Text3D(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_fontObject,$text;function initUIL(){(_config=InputUIL.create(_input.prefix+"_text3d",_group)).setLabel("Text3D"),_config.addTextarea("text").addTextarea("fontStyle"),_config.addToggle("anchor2D",!1),_config.addToggle("renderRetina",!1),_config.add("data","hidden"),UIL.sidebar&&(_config.onUpdate=key=>{if("data"!=key){let text=parseData(_config.get("text")),obj=getFontObject();_config.setValue("data",JSON.stringify(obj)),$text&&($text.setText(text,obj),obj.color&&$text.setColor(obj.color)),_this.onUpdate&&_this.onUpdate()}})}function parseData(text){if(!text||!text.includes("$DATA"))return text;for(;text.includes("$DATA");){let code=text.split("$DATA")[1].split(" ")[0].split("\n")[0],line="$DATA"+code;text=text.replace(line,eval(line.replace("$DATA","_this.parent.data")))}return text}function getFontObject(){let font=_config.get("fontStyle")||"",obj={};return font=font.split("\n"),font.forEach((line=>{let key=(line=line.split(":"))[0],val=line[1];val&&(val=val.replace(/ /g,"")),key.length&&(obj[key]=isNaN(Number(val))?val:Number(val),"false"===val&&(obj[key]=!1),"true"===val&&(obj[key]=!0))})),obj}function initText(){if(!(_fontObject=JSON.parse(_config.get("data")||"{}")).size)return;Text3D.FONT_CONFIG&&(_fontObject.config=Text3D.FONT_CONFIG),Text3D.LANG_BREAK&&(_fontObject.langBreak=Text3D.LANG_BREAK),_fontObject.shader||(_fontObject.shader="Text3D");let text=parseData(_config.get("text"));text&&createText(text,_fontObject)}async function overrideLocalize(text,fontObject,cb){if(!text)return;_this.localized=!0,fontObject.text=text,_this.text&&_this.text.destroy&&_this.text.destroy(),_this.text=new Text3D.FallbackText,_this.text.setColor(_fontObject.color),_this.text.onSetText=text=>_this.setText(text);Text3D.createFallbackTexture(text,fontObject).then((texture=>{_this.text.setColor(fontObject.color);let geom=new PlaneGeometry(texture.width,texture.height);for(geom.computeBoundingBox(),"center"!=fontObject.align&&geom.applyMatrix((new Matrix4).makeTranslation(texture.width/2,0,0));_this.group.children.length;)_this.group.remove(_this.group.children[0]);return _this.text.createMesh(geom,texture),_this.add(_this.text.group),_this.text}))}function createText(text,fontObject){if((fontObject.localize||_input.forceLocalize)&&Text3D.missingChars(text,fontObject))return overrideLocalize(text,fontObject);if(($text=$glText(text,null,null,fontObject)).enable3D(_config.get("anchor2D")),_config.get("renderRetina")&&RenderManager.type!==RenderManager.WEBVR){let gluiToRTScene;$text.anchor||($text.anchor=new Group),_this.add($text.anchor);let p=_this.parent;for(;p;)p.glSceneEnabled&&(gluiToRTScene=p),p=p.parent;gluiToRTScene?gluiToRTScene.addGLUI3D($text):GLUI.Scene.add($text)}else _this.add($text.group);$text.text.onCreateShader=shader=>{let shaderName=_input.get("shader");shaderName&&(shader.fragmentShader?.length&&(shader.fragmentShader=shader.fragmentShader.split("void main")[0]+"\n"+Shaders.getShader(shaderName+".fs")),shader.customCompile=shaderName),$text.text3d=_this,window[shaderName]&&(_this.shaderClass=_this.parent.initClass(window[shaderName],$text,shader,_group,_input),ShaderUIL.add(shader,_group).setLabel("Shader"))},_this.text=$text;let setText=$text.setText.bind($text);$text.setText=function(text,obj){if(obj)for(let key in obj)_fontObject[key]=obj[key];_fontObject.text=text,setText(text,_fontObject),_this.events.fire(Events.UPDATE),defer(setUniforms)},$text.loaded().then((_=>{$text&&(_this.shader=$text.mesh.shader,_this.shader.addUniforms({uTransition:{value:1,ignoreUIL:!0},uOpacity:{value:1,ignoreUIL:!0},uTranslate:{value:_this.translate},uRotate:{value:_this.rotate},uWordCount:{value:0,ignoreUIL:!0},uLetterCount:{value:0,ignoreUIL:!0},uLineCount:{value:0,ignoreUIL:!0},uByWord:{value:0,ignoreUIL:!0},uByLine:{value:0,ignoreUIL:!0},uPadding:{value:.3,ignoreUIL:!0},uBoundingMin:{value:(new Vector3).copy($text.dimensions.min),ignoreUIL:!0},uBoundingMax:{value:(new Vector3).copy($text.dimensions.max),ignoreUIL:!0}}),Text3D.onCreateShader&&Text3D.onCreateShader(_this.shader))})),setUniforms()}async function setUniforms(){if(await _this.wait(_this,"shader"),await $text.loaded(),_input&&_input.get){let depthWrite=_input.get("depthWrite"),depthTest=_input.get("depthTest");"boolean"==typeof depthWrite&&($text.mesh.shader.depthWrite=depthWrite),"boolean"==typeof depthTest&&($text.mesh.shader.depthTest=depthTest);let blending=_input.get("blending");blending&&($text.mesh.shader.blending=blending)}_this.shader.set("uWordCount",$text.mesh.geometry.wordCount),_this.shader.set("uLetterCount",$text.mesh.geometry.letterCount),_this.shader.set("uLineCount",$text.mesh.geometry.lineCount),_this.shader.set("uBoundingMin",(new Vector3).copy($text.dimensions.min)),_this.shader.set("uBoundingMax",(new Vector3).copy($text.dimensions.max))}this.translate=new Vector3,this.rotate=new Vector3,_this.wildcard=_input.get("wildcard"),async function(){_this.group.text=_this,initUIL(),initText(),Text3D.onCreate&&Text3D.onCreate(_this)}(),this.get("fontObject",(_=>_fontObject)),this.setProperties=function(obj=_fontObject){return $text?($text.setText(obj.text,obj),setUniforms()):createText(obj.text,obj),_this.text.loaded()},this.setPropertiesCheck=function(obj,force){let applyProperties=!1;for(const key in obj)_fontObject[key]!==obj[key]&&(applyProperties=!0,_fontObject[key]=obj[key]);return applyProperties||force?_this.setProperties():Promise.resolve()},this.setText=function(text){if(_fontObject.text=text,$text){if(_fontObject.localize&&Text3D.missingChars(text,_fontObject))return _this.group.remove($text.group),_this.shader=void 0,$text=null,void createText(text,_fontObject);$text.setText(text),setUniforms(),$text.mesh&&($text.mesh.onBeforeRender(),$text.mesh.updateMatrixWorld(!0))}else createText(text,_fontObject)},this.setColor=function(color){_fontObject.color=color,_this.text&&_this.text.setColor(color)},this.set("animateByWord",(async bool=>{_this.localized||(await _this.wait(_this,"shader"),_this.shader.set("uByWord",bool?1:0))})),this.set("animateByLine",(async bool=>{_this.localized||(await _this.wait(_this,"shader"),_this.shader.set("uByLine",bool?1:0))})),this.set("animationPadding",(async p=>{_this.localized||(await _this.wait(_this,"shader"),_this.shader.set("uPadding",p))})),this.set("transition",(async v=>{if(_this.localized)return _this.text.alpha=v;await _this.wait(_this,"shader"),_this.shader.set("uTransition",v)})),this.tween=async function(val,time,ease,delay){return _this.localized?_this.text.tween(val,time,ease,delay):(await _this.wait(_this,"shader"),_this.shader.tween("uTransition",val,time,ease,delay))},this.upload=function(){$text&&$text.upload()},this.ready=function(){return _this.wait(_this,"shader")},this.set("renderOrder",(v=>{$text&&$text.setZ(v)})),this.getDimensions=async _=>(await $text.loaded(),await $text.text.ready(),$text.dimensions)}),(_=>{var _projection;Text3D.missingChars=function(){return!1},Text3D.measureScreen=async function($text,camera=World.CAMERA,z=0){_projection||(_projection=new ScreenProjection(World.CAMERA)),$text instanceof Text3D&&($text=$text.text),await $text.loaded(),$text.mesh.onBeforeRender(),$text.mesh.updateMatrixWorld(!0),await defer(),_projection.camera=camera;let bb=new Box3;bb.setFromObject($text.mesh),bb.min.z=bb.max.z=z;let min=_projection.project(bb.min).clone(),max=_projection.project(bb.max).clone();return{width:Math.abs(min.x-max.x),height:Math.abs(min.y-max.y)}}})),Class((function TimelineCameraLink(_input,_group){Inherit(this,Object3D);const _this=this;var _nullObject,_link,_config;function loop(){_this.group.position.lerp(_nullObject.position,_this.lerp),_this.group.quaternion.slerp(_nullObject.quaternion,_this.lerp)}this.isCameraLink=!0,this.lerp=.07,_input instanceof InputUILConfig||(_config=_input,_group=_input=void 0),function(){if(!_config&&!_input)throw"TimelineCameraLink requires a config";if(_config){if(!_config.prefix||!_config.layoutName||!_config.layerName)throw"TimelineCameraLink requires config.prefix, config.layoutName, config.layerName";_config.group||console.warn("Pass in a UIL folder as config.group to organize your cameras")}!function initCamera(){_nullObject=new Group,_config?(_this.gazeCamera=_this.initClass(GazeCamera),_this.gazeCamera.prefix=_config.prefix,CameraUIL.add(_this.gazeCamera,_config.group).setLabel("Camera")):_this.gazeCamera=_this.initClass(GazeCamera,_input,_group);_this.group.add(_this.gazeCamera.group)}(),function initLink(){(_link=_this.initClass(TimelineObjectLink,_nullObject,_config?_config.layoutName:_this.parent.name,_config?_config.layerName:_input.get("name"))).lerp=null;let first=!1;_link.onFrame=_=>{first||(first=!0,_this.group.position.copy(_nullObject.position),_this.group.quaternion.copy(_nullObject.quaternion))}}(),function initConfig(){let config=InputUIL.create((_config?_config.prefix:_input.prefix)+"camera_link",_group||_config?.group);config.setLabel("Camera Config"),config.add("lerp",.07),config.onUpdate=_=>{_this.lerp=config.getNumber("lerp")},config.onUpdate()}(),_this.startRender(loop)}()})),Class((function TimelineLayoutLink(_layout,_shaderMap={},_properties=[]){Inherit(this,Object3D);const _this=this;var _layers={};const STANDARD=["position","rotation","scale"],DEBUG=Hydra.LOCAL;this.lerp=1;var _v2=new Vector2,_v3=new Vector3,_v4=new Vector4,_color=new Color;function onMessage({layers:layers,force:force}){if(!_this.group.determineVisible()&&!force)return!1;_this.lerp=TimelineOSC.lerp;for(let i=0;i<layers.length;i++){let e=layers[i];if(!e.scene.includes(_layout.name))continue;let layer=_layers[e.layer],scene=e.scene;if(layer||(scene=e.scene.replace(_layout.name+"_",""),layer=_layers[scene]),layer)if("i"!=e.type){if(_properties.includes(e.param))layer[e.param]=e.value;else if(!layer.isCameraLink)if(e.param.includes(STANDARD)){let mesh=layer[e.param];if(!mesh&&layer.group&&(mesh=layer.group[e.param]),!mesh){DEBUG&&console.warn(`${_layout.name}::${e.layer} doesn't have param ${e.param}`);continue}1==_this.lerp?(mesh.fromArray(e.value),"position"!=e.param&&"rotation"!=e.param||(mesh.z*=-1)):(_v3.fromArray(e.value),"position"!=e.param&&"rotation"!=e.param||(_v3.z*=-1),mesh.lerp(_v3,_this.lerp,!1))}else{let shader;if(shader="shader"==e.layer?layer.shader:_shaderMap[e.scene.replace(_layout.name+"_","")+"_"+e.layer],!shader){DEBUG&&console.warn(`No shader found for ${scene} :: ${e.layer}`);continue}if(!shader.uniforms){DEBUG&&console.warn(`No uniforms found on shader object ${scene} :: ${e.layer}`);continue}let uniform=shader.uniforms[e.param];if(uniform){switch(e.type){case"f":if("number"!=typeof uniform.value){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got float but not a float`);continue}1==_this.lerp?uniform.value=e.value:uniform.value=Math.lerp(e.value,uniform.value,_this.lerp,!1);break;case"v2":case"v3":case"v4":if(!uniform.value.fromArray){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got vector but not a vector`);continue}if(1==_this.lerp)uniform.value.fromArray(e.value);else{let v="v2"==e.type?_v2:"v3"==e.type?_v3:_v4;v.fromArray(e.value),uniform.value.lerp(v,_this.lerp,!1)}break;case"c":if(!uniform.value.setStyle){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got color but not a color`);continue}1==_this.lerp?uniform.value.setStyle(e.value):(_color.setStyle(e.value),uniform.value.lerp(_color,_this.lerp,!1))}shader.ubo&&(shader.ubo.needsUpdate=!0)}else console.warn(`No uniform found for ${scene} ${e.layer} :: ${e.param}`)}}else{let lastVal=layer[e.param];layer[e.param]=!!e.value,layer[e.param]!=lastVal&&_this.events.fire(TimelineLayoutLink.TOGGLE,{param:e.param,layer:layer,value:!!e.value})}}}!async function(){Array.isArray(_shaderMap)&&(_properties=_shaderMap,_shaderMap={}),_layers=_layout.layers,function addListeners(){_this.events.sub(TimelineOSC,Events.UPDATE,onMessage)}()}(),this.get("shaderMap",(_=>_shaderMap))}),(_=>{TimelineLayoutLink.TOGGLE="timeline_layout_link_toggle"})),Class((function TimelineOSC(){Inherit(this,Component);const _this=this;var _socket,_playing={},_data={},_store=[],_evt={layers:_store};function flush(){_store.length>0&&_this.events.fire(Events.UPDATE,_evt),_store.length=0}function socketUpdate(e){_store.push(e)}function playbackUpdate({array:array}){array.forEach(socketUpdate)}this.data=_data,this.lerp=1,async function(){await Hydra.ready(),Utils.query("osc")&&function initSocket(){_socket=new SocketConnection(`ws://${location.host}:8919`),_this.events.sub(_socket,"update",socketUpdate)}(),_this.startRender(flush)}(),this.test=function(key,type,param,value){let underscore=key.lastIndexOf("_");socketUpdate({scene:key.slice(0,underscore),layer:key.slice(underscore+1),type:type,param:param,value:value})},this.load=async function(name,src){src.includes(".json")||(src+=".json"),_data[name]=await get(Assets.getPath(src))},this.play=function(name,fps){let playback=_this.initClass(TimelineOSCPlayback,_data[name],name,fps);return _this.events.sub(playback,Events.UPDATE,playbackUpdate),_this.events.sub(playback,Events.COMPLETE,(_=>{delete _playing[name],_this.events.fire(Events.COMPLETE,name)})),_playing[name]=playback,playback},this.stop=function(name){_playing[name].stop(),delete _playing[name]},this.setInitialState=async function(name){await _this.wait(_data,name),_this.events.fire(Events.UPDATE,{layers:_data[name][0],force:!0})}}),"static"),Class((function TimelineOSCPlayback(_data,_name,_fps=60){Inherit(this,Component);const _this=this,RATE=_fps,MSRATE=1e3/RATE;var _frame=0,_totalFrames=_data.length,_evt={array:[]},_blurTime=performance.now(),_time=performance.now(),_floatFrame=0,_objectPool=new ObjectPool(Object,200),_arrayPool=new ObjectPool(Array,200),_color=new Color,_color2=new Color;function loop(){let now=performance.now(),delta=now-_time;_time=now,_floatFrame+=delta/MSRATE,Render.REFRESH_RATE<=RATE?_evt.array=_data[Math.round(_floatFrame)]:interpolate(),_frame=Math.round(_floatFrame),_evt.progress=_frame/_totalFrames,_this.events.fire(Events.UPDATE,_evt),_frame>=_totalFrames-1&&(_this.stopRender(loop),_this.events.fire(Events.COMPLETE,{name:_name}),_this.destroy())}function interpolate(){if(_evt.array.length){for(let i=_evt.array.length-1;i>-1;i--){let obj=_evt.array[i];Array.isArray(obj.value)&&(obj.value.length=0,_arrayPool.put(obj.value)),_objectPool.put(obj)}_evt.array.length=0}let currentFrame=Math.floor(_floatFrame),nextFrame=Math.ceil(_floatFrame),fract=Math.fract(_floatFrame),data0=_data[currentFrame],data1=_data[nextFrame];!data0||data0.length<1||data0.forEach((frameData=>{let nextData=function getDataFromNextFrame(obj,data){if(!obj||!data)return;for(let i=data.length-1;i>-1;i--){let obj2=data[i];if(obj.layer==obj2.layer&&obj.param==obj2.param&&obj.type==obj2.type&&obj.scene==obj2.scene)return obj2}}(frameData,data1),obj=_objectPool.get();if(obj.layer=frameData.layer,obj.param=frameData.param,obj.type=frameData.type,obj.scene=frameData.scene,_evt.array.push(obj),nextData)switch(obj.type){case"f":obj.value=frameData.value*(1-fract)+nextData.value*fract;break;case"v2":case"v3":case"v4":obj.value=_arrayPool.get(),function interpolateArray(currentValue,nextValue,fract,output){for(let i=0;i<currentValue.length;i++)output[i]=currentValue[i]*(1-fract)+nextValue[i]*fract}(frameData.value,nextData.value,fract,obj.value);break;case"c":_color.set(frameData.value).lerp(_color2.set(nextData.value),fract),obj.value=_color.getHexString();break;case"i":obj.value=frameData.value}else if(Array.isArray(frameData.value)){obj.value=_arrayPool.get();for(let i=0;i<frameData.value.length;i++)obj.value[i]=frameData.value[i]}else obj.value=frameData.value}))}function focus(e){_this.flag("paused")||_this.flag("seeking")||("blur"==e.type?(_blurTime=performance.now(),_this.stopRender(loop)):(_this.startRender(loop),_time+=performance.now()-_blurTime))}_this.startRender(loop),function addListeners(){_this.events.sub(Events.VISIBILITY,focus)}(),this.seek=function(percent){_floatFrame=Math.min(percent*_totalFrames,_totalFrames-1),interpolate(),_frame=Math.round(_floatFrame),_evt.progress=_frame/_totalFrames,_this.events.fire(Events.UPDATE,_evt),_this.stopRender(loop),_this.flag("seeking",!0)},this.pause=function(){_this.flag("paused")||(_this.stopRender(loop),focus({type:"blur"}),_this.flag("paused",!0))},this.resume=function(){_this.flag("paused")&&(_this.flag("seeking",!1),_this.flag("paused",!1),focus({type:"focus"}))},this.stop=function(){_this.stopRender(loop),_this.destroy()}})),Class((function TimelineObjectLink(_object,_scene,_layer){Inherit(this,Object3D);const _this=this;this.lerp=1;var _v3=new Vector3;const DEBUG=Hydra.LOCAL,STANDARD=["position","rotation","scale"];function onMessage({layers:layers,force:force}){if(!_this.group.determineVisible()&&!force)return!1;null!=_this.lerp&&(_this.lerp=TimelineOSC.lerp||1);for(let i=0;i<layers.length;i++){let e=layers[i];if(e.scene.includes(_scene)&&e.layer==_layer)if("i"!=e.type)if(_object.uniforms){let uniform=_object.uniforms[e.param];if(uniform){switch(e.type){case"f":if("number"!=typeof uniform.value){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got float but not a float`);continue}1==_this.lerp||null==_this.lerp?uniform.value=e.value:uniform.value=Math.lerp(e.value,uniform.value,_this.lerp,!1);break;case"v2":case"v3":case"v4":if(!uniform.value.fromArray){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got vector but not a vector`);continue}if(1==_this.lerp||null==_this.lerp)uniform.value.fromArray(e.value);else{let v="v2"==e.type?_v2:"v3"==e.type?_v3:_v4;v.fromArray(e.value),uniform.value.lerp(v,_this.lerp,!1)}break;case"c":if(!uniform.value.setStyle){DEBUG&&console.warn(`Type mismatch on ${scene} ${e.layer} :: ${e.param} -- got color but not a color`);continue}1==_this.lerp||null==_this.lerp?uniform.value.setStyle(e.value):(_color.setStyle(e.value),uniform.value.lerp(_color,_this.lerp,!1))}_object.ubo&&(_object.ubo.needsUpdate=!0)}}else if(e.param.includes(STANDARD)){let mesh=_object[e.param];if(!mesh){DEBUG&&console.warn(`${_layer}::${e.layer} doesn't have param ${e.param}`);continue}1==_this.lerp||null==_this.lerp?(mesh.fromArray(e.value),"position"!=e.param&&"rotation"!=e.param||(mesh.z*=-1)):(_v3.fromArray(e.value),"position"!=e.param&&"rotation"!=e.param||(_v3.z*=-1),mesh.lerp(_v3,_this.lerp,!1))}else _object[e.param]=e.value;else{let lastVal=_object[e.param];_object[e.param]=!!e.value,_object[e.param]!=lastVal&&_this.events.fire(TimelineLayoutLink.TOGGLE,{param:e.param,layer:_object,value:!!e.value})}}_this.onFrame&&_this.onFrame()}_this.events.sub(TimelineOSC,Events.UPDATE,onMessage)})),Class((function TimelinePlayback(_name){Inherit(this,Component);const _this=this;var _osc,_fps;(async function(){let config=InputUIL.create("TimelinePlayback_"+_name);config.add("json"),config.add("fps",60);let json=config.get("json");if(!json)return;json.includes("()")&&(json=eval(json));let prefix="assets/data/";json.includes("http")&&(prefix=""),await TimelineOSC.load(_name,`${prefix}${json}`),_this.flag("loaded",!0),config.addButton("actions",{label:"Actions",actions:[{title:"Play",callback:_this.play},{title:"Pause",callback:_this.pause}]}),config.addRange("Scrub",0,{min:0,max:1,step:5e-4}),config.onUpdate=key=>{if("Scrub"==key){let value=config.getNumber("Scrub");_this.seek(value)}},_fps=config.get("fps"),"string"==typeof _fps&&_fps.includes("()")&&(_fps=eval(_fps)),_fps=Number(_fps),isFinite(_fps)||(_fps=60)})(),this.play=async function(){let promise=Promise.create();return await _this.ready(),_osc?_osc.resume():(_osc=TimelineOSC.play(_name,_fps),_this.events.sub(_osc,Events.COMPLETE,(_=>{_osc=null,promise.resolve(),_this.events.fire(Events.COMPLETE,_name)})),_this.events.bubble(_osc,Events.UPDATE),_this.osc=_osc),promise},this.kill=async function(){await _this.ready(),_osc&&TimelineOSC.stop(_name)},this.pause=async function(){await _this.ready(),_osc&&_osc.pause()},this.ready=function(){return this.wait("loaded")},this.seek=function(percent){_osc||(_osc=TimelineOSC.play(_name,_fps),_this.events.sub(_osc,Events.COMPLETE,(_=>{_osc=null,_this.events.fire(Events.COMPLETE,{name:_name})})),_osc.pause(),_this.osc=_osc),_osc.seek(percent)}})),Class((function Track(){Inherit(this,Model);const DEBUG=Utils.query("debug");function getAnalyticsType(){return Config.SERVICES?.analytics?"firebase_analytics":window.gtag&&Config.ANALYTICS_ID.includes("UA-")||window.gtag&&Config.ANALYTICS_ID.includes("G-")?"google_analytics_4":window.dataLayer?"google_tag_manager":null}this.page=function(path,title){let data={};switch(data.page_title=title||null,data.page_path=path||null,getAnalyticsType()){case"google_analytics_4":gtag("event","page_view",data);break;case"universal_analytics":gtag("config",Config.ANALYTICS_ID,data);break;case"firebase_analytics":PlatformAnalytics.event("page_view",data);break;case"google_tag_manager":dataLayer.push(data)}DEBUG&&(Config.ANALYTICS_ID||console.warn("Config.ANALYTICS_ID required"),console.log(`>>> Track Page [${getAnalyticsType()}]: `,data))},this.event=function(category,params,label,action,value){let gtag_action,data={};switch(data.event="event",data.event_category=category||null,data.event_action=action||null,data.event_label=label||null,data.value=value||null,data={...data,...params},getAnalyticsType()){case"google_analytics_4":gtag_action=category,action&&(gtag_action+=`_${action}`),label&&(gtag_action+=`_${label}`),gtag("event",gtag_action,data);break;case"universal_analytics":gtag("config",Config.ANALYTICS_ID,data);break;case"firebase_analytics":let props={};label&&(props.label=label),value&&(props.value=value),PlatformAnalytics.event(`${category}_${action}`,props);break;case"google_tag_manager":dataLayer.push(data)}DEBUG&&(gtag_action?console.log(`>>> Track Event: [${getAnalyticsType()}]: `,`action: ${gtag_action}`,data):console.log(`>>> Track Event [${getAnalyticsType()}]: `,gtag_action,data))}}),"Static"),Class((function UIL(){Inherit(this,Component);const _this=this;let _style,$el,_ui={};Hydra.ready((async _=>{if(!Utils.query("editMode")&&!(Hydra.LOCAL&&window.Platform&&window.Platform.isDreamPlatform&&Utils.query("uil"))&&(!Hydra.LOCAL||Device.mobile||window._BUILT_||!Utils.query("uil")&&!Device.detect("hydra")))return function doNotLoad(){Hydra.LOCAL&&Utils.query("remoteUIL")&&(_this.sidebar=_this.global=new UILPanel("null"))}();!function init(){(function initContainer(){$el=$("UIL"),$el.css({position:"fixed",contain:"strict"}).size("100%","100%").mouseEnabled(!1),document.body.insertAdjacentElement("beforeend",$el.div),$el.setZ(1e5)})(),function initStyle(){let initial="\n            .UIL ::-webkit-scrollbar { width:2px; }\n            .UIL ::-webkit-scrollbar-track { background:#161616; }\n            .UIL ::-webkit-scrollbar-thumb { background:#37A1EF; }\n        ",style=document.head.appendChild(document.createElement("style"));style.type="text/css",style.id="uil-style",style.appendChild(document.createTextNode(initial)),_style=style}(),function initSidebar(){_this.add(new UILPanel("sidebar")),_this.add(new UILPanel("global",{side:"left"}))}(),function initGraph(){if(!_this.sidebar)return;let parent=_ui.sidebar.element.div;parent.insertBefore(UILGraph.instance().element.div,parent.firstChild)}()}(),_this.loaded=!0})),this.ready=function(){return _this.wait(_this,"loaded")},this.add=function(panel){return _ui[panel.id]=panel,_this[panel.id]=panel,$el.add(panel),_this},this.remove=function(id){let $panel=_ui[id];return $panel.eliminate&&$panel.eliminate(),$panel.destroy(),delete _ui[id],delete _this[id],_this},this.find=function(id){return Object.values(_ui).reduce(((acc,el)=>acc.concat(el.find(id))),[])},this.enableSorting=function(id,enable){let el=_this.find(id)[0];return el&&el.enableSorting&&el.enableSorting(enable),_this},this.addCSS=function(control,style){if(control.styled)return;let node=document.createTextNode(style);return _style&&_style.appendChild(node),control.styled=!0,_this},this.REORDER="uil_reorder"}),"static"),Class((function CameraUIL(){this.UPDATE="camera_uil_update",this.add=function(light,group){return new CameraUILConfig(light,null===group?null:group||UIL.global)}}),"static"),Class((function CameraUILConfig(_camera,_uil){const _this=this;if(!_camera.prefix)throw"camera.prefix required when using MeshUIL";var prefix="CAMERA_"+_camera.prefix,_group=_uil?createFolder():null,_dynamicFOVCallback=null;function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_camera.prefix,closed:!0});return _uil.add(folder),folder}function initFOV(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera.camera.fov||9999;if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange((e=>{_group&&Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,fov:!0,group:_this}),_camera.setFOV(e),UILStorage.set(`${prefix}${key}`,e)})),_group.add(number)}defer((_=>{_camera.setFOV(initValue)}))}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_camera[key].toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_group&&(Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,vec:!0,group:_this}),_this["tweenUIL_"+key]?.(e)),_camera[key].fromArray(e)})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_camera[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_camera[key].toArray(),!0)}}_camera[key].fromArray(initValue)}function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||(void 0===_camera[key]?9999:_camera[key]);if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onChange((e=>{_camera[key]=e,_group&&Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:e,number:!0,group:_this})})),number.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(number)}_camera[key]=initValue}function initRotation(){let key="rotation",toRadians=array=>array?(array.length=3,array.map((x=>Math.radians(x)))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:(array=initValue,array?(array.length=3,array.map((x=>Math.degrees(x)))):[0,0,0])});vector.onChange((e=>{_group&&Events.emitter._fireEvent(CameraUIL.UPDATE,{prefix:prefix,key:key,val:toRadians(e),rotation:!0,group:_this}),_camera.group[key].fromArray(toRadians(e))})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}var array;_camera.group[key].fromArray(initValue)}function initDynamicFOV(key){let defaultCode="",code=UILStorage.get(`${prefix}${key}Code`)||defaultCode,evalCode=value=>{let method=value.includes("return")?`(function(){ return function getFOV() { ${value}}})()`:`(function(){ return function getFOV() { return ${value}}})()`;_camera._getDynamicFOV=eval(method)},editCode=_=>{let editor=new UILExternalEditor(`${prefix}${key}`,400,900);editor.setCode(code,"c"),editor.onSave=value=>{UILStorage.set(`${prefix}${key}Code`,value),evalCode(value),code=value,_camera.dynamicFOV()}},btn=new UILControlButton("btn",{actions:[{title:"Dynamic FOV",callback:editCode}],hideLabel:!0});_group&&_group.add(btn),defer((_=>{evalCode(code),_camera.dynamicFOV=_=>{let fov=_camera._getDynamicFOV?.()||_camera.camera.fov;if(isNaN(fov))return console.warn(`${prefix} Dynamic FOV requires a float value`);_camera.setFOV(fov)},_camera.onResize((_=>_camera.dynamicFOV()))}))}function addListeners(){Events.emitter._addEvent(CameraUIL.UPDATE,update,_this)}function update(e){e.prefix==prefix&&e.group!=_this&&(e.fov&&_camera.setFOV(e.val),e.number&&(_camera[e.key]=e.val),e.rotation&&_camera.group[e.key].fromArray(e.val),e.vec&&_camera[e.key].fromArray(e.val))}_camera.position&&initVec("position"),_camera.group&&(_camera.groupPos=_camera.group.position,initVec("groupPos"),initRotation()),initFOV("fov"),_camera.moveXY&&(initVec("moveXY"),initVec("lookAt"),initNumber("lerpSpeed"),initNumber("lerpSpeed2"),initNumber("deltaRotate"),initNumber("deltaLerp"),initNumber("wobbleSpeed"),initNumber("wobbleStrength"),initNumber("wobbleZ")),initDynamicFOV("dynamicFOV"),_group&&addListeners(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function InputUIL(){this.UPDATE="inputUil_Update",this.create=function(name,group,decoupled){return new InputUILConfig(name,null===group?null:group||UIL.global,decoupled)}}),"static"),Class((function InputUILConfig(_name,_uil,_decoupled,_slim){var _cache,_this=this;const prefix="INPUT_"+_name;var _group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(_name,{closed:!0});_decoupled||(_uil.add(folder),_uil==UIL.sidebar&&folder.hide());return folder}():null,_fields=_uil?{}:null;function externalUpdate(e){e.prefix==prefix&&e.group!=_this&&(UILStorage.set(`${prefix}_${e.key}`,e.value),_this.onUpdate&&_this.onUpdate(e.key))}_this.group=_group,_uil&&function addListeners(){Events.emitter._addEvent(InputUIL.UPDATE,externalUpdate,_this)}(),this.get=function(key){if(_cache&&void 0!==_cache[key])return _cache[key];let val=UILStorage.get(`${prefix}_${key}`);return"boolean"==typeof val?val:val&&""!=val?"true"===val||"false"!==val&&(val.charAt&&"["==val.charAt(0)?JSON.parse(val):(UIL.global||(_cache||(_cache={}),_cache[key]||(_cache[key]=val)),val)):void 0},this.getFilePath=function(key){let data=this.get(key);return"{"===data?.charAt(0)?(data=JSON.parse(data),data.relative.includes(".")?data.relative:data.src):data},this.getNumber=function(key){return Number(this.get(key))},_slim||(this.add=function(key,initValue,uil=window.UILControlText,options,params={}){if(!_group||"hidden"==initValue||!UIL.sidebar)return this;let value=UILStorage.get(`${prefix}_${key}`);if("true"===value&&(value=!0),"false"===value&&(value=!1),uil==UILControlVector&&"string"==typeof value&&(value=JSON.parse(value)),void 0===value&&(value=initValue),"string"==typeof value&&(uil==UILControlImage||uil==UILControlFile))try{value=JSON.parse(value)}catch(e){}let change=(val,fromInit)=>{val="string"==typeof val?val:JSON.stringify(val),UILStorage.set(`${prefix}_${key}`,val),_this.onUpdate&&_this.onUpdate(key,val),fromInit||Events.emitter._fireEvent(InputUIL.UPDATE,{prefix:prefix,key:key,value:val,group:_this})};"string"!=typeof initValue&&"number"!=typeof initValue&&uil!=UILControlVector||UILStorage.get(`${prefix}_${key}`)||change(initValue,!0);let opts=Utils.mergeObject(params,{label:key,value:value,options:options});uil==window.UILControlButton&&(opts=options);let config=new uil(`${prefix}_${key}`,opts);return config.onFinishChange(change),uil!=UILControlVector&&uil!=UILControlRange||config.onChange(change),_group.add(config),_fields[key]=config,this},this.addToggle=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlCheckbox):this},this.addSelect=function(key,options){return UIL.sidebar?this.add(key,null,UILControlSelect,options):this},this.addImage=function(key,options){return UIL.sidebar?this.add(key,null,UILControlImage,null,options):this},this.addFile=function(key,options){if(!UIL.sidebar)return this;let existing=this.get(key);return existing?.length>3&&!existing.includes("{")?this.add(key):this.add(key,null,UILControlFile,null,options)},this.addRange=function(key,initValue,options){return UIL.sidebar?this.add(key,initValue,UILControlRange,null,options):this},this.addNumber=function(key,initValue,step){return UIL.sidebar?this.add(key,initValue,UILControlNumber,null,{step:step}):this},this.addColor=function(key,initValue=new Color){return UIL.sidebar?this.add(key,initValue.getHexString(),UILControlColor):this},this.addTextarea=function(key,initValue){return UIL.sidebar?this.add(key,initValue,UILControlTextarea,null,{monospace:!0,rows:4}):this},this.addButton=function(key,options){return UIL.sidebar?this.add(key,null,UILControlButton,options):this},this.addVector=function(key,initValue,options){return UIL.sidebar?(options||(options={step:.05}),this.add(key,initValue,UILControlVector,null,options)):this},this.getImage=function(key){let data=this.get(key);if(data)return JSON.parse(data).src},this.setValue=function(key,value){if(UILStorage.set(`${prefix}_${key}`,value),_this.onUpdate&&_this.onUpdate(key),_fields){let field=_fields[key];field&&(field.value=value,field.update&&field.update())}return this},this.copyFrom=function(input,fields){fields.forEach((key=>{let val=input.get(key);void 0!==val&&("string"!=typeof val&&(val=JSON.stringify(val)),_this.setValue(key,val))}))},this.setLabel=function(name){_group&&_group.setLabel(name)},this.getField=function(key){if(_fields)return _fields[key]})})),Class((function ListUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new ListUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new ListUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){},this.getPanel=function(){return _panel}}),"static"),Class((function ListUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function name(){return`LIST_${_id}_config`}function updateConfig(){_config.version=_version,UILStorage.setWrite(name(),_config)}function edit(){let panel=ListUIL.openPanel(_id,_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(ListUIL.OPEN)}_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(name()))?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch(name().split("_config")[0])):(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("LIST_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit List",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(`${_id}_list_items`,JSON.stringify(array))}}),(_=>{ListUIL.OPEN="list_uil_open"})),Class((function ListUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:_name||"List",width:"400px",height:"auto",drag:!0};var _gui,_list,_add,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(`${_id}_list_items`);void 0===data&&(data="[]");_items=JSON.parse(data)}(),(_list=new UILFolder(`${_id}_list`,{hideTitle:!0})).enableSorting(_id),_gui.add(_list);for(let id of _items){let view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}}function initAdd(){!function initButton(title,callback){_add=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0}),_gui.add(_add)}("Add Item",add)}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new ListUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function close(){_this.events.fire(Events.COMPLETE)}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(`${_id}_list_items`,data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),initAdd()}!function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),_this.gui.onClose=close,UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()},this.add=function(){add()}})),Class((function ListUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(`${_id}_folder`,_parent)).setLabel("Item"),_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.listUILItem=_this}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0;_folder.addButton("delete",{actions:actions,hideLabel:hideLabel})}(),this.setLabel=function(label){_folder.setLabel(label)},this.forceSort=function(index){_folder.group.forceSort(index)},this.open=function(){_folder.group.open(),_folder.group.openChildren()},this.close=function(){_folder.group.close()}})),Class((function MeshUIL(){Inherit(this,Component);this.exists={},this.UPDATE="mesh_uil_update",this.add=function(mesh,group){return new MeshUILConfig(mesh,null===group?null:group||UIL.global)}}),"static"),Class((function MeshUILConfig(_mesh,_uil){const _this=this;if(!_mesh.prefix)throw"mesh.prefix required when using MeshUIL";var prefix="MESH_"+_mesh.prefix,_group=_uil&&!MeshUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_mesh.prefix,closed:!0});return _uil.add(folder),folder}():null,_controls=_group?{}:null;function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_mesh[key].toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_mesh[key].fromArray(e),_group&&(Events.emitter._fireEvent(MeshUIL.UPDATE,{prefix:prefix,key:key,val:e,group:_this}),_this["tweenUIL_"+key]?.(e))})),vector.onFinishChange(save),_group.add(vector),_this["forceUpdate"+key.toUpperCase()]=_=>{let val=_mesh[key].toArray();_this["tweenUIL_"+key]?_this["tweenUIL_"+key](val):vector.force(_mesh[key].toArray(),!0)},_controls[key]=vector}_mesh[key].fromArray(initValue)}function save(){for(let key in _controls){let value=_controls[key].value;UILStorage.set(`${prefix}${key}`,value)}}function update(e){e.prefix==prefix&&e.group!=_this&&_mesh[e.key].fromArray(e.val)}this.group=_group,MeshUIL.exists[prefix]=!0,initVec("position"),initVec("scale"),function initRotation(){let key="rotation",toRadians=array=>array?(array.length=3,array.map((x=>Math.radians(x)))):[0,0,0],toDegrees=array=>array?(array.length=3,array.map((x=>Math.degrees(x)))):[0,0,0],initValue=toRadians(UILStorage.get(`${prefix}${key}`));if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:toDegrees(initValue)});vector.onChange((e=>{_mesh[key].fromArray(toRadians(e)),_group&&(Events.emitter._fireEvent(MeshUIL.UPDATE,{prefix:prefix,key:key,val:toRadians(e),group:_this}),_this["tweenUIL_"+key]?.(e))})),vector.onFinishChange(save),_group.add(vector),_controls[key]=vector}_mesh[key].fromArray(initValue);let rotationEuler=(new Euler).fromArray(initValue);_mesh.customRotation=(new Quaternion).setFromEuler(rotationEuler)}(),_group&&function addListeners(){Events.emitter._addEvent(MeshUIL.UPDATE,update,_this)}(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function ShaderUIL(){this.exists={},this.UPDATE="shader_update",this.TEXTURE_UPDATE="shader_texture_update",this.SHADER_UPDATE="shader_shader_update",this.add=function(shader,group){return new ShaderUILConfig(shader.shader||shader,null===group?null:group||UIL.global)},this.createOverride=function(prefix,obj,group,shaderOnly){let uniforms={};Array.isArray(obj)?obj.forEach((o=>{o=o.uniforms||o;for(let key in o)o[key].ignoreUIL||(uniforms[key]=o[key])})):uniforms=obj.uniforms||obj;let shader=Utils3D.getTestShader();shader.vetexShader=shader.fragmentShader="";for(let key in uniforms)shader.uniforms[key]=uniforms[key];return shader.UILPrefix=prefix,null===shaderOnly?shader:this.add(shader,group)},this.createDecorator=function(shader,prefix,obj,group){let uniforms={};for(let key in obj)uniforms[key]=shader.uniforms[key];let nShader=Utils3D.getTestShader();return nShader.vetexShader=shader.fragmentShader="",nShader.uniforms=uniforms,nShader.UILPrefix=prefix,this.add(nShader,group)},this.createClone=function(prefix,obj){let uniforms=obj.uniforms||obj,shader=Utils3D.getTestShader();for(let key in uniforms){let value=uniforms[key].value,ignoreUIL=uniforms[key].ignoreUIL||null===value;!ignoreUIL&&value.clone&&(value=value.clone()),shader.uniforms[key]={value:value,ignoreUIL:ignoreUIL}}return shader.UILPrefix=prefix,shader},this.lerpShader=function(from,to,alpha,hz,uniformsFilter){from=from.uniforms||from,to=to.uniforms||to;for(let key in from){let f=from[key],t=to[key];f&&t&&(uniformsFilter&&-1===uniformsFilter.indexOf(key)||("number"==typeof t.value?f.value=Math.lerp(t.value,f.value,alpha,hz):"c"===f.type?(f.value.r=Math.lerp(t.value.r,f.value.r,alpha,hz),f.value.g=Math.lerp(t.value.g,f.value.g,alpha,hz),f.value.b=Math.lerp(t.value.b,f.value.b,alpha,hz)):"v3"===f.type&&(f.value.x=Math.lerp(t.value.x,f.value.x,alpha,hz),f.value.y=Math.lerp(t.value.y,f.value.y,alpha,hz),f.value.z=Math.lerp(t.value.z,f.value.z,alpha,hz))))}}}),"static"),Class((function ShaderUILConfig(_shader,_uil){var _textures,_this=this;const prefix=_shader.UILPrefix;var _group=_uil&&!ShaderUIL.exists[prefix]?function createFolder(){if(!UIL.sidebar)return null;let label=function getName(){let split=_shader.UILPrefix.split("/");return split.length>2?split[0]+"_"+split[2]:split[0]}();"_"==label.charAt(label.length-1)&&(label=label.slice(0,-1));let folder=new UILFolder(prefix+label,{label:label,closed:!0});return _uil.add(folder),folder}():null;function createVector(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});vector.onChange((val=>{obj.value.fromArray(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0),Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this,vector:!0})})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}obj.value.fromArray(initValue)}function createTexture(obj,key){_group&&!_textures&&(_textures={});const getTexture=obj.getTexture||ShaderUIL.getTexture||Utils3D.getTexture,set=_shader.parent&&_shader.parent.setOverride?_shader.parent.setOverride:_shader.set||_shader.setUniform,get=_shader.get||_shader.getUniform;let prefix=_shader.UILPrefix+"_tx",data=UILStorage.get(`${prefix}_${key}`);data&&(data=JSON.parse(data));let value=data?data.src:null,change=data=>{let val=data.src,cleanPath=val.includes("?")&&!data.hotreload?val.split("?")[0]:val;data.compressed&&(val+="-compressedKtx"),_textures&&(_textures[cleanPath]=change),data.src=cleanPath,UILStorage.set(`${prefix}_${key}`,JSON.stringify(data)),set(key,getTexture(val,{premultiplyAlpha:obj.premultiplyAlpha,scale:obj.scale}),_shader),_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:_shader.UILPrefix,key:key,val:val,texture:get(key,_shader),group:_this})};if(value&&value.length&&change(data),_group){let img=new UILControlImage(prefix+key,{label:key,value:data,description:obj.description});img.onFinishChange(change),_group.add(img)}}function createNumber(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(void 0===initValue&&(initValue=obj.value),_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05,description:obj.description});number.onChange((val=>{_shader.ubo&&(_shader.ubo.needsUpdate=!0),Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this}),obj.value=val})),number.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(number)}obj.value=initValue}function createColor(obj,key){let initValue=UILStorage.get(`${prefix}${key}`)||obj.value.getHexString();if(_group){let color=new UILControlColor(`${prefix}${key}`,{label:key,value:initValue,description:obj.description});color.onChange((val=>{obj.value.set(val),_shader.ubo&&(_shader.ubo.needsUpdate=!0),_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,color:!0,group:_this})})),color.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(color)}initValue&&obj.value.set(initValue)}function createSelect(obj,key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){let{options:options,description:description}=obj,select=new UILControlSelect(`${prefix}${key}`,{label:key,value:initValue,options:options,description:description});select.onChange((val=>{_group&&Events.emitter._fireEvent(ShaderUIL.UPDATE,{prefix:prefix,key:key,val:val,group:_this}),obj.value=val,UILStorage.set(`${prefix}${key}`,val)})),_group.add(select)}initValue&&(obj.value=initValue)}function textureUpdate(e){if(!_textures)return;let cleanPath=e.file.split("?")[0];for(let key in _textures){cleanPath==(key.includes("?")?key.split("?")[0]:key)&&_textures[key]({src:e.file,hotreload:!0})}}function update(e){if(e.prefix==_shader.UILPrefix&&e.group!=_this)if(e.color){let val=e.val,obj=_shader.uniforms[e.key];Array.isArray(val)?obj.value.setRGB(val[0],val[1],val[2]):obj.value.set(val)}else e.texture?"remote"!=e.texture&&_shader.set(e.key,e.texture):e.vector?_shader.uniforms[e.key].value.fromArray(e.val):_shader.uniforms[e.key].value=e.val}this.group=_group,this.shader=_shader,ShaderUIL.exists[_shader.UILPrefix]=!0,function initItems(){for(var key in _shader.uniforms){let obj=_shader.uniforms[key];obj&&!obj.ignoreUIL&&(obj.options&&Array.isArray(obj.options)?createSelect(obj,key):("number"==typeof obj.value&&createNumber(obj,key),obj.value instanceof Color&&createColor(obj,key),(null===obj.value||obj.value instanceof Texture)&&createTexture(obj,key),obj.value instanceof Vector2&&createVector(obj,key),obj.value instanceof Vector3&&createVector(obj,key),obj.value instanceof Vector4&&createVector(obj,key)))}}(),_group&&function addListeners(){Events.emitter._addEvent(ShaderUIL.UPDATE,update,_this),Events.emitter._addEvent(ShaderUIL.TEXTURE_UPDATE,textureUpdate,_this)}(),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function ShadowUIL(){this.add=function(light,group){return new ShadowUILConfig(light,null===group?null:group||UIL.global)}}),"static"),Class((function ShadowUILConfig(_light,_uil){if(!_light.prefix)throw"light.prefix required when using MeshUIL";var prefix="SHADOW_"+_light.prefix,_group=_uil?function createFolder(){if(!UIL.sidebar)return null;let folder=new UILFolder(prefix,{label:_light.prefix,closed:!0});return _uil.add(folder),folder}():null;function initNumber(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light.shadow[key];if(_group){let number=new UILControlNumber(`${prefix}${key}`,{label:key,value:initValue,step:.05});number.onFinishChange((e=>{_light.shadow[key]=e,UILStorage.set(`${prefix}${key}`,e)})),_group.add(number)}_light.shadow[key]=initValue}function initVec(key){let initValue=UILStorage.get(`${prefix}${key}`)||_light[key].toArray();if(_group){let vector=new UILControlVector(`${prefix}${key}`,{label:key,value:initValue,step:.05});vector.onChange((e=>{_light[key].fromArray(e),"target"==key&&_light.shadow.camera.lookAt(_light.target)})),vector.onFinishChange((e=>UILStorage.set(`${prefix}${key}`,e))),_group.add(vector)}_light[key].fromArray(initValue)}_light.target=_light.shadow.target,initVec("position"),initVec("target"),initNumber("fov"),initNumber("size"),initNumber("area"),initNumber("near"),initNumber("far"),function initTick(key){let initValue=UILStorage.get(`${prefix}${key}`);if(_group){let tick=new UILControlCheckbox(`${prefix}${key}`,{label:key,value:initValue});tick.onFinishChange((e=>{_light[key]=e,UILStorage.set(`${prefix}${key}`,e)})),_group.add(tick)}_light[key]=initValue}("static"),this.setLabel=function(name){_group&&_group.setLabel(name)}})),Class((function TimelineUIL(){Inherit(this,Component);const _this=this;var _panel,_created={};function removePanel(){_panel&&_panel.destroy&&(_this.events.unsub(_panel,Events.COMPLETE,removePanel),_panel=_panel.destroy())}this.create=function(id,version=1,group){"number"!=typeof version&&(group=version,version=1),group=null===group?null:group||UIL.global;let config=new TimelineUILConfig(id,version,UIL.global&&!_created[id]);return UIL.global&&(_created[id]||(_created[id]=config,null!=group&&config.appendUILGroup(group||UIL.global))),config},this.openPanel=function(id,name,template){return removePanel(),_panel=new TimelineUILEditor(id,name,template),_this.events.sub(_panel,Events.COMPLETE,removePanel),_panel},this.set=function(){},this.get=function(){}}),"static"),Class((function TimelineUILConfig(_id,_version=1,_store){Inherit(this,Component);const _this=this;var _items,_folder,_config,_template={onSort:_=>{},onAdd:_=>{},onRemove:_=>{}},_name="";function name(){return`TL_${_id}_config`}function updateConfig(){_config.version=_version,UILStorage.setWrite(name(),_config)}function edit(){let panel=TimelineUIL.openPanel(name(),_name,_this.template);_this.events.bubble(panel,Events.UPDATE),_this.events.fire(TimelineUIL.OPEN)}this.model=new TimelineUILModel(name()),_store&&(_items=[]),function initConfig(){(_config=UILStorage.get(name()))?_config.version!=_version&&(updateConfig(),UILStorage.clearMatch(name().split("_config")[0])):(_config={},updateConfig())}(),this.add=function(item){return _items&&_items.push(item),item},this.template=function(config){return"function"==typeof config&&(_template=config),_template},this.appendUILGroup=function(uil){let folder=new UILFolder("TL_"+_id,{closed:!0}),button=new UILControlButton("button",{actions:[{title:"Edit Timeline",callback:edit}],hideLabel:!0});folder.add(button),uil.add(folder),_folder=folder},this.setLabel=function(name){_folder&&_folder.setLabel(name),_name=name},this.onAdd=function(cb){_template.onAdd=cb},this.onRemove=function(cb){_template.onRemove=cb},this.onSort=function(cb){_template.onSort=cb},this.internalAddItems=function(count){if(!count)return;let array=[];for(let i=0;i<count;i++){let id=`${_id}_${Utils.timestamp()}`;array.push(id)}UILStorage.set(`${_id}_list_items`,JSON.stringify(array))}}),(_=>{TimelineUIL.OPEN="list_uil_open"})),Class((function TimelineUILEditor(_id,_name,_template){Inherit(this,Component);const _this=this,PANEL_CONFIG={label:"Timeline Editor",width:"800px",height:"auto",drag:!0};var _gui,_list,_add,_config,_items,_tabs=[],_index=0;function initList(){!function read(){let data=UILStorage.get(`${_id}_list_items`);void 0===data&&(data="[]");_items=JSON.parse(data)}(),_list=new UILFolder(`${_id}_list`,{hideTitle:!0}),_gui.add(_list);for(let id of _items){let view=_this.initClass(TimelineUILItem,id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view)}_config.rails&&function attachRails(){_tabs.forEach(((t,i)=>{t.onUpdate=v=>{_tabs.forEach(((t2,j)=>{t2!=t&&(j<i&&t.getValue()<t2.getValue()&&t2.setValue(t.getValue()),j>i&&t.getValue()>t2.getValue()&&t2.setValue(t.getValue()))}))}}))}()}function initButton(title,callback){let btn=new UILControlButton("button",{actions:[{title:title,callback:callback}],hideLabel:!0});return _gui.add(btn),btn}function spaceEvenly(){_tabs.forEach(((t,i)=>{let perc=Math.range(i,0,_tabs.length-1,0,1);t.setValue(perc)}))}function add(){let id=`${_id}_${Utils.timestamp()}`,view=new TimelineUILItem(id,_list,_template,_index++);_this.events.sub(view,Events.UPDATE,reorder),_this.events.sub(view,Events.END,remove),_tabs.push(view),_items.push(id),write()}function reorder(e){let order=[];for(let item of e.order)order.push(item.split("_folder")[0]);_items=order,_template().onSort(_items),write(),_this.events.fire(Events.UPDATE,{order:order})}function remove(e){_items.remove(e.id),write(),refresh()}function write(){let data=JSON.stringify(_items);UILStorage.set(`${_id}_list_items`,data)}function refresh(){_index=0,_list&&_list.destroy&&(_list=_list.destroy()),_add&&_add.destroy&&(_add=_add.destroy()),initList(),function initAdd(){_config.lock||(_add=initButton("Add Item",add)).element.css({width:"20%"}),initButton("Space Evenly",spaceEvenly).element.css({width:"20%"})}()}_this.config=_config=JSON.parse(UILStorage.get(`${_id}_config`)||"{}"),function initPanel(){_this.gui=_gui=new UILWindow(_id,PANEL_CONFIG),UIL.add(_gui)}(),refresh(),this.onDestroy=function(){_gui.destroy()}})),Class((function TimelineUILItem(_id,_parent,_template,_index){Inherit(this,Component);const _this=this;var _folder;function onDelete(){if(!confirm("You sure you want to delete this?"))return;let id=_id;_template().onRemove(id),_this.events.fire(Events.END,{id:id})}function onReorder(e){_this.events.fire(Events.UPDATE,e)}!async function initFolder(){(_folder=InputUIL.create(`${_id}_folder`,_parent)).setLabel("Item"),_this.parent&&_this.parent.config.lock||_folder.group.draggable(!0),_this.events.sub(_folder.group,UIL.REORDER,onReorder),_folder.group.open()}(),function initTemplate(){let id=_id;(0,_template().onAdd)(id,_folder,_index)}(),function initUI(){_folder.add("label",_this.parent&&_this.parent.config.lock?"hidden":void 0),_folder.addRange("keyframe"),_folder.add("percent","hidden"),_folder.getField("keyframe").force(Math.round(100*_folder.getNumber("percent"))||0),_folder.onUpdate=key=>{if("keyframe"==key){let val=_folder.getNumber(key)/100;_folder.setValue("percent",val),_this.onUpdate&&_this.onUpdate(val)}};let label=_folder.get("label");if(label&&_folder.setLabel(label),!_this.parent||!_this.parent.config.lock){let actions=[{title:"Delete",callback:onDelete}],hideLabel=!0,btn=(_folder.addButton("delete",{actions:actions,hideLabel:hideLabel}),_folder.getField("delete"));btn&&btn.$content.css({width:"20%"})}}(),this.setLabel=function(label){_folder.setLabel(label)},this.getValue=function(value){return _folder.getNumber("percent")},this.setValue=function(value){_folder.setValue("percent",value),_folder.getField("keyframe").force(Math.round(100*value)||0)}})),Class((function TimelineUILModel(_id){var _items,_config,_data=[],_map={};!function initItems(){_config=JSON.parse(UILStorage.get(`${_id}_config`)||"{}"),_items=JSON.parse(UILStorage.get(`${_id}_list_items`)||"[]")}(),function initData(){_items.forEach(((item,i)=>{let input=InputUIL.create(`${item}_folder`,null,null,!!UIL.global),data={};data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0,data.arbitrary=input.get("arbitrary"),_data.push(data),_map[data.label]=data,UIL.global&&Render.start((_=>{data.label=input.get("label")||"Item",data.value=input.getNumber("percent")||0}),10)}))}(),this.setState=function(array){for(let i=0;i<array.length;i++)_items[i]||_items.push(`${_id}_${Utils.timestamp()}`);_items.length>array.length&&(_items=_items.slice(0,array.length)),_items.forEach(((item,i)=>{let data=array[i],input=InputUIL.create(`${item}_folder`,null);input.setValue("label",data.label),data.percent&&input.setValue("percent",data.percent),data.arbitrary&&input.setValue("percent",data.arbitrary)})),UILStorage.set(`${_id}_list_items`,JSON.stringify(_items))},this.lock=function(){return _config.lock||(_config.lock=!0,UIL.global&&UILStorage.set(`${_id}_config`,JSON.stringify(_config))),this},this.rails=function(){return _config.rails||(_config.rails=!0,UIL.global&&UILStorage.set(`${_id}_config`,JSON.stringify(_config))),this},this.getData=function(){return _data},this.get=function(key){return _map[key]}})),Class((function TweenUIL(){var _folders={},_activeFolder="Tweens",_cache={};this.TOGGLE="tweenuil_toggle",this.create=function(name,config,group){"boolean"==typeof group&&(group=void 0);let noCache=!1;"nocache"==group&&(noCache=!0,group=void 0);let folderName=_activeFolder;return"string"==typeof group&&(folderName=group,group=null),_folders[folderName]||function initFolder(){if(UIL.global){let folder=new UILFolder(_activeFolder,{label:_activeFolder,closed:!0});_folders[_activeFolder]=folder,UIL.global.add(folder)}}(),_cache[name]&&!noCache||(_cache[name]=new TweenUILConfig(name,config,group||_folders[folderName])),_cache[name]},this.setFolder=function(name){_activeFolder=name}}),"static"),Class((function TweenUILAnchor(){Inherit(this,Object3D);this.isTweenAnchor=!0})),Class((function TweenUILConfig(_name,_config,_group){Inherit(this,Component);const _this=this;var _input,_editor,_promise,_project,_meshes,_keyframes,_flatMap={},_sheets={},_duration=0;function findTrueDuration(sequence){let duration=0,tracks=sequence.tracksByObject;for(let k1 in tracks){let obj=tracks[k1];"tween_anchor"==k1&&findAnchorKeyframes(obj);for(let k2 in obj.trackData){let trackData=obj.trackData[k2];for(let k3 in trackData.keyframes){let keyframe=trackData.keyframes[k3];keyframe.position&&(duration=Math.max(duration,keyframe.position))}}}return duration}function findAnchorKeyframes(obj){for(let k1 in obj)for(let k2 in obj[k1]){let keyframes=obj[k1][k2].keyframes;keyframes&&(_keyframes=keyframes)}}async function play(options){if(_config.sheets||(await prepareConfig(),linkLocally()),0===_duration)for(let key in _sheets)_duration=Math.max(_duration,_sheets[key].length);for(let key in _sheets)_sheets[key].sequence.position="reverse"===options?.direction?_duration:0,_sheets[key].sequence.play(options);return _promise=_this.wait(1e3*_duration)}function linkLocally(){makeSendable().sheets.forEach((obj=>{let layoutName=Object.keys(obj)[0].split("&")[0];const sheet=_sheets[layoutName];for(let key in obj){let name=key.split("&");name.shift(),name=name.join("_");for(let key2 in obj[key]){let finalObj=obj[key][key2];for(let key3 in finalObj)finalObj[key3]=finalObj[key3]}sheet.object(name,obj[key]).onValuesChange((newValue=>{completeDataLink(newValue,_flatMap[key])}))}}))}async function prepareConfig(){let array=Array.isArray(_config)?_config:[_config];(_config={}).nudgeMultiplier=.05,_config.sheets=[];for(let i=0;i<array.length;i++){let layoutName,objects=array[i],options={};if(objects instanceof SceneLayout)layoutName=objects.name,options.isSceneLayout=!0,objects=await getObjectsFromLayout(objects);else{if("object"!=typeof objects)throw"TweenUIL :: Type not supported";if(0===i){let obj0=objects[Object.keys(objects)[0]];obj0 instanceof Mesh?layoutName="Scene":obj0.uniforms?layoutName="Shader":isElement(obj0)&&(layoutName="Elements")}}layoutName||(layoutName=`Scene${i+1}`),_config.sheets.push(createSheetFromObjects(objects,layoutName,options))}}function getMeshObject(layer,parent,layerName){if(parent?.isTweenAnchor){let obj={};return obj.anchor={anchor:0,link:{copy:e=>{_this.keyframeSection=Math.fract(e.anchor)}}},obj}layer.rotationLink={copy:obj=>{layer.rotation.x=Math.radians(obj.x),layer.rotation.y=Math.radians(obj.y),layer.rotation.z=Math.radians(obj.z)},get x(){return Math.degrees(layer.rotation.x)},get y(){return Math.degrees(layer.rotation.y)},get z(){return Math.degrees(layer.rotation.z)}};let obj={position:{x:layer.position.x,y:layer.position.y,z:layer.position.z,link:layer.position},scale:{x:layer.scale.x,y:layer.scale.y,z:layer.scale.z,link:layer.scale},rotation:{x:Math.degrees(layer.rotation.x),y:Math.degrees(layer.rotation.y),z:Math.degrees(layer.rotation.z),link:layer.rotationLink}};return UIL.global&&(_meshes||(_meshes=[]),layer._uilLayerName=layerName,_meshes.push(layer)),parent?.tweenToggle&&(obj.toggle={on:0,link:{copy:e=>{0==e.on&&parent.flag("tweenToggle")?(parent.flag("tweenToggle",!1),parent.events.fire(TweenUIL.TOGGLE,{on:!1})):1!=e.on||parent.flag("tweenToggle")||(parent.events.fire(TweenUIL.TOGGLE,{on:!0}),parent.flag("tweenToggle",!0))}}}),obj}function getShaderObject(shader){let obj={};for(let key in shader.uniforms){let uniform=shader.uniforms[key],value=uniform.value;void 0===value||uniform.ignoreUIL||"HZ"==key||("number"==typeof value?obj[key]={value:value,link:uniform}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={hex:value.getHexString(),link:value}))}return obj}function isElement(object){return!!object?.div?.hydraObject||void 0!==GLUIObject&&(object instanceof GLUIObject||object instanceof GLUIText)}function getElementObject($element){let obj={_config:{nudgeMultiplier:1}};return void 0!==$element.x&&(obj.x={value:$element.x,link:$element}),void 0!==$element.y&&(obj.y={value:$element.y,link:$element}),void 0!==$element.z&&(obj.z={value:$element.z,link:$element}),void 0!==$element.scale&&(obj.scale={value:$element.scale,link:$element}),void 0!==$element.scaleX&&(obj.scaleX={value:$element.scaleX,link:$element}),void 0!==$element.scaleY&&(obj.scaleY={value:$element.scaleY,link:$element}),void 0!==$element.rotation&&(obj.rotation={value:$element.rotation,link:$element}),void 0!==$element.rotationX&&(obj.rotationX={value:$element.rotationX,link:$element}),void 0!==$element.rotationY&&(obj.rotationY={value:$element.rotationY,link:$element}),void 0!==$element.rotationZ&&(obj.rotationZ={value:$element.rotationZ,link:$element}),void 0!==$element.alpha&&(obj.alpha={value:$element.alpha,link:$element}),obj}function getPlainObject(object){let obj={};for(let key in object){let value=object[key];"number"==typeof value?obj[key]={value:value,link:object}:value instanceof Vector2?obj[key]={x:value.x,y:value.y,link:value}:value instanceof Vector3?obj[key]={x:value.x,y:value.y,z:value.z,link:value}:value instanceof Vector4?obj[key]={x:value.x,y:value.y,z:value.z,w:value.w,link:value}:value instanceof Color&&(obj[key]={hex:value.getHexString(),link:value})}if(Object.keys(obj).length)return obj}async function getObjectsFromLayout(layout){let layers=await layout.getAllLayers(),objects={};for(let key in layers){let layer=layers[key];layer.ready&&await layer.ready(),objects[key]=layer}return objects}function createSheetFromObjects(objects,layoutName,{isSceneLayout:isSceneLayout}){let sheet={};for(let name in objects){let object=objects[name],key=`${layoutName}&${name}`,matched=!1;if(object.uniforms)_flatMap[key]=sheet[key]=getShaderObject(object);else if(isElement(object))_flatMap[key]=sheet[key]=getElementObject(object);else if(object instanceof Mesh&&(_flatMap[key]=sheet[key]=getMeshObject(object,null,key),matched=!0),object.shader&&(_flatMap[`${key}&shader`]=sheet[`${key}&shader`]=getShaderObject(object.shader),matched=!0),object.behavior&&(_flatMap[`${key}&behavior`]=sheet[`${key}&behavior`]=getShaderObject(object.behavior),matched=!0),object.group&&(_flatMap[key]=sheet[key]=getMeshObject(object.group,object,key),matched=!0),!matched&&!isSceneLayout){let obj=getPlainObject(object);obj?_flatMap[key]=sheet[key]=obj:console.warn(`Unclear how to animate object ${key}`,object)}}return sheet}function makeSendable(){const cleanObject=obj=>{let newObj={};for(let key in obj)"link"!=key&&(newObj[key]=obj[key]);return newObj};let obj={sheets:[],nudgeMultiplier:_config.nudgeMultiplier};return obj.filePath=Assets.getPath(`assets/data/timeline-${_name}.json`),obj.filePath.includes("http")||(obj.filePath=Hydra.absolutePath(obj.filePath)),_config.sheets.forEach((sheet=>{let newSheet={};for(let key in sheet){let top=sheet[key];newSheet[key]={};for(let key2 in top)newSheet[key][key2]=cleanObject(top[key2])}obj.sheets.push(newSheet)})),obj}function completeDataLink(dataObj,realObj){let transform;for(let key2 in realObj){if("_config"===key2)continue;let valueObj=dataObj[key2],link=realObj[key2].link;valueObj.hex||(void 0!==valueObj.value?(void 0!==link.value?link.value=valueObj.value:link[key2]=valueObj.value,transform=link.transform,transform&&"alpha"==key2&&link.css("opacity",valueObj.value)):link.copy(valueObj))}transform&&transform()}function linkData(data){for(let key in data){completeDataLink(data[key],_flatMap[key])}}async function openEditor(){_config.sheets||await prepareConfig(),console.log(_config.sheets),(_editor=new UILExternalTimeline(_name,800,1200,makeSendable())).onMessage=linkData,_editor.onSave=_=>{_input.setValue("saved",!0)},_editor.onDestroy=_=>{_editor=null,_meshes?.forEach((mesh=>{mesh._cameraUIL&&(mesh._cameraUIL.tweenUIL_groupPos=null,mesh._cameraUIL.tweenUIL_scale=null,mesh._cameraUIL.tweenUIL_rotation=null),mesh._meshUIL&&(mesh._meshUIL.tweenUIL_scale=null,mesh._meshUIL.tweenUIL_position=null,mesh._meshUIL.tweenUIL_rotation=null)}))},_meshes?.forEach((mesh=>{mesh._cameraUIL?(mesh._cameraUIL.tweenUIL_groupPos=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._cameraUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._cameraUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation")):mesh._meshUIL&&(mesh._meshUIL.tweenUIL_position=value=>_editor.sendUpdate(mesh._uilLayerName,value,"position"),mesh._meshUIL.tweenUIL_scale=value=>_editor.sendUpdate(mesh._uilLayerName,value,"scale"),mesh._meshUIL.tweenUIL_rotation=value=>_editor.sendUpdate(mesh._uilLayerName,value,"rotation"))}))}function updateKeyframeData(){for(let key in _sheets)_this.keyframeTotalProgress=_keyframes.positionObject.position/_sheets[key].length;_this.keyframeIndex=_keyframes.current,_this.keyframeLocalProgress=Math.fract(_keyframes.positionObject.position)}function updateKeyframeLoop(hz){_keyframes.positionObject.position=Math.lerp(_keyframes.positionObject.target,_keyframes.positionObject.position,.07*hz,!1);for(let key in _sheets)_sheets[key].sequence.position=_keyframes.positionObject.position;updateKeyframeData()}!async function(){if((_input=InputUIL.create(_name+"_tween",_group)).setLabel(_name),_input.addButton("edit",{label:"Edit",actions:[{title:"Editor",callback:openEditor}]}),_input.get("saved")){let state=await get(Assets.getPath(`assets/data/timeline-${_name}.json`));_project=Theatre.core.getProject(_name,{state:state}),await _project.ready;for(let key in state.sheetsById)_sheets[key]=_project.sheet(key),_sheets[key].length=findTrueDuration(state.sheetsById[key].sequence);_input.addButton("play",{label:"Play",actions:[{title:"Play",callback:play}]}),_input.addRange("Scrub",0,{min:0,max:1,step:5e-4}),_input.onUpdate=async key=>{if("Scrub"==key){_config.sheets||await play();let value=_input.getNumber("Scrub");_this.seek(value)}}}_this.flag("ready",!0)}(),this.play=async function(options){return await _this.wait("ready"),play(options)},this.seek=function(value){if(_this.flag("ready"))for(let key in _sheets)_sheets[key].sequence.position=_sheets[key].length*value},this.promise=async function(){return await _this.wait("ready"),_promise},this.setLabel=function(label){_input&&_input.setLabel(label)},this.preload=async function(){await _this.wait("ready"),_config.sheets||(await prepareConfig(),linkLocally()),_this.seek(0)},this.seekToKeyframe=async function(index){if(await _this.preload(),!_keyframes)return console.warn("TweenUILConfig :: Missing keyframes! Add tween_anchor layer");_keyframes.current=index,_keyframes.positionObject={position:_keyframes[index].position,target:_keyframes[index].position},_this.seek(_keyframes[index].position),updateKeyframeData(),_this.startRender(updateKeyframeLoop,RenderManager.NATIVE_FRAMERATE)},this.playToKeyframe=async function(index,time,ease="linear",delay){await _this.wait("ready"),_keyframes.positionObject||await _this.seekToKeyframe(0);let nextKeyframe=_keyframes[index],currentKeyframe=_keyframes[_keyframes.current];if(!nextKeyframe)return;let position=nextKeyframe.position;return time||(time=1e3*Math.abs(nextKeyframe.position-currentKeyframe.position)),_keyframes.tween&&(_keyframes.tween=clearTween(_keyframes.tween)),_keyframes.current=index,_this.flag("playingToKeyframe",!0,time+50),_keyframes.tween=tween(_keyframes.positionObject,{target:position},time,ease,delay),_keyframes.tween.promise()},this.peekInKeyframeDirection=function(dir,percent){if(!_keyframes||_this.flag("playingToKeyframe"))return;let currentKeyframe=_keyframes[_keyframes.current],nextKeyframe=_keyframes[_keyframes.current+dir];nextKeyframe&&(_keyframes.positionObject.target=Math.mix(currentKeyframe.position,nextKeyframe.position,percent))},this.playToNextKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current+1,time,ease,delay)},this.playToPrevKeyframe=async function(time,ease,delay){return this.playToKeyframe(_keyframes.current-1,time,ease,delay)},this.playToDirKeyframe=async function(dir,time,ease,delay){return this.playToKeyframe(_keyframes.current+dir,time,ease,delay)},this.get("totalKeyframes",(_=>_keyframes?_keyframes.length:0)),this.get("currentKeyframe",(_=>_keyframes?_keyframes.current:0))})),Class((function UILFile(_offline,_path){Inherit(this,Component);this.load=async function(){let path=window.UIL_STATIC_PATH||"assets/data/uil.json";try{let data=await get(path);return"string"==typeof data?Hydra.LOCAL?null:{}:data}catch(e){return{}}},this.save=async function(sessionData,data){if(Dev.writeFile(window.UIL_STATIC_PATH||"assets/data/uil.json",data),_offline){let partial={};try{partial=await get("assets/data/uil-partial.json",data);for(let key in sessionData)partial[key]=sessionData[key]}catch(e){partial=sessionData}Dev.writeFile("assets/data/uil-partial.json",partial),Storage.set("uil_update_partial",!0)}}})),Class((function UILStorage(){Inherit(this,Component);const _this=this;var _storage,_platform,_fs,_keys,_storeIds=[],_data={},_dataSession={},_id=window.UIL_ID||"default",_remote=window.UIL_REMOTE||!1;window.UIL_ID=_id=_id.replaceAll(/[^a-zA-Z0-9 _-]/g,""),this.SAVE="uil_save";const OFFLINE_FIREBASE=Utils.query("offlineFB");function clearOfflineData(){Storage.set("uil_update_partial",!1),Dev.writeFile("assets/data/uil-partial.json",{})}async function init(){_fs&&_fs.destroy(),_fs=_this.initClass(uilFile()?UILFile:UILRemote,OFFLINE_FIREBASE);let data=await _fs.load();if(null===data){let remoteFs=_this.initClass(UILRemote),remoteData=await remoteFs.load();confirm("Looks like the local uil.json has merge conflicts, do you want to sync from Firebase and resolve it?")?(_data[_id]=remoteData,await write(),window.location.reload()):data={}}if(_data[_id]=data,_this.loaded=!0,!OFFLINE_FIREBASE&&Storage.get("uil_update_partial")&&!uilFile()){if(!confirm("Looks like you have UIL data captured offline, do you want to sync it to Firebase?"))return clearOfflineData();let data=await get("assets/data/uil-partial.json");for(let key in data)_this.set(key,data[key]);write(!0,!0),clearOfflineData()}}async function write(direct,silent){let prevent=!1,e={prevent:_=>prevent=!0};_this.events.fire(_this.SAVE,e),!direct&&(e.wait&&await e.wait(),prevent)||(_fs.save(_dataSession,_data[_id]),_dataSession={},silent||(__body.css({display:"none"}),_this.delayedCall((()=>{__body.css({display:"block"})}),100)))}function uilFile(){return!Utils.query("editMode")&&(!Hydra.LOCAL||!(window.Config&&Config.PLATFORM_CONFIG&&Utils.query("uil"))&&(!!Device.mobile||(!!OFFLINE_FIREBASE||(!!window._BUILT_||(!!window.AURA||(!!window._UIL_FILE_||(!window._FIREBASE_UIL_&&!window.UIL_ID||!Device.detect("hydra")&&!Utils.query("uil"))))))))}Hydra.ready((async _=>{window.Platform&&Platform.isDreamPlatform&&Config.PLATFORM_CONFIG?async function initLocalCached(){_fs=_this.initClass(UILFile),_data[_id]=await _fs.load(),_this.loaded=!0}():Hydra.LOCAL&&window.Platform&&window.Platform.isPlatform||init(),(Utils.query("editMode")||Hydra.LOCAL&&window.Platform&&window.Platform.isDreamPlatform&&Utils.query("uil")||Hydra.LOCAL&&!Device.mobile&&!window._BUILT_&&(Utils.query("uil")||Device.detect("hydra")))&&__window.bind("keydown",(e=>{(e.ctrlKey||e.metaKey)&&83==e.keyCode&&(e.preventDefault(),write())}))})),this.reload=function(id,path,persist){_this.loaded=!1,_platform||(_platform=_id),persist&&_storeIds.push(id),_id=id,window.UIL_ID=id,window.UIL_STATIC_PATH=path,init()},this.set=function(key,value){null===value?(delete _data[_id][key],delete _dataSession[key]):(_data[_id][key]=value,_dataSession[key]=value)},this.setWrite=function(key,value){this.set(key,value),write(!0)},this.clearMatch=function(string){for(let key in _data[_id])key.includes(string)&&delete _data[_id][key];write(!0)},this.write=function(silent){write(!0,silent)},this.get=function(key){let val=_data[_id]&&_data[_id][key];if(void 0===val&&_platform&&(val=_data[_platform][key]),void 0===val&&_storeIds)for(let i=0;i<_storeIds.length;i++)val=_data[_storeIds[i]][key];return val},this.ready=function(){return _this.wait(_this,"loaded")},this.getKeys=function(){return _keys||(_keys=Object.keys(_data[_id])),_keys},this.hasData=function(){return!!_data[_id]},_this.uploadFileToRemoteBucket=async function({file:file,progress:progress}){if(!_remote)return;_storage||(await Services.ready(),_storage=Services.app().storage());let filename=file.name.replace(/ /g,"_");const ref=_storage.ref(`_tmp/${filename}`),path=`https://storage.googleapis.com/${ref.bucket}/uploads/${_id}/${filename}`.toLowerCase(),metadata={customMetadata:{id:_id,path:path,contentType:file.type}},result=ref.put(file,metadata);let exists;for(progress&&result.on("state_changed",(snapshot=>{let _progress=snapshot.bytesTransferred/snapshot.totalBytes*95;progress.css({width:_progress+"%"})}),(error=>{err&&console.log(error),progress.css({width:0})}),(()=>{progress.css({width:0})}));!exists;)try{await fetch(path).then((r=>r.ok))&&(exists=!0)}catch(err){exists=!1}return metadata},this.parse=function(key,hint){let data=_data[_id][key];if(void 0===data)return null;if(Array.isArray(data)){if(hint instanceof Vector2)return{value:(new Vector2).fromArray(data)};if(hint instanceof Vector3)return{value:(new Vector3).fromArray(data)};if(hint instanceof Vector4)return{value:(new Vector4).fromArray(data)}}else if("string"==typeof data&&"#"===data.charAt(0))return{value:new Color(data)};return{value:data}}}),"static"),Class((function UILControl(){Inherit(this,Element);const _this=this;let $this,$label,$content,$view,_value,_previous,_label,_opts,_visible=!0,_onChange=()=>{},_onFinishChange=()=>{};function isEqual(a,b){return Array.isArray(a)||Array.isArray(b)?a+""==b+"":"object"==typeof a||"object"==typeof b?JSON.stringify(a)===JSON.stringify(b):a===b}function clone(value){return Array.isArray(value)?[...value]:"object"==typeof value?Object.assign({},value):value}!function initHTML(){$this=_this.element,$this.size("100%","auto"),$this.css({position:"relative",display:"inline-block",borderBottom:"1px solid #161616",padding:"2px 0",boxSizing:"border-box"}),$this.attr("data-type","UILControl"),$this.div._this=_this}(),function initLabel(){$label=$this.create("label"),$label.size("100px","auto").fontStyle("sans-serif",12,"#9B9C9B"),$label.css({paddingLeft:4,paddingTop:2,boxSizing:"border-box",verticalAlign:"top",float:"left"}),_this.$label=$label}(),function initContent(){$content=$this.create("content"),$content.size("calc(100% - 100px)","auto").css({float:"left"}),_this.$content=$content}(),this.init=function(id,opts={}){_this.id=id,_opts=opts,_value=clone(opts.value),_previous=clone(_value),_this.setLabel(opts.label||id),$this.attr("data-id",id)},this.finish=function(history=!0){_onFinishChange(_value),isEqual(_value,_previous)||(history&&UILHistory.set(_this,_previous),UILLocalStorage.set(_this.id,_value),_previous=clone(_value))},this.force=function(value){_this.value=clone(value),_this.finish(!1)},this.debounce=function(callback,time=250){let interval;return(...args)=>{clearTimeout(interval),interval=setTimeout((()=>{interval=null,callback(...args)}),time)}},this.onChange=function(cb){return _onChange=cb,_this},this.onFinishChange=function(cb){return _onFinishChange=cb,_this},this.get("value",(()=>_value)),this.set("value",(value=>{isEqual(value,_value)||(_value=clone(value),_this.update&&_this.update(_value),_onChange(_value))})),this.get("view",(()=>$view)),this.set("view",(view=>{$view&&$view.destroy(),$view=view,$content.add($view)})),this.hide=function(){return _visible=!1,$this.css({display:"none"}),_this},this.show=function(){return _visible=!0,$this.css({display:"inline-block"}),_this},this.isVisible=function(){return _visible},this.setLabel=function(label){_label=label,_this.label=label,$label.text(label);let title=label;_opts.description&&(title=title+"\n"+_opts.description),$label.attr("title",title)}})),Class((function UILFolder(_id,_opts={drag:!0}){Inherit(this,Element);const _this=this;let $this,$header,$container,$toggle,$drag,$title,_children={},_open=!_opts.closed,_visible=!0,_order=[],_draggable=!1,_sortableChildren=!1,_headerDrag=!1;var _hasClipboard=!1;_this.id=_id,_this.label=`${_opts.label||_id}`,_this.level=-1;function removeDragHandlers(){$this.div.removeEventListener("dragstart",dragStart,!1),$this.div.removeEventListener("dragover",dragOver,!1),$this.div.removeEventListener("drop",drop,!1)}function matchItem(str,item){return UILFuzzySearch.search(str,item.id.toLowerCase())||UILFuzzySearch.search(str,item.label.toLowerCase())}function dragStart(e){if(!UILFolder.DragLock){if(!_headerDrag)return e.preventDefault(),void e.stopPropagation();UILFolder.DragLock=_this.id,e.dataTransfer.setData("text/plain",_this.id),e.dataTransfer.effectAllowed="move",$this.css({opacity:.5})}}function dragOver(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function drop(e){if(!UILFolder.DragLock)return;if(e.dataTransfer.items)for(var i=0;i<e.dataTransfer.items.length;i++)if("file"===e.dataTransfer.items[i].kind)return;e.preventDefault(),_headerDrag=!1;let target=e.currentTarget._this,dragging=_this.parent.get(UILFolder.DragLock);UILFolder.DragLock=null,target&&target.parent&&dragging&&(dragging.element.css({opacity:1}),dragging.parent.get(target.id)&&(e.stopPropagation(),target.parent.container.insertBefore(dragging.element.div,target.element.div),_order=[...target.parent.container.childNodes].map((el=>el._this.id)),_this.events.fire(UIL.REORDER,{order:[..._order]}),function saveSort(){UILStorage.set(`UIL_${UIL.sortKey}_${_this.parent.id}_order`,JSON.stringify(_order))}()))}function getUrlID(){return`${Global.PLAYGROUND||"Global"}_folder_${_id}`}function saveFolderState(){sessionStorage.setItem(getUrlID(),JSON.stringify({open:_open}))}function open(keepClosed=!1){_open=!0,$container.css({display:"flex"}),$toggle&&$toggle.text("▼"),1!=keepClosed&&forEachFolder((f=>f.close())),saveFolderState(),_this.onOpen&&_this.onOpen()}function close(){_open=!1,$container.css({display:"none"}),$toggle&&$toggle.text("▶"),saveFolderState()}function onToggle(e){_open?close():open()}function onMouseDown(e){_headerDrag=!0,$header.div.addEventListener("mouseup",onMouseUp)}function onMouseUp(e){_headerDrag=!1,$header.div.removeEventListener("mouseup",onMouseUp)}function onKeydown(e){13===e.which&&(_open?close():open())}function onKeyup(e){_hasClipboard&&("c"==e.key&&e.metaKey?function onCopy(){UILClipboard.copy(_children)}():"v"==e.key&&e.metaKey&&function onPaste(){UILClipboard.paste(_children)}())}function onFocus(){$this.css({border:"1px solid #37a1ef"}),$this.div.classList.add("active"),_hasClipboard=!0}function onBlur(){$this.css({border:"none",border:"1px solid #161616"}),$this.div.classList.remove("active"),_hasClipboard=!1}function forEachFolder(cb){return Object.values(_children).forEach((el=>{el instanceof UILFolder&&(cb(el),el.forEachFolder(cb))})),_this}!function init(){$this=_this.element,$this.size("100%","auto").bg(_opts.background||"#272727"),$this.css({position:"relative",border:"1px solid #161616",boxSizing:"border-box",maxHeight:_opts.maxHeight||"none"}),$this.attr("data-id",_id),$this.attr("data-type","UILFolder"),$this.div._this=_this}(),function style(){UIL.addCSS(UILFolder,"\n            .UILFolder *:focus { outline: none; }\n            .UILFolder input:focus { border-color:#37a1ef!important; }\n            .UILFolder button:focus { border-color:#37a1ef!important; }\n            .UILFolder .UILFolder .UILFolder .toggle {margin-left:8px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:16px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:24px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:32px; }\n            .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .UILFolder .toggle {margin-left:40px; }\n        ")}(),function initHeader(){_opts.hideTitle||($header=$this.create("title","a"),$header.attr("tabindex","0"),$header.size("100%","auto").bg("#272727"),$header.css({display:"block",padding:"4px 4px",boxSizing:"border-box",fontWeight:"bold",userSelect:"none",borderBottom:"1px solid #161616"}),$header.fontStyle("sans-serif",11,"#B1B1B1"),$header.div.addEventListener("keydown",onKeydown,!1),$header.div.addEventListener("click",onToggle,!1),$header.div.addEventListener("mousedown",onMouseDown),$header.div.addEventListener("focus",onFocus,!1),$header.div.addEventListener("blur",onBlur,!1),$header.div.addEventListener("keydown",onKeyup,!1),$toggle=$header.create("toggle"),$toggle.text(_open?"▼":"▶").css({fontSize:8,display:"inline-block",verticalAlign:"middle"}),$drag=$header.create("drag"),$drag.text("☰").css({position:"absolute",right:7,top:3,display:"inline-block",pointerEvents:"none"}),$drag.hide(),$title=$header.create("title"),$title.text(_this.label).css({display:"inline-block",marginLeft:4}))}(),function initContainer(){$container=$this.create("container"),$container.size("100%","100%").css({display:"flex",flexDirection:"column",position:"relative",overflowY:"auto"}),_open||$container.css({display:"none"}),_this.container=$container.div}(),function restoreFolderState(){let json=JSON.parse(sessionStorage.getItem(getUrlID()));json&&(json.open?open():close())}(),this.add=function(child){return child.draggable&&child.draggable(_sortableChildren),child.parent=_this,_children[child.id]=child,$container.add(child),_this},this.remove=function(x){let id="string"==typeof x?x:x.id,child=_children[id];if(!child)for(let key in _children)if(key.includes(x)){child=_children[key],delete _children[key];break}return child.eliminate&&child.eliminate(),child.destroy(),_order&&(_order=_order.filter((child=>child!==id))),delete _children[id],_this},this.get=function(id){return _children[id]},this.getAll=function(){return Object.values(_children)},this.getVisible=function(){return Object.values(_children).filter((x=>x.isVisible()))},this.find=function(id){return id===_id?_this:Object.values(_children).reduce(((acc,item)=>item.id===id?acc.concat(item):item instanceof UILFolder?acc.concat(item.find(id)):acc),[])},this.filter=function(str){return function filter(str,match=!1){str=str.toLowerCase();let result=[],haystack=Object.values(_children);for(let el of haystack)if(el instanceof UILFolder){let matches=el.filter(str,!0);matches.length?(result.concat(matches),el.show(),el.open()):matchItem(str,el)?(result.push(el),el.show(),el.showChildren(),el.close()):el.getVisible().length?el.show():el.hide()}else matchItem(str,el)?(result.push(el),el.show()):el.hide();return result}(str)},this.filterSingle=function filterSingle(str){str=str.toLowerCase();let haystack=Object.values(_children);for(let el of haystack)el instanceof UILFolder?(el.filterSingle(str),str==el.label.toLowerCase()||str==el.id.toLowerCase()?(el.show(),el.showChildren(),el.open(!0)):el.getVisible().length?el.show():el.hide()):matchItem(str,el)?(el.show(),el.open&&el.open(!0)):el.hide();return[]},this.open=function(keepClosed){return open(keepClosed),_this},this.close=function(){return close(),_this},this.setLabel=function(label){return _this.label=`${label}`,$title.text(label),_this},this.hide=function(){return _visible=!1,$this.css({display:"none"}),_this},this.show=function(){return _visible=!0,$this.css({display:"block"}),_this},this.showChildren=function(){return Object.values(_children).forEach((el=>el instanceof UILFolder?el.showChildren():el.show())),_this.show(),_this},this.isOpen=function(){return _open},this.isVisible=function(){return _visible},this.forEachFolder=function(cb){return forEachFolder(cb)},this.forEachControl=function(cb){return Object.values(_children).forEach((el=>{el instanceof UILFolder?el.forEachControl(cb):cb(el)})),_this},this.enableSorting=function(key){_sortableChildren=!0,UIL.sortKey=key,Object.values(_children).forEach((el=>{el instanceof UILFolder&&el.draggable(!0)}));let order=function getSort(){let sort=UILStorage.get(`UIL_${UIL.sortKey}_${_id}_order`);if(sort)return JSON.parse(sort)}();return order&&(_order=order,function restoreSort(){_order.forEach((id=>{_children[id]&&$container.add(_children[id])}))}()),_this},this.draggable=function(enable){_draggable=enable,$this.attr("draggable",enable),enable?(!function addDragHandlers(){$this.div.addEventListener("dragstart",dragStart,!1),$this.div.addEventListener("dragover",dragOver,!1),$this.div.addEventListener("drop",drop,!1)}(),$drag&&$drag.show()):(removeDragHandlers(),$drag&&$drag.hide())},this.toClipboard=function(){UILClipboard.copy(_children)},this.fromClipboard=function(){UILClipboard.paste(_children)},this.eliminate=function(){_opts.hideTitle||($header.div.removeEventListener("keydown",onToggle,!1),$header.div.removeEventListener("click",onToggle,!1),$header.div.removeEventListener("mousedown",onMouseDown),$header.div.removeEventListener("focus",onFocus,!1),$header.div.removeEventListener("blur",onBlur,!1)),_draggable&&removeDragHandlers()},this.forceSort=function(index){_this.parent.container.insertBefore(_this.element.div,_this.parent.container.children[index]),_order=[..._this.parent.container.childNodes].map((el=>el._this.id)),_this.events.fire(UIL.REORDER,{order:[..._order]})},this.openChildren=function(){Object.values(_children).forEach((el=>el instanceof UILFolder?el.open():null))}})),Class((function UILPanel(_title,_opts={}){Inherit(this,Element);const _this=this;let $this,_folder,_toolbar,_hidden=!1;function onKeydown(e){if(e.ctrlKey||e.metaKey){if(72==e.keyCode&&e.shiftKey){if(`${document.activeElement.type}`.includes(["textarea","input","number"]))return;e.preventDefault(),_hidden?function show(){$this.visible(),_hidden=!1}():function hide(){$this.invisible(),_hidden=!0}()}37==e.keyCode&&e.shiftKey&&(e.preventDefault(),$this.css({left:0,right:"auto"})),39==e.keyCode&&e.shiftKey&&(e.preventDefault(),$this.css({left:"auto",right:0})),67==e.which&&e.shiftKey&&(e.preventDefault(),_folder.forEachFolder((f=>f.close()))),79==e.which&&e.shiftKey&&(e.preventDefault(),_folder.forEachFolder((f=>f.open())))}}function undim(){$this.css({opacity:1})}function dim(){$this.css({opacity:.3})}_this.id=_title,function initHTML(){$this=_this.element,$this.size(_opts.width||"300px",_opts.height||"auto").bg("#161616").mouseEnabled(!0),"left"===_opts.side?$this.css({left:0}):$this.css({right:0}),$this.css({top:0,maxHeight:_opts.maxHeight||"100%",position:"absolute",userSelect:"none",padding:4,overflowY:"auto",borderRadius:4}),$this.hide()}(),function initToolbar(){_toolbar=_this.toolbar=_this.initClass(UILPanelToolbar)}(),function initGroup(){_folder=_this.initClass(UILFolder,_title,{hideTitle:!0,drag:!1,background:"#161616"}),_this.folder=_folder}(),function addHandlers(){document.addEventListener("keydown",onKeydown,!1),_opts.hide&&($this.div.addEventListener("mouseover",undim,!1),$this.div.addEventListener("mouseleave",dim,!1))}(),this.add=function(child){return $this.show(),_folder.add(child),_this},this.remove=function(x){return _folder.remove(x.id),_this},this.get=function(id){return _folder.get(id)},this.find=function(id){return _folder.find(id)},this.filter=function(str){return _folder.filter(str)},this.enableSorting=function(key){return _folder.enableSorting&&_folder.enableSorting(key),_this},this.eliminate=function(){_toolbar.eliminate(),$this.div.removeEventListener("mouseover",undim,!1),$this.div.removeEventListener("mouseleave",dim,!1),document.removeEventListener("keydown",onKeydown,!1)}})),Class((function UILControlButton(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,_buttons=[];!function init(){_this.init(_id,_opts),_opts.hideLabel&&(_this.$label.css({display:"none"}),_this.$content.css({width:"100%"}))}(),function initActions(){$view=$("inputs");let config=[].concat(_opts.actions);_buttons=[].concat(_opts.actions).map((({title:title,callback:callback})=>{let btn=$view.create(`btn btn-${title}`,"button");return btn.text(title).bg("#1d1d1d"),btn.css({width:`calc(100% / ${config.length||1}`,border:"1px solid #2e2e2e",color:"#37a1ef",position:"relative"}),btn.interact((e=>function hover(btn,e){"over"===e.action?btn.css({border:"1px solid #9b9c9b"}):btn.css({border:"1px solid #2e2e2e"})}(btn,e))),btn.click((e=>function click(e,title,callback){_this.value=title,callback&&callback(title,e),_this.finish()}(e,title,callback))),btn})),_this.view=$view}(),this.setTitle=function(text){_buttons.forEach((btn=>{btn.text(text)}))}})),Class((function UILControlCheckbox(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$label,$checkbox,$slider;function toggle(){$checkbox.attr("checked",_this.value),$slider.css({right:_this.value?0:"auto"}),$label.bg(_this.value?"#37a1ef":"#1d1d1d")}function click(){_this.value=!_this.value,toggle(),_this.finish()}function focus(){$label.css({border:"1px solid #37a1ef"})}function blur(){$label.css({border:"1px solid #2e2e2e"})}!function init(){_opts.value=_opts.value||!1,_this.init(_id,_opts)}(),function initView(){$view=$("view"),$label=$view.create("label","label"),$label.size(30,15).css({position:"relative",display:"inline-block",borderRadius:15,border:"1px solid #2e2e2e"}).bg(_this.value?"#37a1ef":"#1d1d1d"),$checkbox=$label.create("checkbox","input"),$checkbox.attr("type","checkbox"),$checkbox.attr("checked",_this.value),$checkbox.css({opacity:0,width:"100%",position:"absolute"}),$slider=$label.create("slider"),$slider.size(15,15).css({borderRadius:15,position:"absolute",right:_this.value?0:"auto",boxSizing:"border-box"}).bg("#ffffff"),_this.view=$view}(),function addHandlers(){$checkbox.div.addEventListener("focus",focus,!1),$checkbox.div.addEventListener("blur",blur,!1),$checkbox.div.addEventListener("click",click,!1),$checkbox.div.addEventListener("keypress",click,!1)}(),this.update=function(){toggle()},this.onDestroy=function(){$checkbox.div.removeEventListener("focus",focus,!1),$checkbox.div.removeEventListener("blur",blur,!1),$checkbox.div.removeEventListener("click",click,!1),$checkbox.div.removeEventListener("keypress",click,!1)}})),Class((function UILControlColor(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $hex,$colorPicker,$hexInput,$colorInput;function syncColorValue(frame,hexUpdate=!1){let needsUpdate=!0;hexUpdate?$hexInput.div.value!==_this.value&&(_this.value=$hexInput.div.value):$colorInput.div.value!==_this.value?_this.value=$colorInput.div.value:needsUpdate=!1,needsUpdate&&($hexInput.div.value=_this.value,$colorInput.div.value=_this.value,$colorPicker.bg(_this.value))}function onClick(){$colorInput.div.click(),$colorInput.div.focus(),_this.startRender(syncColorValue,24)}function onTextFocus(){$hexInput.div.select()}function onColorBlur(){_this.stopRender(syncColorValue),finishChange()}function onChange(v){syncColorValue(0,!0),finishChange()}function finishChange(){_this.finish()}!function init(){_opts.value=_opts.value||"#ffffff",_this.init(_id,_opts)}(),function initInput(){let $view=$("color");$view.css({position:"relative",display:"flex"}),$hex=$view.create("colorHex"),$hex.size("100%","100%"),$hex.css({boxSizing:"border-box",flex:"2",marginRight:4}),$hexInput=$hex.create("hex","input"),$hexInput.size("100%").css({fontSize:12,fontFamily:"sans-serif",padding:1,color:"#37A1EF",border:"1px solid #2E2E2E"}).bg("#1D1D1D"),$hexInput.attr("value",_this.value),$hexInput.attr("maxlength",7),$colorPicker=$view.create("colorPicker"),$colorPicker.size("100%","auto").bg(_this.value),$colorPicker.css({border:"1px solid #2E2E2E",position:"relative",flex:"3"}),$colorInput=$colorPicker.create("colorInput","input"),$colorInput.attr("type","color"),$colorInput.attr("value",_this.value),$colorInput.size(0,0).css({border:0,top:6,zIndex:-1,position:"absolute"}),_this.view=$view}(),function addHandlers(){$colorPicker.interact(null,onClick),finishChange=_this.debounce(finishChange,250),$hexInput.div.addEventListener("input",onChange,!1),$hexInput.div.addEventListener("focus",onTextFocus,!1),$hexInput.div.addEventListener("change",finishChange,!1),$colorInput.div.addEventListener("blur",onColorBlur,!1)}(),this.force=function(value){$hexInput.div.value=value,syncColorValue(0,!0)},this.update=function(){$hexInput.attr("value",_this.value),$colorPicker.bg(_this.value),$colorInput.attr("value",_this.value),finishChange()},this.onDestroy=function(){$hexInput.div.removeEventListener("input",onChange,!1),$hexInput.div.removeEventListener("focus",onTextFocus,!1),$hexInput.div.removeEventListener("change",finishChange,!1),$colorInput.div.removeEventListener("blur",onColorBlur,!1)}})),Class((function UILControlFile(_id,_opts={value:{}}){Inherit(this,UILControl);const _this=this;let $view,$picker,$preview,$img,$input,$$copy,$progress,_value;async function change(e){let file=$picker.div.files[0];if(!file)return;let name=file.name;if(window.UIL_REMOTE){const{customMetadata:customMetadata}=await UILStorage.uploadFileToRemoteBucket({file:file,progress:$progress});name=customMetadata.path}_value.filename=name,_value.relative=function getRelative(){return _value.filename.includes("http")?"":_value.relative.includes(_value.prefix)?_value.relative.replace(`${_value.prefix}`,""):_value.relative}(),_value.src=function getSrc(){return _value.filename.includes("http")?_value.filename:`${_value.prefix?_value.prefix+"/":""}${_value.relative?_value.relative+"/":""}${_value.filename}`}(),await function fileExists(url){return!!url.includes("http")||fetch(Assets.getPath(url)).then((e=>404!=e.status)).catch((e=>console.warn("UILControlFile image url validation failed",e)))}(_value.src)?(_this.value=Object.assign({},_value),$img.attr("title",_value.src),$$copy.text(_value.filename),_this.finish()):($picker.div.value="",console.warn("UIL: Could not find file",_value),alert(`"${_value.src}" not found!\nMake sure "relative path" is correct.`))}function focus(){$img.css({border:"1px solid #37a1ef"})}function blur(){$img.css({border:"1px dotted #2e2e2e"})}function inputChange(){_value.relative=$input.div.value,_value.relative.includes(".")&&(_this.value=Object.assign({},_value),_this.finish())}!function init(){_opts.value=Object.assign({src:"",relative:_opts.relative||"",prefix:_opts.prefix,filename:""},_opts.value),_value=Object.assign({},_opts.value),_this.init(_id,_opts)}(),function initView(){$view=$("view"),$view.css({position:"relative",padding:5}),$input=$view.create("path","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",marginBottom:5}),_this.value.relative?$input.div.value=_this.value.relative:$input.attr("placeholder","Relative Path"),$preview=$view.create("preview"),$preview.size("100%",60),$preview.css({boxSizing:"border-box",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),$img=$preview.create("img"),$img.size("100%"),$img.css({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",border:"1px dotted #2e2e2e",boxSizing:"border-box"}),$picker=$preview.create("picker","input"),$picker.attr("type","file"),$picker.css({opacity:0,position:"absolute",top:0,right:0,bottom:0,left:0}),$progress=$preview.create("progress"),$progress.css({position:"absolute",bottom:0,height:10,left:0,background:"#9B9C9B"}),$$copy=$preview.create("copy"),$$copy.html("Drag file here<br><small>or Click to Select</small>"),$$copy.fontStyle("sans-serif",11,"#9B9C9B").css({textAlign:"center"}),_this.view=$view,_value.src&&($img.attr("title",_value.src),$$copy.text(_value.filename))}(),function addHandlers(){$picker.div.addEventListener("change",change,!1),$picker.div.addEventListener("focus",focus,!1),$picker.div.addEventListener("blur",blur,!1),$input.div.addEventListener("change",inputChange,!1)}(),this.force=function(value){_value=Object.assign({},value),$input.div.value=_value.relative,$img.attr("title",_value.src),$$copy.text(_value.filename)},this.onDestroy=function(){$picker.div.removeEventListener("change",change,!1),$picker.div.removeEventListener("focus",focus,!1),$picker.div.removeEventListener("blur",blur,!1),$input.div.removeEventListener("change",inputChange,!1)}})),Class((function UILControlImage(_id,_opts={value:{}}){Inherit(this,UILControl);const _this=this;let $view,$picker,$preview,$img,$input,$check,$compress,$delete,$progress,_value;async function compressClick(){if(_value.src&&!_this.flag("compressPending")){_this.flag("compressPending",!0),$compress.bg("#f4ee42").text("---");try{"Error"==await Dev.execUILScript("compressktx",{src:_value.src.split("?")[0]})?$compress.bg("#f44141").html("Failed"):$compress.bg("#46f441").html("Success")}catch(e){$compress.bg("#f44141").html("Failed"),console.error(e)}_this.flag("compressPending",!1)}}function checkChange(){_this.value.compressed=_value.compressed=!!$check.div.checked,_this.finish(!1)}async function change(e){let file=$picker.div.files[0];if(!file)return;let name=file.name;if(window.UIL_REMOTE){const{customMetadata:customMetadata}=await UILStorage.uploadFileToRemoteBucket({file:file,progress:$progress});name=customMetadata.path}_value.filename=name,_value.relative=function getRelative(){return _value.filename.includes("http")?"":_value.relative.includes(_value.prefix)?_value.relative.replace(`${_value.prefix}`,""):_value.relative}(),_value.src=function getSrc(){return _value.filename.includes("http")?_value.filename:`${_value.prefix?_value.prefix+"/":""}${_value.relative?_value.relative+"/":""}${_value.filename}`}(),_value.compressed=!!$check.div.checked,await function imageExists(url){return!!url.includes("http")||(url=Assets.getPath(url),fetch(url).then((e=>404!=e.status)).catch((e=>console.warn("UILControlImage image url validation failed",e))))}(_value.src)?(_this.value=Object.assign({},_value),$picker.div.value="",$picker.attr("title",_value.src),$img.css({backgroundImage:`url(${Assets.getPath(_value.src)})`}),$delete.show(),_this.finish()):($picker.div.value="",console.warn("UIL: Could not find image",_value),alert(`"${_value.src}" not found!\nMake sure "relative path" is correct.`))}function deleteImage(){_value={src:"",relative:"",prefix:"assets/images",filename:""},$input.div.value="",$picker.div.value="",$picker.attr("title",null),$img.css({backgroundImage:""}),$delete.hide(),_this.value=Object.assign({},_value),_this.finish()}function focus(){$img.css({border:"1px solid #37a1ef"})}function blur(){$img.css({border:"1px dotted #2e2e2e"})}function inputChange(){_value.relative=$input.div.value}!function init(){_opts.value=Object.assign({src:"",relative:_opts.relative||"",prefix:_opts.prefix||"assets/images",filename:""},_opts.value),_value=Object.assign({},_opts.value),_this.init(_id,_opts)}(),function initView(){$view=$("view"),$view.css({position:"relative",padding:5}),$input=$view.create("path","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",marginBottom:5}),_this.value.relative?$input.div.value=_this.value.relative:$input.attr("placeholder","Relative Path"),$compress=$view.create("compress"),$compress.text("Compress").bg("#fff").css({top:3,width:70,height:15,textAlign:"center",borderRadius:5,position:"relative",float:"left",paddingTop:2}).fontStyle("sans-serif",11,"#000"),$check=$view.create("#compressed","input"),$check.attr("type","checkbox"),$check.size(20,20),$check.css({boxSizing:"border-box",position:"relative"}),$check.div.checked=!!_this.value.compressed;let $label=$view.create("compressed-label","label");$label.attr("for","compressed"),$label.text("Use Compressed").fontStyle("sans-serif",9,"#9B9C9B").css({top:-6,position:"relative"}),$preview=$view.create("preview"),$preview.size("100%",60),$preview.css({boxSizing:"border-box",position:"relative",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),$img=$preview.create("img"),$img.size("100%"),$img.css({position:"absolute",top:0,right:0,bottom:0,left:0,backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",border:"1px dotted #2e2e2e",boxSizing:"border-box"}),$picker=$preview.create("picker","input"),$picker.attr("type","file"),$picker.attr("accept","image/*"),$picker.css({opacity:0,position:"absolute",top:0,right:0,bottom:0,left:0}),$progress=$preview.create("progress"),$progress.css({position:"absolute",bottom:0,height:10,left:0,background:"#9B9C9B"}),$delete=$preview.create("delete","button"),$delete.size(18,18).css({border:"none",padding:0,position:"absolute",top:8,right:8,borderRadius:"50%",background:"#1D1D1D",color:"#9B9C9B",textAlign:"center"}).html('<svg width="10" height="10" viewBox="0 0 10 10" fill="none" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-width="2" stroke-linecap="round" d="M2 2l6 6M2 8l6-6"/></svg>'),$delete.hide();let copy=$preview.create("copy");copy.html("Drag image here<br><small>or Click to Select</small>"),copy.fontStyle("sans-serif",11,"#9B9C9B").css({textAlign:"center"}),_this.value.src&&($img.css({backgroundImage:`url('${Assets.getPath(_this.value.src)}')`}),$picker.attr("title",_this.value.src),$delete.show()),_this.view=$view}(),function addHandlers(){$picker.div.addEventListener("change",change,!1),$picker.div.addEventListener("focus",focus,!1),$picker.div.addEventListener("blur",blur,!1),$input.div.addEventListener("change",inputChange,!1),$delete.div.onclick=deleteImage,$compress.div.onclick=compressClick,$check.div.onchange=checkChange}(),this.force=function(value,isClipboard){_value=Object.assign({},value),!0===isClipboard&&(_this.value=_value),$input.div.value=_value.relative,$picker.div.value="",$picker.attr("title",_value.src),$img.css({backgroundImage:`url('${Assets.getPath(_value.src)}')`}),$check.div.checked=_value.compressed},this.onDestroy=function(){$picker.div.removeEventListener("change",change,!1),$picker.div.removeEventListener("focus",focus,!1),$picker.div.removeEventListener("blur",blur,!1),$input.div.removeEventListener("change",inputChange,!1)}})),Class((function UILControlNumber(_id,_opts={}){Inherit(this,UILControl);const _this=this;let _input;!function init(){_opts.value=_opts.value||0,_this.init(_id,_opts)}(),function initInput(){_input=_this.initClass(UILInputNumber,Object.assign(_opts,{value:_this.value})),_input.onInput((v=>_this.value=v)),_input.onFinish((v=>_this.finish())),_this.view=_input.input}(),this.update=function(value){_input.value=_this.value||0}})),Class((function UILControlRange(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$slider,_max=_opts.max||100,_min=_opts.min||0,_step=_opts.step||1;function change(){_this.finish()}function input(e){_this.value=Number($slider.div.value)}function focus(){$slider.css({border:"1px solid #37a1ef"})}function blur(){$slider.css({border:"1px solid #2e2e2e"})}!function init(){_opts.value=_opts.value||0,_this.init(_id,_opts)}(),function style(){UIL.addCSS(UILControlRange,"\n            .UILControlRange input { -webkit-appearance:none; appearance:none; }\n            .UILControlRange input::-webkit-slider-thumb { -webkit-appearance: none; }\n            .UILControlRange input::-webkit-slider-thumb { \n                -webkit-appearance:none; appearance:none;\n                width:15px; height:15px;\n                background:#FFF;\n                border-radius:15px;\n            }\n            .UILControlRange input::-moz-slider-thumb { \n                -webkit-appearance:none; appearance:none;\n                width:15px; height:15px;\n                background:#FFF;\n                border-radius:15px;\n            }\n        ")}(),function initView(){$view=$("view"),$slider=$view.create("range","input"),$slider.attr("type","range"),$slider.attr("max",_max),$slider.attr("min",_min),$slider.attr("step",_step),$slider.div.value=_this.value,$slider.css({width:"100%",margin:0,padding:0,background:"#1d1d1d",height:4,borderRadius:15,border:"1px solid #2e2e2e",boxSizing:"border-box"}),_this.view=$view}(),function addHandlers(){$slider.div.addEventListener("change",change,!1),$slider.div.addEventListener("input",input,!1),$slider.div.addEventListener("focus",focus,!1),$slider.div.addEventListener("blur",blur,!1)}(),this.force=function(value){_this.value=value,$slider.div.value=value,_this.finish(!1)},this.onDestroy=function(){$slider.div.removeEventListener("change",change,!1),$slider.div.removeEventListener("input",input,!1),$slider.div.removeEventListener("focus",focus,!1),$slider.div.removeEventListener("blur",blur,!1)}})),Class((function UILControlSelect(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,$select,_options;function change(){_this.finish()}function input(){let i=$select.div.selectedIndex;_this.value=_options[i].value}function focus(){$select.css({border:"1px solid #37a1ef"})}function blur(){$select.css({border:"1px solid #2e2e2e"})}!function init(){if(!_opts.options)throw"UILControlSelect is missing select options";_opts.value=_opts.value||_opts.options[0].value,_this.init(_id,_opts)}(),function style(){UIL.addCSS(UILControlSelect,"\n            .UILControlSelect select { -webkit-appearance:none; appearance:none; }\n        ")}(),function initView(){$view=$("view"),$view.css({position:"relative"}),$select=$view.create("dropdown","select"),$select.css({width:"100%",margin:0,padding:0,background:"#1d1d1d",height:15,border:"1px solid #2e2e2e",boxSizing:"border-box",color:"#37a1ef",borderRadius:0,height:17}),$view.create("arrow").text("▼").css({color:"#37a1ef",fontSize:6,position:"absolute",right:8,top:7,pointerEvents:"none"}),_this.view=$view}(),function initOptions(){_options=_opts.options.map((({value:value,label:label})=>{let el=document.createElement("option");return el.setAttribute("value",value),_this.value===value&&el.setAttribute("selected",!0),el.text=label||value,el.value=value,$select.add(el),el})),$select.div.value=_this.value}(),function addHandlers(){$select.div.addEventListener("change",change,!1),$select.div.addEventListener("input",input,!1),$select.div.addEventListener("focus",focus,!1),$select.div.addEventListener("blur",blur,!1)}(),this.force=function(value){$select.div.value=value,_this.value=value},this.onDestroy=function(){$select.div.removeEventListener("change",change,!1),$select.div.removeEventListener("input",input,!1),$select.div.removeEventListener("focus",focus,!1),$select.div.removeEventListener("blur",blur,!1)}})),Class((function UILControlText(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $input,_timeout;function onChange(v){clearTimeout(_timeout),_timeout=setTimeout(onFinishChange,400),_this.value=$input.div.value}function onFinishChange(){null!==_timeout&&(clearTimeout(_timeout),_timeout=null,_this.finish())}_this.init(_id,_opts),function initInput(){$input=$("input","input"),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF"}),_this.value&&($input.div.value=_this.value||""),_this.view=$input}(),function addHandlers(){$input.div.addEventListener("input",onChange,!1),$input.div.addEventListener("change",onFinishChange,!1)}(),this.update=function(){$input.div.value=_this.value||""},this.onDestroy=function(){$input.div.removeEventListener("input",onChange,!1),$input.div.removeEventListener("change",onBlur,!1)}})),Class((function UILControlTextarea(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $input,_timeout;function onChange(v){clearTimeout(_timeout),_timeout=setTimeout(onFinishChange,400),_this.value=$input.div.value}function onFinishChange(){null!==_timeout&&(clearTimeout(_timeout),_timeout=null,_this.finish())}_this.init(_id,_opts),function initInput(){$input=$("input","textarea"),$input.attr("maxlength",_opts.max||1/0),$input.attr("minlength",_opts.min||-1/0),$input.attr("rows",_opts.rows||2),$input.attr("readonly",_opts.readonly||!1),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",resize:_opts.resize||"vertical",minWidth:_opts.minWidth||0,border:"1px solid #2E2E2E",color:"#37A1EF"}),(_opts.monospace||_opts.editor)&&$input.css({fontFamily:"monospace"}),_this.value&&($input.div.value=_this.value||""),_this.view=$input}(),_opts.editor&&function enableTab(){$input.div.onkeydown=function(e){if(9===e.keyCode){let val=this.value,start=this.selectionStart,end=this.selectionEnd;this.value=val.substring(0,start)+"\t"+val.substring(end),this.selectionStart=this.selectionEnd=start+1,e.preventDefault()}}}(),function addHandlers(){$input.div.addEventListener("input",onChange,!1),$input.div.addEventListener("change",onFinishChange,!1)}(),this.update=function(){$input.div.value=_this.value||""},this.onDestroy=function(){$input.div.removeEventListener("input",onChange,!1),$input.div.removeEventListener("change",onBlur,!1)}})),Class((function UILControlVector(_id,_opts={}){Inherit(this,UILControl);const _this=this;let $view,_length,_inputs=[],_vector=[];function onInput(value,index,master){master?_vector=_vector.map((v=>value)):_vector[index]=value,_this.value=[..._vector]}function onFinish(value,index,master){_this.finish()}!function init(){if(_opts.value)_length=_vector.length;else{if(!_opts.components)throw'UILControlVector: Cannot detect vector type. Define "options.components" count or init with a initial value';_opts.value=new Array(_opts.components).fill(0)}_length=_opts.value.length,_this.init(_id,_opts),_vector=[..._this.value]}(),function initInputs(){$view=$("inputs");for(let i=0;i<_length;i++){let input=_this.initClass(UILInputNumber,_opts);input.value=_this.value[i],input.onInput(((v,m)=>onInput(v,i,m))),input.onFinish(((v,m)=>onFinish(v,i,m))),input.input.css({display:"inline-block",width:`calc(100% / ${_length})`}),_inputs.push(input),$view.add(input.input)}_this.view=$view}(),this.force=function(value,history=!1){_vector=[...value],_this.value=[..._vector],_inputs.forEach(((input,index)=>input.value=_this.value[index])),_this.finish(history)},this.update=function(){_inputs.forEach(((input,index)=>input.value=_this.value[index]))}})),Class((function UILInputNumber(_opts={}){Inherit(this,Component);const _this=this;let $input,_timeout,_distance,_onMouseDownValue,_editing=!1,_precision=_opts.precision||3,_step=_opts.step||1,_min=_opts.min||-1/0,_max=_opts.max||1/0,_value=_opts.value||0,_pointer=[0,0],_prevPointer=[0,0],_onInputCB=()=>{},_onFinishCB=()=>{};function setValue(value){(value=parseFloat(value)||0)<_min&&(value=_min),value>_max&&(value=_max),_value=value,_onInputCB(value,_this.master)}function onBlur(){onFinishChange(),$input.div.value=parseFloat(_value).toFixed(_precision)}function onKeyUp(e){13===e.keyCode&&e.altKey&&(_this.master=!0,onInput())}function onInput(e){_timeout=setTimeout(onFinishChange,400),_editing=!0,setValue(parseFloat($input.div.value))}function onFinishChange(){_editing&&(_editing=!1,clearTimeout(_timeout),_onFinishCB(_value,_this.master),_this.master=!1)}function onMouseDown(e){(1===e.button||0===e.button&&e.metaKey||e.ctrlKey)&&(e.preventDefault(),$input.css({cursor:"col-resize"}),_distance=0,_onMouseDownValue=_value,_prevPointer=[e.screenX,e.screenY],document.addEventListener("mousemove",onMouseMove,!1),document.addEventListener("mouseup",onMouseUp,!1))}function onMouseMove(e){clearTimeout(_timeout),_editing=!0;let currentValue=_value;_pointer=[e.screenX,e.screenY],_distance+=_pointer[0]-_prevPointer[0]-(_pointer[1]-_prevPointer[1]);let value=_onMouseDownValue+_distance/(e.shiftKey?5:50)*_step;value=Math.min(_max,Math.max(_min,value)),_this.master=e.altKey,currentValue!==value&&function setValueDrag(value){void 0===value&&value===$input.div.value||(setValue(value),$input.div.value=_value.toFixed(_precision))}(value),_prevPointer=[e.screenX,e.screenY]}function onMouseUp(e){onFinishChange(),$input.css({cursor:""}),document.removeEventListener("mousemove",onMouseMove,!1),document.removeEventListener("mouseup",onMouseUp,!1)}!function initInput(){$input=$("input","input"),$input.attr("type","number"),$input.attr("step",_step),$input.size("100%").bg("#1D1D1D"),$input.css({boxSizing:"border-box",border:"1px solid #2E2E2E",color:"#37A1EF",boxShadow:"none"}),$input.div.value=parseFloat(_value).toFixed(_precision),_this.input=$input}(),function addHandlers(){$input.div.addEventListener("mousedown",onMouseDown,!1),$input.div.addEventListener("keyup",onKeyUp,!1),$input.div.addEventListener("change",onFinishChange,!1),$input.div.addEventListener("blur",onBlur,!1),$input.div.addEventListener("input",onInput,!1)}(),this.set("value",(value=>{_value=value,_editing||($input.div.value=parseFloat(value).toFixed(_precision))})),this.get("value",(()=>_value)),this.onInput=cb=>_onInputCB=cb,this.onFinish=cb=>_onFinishCB=cb,this.onDestroy=function(){$input.div.removeEventListener("mousedown",onMouseDown,!1),$input.div.removeEventListener("change",onFinishChange,!1),$input.div.removeEventListener("blur",onBlur,!1),$input.div.removeEventListener("input",onInput,!1)}})),Class((function UILExternalColor(_title,_value){Inherit(this,Component);const _this=this;var _window;function onReload(){_this.onDestroy()}(_window=window.open(location.protocol+"//localhost/hydra/editor/color/index.html",`hydra_color_${_title}`,"width=480,height=220,left=200,top=100,location=no")).window.onload=_=>{_window.window.initPicker(_title,_value,_this)},window.addEventListener("beforeunload",onReload),this.update=function(value){_this.events.fire(Events.UPDATE,{value:value})},this.onDestroy=function(){window.removeEventListener("beforeunload",onReload),_window&&_window.window&&_window.window.close()}})),Class((function UILExternalEditor(_title,_height=500,_width=700){Inherit(this,Component);const _this=this;var _window,_code,_language;_window=window.open(location.protocol+"//localhost/hydra/editor/code/index.html","_blank",`width=${_width},height=${_height},left=200,top=100`),_this.events.sub(Events.UNLOAD,(_=>_window.close())),_window.window.onload=_=>{_window.window.initEditor(_title,_code,_language,_this)},this.setCode=function(code,language){_code=code,_language=language},this.saved=async function(code){_this.onSave&&_this.onSave(code),await defer(),UILStorage.write()}})),Class((function UILPanelToolbar(){Inherit(this,Element);const _this=this;let $this,$filter,_state=new Map;function restoreFolderState(){_this.parent.folder.forEachFolder((folder=>{_state.get(folder)?folder.open():folder.close()})),_state.clear()}function onInput(e){if(!$filter.div.value.length)return restoreFolderState(),_this.parent.folder.showChildren();_this.parent.folder.filter($filter.div.value)}function onFocus(){!function saveFolderState(){_this.parent.folder.forEachFolder((folder=>{_state.set(folder,folder.isOpen())}))}(),$filter.css({border:"1px solid #37a1ef"})}function onBlur(){$filter.css({border:"1px solid #2e2e2e"})}function onKeyPressed(e){if(27===e.keyCode)return $filter.div.value="",restoreFolderState(),_this.parent.folder.showChildren()}!function initHTML(){$this=_this.element,$this.size("100%","auto").bg("#272727"),$this.css({padding:4,boxSizing:"border-box",marginBottom:4})}(),function initFilter(){$filter=$this.create("filter","input"),$filter.div.addEventListener("input",onInput,!1),$filter.div.addEventListener("keydown",onKeyPressed,!1),$filter.div.addEventListener("focus",onFocus,!1),$filter.div.addEventListener("blur",onBlur,!1),$filter.size("100%","auto").bg("#161616"),$filter.css({color:"#B1B1B1",border:"1px solid #2e2e2e",outline:"none",padding:2,boxSizing:"border-box"})}(),this.eliminate=function(){$filter.div.removeEventListener("input",onInput,!1),$filter.div.removeEventListener("keydown",onKeyPressed,!1),$filter.div.removeEventListener("focus",onFocus,!1),$filter.div.removeEventListener("blur",onBlur,!1)},this.filter=function(text){$filter.div.value=text,onInput()},this.filterSingle=function(text){$filter.div.value=text,_this.parent.folder.filterSingle($filter.div.value)},this.hideAll=function(){_this.flag("init")||(_this.flag("init",!0),this.filterSingle("xxxxxx"))}})),Namespace("FX"),FX.Class((function UnrealBloom(_nuke,options,_unique){Inherit(this,Component);var _triangleGeometry,_luminosityShader,_compositeShader,_mesh,_inputTexture,_this=this;"string"==typeof options?(_unique=_params,options={},_nuke=World.NUKE):"string"==typeof _nuke?(_unique=_nuke,options={},_nuke=World.NUKE):!_nuke||_nuke instanceof Nuke?(_nuke=_nuke||World.NUKE,options=options||{},_unique=_unique||""):(options=_nuke,_nuke=World.NUKE);var _oldClearColor=new Color,_oldClearAlpha=1,_renderTargetsHorizontal=[],_renderTargetsVertical=[],_separableBlurShaders=[],_nMips=options.nMips||5,_DPR=_nuke.dpr,_blurDirectionX=new Vector2(_DPR,0),_blurDirectionY=new Vector2(0,_DPR),_kernelSizeArray=options.kernelSizeArray||[3,5,7,9,11],_bloomFactors=options.bloomFactors||[1,.8,.6,.4,.2],_useRTPool=options.useRTPool||!1;function render(){if(!_this.enabled||!1===_this.visible)return;let renderer=_nuke.renderer;_oldClearColor.copy(renderer.getClearColor()),_oldClearAlpha=renderer.getClearAlpha();let oldAutoClear=renderer.autoClear;renderer.autoClear=!0,renderer.setClearColor(_this.clearColor,0);let inputRenderTarget=_inputTexture||_nuke.rttBuffer.texture;_luminosityShader.uniforms.luminosityThreshold.value>.01&&(_luminosityShader.uniforms.tDiffuse.value=inputRenderTarget,_mesh.shader=_luminosityShader,renderer.renderSingle(_mesh,_nuke.camera,_this.renderTargetBright),inputRenderTarget=_this.renderTargetBright);for(let i=0;i<_nMips;i++)_mesh.shader=_separableBlurShaders[i],_separableBlurShaders[i].uniforms.colorTexture.value=inputRenderTarget,_separableBlurShaders[i].uniforms.direction.value=_blurDirectionX,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsHorizontal[i]),_separableBlurShaders[i].uniforms.colorTexture.value=_renderTargetsHorizontal[i].texture,_separableBlurShaders[i].uniforms.direction.value=_blurDirectionY,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsVertical[i]),inputRenderTarget=_renderTargetsVertical[i];_mesh.shader=_compositeShader,renderer.renderSingle(_mesh,_nuke.camera,_renderTargetsHorizontal[0]),renderer.setClearColor(_oldClearColor,_oldClearAlpha),renderer.autoClear=oldAutoClear}function resizeHandler(){_this.resolution.set(_nuke.stage.width,_nuke.stage.height).multiplyScalar(_DPR),_blurDirectionX.x=_DPR,_blurDirectionY.y=_DPR;let resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);_this.renderTargetBright&&_this.renderTargetBright.setSize(resx,resy);for(var i=0;i<_renderTargetsHorizontal.length;i++)_renderTargetsHorizontal[i].setSize(resx,resy),_renderTargetsVertical[i].setSize(resx,resy),_separableBlurShaders[i].uniforms.texSize.value=new Vector2(resx,resy),resx=Math.round(resx/2),resy=Math.round(resy/2)}this.uniforms={tUnrealBloom:{value:null,ignoreUIL:!0},unique:_unique},this.resolution=new Vector2(_nuke.stage.width*_DPR,_nuke.stage.height*_DPR),this.clearColor=new Color(0,0,0),this.enabled="boolean"!=typeof options.enabled||options.enabled,this.outputTexture=null,function initRTs(){if(_useRTPool)return void RTPool.instance(null,3,Texture.RGBAFormat).disableResize();let pars={minFilter:Texture.LINEAR,magFilter:Texture.LINEAR,format:Texture.RGBAFormat},resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);_this.renderTargetBright=new RenderTarget(resx,resy,pars),_this.renderTargetBright.texture.generateMipmaps=!1;for(let i=0;i<_nMips;i++){let renderTargetHorizonal=new RenderTarget(resx,resy,pars);renderTargetHorizonal.texture.generateMipmaps=!1,_renderTargetsHorizontal.push(renderTargetHorizonal);let renderTargetVertical=new RenderTarget(resx,resy,pars);renderTargetVertical.texture.generateMipmaps=!1,_renderTargetsVertical.push(renderTargetVertical),resx=Math.round(resx/2),resy=Math.round(resy/2)}_this.outputTexture=_renderTargetsHorizontal[0].texture,_this.uniforms.tUnrealBloom.value=_renderTargetsHorizontal[0].texture}(),function initScene(){_triangleGeometry=World.QUAD,_luminosityShader=_this.initClass(Shader,"UnrealBloomLuminosity",{tDiffuse:{value:null,ignoreUIL:!0},luminosityThreshold:{value:1},smoothWidth:{value:.01,ignoreUIL:!0},defaultColor:{value:new Color(0),ignoreUIL:!0},defaultOpacity:{value:0,ignoreUIL:!0},unique:_unique}),(_mesh=new Mesh(_triangleGeometry,_luminosityShader)).frustumCulled=!1}(),function initBlurShaders(){let resx=Math.round(_this.resolution.x/2),resy=Math.round(_this.resolution.y/2);for(let i=0;i<_nMips;i++){let shader=_this.initClass(Shader,"UnrealBloomGaussian",{unique:_unique,colorTexture:{value:null},texSize:{value:new Vector2(resx,resy)},direction:{value:new Vector2(.5,.5)}},null,(glsl=>`\n#define KERNEL_RADIUS ${_kernelSizeArray[i]}\n#define SIGMA ${_kernelSizeArray[i]}\n${glsl}`),`gaussian${i}`);_separableBlurShaders.push(shader),resx=Math.round(resx/2),resy=Math.round(resy/2)}}(),function initCompositeShader(){let uniforms={bloomStrength:{value:1},bloomTintColor:{value:new Color("#ffffff")},bloomRadius:{value:0},unique:_unique};for(let i=0;i<_nMips;i++)uniforms[`blurTexture${i+1}`]={value:_useRTPool?null:_renderTargetsVertical[i].texture,ignoreUIL:!0};(_compositeShader=_this.initClass(Shader,"UnrealBloomComposite",uniforms,null,((glsl,type)=>{if("vs"===type)return glsl;let compositeUniforms="",compositeMain="";for(let i=0;i<_nMips;i++)compositeUniforms+=`uniform sampler2D blurTexture${i+1};\n`,compositeMain+=`lerpBloomFactor(${_bloomFactors[i].toFixed(4)}) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture${i+1}, vUv) ${i<_nMips-1?"+ ":""}`;return(glsl=glsl.replace("uniform sampler2D blurTexture1;",compositeUniforms)).replace("lerpBloomFactor(1.0) * vec4(bloomTintColor, 1.0) * texture2D(blurTexture1, vUv)",compositeMain)}))).needsUpdate=!0}(),function initPass(){_this.pass=_this.initClass(NukePass,"UnrealBloomPass",_this.uniforms)}(),function addListeners(){_this.events.sub(Events.RESIZE,resizeHandler),_this.startRender(render,RenderManager.POST_RENDER)}(),options.noUIL||(ShaderUIL.add(_luminosityShader).setLabel("UnrealBloom Luminosity"),ShaderUIL.add(_compositeShader).setLabel("UnrealBloom Composite")),this.set("texture",(texture=>{_inputTexture=texture})),this.get("luminosityShader",(_=>_luminosityShader)),this.get("compositeShader",(_=>_compositeShader)),this.set("dpr",(dpr=>{_DPR=dpr,resizeHandler()})),this.renderBloom=render,this.renderMesh=_mesh,this.onDestroy=function(){_renderTargetsHorizontal.forEach((r=>r.destroy())),_renderTargetsVertical.forEach((r=>r.destroy())),_this.renderTargetBright&&_this.renderTargetBright.destroy()},this.getRTs=function(){_this.renderTargetBright=RTPool.instance().getRT();for(let i=0;i<_nMips;i++)_renderTargetsHorizontal.push(RTPool.instance().getRT()),_renderTargetsVertical.push(RTPool.instance().getRT()),_compositeShader.uniforms[`blurTexture${i+1}`].value=_renderTargetsVertical[i].texture;_this.outputTexture=_renderTargetsHorizontal[0].texture,_this.uniforms.tUnrealBloom.value=_renderTargetsHorizontal[0].texture,resizeHandler()},this.putRTs=function(){_this.renderTargetBright&&RTPool.instance().putRT(_this.renderTargetBright),_this.renderTargetBright=null;for(let i=0;i<_renderTargetsHorizontal.length;i++)RTPool.instance().putRT(_renderTargetsHorizontal[i]),RTPool.instance().putRT(_renderTargetsVertical[i]);_renderTargetsHorizontal=[],_renderTargetsVertical=[]}})),Class((function VelocityTracker(_vector){Inherit(this,Component);var _this=this,Vector="number"==typeof _vector.z?Vector3:Vector2,_velocity=new Vector,_last=new Vector;function loop(){_velocity.subVectors(_vector,_last),_last.copy(_vector)}this.value=_velocity,this.start=function(){_this.startRender(loop)},this.onDestroy=this.stop=function(){_this.stopRender(loop)},this.copy=function(){_last.copy(_vector)},this.update=loop})),Class((function Video(_params){Inherit(this,Component);const _this=this;let $video,_video,_loadingState,_handlers,_ready=Promise.create(),_loaded=Promise.create(),_initialPlay=!0;function startPreload(){return _loadingState=!0,_video.load(),_ready}async function startPlayback(){if(!_this.playing&&(_loadingState=!1,_video.readyState<2&&(_video.load(),await _ready),!_this.playing)){_initialPlay&&(_initialPlay=!1,_params.currentTime&&(_video.currentTime=_params.currentTime)),_this.playing=!0;try{return await _video.play()}catch(error){throw _this.playing=!1,error}}}function getSource(src=""){return src&&!src.includes(["webm","mp4","ogv","blob","?"])&&(src+="."+Device.media.video),src}function progress(e){_this.events.fire(Video.PROGRESS,e)}function timeupdate(e){_this.events.fire(Video.UPDATE,e)}function play(e){if(_loadingState)return _loadingState=!1;_this.events.fire(Video.PLAY,e)}function pause(e){_this.events.fire(Video.PAUSE,e)}function playing(e){_this.events.fire(Video.PLAYING,e)}function ended(e){_this.events.fire(Video.ENDED,e)}function waiting(e){_this.events.fire(Video.WAITING,e)}function canplay(e){loadeddata(),_this.events.fire(Video.CANPLAY,e)}function loadedmetadata(e){_this.dimensions.width=_video.videoWidth,_this.dimensions.height=_video.videoHeight,_this.events.fire(Video.LOADEDMETADATA,e)}function loadeddata(e){_video.readyState>=2&&_ready.resolve(),_video.readyState>=4&&_loaded.resolve()}function error(){_this.playing&&(_this.playing=!1),_this.events.fire(Video.ERROR,_video.error)}!function initParam(){let defaults={muted:!0,loop:!1,autoplay:!1,inline:!0,controls:!1,currentTime:0,playback:1,preload:!1,width:640,height:360,events:[],disableRemotePlayback:!0};_params=Object.assign(defaults,_params)}(),function init(){return _video=document.createElement("video"),_params.src&&(_video.src=getSource(_params.src)),_video.setAttribute("crossorigin","anonymous"),_video.disableRemotePlayback=_params.disableRemotePlayback,_video.autoplay=_params.autoplay,_video.loop=_params.loop,_video.controls=_params.controls,_video.height=_params.height,_video.width=_params.width,_video.defaultMuted=_params.muted,_video.defaultPlaybackRate=_params.playback,_video.preload="string"==typeof _params.preload?_params.preload:_params.preload?"auto":"none",_video.muted=_params.autoplay||_params.muted,_video.setAttribute("webkit-playsinline",_params.inline),_video.setAttribute("playsinline",_params.inline),_this.dimensions={width:_params.width,height:_params.height},_video.autoplay&&_video.setAttribute("autoplay",_params.autoplay),_video.setAttribute("muted",_params.muted),_params.loop&&_video.setAttribute("loop",_params.loop),_this.div=_video,$video=$(_video),_params.autoplay?startPlayback():_params.preload?startPreload():void 0}(),function addHandlers(){["loadedmetadata","loadeddata","error"].forEach((ev=>{_params.events.includes(ev)||_params.events.push(ev)})),_handlers={play:play,pause:pause,ended:ended,playing:playing,progress:progress,waiting:waiting,timeupdate:timeupdate,loadedmetadata:loadedmetadata,loadeddata:loadeddata,canplay:canplay,error:error},_params.events.forEach((ev=>_video.addEventListener(ev,_handlers[ev],!0)))}(),this.set("loop",(bool=>_video.loop=bool)),this.get("loop",(()=>_video.loop)),this.set("src",(src=>{(src=getSource(src))!==_video.src&&(_ready=Promise.create(),_loaded=Promise.create(),_video.src=src,_this.playing?(_this.playing=!1,startPlayback()):_params.preload&&startPreload())})),this.get("src",(()=>_video.currentSrc)),this.set("volume",(v=>{_video.muted=0===v,_video.volume=v})),this.get("volume",(()=>_video.volume)),this.set("muted",(bool=>_video.muted=bool)),this.get("muted",(()=>_video.muted)),this.set("controls",(bool=>_video.controls=bool)),this.get("controls",(()=>_video.controls)),this.get("duration",(()=>_video.duration)),this.get("ended",(()=>_video.ended)),this.get("playback",(()=>_video.playbackRate)),this.get("time",(()=>_video.currentTime)),this.get("error",(()=>_video.error)),this.get("canRender",(()=>_video.readyState>=2)),this.get("canPlayThrough",(()=>_video.readyState>=4)),this.get("paused",(()=>_video.paused)),this.get("element",(()=>$video)),this.get("object",(()=>$video)),this.get("video",(()=>_video)),this.get("bufferedSeconds",(_=>_video.readyState<2?0:_video.buffered.end(0)-_video.buffered.start(0))),this.load=async function(){return startPreload()},this.play=async function(){return startPlayback()},this.pause=function(){_this.playing=!1,_video.pause()},this.stop=function(){_this.playing=!1,_video.pause(),_this.seek(0)},this.seek=function(t){if(_video.fastSeek)return _video.fastSeek(t);_video.currentTime=t},this.seekExact=function(t){_video.currentTime=t},this.ready=function(){return _ready},this.loaded=function(){return _loaded},this.onDestroy=function(){_this.stop(),_video.src="",function removeListeners(){_params.events.forEach((ev=>_video.removeEventListener(ev,_handlers[ev],!0)))}(),_video=null},this.setSize=function(width,height){_video.width=width,_video.height=height,_this.dimensions.width=width,_this.dimensions.height=height}}),(()=>{Video.PLAY="hydra_video_play",Video.CANPLAY="hydra_video_can_play",Video.LOADEDMETADATA="hydra_video_loaded_metadata",Video.PAUSE="hydra_video_pause",Video.PROGRESS="hydra_video_progress",Video.UPDATE="hydra_video_update",Video.PLAYING="hydra_video_playing",Video.ENDED="hydra_video_ended",Video.WAITING="hydra_video_waiting",Video.ERROR="hydra_video_error"})),Class((function VideoTexture(_path,_props={}){Inherit(this,Component);const _this=this;let _video,_requestId,_hasRequestCallback=!1,_sharedVideo=!1;if(_this.canUpdate=!0,"object"==typeof _path&&!(_path instanceof HTMLVideoElement)){let path=_path.path;_props=_path,_path=path,delete _props.path}let{loop:loop,preload:preload,autoplay:autoplay,muted:muted,firstFrame:firstFrame,parseColor:parseColor,events:events=[]}=_props;function update(){_requestId=null;let updateTex=_video.canRender&&_this.canUpdate;firstFrame&&updateTex&&(updateTex=_video.time>0),updateTex&&(_this.videoTexture&&(_this.texture.destroy(),_this.texture=_this.videoTexture,delete _this.videoTexture),_this.texture.image||(_this.texture.image=_video.video,_this.texture.upload()),_this.colorParser&&_this.colorParser.update(_video.time),_this.texture.loaded=_this.texture.needsUpdate=!0,_this.uniform.value=_this.texture),_hasRequestCallback&&(_requestId=_video.element.div.requestVideoFrameCallback(update))}function noop(){}function handleSharedVideoPlaying(){start()}function handleSharedVideoPause(){stop()}function start(){_this.active=!0,_requestId&&(_video.element.div.cancelVideoFrameCallback(_requestId),_requestId=null),_hasRequestCallback?_this.startRender(noop):_this.startRender(update,30),update()}function stop(){_this.active=!1,_hasRequestCallback?_requestId&&_video.element.div.cancelVideoFrameCallback(_requestId):_this.stopRender(update)}void 0===loop&&(loop=!0),void 0===preload&&(preload=!0),void 0===autoplay&&(autoplay=!0),void 0===muted&&(muted=!0),void 0===firstFrame&&(firstFrame=!1),void 0===parseColor&&(parseColor=!1),void 0===events&&(events=[]),_this.uniform={value:null},function(){let src;if(_props.start&&defer((_=>_this.start())),_path instanceof HTMLVideoElement?(_sharedVideo=!0,src=_path,autoplay=!1,preload=!1,events=[...events,"pause"]):src=_path.includes("blob")?_path:Assets.getPath(_path),!_sharedVideo&&_path.includes(["jpg","png"])){let noop=_=>{};_this.texture=Utils3D.getTexture(src),_this.video={play:noop,pause:noop},parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!0))}else{let videoEvents=["timeupdate","playing","ended"];events.forEach((ev=>{videoEvents.includes(ev)||videoEvents.push(ev)})),_video=_this.initClass(Video,{src:src,loop:loop,preload:preload,autoplay:autoplay,muted:muted,events:videoEvents}),_this.texture=new Texture,_this.texture.format=Texture.RGBFormat,_this.texture.minFilter=_this.texture.magFilter=Texture.LINEAR,_this.texture.generateMipmaps=!1,_this.texture.loaded=!1,_this.video=_video,_this.dimensions=_video.dimensions,_this.texture.dimensions=_this.dimensions,_this.events.bubble(_video,Video.PLAYING),parseColor&&(_this.colorParser=_this.initClass(VideoTextureColorParser,src,!1)),firstFrame&&(_this.videoTexture=_this.texture,_this.texture=Utils3D.getTexture(firstFrame))}_this.uniform.value=_this.texture,_hasRequestCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,"safari"===Device.system.browser&&(_hasRequestCallback=!1),_sharedVideo&&function initSharedVideo(){_this.events.sub(_video,Video.PLAYING,handleSharedVideoPlaying),_this.events.sub(_video,Video.PAUSE,handleSharedVideoPause)}()}(),this.set("loop",(loop=>_video.loop=loop)),this.set("muted",(muted=>_video.muted=muted)),this.set("src",(src=>{_requestId&&(_video.element.div.cancelVideoFrameCallback(_requestId),_requestId=null),_video.src=src.includes("blob")?src:Assets.getPath(src),_hasRequestCallback&&(_requestId=_video.element.div.requestVideoFrameCallback(update))})),this.start=async function(){_sharedVideo||_video&&(start(),await _video.play())},this.stop=function(){_sharedVideo||_video&&(stop(),_video.pause())},this.seek=function(time){_sharedVideo||_video&&_video.seek(time)},this.onInvisible=function(){_sharedVideo||(_this.active&&_video.pause(),VideoTexture.element().removeChild(_this.video.object,!0))},this.onVisible=function(){_sharedVideo||(_this.active&&_video.play(),VideoTexture.element().add(_this.video.object))},this.onDestroy=function(){_this.texture.destroy(),_sharedVideo||VideoTexture.element().removeChild(_this.video.object,!0)}}),(_=>{var $element;VideoTexture.element=function(){return $element||(($element=Stage.create("VideoTextures")).css({position:"absolute",pointerEvents:"none"}),$element.size(0,0).setZ(-10),Stage.add($element)),$element}})),Class((function VideoTextureColorParser(_path,_static){Inherit(this,Component);const _this=this;var _colorData,_color=new Color;this.color=new Color,this.lerp=1,async function(){let path=_path.split(".")[0]+".json";_colorData=await get(path)}(),this.update=function(time){if(_colorData)for(let key in _colorData)if(time<=key){_color.set("#"+_colorData[key]),_this.color.lerp(_color,_this.lerp);break}}})),Class((function SocketConnection(_server,_channel){Inherit(this,Component);var _socket,_pingPong,_this=this,_fail=0,_binary={},_time=Render.TIME;function connect(){_this.pending=!1,(_socket=new WebSocket(_server,["permessage-deflate"])).binaryType="arraybuffer",_socket.onopen=open,_socket.onmessage=message,_socket.onclose=close,_socket.onerror=close}function sendPing(){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send("ping")}function open(e){_fail=0,_this.connected=!0,_this.events.fire(SocketConnection.OPEN,{socket:_this},!0),_channel&&_this.send("register",{channel:_channel}),_pingPong=setInterval(sendPing,5e3)}function message(e){if("pong"!=e.data&&"ping"!=e.data)if("string"==typeof e.data)try{let data=JSON.parse(e.data),evt=data._evt;evt?(delete data._evt,_this.events.fire(evt,data,!0)):(_binary.data=data,_this.events.fire(SocketConnection.BINARY,_binary))}catch(er){}else _binary.data=e.data,_this.events.fire(SocketConnection.BINARY,_binary)}function close(e){if(Render.TIME-_time<50&&!_this.blocked)return _this.blocked=!0,_this.events.fire(SocketConnection.BLOCKED);_this.pending||_fail++>250||(_this.connected=!1,_this.pending=!0,_this.events.fire(SocketConnection.CLOSE,{socket:_this},!0),_this.timer=_this.delayedCall(connect,250),clearTimeout(_pingPong))}this.connected=!1,async function(){try{connect()}catch(e){await defer(),_this.events.fire(SocketConnection.ERROR,{socket:_this}),_this.timer=_this.delayedCall(connect,250)}}(),this.send=function(evt,data={}){if(!_this.connected)return _this.delayedCall((_=>_this.send(evt,data)),100);data._evt=evt,_socket&&_socket.readyState==WebSocket.OPEN&&_socket.send(null!=data.length?data:JSON.stringify(data))},this.sendBinary=function(data){_socket&&_socket.readyState==WebSocket.OPEN&&_socket.bufferedAmount<1024&&_socket.send("binary:"+(null!=data.length?data:JSON.stringify(data)))},this.close=function(){_socket.onclose=null,_socket.onerror=null,clearTimeout(_this.timer),_socket.close()}}),(_=>{SocketConnection.OPEN="socket_connection_open",SocketConnection.CLOSE="socket_connection_close",SocketConnection.ERROR="socket_connection_error",SocketConnection.BINARY="socket_connection_binary",SocketConnection.BLOCKED="socket_connection_blocked"})),Class((function CameraUtil(){Inherit(this,Component);const _this=this;var _cameras=[];function handleResize(){_cameras.forEach((camera=>camera.applyFOV()))}function handleScrollEvent(e){_this.flag("preventScroll")&&e.preventDefault?.()}function touchStart(e){_this.flag("hardBlock")&&e.preventDefault?.()}!async function(){await Hydra.ready(),_this.onResize(handleResize),Scroll.createUnlimited(),_this.events.sub(Scroll.EVENT,handleScrollEvent),Device.mobile&&__window.bind("touchstart",touchStart)}(),this.addCamera=function(camera,near=1,far=1e4){_cameras.push(camera),camera.applyFOV=function(){camera.fov=function getFOV(){return Math.range(Stage.width/Stage.height,1,2,50,30,!0)}(),camera.updateProjectionMatrix()},camera.near=near,camera.far=far,camera.applyFOV()},this.blockScroll=function(bool){_this.flag("preventScroll",bool)},this.hardBlockScroll=function(bool){_this.flag("hardBlock",bool)}}),"static"),Class((function ImageUtil(){this.square=async function(src,size=512){let $canvas=document.createElement("canvas"),$ctx=$canvas.getContext("2d");$canvas.setAttribute("width",size),$canvas.setAttribute("height",size),$canvas.width=size,$canvas.height=size;let loaded=Promise.create(),$img=document.createElement("img");$img.crossOrigin="anonymous",$img.onload=_=>loaded.resolve(),$img.src=src,await loaded,await defer();let{width:width,height:height}=$img,mult=size/Math.max(width,height);width*=mult,height*=mult;let x=.5*(size-width),y=.5*(size-height);return $ctx.drawImage($img,x,y,width,height),{width:width,height:height,canvas:$canvas}}}),"static"),Class((function Fonts(){Inherit(this,Component);const _this=this,FONTS=["FuturaLT-Bold.ttf","FuturaLT-Book.otf","FuturaLT-Heavy.ttf","FuturaLT-Light.otf","FuturaLT-Medium.ttf","marscondensed-regular-TRIAL.otf","marsextended-regular-TRIAL.otf"],SUBSCRIPTMAP="0123456789".split(""),SUBSCRIPT="₀₁₂₃₄₅₆₇₈₉".split(""),SUPERSCRIPTMAP="0123456789stndrh".split(""),SUPERSCRIPT="⁰¹²³⁴⁵⁶⁷⁸⁹ˢᵗⁿᵈʳʰ".split("");async function applyExtraChars(){for(let fontName of FONTS){let path=`assets/fonts/${fontName.split(".")[0]}.json`,font=await get(path);SUBSCRIPT.map(((char,i)=>addScripts(font,char,SUBSCRIPTMAP[i],i))),SUPERSCRIPT.map(((char,i)=>addScripts(font,char,SUPERSCRIPTMAP[i],i))),await Dev.writeFile(path,font)}}function addScripts(font,char,map,i){let id=char.charCodeAt(0),existing=font.chars.find((char=>char.id===id));existing&&font.chars.remove(existing);let lookup=`${map}`.charCodeAt(0),data=font.chars.find((char=>char.id===lookup)),yoffset=SUBSCRIPT.includes(char)?.8*font.common.base:data.yoffset,charData=Object.assign({},data);charData=Object.assign(charData,{id:id,char:char,scale:.6,yoffset:yoffset}),font.chars.push(charData)}this.generate=async function(){await async function generateFonts(){for(let name of FONTS)await window.generateFont(`${name}`,{},"~!@#$%^&*()-_+=[]{}:;\"'<>?.,©®™ŒW()—ÆÇj$|[]{}ÓÚÜÖÒÔÕÙÛÁÉÍÑÄÊÂÀÃÅÈËÌÎÏœØQæwM@%åbdfiCGOS0689&?¿ßhklmABDEFHIJKLNPRTUVXYZ123457!#/\\áéóú¡àçèòùgpqyíüñäöêâëãìîôõûït;ø_–acenorsu~:<>vxz^+=*“”\",-'’‘. ẞ"),await _this.wait(150);await _this.wait(5e3)}(),await applyExtraChars()},this.applyExtraChars=async function(){await applyExtraChars()}}),"static"),Module((function glEaseOptions(){let options=["backInOut","backIn","backOut","bounceOut","bounceIn","bounceInOut","circularInOut","circularIn","circularOut","cubicInOut","cubicIn","cubicOut","elasticInOut","elasticIn","elasticOut","expoInOut","expoIn","expoOut","linear","quadraticInOut","quadraticIn","quadraticOut","qinticInOut","qinticIn","qinticOut","sineInOut","sineIn","sineOut"].map(((label,value)=>({label:label,value:value})));this.exports={value:0,type:"i",options:options}})),Class((function Tests(){this.getDPR=function(){return GPU.OVERSIZED?.8:GPU.lt(0)?1:GPU.lt(1)?Math.min(Device.pixelRatio,1):GPU.lt(2)?Math.min(Device.pixelRatio,1.1):GPU.lt(3)?Math.min(Device.pixelRatio,1.2):GPU.lt(4)?Math.min(Device.pixelRatio,1.4):GPU.gt(5)?Math.max(Device.pixelRatio,1.5):GPU.mobileLT(0)?1:GPU.mobileLT(1)?Math.min(Device.pixelRatio,1.1):GPU.mobileLT(2)?Math.min(Device.pixelRatio,1.2):GPU.mobileLT(3)?Math.min(Device.pixelRatio,1.4):GPU.mobileLT(4)?Math.min(Device.pixelRatio,2):1},this.hasBirds=function(){return!0},this.getBirdsCount=function(){return GPU.mobileLT(3)||GPU.lt(2)?30:100},this.lowFPS=function(){return!!GPU.lt(1)||!!GPU.mobileLT(2)},this.renderFXAA=function(){return!GPU.mobileLT(2)},this.useSmoothScroll=function(){return!Device.mobile&&("safari"!==Device.system.browser&&"ie"!==Device.system.browser)},this.bloomEnabled=function(){return!1},this.bloomMips=function(){return GPU.gt(5)?5:3},this.pingPongSections=function(){return!!GPU.lt(0)||!!GPU.mobileLT(2)},this.optimizeGPUMem=function(){return!Global.PLAYGROUND},this.generatePreview=function(){return"production"!==Config.ENV&&!!Utils.query("previewMode")},this.capFPS=function(){return GPU.lt(0)||GPU.mobileLT(2)?30.001:GPU.lt(3)?Render.REFRESH_RATE>60?60.001:null:Device.mobile&&Render.REFRESH_RATE>100?100.001:null}}),"static"),Class((function CMS(){Inherit(this,Model);const _this=this,MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"];let _data=null,_rawData=null,_newsPagesCache={};function buildFlexibleSchemaObject(key){var obj={};for(var childKey in _rawData[key])if("_order"!==childKey&&"_temp"!==childKey){let item=_rawData[key][childKey];obj[item.key]=item.value}return obj}function trimStub(stub){let copy={...stub};return delete copy.perma,delete copy._title,delete copy._type,copy}function slugify(str){str=(str=str.replace(/^\s+|\s+$/g,"")).toLowerCase();for(var from="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",i=0,l=from.length;i<l;i++)str=str.replace(new RegExp(from.charAt(i),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(i));return str=str.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}!async function(){await Hydra.ready(),await async function fetchRoot(){_data||(_rawData=await get(`${Config.CMS}/index.json?${Date.now()}`))}(),await async function fetchNewsListing(){_rawData.news=await get(`${Config.CMS}/news/listing.json?${Date.now()}`)}(),await async function transformData(){const home=buildFlexibleSchemaObject("home"),about=buildFlexibleSchemaObject("about"),general=buildFlexibleSchemaObject("general"),chapters=function formatChapters(){let obj={};for(var key in _rawData.chapter){var chapter=_rawData.chapter[key],stories=chapter.chapterstorystub.map((storyStub=>trimStub(storyStub)));obj[key]={number:Number(chapter.chapterinfostub.number),title:chapter.chapterinfostub.title,new:chapter.chapterinfostub.new||!1,stories:stories}}return obj}(),news=function formatNews(){return _rawData.news=_rawData.news.map((article=>{article.listingColumnSpan&&(article.listingColumnSpan=Number(article.listingColumnSpan));try{let[month,date,year]=article.date.split(" ");month=String(MONTHS.indexOf(month)+1).padStart(2,"0"),date=String(date.replace(",","")).padStart(2,"0"),article._order=new Date(`${year}-${month}-${date}T00:00:00.000Z`)}catch{article._order=null}return article})).sort(((a,b)=>a._order<b._order?-1:a._order>b._order?1:0)).reverse(),_rawData.news}(),technology=function formatTechnology(){let obj={};for(var key in _rawData.technology){let item=_rawData.technology[key],pairedItems={},textItems={},longTextItems={};item.technologypaireditem&&item.technologypaireditem.forEach((pairedItem=>{pairedItems[slugify(pairedItem._title)]=pairedItem})),item.generaltextstub&&item.generaltextstub.forEach((textItem=>{textItems[slugify(textItem._title)]=textItem})),item.generaltextareastub&&item.generaltextareastub.forEach((longTextItem=>{longTextItems[slugify(longTextItem._title)]=longTextItem})),obj[key]={title:item.technologyinfostub.title,pairedItems:pairedItems,textItems:textItems,longTextItems:longTextItems}}return obj}(),contact=_rawData.contact;contact.terms=await RichText.parse(JSON.parse(contact.terms));const partners=_rawData.partners.images.sort(((a,b)=>{const altA=a.alt?a.alt.toUpperCase():"",altB=b.alt?b.alt.toUpperCase():"";return altA<altB?-1:altA>altB?1:0}));_data={general:general,about:about,home:home,contact:contact,navigation:_rawData.navigation,chapters:chapters,news:news,technology:technology,partners:partners}}(),_this.dataReady=!0,_this.flag("isReady",!0)}(),this.fetchNewsPage=async function(slug){if(_newsPagesCache[slug])return _newsPagesCache[slug];const rawNewsPage=await get(`${Config.CMS}/news/${slug}/index.json?${Date.now()}`),newsPage=await async function formatNewsStory(story){let assets=[],audioPlayers=[],pulledQuotes=[];story.newsarticleasset&&(assets=story.newsarticleasset.map((asset=>trimStub(asset)))),story.newsaudioplayer&&(audioPlayers=story.newsaudioplayer.map((audioPlayer=>trimStub(audioPlayer)))),story.newsboldedpullquote&&(pulledQuotes=story.newsboldedpullquote.map((pullQuote=>trimStub(pullQuote))));let content=trimStub(story.newsarticlemain);return content.body=await RichText.parse(JSON.parse(content.body)),{...content,assets:assets,pulledQuotes:pulledQuotes,audioPlayers:audioPlayers}}(rawNewsPage);return _newsPagesCache[slug]=newsPage,newsPage},this.get=function(path){return function objectByString(path="string",obj={}){return(path=(path=path.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split(".").reduce(((prev,key)=>prev&&prev[key]||0===prev[key]?prev[key]:null),obj||{})}(path,_data)},this.ready=async function(){await _this.wait("isReady")}}),"static"),Class((function Colors(){Inherit(this,Component);this.value={beige:"#FDF0E1",orange:"#E74833",darkOrange:"#6e1409",orangeYellow:"#FFA300",greyishTeal:"#66B4AD",teal:"#66B4AD",darkBlueGrey:"#122A2B",dirtyBlue:"#3BBEA0",black:"#161616",lime:"#96AF52"},this.hex={beige:16642273,orange:15157299,black:1447446}}),"static"),Class((function Typography(){Inherit(this,Component);const _this=this,FONT_FAMILY={title:"Aktifo-B",body:"Aktifo-B Book",button:"Aktifo-B Bold"};this.getCSSFont=function(fontName=FONT_FAMILY.body,fontSize,lineHeight="100%",letterSpacing="0",fontWeight="normal"){return{position:"relative",fontFamily:FONT_FAMILY[fontName],fontSize:fontSize,lineHeight:lineHeight,letterSpacing:letterSpacing,fontStyle:"normal",fontWeight:fontWeight}},Text3D.onCreateShader=(shader,test)=>{shader.addUniforms({uNormalColor:{value:new Color(Colors.hex.beige)},uBoldColor:{value:new Color(Colors.hex.orange)}});let shaderClass=_this.initClass(WaveTextShader,null,shader);shader.shaderClass=shaderClass}}),"static"),Class((function Container(){Inherit(this,Element);const _this=this,$this=this.element;var _loader;!function initHTML(){Stage.add($this),$this.css({position:"static"})}(),async function loadView(){let loaderView=_this.initClass(LoaderView);await _this.wait(100),(_loader=_this.initClass(AssetLoader,Assets.list().filter(["shaders","uil","quill"]))).add(3),_this.events.sub(_loader,Events.PROGRESS,loaderView.progress),_this.events.sub(_loader,Events.COMPLETE,(()=>{!function animateIn(){ViewController.instance().isVisible=!0,PageUIGlobal.instance().animateIn()}(),loaderView.animateOut((()=>{loaderView=loaderView.destroy()}))})),_this.events.sub(InteractiveSection.INITIAL_LOADED,(()=>{_loader.trigger(3)})),await CMS.ready(),await Initializer3D.createWorld(),await AssetLoader.loadAssets(["~assets/js/lib/video.min.js"]),function initView(){World.instance(),$this.add(World.ELEMENT),PageUIGlobal.instance(),PageUIController.instance(),ViewController.instance(),NewsController.instance()}(),await Initializer3D.loaded()}(),_this.triggerLoader=num=>{_loader.trigger(num)}}),"singleton"),Class((function NewsController(){Inherit(this,Component);const _this=this;!async function init(){_this.flag("ready",!0)}(),_this.ready=async function(){await _this.wait("ready")}}),"singleton",(()=>{NewsController.LOAD_ARTICLE="load_article"})),Class((function PageUIController(){Inherit(this,Element);const _this=this,$this=_this.element;var $container,_state=AppState.createLocal({menuOpen:!1,orientation:Stage.width>Stage.height?"landscape":"portrait"});function resize(){_state.orientation=Stage.width>Stage.height?"landscape":"portrait"}!function initHTML(){$this.css({top:0,left:0,width:"100%",height:"100%"}),($container=$this.create("container")).css({width:"100%",height:"100%"}),Container.instance().element.add($this)}(),function addHandlers(){_this.onResize(resize)}(),this.get("$container",(_=>$container)),this.get("state",(_=>_state))}),"singleton"),Class((function PageUIGlobal(){Inherit(this,Element);const _this=this,$this=_this.element;var $right,$top,$bottom,$left,_menuTop;const WINDOWS="windows"===Device.system.os;function resize(){WINDOWS&&$right.css({left:Stage.width-10})}Tests.generatePreview()||(function initHTML(){if($this.css({position:"fixed",top:0,left:0,width:"100vw"}),$this.setZ(1e4),$this.invisible(),WINDOWS){let style=document.createElement("style");style.innerHTML="\n            body::-webkit-scrollbar {\n                width: 10px;\n                background: #FDF0E1;\n            }\n            body::-webkit-scrollbar-thumb {\n                background: rgba(0, 0, 0, 0.75);\n            }",document.body.appendChild(style)}}(),function initHeader(){_menuTop=NavigationHeader.instance(),$this.add(_menuTop.element)}(),function initBorder(){let size=Device.mobile?5:10;($top=Stage.create(".border")).css({width:"100%",height:size,position:"fixed",left:0,top:0}).bg(Colors.value.beige).setZ(100),($bottom=Stage.create(".border")).css({width:"100%",height:size,left:0,bottom:0,position:"fixed"}).bg(Colors.value.beige).setZ(100),($left=Stage.create(".border")).css({width:size,height:"100%",top:0,left:0,position:"fixed"}).bg(Colors.value.beige).setZ(100),($right=Stage.create(".border")).css({width:size,height:"100%",top:0,position:"fixed"}).bg(Colors.value.beige).setZ(100),WINDOWS||$right.css({right:0}),Dev.expose("uig",$this)}(),function addHandlers(){_this.onResize(resize)}(),Container.instance().element.add($this)),this.animateIn=function(){if(Tests.generatePreview())return;$this.visible();$top.transformPoint("50%","0%").transform({scaleY:0}).tween({scaleY:1},1e3,"easeInOutQuart",1e3),$bottom.transformPoint("50%","100%").transform({scaleY:0}).tween({scaleY:1},1e3,"easeInOutQuart",1e3),$left.transformPoint("0%","50%").transform({scaleX:0}).tween({scaleX:1},1e3,"easeInOutQuart",1e3),$right.transformPoint("100%","50%").transform({scaleX:0}).tween({scaleX:1},1e3,"easeInOutQuart",1e3)}}),"singleton"),Class((function Playground(){Inherit(this,Component);const _this=this;let _view;function initGLUIView(element){GLUI.Stage.add(element)}!async function(){await UILStorage.ready(),await Data.ready(),Global.PLAYGROUND=Utils.query("p"),function initThree(){World.instance(),Stage.add(World.ELEMENT)}(),function initView(){let request=Global.PLAYGROUND.split("/")[0],view=window["Playground"+request]||window[request]||null;if(!view)throw`No Playground class ${request} found.`;_view=view.instance?view.instance():_this.initClass(view),_view.element?_view.element.mesh?initGLUIView(_view.element):Stage.add(_view.element):_view.root&&_view.$gluiObject&&function initUI3DView(ui3d){Device.mobile?initGLUIView(ui3d.root):(GLUI.Scene.add(ui3d.$gluiObject),function addUIToWorldScene(uiGroup){let group=new Group,v3=new Vector3,distance=USING_XR?1.5:2;return v3.set(0,0,-distance).applyQuaternion(World.CAMERA.quaternion),group.position.copy(World.CAMERA.position).add(v3),group.lookAt(World.CAMERA.position),group.add(uiGroup),World.SCENE.add(group),group}(ui3d.$gluiObject.anchor))}(_view);if(_view.rt&&_view.scene&&_view.nuke)if(request.includes("Figma")){let dimensions=_view.dimensions,$obj=$gl(dimensions[0],dimensions[1],_view.rt.texture);$obj.x=40,$obj.y=40,"portrait"===Utils.query("orientation")&&($obj.scale=.5,$obj.y=-300),GLUI.Stage.add($obj)}else{let shader=_this.initClass(Shader,"ScreenQuad",{tMap:{value:_view}}),mesh=new Mesh(World.QUAD,shader);mesh.frustumCulled=!1,World.SCENE.add(mesh)}else World.SCENE.add(_view.group||_view.mesh||_view.object3D||new Group);(function initCameraHelper(nuke){let orbitCamera=new PerspectiveCamera(30,Stage.width/Stage.height,.1,1e3);orbitCamera.position.z=6;let lastCamera,timer0,timer1,timer2,wasdCamera=orbitCamera.clone();_this.onResize((_=>{orbitCamera.aspect=wasdCamera.aspect=Stage.width/Stage.height,orbitCamera.updateProjectionMatrix(),wasdCamera.updateProjectionMatrix()}));let orbit=new DebugControls(orbitCamera,World.ELEMENT.div),wasd=new WASDControls(wasdCamera,World.ELEMENT.div);orbit.enabled=!1,wasd.enabled=!1,_this.startRender((_=>{orbit.update(),wasd.update()})),_this.orbitControls=orbit,_this.wasdControls=wasd;const clearTimers=_=>{clearTimeout(timer0),clearTimeout(timer1),clearTimeout(timer2)},goToMain=_=>{orbit.enabled=!1,wasd.enabled=!1,lastCamera&&(nuke.camera=lastCamera),AppState.set("playground_camera_active",!1),clearTimers()},goToOrbit=_=>{orbit.enabled=!0,wasd.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=orbitCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=orbit,clearTimers()},goToWASD=_=>{wasd.enabled=!0,orbit.enabled=!1,nuke.camera!=wasdCamera&&nuke.camera!=orbitCamera&&(lastCamera=nuke.camera),nuke.camera=wasdCamera,AppState.set("playground_camera_active",nuke.camera),_this.activeControls=wasd,clearTimers()};Utils.query("orbit")&&(goToOrbit(),timer0=_this.delayedCall(goToOrbit,500),timer1=_this.delayedCall(goToOrbit,1e3),timer2=_this.delayedCall(goToOrbit,3e3));_this.events.sub(Keyboard.DOWN,(_=>{document.activeElement.tagName.toLowerCase().includes(["textarea","input"])||(Keyboard.pressing.includes("!")&&goToMain(),Keyboard.pressing.includes("@")&&goToOrbit(),Keyboard.pressing.includes("#")&&goToWASD())}))})(_view.nuke||World.NUKE),Dev.expose("view",_view)}(),defer(window.onresize)}()}),"singleton"),Class((function TestParticlePlayground(){Inherit(this,Object3D);const _this=this;_this.layout=_this.initClass(SceneLayout,"test-particles")})),Class((function PlaygroundCar(){Inherit(this,Object3D);this.initClass(Car,{})})),Class((function PlaygroundStylizedPBR(){Inherit(this,Object3D);const _this=this;_this.layout=_this.initClass(SceneLayout,"playground_stylized_pbr")})),Class((function InstancedCarPart(_input,_group){Inherit(this,Component);const _this=this;var _batch,_geom,_shader,_mesh;!async function(){!function initBatch(){let geom=_input.get("geometry"),key=!!geom&&JSON.parse(geom).filename;if(!key)return;key=`${_this.parent.name}_${key}`,InstancedCarPart.PARTS[key]||(InstancedCarPart.PARTS[key]=new MeshBatch,_this.parent.add(InstancedCarPart.PARTS[key].group));_batch=InstancedCarPart.PARTS[key]}(),_batch&&(await async function initGeometry(){let settings=_input.get("geometry"),src=!!settings&&JSON.parse(settings).src;_geom=src?await GeomThread.loadGeometry(src):World.PLANE}(),function initShader(){let unique=`${_input.prefix}_shader`;_shader=_this.initClass(Shader,"InstancedCarPart",{tMap:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg")},unique:unique}),ShaderUIL.add(_shader,_group).setLabel("Shader")}(),function initMesh(){_mesh=new Mesh(_geom,_shader),_batch.add(_mesh),_this.parent.group.add(_mesh)}())}()}),(_=>{InstancedCarPart.PARTS={}})),Class((function PlaygroundInstance(){Inherit(this,Object3D);const _this=this;_this.layout=_this.initClass(SceneLayout,"playground_instance")})),Class((function PlaygroundInstanceCar(){Inherit(this,Object3D);const _this=this;!function(){let noGraph="InstanceCar"!==Global.PLAYGROUND;_this.layout=_this.initClass(SceneLayout,"playground_instance_car",{noGraph:noGraph})}()})),Class((function CarClip(_input,_group){Inherit(this,Object3D);const _this=this;var _config,_shaders=[];!async function(){let wildcard=_input?.get?.("wildcard");"CarClip"===Global.PLAYGROUND&&(wildcard=Utils.query("car"));let suffix=wildcard&&wildcard.trim().length>0?`-${wildcard}`:"",noGraph=Global.PLAYGROUND&&!Global.PLAYGROUND.includes(["CarClip","Transition"]);_this.layout=_this.initClass(SceneLayout,`carclip${suffix}`,{noGraph:noGraph}),(_config=InputUIL.create("carclip_"+_input?.prefix,_group)).setLabel("Car Config"),_config.addImage("tEnvDiffuse"),_config.addImage("tEnvSpecular"),_config.addImage("tLightmap"),_config.addNumber("uWheelSpeed",100),_config.addNumber("uSide",1),_config.addVector("uScaleOut",[1,1,1]),_config.addVector("uOffsetOut",[0,0,0]),_config.addNumber("uSaturation",1),_config.addVector("uEnv",[2,0]),_config.addVector("uLight",[1,1,2.5,1]),_config.addVector("uWiggle",[.002,0,0,0]),_config.onUpdate=key=>{let value=_config.get(key);if(value)if(Array.isArray(value))for(let layer in _this.layout.layers){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&mesh.shader.uniforms[key].value.fromArray(value)}else if(value.includes("{")){value=JSON.parse(value);let src=value.src;src.includes("?")&&!data.hotreload&&src.split("?")[0];if(src?.length){value.compressed&&(src+="-compressedKtx");let texture=Utils3D.getTexture(src);key.includes("tEnv")&&(texture.generateMipmaps=!1,texture.minFilter=Texture.LINEAR);for(let layer in _this.layout.layers){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&mesh.shader.set(key,texture)}}}else{value=JSON.parse(value);for(let layer in _this.layout.layers)if(layer.includes("wheel")||"uSide"===key){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&(mesh.shader.uniforms[key].value=value),layer.includes("wheel")&&mesh.shader&&(mesh.shader.uniforms.uWheel.value=1)}}};let inPlayground=Global.PLAYGROUND&&Global.PLAYGROUND.includes(["CarClip","CarTransition"]);_this.startRender((_=>{_shaders.map((shader=>{let p=Math.range(_this.progress,0,1,3,-3,!0);inPlayground&&(p=Math.range(Mouse.tilt.x,-1,1,3,-3,!0)),shader.set("uProgress",p*shader.get("uSide"))})),PBRCarShader.TIME.value+=.015*(1+2*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER*_this.wheelSpeed})),await _this.layout.loadedAllLayers(),["tEnvDiffuse","tEnvSpecular","tLightmap","uEnv","uLight","uWiggle","uWheelSpeed","uSaturation","uSide"].forEach(_config.onUpdate)}(),this.progress=0,this.wheelSpeed=1,this.register=function(shader){_shaders.push(shader)}})),Class((function PBRCarClipShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;!function(){_shader.addUniforms({uTime:PBRCarClipShader.TIME,uProgress:{value:.5,ignoreUIL:!0},uSide:{value:1},uWheel:{value:0},uScaleOut:{value:new Vector3(1,1,1)},uOffsetOut:{value:new Vector3(0,0,0)},uNoiseStrength:{value:0},uEase:require("glEaseOptions"),uWheelSpeed:{value:0},uClearCoat:{value:new Vector3(.6,.7,0)},uWiggle:{value:new Vector4},uSaturation:{value:1},side:Shader.DOUBLE_SIDE,transparent:!0});let parent=_this.findParent("CarClip");parent&&parent.register(_shader)}()}),(_=>{PBRCarClipShader.TIME={value:1}})),Class((function PlaygroundTransition(){Inherit(this,Object3D);const _this=this;!async function(){_this.layout=_this.initClass(SceneLayout,"playground_transition");let[a,b]=await _this.layout.getLayers("shape-1","shape-2");a.shader.set("uColor",new Color("#ff0000")),b.shader.set("uColor",new Color("#0000ff")),b.shader.set("uSide",-1),_this.startRender((_=>{let progress=Math.range(Mouse.tilt.x,-.5,.5,-3,3,!0);a.shader.set("uProgress",progress),b.shader.set("uProgress",-progress)}))}()})),Class((function pTransition(_mesh,_shader){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color("#fff")},uProgress:{value:0},uSide:{value:1}})})),Class((function ViewCache(){Inherit(this,Component);this.sceneRepository={}}),"static"),Class((function ViewController(){Inherit(this,Object3D),Inherit(this,Router);const _this=this,ROUTES=[{path:"",key:"homePage",title:"Home"},{path:"chapter1",key:"chapter1Page",title:"Chapter 1"},{path:"chapter2",key:"chapter2Page",title:"Chapter 2"},{path:"chapter3",key:"chapter3Page",title:"Chapter 3"},{path:"test",key:"testPage"},{path:"news",key:"newsPage",title:"News"},{path:"technology",key:"technologyPage",title:"Technology"},{path:"connect",key:"contactPage",title:"Contact"},{path:"news/:id",key:"newsDetailPage"},{path:"mission",key:"aboutPage",title:"Mission"},{path:"privacy",key:"PrivacyPage",title:"Privacy Policy"},{path:"404",key:"errorPage",title:"Error"},{path:"faq",redirect:"technology"},{path:"partners",key:"partnersPage",title:"Partners"}],ROUTELESS=[{key:"menu",path:"menu"}],DIRECTIONS=["left","right","topRight","bottomLeft"];var _composite,_bloom,_audio,_current,_prev,_currentPage,_direction="left",_skipNextTransition=!1,_sceneMap={},_beige=new Color(Colors.value.black),_orange=new Color(Colors.value.orange);function loop(){_composite.uniforms.uBloomAdd.value=Math.lerp(ViewController.BLOOM_EXTRA,_composite.uniforms.uBloomAdd.value,.1)}function initRoute({key:key,path:path,children:children,redirect:redirect,title:title,isFirst:isFirst=!1}){if(redirect)return;let className=key.capitalize();if(_sceneMap[className])return;let instance=_this.initClass(InteractivePageWrapper,window[className],isFirst);_sceneMap[className]=instance,instance.key=className,instance.title=title,instance.visible=!1,children&&children.forEach((child=>{initRoute({key:child.key,path:child.path})}))}function createView(name){return{name:name,view:name.capitalize()}}function start(){startInteracting()}function end(){stopInteracting()}function press(e){}function down(e){32==e.keyCode&&(startInteracting(),!Utils.query("uil")&&GlobalAudio3D.initialized&&e.preventDefault())}function up(e){32==e.keyCode&&stopInteracting()}function startInteracting(){if(!_this.interacting&&(_this.interacting=!0,Instruction.CAN_INTERACT)){switch(Instruction.CAN_INTERACT){case"engine":_audio.engine.play(),_audio.engine.volume=0,tween(_audio.engine,{volume:1},3e3,"easeOutSine"),_audio["engine-fade"].play(),_audio["engine-fade"].volume=0,tween(_audio["engine-fade"],{volume:.5},4e3,"easeOutSine")}_this.events.fire(ViewController.INTERACTION,{down:!0}),tween(ViewController.SPEED_MULTI,{value:1},2500,"easeOutCubic")}}function stopInteracting(){if(_this.interacting){switch(_this.interacting=!1,Instruction.CAN_INTERACT){case!1:tween(_audio.engine,{volume:0},500,"easeOutSine",(_=>{_audio.engine.stop()})),tween(_audio["engine-fade"],{volume:0},500,"easeOutSine",(_=>{_audio["engine-fade"].stop()}));case"engine":tween(_audio.engine,{volume:0},500,"easeOutSine",(_=>{_audio.engine.stop()})),tween(_audio["engine-fade"],{volume:0},500,"easeOutSine",(_=>{_audio["engine-fade"].stop()}))}_this.events.fire(ViewController.INTERACTION,{down:!1}),tween(ViewController.SPEED_MULTI,{value:0},1500,"easeOutCubic")}}function onSmoothViewChange(e){}function onSmoothBottom(e){}function onSmoothTop(e){}function onRouteChange(from,to,path,params,route){CameraUtil.blockScroll(!1),CameraUtil.hardBlockScroll(!1),Track.event("pageChange",{page_path:`/${path}`},`navigateTo:${path}`);let next=_sceneMap[to.view];next||(next=_sceneMap[ErrorPage]),transition(next)}async function transition(next){_this.flag("transitioning",!0),next.visible=!0,_current&&_composite.set("tFrom",_current?.view.rt),_composite.set("tTo",next.view.rt),_composite.set("uTransitionColor",_this.isVisible?_orange:_beige),_current&&(_current.key==next.key?await _current.hide():_current.hide());let show=next.show();if(_prev=_current,"Menu"!=(_current=next).key&&(_currentPage=_current,_current.title?_this.setTitle(`${_current.title}`):_this.setTitle("Prometheus Fuels"),_this.events.fire(ViewController.UPDATE,next.key)),_composite.tween("uVignette","HomePage"==_current.key?1:0,1e3,"easeOutSine"),_skipNextTransition)_composite.set("uTransition",1);else{_composite.tween("uTransition0",1,750,"easeOutSine",0).promise();let time=_this.isVisible?1200:2e3;await _this.wait("isVisible"),await Promise.all([_composite.tween("uTransition",1,time,"easeOutSine").promise(),show])}_composite.set("uTransition0",.01),_composite.set("uTransition",.03),_composite.set("tFrom",_current?.view.rt),_composite.set("tTo",_current?.view.rt),_skipNextTransition=!1,_this.flag("transitioning",!1)}async function setDirection(direction="left"){DIRECTIONS.includes(direction)||(direction="left"),_direction=direction,await defer()}function resize(){_composite.set("uStageDimensions",new Vector2(Stage.width,Stage.height))}!async function(){Global.PLAYGROUND||(World.SCENE.add(_this.group),function initEager(){[...ROUTELESS].forEach((({key:key,path:path,children:children,title:title})=>{initRoute({key:key,path:path,children:children,title:title})}));let split=_this.getState().split("/"),match=ROUTES.find((route=>split.length>1?route.path==split[0]+"/:id":route.path==split[0]));match&&match.redirect&&(match=ROUTES.find((route=>route.path==match.redirect)));initRoute(match?{key:match.key,path:match.key,title:match.title,isFirst:!0}:{key:"errorPage",path:"error",title:"Error",isFirst:!0})}(),function initAudio(){(_audio={}).engine=_this.initClass(Audio3D,{src:"assets/audio/engine.mp3",loop:!1}),_audio["engine-fade"]=_this.initClass(Audio3D,{src:"assets/audio/engine-fade.mp3",loop:!1,volume:.1})}(),function initRoutes(){[...ROUTES].forEach((({key:key,path:path,children:children,title:title,redirect:redirect})=>{initRoute({key:key,path:path,children:children,title:title,redirect:redirect})})),_this.registerRoutes(onRouteChange,ROUTES.map((({path:path,key:key,children:children,title:title,redirect:redirect})=>{if(redirect)return{path:path,redirect:redirect,updateURL:!0};let data={path:path,view:createView(key),children:[]};return children&&children.forEach((child=>{let childData={path:child.path,view:createView(child.key)};data.children.push(childData)})),data})))}(),async function initCompositor(){_bloom=_this.initClass(FX.UnrealBloom,World.NUKE,{nMips:Tests.bloomMips(),enabled:Tests.bloomEnabled()},"sceneComposite"),(_composite=_this.initClass(NukePass,"SceneComposite",Utils.mergeObject({tTo:{value:Utils3D.getTexture("assets/images/_scenelayout/black.jpg"),ignoreUIL:!0},tFrom:{value:Utils3D.getTexture("assets/images/_scenelayout/black.jpg"),ignoreUIL:!0},tNoise:{value:Utils3D.getRepeatTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},tGrunge:{value:Utils3D.getRepeatTexture("assets/images/noise/grunge.jpg"),ignoreUIL:!0},uTransition0:{value:.01,ignoreUIL:!0},uTransition:{value:0,ignoreUIL:!0},uTransitionColor:{value:null,ignoreUIL:!0},uUVScale:{value:.8},uVignette:{value:0},uSpeed:ViewController.SPEED_MULTI,uFlipped:{value:0},uMobile:{value:Device.mobile?1:0},uRotation:{value:-60},uRGBShift:{value:1},uNoise:{value:0},uGrunge:{value:0},uBloomAdd:{value:0,ignoreUIL:!0},uStageDimensions:{value:new Vector2(Stage.width,Stage.height)},uDimensions:{value:new Vector2(1024,1024)}},_bloom.uniforms))).depthWrite=!1,_composite.depthTest=!1,_composite.upload(),ShaderUIL.add(_composite),World.NUKE.add(_composite),_this.mesh=new Mesh(World.QUAD,_composite.pass),_this.mesh.frustumCulled=!1,_this.add(_this.mesh)}(),function addHandlers(){_this.onResize(resize),_this.events.sub(ViewController.SOUNDS_ALL_STOP,stopInteracting),_this.events.sub(SmoothRenderManager.VIEW_CHANGE,onSmoothViewChange),_this.events.sub(SmoothRenderManager.BOTTOM,onSmoothBottom),_this.events.sub(SmoothRenderManager.TOP,onSmoothTop),Device.mobile?(_this.events.sub(Mouse.input,Interaction.START,start),_this.events.sub(Mouse.input,Interaction.END,end)):(_this.events.sub(Keyboard.DOWN,down),_this.events.sub(Keyboard.UP,up),_this.events.sub(Keyboard.UP,press))}(),_this.startRender(loop))}(),this.changeRoute=async function(route,direction="left",skipTransition=!1){return!_this.flag("transitioning")&&(_skipNextTransition=skipTransition,await setDirection(direction),_this.setState(route),!0)},_this.getCurrentPage=function(){return _currentPage},this.transition=async function(key,direction="left"){if(_this.flag("transitioning"))return!1;let next=_sceneMap[key];return await setDirection(direction),transition(next),!0},_this.transitionBack=async function(){if(_this.flag("transitioning"))return!1;let next=_prev;if(next){let direction="left";switch(_direction){case"left":direction="right";break;case"right":direction="left";break;case"topRight":direction="bottomLeft";break;case"bottomLeft":direction="topRight";break;default:direction="left"}return await setDirection(direction),transition(next),!0}},Dev.expose("changeRoute",this.changeRoute),Dev.expose("transition",this.transition),Dev.expose("transitionBack",this.transitionBack)}),"singleton",(()=>{ViewController.UPDATE="viewcontroller_update",ViewController.BLOOM_EXTRA=0,ViewController.SPEED_MULTI={value:0},ViewController.INTERACTION="viewcontroller_interaction",ViewController.NEWS_TRANSITION_ANIMATING="viewcontroller_news_animating",ViewController.NEWS_TRANSITION_IDLE="viewcontroller_news_idle",ViewController.SOUNDS_ALL_STOP="viewcontroller_sounds_all_stop"})),Class((function World(){Inherit(this,Component);const _this=this;let _renderer,_scene,_camera,_nuke,_controls;function resize(){_renderer.setSize(Stage.width,Stage.height),_camera.aspect=Stage.width/Stage.height,_camera.updateProjectionMatrix(),function updateBreakpoint(){Stage.width/Stage.height<1?SceneLayout.setBreakpoint("portrait"):SceneLayout.setBreakpoint("")}()}function loop(t,delta){_controls&&_controls.enabled&&_controls.update(),RenderManager.render()}World.DPR=Tests.getDPR(),function initWorld(){World.PLANE=new PlaneGeometry(1,1),World.QUAD=Utils3D.getQuad(),World.BOX=new BoxGeometry(1,1,1),World.SPHERE=new SphereGeometry(1,16,16),World.HIGH_PLANE=new PlaneGeometry(1,1,128,128),RenderManager.initialize(RenderManager.NORMAL,{powerPreference:"high-performance"}),_renderer=RenderManager.gl,_scene=RenderManager.scene,_camera=RenderManager.camera.worldCamera,_nuke=RenderManager.nuke,World.SCENE=_scene,World.RENDERER=_renderer,World.ELEMENT=$(_renderer.domElement),World.CAMERA=_camera,World.NUKE=_nuke,Tests.renderFXAA()&&_nuke.add(new FXAA)}(),RenderManager.type==RenderManager.NORMAL&&(Camera.instance(_camera),Render.capFPS=Tests.capFPS()),function initControls(){if(!window.DebugControls)return;const renderTypeNormal=RenderManager.type===RenderManager.NORMAL;if(!Utils.query("orbit")){let camera=new BaseCamera;return camera.group.position.set(0,0,6),void camera.lock()}const Controls=Utils.query("wasd")?WASDControls:DebugControls;_controls=new Controls(_camera,World.ELEMENT.div),renderTypeNormal?_controls.target=new Vector3(0,0,0):_controls.enabled=!1,World.CONTROLS=_controls,World.CAMERA.position.z=6}(),function addHandlers(){_this.events.sub(Events.RESIZE,resize),SceneLayout.breakpoint=Utils.query("breakpoint"),resize()}(),Utils.query("uilOnly")||Render.onDrawFrame(loop)}),(function(){var _instance;World.instance=function(){return _instance||(_instance=new World),_instance}})),Class((function ErrorPage(isFirst=!1){Inherit(this,InteractivePage,"error",isFirst);!async function(){}()})),Class((function ErrorSection(index,parentConfig,isFirst){Inherit(this,InteractiveSection,"errorMain",index,parentConfig,isFirst);const _this=this;var _text,_text2,_camera,_hitArea;function clickHome(){ViewController.instance().changeRoute("")}function resize(){let aspect=Stage.width/Stage.height;_camera.setFOV(Math.range(aspect,.4,1.6,55,30,!0)),_camera.group.position.x=Math.range(aspect,.4,1.6,-1.3,0),_camera.group.position.y=Math.range(aspect,.4,1.6,-.5,0)}!async function(){await _this.wait(_this,"isReady"),await CMS.ready(),_text=_this.layers.text,_text2=_this.layers.text2,_hitArea=_this.layers.hitArea,_camera=_this.layers.sceneCamera,_this.flag("textReady",!0),function addListeners(){Interaction3D.find(_camera).add(_hitArea,(()=>{}),clickHome),_this.onResize(resize),resize()}(),Global.PLAYGROUND&&_this.show()}(),_this.show=async function(){await _this.wait(_this,"textReady"),_this._show(),await _this.wait(_text,"shaderClass"),await _this.wait(_text2,"shaderClass"),_text.shaderClass.animateIn(),_text2.shaderClass.animateIn()},_this.hide=async function(){await _this.wait(_this,"textReady"),_this._hide(),_text.shaderClass.animateOut(),_text2.shaderClass.animateOut()}})),Class((function ErrorUI(){Inherit(this,InteractiveUI);const _this=this,$this=this.element;var _social;!function initSocial(){(_social=_this.initClass(MenuSocialv2,[$this])).element.css({position:"absolute",bottom:"4rem",right:"6rem"})}(),_this.animateIn=function(delay=300){_social.animateIn(delay)},_this.animateOut=async function(){return new Promise((async resolve=>{_social.animateOut(),resolve()}))}})),Class((function SceneView(){Inherit(this,Object3D);const _this=this;!function initMesh(){let mesh=new Mesh(new BoxGeometry(1,1,1),Utils3D.getTestShader());_this.add(mesh),_this.startRender((t=>{mesh.position.y=.3*Math.sin(.002*t),mesh.rotation.y+=.01,mesh.rotation.x+=.004})),World.SCENE.add(_this.group);let camera=_this.initClass(GazeCamera);camera.moveXY.set(8,4),camera.position.set(0,0,6),camera.lerpSpeed=.07,camera.lookAt=new Vector3,camera.lock()}()})),Class((function AboutPage(isFirst=!1){Inherit(this,InteractiveScrollPage,"about",isFirst);const _this=this;var _camera,_topLayer,_topScene,_scrollHint,_space,_section1,_section2,_section3,_section4,_section5,_section6,_section7,_sectionWrapper;async function resizeHandler(){await _this.wait("isReady");let aspect=Stage.width/Stage.height;_this.layout.breakpoint=aspect<1?"portrait":aspect<1.45?"tablet":"","portrait"==_this.layout.breakpoint?(_scrollHint.visible=!1,_section1.group.position.y=-1,_section2.group.position.y=-3.56,_section3.group.position.y=-5.7,_section4.group.position.y=-11.7,_section5.group.position.y=-13.9,_section6.group.position.y=-20.6,_section7.group.position.y=-23.6,_camera.bottom=-31,Device.mobile&&(_section1.group.position.y=-1,_section2.group.position.y=-3.56,_section3.group.position.y=-5.7,_section4.group.position.y=-13.2,_section5.group.position.y=-15.4,_section6.group.position.y=-23.6,_section7.group.position.y=-26.6,_camera.bottom=-35)):"tablet"==_this.layout.breakpoint&&Device.mobile?(_scrollHint.visible=!1,_section1.group.position.y=0,_section2.group.position.y=-2.11,_section3.group.position.y=-3.35,_section4.group.position.y=-10.1,_section5.group.position.y=-11.4,_section6.group.position.y=-18.4,_section7.group.position.y=-20,_camera.bottom=-29):Device.mobile?(_this.layout.breakpoint="portrait",_section1.group.position.y=-1,_section2.group.position.y=-3.56,_section3.group.position.y=-5.7,_section4.group.position.y=-11.7,_section5.group.position.y=-13.9,_section6.group.position.y=-20.6,_section7.group.position.y=-23.6,_camera.bottom=-31.5):""==_this.layout.breakpoint?(_scrollHint.visible=!0,_section1.group.position.y=0,_section2.group.position.y=-2.11,_section3.group.position.y=-3.35,_section4.group.position.y=-7.35,_section5.group.position.y=-8.8,_section6.group.position.y=-13,_section7.group.position.y=-14.8,_camera.bottom=-20):"tablet"==_this.layout.breakpoint&&(_scrollHint.visible=!0,_section1.group.position.y=0,_section2.group.position.y=-2.11,_section3.group.position.y=-3.35,_section4.group.position.y=-9.7,_section5.group.position.y=-11,_section6.group.position.y=-18,_section7.group.position.y=-19.8,_camera.bottom=-28),aspect<.6?(_camera.group.position.z=Math.range(aspect,1,.4,7,8),_sectionWrapper.position.y=-3,_topLayer.position.z=1.75):aspect<1.45?(_sectionWrapper.position.y=-1*(_topLayer.scale._y-_topLayer.position._y),_camera.group.position.z=6,_topLayer.position.z=0):(_camera.group.position.z=6,_sectionWrapper.position.y=-3.5,_topLayer.position.z=0),aspect<1?_topLayer.shader.set("uAngle",0):_topLayer.shader.set("uAngle",-5)}!async function(){await _this.ready(),[_camera,_topLayer,_topScene,_scrollHint,_space,_section1,_section2,_section3,_section4,_section5,_section6,_section7,_sectionWrapper]=await _this.layout.getLayers("camera","topLayer","topScene","scrollHint","space","section1","section2","section3","section4","section5","section6","section7","sectionWrapper"),_topLayer.renderOrder=-1,_space.renderOrder=-1,function addListeners(){_this.onResize(resizeHandler),_this.events.sub(_this,"LayerVisible",(e=>{Track.event("about",{items:[{item_id:`about_section_scroll_${e.key}`,item_name:`about_section_scroll_${e.key}`}]},`about:section:${e.key}`)}))}(),Dev.expose("about",_this),_this.flag("isReady",!0)}(),this.animateIn=async function(){await _this.wait("isReady"),_topScene.animateIn(),tween(_scrollHint,{alpha:0},0,"easeOutCubic"),tween(_scrollHint,{alpha:1},600,"easeOutCubic",1500);let z=_camera.group.position.z;_camera.group.position.z-=1.5,tween(_camera.group.position,{z:z},3e3,"easeOutCubic")},this.animateOut=async function(){},_this.onVisible=function(){CameraUtil.hardBlockScroll(!0)}})),Class((function AboutPageTest(){Inherit(this,Object3D);const _this=this;!async function(){let instance=_this.initClass(AboutSectionType4,{text1:"We also know that in order to succeed, our fuels can’t just be as good as fossil fuels, they have to be better. That’s why we’ve designed them to be high-performance and clean-burning. Most importantly, our fuels will cost the same or less than fossil fuels.",text2:"Given the magnitude of the crisis, there are some who think that the only way to respond is to fundamentally change who we are. To do and be less.\n\nWe, at Prometheus, think this would be a terrible mistake. We believe we can meet this epic challenge not in spite of, but because of who we are.\n\nThe urge to discover what lies beyond that far horizon, or that ocean, or this planet, is part of what makes us human. We are explorers and adventurers. We search for inspiration, for what’s new and what’s next. And we yearn to live better, larger lives. Throughout human existence, this restless impulse has led our species to overcome near unfathomable hardships. And it’s exactly this ability that we need now.\n\nWe shouldn’t shrink the scope of human experience. Instead, our goal should be to break the historical link between energy and the dirty fossil fuels that are destroying our world. Instead, we should make energy and the things we do with it in a brand new way.\n\nThis is our mission at Prometheus. We are propelled by the future we imagine—one in which everyone who wants to can experience the joy of a road trip, the thrill of flight, and, one day soon, the humbling awe of viewing the Earth from orbit.",text3:"We invite you to imagine this future, and if you find it as inspiring as we do, we hope you’ll join us."});_this.add(instance.layout.group)}()})),Class((function AboutSection(_input,_group){Inherit(this,Object3D);const _this=this;var _instance;!async function(){let instance,wildcard=_input.get("wildcard"),[type,id]=wildcard?.split("|")||[];switch(await CMS.ready(),id){case"1":instance=_this.initClass(window[type],{text1:CMS.get("about.text1")});break;case"2":instance=_this.initClass(window[type],{text1:CMS.get("about.text2")});break;case"3":instance=_this.initClass(window[type],{text1:CMS.get("about.text3"),text2:CMS.get("about.text4"),text3:CMS.get("about.text5")});break;case"4":instance=_this.initClass(window[type],{text1:CMS.get("about.text6")});break;case"5":instance=_this.initClass(window[type],{text1:CMS.get("about.text7"),text2:CMS.get("about.text8"),text3:CMS.get("about.text9")});break;case"6":instance=_this.initClass(window[type],{text1:CMS.get("about.text10")});break;case"7":instance=_this.initClass(window[type],{text1:CMS.get("about.text11"),text2:CMS.get("about.text12"),text3:CMS.get("about.text13")})}_instance=instance}(),_this.get("hit",(async()=>await _instance.hit)),_this.onVisible=()=>{_instance.onVisible()},_this.onInvisible=()=>{_instance.onInvisible()},_this.reset=()=>{_instance.reset()}})),Class((function AboutSectionType1(_input){Inherit(this,Object3D),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1;async function resize(){await _this.wait("textInitialized");let aspect=Stage.width/Stage.height;_this.layout.breakpoint=aspect<1?"portrait":aspect<1.45?"tablet":"",aspect<1?(Device.mobile,_text1.setPropertiesCheck({size:.5,width:3.4,lineHeight:1})):(Device.mobile,_text1.setPropertiesCheck({size:.3,width:3.4,lineHeight:1.2}))}!async function initScene(){_this.layout=_this.initClass(SceneLayout,"AboutSectionType1"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_input&&async function initText(){await _text1.ready(),_text1.setText(_input.text1.toUpperCase()),_this.flag("textInitialized",!0)}(),_this.onResize(resize)}()})),Class((function AboutSectionType2(_input){Inherit(this,Object3D),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2,_text3;async function resize(){await _this.wait("textInitialized");let aspect=Stage.width/Stage.height;if(_this.layout.breakpoint=aspect<1?"portrait":aspect<1.45?"tablet":"",aspect<1.45){_text1.setPropertiesCheck({size:.15,width:1.75,align:"center"}),_text2.setPropertiesCheck({size:.15,width:1.75,align:"center"}),_text3.setPropertiesCheck({size:.07,width:1.75,align:"center"});let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.1;let _text2Dimensions=await _text2.getDimensions();if(_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.3,Device.mobile){_text1.setPropertiesCheck({size:.15,width:1.4,align:"center"}),_text2.setPropertiesCheck({size:.15,width:1.4,align:"center"}),_text3.setPropertiesCheck({size:.07,width:1.4,align:"center"});let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.2;let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.4}_text1.group.position.x=0,_text2.group.position.x=0,_text3.group.position.x=0}else if(Device.mobile){_text1.setPropertiesCheck({size:.2,width:5,align:"center"}),_text2.setPropertiesCheck({size:.2,width:5,align:"center"}),_text3.setPropertiesCheck({size:.12,width:5,align:"center"}),_text1.group.position.x=0,_text2.group.position.x=0,_text3.group.position.x=0;let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.1;let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.3}else{_text1.setPropertiesCheck({size:.13,width:1.5,align:"left"}),_text2.setPropertiesCheck({size:.13,width:1.5,align:"left"}),_text3.setPropertiesCheck({size:.07,width:2.5,align:"left"}),_text1.group.position.x=-2.3,_text2.group.position.x=-2.3,_text3.group.position.x=-.291;let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.2,_text3.group.position.y=0}}!async function initScene(){_this.layout=_this.initClass(SceneLayout,"AboutSectionType2"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_text3=_this.layers.text3,_input&&async function initText(){_text1.setText(_input.text1.toUpperCase()),_text2.setText(_input.text2.toUpperCase()),_text3.setText(_input.text3),await _text1.ready();let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.2,_this.flag("textInitialized",!0)}(),_this.onResize(resize)}()})),Class((function AboutSectionType3(_input){Inherit(this,Object3D),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2;!async function initScene(){_this.layout=_this.initClass(SceneLayout,"AboutSectionType3"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_input&&async function initText(){await _text1.ready(),_text1.setText(_input.text1.toUpperCase()),_text2.setText(_input.text2.toUpperCase())}()}()})),Class((function AboutSectionType4(_input){Inherit(this,Object3D),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2,_text3;async function resize(){await _this.wait("textInitialized");let aspect=Stage.width/Stage.height;if(_this.layout.breakpoint=aspect<1?"portrait":aspect<1.45?"tablet":"",aspect<1.45){_text1.setPropertiesCheck({size:.15,width:1.75,align:"center"}),_text2.setPropertiesCheck({size:.07,width:1.75,align:"center"}),_text3.setPropertiesCheck({size:.07,width:1.75,align:"center"});let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.3;let _text2Dimensions=await _text2.getDimensions();if(_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.2,Device.mobile){_text1.setPropertiesCheck({size:.15,width:1.4,align:"center"}),_text2.setPropertiesCheck({size:.07,width:1.4,align:"center"}),_text3.setPropertiesCheck({size:.07,width:1.4,align:"center"});let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.3;let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.4}_text1.group.position.x=0,_text2.group.position.x=0,_text3.group.position.x=0}else if(Device.mobile){_text1.setPropertiesCheck({size:.2,width:5,align:"center"}),_text2.setPropertiesCheck({size:.12,width:5,align:"center"}),_text3.setPropertiesCheck({size:.12,width:5,align:"center"}),_text1.group.position.x=0,_text2.group.position.x=0,_text3.group.position.x=0;let _text1Dimensions=await _text1.getDimensions();_text2.group.position.y=_text1.group.position.y-_text1Dimensions.height-.3;let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.4}else{_text1.setPropertiesCheck({size:.13,width:1.5,align:"left"}),_text2.setPropertiesCheck({size:.07,width:2.5,align:"left"}),_text3.setPropertiesCheck({size:.07,width:2.5,align:"left"}),_text1.group.position.x=-2.3,_text2.group.position.x=-.291,_text3.group.position.x=-.291,_text2.group.position.y=0;let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.2}}!async function initScene(){_this.layout=_this.initClass(SceneLayout,"AboutSectionType4"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_text3=_this.layers.text3,_input&&async function initText(){_text1.setText(_input.text1.toUpperCase()),_text2.setText(_input.text2),_text3.setText(_input.text3),await _text2.ready(),await _text3.ready();let _text2Dimensions=await _text2.getDimensions();_text3.group.position.y=_text2.group.position.y-_text2Dimensions.height-.2,_this.flag("textInitialized",!0)}(),_this.onResize(resize)}()})),Class((function AboutSectionType5(textCopy1,textCopy2,textCopy3){Inherit(this,FXScene),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2,_text3;!async function initScene(){_this.create(),_this.layout=_this.initClass(SceneLayout,"AboutSectionType5"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_text3=_this.layers.text3,_this.scene.add(_this.layout.group),function initText(){_text1.setText(textCopy1.toUpperCase()),_text2.setText(textCopy2.toUpperCase()),_text3.setText(textCopy3)}()}()})),Class((function AboutSectionType6(){Inherit(this,FXScene),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2;!async function initScene(){_this.create(),_this.layout=_this.initClass(SceneLayout,"AboutSectionType6"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_this.scene.add(_this.layout.group),function initText(){let textCopy1="We know we have to move fast, maybe scaling faster than any industry has moved before.";_text1.setText(textCopy1.toUpperCase());let textCopy2="But we believe it’s possible and we have a plan to do it.";_text2.setText(textCopy2.toUpperCase())}()}()})),Class((function AboutSectionType7(textCopy1,textCopy2,textCopy3){Inherit(this,FXScene),Inherit(this,AbstractAboutSectionType);const _this=this;var _text1,_text2,_text3;!async function initScene(){_this.create(),_this.layout=_this.initClass(SceneLayout,"AboutSectionType7"),_this.layers=await _this.layout.getAllLayers(),_text1=_this.layers.text1,_text2=_this.layers.text2,_text3=_this.layers.text3,_this.scene.add(_this.layout.group),function initText(){_text1.setText(textCopy1.toUpperCase()),_text2.setText(textCopy1),_text3.setText(textCopy1)}()}(),initCamera()})),Class((function AboutSpaceBG(_mesh,_shader){function getTexture(src){let texture=Utils3D.getTexture(src);return texture.wrapS=texture.wrapT=Texture.MIRROR_REPEAT,texture}_shader.addUniforms({tMap:{value:null,getTexture:getTexture},tStars:{value:null,getTexture:getTexture},uScale2:{value:new Vector2(1,1)},uNoiseScale2:{value:new Vector2(1,1)},uTimeScale:{value:1},uMap:{value:new Vector2(0,1)}})})),Class((function AboutTopLayer(_mesh,_shader){Inherit(this,Component);const _this=this;function resizeHandler(){let aspect=Stage.width/Stage.height;_mesh.scale.x=aspect*_mesh.scale.y}!async function(){let scene=await _this.parent.getLayer("topScene");_mesh.scale.x,_mesh.scale.y,_shader.set("tMap",scene),_this.onResize(resizeHandler)}()})),Class((function AboutTopLayerShader(_mesh,_shader){_shader.addUniforms({tMap:{value:null},uAngle:{value:0}}),_mesh.renderOrder=999})),Class((function AboutTopScene(){Inherit(this,FXScene);const _this=this;var _text,_people,_space;async function resizeHandler(){let aspect=Stage.width/Stage.height;_this.layout.breakpoint=aspect<1?"portrait":aspect<1.45?"tablet":"",_space.scale.x=aspect*_space.scale.y,_people.scale.x=4.1*aspect,_people.scale.y=2.5625*aspect,_people.position.y=Math.range(aspect,0,2,-2,.5),Stage.width<Stage.height?_text.setText("OUR\nMISSION"):_text.setText("MISSION")}!async function(){_this.create(_this.parent?.parent?.nuke),_this.layout=_this.initClass(SceneLayout,"AboutTopScene"),_space=await _this.layout.getLayer("space"),await _this.layout.getLayer("earth"),_text=await _this.layout.getLayer("text"),_people=await _this.layout.getLayer("people"),_text.renderOrder+=100;let camera=await _this.layout.getLayer("camera");if(_this.useCamera(camera),_this.scene.add(_this.layout.group),_this.parent.getLayer){let parentCamera=await _this.parent.getLayer("camera");_this.startRender((_=>{camera.group.position.y=-.2*parentCamera.group.position.y,camera.group.position.z=-.4*parentCamera.group.position.y,camera.lookAt.y=.7*-parentCamera.group.position.y}))}!async function initText(){await _text.ready(),_this.flag("textInitialized",!0)}(),_this.onResize(resizeHandler),_this.isPlayground()&&defer((()=>{_this.animateIn()}))}(),_this.animateIn=async function(){await _text.ready(),_text.shaderClass&&_text.shaderClass.animateIn?(_text.shaderClass.reset(),_text.shaderClass.animateIn(ViewController.instance().isVisible?800:1500)):_text.shader.shaderClass&&_text.shader.shaderClass.animateIn?(_text.shader.shaderClass.reset(),_text.shader.shaderClass.animateIn(ViewController.instance().isVisible?800:1500)):console.warn("Text missing WaveTextShader shader class")},_this.animateOut=async function(){await _text.ready()}})),Class((function AbstractAboutSectionType(){Inherit(this,Component);const _this=this;var _texts,_hit;!async function(){await _this.wait(_this,"layers"),(_texts=await _this.layout.getAllMatching("text")).forEach((async text=>{await text.ready(),text.shader.transparent=!0,text.shader.set("uBoundingMin",text.shader.get("uBoundingMin").copy(text.text.dimensions.min)),text.shader.set("uBoundingMax",text.shader.get("uBoundingMax").copy(text.text.dimensions.max)),text.shader.set("uTransition0",0)})),function initHit(){let shader=_this.initClass(Shader,"InteractiveScrollSectionHitShader");(_hit=new Mesh(World.PLANE,shader)).scale.setScalar(.001),_hit.position.y=1,_hit.shader.transparent=!0,_hit.renderOrder=-1e3,_this.add(_hit),_this.flag("hitReady",!0)}()}(),_this.get("hit",(async()=>(await _this.wait(_this,"hitReady"),_hit))),_this.onInvisible=()=>{_this.shown&&(_this.shown=!1)},_this.onVisible=()=>{_this.shown||(_this.shown=!0,_this.animateIn&&_this.animateIn(),_this.animatedIn||function animateIn(){_texts.forEach(((text,index)=>{text.shaderClass&&text.shaderClass.animateIn?text.shaderClass.animateIn(300*index):text.shader.shaderClass&&text.shader.shaderClass.animateIn?text.shader.shaderClass.animateIn(300*index):console.warn("Text missing WaveTextShader shader class")}))}())},_this.hide=()=>{_this.animateOut&&_this.animateOut(),function animateOut(){_texts.forEach(((text,index)=>{text.shaderClass&&text.shaderClass.animateOut?text.shaderClass.animateOut(0):console.warn("Text missing WaveTextShader shader class")}))}(),_this.animatedIn=!1,_this.shown=!1},_this.reset=()=>{_this.shown=!1,_this.animatedIn=!1,_texts.forEach((async text=>{await text.ready(),text.shaderClass&&text.shaderClass.animateIn?text.shaderClass.reset():text.shader.shaderClass&&text.shader.shaderClass.reset?text.shader.shaderClass.reset():console.warn("Text missing WaveTextShader shader class")}))}})),Class((function CustomText3D(_mesh,_shader,_group,_input){Inherit(this,Component);!async function(){}()})),Class((function SolidColorShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color("#000000")},uAlpha:{value:.5}})})),Class((function Chapter1Page(isFirst=!1){Inherit(this,InteractivePage,"chapter1",isFirst);const _this=this;function onViewChange(e){e&&e.view&&e.view.parent===_this&&Track.event("chapter1",{items:[{item_id:`chapter1_screen_${e.index}`,item_name:`chapter1_screen_${e.index}`}]},`chapter1:section:${e.index}`)}!async function(){await _this.ready(),function addListeners(){_this.events.sub(SmoothRenderManager.VIEW_CHANGE,onViewChange)}()}()})),Class((function Chapter2Page(isFirst=!1){Inherit(this,InteractivePage,"chapter2",isFirst);const _this=this;function onViewChange(e){e&&e.view&&e.view.parent===_this&&Track.event("chapter2",{items:[{item_id:`chapter2_screen_${e.index}`,item_name:`chapter2_screen_${e.index}`}]},`chapter2:section:${e.index}`)}!async function(){await _this.ready(),function addListeners(){_this.events.sub(SmoothRenderManager.VIEW_CHANGE,onViewChange)}()}()})),Class((function Chapter3Page(isFirst=!1){Inherit(this,InteractivePage,"chapter3",isFirst);const _this=this;function onViewChange(e){e&&e.view&&e.view.parent===_this&&Track.event("chapter3",{items:[{item_id:`chapter3_screen_${e.index}`,item_name:`chapter3_screen_${e.index}`}]},`chapter3:section:${e.index}`)}!async function(){await _this.ready(),function addListeners(){_this.events.sub(SmoothRenderManager.VIEW_CHANGE,onViewChange)}()}()})),Class((function ChapterCopy(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$translate,$text,$sub,_cta;async function resize(){let width=Stage.width>Stage.height||!Device.mobile.phone?Math.min(Stage.width-100,Device.mobile?300:600):Stage.width-80;Device.mobile.phone&&(width=Math.min(310,Stage.width-70)),$text&&$text.resize({width:width}),$sub&&$sub.resize({width:width}),await defer();let height=0,textHeight=$text?.dimensions?.height||0,subHeight=$sub?.dimensions?.height||0;$text&&(height+=textHeight),$sub&&(height+=subHeight+30),_cta&&(height+=30),$wrapper.x=Math.max(40,.06*Stage.width),$wrapper.y=Stage.height-Math.max(40,.06*Stage.width)-height,Device.mobile.phone&&Stage.width<Stage.height&&($wrapper.x=Math.max(35,.06*Stage.width),$wrapper.y-=_config.dashboard?50:30),_config.top&&($wrapper.y=Math.max(40,.06*Stage.width)+300),_config.right&&($wrapper.x=Math.min(Stage.width-40,.94*Stage.width),Device.mobile.phone&&Stage.width<Stage.height&&($wrapper.x=Math.min(Stage.width-35,.94*Stage.width))),$sub&&$text&&($sub.y=textHeight+30),_cta&&_cta.element&&(_cta.element.y=0,$text&&(_cta.element.y+=textHeight+50),$sub&&(_cta.element.y+=subHeight+10))}_this.progress=0,async function(){!function init(){($wrapper=$gl()).hide(),_this.element.add($wrapper),($translate=$gl()).alpha=0,$wrapper.add($translate)}(),_config.copy&&await async function initText(){let size=Math.range(_config.copy.length,10,120,28,16,!0);Device.mobile.phone&&(size*=Stage.width>Stage.height?.6:.7);let text=_config.copy;Device.mobile&&(text=text.replace(/\n/g," "));$text=$glText(text.toString().toUpperCase(),"FuturaLT-Bold",size,{width:450,align:_config.right?"right":"left",lineHeight:Math.range(size,28,16,1.45,1.6),letterSpacing:0,color:_config.color||Colors.value.beige}),$translate.add($text),$text.textContent=text;let shader=_this.initClass(Shader,"ChapterCopyShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:-180},uTransition0:{value:1.01},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3},blending:_config.additive?Shader.ADDITIVE_BLENDING:Shader.NORMAL_BLENDING});$text.shader=shader,$text.useShader(shader),await $text.text.ready(),$text.text.shader.set("uBoundingMin",(new Vector3).copy($text.dimensions.min)),$text.text.shader.set("uBoundingMax",(new Vector3).copy($text.dimensions.max))}(),_config.sub&&function initSub(){let text=_config.sub;Device.mobile&&(text=text.replace(/\n/g," "));$sub=$glText(text.toString(),"FuturaLT-Medium",Device.mobile.phone?14:16,{width:320,align:"left",lineHeight:1.6,letterSpacing:0,color:_config.color||Colors.value.beige}),$translate.add($sub)}(),_config.cta&&function initCTA(){_cta=_this.initClass(CopyButton,{width:170,height:40,text:_config.cta,bg:_config.color||Colors.value.beige,color:_config.color==Colors.value.black?Colors.value.beige:Colors.value.black}),$translate.add(_cta.element),_this.events.sub(_cta,Events.CLICK,(_=>{ViewController.instance().changeRoute("news/prometheus-metaforge")}))}(),await _this.wait(100),function addHandlers(){_this.onResize(resize)}()}(),this.setCopy=async function(text){$text&&$text.setText(text),$wrapper.hide()},this.update=function(progress){if(!$translate)return;let offset=_config.start*_config.height*200;$translate.y=offset-progress*_config.height*200+80;let pos=Math.range(progress,_config.start,_config.end,-1,1);$translate.alpha=Math.smoothStep(1,.3,Math.abs(pos)),$text.shader.set("uRotation",pos>0?-180:0),$text.shader.set("uTransition0",Math.smoothStep(1,.3,Math.abs(pos))),_cta&&(_cta.element.alpha=Math.smoothStep(-.4,.1,pos)*Math.smoothStep(.8,.5,pos)),$translate.alpha>0?$wrapper.show():$wrapper.hide()},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1)}})),Class((function ChapterOverlay(_config){Inherit(this,GLUIElement);const _this=this;var $image;function resize(){$image.x=.9*Stage.width-100,$image.y=.85*Stage.height-100}_this.progress=0,async function(){!function initText(){($image=$gl(200,200,_config.src)).shader.transparent=!0,$image.alpha=0,_this.element.add($image)}(),function addHandlers(){_this.onResize(resize)}()}(),this.setImage=async function(image){$image.shader.set("tMap",Utils3D.getTexture(image))},this.update=function(progress){let movement=Math.range(progress,_config.start,_config.end,1,-1);$image.alpha=Math.smoothStep(1,.5,Math.abs(movement))},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0,$image.show(),$image.alpha=0,$image.y=10,$image.tween({alpha:1,y:0},1500,"easeOutQuart"))},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1,$image.tween({alpha:0,y:-10},600,"easeInSine",(_=>{$image.hide()})))}})),Class((function CopyButton(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$text,$bg,$hit;function hover(e){switch(e.action){case"over":$bg.tween({alpha:.5},300,"easeOutSine");break;case"out":$bg.tween({alpha:1},500,"easeOutSine")}}function click(){_this.events.fire(Events.CLICK,_config)}!async function(){!function initText(){$wrapper=$gl(),_this.element.add($wrapper),$bg=$wrapper.create(_config.width||200,_config.height||50,_config.bg||"#ff0000"),($text=$glText(_config.text.toString().toUpperCase(),"FuturaLT-Bold",10,{width:_config.width||200,align:"center",lineHeight:1.5,letterSpacing:0,color:_config.color||Colors.value.beige})).x=_config.width/2,$text.y=_config.height/2-5,$text.z+=.001,$wrapper.add($text),($hit=$gl(_config.width||200,_config.height||50,"empty")).shader.neverRender=!0,$wrapper.add($hit)}(),function addHandlers(){$hit.mesh.interactionScene=GLUI.Stage.scene,$hit.interact(hover,click)}()}(),this.animateIn=async function(delay=0){$wrapper.alpha=0,$wrapper.y=10,$wrapper.tween({alpha:1,y:0},1e3,"easeOutQuart",delay+200)},this.animateOut=async function(){}})),Class((function CoverTest(){Inherit(this,Object3D);const _this=this;!function(){let mesh=new Mesh(World.QUAD,_this.initClass(Shader,"ScreenQuad",{tMap:{value:LoaderCoverView.instance().rt}}));_this.add(mesh)}()})),Class((function Instruction(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$translate,$text;async function resize(){$wrapper.x=Stage.width/2,$wrapper.y=Stage.height-Math.max(40,.06*Stage.height)-(Device.mobile.phone?10:35)}_this.progress=0,async function(){!function init(){($wrapper=$gl()).hide(),_this.element.add($wrapper),($translate=$gl()).alpha=0,$wrapper.add($translate)}(),_config.copy&&await async function initText(){let text=(Device.mobile?"TAP AND HOLD TO\n":"HOLD SPACEBAR TO\n")+_config.copy;$text=$glText(text.toString().toUpperCase(),"FuturaLT-Bold",Device.mobile?10:12,{width:450,align:"center",lineHeight:1.5,letterSpacing:0,color:_config.color||Colors.value.orange}),$translate.add($text),$text.textContent=text;let shader=_this.initClass(Shader,"ChapterCopyShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:-180},uTransition0:{value:1.01},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3},blending:Shader.ADDITIVE_BLENDING});$text.shader=shader,$text.useShader(shader),await $text.text.ready(),$text.text.shader.set("uBoundingMin",(new Vector3).copy($text.dimensions.min)),$text.text.shader.set("uBoundingMax",(new Vector3).copy($text.dimensions.max))}(),function addHandlers(){_this.onResize(resize)}()}(),this.setCopy=async function(text){$text&&$text.setText(text),$wrapper.hide()},this.update=function(progress){if(!$translate)return;_config.start,_config.height;let pos=Math.range(progress,_config.start,_config.end,-1,1);$translate.alpha=Math.smoothStep(1,.3,Math.abs(pos)),$translate.alpha*=.9+.1*Math.sin(.01*Render.TIME),$text.shader.set("uRotation",pos<0?-180:0),$text.shader.set("uTransition0",Math.smoothStep(1,.3,Math.abs(pos))),$wrapper.alpha=Math.smoothStep(.8,0,ViewController.SPEED_MULTI.value),$translate.alpha>0?$wrapper.show():$wrapper.hide()},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0,resize(),Instruction.CAN_INTERACT=_config.type||!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1,Instruction.CAN_INTERACT=!1,_this.events.fire(ViewController.SOUNDS_ALL_STOP))}}),(_=>{Instruction.CAN_INTERACT=!1})),Class((function LandingCopy(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$translate,$title,$text,_button;function click(){ViewController.instance().changeRoute("mission")}function resize(){let offset=Device.mobile.phone?30:60;$wrapper.scale=1,$wrapper.x=Stage.width-offset-Config.SCROLL_PAGE_OFFSET,$wrapper.y=Stage.height-180,Device.mobile&&Stage.width>Stage.height&&($wrapper.scale=.7,$wrapper.y=Stage.height-170*$wrapper.scale)}!async function(){!function initText(){($wrapper=$gl()).hide(),_this.element.add($wrapper),$translate=$gl(),$wrapper.add($translate),$title=$glText(_config.title.toString().toUpperCase(),"FuturaLT-Bold",17,{width:400,align:"right",lineHeight:1.4,letterSpacing:0,color:_config.color||Colors.value.beige}),$translate.add($title),($text=$glText(_config.copy.toString(),"FuturaLT-Book",14,{width:260,align:"right",lineHeight:1.5,letterSpacing:0,color:_config.color||Colors.value.beige})).y=30,$translate.add($text)}(),function initButton(){(_button=_this.initClass(CopyButton,{width:120,height:36,text:_config.cta,bg:Colors.value.beige,color:Colors.value.black})).element.y=90,_button.element.x=-120,_button.animateIn(),$translate.add(_button.element)}(),function addHandlers(){_this.onResize(resize),_this.events.sub(_button,Events.CLICK,click)}()}(),this.setCopy=async function(text){$text.setText(text),$wrapper.hide()},this.update=function(progress){let movement=Math.range(progress,_config.start,_config.end,1,-1);$translate.alpha=Math.smoothStep(1,.3,-movement),$translate.alpha>0?$wrapper.show():$wrapper.hide()},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1)}})),Class((function LoaderCoverView(){Inherit(this,Component);const _this=this;var _capture,$container,$spinner;function resize(){$container.width=Stage.width,$container.height=Stage.height,$spinner.x=Stage.width/2-90,$spinner.y=Stage.height/2-90}_capture=_this.initClass(StageLayoutCapture,Stage.width,Stage.height),_this.rt=_capture.rt,function initSpinner(){$container=$gl(Stage.width,Stage.height,Colors.value.black);let shader=_this.initClass(Shader,"LoaderCoverShader");($spinner=$gl(180,180,"#000000")).useShader(shader),$spinner.x=Stage.width/2-90,$spinner.y=Stage.height/2-90,_capture.root.add($spinner),_capture.root.add($container)}(),function addListeners(){_this.onResize(resize)}()}),"singleton"),Class((function PrometheusInput({label:label,type:type,maxLength:maxLength,validator:validator}){Inherit(this,Element);const _this=this,$this=_this.element;var $label,$input,$inputWrapper,$underline;function handleFocus(){Stage.width<=600?($label.css({fontSize:"1.6rem",transform:"translateY(0rem) scale(0.7)"}),$input.css({fontSize:"1.6rem",padding:"1.3rem 0 0"})):($label.css({fontSize:"1rem",transform:"translateY(1rem) scale(0.7)"}),$input.css({fontSize:"1.6rem",padding:"1.4rem 0 0"}))}function handleFocusLoss(){_this.value||(Stage.width<=600?($label.css({fontSize:"1.6rem",transform:"translateY(1rem) scale(1)"}),$input.css({fontSize:"2.6rem",padding:"0rem 0 0"})):($label.css({fontSize:"1rem",transform:"translateY(2rem) scale(1)"}),$input.css({fontSize:"2.8rem",padding:"0rem 0 0"})))}function handleValueChange(e){_this.value=$input.div.value}function resize(){Stage.width<=600?($label.css({fontSize:"1.6rem",transform:"translateY(1rem) scale(1)"}),$input.css({fontSize:"2.6rem",padding:"0rem 0 0"})):($label.css({fontSize:"1rem",transform:"translateY(2rem) scale(1)"}),$input.css({fontSize:"2.8rem",padding:"0rem 0 0"}))}!function initHTML(){if($label=$this.create("label"),$inputWrapper=$this.create("input_wrapper"),$input=$inputWrapper.create("input","input"),"password"===type&&$input.attr("type","password"),"email"===type&&$input.attr("type","email"),"file"===type&&$input.attr("type","file"),$input.attr("tabindex","0"),label){let stripped=label.replace(" ","");$input.attr("name",stripped),$input.attr("aria-labeledby",stripped+"_label"),$label.attr("for",stripped),$label.attr("id",stripped+"_label"),$label.text(label)}maxLength&&$input.attr("maxlength",maxLength),$underline=$this.create("underline")}(),function initStyles(){$this.css({position:"relative",display:"flex",flexDirection:"column"}),$this.css({opacity:0}).transform({y:10}),$label.css({fontSize:"1rem",position:"relative",fontFamily:"'FuturaLT-Bold', sans-serif",textTransform:"uppercase",transformOrigin:"0% 50%",transform:"translateY(4rem) scale(1)",WebkitTransition:"all 100ms cubic-bezier(0.33, 1, 0.68, 1)"}),$inputWrapper.css({position:"relative",fontSize:"1.6rem"}),$input.css({position:"relative",fontSize:"5.6rem",width:"100%",WebkitTransition:"all 100ms cubic-bezier(0.33, 1, 0.68, 1)"}),$underline.css({position:"relative",width:"100%",height:"1px",background:Colors.value.beige})}(),function addListeners(){$input.bind("focusin",handleFocus),$input.bind("focusout",handleFocusLoss),$input.bind("change",handleValueChange),$input.bind("input",handleValueChange),_this.onResize(resize)}(),_this.animateIn=function(delay=0){$this.tween({opacity:1,y:0},400,"easeInOut",delay)},_this.animateOut=async function(delay=0){await $this.tween({opacity:0},400,"easeInOut",delay).promise(),$this.transform({y:10})},_this.getValue=function(){let valid=!0;return validator&&(valid=validator(_this.value)),{valid:valid,value:_this.value}}})),Class((function ScrollPrompt(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$translate,$circle,$arrow;function resize(){$wrapper.x=.62*Stage.width-.5*_this.size,$wrapper.y=Stage.height-1.18*_this.size,Device.mobile.phone&&Stage.width<Stage.height&&($wrapper.x=.3*Stage.width-.5*_this.size,$wrapper.y=Stage.height-1.25*_this.size)}_this.progress=0,_this.size=Device.mobile.phone?150:220,async function(){!function init(){($wrapper=$gl(_this.size,_this.size)).hide(),_this.element.add($wrapper),($translate=$gl(_this.size,_this.size)).alpha=0,$wrapper.add($translate)}(),function initText(){($circle=$gl(_this.size,_this.size)).x=.5*_this.size,$circle.y=.5*_this.size,$translate.add($circle);let $inside=$gl(_this.size,_this.size,"assets/images/ui/star-circle.png");$inside.x=.5*-_this.size,$inside.y=.5*-_this.size,$inside.textureShader.blending=Shader.ADDITIVE_BLENDING,$inside.shader.blending=Shader.ADDITIVE_BLENDING,$circle.add($inside),($arrow=$gl(.4*_this.size,.4*_this.size,"assets/images/ui/down-arrow.png")).x=.3*_this.size,$arrow.y=.3*_this.size,$arrow.textureShader.blending=Shader.ADDITIVE_BLENDING,$arrow.shader.blending=Shader.ADDITIVE_BLENDING,$translate.add($arrow)}(),function addHandlers(){_this.onResize(resize)}()}(),this.setImage=async function(image){$image.shader.set("tMap",Utils3D.getTexture(image))},this.update=function(progress){let offset=_config.start*_config.height*-100;$translate.y=offset-progress*_config.height*-100-40,$circle.rotation-=.3*Render.HZ_MULTIPLIER;let pos=Math.range(progress,_config.start,_config.end,-1,1);$translate.alpha=.8*Math.smoothStep(1,.3,Math.abs(pos)),$translate.alpha>0?$wrapper.show():$wrapper.hide()},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1)}})),Class((function DashboardGraph(_config){Inherit(this,GLUIElement);const _this=this;var $wrapper,$topLabel,$destination,$topLabelSub,$bottomlabel,$bottomlabelSub,$number,$numberLabel,$icon,$iconLabel,$iconSub,_boxes,$boxes;_this.width=110,_this.height=200;var _extra=_config.negative?5:0,_color=new Color(_config?.color||Colors.value.teal),_positive=new Color(_config?.color||Colors.value.teal),_negative=new Color("#1c87ff");async function addText(text="text",size="12",align="left",link=!1){let $text=$glText(text.toString().toUpperCase(),"FuturaLT-Bold",size,{width:450,align:align,lineHeight:Math.range(size,28,16,1.45,1.6),letterSpacing:0,color:_config?.color||Colors.value.teal});return $wrapper.add($text),await $text.text.ready(),$text.text.shader.blending=Shader.ADDITIVE_BLENDING,link&&($text.text.shader.uniforms.uColor.value=_color),$text}!async function(){_this.isPlayground()&&(_this.element.x=200,_this.element.y=200,_this.startRender((_=>{_this.update(.5-.5*Math.sin(.001*Render.TIME))}))),function init(){$wrapper=$gl(),_this.element.add($wrapper)}(),await async function initText(){($topLabel=await addText(_config?.top||"",_config?.topSub?16:18,"right")).x=-9,$topLabel.y=5,($topLabelSub=await addText(_config?.topSub||"",9,"right")).x=-9,$topLabelSub.y=_config?.top?30:5,($bottomlabel=await addText(_config?.bottom||"",_config?.bottomSub?16:18,"right")).x=-9,$bottomlabel.y=_config?.bottomSub?_this.height-30:_this.height-13,($bottomlabelSub=await addText(_config?.bottomSub||"",9,"right")).x=-9,$bottomlabelSub.y=_config?.bottom?_this.height-5:_this.height-20,($number=await addText(_config?.number||"",21,"left",!0)).x=_this.width+6,$number.y=_this.height/2-9,($numberLabel=await addText(_config?.numberLabel||"",10,"left",!0)).x=_this.width+6,$numberLabel.y=_this.height/2+20,($icon=$wrapper.create(35,35,"assets/images/ui/"+(_config?.icon||"molecule")+".png")).x=-4,$icon.y=_this.height+12,$icon.textureShader.blending=Shader.ADDITIVE_BLENDING,$icon.shader.blending=Shader.ADDITIVE_BLENDING,($iconLabel=await addText(_config?.iconLabel||"",17,"left",!1)).x=38,$iconLabel.y=_this.height+20,($iconSub=await addText(_config?.iconSub||"",8,"left",!1)).x=0,$iconSub.y=_this.height+52,($destination=await addText(_config?.destination||"",13,"right",!1)).y=-90,$destination.x=_this.width+45}(),function initBars(){let padding=4,width=_this.width-padding,height=(_this.height-9*padding)/10,y=padding;$boxes=$gl(),$wrapper.add($boxes),_boxes=[];for(var i=0;i<10+_extra;i++){let $box=$boxes.create(width,height,_config?.color||Colors.value.teal);$box.textureShader.blending=Shader.ADDITIVE_BLENDING,$box.shader.blending=Shader.ADDITIVE_BLENDING,i>9&&($box.shader.uniforms.uColor.value=_color),$box.y=y,_boxes.push($box),y+=height+padding}}()}(),this.update=function(p){if(!_boxes)return;let progress=_config.negative?Math.range(p,1,.5,1,0,!0)+Math.range(p,.5,0,0,-1,!0):p,negative=!!(_config.negative&&p<.5);if(_color.lerp(negative?_negative:_positive,.12),_boxes.forEach((($box,i)=>{let index=10-i-1,start=.1*index,end=.1*(index+1);$box.alpha=.15+.85*Math.smoothStep(0,.8,Math.range(progress,start,end,0,1,!0)),i>9&&($box.alpha=Math.range($box.alpha,.15,1,.5,0))})),!isNaN(_config?.number)){let number=_config?.number*progress,fixed=_config?.number<100?1:0;$number.setText(number.toFixed(fixed))}},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1)}})),Class((function DashboardOverlay({type:type="fillup",start:start=.2,end:end=1,height:height=2,left:left}){Inherit(this,GLUIElement);const _this=this;var $wrapper,$bg,$translate,_left,_right,_config;switch(_this.progress=0,_this.interact="fillup"==type,_this.bg=0,type){case"fillup":_config=[{top:"F",bottom:"E",number:16,numberLabel:"GAL",icon:"gas",iconLabel:"GAS",iconSub:"Zero Net Carbon"},{direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",number:314,numberLabel:"LBS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}];break;case"truck":_config=[{top:2137,topSub:"MILES",bottom:"0",bottomSub:"MILES",number:356,numberLabel:"GAL",icon:"gas",iconLabel:"DIESEL",iconSub:"Zero Net Carbon"},{destination:"Origin: Port of Los Angeles\nDestination: Chicago",direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",number:4,numberLabel:"TONS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}];break;case"plane":_config=[{top:2475,topSub:"MILES",bottom:"0",bottomSub:"MILES",color:"#38807a",number:5325,numberLabel:"GAL",icon:"gas",iconLabel:"JETFUEL",iconSub:"Zero Net Carbon"},{destination:"Origin: JFK\nDestination: LAX",direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",color:"#38807a",number:56,numberLabel:"TONS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}];break;case"spirits":_config=[{topSub:"PARTY",bottomSub:"NIP",number:750,numberLabel:"ML",icon:"whiskey",iconLabel:"SPIRITS",iconSub:"Zero Net Carbon"},{direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",number:383,numberLabel:"GRAMS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}];break;case"store":_config=[{top:"100%",topSub:"INVENTORY",bottomSub:"INVENTORY",bottom:"0%",number:1159,numberLabel:"LBS",icon:"camping",iconLabel:"GOODS",iconSub:"banked-carbon"},{negative:!0,direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",number:1.8,numberLabel:"TONS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}];break;case"camp":_config=[{top:216,topSub:"MILES",bottomSub:"MILES",bottom:"0",number:13.5,numberLabel:"GAL",icon:"gas",iconLabel:"GAS",iconSub:"Zero Net Carbon"},{destination:"Origin: Los Angeles city limits\nDestination: Mojave Desert",direction:1,topSub:"Polluted\nPast",bottomSub:"Net Zero\nFuture",number:265,numberLabel:"LBS",icon:"molecule",iconLabel:"CO2",iconSub:"Emissions"}]}function resize(){let scale=Math.range(Stage.width,0,1800,0,1,!0);$wrapper.scaleX=scale,$wrapper.scaleY=scale;let offset=(Device.mobile.phone,15),scroll=Device.mobile?0:15;if($wrapper.x=Stage.width-offset-scroll-$wrapper.width*scale,$wrapper.y=Stage.height-offset-$wrapper.height*scale,left&&($wrapper.x=40),Device.mobile.phone&&Stage.width<Stage.height){let scale=Math.range(Stage.width-40,0,$wrapper.width,0,1,!0);$wrapper.scaleX=scale,$wrapper.scaleY=scale,$wrapper.x=Stage.width-20-$wrapper.width*scale,$wrapper.y=Stage.height-5-$wrapper.height*scale,"fillup"==type&&($wrapper.y-=50)}}!async function(){_this.isPlayground()&&(_this.element.x=150,_this.element.y=100),function init(){($wrapper=$gl()).width=540,$wrapper.height=350,_this.element.add($wrapper),($translate=$gl()).alpha=1,$wrapper.add($translate),($bg=$translate.create($wrapper.width,$wrapper.height,"#000000")).x=0,$bg.y=0,$bg.alpha=.4,$bg.z=-.01,$bg.textureShader.blending=Shader.SUBTRACTIVE_BLENDING,$bg.shader.blending=Shader.SUBTRACTIVE_BLENDING}(),function initGraphs(){(_left=_this.initClass(DashboardGraph,_config[0])).element.x=$wrapper.width/2-_left.width-52,_left.element.y=45,$translate.add(_left.element),(_right=_this.initClass(DashboardGraph,_config[1])).element.x=$wrapper.width/2+55,_right.element.y=45,$translate.add(_right.element)}(),function addHandlers(){_this.onResize(resize)}()}(),this.setCopy=async function(text){$wrapper.hide()},this.update=function(progress){if(!$translate)return;let pos=Math.range(progress,start,end,-1,1,!0);$translate.alpha=Math.smoothStep(-1,-.6,pos),$wrapper.alpha=.98+.01*Math.sin(.017*Render.TIME)+.01*Math.sin(.028*Render.TIME),_this.interact?(_left.update(ViewController.SPEED_MULTI.value),_right.update(1-ViewController.SPEED_MULTI.value)):(_left.update(Math.smoothStep(-.9,.2,pos)),_right.update(1-Math.smoothStep(-.9,.2,pos))),$bg.alpha=Math.smoothStep(-1,0,pos)*_this.bg},this.animateIn=async function(){_this.isVisible||(_this.isVisible=!0)},this.animateOut=async function(){_this.isVisible&&(_this.isVisible=!1)}})),Class((function ContactPage(isFirst=!1){Inherit(this,InteractivePage,"contact",isFirst);const _this=this;!async function(){await _this.ready()}()})),Class((function ContactSection(index,parentConfig,isFirst){Inherit(this,InteractiveSection,"contactMain",index,parentConfig,isFirst);const _this=this;var _text,_camera;function resize(){let aspect=Stage.width/Stage.height;_camera.setFOV(Math.range(aspect,1,1.6,95,30,!0)),_text.group.position.y=aspect<1?-20:0}!async function(){await _this.wait(_this,"isReady"),await CMS.ready(),(_text=_this.layers.text).setText(CMS.get("contact.title").replace(/<br>/g,"\n")),_camera=_this.layers.sceneCamera,_this.flag("textReady",!0),function addListeners(){_this.onResize(resize),resize()}()}(),_this.show=async function(){await _this.wait(_this,"textReady"),_this._show(),_text.shaderClass.animateIn()},_this.hide=async function(){await _this.wait(_this,"textReady"),_this._hide(),_text.shaderClass.animateOut()}})),Class((function ContactUI(){Inherit(this,InteractiveUI);const _this=this,$this=_this.element,FIELDS=[{key:"firstName",label:"First Name"},{key:"lastName",label:"Last Name"},{key:"email",label:"Email Address",type:"email",validator:email=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(email).toLowerCase())}];var $container,$header,$form,$error,$bottom,$desc,$button,$containerTitle,$title,_social,_inputs=[],_formFields={};function showError(type){"email"==type?$error.text(_this.config.emailError):$error.text(_this.config.generalError),$error.css({display:"initial"}),$error.transform({y:10}).tween({y:0,opacity:1},400,"easeOutCubic")}function resize(){Stage.width<=600?Device.mobile?($this.css({height:"fit-content"}),$container.css({width:"90%",position:"relative",top:"initial",left:"initial",transform:"initial",padding:"2rem 0 5rem",margin:"auto"}),$containerTitle.css({width:"90%",bottom:"initial",position:"relative",left:"initial",top:"initial",margin:"auto",padding:"12rem 0 0rem"}),$header.css({fontSize:"1.6rem",paddingBottom:"2rem",width:"100%"}),$title.css({fontSize:"7rem",textAlign:"left"}),_social.element.css({position:"relative",bottom:"initial",right:"initial",padding:"0 5% 5rem"})):($this.css({height:"fit-content"}),$container.css({width:"90%",position:"relative",top:"initial",left:"initial",transform:"initial",padding:"2rem 0 5rem",margin:"auto"}),$containerTitle.css({width:"90%",bottom:"initial",position:"relative",left:"0",top:"15%",margin:"auto",padding:"12rem 0rem 0rem"}),$header.css({fontSize:"1.6rem",marginBottom:"0",paddingBottom:"2rem",width:"100%"}),$title.css({fontSize:"7rem",textAlign:"left"}),_social.element.css({position:"relative",bottom:"initial",right:"initial",padding:"0 5% 5rem"})):Stage.width<=960?Device.mobile?($this.css({height:"fit-content"}),$container.css({width:"90%",position:"relative",top:"initial",left:"initial",transform:"initial",padding:"2rem 0 5rem",margin:"auto"}),$containerTitle.css({width:"90%",bottom:"initial",position:"relative",left:"0",top:"15%",margin:"auto",padding:"10rem 0px 10rem"}),$header.css({fontSize:"1.6rem",marginBottom:"0",paddingBottom:"2rem",width:"100%"}),$title.css({fontSize:"9rem",textAlign:"center"}),_social.element.css({position:"relative",bottom:"initial",right:"initial",padding:"0 5% 5rem"})):($this.css({height:"fit-content"}),$container.css({width:"90%",position:"relative",top:"initial",left:"initial",transform:"initial",padding:"2rem 0 5rem",margin:"auto"}),$containerTitle.css({width:"90%",bottom:"initial",position:"relative",left:"0",top:"15%",margin:"auto",padding:"14rem 0px 5rem"}),$header.css({fontSize:"1.6rem",marginBottom:"0",paddingBottom:"2rem",width:"100%"}),$title.css({fontSize:"9rem",textAlign:"center"}),_social.element.css({position:"relative",bottom:"initial",right:"initial",padding:"0 5% 5rem"})):($this.css({height:"100vh"}),$container.css({width:"30vw",top:"50%",left:"75%",transform:"translate(-50%, -50%)",padding:"initial",margin:"initial"}),$containerTitle.css({position:"absolute",left:"50%",width:"35vw",bottom:"8rem",left:"8rem",top:"initial",padding:"10rem 0rem 0rem",transform:"translateX(0%)"}),$header.css({fontSize:"2.6rem",paddingBottom:"initial",width:"87%",margin:"revert"}),$title.css({fontSize:"16rem",textAlign:"left"}),_social.element.css({position:"absolute",bottom:"4rem",right:"4rem"}))}function onButtonHover(e){"over"==e.action?$button.tween({scale:.9},300,"easeOutCubic"):$button.tween({scale:1},300,"easeOutCubic")}async function onButtonClick(e){$error.css({display:"none"});let formData={},errors={};if(Object.keys(_formFields).forEach((key=>{let input=_formFields[key],{value:value,valid:valid}=input.getValue();valid||(errors[key]=!0),formData[key]=value})),0==Object.keys(errors).length){Track.event("sign_up",{method:"Newsletter"},"newsletter");try{const result=await post(Config.NEWSLETTER_URL,formData);result&&result.success?_this.animateSuccess():showError()}catch(e){showError()}}else 1==Object.keys(errors).length&&errors.email?showError("email"):showError()}_this.config=Config.CONTACT,function initHTML(){$containerTitle=$this.create("container_title"),($title=$containerTitle.create("header","h1")).text(_this.config.title),$container=$this.create("container"),($header=$container.create("header","h5")).text(_this.config.header),$form=$container.create("form"),FIELDS.forEach((({key:key,label:label,type:type,validator:validator})=>{let $input=_this.initClass(PrometheusInput,{key:key,label:label,type:type,validator:validator},[$form]);_inputs.push($input),_formFields[key]=$input})),($error=$form.create("error")).text("error"),$bottom=$container.create("bottom"),($desc=$bottom.create("desc")).text(_this.config.description),($button=$bottom.create("button")).bg("assets/images/ui/right-arrow.png"),$button.interact(onButtonHover,onButtonClick,"#","submit button")}(),function initStyles(){$this.css({position:"relative",height:"fit-content",width:"100vw"}),$containerTitle.css({position:"absolute",width:"35vw",height:"fit-content",color:Colors.value.black,bottom:"8rem",left:"8rem",opacity:"0",padding:"10rem 0 0"}),$title.css({fontFamily:"marscondensed-regular-TRIAL, sans-serif",fontSize:"16rem",lineHeight:"0.8",position:"relative",textTransform:"uppercase",textAlign:"left",backgroundSize:"cover",webkitBackgroundClip:"text",backgroundClip:"text",color:"transparent",display:"block",margin:"auto"}),$title.bg("assets/images/textures/grains_3.jpg"),$container.css({position:"absolute",width:"30vw",height:"fit-content",color:Colors.value.beige,top:"50%",left:"75%",transform:"translate(-50%, -50%)",padding:"2rem 0 5rem",display:"block",margin:"auto"}),$header.css({fontFamily:"'Futura', sans-serif",fontWeight:700,fontSize:"2.6rem",position:"relative",lineHeight:"1",width:"87%"}),$header.css({opacity:0}).transform({y:10}),$form.css({display:"grid",gridGap:"1rem",position:"relative",paddingBottom:"6rem"}),$error.css({fontFamily:"'Futura', sans-serif",fontWeight:500,color:Colors.value.black,opacity:0,fontSize:"1.1rem",lineHeight:"1.3",display:"none",zIndex:-1,bottom:"2rem",textTransform:"uppercase",fontWeight:"700"}),$bottom.css({position:"relative",display:"flex",justifyContent:"spaceBetween"}),$bottom.css({opacity:0}).transform({y:10}),$desc.css({fontFamily:"'Futura', sans-serif",fontWeight:500,fontSize:"1.1rem",lineHeight:"1.3",position:"relative"}),$button.css({width:"20rem",height:"5rem",paddingLeft:"4rem",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"relative"})}(),function initSocial(){(_social=_this.initClass(MenuSocialv2,[$this])).element.css({position:"absolute",bottom:"4rem",right:"4rem",display:"flex"})}(),function addListeners(){_this.onResize(resize)}(),_this.isPlayground()&&Container.instance().element.add($this),_this.animateIn=function(delay=300){$containerTitle.tween({opacity:1},200,"easeInOut",delay),$header.tween({opacity:1,y:0},400,"easeInOut",delay),_inputs.forEach(((input,index)=>{input.animateIn(delay+200*index+1)})),$bottom.css({opacity:0,y:10}),$bottom.tween({opacity:1,y:0},400,"easeInOut",delay+200*_inputs.length),_social.animateIn(200*_inputs.length+200)},_this.animateOut=async function(){return new Promise((async resolve=>{_inputs.forEach(((input,index)=>{input.animateOut()})),$containerTitle.tween({opacity:0},200,"easeInOut").promise(),$header.tween({opacity:0},200,"easeInOut"),_social.animateOut(),await $bottom.tween({opacity:0},200,"easeInOut").promise(),$header.transform({y:10}),$bottom.transform({y:10}),resolve()}))},_this.animateSuccess=async function(){return new Promise((async resolve=>{_inputs.forEach(((input,index)=>{input.animateOut()})),await $containerTitle.tween({opacity:0},200,"easeInOut").promise(),$title.text(_this.config.success),await $containerTitle.tween({opacity:1},200,"easeInOut").promise(),console.log("asdasd"),await $header.tween({opacity:0},200,"easeInOut").promise(),await $bottom.tween({opacity:0},200,"easeInOut").promise(),_social.animateOut(),$header.transform({y:10}),$bottom.transform({y:10}),resolve()}))}})),Class((function HomePage(isFirst=!1){Inherit(this,InteractivePage,"home",isFirst);const _this=this;function onViewChange(e){e&&e.view&&e.view.parent===_this&&Track.event("homepage",{items:[{item_id:`homepage_screen_${e.index}`,item_name:`homepage_screen_${e.index}`}]},`homepage:section:${e.index}`)}!async function(){await _this.ready(),function addListeners(){_this.events.sub(SmoothRenderManager.VIEW_CHANGE,onViewChange)}()}(),this.animateIn=function(){},this.animateOut=function(){}})),Class((function HomeTestSection(){Inherit(this,InteractiveSection,"homeTestSection");const _this=this;!async function(){await _this.ready()}()})),Class((function TestHomeUI(){Inherit(this,Element);const $this=this.element;!function initHTML(){$this.size("100%","100vh"),$this.css({})}()})),Class((function LoaderView(){Inherit(this,Element);const _this=this,$this=this.element;let $logo,$bg,$wrapper,$rings,$rings2,$colorbg;!function initHTML(){$this.size("100%").setZ(100),$this.css({top:0,left:0,position:"fixed",backgroundSize:"cover",backgroundPosition:"center",zIndex:999999}),$colorbg=$this.create(".colorbg"),$colorbg.size("100%").bg(Colors.value.black),$bg=$this.create(".bg"),$bg.size("100%").bg("assets/images/about/stars-repeat.jpg").css({backgroundSize:"512px 512px",backgroundRepeat:"repeat",opacity:0}),$bg.tween({opacity:.2},1e3,"easeInOutSine",100)}(),function initLogo(){$logo=$this.create("logo"),$logo.size(80,80).center().bg("assets/images/ui/prometheus-logo.png"),$logo.css({opacity:0}).transform({scale:.85,rotation:0}),$wrapper=$this.create(".wrapper"),$wrapper.size("100%"),$wrapper.css({opacity:0}).transform({scale:1.05,rotation:0}),$wrapper.inner=$wrapper.create(".wrapper-rotate"),$wrapper.inner.size("100%"),_this.delayedCall((_=>{$logo.tween({opacity:1,scale:1,y:0,rotation:0},1e3,"easeOutBack"),$wrapper.tween({opacity:1,scale:1,y:0,rotation:0},1e3,"easeOutBack")}),200),$rings2=$wrapper.inner.create("rings2"),$rings2.svg("assets/images/ui/rings.svg"),$rings2.css({width:"100%",height:"100%"}),$rings=$wrapper.inner.create("rings"),$rings.svg("assets/images/ui/rings.svg"),$rings.css({width:"100%",height:"100%"})}(),this.progress=function(e){},this.animateOut=async function(callback){$colorbg.tween({opacity:0},1e3,"easeOutSine"),$wrapper.tween({opacity:0,scale:.95},600,"easeOutCubic"),$logo.tween({opacity:0,scale:.95},800,"easeOutCubic",100),$this.tween({opacity:0},1500,"easeInOutSine",500).onComplete((()=>callback&&callback()))}})),Class((function Menu(){Inherit(this,InteractivePage,"menu");const _this=this,$this=_this.element;!async function(){!async function init(){await _this.ready(),$this.css({overflow:"",height:"100%"})}(),_this.isPlayground()&&_this.delayedCall((()=>{_this.show()}),100)}(),_this.onVisible=function(){CameraUtil.hardBlockScroll(!0)}})),Class((function ColorBlockShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color("#000000")}})})),Class((function MenuNavigation($parent){Inherit(this,Component);const _this=this;var $container,_totalHeight=0,_currRoute="";const NAV_ITEMS=[{text:"HOME",path:"",order:1},{text:"MISSION",path:"mission",order:2},{text:"TECHNOLOGY",path:"technology",order:3},{text:"NEWS",path:"news",order:4},{text:"PARTNERS",path:"partners",order:5},{text:"CONNECT",path:"connect",order:6}];var $navItems=[];function onItemHover(e){let $el;if($el=e?.mesh?e.mesh.glui:e.object,!_this.flag("isAnimating")&&!$el.active)switch(e.action){case"over":$el.tween({x:10},600,"easeOutQuart"),$el.shader.set("uRotation",80),$el.shader.tween("uTransition0",1,600,"easeOutQuart");break;case"out":$el.tween({x:0},1e3,"easeOutQuart"),$el.shader.set("uRotation",-80),$el.shader.tween("uTransition0",0,1e3,"easeOutQuart")}}function onItemClick(e){if(_this.flag("isAnimating"))return;let $el;$el=e?.mesh?e.mesh.glui:e.object,$el.path==ViewController.instance().currentRoute.path?ViewController.instance().transitionBack():ViewController.instance().changeRoute($el.path)}async function resize(){await _this.wait(_this,"contentReady");let scaleLimit=Stage.width>1440?.9:.8;$container.scale=Math.range(Stage.height,0,750,0,1,!0),$container.scale*=Math.range(Stage.width,400,1440,.45,scaleLimit,!0),Stage.width<800?($container.x=25,$container.y=95):Device.mobile.phone&&Stage.width>Stage.height?($container.x=Stage.width/2-300,$container.y=70):($container.x=150*Math.range(Stage.width,400,1440,.1,1,!0),$container.y=Stage.height/2-_totalHeight*$container.scale/2),$container.y,_totalHeight*$container.scale}!async function(){!function init(){($container=$gl()).y=0,$parent.add($container),_currRoute=ViewController.instance().currentRoute?.path}(),async function initNavItems(){let promises=NAV_ITEMS.map((async(item,index)=>new Promise((async resolve=>{let $item=await async function createText({text:text,path:path,order:order}){return new Promise((async resolve=>{let $item=$glText(text,"marscondensed-regular-TRIAL",120,{width:"Infinity",align:"left",letterSpacing:-.03,color:path===_currRoute?Colors.value.orange:Colors.value.beige});$item.visible=!0,$item.textContent=text,$item.order=order;let shader=_this.initClass(Shader,"MenuItemShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uHoverColor:{value:new Color("#9f9992")},uUVScale:{value:.8},uRotation:{value:180},uTransition0:{value:0},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3}});$item.shader=shader,$item.useShader(shader),await $item.text.ready(),$item.mesh.tag="menunav",$item.text.shader.set("uBoundingMin",(new Vector3).copy($item.dimensions.min)),$item.text.shader.set("uBoundingMax",(new Vector3).copy($item.dimensions.max)),$item.path=path,$item.mesh.interactionScene=GLUI.Stage.scene,$item.interact(onItemHover,onItemClick,"#",text),resolve($item)}))}(item);index>0&&($item.y=$item.dimensions.height*index),_totalHeight+=$item.dimensions.height,$item.targetY=$item.y+50,$item.index=index,$container.add($item),$navItems.push($item),resolve()}))));await Promise.all(promises);let _seo={root:_this.findParent("MenuSection").scene,seo:NAV_ITEMS.map((item=>({url:item.path,label:item.text})))},_meshes=$navItems.sort(((a,b)=>a.order-b.order)).map((item=>item.mesh));Interaction3D.find(World.CAMERA).add(_meshes,onItemHover,onItemClick,_seo),Stage.width>600?$container.y=Stage.height/2-_totalHeight/2:$container.y=0;_this.flag("contentReady",!0)}(),function addListeners(){_this.onResize(resize)}(),_this.isPlayground()&&_this.animateIn(),resize()}(),_this.show=async function(){await _this.wait(_this,"contentReady"),_currRoute=ViewController.instance().currentRoute?.path,$navItems.forEach(($item=>{$item.path==_currRoute?($item.setColor(Colors.value.orange),$item.active=!0):($item.setColor(Colors.value.beige),$item.active=!1),$item.tween({alpha:1},400,"easeOutCubic"),$item.tween({x:0},10,"easeOutQuart"),$item.shader.set("uRotation",-80),$item.shader.tween("uTransition0",0,10,"easeOutQuart")}))},_this.hide=function(){},_this.getDimensions=async function(){let scale=Math.range(Stage.height,0,750,0,1,!0);return scale*=Math.range(Stage.width,600,1440,.45,1,!0),{y:$container.y,height:_totalHeight*scale}}})),Class((function MenuSection(){Inherit(this,InteractiveSection,"menu");const _this=this;var _mobileCarousel,_menuNavigation,_stack;async function resize(){await defer(),doCarousel()}async function doCarousel(){let h=Stage.height,w=Stage.width;if(Stage.width<=600||Device.mobile&&!(Stage.width>Stage.height)){_mobileCarousel||(_mobileCarousel=_this.initClass(MobileCarousel,{parent:_this.glui,hit:_this.ui.element}));let{height:height,y:y}=await _menuNavigation.getDimensions();h===Stage.height&&w===Stage.width||resize(),_mobileCarousel.resize(height+y),_this.visible&&_mobileCarousel.show(),_stack&&_stack.animateOut()}else _mobileCarousel&&_mobileCarousel.hide(),_this.visible&&_stack.show()}!async function(){await _this.wait(_this,"isReady"),_menuNavigation=_this.initClass(MenuNavigation,_this.glui),_stack=_this.initClass(MenuStack,_this.glui),_this.flag("sectionReady",!0),function addListeners(){_this.onResize(resize),resize()}(),_this.parent.isPlayground()&&(await defer(),_this.show())}(),_this.animateIn=async function(){await _this.wait(_this,"sectionReady"),_menuNavigation.show(),await doCarousel(),resize()},_this.animateOut=function(){_menuNavigation&&_menuNavigation.hide(),_stack&&_stack.hide()}})),Class((function MenuSignup(){Inherit(this,DOMTemplate);const _this=this;var $this,_elements=[];!async function(){$this=_this.element}(),this.visible=function(){$this.visible()},this.style=function(){return"\n        @font-face {\n            font-family: 'FuturaLT-Bold';\n            src: url('../fonts/FuturaLT-Bold.ttf') format('truetype');\n            font-weight: 400;\n            font-style: normal;\n        }\n\n        #Stage, #Stage * {\n            // * {\n            //     position: relative;\n            // }\n            .MenuSignup, {\n                width: 100%;\n                position: fixed;\n                bottom: 30%;\n                left: 100px;\n                width: 31%;\n            }\n            .Signup {\n                position: relative;\n                width: 100%;\n                opacity: 0;\n            }\n            .Signup_Title_Wrapper {\n                position: relative;\n                width: 100%;\n            }\n            .Signup_Title {\n                position: absolute;\n                top: 0%;\n                left: 0%;\n                font-family: 'FuturaLT-Bold', sans-serif;\n                font-size: 2rem;\n                color: #E74833;\n                width: 100%;\n            }\n            .CTA {\n                position: absolute;\n                top: 4rem;\n                left: 0%;\n                font-family: 'Futura LT Medium', sans-serif;\n                font-size: 1.0rem;\n                line-height: 1.6rem;\n                color: #D8D8D8;\n                width: 30%;\n            }\n            .Data {\n                position: absolute;\n                top: 4rem;\n                left: 40%;\n                font-family: 'Futura LT Medium', sans-serif;\n                font-size: 0.8rem;\n                line-height: 1.15rem;\n                color: #D8D8D8;\n                width: 60%;\n            }\n            .CheckboxLabel {\n                position: absolute;\n                top: 13rem;\n                left: 0%;\n                font-family: 'FuturaLT-Bold', sans-serif;\n                font-size: 1.1rem;\n                color: #D8D8D8;\n                // width: 40%;\n            }\n            .Checkbox {\n                position: absolute;\n                top: 11.9rem;\n                left: 26%;\n                width: 3.5rem;\n                height: 3.5rem;\n                border: 0.15rem solid #D8D8D8;\n                border-radius: 0.7rem;\n            }\n            .EmailInput_Placehoder {\n                position: absolute;\n                top: 11.8rem;\n                left: 40%;\n                width: 40%;\n                height: 3.5rem;\n                font-family: 'FuturaLT-Bold', sans-serif;\n                font-size: 1.1rem;\n                color: #D8D8D8;\n                display: flex;\n                align-items: center;\n            }\n            .EmailInput {\n                position: absolute;\n                top: 11.8rem;\n                left: 40%;\n                width: 40%;\n                height: 3.5rem;\n                font-family: 'FuturaLT-Bold', sans-serif;\n                font-size: 1.1rem;\n                color: #D8D8D8;\n            }\n            .EmailUnderline {\n                position: absolute;\n                top: 15.2rem;\n                left: 40%;\n                width: 45%;\n                height: 0.15rem;\n                background-color: #D8D8D8;\n            }\n            .EmailArrow_Wrapper {\n                position: absolute;\n                top: 11.8rem;\n                right: 0%;\n            }\n            .EmailArrow {\n                position: relative;\n                width: 3.5rem;\n                height: 3.5rem;\n            }\n            .EmailArrowL1 {\n                position: absolute;\n                top: 50%;\n                right: 0;\n                width: 2.3rem;\n                height: 0.15rem;\n                background-color: #D8D8D8;\n                transform-origin: top right;\n                transform: rotate(45deg)\n            }\n            .EmailArrowL2 {\n                position: absolute;\n                top: 50%;\n                right: 0;\n                width: 2.3rem;\n                height: 0.15rem;\n                background-color: #D8D8D8;\n                transform-origin: top right;\n                transform: rotate(-45deg)\n            }\n            .EmailArrowL3 {\n                position: absolute;\n                top: 50%;\n                right: 0;\n                width: 3.5rem;\n                height: 0.15rem;\n                background-color: #D8D8D8;\n            }\n        }        \n        "},this.render=function(html){return html`
            <div class="Signup">
                <div class="Signup_Title">
                    JOIN THE REVOLUTION
                </div>
                <div class="CTA">
                    Enter your email to receive updates on what we\'re doing and how you can support us.
                </div>
                <div class="Data">
                    We are collecting this information so that we can contact you in the future with updates about our product. We will never share it with any third party companies and you may unsubscribe at any time by following the instructions in the emails you receive.
                </div>
                <div class="CheckboxLabel">
                    I UNDERSTAND
                </div>
                <div class="Checkbox"></div>
                <div class="EmailInput_Placehoder">
                    ENTER EMAIL ADDRESS
                </div>
                <input class="EmailInput" />
                <div class="EmailUnderline"></div>
                <div class="EmailArrow_Wrapper">
                    <div class="EmailArrow">
                        <div class="EmailArrowL1"></div>
                        <div class="EmailArrowL2"></div>
                        <div class="EmailArrowL3"></div>
                    </div>
                </div>
            </div>
        `},this.postRender=async function(){let $signup=await _this.querySelector(".Signup");_elements.push($signup),_this.flag("hasElements",!0)},_this.animateIn=async function(delay=0){return await _this.wait("hasElements"),_elements[0].css({opacity:0}),_elements[0].tween({opacity:1},500,"easeInOutQuad",delay).promise()},_this.animateOut=async function(delay=0){return await _this.wait("hasElements"),_elements[0].tween({opacity:0},500,"easeInOutQuad",delay).promise()},this.getElements=async function(){return await _this.wait("hasElements"),_elements}})),Class((function MenuSocial($parent){Inherit(this,DOMTemplate);const _this=this;var $this,_elements=[];!async function(){$this=_this.element,$parent[0].div.classList.contains("MenuSection")&&$this.div.classList.add("isMenu")}(),this.visible=function(){$this.visible()},this.style=function(){return"\n\n        #Stage, #Stage * {\n            \n            .MenuSocial {\n                position: fixed;\n                bottom: 4rem;\n                right: 5%;\n                width: 13rem;\n                height: 5rem;\n                &.isMenu {\n                    position: absolute !important;\n                    .Social {\n                        transition: opacity 500ms cubic-bezier(0.455, 0.03, 0.515, 0.955) 500ms !important;\n                    }\n                }\n                @media screen and (max-width: 600px) {\n                    bottom: 3rem;\n                    right: 0; \n                    width: 13rem;\n                    height: 5rem;\n                    left: 20px;\n                    transform: initial;\n                }\n            }\n\n            .Social {\n                position: relative;\n                width: 100%;\n                height: 100%;\n                display: flex;\n                align-items: center;\n                justify-content: space-between;\n                opacity:0;\n            }\n            .Social_Link {\n                display: flex;\n                width: 100%;\n                height: 100%;\n                z-index: 1;\n                justify-content: center;\n                align-items: center;\n            }\n            .Social_Facebook_Wrapper {\n                position: relative;\n                width: 4rem;\n                height: 4rem;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                cursor: pointer;\n                &:hover {\n                    .Social_Facebook_Border {\n                        width: 90%;\n                        height: 90%;\n                    }\n                    .Social_Facebook_Img {\n                        width: 50%;\n                        height: 50%;\n                    }\n                }\n            }\n            .Social_Facebook_Img {\n                width: 40%;\n                height: 40%;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .Social_Facebook_Border {\n                width: 100%;\n                height: 100%;\n                border: 2px solid #D8D8D8;\n                border-radius: 3.5rem;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .Social_Instagram_Wrapper {\n                position: relative;\n                width: 4rem;\n                height: 4rem;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                cursor: pointer;\n                &:hover {\n                    .Social_Instagram_Border {\n                        width: 90%;\n                        height: 90%;\n                    }\n                    .Social_Instagram_Img {\n                        width: 50%;\n                        height: 50%;\n                    }\n                }\n            }\n            .Social_Instagram_Img {\n                width: 40%;\n                height: 40%;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .Social_Instagram_Border {\n                width: 100%;\n                height: 100%;\n                border: 2px solid #D8D8D8;\n                border-radius: 3.5rem;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .Social_Twitter_Wrapper {\n                position: relative;\n                width: 4rem;\n                height: 4rem;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                cursor: pointer;\n                &:hover {\n                    .Social_Twitter_Border {\n                        width: 90%;\n                        height: 90%;\n                    }\n                    .Social_Twitter_Img {\n                        width: 50%;\n                        height: 50%;\n                    }\n                }\n            }\n            .Social_Twitter_Img {\n                width: 40%;\n                height: 40%;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .Social_Twitter_Border {\n                width: 100%;\n                height: 100%;\n                border: 2px solid #D8D8D8;\n                border-radius: 3.5rem;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n\n        \n        }        \n        "},this.render=function(html){return html`
            <div class="Social">
                <div class="Social_Facebook_Wrapper">
                    <a href="https://www.facebook.com/prometheusfuels/" target="blank" title="Prometheus Facebook" class="Social_Link">
                        <img src="assets/images/icons/facebook.png" alt="Prometheus Facebook" class="Social_Facebook_Img"/>
                    </a>
                    <div class="Social_Facebook_Border"></div>
                </div>
                <div class="Social_Instagram_Wrapper">
                    <a href="https://www.instagram.com/prometheusfuels/" target="blank" title="Prometheus Instagram" class="Social_Link">
                        <img src="assets/images/icons/instagram.png" alt="Prometheus Instagram" class="Social_Instagram_Img"/>
                    </a>
                    <div class="Social_Instagram_Border"></div>
                </div>
                <div class="Social_Twitter_Wrapper">
                    <a href="https://twitter.com/prometheusfuels/" target="blank" title="Prometheus Twitter" class="Social_Link">
                        <img src="assets/images/icons/twitter.png" alt="Prometheus Twitter" class="Social_Twitter_Img" />
                    </a>
                    <div class="Social_Twitter_Border"></div>
                </div>
            </div>
        `},this.postRender=async function(){let $social=await _this.querySelector(".Social");_elements.push($social),_this.flag("hasElements",!0)},this.animateIn=async function(delay=0){return await _this.wait("hasElements"),_elements[0].css({opacity:0}),_elements[0].tween({opacity:1},500,"easeInOutQuad",delay).promise()},_this.animateOut=async function(delay=0){return await _this.wait("hasElements"),_elements[0].tween({opacity:0},500,"easeInOutQuad",delay).promise()},this.getElements=async function(){return await _this.wait("hasElements"),_elements}})),Class((function MenuSocialv2(){Inherit(this,Element);const _this=this,$this=_this.element;var $container;const SOCIAL_ITEMS=[{image:"assets/images/icons/twitter.png",path:"https://twitter.com/prometheusfuels/",label:"Twitter"},{image:"assets/images/icons/linkedin.png",path:"https://www.linkedin.com/company/prometheusfuels/",label:"LinkedIn"},{image:"assets/images/icons/instagram.png",path:"https://www.instagram.com/prometheusfuels/",label:"Instagram"},{image:"assets/images/icons/facebook.png",path:"https://www.facebook.com/prometheusfuels/",label:"Facebook"}];var $socialItems=[];function hover(e){switch(e.action){case"over":e.object.tween({scale:.9,opacity:.8},200,"easeOutCubic");break;case"out":e.object.tween({scale:1,opacity:1},400,"easeOutCubic")}}function click(e){Track.event("share",{method:e.object.networkName},e.object.networkName),window.open(e.object.path,"_blank")}!async function(){!async function init(){$container=$this.create("social_container"),$this.css({position:"relative"}),$container.css({position:"relative",display:"inline-flex",alignItems:"center",flexWrap:"wrap",gap:"1rem"}),SOCIAL_ITEMS.forEach((async(item,index)=>{let $icon=$container.create("social_icon");index&&$icon.css({marginLeft:item.label.match("Facebook")?5:10}),$icon.css({height:"23px",width:"23px",position:"relative",opacity:0,display:"flex",justifyContent:"center",alignItems:"center"});let $iconImage=$icon.create("social_image");$iconImage.css({height:"100%",width:"100%",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"}).bg(item.image),$icon.networkName=item.label,$icon.path=item.path,$icon.index=index,$icon.interact(hover,click,item.path,item.label);let $socialItem={icon:$icon,iconImage:$iconImage};$socialItems.push($socialItem)}))}(),_this.isPlayground()&&_this.animateIn()}(),this.animateIn=async function(delay=1e3){return new Promise((async resolve=>{if(_this.flag("isShowing"))resolve();else{_this.flag("isShowing",!0);let anims=$socialItems.map((async($item,index)=>$item.icon.tween({opacity:1},800,"easeOutCubic",delay+100*index).promise()));await Promise.all(anims),resolve()}}))},this.animateOut=async function(delay=0){return new Promise((async resolve=>{if(_this.flag("isShowing")){_this.flag("isShowing",!1);let anims=$socialItems.map((async $item=>$item.icon.tween({opacity:0},400,"easeOutCubic").promise()));await Promise.all(anims),resolve()}else resolve()}))}})),Class((function MenuTop(){Inherit(this,DOMTemplate);const _this=this;var _elements=[];function close(){_this.flag("isOpen",!1),_elements[0]?.tween({scale:1},600,"easeOutCubic"),_elements[1]?.tween({rotation:0,y:0},600,"easeOutCubic"),_elements[2]?.tween({scale:1,y:8,x:0},600,"easeOutCubic"),_elements[3]?.tween({rotation:0,y:16},600,"easeOutCubic"),_elements[4]?.tween({x:0,opacity:0},600,"easeOutCubic")}async function onLogoClick(){if(_this.flag("isOpen")&&"HomePage"==ViewController.instance().getCurrentPage().key){await ViewController.instance().transitionBack()&&close()}else{await ViewController.instance().changeRoute("","right")&&close()}}async function onMenuClick(){if(_this.flag("isOpen")){await ViewController.instance().transitionBack()&&close()}else{await ViewController.instance().transition("Menu","topRight")&&function open(){_this.flag("isOpen",!0),_elements[0]?.tween({scale:.7,scaleX:1},600,"easeOutCubic"),_elements[1]?.tween({rotation:45,y:10,scaleX:1},600,"easeOutCubic"),_elements[2]?.tween({scale:0,x:-100,y:10,scaleX:1},600,"easeOutCubic"),_elements[3]?.tween({rotation:-45,y:8,scaleX:1},600,"easeOutCubic"),_elements[4]?.tween({x:-100,opacity:1,scaleX:1},600,"easeOutCubic")}()}}function onMenuEnter(){_this.flag("isOpen")||(_elements[1]?.tween({y:0,scaleX:.8},300,"easeOutCubic"),_elements[3]?.tween({y:16,scaleX:.8},300,"easeOutCubic"))}function onMenuLeave(){_this.flag("isOpen")||(_elements[1]?.tween({y:0,x:0,scaleX:1},500,"easeOutCubic"),_elements[3]?.tween({y:16,x:0,scaleX:1},500,"easeOutCubic"))}function onRouteChange(){close()}!async function(){!function initHTML(){_this.element.attr("aria-label","menu-top")}(),function addListeners(){_this.events.sub(ViewController.UPDATE,onRouteChange)}()}(),this.style=function(){return"\n        @font-face {\n            // font-family: 'FuturaLT-Bold';\n            // src: url('../fonts/FuturaLT-Bold.ttf') format('truetype');\n            font-family: 'marscondensed-regular-TRIAL';\n            src: url('../fonts/marscondensed-regular-TRIAL.otf') format('opentype');\n            font-weight: 400;\n            font-style: normal;\n        }\n\n        #Stage, #Stage * {\n            .Menu {\n                position: absolute;\n                z-index: 9999;\n            }\n            .MenuTop, {\n                position: fixed;\n                top: 3rem;\n                height: 7rem;\n                left: 50%;\n                width: 100%;\n                transform: translateX(-50%);\n                display: contents;\n            }\n            .Top {\n                position: relative;\n                width: 100%;\n                height: 100%;\n                display: contents;\n            }\n            .Logo {\n                position: absolute;\n                left: 40px;\n                top: 40px;\n                width: 6rem;\n                height: 6rem;\n                transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                img {\n                    height: 100%;\n                }\n                &:hover {\n                    cursor: pointer;\n                    opacity: 0.5;\n                    transform: scale(0.8) !important;\n                }\n            }\n            .TopBuger_Wrapper {\n                position: absolute;\n                right: 40px;\n                top: 50px;\n                width: 100px;\n                height: 80px;\n            }\n            .TopBuger {\n                position: relative;\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                cursor: pointer;\n                transform-origin: 50% 50%;\n\n                &__close {\n                    opacity: 0;\n                    position:absolute;\n                    font-family:Futura, sans-serif;\n                    color: #D8D8D8;\n                    font-weight:700;\n                    fontSize: 1.6rem;\n                    text-transform:uppercase;\n                }\n\n                .TopBurgerL1 {\n                    position: absolute;\n                    transform: translateY(0px);\n                    width: 100%;\n                    height: 2px;\n                    background-color: #ee2f22;\n                }\n                .TopBurgerL2 {\n                    position: absolute;\n                    transform: translateY(8px);\n                    width: 100%;\n                    height: 2px;\n                    background-color: #ee2f22;\n                }\n                .TopBurgerL3 {\n                    position: absolute;\n                    transform: translateY(16px);\n                    width: 100%;\n                    height: 2px;\n                    background-color: #ee2f22;\n                }\n            }\n            \n        }        \n        "},this.render=function(html){return html`
            <div class="Top">
                <div class="Logo">
                    <img src="assets/images/test/prometheus-logo.png" @click="${onLogoClick}"/>
                </div>
                <div class="TopBuger_Wrapper" @click="${onMenuClick}" @mouseenter="${onMenuEnter}" @mouseleave="${onMenuLeave}">
<!--                    <div class="TopBuger__close">Close</div>-->
                    <div class="TopBuger">
                        <div class="TopBurgerL1"></div>
                        <div class="TopBurgerL2"></div>
                        <div class="TopBurgerL3"></div>
                    </div>
                </div>
            </div>
        `},this.postRender=async function(){let $logo=await _this.querySelector(".Logo");_elements.push($logo);let $topBurgerL1=await _this.querySelector(".TopBurgerL1");_elements.push($topBurgerL1);let $topBurgerL2=await _this.querySelector(".TopBurgerL2");_elements.push($topBurgerL2);let $topBurgerL3=await _this.querySelector(".TopBurgerL3");_elements.push($topBurgerL3);let $close=await _this.querySelector(".TopBuger__close");_elements.push($close),_this.flag("hasElements",!0)},_this.animateIn=async function(){await _this.wait("hasElements"),_elements.forEach(((el,index)=>{0==index?el.css({opacity:0}).tween({opacity:1},3e3,"easeOutCubic"):el.css({opacity:0}).transform({scaleX:0}).tween({opacity:1,scaleX:1},index-250,"easeOutCubic")}))},this.getElements=async function(){return await _this.wait("hasElements"),_elements}})),Class((function MenuUI(){Inherit(this,InteractiveUI);const _this=this,$this=_this.element;var $content,$link,_social;function resize(){Stage.width<600?($content.css({alignItems:"flex-start",justifyContent:"center",bottom:"2rem",right:"unset",left:"1rem"}).transform({scale:.8}),$link.css({fontSize:"1.2rem"})):Device.mobile&&Stage.width>Stage.height?(_social.element.css({display:"block"}),$content.css({alignItems:"flex-start",justifyContent:"unset",bottom:"1rem",right:"unset",left:"7.5rem"}).transform({x:"0",scale:.6}),$link.css({fontSize:"1.4rem"})):(_social.element.css({display:"block"}),$content.css({alignItems:"flex-end",justifyContent:"unset",bottom:"4rem",right:"4rem",marginRight:Config.SCROLL_PAGE_OFFSET,left:"unset"}).transform({x:"0",scale:1}),$link.css({fontSize:"1.2rem"})),Device.mobile&&Stage.width<Stage.height?$this.css({height:window.innerHeight}):$this.css({height:"100%"})}function onLinkHover(e){"over"==e.action?$link.tween({opacity:.5},200,"easeOutCubic"):$link.tween({opacity:1},400,"easeOutCubic")}function onLinkClick(e){ViewController.instance().changeRoute("privacy")}$this.css({width:"100vw",height:"100%"}),($content=$this.create("content")).css({display:"flex",flexDirection:"column",alignItems:"flex-end",bottom:"4rem",right:"4rem"}),($link=$content.create("link")).text("Privacy Policy"),$link.css({position:"relative",fontWeight:"500",color:"#FDF0E1",textDecoration:"underline",fontFamily:"Futura, sans-serif",fontSize:"1.2rem",paddingBottom:"1rem",lineHeight:"2.4rem",whiteSpace:"nowrap",opacity:0}),$link.interact(onLinkHover,onLinkClick,"privacy","privacy"),_social=_this.initClass(MenuSocialv2,[$content]),_this.onResize(resize),_this.onVisible=function(){},_this.onInvisible=function(){},_this.animateIn=function(){return $link.tween({opacity:1},300,"easeOutCubic",1200),_social.animateIn()},_this.animateOut=async function(){return $link.tween({opacity:0},300,"easeOutCubic"),_social.animateOut()}})),Class((function MobileMenuNavigation($parent){Inherit(this,Object3D);const _this=this;var $container,_totalHeight=0,_currRoute="";const NAV_ITEMS=[{text:"HOME",path:""},{text:"ABOUT",path:"about"},{text:"TECHNOLOGY",path:"technology"},{text:"NEWS",path:"news"},{text:"CONNECT",path:"connect"}];var $navItems=[];function onItemHover(e){if(!_this.flag("isAnimating"))switch(e.action){case"over":e.object.tween({alpha:.33},200,"easeOutCubic");break;case"out":e.object.tween({alpha:1},400,"easeOutCubic")}}function onItemClick(e){_this.flag("isAnimating")||(e.object.path==ViewController.instance().currentRoute.path?ViewController.instance().transitionBack():ViewController.instance().changeRoute(e.object.path))}async function resize(){await _this.wait(_this,"contentReady"),$container.scale=Math.range(Stage.height,0,750,0,1,!0),$container.scale*=Math.range(Stage.width,400,1440,.5,1,!0),""!=SceneLayout.breakpoint?($container.x=25,$container.y=75):($container.x=150,$container.y=Stage.height/2-_totalHeight/2*1.2*$container.scale),_this.animateIn()}!async function(){!function init(){($container=$gl()).y=0,$parent.add($container),_currRoute=ViewController.instance().currentRoute?.path}(),function initNavItems(){NAV_ITEMS.forEach((async(item,index)=>{let $item=await async function createText({text:text,path:path,offset:offset}){return new Promise((async resolve=>{let $item=$glText(text,"marscondensed-regular-TRIAL",70,{width:120,align:"left",letterSpacing:-.03,color:path===_currRoute?Colors.value.orange:Colors.value.beige}),shader=_this.initClass(Shader,"MenuItemShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise_basecolor.png"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:-180},uTransition0:{value:.01},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3}});$item.shader=shader,$item.useShader(shader),await $item.text.ready(),$item.text.shader.set("uBoundingMin",(new Vector3).copy($item.dimensions.min)),$item.text.shader.set("uBoundingMax",(new Vector3).copy($item.dimensions.max)),$item.path=path,$item.interact(onItemHover,onItemClick),resolve($item)}))}(item);index>0&&($item.y=$item.dimensions.height*index),_totalHeight+=$item.dimensions.height,$item.targetY=$item.y+50,$item.index=index,$container.add($item),$navItems.push($item),index==NAV_ITEMS.length-1&&(Stage.width>600?$container.y=Stage.height/2-_totalHeight/2-$item.dimensions.height/2:$container.y=0,_this.flag("contentReady",!0))}))}(),function addListeners(){_this.onResize(resize)}(),_this.isPlayground()&&_this.animateIn(),resize()}(),this.animateIn=async function(delay=0){return new Promise((async(resolve,reject)=>{await _this.wait(_this,"contentReady"),_this.flag("isAnimating",!0);let anims=$navItems.map((async $item=>(await $item.text.ready(),$item.shader.tween("uTransition0",1,800,"easeIn",delay+100*$item.index).promise(),$item.tween({y:$item.targetY},400,"easeOutCubic",delay+150*$item.index).promise())));await Promise.all(anims),_this.flag("isAnimating",!1),resolve()}))},this.animateOut=async function(delay=0){return new Promise((resolve=>{$navItems.forEach(($item=>{$item.shader.tween("uAlpha",0,500,"easeOutSine",delay+50*$item.index),$item.shader.tween("uTransition0",0,500,"easeIn",delay+50*$item.index).promise(),$item.clearInteract()})),$navItems=[],resolve()}))}})),Class((function NavigationHeader(){Inherit(this,Element);const _this=this,$this=_this.element;var $wordmark,$menu,$logo,$logoContainer,$closeContainer,$closeWrapper;_this.state="";var $lines=[],_gap=Device.mobile?4:6;async function close(){_this.flag("isOpen",!1),PageUIController.instance().state.set("menuOpen",!1),$lines[0].tween({rotation:0,y:0},600,"easeOutCubic"),$lines[1].tween({scale:1,y:_gap,x:0},600,"easeOutCubic"),$lines[2].tween({rotation:0,y:2*_gap},600,"easeOutCubic"),$menu.hit.size(56,24).center()}function resize(){Device.mobile&&Stage.width>Stage.height&&Stage.height<500?$this.transform({scale:.7}):$this.transform({scale:1})}async function onMenuClick(){if(_this.flag("isOpen")){await ViewController.instance().transitionBack()&&close()}else{await ViewController.instance().transition("Menu","topRight")&&(_this.switchToLogo(),_this.changeColor(Colors.value.beige),async function open(){_this.flag("isOpen",!0),PageUIController.instance().state.set("menuOpen",!0),$lines[0].tween({rotation:45,y:10,scaleX:1},600,"easeOutCubic"),$lines[1].tween({scale:0,x:-100,y:10,scaleX:1},600,"easeOutCubic"),$lines[2].tween({rotation:-45,y:6,scaleX:1},600,"easeOutCubic"),$menu.hit.size(56,56).center()}())}}function onMenuHover(e){_this.flag("isOpen")||("over"==e.action?($lines[0]?.tween({y:0,scaleX:.8,rotation:0},300,"easeOutCubic"),$lines[2]?.tween({y:2*_gap,scaleX:.8,rotation:0},300,"easeOutCubic")):($lines[0]?.tween({y:0,x:0,scaleX:1,rotation:0},500,"easeOutCubic"),$lines[2]?.tween({y:2*_gap,x:0,scaleX:1,rotation:0},500,"easeOutCubic")))}async function onLogoClick(){if(""!=ViewController.instance().currentRoute.path||_this.flag("isOpen"))if(_this.flag("isOpen")&&"HomePage"==ViewController.instance().getCurrentPage().key){await ViewController.instance().transitionBack()&&close()}else{await ViewController.instance().changeRoute("","right")&&close()}else _this.events.fire(NavigationHeader.LOGO_CLICK)}function onLogoHover(e){Device.mobile||("over"==e.action?"logo"==_this.state?$logo.tween({opacity:.6},200,"easeOutCubic"):$wordmark.tween({opacity:.6},200,"easeOutCubic"):"logo"==_this.state?$logo.tween({opacity:1},400,"easeOutCubic"):$wordmark.tween({opacity:1},400,"easeOutCubic"))}async function onCloseClick(){"news"!=ViewController.instance().currentRoute.path&&ViewController.instance().changeRoute("news")}async function onCloseHover(e){if(null!=ViewController.instance().currentRoute.path.split("/")[1])_this.flag("closeHoverable")&&("over"==e.action?$closeWrapper.tween({opacity:.5,scale:.8},300,"easeOutCubic"):$closeWrapper.tween({opacity:1,scale:1},300,"easeOutCubic"));else{if(_this.flag("closeHoverable")||_this.flag("closeActive"))return;await closeHide()}}async function onRouteChange(e){switch(close(),await defer(),ViewController.instance().currentRoute?.path){case"":case"chapter1":case"chapter2":_this.switchToWordmark(),$logoContainer.css({backgroundColor:Colors.value.orange});break;case"connect":_this.switchToLogo(),$logoContainer.css({backgroundColor:Colors.value.beige});break;case"mission":default:_this.switchToLogo(),$logoContainer.css({backgroundColor:Colors.value.orange})}}async function closeShow(){_this.flag("closeActive")||($closeWrapper.transform({y:-20}),$closeWrapper.css({opacity:0}),$closeContainer.css({display:"initial"}),await $closeWrapper.tween({opacity:1,y:0},300,"easeInOut",300).promise(),_this.flag("closeActive",!0),await _this.wait(1e3),_this.flag("closeHoverable",!0))}async function closeHide(){_this.flag("closeActive")&&(await $closeWrapper.tween({opacity:0,scale:1},300,"easeInOut").promise(),_this.flag("closeHoverable",!1),$closeContainer.css({display:"none"}),_this.flag("closeActive",!1))}!async function initHTML(){$this.css({display:"contents"});let offset=Device.mobile.phone?40:60;($logoContainer=$this.create("logo-container")).css({position:"relative",top:.7*offset,left:.7*offset,backgroundColor:Colors.value.orange});let size=Device.mobile.phone?{width:200,height:45}:{width:250,height:60},logoSize=Device.mobile.phone?36:44,logoCSS={backgroundSize:"contain",backgroundPosition:"center",display:"inline-block",marginLeft:5,backgroundColor:"inherit",maskSize:"contain",opacity:0};($wordmark=$logoContainer.create("wordmark")).size(size.width,size.height).css(logoCSS),$wordmark.css({top:Device.mobile.phone?-9:-10,left:5,"-webkit-mask":"url(assets/images/ui/prometheus_wordmark.svg) no-repeat center",mask:"url(assets/images/ui/prometheus_wordmark.svg) no-repeat center"}),$wordmark.interact(onLogoHover,onLogoClick,"#","Prometheus logo home button"),$wordmark.multiTween=!0,Device.mobile&&$wordmark.hit.div.setAttribute("role","button"),($logo=$logoContainer.create("logo")).size(logoSize,logoSize).css(logoCSS),$logo.css({"-webkit-mask":"url(assets/images/ui/logo.svg) no-repeat center",mask:"url(assets/images/ui/logo.svg) no-repeat center contain",maskSize:"contain"}),$logo.interact(onLogoHover,onLogoClick,"#","Prometheus logo home button"),$logo.multiTween=!0,Device.mobile&&$logo.hit.div.setAttribute("role","button"),($closeContainer=$this.create("close-container")).css({position:"absolute",top:.7*offset,left:"50%",width:"4rem",height:"4rem",transform:"translateX(-50%)",display:"none"}),$closeContainer.interact(onCloseHover,onCloseClick,"#","Close button"),($closeWrapper=$closeContainer.create("close-wrapper")).css({position:"relative",width:"100%",height:"100%",opacity:0}),$closeWrapper.create("closeLine1").css({position:"absolute",top:"50%",left:"50%",width:"100%",height:"2px",background:Colors.value.beige,transformOrigin:"left",transform:"rotate(45deg) translate(-50%, -50%)"}),$closeWrapper.create("closeLine2").css({position:"absolute",top:"50%",left:"50%",width:"100%",height:"2px",background:Colors.value.beige,transformOrigin:"left",transform:"rotate(-45deg) translate(-50%, -50%)"}),($menu=$this.create("menu")).css({position:"relative",height:"24px",float:"right",top:offset-3,right:offset}),$menu.interact(onMenuHover,onMenuClick,"#","Menu button"),$menu.hit.size(56,24).center(),Device.mobile&&$menu.hit.div.setAttribute("role","button");for(let i=0;i<3;i++){let $line=$menu.create("line");$line.css({position:"relative",width:Device.mobile.phone?40:56,height:"2px",background:Colors.value.beige}).transform({y:_gap*i}),$lines.push($line)}}(),function addListeners(){_this.events.sub(ViewController.UPDATE,onRouteChange),_this.events.sub(NavigationHeader.CLOSE_SHOW,closeShow),_this.events.sub(NavigationHeader.CLOSE_HIDE,closeHide),_this.onResize(resize)}(),_this.changeColor=function(color){$lines.forEach(($line=>{$line.css({background:color})}))},_this.switchToLogo=async function(){"logo"!=_this.state&&(_this.state="logo",await $logoContainer.tween({opacity:0},300,"easeOutCubic").promise(),$logo.show().css({opacity:1}),$wordmark.css({opacity:0}).hide(),$logoContainer.tween({opacity:1},300,"easeOutCubic").promise())},_this.switchToWordmark=async function(){"wordmark"!=_this.state&&(_this.state="wordmark",await $logoContainer.tween({opacity:0},300,"easeOutCubic").promise(),$logo.css({opacity:0}).hide(),$wordmark.css({opacity:1}).show(),$logoContainer.tween({opacity:1},300,"easeOutCubic").promise())}}),"singleton",(()=>{NavigationHeader.LOGO_CLICK="NavigationHeader_logo_click",NavigationHeader.CLOSE_SHOW="NavigationHeader_close_anim_show",NavigationHeader.CLOSE_HIDE="NavigationHeader_close_anim_hide",NavigationHeader.CLOSE_CLICK="NavigationHeader_close_click"})),Class((function MenuCarousel(){Inherit(this,Object3D);const _this=this,DATA=[{image:"assets/images/ui/chapter1.jpg",subtitle:"CHAPTER 1",title:CMS.get("chapters.chapter-1.title"),path:"chapter1"},{image:"assets/images/ui/chapter2.jpg",subtitle:"CHAPTER 2",title:CMS.get("chapters.chapter-2.title"),path:"chapter2"},{image:"assets/images/ui/chapter3.jpg",subtitle:"CHAPTER 3",title:CMS.get("chapters.chapter-3.title"),path:"chapter3"}];var $stack,$container,_objects=[],$dots=[],_active=0;function generateObjects(){DATA.forEach((async({image:image,subtitle:subtitle,title:title,path:path},index)=>{let item=_this.initClass(MenuCarouselItem,{image:image,subtitle:subtitle,title:title,index:index%DATA.length,path:path});_objects.push(item.$container)}))}function loop(){}function addListeners(){_this.events.sub(Stack3D.UPDATE,onUpdate)}function onUpdate(e){_objects.forEach(((obj,index)=>{-1==e.sign?0==index?(obj.shader.set("uAlpha2",1),obj.title.text.shader?.tween("uTransition0",1,400,"easeIn"),obj.subtitle.text.shader?.tween("uTransition0",1,400,"easeIn"),_active=obj.index,$dots[_active]?.tween({alpha:1},300,"easeOutCubic")):(obj.title.text.shader?.set("uTransition0",0),obj.subtitle.text.shader?.set("uTransition0",0),obj.index!=_active&&$dots[obj.index]?.tween({alpha:.5},300,"easeOutCubic")):1==index?(obj.shader.set("uAlpha2",1),obj.title.text.shader?.tween("uTransition0",1,400,"easeIn"),obj.subtitle.text.shader?.tween("uTransition0",1,400,"easeIn"),_active=obj.index,$dots[_active]?.tween({alpha:1},300,"easeOutCubic")):(obj.title.text.shader?.set("uTransition0",0),obj.subtitle.text.shader?.set("uTransition0",0),obj.index!=_active&&$dots[obj.index]?.tween({alpha:.5},300,"easeOutCubic"))}))}!async function(){!async function initObjects(){generateObjects(),generateObjects(),function createStack(mode){$stack&&$stack.destroy();let offset=new Vector3(0,0,0);"desktop"==mode?offset.set(-.2,.2,1):offset.set(Stage.width<=500?-1.25:-1.5,.001,.001);$stack=_this.initClass(Stack3D,_objects,{offset:offset,visible:2,easeTime:800,ease:"easeOutQuart"})}("desktop"),await defer(),addListeners(),await _objects[0].title.text.ready(),await _objects[0].subtitle.text.ready(),_objects[0].title.text.shader?.set("uTransition0",1),_objects[0].subtitle.text.shader?.set("uTransition0",1)}(),addListeners()}(),this.animateIn=async function(delay=0){return _this.visible=!0,_this.startRender(loop),Promise.all([$stack.wrapper.tween({alpha:1},400,"easeOutCubic",delay).promise(),$container?.tween({alpha:1},400,"easeOutCubic",delay).promise()])},this.animateOut=async function(delay=0){return _this.stopRender(loop),Promise.all([$stack.wrapper.tween({alpha:0},400,"easeOutCubic",delay).promise(),$container?.tween({alpha:0},400,"easeOutCubic",delay).promise()])},this.hide=async()=>{await $stack.wrapper.tween({alpha:0},300,"easeOutCubic").promise(),_this.stopRender(loop),_this.visible=!1},this.initControls=function(){$container||(($container=$gl()).alpha=.01,DATA.forEach(((data,index)=>{let $dot=$gl(.04,.04,Colors.value.beige),shader=_this.initClass(Shader,"MenuCarouselIndicatorShader",{uColor:{value:new Color},transparent:!0});$dot.useShader(shader),$dot.alpha=0==index?1:.5,$dot.y=.075*index,$dot.index=index,$container.add($dot),$dots.push($dot)})),$container.x=1.5,$container.y=-(.04*DATA.length+.075*(DATA.length-1))/2,$stack.wrapper.add($container))},_this.get("stack",(()=>$stack))})),Class((function MenuCarouselItem({image:image,subtitle:subtitle,title:title,index:index,path:path}={}){Inherit(this,Component);const _this=this;function initText({text:text,size:size,color:color}){let shader=_this.initClass(Shader,"MenuItemShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:-60},uTransition0:{value:.01},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3}}),$text=$glText(text,"marscondensed-regular-TRIAL",size,{align:"center",color:color,letterSpacing:-.03});return $text.useShader(shader),$text.shader=shader,$text}async function resize(){await _this.wait(_this,"isReady")}function onHover(e){}function onClick(e){_this.$container.z>=-.5&&path&&ViewController.instance().changeRoute(path)}_this.$container,async function init(){let shader=_this.initClass(Shader,"MenuCarouselItemShader",{uSize:{value:new Vector2(2.7,1.8)},uAlpha2:{value:1}});_this.$container=$gl(2.7,1.8,image),_this.$container.index=index,_this.$container.useShader(shader),_this.$container.enable3D(),_this.$container.interact(onHover,onClick);let $subtitle=initText({text:subtitle,size:.08,color:Colors.value.orange});$subtitle.y=.33,$subtitle.enable3D(),_this.$container.group.add($subtitle.anchor),_this.$container.subtitle=$subtitle;let $title=initText({text:title,size:.2,color:Colors.value.beige});$title.y=.1,$title.enable3D(),_this.$container.group.add($title.anchor),_this.$container.title=$title,await $subtitle.text.ready(),$subtitle.shader.set("uBoundingMin",(new Vector3).copy($subtitle.dimensions.min)),$subtitle.shader.set("uBoundingMax",(new Vector3).copy($subtitle.dimensions.max)),await $title.text.ready(),$title.shader.set("uBoundingMin",(new Vector3).copy($title.dimensions.min)),$title.shader.set("uBoundingMax",(new Vector3).copy($title.dimensions.max)),_this.flag("isReady",!0)}(),function addListeners(){_this.onResize(resize)}()})),Class((function MobileCarousel({parent:parent,hit:hit}={}){Inherit(this,Component);const _this=this,DATA=[{image:"assets/images/ui/chapter1.jpg",subtitle:"CHAPTER 1",title:CMS.get("chapters.chapter-1.title"),path:"chapter1",badge:CMS.get("chapters.chapter-1.new")},{image:"assets/images/ui/chapter2.jpg",subtitle:"CHAPTER 2",title:CMS.get("chapters.chapter-2.title"),path:"chapter2",badge:CMS.get("chapters.chapter-2.new")},{image:"assets/images/ui/chapter3.jpg",subtitle:"CHAPTER 3",title:CMS.get("chapters.chapter-3.title"),path:"chapter3",badge:CMS.get("chapters.chapter-3.new")}];var $wrap,$carousel,_slider,_feathering,_items=[],_objects=[];!function initFeathering(){_feathering=_this.initClass(UIFeathering,{bounds:new Vector2(.35,1),direction:new Vector2(1,0),width:50})}(),function generateObjects(){DATA.forEach((async(obj,index)=>{let item=_this.initClass(MobileCarouselItem,{...obj,index:index%DATA.length});item.useFeathering(_feathering),_items.push(item),_objects.push(item.$container)}))}(),async function initSlider(){($wrap=$gl()).alpha=0,parent.add($wrap),$carousel=$gl(),$wrap.add($carousel);let size=await _items[0].getSize(),itemWidth=size.width,itemHeight=size.height,width=itemWidth+10;(_slider=_this.initClass(Interaction.Slider,$carousel,{x:1},{hit:Stage,slides:_objects.length,width:width,repeatable:!0,desktopDrag:!0})).repeatable=!0,_slider.views=_objects,_objects.forEach(((obj,index)=>{obj.x=width*index,$carousel.add(obj)})),$wrap.x=Stage.width/2-itemWidth/2,$wrap.y=Stage.height-200-itemHeight/2}(),_this.hide=async function(){await $wrap.tween({alpha:0},300,"easeOutCubic").promise(),$wrap.visible=!1},_this.show=async function(){await $wrap.tween({alpha:1},300,"easeOutCubic",300).promise(),$wrap.visible=!0},_this.resize=async function(y){Stage.width>Stage.height?_feathering.bounds=new Vector2(.35,1):_feathering.bounds=new Vector2(0,1);let size=await _items[0].getSize(),itemWidth=size.width,itemHeight=size.height;Stage.width<600?$wrap.x=Stage.width/2-itemWidth/2-25:$wrap.x=Stage.width/2-itemWidth/2+100,$wrap.y=Stage.width>Stage.height?Stage.height-170-itemHeight/2:y+30,_objects.forEach(((obj,index)=>{obj.x=(itemWidth+10)*index})),_slider.width=itemWidth+10}})),Class((function MobileCarouselItem({image:image,subtitle:subtitle,title:title,index:index,path:path,badge:badge}={}){Inherit(this,Component);const _this=this;var $image,$badge;_this.$container=$gl();var _width=Math.max(Stage.width/2,275),_height=_width/1.5,_lastX=0,_layoutAspect=0;function initText({text:text,size:size,color:color}){let textShader=_this.initClass(Shader,"MenuCarouselItemTextShader",{uAlpha2:{value:1},transparent:!0}),$text=$glText(text,"marscondensed-regular-TRIAL",size,{align:"center",color:color,letterSpacing:-.03});return $text.useShader(textShader),$text}async function resize(){_this.flag("isResized",!1),await _this.wait(_this,"isReady"),_width=Stage.width/1.5,_height=_width/_layoutAspect,$image.height=_height,$image.width=_width,_this.$container.title.x=_width/2,_this.$container.subtitle.x=_width/2,await _this.$container.title.text.ready(),_this.$container.title.text.shader.set("uAlpha2",1),_this.flag("isResized",!0),$badge&&($badge.element.x=_width-1.5*$badge.width-10,$badge.element.y=_height-1.5*$badge.height-10,$badge.element.scale=1.5)}function onHover(e){"over"==e.action?(_lastX=Mouse.x,0,_this.flag("canClick",!1)):(Math.abs(Mouse.x-_lastX),_this.flag("canClick",!0))}async function onClick(e){path&&Mouse.delta.length()<3&&(ViewController.instance().currentRoute.path!=path?ViewController.instance().changeRoute(path):ViewController.instance().transitionBack())}_layoutAspect=281/184,function init(){let shader=_this.initClass(Shader,"MenuCarouselItemShader",{uSize:{value:new Vector2(1.5,1)},uAlpha2:{value:1},transparent:!0});_this.$container.index=index,($image=$gl(_width,_height,image)).useShader(shader),$image.z=-1,_this.$container.add($image),$image.interact(onHover,onClick);let $subtitle=initText({text:subtitle,size:20,color:Colors.value.orange});$subtitle.y=25,$subtitle.x=_width/2,_this.$container.add($subtitle),_this.$container.subtitle=$subtitle;let $title=initText({text:title,size:30,color:Colors.value.beige});$title.y=50,$title.x=_width/2,_this.$container.add($title),_this.$container.title=$title,_this.flag("isReady",!0)}(),function initBadge(){badge&&($badge=_this.initClass(MenuBadge),_this.$container.add($badge.element))}(),function addListeners(){_this.onResize(resize)}(),console.log($image),_this.getSize=async function(){return new Promise((async resolve=>{await _this.wait(_this,"isResized"),resolve({width:_width,height:_height})}))},_this.useFeathering=async function(feathering){await _this.wait(_this,"isReady"),await _this.$container.subtitle.text.ready(),await _this.$container.title.text.ready()}})),Class((function UIFeathering(_config={}){Inherit(this,Component);const _this=this;var _bounds=new Vector2(0,1),_width={value:Device.mobile?30:80},_direction=new Vector2(0,0);_config.bounds&&_bounds.copy(_config.bounds),_config.width&&(_width.value=_config.width),_config.direction&&_direction.copy(_config.direction),_this.get("width",(()=>_width.value)),_this.set("width",(width=>_width.value=width)),_this.get("bounds",(()=>_bounds)),_this.set("bounds",(bounds=>_this.bounds.copy(bounds))),_this.get("direction",(()=>_direction)),_this.set("direction",(direction=>_this.direction.copy(direction))),_this.get("uniforms",(()=>({uFeatherBounds:{value:_this.bounds},uFeatherWidth:_width,uFeatherDirection:{value:_this.direction}}))),_this.copyUniformsTo=function(...shaders){shaders.forEach((shader=>{shader&&(shader instanceof Shader||(shader=shader.shader),Object.assign(shader.uniforms,_this.uniforms))}))}})),Class((function MenuBadge(){Inherit(this,GLUIElement);const _this=this,$this=_this.element;var $bg,$title;function loop(){$bg.rotation.z-=.012*Render.HZ_MULTIPLIER}_this.width=42,_this.height=42,function initGL(){($bg=$gl(42,42,Utils3D.getTexture("/assets/images/ui/badge-star-texture.png"))).enable3D(),$bg.setZ(2),$bg.x=21,$bg.y=-21,$this.add($bg),($title=$glText("NEW","marscondensed-regular-TRIAL",12.5,{align:"center",color:Colors.value.beige,letterSpacing:0})).x=21,$title.y=14.5,$this.add($title),$title.setZ(3)}(),_this.startRender(loop)})),Class((function MenuStack($parent){Inherit(this,Component);const _this=this;var $this,$items=[],_totalHeight=0;const DATA=[{image:"assets/images/ui/chapter1.jpg",subtitle:"CHAPTER   1",title:CMS.get("chapters.chapter-1.title"),path:"chapter1",badge:CMS.get("chapters.chapter-1.new")},{image:"assets/images/ui/chapter2.jpg",subtitle:"CHAPTER   2",title:CMS.get("chapters.chapter-2.title"),path:"chapter2",badge:CMS.get("chapters.chapter-2.new")},{image:"assets/images/ui/chapter3.jpg",subtitle:"CHAPTER   3",title:CMS.get("chapters.chapter-3.title"),path:"chapter3",badge:CMS.get("chapters.chapter-3.new")}];function resizeHandler(){$this.scale=Math.range(Stage.width,600,1400,.7,1.4,!0),$this.scale*=Math.range(Stage.height,600,1100,.7,1.1,!0),$this.scale*=Math.range(Stage.height,500,300,1,.7,!0),$this.y=Stage.height/2-_totalHeight/2,Device.mobile&&Stage.width>Stage.height?($this.x=Stage.width/2-50,Stage.height<375&&($this.scale*=Math.range(Stage.height,0,375,0,.9,!0))):$this.x=Stage.width/2+75}($this=$gl(366,490)).alpha=.001,$this.topLeftAnchor=!0,$parent.add($this),DATA.forEach(((obj,i)=>{obj.video="ch"+(i+1);let item=_this.initClass(MenuStackItem,obj);$this.add(item.element),Device.mobile&&Stage.width>Stage.height?item.element.y=190*i:item.element.y=180*i,$items.push(item),_totalHeight+=item.element.y})),Device.mobile&&Stage.width>Stage.height?_totalHeight-=35:_totalHeight+=0,_this.onResize(resizeHandler),_this.show=function(){$items.forEach(($item=>{$item.show()})),$this.tween({alpha:1},300,"easeInCubic",200)},_this.hide=function(){$items.forEach(($item=>{$item.hide()}))},_this.animateOut=function(){$this.tween({alpha:0},300,"easeOutCubic")}})),Class((function MenuStackItem(_data){Inherit(this,GLUIElement);const _this=this,$this=_this.element;var _shader,_videoTexture,$wrapper,$bg,$title,$subtitle,$badge,_color,_width,_height,_mouse=new Vector2;function hover(e){"over"==e.action?($badge&&$badge.element.tween({scale:1.1},800,"easeOutQuart"),$wrapper.tween({scale:1.04},800,"easeOutQuart"),tween($subtitle,{scale:1},800,"easeOutQuart"),tween($title,{scale:1.02},800,"easeOutQuart"),_shader.tween("uHover",1,2e3,"easeOutQuart"),_videoTexture.start()):($badge&&$badge.element.tween({scale:1},800,"easeOutQuart"),_videoTexture.saveTime=_videoTexture.video.time,$wrapper.tween({scale:1},800,"easeOutQuart"),tween($subtitle,{scale:1},800,"easeOutQuart"),tween($title,{scale:1},800,"easeOutQuart"),_shader.tween("uHover",0,2e3,"easeOutQuart"),_videoTexture.stop())}function click(e){ViewController.instance().currentRoute.path!=_data.path?ViewController.instance().changeRoute(_data.path):ViewController.instance().transitionBack()}Device.mobile&&Stage.width>Stage.height?(_width=325,_height=185):(_width=325,_height=165),function initGL(){switch(_videoTexture=_this.initClass(VideoTexture,`assets/videos/${_data.video}.mp4`,{firstFrame:`assets/videos/${_data.video}.jpg`,autoplay:!1}),$wrapper=$gl(_width,_height),$this.add($wrapper),$bg=$gl(_width,_height,_videoTexture),$wrapper.add($bg),_data.video){case"ch1":_color=Colors.value.orangeYellow;break;case"ch2":_color=Colors.value.greyishTeal;break;case"ch3":_color=Colors.value.lime}_shader=_this.initClass(Shader,"MenuStackBackground",{uAlpha:{value:1},uTreatment:{value:1},uHover:{value:0},uMouse:{value:_mouse},uColor:{value:new Color(_color)},uBorder:{value:new Color(Colors.value.beige)},uSize:{value:new Vector2(2,1)},uSize2:{value:new Vector2(2,1)},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg")}}),$bg.useShader(_shader),$bg.mesh.interactionScene=GLUI.Stage.scene,$bg.interact(hover,click,"#",_data.title),($title=$glText(_data.title,"marscondensed-regular-TRIAL",32,{align:"center",color:Colors.value.beige,letterSpacing:-.03})).x=_width/2,$title.y=_height/2-16,$wrapper.add($title),$title.setZ(2),($subtitle=$glText(_data.subtitle,"marscondensed-regular-TRIAL",11,{align:"center",color:Colors.value.beige,letterSpacing:.3})).x=_width/2,$subtitle.y=_height/2-32,$wrapper.add($subtitle),$subtitle.setZ(2)}(),function initBadge(){_data.badge&&(($badge=_this.initClass(MenuBadge)).element.x=12,$badge.element.y=12,$this.add($badge))}(),function initSEO(){let _seo={root:_this.findParent("MenuSection").scene,seo:{url:_data.path,label:`${_data.subtitle} ${_data.title}`.toLowerCase()}};Interaction3D.find(World.CAMERA).add($bg.mesh,hover,click,_seo)}(),_this.show=async function(){$wrapper.tween({scale:1},10,"easeOutQuart"),tween($subtitle,{scale:1},10,"easeOutQuart"),tween($title,{scale:1},10,"easeOutQuart"),_shader.tween("uHover",0,10,"easeOutQuart"),_videoTexture.stop()},_this.hide=function(){_videoTexture.stop()}})),Class((function NewsArticleItem(_data,_index){Inherit(this,Element);const $this=this.element;var $container,$title;!async function(){!function initHTML(){$container=$this.create("NewsArticleItem_Container"),$title=$container.create("NewsArticleItem_Header","h5"),_data.bind("title",$title)}(),function initStyles(){$this.css({position:"relative",display:"flex",flexDirection:"column"}),$container.css({width:"calc(((100vw / 3) * 2) / 2)",height:"calc((20rem + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem))",marginBottom:"6rem",background:"gray",position:"relative"}),$title.css({fontFamily:"'marscondensed-regular-TRIAL', sans-serif",fontSize:"4rem",lineHeight:"3.4rem",color:"#d8d8d8",textAlign:"left",textTransform:"uppercase",marginBottom:"3rem"})}()}(),this.animateIn=function(delay=0){},this.animateOut=async function(delay=0){}})),Class((function NewsPage(isFirst=!1){Inherit(this,InteractivePage,"news",isFirst);const _this=this;!async function(){!async function init(){await _this.ready()}()}(),this.animateIn=function(){},this.animateOut=function(){},this.hide=async function(){await defer(),_this._hide()}})),Class((function NewsPageUI(){Inherit(this,InteractiveUI),Inherit(this,DOMTemplate);const _this=this;var $newsPageUIWrapper,$newsArticleCloneWrapper,$newsArticleImgWrapper,$newsArticleTitleHeader,$newsArticleHTML,$newsArticleDateClone,_articleId,$clickedArticle,_activeArticle,$clonedArticle,$clone,$this=_this.element,$newsArticles=[],_scrollY=0;async function openArticle(item,ev){if(_this.flag("newsArticleIsOpened"))return;CameraUtil.blockScroll(!0),_this.events.fire(ViewController.NEWS_TRANSITION_ANIMATING),_this.flag("newsArticleIsOpened",!0),_this.events.fire(NewsController.LOAD_ARTICLE,{item:item}),_scrollY=window.scrollY,_articleId=item.slug,_activeArticle=await CMS.fetchNewsPage(item.slug),$clickedArticle=ev.target.closest(".News_Article_Wrapper"),$newsPageUIWrapper.div.classList.add("NewsPageUI_Wrapper_ACTIVE"),$newsArticles.forEach((async $article=>{$article.div.classList.add("News_Article_HIDE")})),document.querySelector(".NewsPage").classList.add("NewsPage_ACTIVE"),$clone=$clickedArticle.querySelector(".News_Article_Img").cloneNode(!0),$clickedArticle.classList.contains("News_Article_Featured")?$newsPageUIWrapper.div.classList.add("News_Article_Clone_ACTIVE_V2"):$newsPageUIWrapper.div.classList.add("News_Article_Clone_ACTIVE"),$clonedArticle=$clickedArticle,$newsArticleTitleHeader.div.innerHTML=_activeArticle.title,$newsArticleHTML.div.innerHTML=_activeArticle.body,$newsArticleDateClone.div.innerHTML=_activeArticle.date,$newsArticleCloneWrapper.div.style.top=window.scrollY+"px",$clone.style.top=$clonedArticle.getBoundingClientRect().top-$newsArticleImgWrapper.div.getBoundingClientRect().top+"px",$clone.style.left=$clonedArticle.getBoundingClientRect().left+"px",$clone.style.width=$clonedArticle.getBoundingClientRect().width+"px",$newsArticleImgWrapper.div.appendChild($clone),await _this.wait(1),$clickedArticle.classList.contains("News_Article_Featured")||window.innerWidth<=600?$clone.classList.add("News_Article_Clone_ANIMATE_ACTIVE_V2"):$clone.classList.add("News_Article_Clone_ANIMATE_ACTIVE"),await _this.wait(1e3),CameraUtil.blockScroll(!1),Stage.div.scrollTop=0,function changeRoute(){ViewController.instance().changeRoute("news/"+_articleId)}()}!async function(){!async function init(){$this.css({opacity:0}),_this.isPlayground()&&defer((()=>{_this.animateIn()}))}()}(),this.animateIn=async function(delay=600){return new Promise((async resolve=>{0!=_scrollY&&(await _this.wait(delay),window.scrollTo(0,_scrollY)),$this.css({opacity:0}),await $this.tween({opacity:1},1e3,"easeOutCubic",delay).promise(),resolve()}))},this.animateOut=async function(delay=1e3){return new Promise((async resolve=>{await defer(),$this.css({opacity:0}),async function closeArticle(){_this.flag("newsArticleIsOpened",!1),document.querySelector(".NewsPage").classList.remove("NewsPage_ACTIVE"),$newsPageUIWrapper.div.classList.remove("News_Article_Clone_ACTIVE"),$newsPageUIWrapper.div.classList.remove("News_Article_Clone_ACTIVE_V2"),$clone&&($clone.classList.remove("News_Article_Clone_ANIMATE_ACTIVE"),$clone.classList.remove("News_Article_Clone_ANIMATE_ACTIVE_V2"),$newsArticleImgWrapper.div.contains($clone)&&$newsArticleImgWrapper.div.removeChild($clone)),$newsPageUIWrapper.div.classList.remove("NewsPageUI_Wrapper_ACTIVE"),$newsPageUIWrapper.div.classList.remove("News_PageUI_ACTIVE"),$newsArticles.forEach((async _article=>{_article.div.classList.remove("News_Article_ACTIVE"),_article.div.classList.remove("News_Article_HIDE")})),$newsArticleTitleHeader.div.innerHTML="",$newsArticleHTML.div.innerHTML="",$newsArticleDateClone.div.innerHTML=""}(),_this.events.fire(ViewController.NEWS_TRANSITION_IDLE),resolve()}))},this.style=function(){return"\n        @font-face {\n            font-family: 'marscondensed-regular-TRIAL';\n            src: url('../fonts/marscondensed-regular-TRIAL.otf') format('opentype');\n            font-weight: 400;\n            font-style: bold;\n        }\n        @font-face {\n            font-family: 'FuturaLT-Bold';\n            src: url('../fonts/FuturaLT-Bold.ttf') format('truetype');\n            font-weight: 600;\n            font-style: normal;\n        }\n        @font-face {\n            font-family: 'FuturaLT-Medium';\n            src: url('../fonts/FuturaLT-Medium.ttf') format('truetype');\n            font-weight: 400;\n            font-style: normal;\n        }\n\n        #Stage, #Stage * {\n            .NewsPage {\n                overflow: hidden;\n            }\n            .NewsPageUI, {\n                width: 100%;\n                position: relative;\n                display: inline-block;\n                * {\n                    position: relative;\n                }\n            }\n            .NewsPageUI_Wrapper {\n                display: inline-block;\n                position: relative;\n                background-color: #161616;\n                &:before {\n                    content: '';\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background-image: url('../assets/images/textures/grains.png');\n                    background-size: contain;\n                    filter: brightness(4.75);\n                    transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 150ms;\n                }\n            }\n            .News {\n                position: relative;\n                width: 100%;\n            }\n            .News_Header {\n                font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                font-size: 12rem;\n                color: #E74833;\n                text-align: center;\n                margin: 5rem auto;\n                position: relative;\n                z-index: 0;\n                width: calc(66% + 20rem);\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 150ms;\n            }\n            .News_Article_Title_Header {\n                font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                font-size: 12rem;\n                color: #FDF0E1;\n                text-align: center;\n                text-transform: uppercase;\n                line-height: 10rem;\n                z-index: 2;\n                opacity: 0;\n                width: 80vw;\n                transform: translateY(-200%);\n                // margin: calc(2.5% + 1.25rem) auto 0;\n                // padding: calc(2.5% + 1.25rem) 0 0;\n                padding: 150px 0 0;\n                margin: 0 auto 4.5rem auto;\n                // background: url('../images/textures/grains_2.jpg');\n                background: url('../assets/images/textures/grains_2.jpg');\n                background-size: cover;\n                -webkit-background-clip: text;\n                background-clip: text;\n                color: transparent;\n                top: 0;\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            \n            .News_Article_Date_Header {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                text-align: center;\n                font-size: 1.4rem;\n                color: #FDF0E1;\n                text-transform: uppercase;\n                z-index: 2;\n                opacity: 0;\n                width: calc((100vw / 3) * 2 + 8rem);\n                transform: translateY(-200%);\n                margin: calc(2.5% + 2rem) auto 2rem;\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .News_Articles {\n                width: calc((100% / 3) * 2 + 10rem);\n                margin: auto;\n                position: relative;\n                display: flex;\n                flex-wrap: wrap;\n                justify-content: space-between;\n            }\n            .News_Article_Wrapper {\n                position: relative;\n                z-index: 0;\n                width: calc(((100vw / 3) * 2) / 2);\n                height: calc(((((100vw / 3) * 2) / 2 + 3rem) * 0.627) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                // height: calc((30rem + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                margin-bottom: 6rem;\n                transition: opacity 500ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 100ms;\n            }\n            .News_Article_Wrapper.News_Article_Featured {\n                // height: calc((60rem + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                height: calc(((((100vw / 3) * 2 + 10rem) * 0.627) + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                margin-bottom: 2.5rem;\n            }\n            .News_Article_Featured {\n                width: 100%;\n                .News_Article {\n                    width: 100%;\n                }\n                .News_Article_Content {\n                    width: 100%;\n                }\n                .News_Article_Img {\n                    // width: 100%;\n                    // height: 60rem;\n                    height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                    width: calc((100vw / 3) * 2 + 10rem);\n                    border-radius: 1.5rem;\n                }\n                .News_Article_Content_Wrapper {\n                    // top: 63rem;\n                    top: calc((((100vw / 3) * 2 + 10rem) * 0.627) + 3rem);\n                }\n            }\n            .News_Article {\n                position: relative;\n                display: flex;\n                flex-direction: column;\n                width: calc(((100vw / 3) * 2) / 2);\n                height: 100%;\n                cursor: pointer;\n                text-decoration: none;\n                &:hover {\n                    .News_Article_Img {\n                        // border: 2px solid #E74833;\n                        box-shadow: 0px 0px 0px 2px #E74833;\n                        filter: brightness(1) sepia(0) grayscale(0) contrast(1.0);\n                    }\n                    // .News_Article_Img_Thumb {\n                    //     opacity: 0;\n                    // }\n                }\n                &:focus {\n                    outline: auto;\n                    .News_Article_Img {\n                        filter: brightness(1.0) sepia(0.0) grayscale(0) contrast(1.0);\n                    }\n                }\n            }\n\n            .News_Article_Featured .News_Article_Img {\n                filter: brightness(0.85) sepia(0) grayscale(0) contrast(1.02);\n            }\n\n            \n            \n            .News_Article_Img {\n                position: absolute;\n                background-size: cover;\n                background-position: center;\n                background-repeat: no-repeat;\n                overflow: hidden;\n                // width: calc(((100vw / 3) * 2) / 2);\n                // height: 30rem;\n                width: calc(((100vw / 3) * 2) / 2);\n                height: calc((((100vw / 3) * 2) / 2) * 0.627);\n                // height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                // width: calc((100vw / 3) * 2 + 10rem);\n                border-radius: 1.2rem;\n                margin-bottom: 3rem;\n                // border: 2px solid #FDF0E1;\n                box-shadow: 0px 0px 0px 2px #FDF0E1;\n                filter: brightness(0.5) sepia(1.0) grayscale(0.30) contrast(1.25);\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000), filter 150ms ease-out;\n            }\n            .News_Article_Img_Thumb {\n                background-position: center;\n                background-size: cover;\n                background-repeat: no-repeat;\n                width: 100%;\n                height: 100%;\n                border-radius: 1.2rem;\n                display: flex;\n                opacity: 1;\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                // transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            } \n            .News_Article_Content_Wrapper {\n                width: 100%;\n                position: relative;\n                // top: 33rem;\n                top: calc(((((100vw / 3) * 2) / 2 + 3rem) * 0.627));\n            }\n            .News_Article_Content {\n                position: absolute;\n                width: calc(((100vw / 3) * 2) / 2);\n                opacity: 1;\n                transition: opacity 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            }\n            .News_Article_Title {\n                font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                font-size: 4rem;\n                line-height: 3.4rem;\n                color: #FDF0E1;\n                text-align: left;\n                text-transform: uppercase;\n                margin-bottom: 3rem;\n                display: -webkit-box;\n                -webkit-line-clamp: 3;\n                -webkit-box-orient: vertical;\n                overflow: hidden;\n                margin-top: 0;\n                text-overflow: ellipsis;\n                width: 100%;\n\n                @media screen and (max-width: 800px) {\n                    -webkit-line-clamp: 2;\n                }\n            }\n            .News_Article_Title.minHeight {\n                min-height: 10rem;\n            }\n            .News_Article_Date {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                font-size: 1.4rem;\n                color: #FDF0E1;\n                text-align: left;\n                // text-align: center;\n                width: 100%;\n                text-transform: uppercase;\n                height: 1.7rem;\n                margin-bottom: 2rem;\n                // opacity: 0;\n                // top: 66rem;\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000)\n            }\n            .News_Article_Date_Clone {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                font-size: 1.4rem;\n                color: #FDF0E1;\n                text-align: left;\n                text-align: center;\n                width: 100%;\n                text-transform: uppercase;\n                height: 1.7rem;\n                margin-bottom: 2rem;\n                opacity: 0;\n                top: 66rem;\n                transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000)\n            }\n            .News_Article_Line {\n                width: 100%;\n                height: 1px;\n                background-color: #E74833;\n            }\n            .News_Article_Line.fixedHeight {\n                position: absolute;\n                top: 17rem;\n            }\n            .News_Article_HTML {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                font-size: 1.8rem;\n                line-height: 2.4rem;\n                // font-size: 1.4rem;\n                // line-height: 2rem;\n                color: #FDF0E1;\n                position: relative;\n                top: 60rem;\n                left: 50%;\n                z-index: 2;\n                opacity: 0;\n                width: 50vw;\n                transform: translateX(-50%);\n                transition: all 500ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                iframe {\n                    padding: 5rem 0;\n                    margin: 0 auto;\n                    width: 100%;\n                }\n                ul {\n                    padding: 0 4rem;\n                }\n                blockquote {\n                    font-size: 4rem;\n                    font-family: \"marscondensed-regular-TRIAL\", sans-serif;\n                    line-height: 3.5rem;\n                    text-transform: uppercase;\n                    padding: 4rem 0;\n                    border-top: 1px #FDF0E1 solid;\n                    border-bottom: 1px #FDF0E1 solid;\n                    padding: 4rem 0;\n                    margin: 0 auto;\n                }\n                a {\n                    font-weight: bold;\n                    color: #FDF0E1 !important;\n                    text-decoration: none;\n                    border-bottom: 1px #E74833 solid;\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &:hover {\n                        opacity: 0.5;\n                    }\n                }\n                img {\n                    max-height: 40rem;\n                    max-width: 100%;\n                    padding: 4rem 0;\n                    margin: 0 auto;\n                    text-align: center;\n                    display: flex;\n                }\n            }\n            // .News_Article_Clone_Close {\n            //     width: 5rem;\n            //     height: 5rem;\n            //     margin: 0 auto;\n            //     display: flex;\n            //     justify-content: center;\n            //     align-items: center;\n            //     position: relative;\n            //     padding: calc(2.5% + 5rem) 0 0;\n            //     // padding: calc(2.5% + 10rem) 0 0;\n            //     opacity: 0;\n            //     transform: translateY(-10rem);\n            //     transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 100ms;\n            //     &__L1 {\n            //         height: 2px;\n            //         background-color: #FDF0E1;\n            //         width: 100%;\n            //         position: absolute;\n            //         top: 50%;\n            //         left: 50%;\n            //         transform-origin: left;\n            //         transform: rotate(45deg) translate(-50%, -50%);\n            //     }\n            //     &__L2 {\n            //         height: 2px;\n            //         background-color: #FDF0E1;\n            //         width: 100%;\n            //         position: absolute;\n            //         top: 50%;\n            //         left: 50%;\n            //         transform-origin: left;\n            //         transform: rotate(-45deg) translate(-50%, -50%);\n            //     }\n            // }\n            .NewsPageUI_Wrapper_ACTIVE {\n                &:before {\n                    opacity: 0;\n                }\n                // .News_Article_Clone_Close {\n                //     opacity: 1;\n                //     transform: translateY(0);\n                // }\n                .News_Header {\n                    opacity: 0;\n                    transform: translateY(125%);\n                    transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                }\n                .News_Article_ACTIVE {\n                    .News_Article_Img {\n                        visibility: hidden;\n                    }\n                }\n                .News_Article_Clone_Wrapper {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100vh;\n                    .News_Article_Img {\n                        visibility: initial;\n                        transform: translateX(0%);\n                    }\n                }\n                .News_Article_Date_Header {\n                    opacity: 1;\n                    margin: calc(2.5% + 10rem) auto 2rem;\n                    transform: translateY(0%);\n                }\n                .News_Article_Title_Header {\n                    opacity: 1;\n                    transform: translateY(0%);\n                }\n                .News_Article_Img {\n                    // border: 2px solid #E74833 !important;\n                    box-shadow: 0px 0px 0px 2px #E74833 !important;;\n                    filter: brightness(1) sepia(0) grayscale(0) contrast(1.0) !important;\n                }\n                .News_Article_Img_Thumb {\n                    opacity: 0;\n                    // transition: initial;\n                }\n                // .News_Article_Date {\n                //     opacity: 1;\n                // }\n                .News_Article_Date_Clone {\n                    opacity: 1;\n                }\n                .News_Article_HTML {\n                    opacity: 1;\n                    top: 70.8rem;\n                    transition: all 1000ms cubic-bezier(0.455, 0.030, 0.515, 0.955);\n                }\n                // .News_Article_Icon_Wrapper {\n                //     visibility: initial;\n                // }\n                // .News_Article_Icon {\n                //     opacity: 1;\n                // }\n            }\n            .News_Article_HIDE {\n                opacity: 0;\n                transition: opacity 500ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 0ms;\n            }\n            .News_Article_Clone {\n                position: relative;\n                // top: 150px;\n                width: 100%;\n            }\n            .News_Article_Clone_ACTIVE {\n                .News_Article_Img {\n                    transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000), width 1000ms cubic-bezier(0.455, 0.030, 0.515, 0.955);\n                }\n            }\n            .News_Article_Clone_ACTIVE_V2 {\n                .News_Article_Img {\n                    // height: 60rem;\n                    height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                    // width: calc((100vw / 3) * 2 + 10rem);\n                    width: calc((100vw / 3) * 2 + 10rem) !important;\n                    left: calc(50% - ((100vw / 3) * 2 + 10rem) / 2) !important;\n                    transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000), width 1000ms cubic-bezier(0.455, 0.030, 0.515, 0.955), height 0ms;\n                }\n            }\n            .News_Article_Clone_ANIMATE_ACTIVE {\n                // height: 60rem !important;\n                height: calc(((100vw / 3) * 2 + 10rem) * 0.627) !important;\n                top: 0 !important;\n                left: 50% !important;\n                width: calc((100% / 3) * 2 + 10rem) !important;\n                margin: -2rem auto 10rem;\n                transform: translateX(-50%) !important;\n            }\n            .News_Article_Clone_ANIMATE_ACTIVE_V2 {\n                top: 0 !important;\n                margin: -2rem auto 10rem;\n            }\n            // .News_Article_Icon_Wrapper {\n            //     width: calc((100% / 3) * 2 + 10rem);\n            //     margin: 0 auto;\n            //     visibility: hidden;\n            //     z-index: 1;\n            // }\n            // .News_Article_Icon {\n            //     opacity: 0;\n            //     width: 20rem;\n            //     height: 20rem;\n            //     background-image: url('../images/icons/cta-scroll.svg');\n            //     position: absolute;\n            //     right: -17rem;\n            //     top: 42rem;\n            //     transition: all 700ms cubic-bezier(0.455, 0.03, 0.515, 0.955) 300ms;\n            // }\n\n            .NewsPage_ACTIVE {\n                overflow: initial !important;\n                .News_Article_Clone {\n                    background-color: #161616;\n                }\n            }\n            \n            @media screen and (max-width: 960px) {\n                .News_Article_Title_Header {\n                    font-size: 8rem;\n                    line-height: 7rem;\n                }\n            }\n\n            @media screen and (max-width: 600px) {\n                .News_Article_Clone {\n                    top: 100px;\n                }\n                .News_Header {\n                    font-size: 6rem;\n                    width: 100%;\n                    margin: 10rem 0 5rem;\n                }\n                .NewsPageUI_Wrapper {\n                    width: 100%;\n                }\n                .News_Articles {\n                    width: calc(100% - 5rem);\n                }\n                .News_Article_Wrapper {\n                    width: 100%;\n                    height: calc((20rem + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                }\n                .News_Article {\n                    width: 100%;\n                }\n                .News_Article_Wrapper.News_Article_Featured {\n                    height: calc((20rem + 3rem) + (10.3rem + 3rem) + (1.7rem + 2rem) + (1.4rem + 1rem));\n                }\n                .News_Article_Featured {\n                    .News_Article_Img {\n                        // height: 20rem;\n                        width: calc(100vw - 5rem);\n                        height: calc((100vw - 5rem) * 0.627);\n                    }\n                    .News_Article_Content_Wrapper {\n                        top: 23rem;\n                    }\n                }\n                .News_Article_Content_Wrapper {\n                    top: 23rem;\n                }\n                .News_Article_Img {\n                    // width: 100%;\n                    // height: 20rem;\n                    // width: calc(100vw - 5rem);\n                    height: calc((100vw - 5rem) * 0.627);\n                    width: calc(100vw - 5rem) !important;\n                    left: calc(50% - (100vw - 5rem) / 2) !important;\n                }\n                .News_Article_Content {\n                    width: 100%;\n                }\n                .News_Article_Title_Header {\n                    font-size: 6rem;\n                    line-height: 5rem;\n                    padding: 0;\n                }\n                // .News_Article_Clone_Close {\n                //     visibility: hidden;\n                // }\n                .News_Article_Clone_ANIMATE_ACTIVE_V2.News_Article_Img {\n                    // height: 20rem ;\n                    // height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                    height: calc((100vw - 5rem)*.627);\n                    // width: calc((100vw / 3) * 2 + 10rem);\n                    // width: calc(100% - 5rem)!important;\n                    width: calc(100vw - 5rem) !important;\n                    left: calc(50% - (100vw - 5rem) / 2) !important;\n                    transition: all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000), width 0ms, height 0ms, left 0ms,;\n                }\n                .News_Article_Clone_ANIMATE_ACTIVE {\n                    height: 20rem !important;\n                    top: 0 !important;\n                    left: 50% !important;\n                    width: calc(100% - 5rem)!important;\n                    transform: translateX(-50%) !important;\n                }\n                // .News_Article_Date {\n                //     top: 35rem;\n                // }\n                .News_Article_HTML {\n                    // top: 5rem;\n                    top: 40rem;\n                }\n                .NewsPageUI_Wrapper_ACTIVE {\n                    // .News_Article_Date {\n                    //     // top: 25rem;\n                    //     top: calc(((100vw / 3) * 2 + 10rem) * 0.627 + 5rem);\n                    // }\n                    .News_Article_Date_Clone {\n                        // top: 25rem;\n                        top: calc(((100vw / 3) * 2 + 10rem) * 0.627 + 5rem);\n                    }\n                    .News_Article_HTML {\n                        position: relative;\n                        // top: 0rem;\n                        // top: 30rem;\n                        top: calc(((100vw / 3) * 2 + 10rem) * 0.627 + 10rem);\n                        // padding: 25rem 0 20rem;\n                        width: calc(100% - 5rem);\n                        transition: all 1000ms cubic-bezier(0.455, 0.03, 0.515, 0.955), width 0ms;\n                    }\n                    .News_Article_Clone_Wrapper {\n                        top: 0 !important;\n                    }\n                    // .News_Article_Icon_Wrapper {\n                    //     visibility: hidden;\n                    // }\n                }\n            }            \n        }        \n        "},this.render=function(html){return html`
            <div class="NewsPageUI_Wrapper">
                <h1 class="News_Header">NEWS</h1>
                <div class="News_Articles">
                    ${CMS.get("news").sort(((a,b)=>b._order-a._order)).map(((item,index)=>html`
                    <div id="${item.slug}" class="News_Article_Wrapper ${0==index?"News_Article_Featured":""}" @click="${openArticle.bind(_this,item)}">
                        <a href="javascript:;" title="${item.title}" class="News_Article" >
                            <div class="News_Article_Img" style="background-image: url(${item.heroImage})">
                                <div class="News_Article_Img_Thumb" style="display: ${item.thumbnailImage?0==index?"none":"flex":"none"}; background-image: url(${item.thumbnailImage?0==index?"":item.thumbnailImage:""})"></div>
                            </div>
                            <div class="News_Article_Content_Wrapper">
                                <div class="News_Article_Content">
                                    <h2 class="News_Article_Title minHeight">${item.title}</h2>
                                    <div class="News_Article_Date">${item.date}</div>
                                    <div class="News_Article_Line"></div>
                                </div>
                            </div>
                        </a>
                    </div>
                    `))}
                </div>
                
                <div class="News_Article_Clone_Wrapper">
                    <div class="News_Article_Clone">
                        <!-- <div class="News_Article_Clone_Close">
                            <div class="News_Article_Clone_Close__L1"></div>
                            <div class="News_Article_Clone_Close__L2"></div>
                        </div> -->
                        <h1 class="News_Article_Title_Header"></h1>
                        <!-- <div class="News_Article_Icon_Wrapper">
                            <div class="News_Article_Icon"></div>
                        </div> -->
                        <div class="News_Article_Img_Wrapper"></div>
                        <div class="News_Article_Date_Clone"></div>
                        <div class="News_Article_HTML"></div>
                    </div>
                </div>                
                
            </div>
        `},this.postRender=async function(){await _this.querySelector(".NewsPage"),$newsPageUIWrapper=await _this.querySelector(".NewsPageUI_Wrapper"),$newsArticleCloneWrapper=await _this.querySelector(".News_Article_Clone_Wrapper"),await _this.querySelector(".News_Article_Clone"),$newsArticleImgWrapper=await _this.querySelector(".News_Article_Img_Wrapper"),$newsArticleTitleHeader=await _this.querySelector(".News_Article_Title_Header"),await _this.querySelector(".News_Article_Date"),$newsArticleDateClone=await _this.querySelector(".News_Article_Date_Clone"),$newsArticleHTML=await _this.querySelector(".News_Article_HTML"),$newsArticles=await _this.querySelectorAll(".News_Article_Wrapper"),_this.flag("postRendered",!0)}})),Class((function NewsPageUIv2(){Inherit(this,InteractiveUI),Inherit(this,ViewState,NewsArticleItem);const _this=this,$this=_this.element;var $container,$header;_this.config=Config.NEWS,async function initHTML(){$container=$this.create("NewsPageUIv2_Container"),($header=$container.create("NewsPageUIv2_Header","h6")).text(_this.config.header),await CMS.ready();let cmsNews=CMS.get("news");console.log(cmsNews);let data=new StateArray(cmsNews);_this.setSourceData(data),Dev.expose("data",data)}(),function initStyles(){$this.css({position:"relative",height:"100vh",width:"100vw"}),$container.css({position:"absolute",width:"100vw",height:"fit-content"}),$header.css({fontFamily:"'marscondensed-regular-TRIAL', sans-serif",fontSize:"12rem",color:"#66B4AD",textAlign:"center",textTransform:"uppercase",margin:"5rem auto",position:"relative",zIndex:"0",width:"calc(66% + 20rem)",transition:"all 1000ms cubic-bezier(0.190, 1.000, 0.220, 1.000) 150ms"})}(),_this.isPlayground()&&Container.instance().element.add($this),_this.animateIn=function(delay=300){console.log("NewsPageUIv2 animateIn")},_this.animateOut=async function(){console.log("NewsPageUIv2 animateOut")},this.onAddView=function(instance,index){_this.element.add(instance)},this.onRemoveView=function(instance,index){instance.element.remove()}})),Class((function TestPageUI(){Inherit(this,InteractiveUI);const $this=this.element;!function initHTML(){$this.size("100%","100vh"),$this.css({})}()})),Class((function NewsDetailPage(isFirst=!1){Inherit(this,InteractivePage,"newsDetail",isFirst);const _this=this;!async function(){await _this.ready()}(),_this.hide=function(){return new Promise((async resolve=>{this.views.forEach((async view=>{await view.hide()})),_this._hide(),resolve()}))}})),Class((function NewsDetailUI(){Inherit(this,InteractiveUI),Inherit(this,DOMTemplate);const _this=this,$this=_this.element;var _hash,_activeArticle,$newsDetailTitle,$newsDetailDate,$newsDetailImg,$newsDetailHTML,_news,_currentNewsIndex;async function loadArticle({item:item}){_this.flag("fromNewsPageIU",!0),_hash=item.slug,_activeArticle=await CMS.fetchNewsPage(_hash),_news.forEach((async(article,index)=>{article.date==_activeArticle.date&&(_currentNewsIndex=index)})),$this.css({opacity:0}),$newsDetailTitle.div.innerHTML=_activeArticle.title,$newsDetailDate.div.innerHTML=_activeArticle.date,$newsDetailImg.div.style.backgroundImage="url('"+_activeArticle.heroImage+"')",$newsDetailHTML.div.innerHTML=_activeArticle.body,_this.events.fire(NavigationHeader.CLOSE_SHOW),_this.flag("closeActive",!0)}async function onPrevClick(){_this.flag("fromNewsPageIU",!1),await _this.wait("postRendered"),_this.flag("fromNewsNav",!0),await _this.preAnimateOut(),0==_currentNewsIndex?ViewController.instance().changeRoute("news/"+_news[_news.length-1].slug):ViewController.instance().changeRoute("news/"+_news[_currentNewsIndex-1].slug)}async function onNextClick(){_this.flag("fromNewsPageIU",!1),await _this.wait("postRendered"),_this.flag("fromNewsNav",!0),await _this.preAnimateOut(),_currentNewsIndex==_news.length-1?ViewController.instance().changeRoute("news/"+_news[0].slug):ViewController.instance().changeRoute("news/"+_news[_currentNewsIndex+1].slug)}!async function(){_this.flag("animateIn",!1),async function init(){_news=await CMS.get("news"),_this.flag("isIdle",!0)}(),function addHandlers(){_this.events.sub(NewsController.LOAD_ARTICLE,loadArticle)}()}(),_this.animateIn=async function(delay=300){return new Promise((async resolve=>{await _this.wait("postRendered"),_this.flag("fromNewsPageIU")?($this.css({opacity:1}),_this.flag("closeActive")||(null!=_hash&&_this.events.fire(NavigationHeader.CLOSE_SHOW),_this.flag("closeActive",!0))):(await _this.wait("isIdle"),_this.flag("isIdle",!1),$this.css({opacity:0}),_hash=ViewController.instance().currentRoute.params.id,_activeArticle=await CMS.fetchNewsPage(_hash),_news.forEach((async(article,index)=>{article.date==_activeArticle.date&&(_currentNewsIndex=index)})),$newsDetailTitle.div.innerHTML=_activeArticle.title,$newsDetailDate.div.innerHTML=_activeArticle.date,$newsDetailImg.div.style.backgroundImage="url('"+_activeArticle.heroImage+"')",$newsDetailHTML.div.innerHTML=_activeArticle.body,_this.flag("fromNewsNav")?_this.flag("fromNewsNav",!1):(null!=_hash&&_this.events.fire(NavigationHeader.CLOSE_SHOW),_this.flag("closeActive",!0)),await $this.tween({opacity:1},1e3,"easeOutCubic").promise()),await defer(),function wrapIframes(){let iframes=$newsDetailHTML.div.querySelectorAll("iframe");for(let i=0;i<iframes.length;i++){const el=iframes[i];let wrapper=document.createElement("div");wrapper.className="iframe-wrapper",el.parentNode.style.padding=0,el.parentNode.insertBefore(wrapper,el),wrapper.appendChild(el)}}(),Device.mobile&&(Stage.div.scrollTop=0),_activeArticle&&ViewController.instance().setTitle("Prometheus Fuels - "+_activeArticle.title),_this.parent?.smooth.resize(),_this.flag("isIdle",!0),resolve()}))},this.animateOut=async function(){return new Promise((async resolve=>{_this.flag("fromNewsNav")||($this.tween({opacity:0},300,"easeOutCubic"),_this.events.fire(NavigationHeader.CLOSE_HIDE),_this.flag("closeActive",!1)),resolve()}))},_this.preAnimateOut=async function(delay=1e3){return _this.flag("isIdle",!1),new Promise((async resolve=>{await $this.tween({opacity:0},400,"easeOutCubic",0).promise(),_this.flag("isIdle",!0),resolve()}))},this.style=function(){return"\n        @font-face {\n            font-family: 'marscondensed-regular-TRIAL';\n            src: url('../fonts/marscondensed-regular-TRIAL.otf') format('opentype');\n            font-weight: 400;\n            font-style: bold;\n        }\n        @font-face {\n            font-family: 'FuturaLT-Bold';\n            src: url('../fonts/FuturaLT-Bold.ttf') format('truetype');\n            font-weight: 600;\n            font-style: normal;\n        }\n        @font-face {\n            font-family: 'FuturaLT-Medium';\n            src: url('../fonts/FuturaLT-Medium.ttf') format('truetype');\n            font-weight: 400;\n            font-style: normal;\n        }\n\n        #Stage, #Stage * {\n            .NewsDetailUI, {\n                width: 100%;\n                position: relative;\n                background-color: #161616;\n                * {\n                    position: relative;\n                    user-select: text;\n                }\n            }\n            .NewsDetailUI {\n                display: block;\n            }\n            .NewsDetailUI_Wrapper {\n                width: 100%;\n                display: block;\n                &:before {\n                    content: '';\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background-image: url('../assets/images/textures/grains.png');\n                    background-repeat-y: repeat;\n                    filter: brightness(2.75);\n                    opacity: 0;\n                    animation: GRAINS 1s linear 1 normal forwards;\n                }\n            }\n            @keyframes GRAINS {\n                0%   {opacity: 0}\n                50% {opacity: 1}\n                100% {opacity: 1}\n            }\n            // .News_Detail_Close_Wrapper {\n            //     padding: calc(2.5% + 0.7rem) 0 4.3rem;\n            //     margin: 0 auto;\n            //     display: flex;\n            //     justify-content: center;\n            //     align-items: center;\n            //     width: 5rem;\n            // }\n            // .News_Detail_Close {\n            //     width: 5rem;\n            //     height: 5rem;\n            //     position: relative;\n            //     transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            //     text-decoration: none;\n            //     &__L1 {\n            //         height: 2px;\n            //         background-color: #FDF0E1;\n            //         width: 100%;\n            //         position: absolute;\n            //         top: 50%;\n            //         left: 50%;\n            //         transform-origin: left;\n            //         transform: rotate(45deg) translate(-50%, -50%);\n            //         transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            //     }\n            //     &__L2 {\n            //         height: 2px;\n            //         background-color: #FDF0E1;\n            //         width: 100%;\n            //         position: absolute;\n            //         top: 50%;\n            //         left: 50%;\n            //         transform-origin: left;\n            //         transform: rotate(-45deg) translate(-50%, -50%);\n            //         transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n            //     }\n            //     &:hover {\n            //         cursor: pointer;\n            //         opacity: 0.5;\n            //         transform: scale(0.8);\n            //     }\n            //     &:focus {\n            //         cursor: pointer;\n            //         opacity: 0.5;\n            //         transform: scale(0.8);\n            //         outline: auto;\n            //     }\n                \n            // }\n            .News_Detail_Title {\n                font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                font-size: 12rem;\n                color: transparent;\n                text-align: center;\n                text-transform: uppercase;\n                line-height: 10rem;\n                // padding: calc(2.5% + 1.25rem) 0 0;\n                padding: 150px 0 0;\n                // padding: 9.6% 0 0;\n                margin: 0 auto 0;\n                z-index: 1;\n                width: 80vw;\n                // background: url('../images/textures/grains_2.jpg');\n                background: url('../assets/images/textures/grains_2.jpg');\n                background-size: cover;\n                -webkit-background-clip: text;\n                background-clip: text;\n            }\n            .News_Detail_Img {\n                background-size: cover;\n                background-position: center;\n                background-repeat: no-repeat;\n                height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                width: calc((100vw / 3) * 2 + 10rem);\n                // height: 60rem;\n                // width: calc((100% / 3) * 2 + 10rem);\n                margin: 0 auto;\n                border-radius: 1.2rem;\n                // border: 2px solid #E74833;\n                box-shadow: 0px 0px 0px 2px #E74833;\n                position: relative;\n                margin-top: 3rem;\n            }\n            // .News_Detail_Icon {\n            //     width: 20rem;\n            //     height: 20rem;\n            //     background-image: url('../images/icons/cta-scroll.svg');\n            //     position: absolute;\n            //     right: -17rem;\n            //     bottom: -4rem;\n            // }\n            .News_Detail_Date {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                text-align: center;\n                font-size: 1.4rem;\n                color: #FDF0E1;\n                text-transform: uppercase;\n                position: relative;\n                padding: 6rem 0 3rem;\n                width: 100%;\n            }\n            .News_Detail_HTML {\n                font-family: 'FuturaLT-Medium', sans-serif;\n                // font-size: 1.4rem;\n                // line-height: 2rem;\n                font-size: 1.8rem;\n                line-height: 2.4rem;\n                color: #FDF0E1;\n                width: 50vw;\n                padding: 0 0 20rem;\n                margin: 0 auto 0;\n                .iframe-wrapper{\n                    width: 100%;\n                    padding-bottom: 56.25%;\n                    margin: 5rem 0;\n                }\n                iframe {\n                    position: absolute;\n                    padding: 0;\n                    margin: 0 auto;\n                    width: 100%;\n                    height: 100%;\n                }\n                ul {\n                    padding: 0 4rem;\n                    margin: 0;\n                }\n                blockquote {\n                    font-size: 4rem;\n                    font-family: \"marscondensed-regular-TRIAL\", sans-serif;\n                    line-height: 3.5rem;\n                    text-transform: uppercase;\n                    padding: 4rem 0;\n                    border-top: 1px #FDF0E1 solid;\n                    border-bottom: 1px #FDF0E1 solid;\n                    padding: 4rem 0;\n                    margin: 0 auto;\n                }\n                a {\n                    font-weight: bold;\n                    color: #FDF0E1 !important;\n                    text-decoration: none;\n                    border-bottom: 1px #E74833 solid;\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &:hover {\n                        opacity: 0.5;\n                    }\n                    &:focus {\n                        outline: auto;\n                    }\n                }\n                img {\n                    // max-height: 40rem;\n                    // max-width: 100%;\n                    width: 100%;\n                    padding: 0;\n                    margin: 0 auto;\n                    text-align: center;\n                    display: flex;\n                }\n                p {\n                    padding: 0;\n                    margin: 0;\n                }\n                .ql-size-small {\n                    font-size: 1.2rem !important;\n                    line-height: 1.6rem !important;\n                }\n            }\n            .News_Detail_Nav {\n                display: flex;\n                justify-content: space-between;\n                width: 80vw;\n                margin: auto;\n                padding-bottom: 5rem;\n            }\n            .News_Detail_Nav_Prev {\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: flex-start;\n                width: 18rem;\n                text-decoration: none;\n                &__Arrow {\n                    width: 3rem;\n                    height: 3rem;\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &__L1 {\n                        transform-origin: left;\n                        position: absolute;\n                        transform: rotate(-45deg);\n                        top: 50%;\n                        width: 2rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                    &__L2 {\n                        position: absolute;\n                        top: 50%;\n                        width: 3rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                    &__L3 {\n                        position: absolute;\n                        top: 50%;\n                        transform-origin: left;\n                        transform: rotate(45deg);\n                        width: 2rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                }\n                &__Text {\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &:after {\n                        content: 'PREV ARTICLE';\n                        font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                        font-size: 3rem;\n                        color: #E74833;\n                        margin-left: 2rem;\n                    }\n                }\n                &:hover {\n                    .News_Detail_Nav_Prev__Arrow {\n                        transform: translateX(-50%);\n                    }\n                    .News_Detail_Nav_Prev__Text {\n                        opacity: 0.5;\n                        transform: translateX(-20%);\n                    }\n                }\n                &:focus {\n                    .News_Detail_Nav_Prev__Arrow {\n                        transform: translateX(-50%);\n                    }\n                    .News_Detail_Nav_Prev__Text {\n                        opacity: 0.5;\n                        transform: translateX(-20%);\n                    }\n                }\n            }\n            .News_Detail_Nav_Next {\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: flex-end;\n                width: 18rem;\n                text-decoration: none;\n                &__Arrow {\n                    width: 3rem;\n                    height: 3rem;\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &__L1 {\n                        transform-origin: right;\n                        position: absolute;\n                        transform: rotate(-45deg);\n                        top: 50%;\n                        right: 0;\n                        width: 2rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                    &__L2 {\n                        position: absolute;\n                        top: 50%;\n                        width: 3rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                    &__L3 {\n                        position: absolute;\n                        top: 50%;\n                        right: 0;\n                        transform-origin: right;\n                        transform: rotate(45deg);\n                        width: 2rem;\n                        height: 1px;\n                        background: #E74833;\n                    }\n                }\n                &__Text {\n                    transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                    &:after {\n                        content: 'NEXT ARTICLE';\n                        font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                        font-size: 3rem;\n                        color: #E74833;\n                        margin-right: 2rem;\n                    }\n                }\n                &:hover {\n                    .News_Detail_Nav_Next__Text {\n                        opacity: 0.5;\n                        transform: translateX(20%);\n                    }\n                    .News_Detail_Nav_Next__Arrow {\n                        transform: translateX(50%);\n                    }\n                }\n                &:focus {\n                    .News_Detail_Nav_Next__Text {\n                        opacity: 0.5;\n                        transform: translateX(20%);\n                    }\n                    .News_Detail_Nav_Next__Arrow {\n                        transform: translateX(50%);\n                    }\n                }\n            }\n            @media screen and (max-width: 960px) {\n                .News_Detail_Title {\n                    font-size: 8rem;\n                    line-height: 7rem;\n                }\n            }\n            @media screen and (max-width: 600px) {\n                .NewsDetailUI_Wrapper {\n                    width: calc(100% - 5rem);\n                    margin: auto;\n                }\n                .News_Detail_Title {\n                    font-size: 6rem;\n                    line-height: 5rem;\n                    // padding: calc(2.5% + 2rem) 0 0;\n                    padding: 100px 0 0;\n                }\n                .News_Detail_Date {\n                    width: 100%;\n                    // padding: 5rem 0 0;\n                    // padding: 4.6rem 0 0;\n                    padding: 6.5rem 0 0;\n                }\n                .News_Detail_Img {\n                    // height: 20rem;\n                    // height: calc(((100vw / 3) * 2 + 10rem) * 0.627);\n                    height: calc((100vw - 5rem)*.627);\n                    width: 100%;\n                }\n                .News_Detail_HTML {\n                    width: 100%;\n                    // padding: 5rem 0 20rem;\n                    padding: 5.3rem 0 20rem;\n                    // padding: 5.1rem 0 20rem; \n                }\n                // .News_Detail_Icon {\n                //     display: none;\n                // }\n                // .News_Detail_Close_Wrapper {\n                //     padding: 0;\n                // }\n                // .News_Detail_Close {\n                //     visibility: hidden;\n                //     padding: calc(2.5% + 10.2rem) 0 0;\n                // }\n                .News_Detail_Nav_Prev {\n                    &__Text {\n                        &:after {\n                            content: 'PREV';\n                        }\n                    }\n                }\n                .News_Detail_Nav_Next {\n                    &__Text {\n                        &:after {\n                            content: 'NEXT';\n                        }\n                    }\n                }\n            }\n        }        \n        "},this.render=function(html){return html`
            <div class="NewsDetailUI_Wrapper">
                <h1 class="News_Detail_Title"></h1>
                <div class="News_Detail_Img">
                    <!-- <div class="News_Detail_Icon"></div> -->
                </div>
                <div class="News_Detail_Date"></div>
                <div class="News_Detail_HTML"></div>    
                <div class="News_Detail_Nav">
                    <a href="javascript:;" title="Previous article" class="News_Detail_Nav_Prev" @click="${onPrevClick}">
                        <div class="News_Detail_Nav_Prev__Arrow">
                            <div class="News_Detail_Nav_Prev__Arrow__L1"></div>
                            <div class="News_Detail_Nav_Prev__Arrow__L2"></div>
                            <div class="News_Detail_Nav_Prev__Arrow__L3"></div>
                        </div>
                        <div class="News_Detail_Nav_Prev__Text"></div>
                    </a>
                    <a href="javascript:;" title="Next article" class="News_Detail_Nav_Next" @click="${onNextClick}">
                        <div class="News_Detail_Nav_Next__Text"></div>
                        <div class="News_Detail_Nav_Next__Arrow">
                            <div class="News_Detail_Nav_Next__Arrow__L1"></div>
                            <div class="News_Detail_Nav_Next__Arrow__L2"></div>
                            <div class="News_Detail_Nav_Next__Arrow__L3"></div>
                        </div>
                    </a>
                </div>
            </div>
        `},this.postRender=async function(){await _this.querySelector(".NewsDetailUI_Wrapper"),$newsDetailDate=await _this.querySelector(".News_Detail_Date"),$newsDetailTitle=await _this.querySelector(".News_Detail_Title"),$newsDetailImg=await _this.querySelector(".News_Detail_Img"),$newsDetailHTML=await _this.querySelector(".News_Detail_HTML"),_this.flag("postRendered",!0)}})),Class((function SceneParticles(){Inherit(this,Object3D);const _this=this;var _particles;!async function(){_this.layout=_this.initClass(SceneLayout,"scene-particles"),_particles=await _this.layout.getLayer("particles"),await _particles.ready(),_this.flag("isReady",!0)}(),_this.set("previousFrame",(async frame=>{await _this.wait("isReady"),_particles.shader.set("uPrevFrame",frame)}))})),Class((function PartnersHero(){Inherit(this,FXScene);const _this=this;var _resizeDebounced,_imgTexturePortrait,_imgTextureLandscape;function resizeHandler(){clearTimeout(_resizeDebounced),_resizeDebounced=_this.delayedCall((()=>{!async function resize(){let image=_this.layers.image,camera=_this.layers.camera;Stage.width<Stage.height?(_this.layers.text.setPropertiesCheck({size:.5}),_this.layers.text.group.position.x=0,_this.layers.text.group.position.y=-.3,image.shader.addUniforms({tMap:{value:_imgTexturePortrait},uScale2:{value:new Vector2(1.03,1.03)},uTranslate:{value:new Vector2(0,-.06)}})):(_this.layers.text.setPropertiesCheck({size:1.2}),_this.layers.text.group.position.x=-.25,_this.layers.text.group.position.y=1.103,image.shader.addUniforms({tMap:{value:_imgTextureLandscape},uScale2:{value:new Vector2(1,1)},uTranslate:{value:new Vector2(0,0)}})),await image.shader.uniforms.tMap.value.promise;let imageDimensions=image.shader.uniforms.tMap.value.dimensions,imageRatio=imageDimensions.width/imageDimensions.height,screenHeight=Utils3D.getHeightFromCamera(camera,camera.position.z-image.position.z),screenWidth=Utils3D.getWidthFromCamera(camera,camera.position.z-image.position.z),scale=screenWidth/screenHeight<imageRatio?screenHeight:screenWidth*(1/imageRatio);image.scale.x=imageRatio,image.scale.y=1,image.scale.z=1,image.scale.multiplyScalar(scale)}()}),300)}!async function(){_this.create(_this.parent?.parent?.nuke),_this.layout=_this.initClass(SceneLayout,"PartnersHero"),_this.layers=await _this.layout.getAllLayers(),_imgTextureLandscape=Utils3D.getTexture("assets/images/partners/partners-hero.jpg"),_imgTexturePortrait=Utils3D.getTexture("assets/images/partners/partners-hero-mobile.jpg"),_this.layers.text.renderOrder+=100,_this.layers.image.renderOrder=-1,async function initCamera(){let camera=_this.layers.camera;if(_this.useCamera(camera),_this.parent.getLayer){let parentCamera=await _this.parent.getLayer("camera");_this.startRender((_=>{camera.group.position.y=-.2*parentCamera.group.position.y,camera.group.position.z=-.4*parentCamera.group.position.y,camera.lookAt.y=.7*-parentCamera.group.position.y}))}}(),function addHandlers(){_this.onResize(resizeHandler)}(),_this.scene.add(_this.layout.group),_this.animateIn()}(),_this.animateIn=async function(){await _this.layers.text.ready(),_this.layers.text.shaderClass&&_this.layers.text.shaderClass.animateIn?(_this.layers.text.shaderClass.reset(),_this.layers.text.shaderClass.animateIn(ViewController.instance().isVisible?800:1500)):_this.layers.text.shader.shaderClass&&_this.layers.text.shader.shaderClass.animateIn?(_this.layers.text.shader.shaderClass.reset(),_this.layers.text.shader.shaderClass.animateIn(ViewController.instance().isVisible?800:1500)):console.warn("Text missing WaveTextShader shader class");let z=_this.layers.camera.position.z;_this.layers.camera.position.z+=2.5,tween(_this.layers.camera.position,{z:z},3e3,"easeOutCubic")},_this.animateOut=async function(){await _this.layers.text.ready()}})),Class((function PartnersHeroBGShader(_mesh,_shader){Inherit(this,Component);!async function(){_shader.addUniforms({tMap:{value:null},uScale2:{value:new Vector2(1,1)},uTranslate:{value:new Vector2(0,0)}})}()})),Class((function PartnersHeroLayer(_mesh,_shader){Inherit(this,Component);const _this=this;var _heroScene;function resizeHandler(){let aspect=Stage.width/Stage.height;_mesh.scale.x=aspect*_mesh.scale.y,Stage.width<Stage.height?_mesh.position.y=1:_mesh.position.y=0}!async function(){_heroScene=await _this.parent.getLayer("heroSection"),function initShaderRT(){_shader.set("tMap",_heroScene)}(),function addHandlers(){_mesh.scale.x,_mesh.scale.y,_this.onResize(resizeHandler)}()}()})),Class((function PartnersHeroLayerShader(_mesh,_shader){_shader.addUniforms({tMap:{value:null},uAngle:{value:0}}),_mesh.renderOrder=999})),Class((function PartnersLine(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;async function resize(){let image=_mesh,camera=_this.parent.layers.camera.baseCamera.camera,screenHeight=Utils3D.getHeightFromCamera(camera,camera.position.z-image.position.z),screenWidth=Utils3D.getWidthFromCamera(camera,camera.position.z-image.position.z);image.scale.x=.2,image.scale.y=3*screenHeight,image.scale.z=1;let pos=_input.get("wildcard"),x=Math.range(["left","center","right"].indexOf(pos),0,2,1.15*-screenWidth,1.15*screenWidth);image.position.x=x}_shader.addUniforms({tMap:{value:Utils3D.getTexture("assets/images/partners/lines.png")},uScale:{value:new Vector2(1,1)},transparent:!0}),_this.onResize(resize)})),Class((function PartnersLogoSection(){Inherit(this,Object3D);const _this=this;var _cameraUnits,_resizeDebounced,_hit,_parent,_size=Device.mobile?2:2.25,_gridColumns=Device.mobile?2:4,_group=$gl(),_logoOffsetX=Device.mobile?.1:.5,_data=[],_gridPos=[];function resizeHandler(){_cameraUnits=Utils3D.getHeightFromCamera(_this.parent.layers.camera.baseCamera,_this.parent.layers.camera.group.position.length()),_gridColumns=Math.round(Math.range(Stage.width,800,1200,2,4,!0)),_size=Math.range(Stage.width,800,1200,2,3,!0);let _cameraBottomPortrait=Math.range(Stage.width,375,800,3.9,4.4,!0);Stage.width<=800&&Stage.height>500?(_group.x=-(_size+_logoOffsetX-.1)*_gridColumns/2/_cameraUnits,_group.y=-.8,_this.parent.layers.camera.bottom=-_cameraBottomPortrait):Device.mobile&&Stage.width>Stage.height?(_size=Math.range(Stage.width,500,800,3,4,!0),_gridColumns=4,_group.x=-(_size+_logoOffsetX)*_gridColumns/2/_cameraUnits,_group.y=-1.8,_this.parent.layers.camera.bottom=-4):(_group.x=-(_size+_logoOffsetX)*_gridColumns/2/_cameraUnits,_group.y=-2,_this.parent.layers.camera.bottom=-3.8),clearTimeout(_resizeDebounced),_resizeDebounced=_this.delayedCall((()=>{!function initGridPos(){let x=0,y=0,row=0;_gridPos=[],_data.forEach(((item,i)=>{if(i%_gridColumns)x+=(_size+_logoOffsetX)/_cameraUnits;else{row+=1;let rowItems=_data.slice(i-_gridColumns,i);0===i&&(rowItems=_data.slice(0,_gridColumns)),x=0,y+=(_size+.5)/_cameraUnits,y}1===row&&(y=0);let size=_size/_cameraUnits;_gridPos.push({x:x,y:y,size:size}),_group.children[i].x=x,_group.children[i].y=-y,_group.children[i].width=size,_group.children[i].height=size}))}()}),300)}function onLogoHover(e){let $el;$el=e?.mesh?e.mesh.glui:e.object,$el.link&&("over"==e.action?$el.tween({scale:1.2},600,"easeOutCubic"):$el.tween({scale:1},300,"easeOutCubic"))}function onLogoClick(data){data.link&&(window.open(data.link,"_blank"),Track.event("partners",{items:[{item_id:`partners_logo_${data.alt}`,item_name:`partners_logo_${data.alt}`}]},`click:${data.alt}`))}!async function(){_parent=_this.findParent("PartnersPage"),_group.enable3D(!0),_group.hide(),_this.layout=_this.initClass(SceneLayout,"PartnersLogoSection"),_this.layers=await _this.layout.getAllLayers(),_cameraUnits=Utils3D.getHeightFromCamera(_this.parent.layers.camera.baseCamera,_this.parent.layers.camera.group.position.length()),await async function initData(){_data=[];let res=await CMS.get("partners");await Promise.all(res.map((async item=>{let obj=item,asset=await ImageUtil.square(item.asset),texture=new Texture(asset.canvas);obj.width=asset.width,obj.height=asset.height,obj.canvas=asset.canvas,obj.texture=texture,_data.push(obj)}))),_data=_data.sort(((a,b)=>a.alt<b.alt?-1:a.alt>b.alt?1:0))}(),function initHit(){let shader=_this.initClass(Shader,"InteractiveScrollSectionHitShader");(_hit=new Mesh(World.PLANE,shader)).position.y=1,_this.group.position.y=-4,_hit.shader.transparent=!0,_hit.renderOrder=-1,_this.add(_hit),_this.flag("hitReady",!0)}(),function initLogos(){_data.forEach(((item,i)=>{let size=_size/_cameraUnits,shader=_this.initClass(Shader,"PartnersLogoShader",{tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.15},uUVScale:{value:1.78},uRotation:{value:90},uTransition0:{value:0},uBoundingMin:{value:new Vector3},uBoundingMax:{value:new Vector3},transparent:!0,blending:Shader.ADDITIVE_BLENDING}),$logo=$gl(size,size,item.texture);$logo.enable3D(!0),$logo.useShader(shader),$logo.delay=100*i,$logo.shader.set("uBoundingMax",new Vector3(2,-5,1)),item.link&&item.link.length&&(Global.PLAYGROUND||$logo.interact(onLogoHover,onLogoClick.bind($logo,item),item.link,`Go to ${item.alt} website`),$logo.link=item.link),_group.add($logo)}))}(),function addHandlers(){_this.onResize(resizeHandler)}(),_parent.glScene.add(_group),await async function initSEO(){await _this.wait(250),await _this.wait((_=>_parent.camera)),GLSEO.registerPage(_group,"partners_logos_glui");let _seo={root:_group,seo:_data.map((item=>({url:item.link?item.link:"",label:item.alt})))},_meshes=_group.children.map((item=>item.mesh));Interaction3D.find(_parent.camera.baseCamera).add(_meshes,onLogoHover,onLogoClick,_seo)}()}(),_this.get("hit",(async()=>(await _this.wait(_this,"hitReady"),_hit))),_this.onInvisible=()=>{_group.hide(),_group.children.forEach((el=>{el.shader.set("uTransition0",0)}))},_this.onVisible=()=>{_group.show(),_group.children.forEach((el=>{el.shader.tween("uTransition0",1,4e3,"easeOutQuart",el.delay)}))},_this.hide=function(){_group.hide()}})),Class((function PartnersPage(isFirst=!1){Inherit(this,InteractiveScrollPage,"partners",isFirst);const _this=this;function resizeHandler(){Stage.width<Stage.height?(_this.layers.bg.position.y=-3.23,_this.layers.scrollHint.group.scale.set(.3,.3,1),_this.layers.scrollHint.group.position.x=0,_this.layers.scrollHint.group.position.y=.55,_this.layers.scrollHint.group.position.z=-1):(_this.layers.bg.position.y=-3.35,_this.layers.scrollHint.group.scale.set(.7,.7,1),_this.layers.scrollHint.group.position.x=-1.015,_this.layers.scrollHint.group.position.y=-1.514,_this.layers.scrollHint.group.position.z=-1)}!async function(){await _this.ready(),await _this.wait(_this,"cameraReady"),_this.layers=await _this.layout.getAllLayers(),_this.layers.camera.baseCamera.lock(),_this.layers.heroRTLayer.renderOrder=-1,_this.layers.bg.renderOrder=-3,_this.layers.left.renderOrder=-2,_this.layers.center.renderOrder=-2,_this.layers.right.renderOrder=-2,_this.layers.scrollHint.alpha=1,function addHandlers(){_this.onResize(resizeHandler),_this.events.sub(_this,"LayerVisible",(e=>{Track.event("partners",{items:[{item_id:`partners_section_scroll_${e.key}`,item_name:`partners_section_scroll_${e.key}`}]},`partners:section:${e.key}`)}))}(),_this.flag("layersReady",!0)}(),this.animateIn=async function(){await _this.wait("layersReady"),_this.layers.heroSection.animateIn(),tween(_this.layers.scrollHint,{alpha:0},0,"easeOutCubic"),tween(_this.layers.scrollHint,{alpha:1},600,"easeOutCubic",1500)},this.animateOut=async function(){},_this.onVisible=function(){CameraUtil.hardBlockScroll(!0)}})),Class((function PartnersSpaceBG(_mesh,_shader){Inherit(this,Component);const _this=this;async function resize(){let image=_mesh,camera=_this.parent.layers.camera.baseCamera.camera;await _shader.uniforms.tMap.value.promise;let imageDimensions=_shader.uniforms.tMap.value.dimensions,imageRatio=imageDimensions.width/imageDimensions.height,screenHeight=Utils3D.getHeightFromCamera(camera,camera.position.z-image.position.z),screenWidth=Utils3D.getWidthFromCamera(camera,camera.position.z-image.position.z),scale=screenWidth/screenHeight<imageRatio?screenHeight:screenWidth*(1/imageRatio);image.scale.x=imageRatio,image.scale.y=1,image.scale.z=1,image.scale.multiplyScalar(scale*Math.range(Stage.width/Stage.height,1.5,.5,2.6,4,!0))}!async function(){_shader.addUniforms({tMap:{value:null},tLines:{value:null},uScale2:{value:new Vector2(1,1)}}),await _this.parent.getAllLayers(),_this.onResize(resize)}()})),Class((function PrivacyPage(){Inherit(this,InteractivePage,"privacy");const _this=this;!async function(){await _this.ready(),_this.element.css({opacity:"0"})}(),this.animateIn=function(){_this.element.tween({opacity:1},600,"easeOutCubic",600),_this.element.css({position:"relative !important"})},this.animateOut=function(){_this.element.tween({opacity:0},300,"easeOutCubic")}})),Class((function PrivacyUI(){Inherit(this,InteractiveUI),Inherit(this,DOMTemplate);const _this=this;_this.element;var _content,$body;!async function(){_this.flag("animateIn",!1),async function init(){await CMS.ready(),_content=await CMS.get("contact.terms"),await _this.wait("postRendered"),$body.div.innerHTML=_content}()}(),this.style=function(){return"\n            $small: 500px;\n            $medium: 900px;\n            @font-face {\n                font-family: 'marscondensed-regular-TRIAL';\n                src: url('../fonts/marscondensed-regular-TRIAL.otf') format('opentype');\n                font-weight: 400;\n                font-style: bold;\n            }\n            @font-face {\n                font-family: 'FuturaLT-Bold';\n                src: url('../fonts/FuturaLT-Bold.ttf') format('truetype');\n                font-weight: 600;\n                font-style: normal;\n            }\n            @font-face {\n                font-family: 'FuturaLT-Medium';\n                src: url('../fonts/FuturaLT-Medium.ttf') format('truetype');\n                font-weight: 400;\n                font-style: normal;\n            }\n\n            .PrivacyUI {\n                display: block;\n                position: relative !important;\n                width: 100vw;\n\n                & > * {\n                    position:relative !important;\n                }\n\n                &__title {\n                    font-family: 'marscondensed-regular-TRIAL', sans-serif;\n                    font-size: 12rem;\n                    color: #FDF0E1;\n                    text-align: center;\n                    text-transform: uppercase;\n                    line-height: 10rem;\n                    padding: calc(2.5% + 1.25rem) 0 0;              \n                    margin: 0 auto 0;\n                    z-index: 1;\n                    width: 80vw;\n                    background: url('../images/textures/grains-2.jpg');\n                    background-size: cover;\n                    -webkit-background-clip: text;\n                    background-clip: text;\n                    color: transparent;\n                }\n\n                &__content {\n                    & > * {\n                        position:relative !important;\n                    }\n\n                    font-family: 'FuturaLT-Medium', sans-serif;\n                    font-size: 1.8rem;\n                    line-height: 2.4rem;\n                    color: #FDF0E1;\n                 \n                    margin: 0 auto 0;\n\n\n                    @media screen and (max-width: $small) {\n                        width: initial;\n                        padding: 40px;\n                        padding-top: 80px;\n                        font-size: 1.4rem;\n                        line-height: 1.4;\n                    }\n                    @media screen and (min-width: $small) {\n                        width: 50vw;\n                        padding: 10rem 0 20rem;\n                    }\n\n                    iframe {\n                        padding: 5rem 0;\n                        margin: 0 auto;\n                        width: 100%;\n                    }\n                    ul {\n                        padding: 0 4rem;\n\n                        & > * {\n                            position:relative !important;\n                        }\n                    }\n\n                    p {\n                        margin: 0;\n                        padding: 0;\n                        & > * {\n                            position:relative !important;\n                        }\n                    }\n\n                    blockquote {\n                        font-size: 4rem;\n                        font-family: \"marscondensed-regular-TRIAL\", sans-serif;\n                        line-height: 3.5rem;\n                        text-transform: uppercase;\n                        padding: 4rem 0;\n                        border-top: 1px #FDF0E1 solid;\n                        border-bottom: 1px #FDF0E1 solid;\n                        padding: 4rem 0;\n                        margin: 0 auto;\n                    }\n                    a {\n                        font-weight: bold;\n                        color: #FDF0E1;\n                        text-decoration: none;\n                        border-bottom: 1px #E74833 solid;\n                        transition: all 300ms cubic-bezier(0.190, 1.000, 0.220, 1.000);\n                        &:hover {\n                            opacity: 0.5;\n                        }\n                        &:focus {\n                            outline: auto;\n                        }\n                    }\n                    img {\n                        // max-height: 40rem;\n                        // max-width: 100%;\n                        width: 100%;\n                        padding: 4rem 0;\n                        margin: 0 auto;\n                        text-align: center;\n                        display: flex;\n                    }\n                }\n            }\n        "},this.render=function(html){return html`
            <div class="PrivacyUI">
                <h1 class="PrivacyUI__title"></h1>
                <div class="PrivacyUI__content"></div>    
            </div>
        `},this.postRender=async function(){$body=await _this.querySelector(".PrivacyUI__content"),_this.flag("postRendered",!0)}})),Class((function ScrollHint(_input){Inherit(this,Object3D);const _this=this;var $wrapper,$circleWrap,$circle,$arrow,_color=new Color;async function arrowOut(){await $arrow.tween({y:.4,alpha:0,scale:.95},1e3,"easeInCubic",400).promise(),async function arrowIn(){$arrow.y=.1,await $arrow.tween({y:.3,alpha:1,scale:1},1400,"easeOutQuart").promise(),await _this.wait(1500),arrowOut()}()}function loop(){$circleWrap.rotation-=.1}!function(){if(_this.renderOrder=9999,_input&&_input instanceof InputUILConfig){let color=_input.get("wildcard");color?_color.setHex(color):_color.setHex(Colors.hex.orange)}!function initWrapper(){($wrapper=$gl()).alpha=0,$wrapper.x=-.5,$wrapper.y=-.5,_this.add($wrapper.group)}(),function initCircle(){($circleWrap=$gl()).x=.5,$circleWrap.y=.5;let shader=_this.initClass(Shader,"ScrollHintItemShader",{uColor:{value:_color}});($circle=$gl(1,1,"assets/images/ui/star-circle.png")).useShader(shader),$circle.x=-.5,$circle.y=-.5,$circleWrap.add($circle),$wrapper.add($circleWrap)}(),function initArrow(){let shader=_this.initClass(Shader,"ScrollHintItemShader",{uColor:{value:_color}});($arrow=$gl(.4,.4,"assets/images/ui/down-arrow.png")).useShader(shader),$arrow.x=.3,$arrow.y=.3,$wrapper.add($arrow)}(),_this.delayedCall((()=>{_this.start()}),500),_this.startRender(loop)}(),_this.set("rotation",(v=>{})),_this.set("alpha",(v=>{$wrapper.alpha=v})),_this.get("alpha",(()=>$wrapper.alpha)),_this.start=function(){arrowOut()}})),Class((function ScrollProgress({$parent:$parent,views:views}={}){Inherit(this,Component);const _this=this;var $container,_shader,_color=new Color;!async function(){_color.setHex(Colors.hex.beige),$container=$gl(3,.65*Stage.height,"#FFFFFF"),_shader=_this.initClass(Shader,"ScrollProgressShader",{uIndex:{value:1},uColor:{value:_color},uSectionAmount:{value:views.length},uAlpha0:{value:0},transparent:!0}),$container.useShader(_shader),$container.x=.95*Stage.width,$container.y=.55*Stage.height-$container.height/2}(),_this.setIndex=function(index){index,_shader.tween("uIndex",index,400,"easeOutCubic")},_this.animateOut=function(delay=0){_shader.tween("uAlpha0",0,400,"easeOutCubic",delay)},_this.animateIn=function(delay=0){_shader.tween("uAlpha0",1,400,"easeOutCubic",delay)}})),Class((function TechnologyBGShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;function resize(){"portrait"==SceneLayout.breakpoint||Device.mobile?_shader.set("uApplyTilt",0):_shader.set("uApplyTilt",1)}_shader.addUniforms({uColor:{value:new Color},uApplyTilt:{value:1}}),_this.onResize(resize)})),Class((function TechnologyGraphicShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise_basecolor.png"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:90},uTransition0:{value:0}}),this.animateIn=async function(delay=0){await _shader.tween("uTransition0",1,2e3,"easeOutCubic",delay).promise()},this.animateOut=async function(delay=0){await _shader.tween("uTransition0",0,300,"easeOutCubic",delay).promise()}})),Class((function TechnologyPage(isFirst=!1){Inherit(this,InteractiveScrollPage,"technology",isFirst);const _this=this,$this=_this.element;var _element,_video,$modal,$vidContainer,$closeContainer,$closeWrapper;function hideModal(){_this.flag("videoModalOpen",!1),_video.pause(),$modal.tween({x:"100%"},300,"easeOutCubic")}function fixPauseSafari(){_this.flag("forcedReflowForVideoFix")?(_element.classList.remove("forceReflow"),_this.flag("forcedReflowForVideoFix",!1)):(_element.classList.add("forceReflow"),_this.flag("forcedReflowForVideoFix",!0))}function hideCloseModalBtn(){$closeContainer.tween({opacity:0},1e3,"easeOutCubic").onComplete((_=>{$closeContainer.hide()}))}function showCloseModalBtn(){$closeContainer.show(),$closeContainer.tween({opacity:1},300,"easeOutCubic")}function handleOrientation(orientation){"landscape"==orientation&&_this.flag("videoModalOpen")&&_video&&_video.requestFullscreen()}function resize(){_this.flag("videoIsPlaying")&&Device.mobile&&(Stage.height>Stage.width?hideCloseModalBtn():showCloseModalBtn()),_this.camera&&("portrait"==SceneLayout.breakpoint&&Stage.width<600?(_this.camera.baseCamera.setFOV(30),_this.camera.bottom=0):Device.mobile?.phone&&Stage.width>Stage.height?(_this.camera.baseCamera.setFOV(22.5),_this.camera.bottom=0):Device.mobile?.tablet&&Stage.width>Stage.height?(_this.camera.baseCamera.setFOV(35),_this.camera.bottom=0):(_this.camera.baseCamera.setFOV(30),_this.camera.bottom=0))}function handleHoverCloseBtn(e){e.action}function handleClickCloseBtn(){!function closeModal(){_this.events.fire(TechnologyPage.CLOSE_MODAL),PageUIController.instance().$container.css({zIndex:"unset"}),hideModal()}()}function openModal(){PageUIController.instance().$container.css({zIndex:999999}),function showModal(){_this.flag("videoModalOpen",!0),showCloseModalBtn(),$modal.tween({x:"0%"},800,"easeOutQuint").onComplete((_=>{_video.play(),"landscape"==PageUIController.instance().state.orientation&&Device.mobile&&_video.requestFullscreen()}))}()}!async function(){await async function initHTML(){(function initStyles(){$this.goob(`\n            width: 100%;\n            height: 100%;\n\n            .videoModal {\n                z-index: 99999;\n                position: fixed !important;\n                width: 100%;\n                height: 100%;\n                top: 0;\n                left: 0;\n                background: rgba(255,255,255, 0.75);\n            }\n\n            .vidContainer {\n                top: 0;\n                bottom: 0;\n                left: 0;\n                right: 0;\n                margin: auto;\n                width: 100%;\n                height: 100%;\n                background: rgba(50,50,50, 0.75);\n\n                video {\n                    pointer-events: ${Device.mobile?"auto":"none"};\n                    width: 100%;\n                    height: 100%;\n                    top: 0;\n                    left: 0;\n\n                    &.forceReflow {\n                        position: absolute !important;\n                    }\n                }\n            }\n\n            .close-container {\n                position: absolute;\n                top: 47px;\n                right: 25px;\n                width: 4rem;\n                height: 4rem;\n                transform: translateX(-50%);\n\n                @media (max-width: 767px) {\n                    top: 27px;\n                    right: 16px;\n                }\n\n                @media (max-width: 600px) {\n                    top: 27px;\n                    right: 8px;\n                }\n            }\n\n            .closeButton {\n                position: absolute;\n                top: 50px;\n                right: 50px;\n                width: 50px;\n                height: 50px;\n                background: #ff0000;\n            }\n\n            .vjs-control-bar {\n                position: absolute !important;\n                bottom: 42px;\n\n                @media (max-width: 767px) {\n                    bottom: 20px;\n                }\n            }\n\n            #custom-player .vjs-play-control .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-play.png")});\n            }\n\n            #custom-player .vjs-play-control.vjs-playing .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-pause.png")});\n            }\n\n            #custom-player .vjs-mute-control .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-volume.png")});\n            }\n\n            #custom-player .vjs-mute-control.vjs-vol-2 .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-volume-low.png")});\n            }\n\n            #custom-player .vjs-mute-control.vjs-vol-1 .vjs-icon-placeholder:before, \n            #custom-player .vjs-mute-control.vjs-vol-0 .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-volume-none.png")});\n            }\n            \n            #custom-player .vjs-fullscreen-control .vjs-icon-placeholder:before {\n                background-image: url(${Assets.getPath("assets/images/technology/player-ui/icon-fullscreen.png")});\n            }\n        `)})(),function initModal(){$modal=$this.create("videoModal"),($vidContainer=$modal.create("vidContainer")).div.setAttribute("id","custom-player"),function initCloseButton(){($closeContainer=$modal.create("close-container")).interact(handleHoverCloseBtn,handleClickCloseBtn,"#","Close video button"),$closeContainer.div.setAttribute("title","Close video button"),$closeContainer.hit.div.setAttribute("role","button"),($closeWrapper=$closeContainer.create("close-wrapper")).css({position:"relative",width:"100%",height:"100%"}),$closeWrapper.create("closeLine1").css({position:"absolute",top:"50%",left:"50%",width:"100%",height:"2px",background:Colors.value.beige,transformOrigin:"left",transform:"rotate(45deg) translate(-50%, -50%)"}),$closeWrapper.create("closeLine2").css({position:"absolute",top:"50%",left:"50%",width:"100%",height:"2px",background:Colors.value.beige,transformOrigin:"left",transform:"rotate(-45deg) translate(-50%, -50%)"})}()}(),await async function initVideo(){(_element=document.createElement("video")).crossOrigin="anonymous",_element.setAttribute("crossorigin","anonymous"),_element.setAttribute("playsinline",""),_element.setAttribute("webkit-playsinline",""),_element.setAttribute("id","tech-video"),_element.setAttribute("preload","auto"),_element.style.width="100%",_element.style.height="100%",_element.style.padding="0",_element.style.maxWidth="100%",_element.style.background="#000000",_element.src=Assets.getPath("assets/images/technology/Prometheus_Tech_Film_1080_v4.mp4"),$vidContainer.div.appendChild(_element),Global.PLAYGROUND&&await AssetLoader.loadAssets(["~assets/js/lib/video.min.js"]);(_video=videojs(_element,{controls:!0,autoplay:!1,preload:!0,fluid:!0,controlBar:{children:["playToggle","progressControl","volumePanel","fullscreenToggle"]}},(async function onPlayerReady(){Device.mobile&&(this.play(),await defer(),this.pause()),this.on("playing",(function(e){_this.flag("videoIsPlaying",!0),$vidContainer.div.classList.remove("loadingVideo"),_this.flag("userInactive")&&Device.mobile&&Stage.height>Stage.width&&hideCloseModalBtn(),Device.mobile||"safari"!=Device.system.browser||_this.stopRender(fixPauseSafari)})),this.on("pause",(function(e){if(_this.flag("videoIsPlaying",!1),Device.mobile&&showCloseModalBtn(),!Device.mobile&&"safari"==Device.system.browser){let pausedAtTime=_video.currentTime();fixPauseSafari(),_this.startRender(fixPauseSafari,2),_this.delayedCall((_=>{_this.flag("videoIsPlaying")||_video.currentTime(pausedAtTime)}),500)}})),this.on("useractive",(function(){_this.flag("userInactive",!1),showCloseModalBtn()})),this.on("userinactive",(function(){_this.flag("userInactive",!0),_this.flag("videoIsPlaying")&&Device.mobile&&Stage.height>Stage.width&&hideCloseModalBtn()})),this.on("waiting",(function(e){$vidContainer.div.classList.add("loadingVideo")})),this.on("canplaythrough",(function(e){$vidContainer.div.classList.remove("loadingVideo")})),this.on("canplay",(function(e){$vidContainer.div.classList.remove("loadingVideo")})),this.on("ended",(function(e){$vidContainer.div.classList.remove("loadingVideo")}))}))).src({src:Assets.getPath("assets/images/technology/Prometheus_Tech_Film_1080_v4.mp4"),type:"video/mp4"}),_video.addClass("video-js"),_video.addClass("vjs-hydra")}(),hideModal()}(),await _this.ready(),await _this.wait(_this,"cameraReady"),function addListeners(){_this.onResize(resize),_this.events.sub(_this,"LayerVisible",(e=>{Track.event("technology",{items:[{item_id:`technology_section_scroll_${e.key}`,item_name:`technology_section_scroll_${e.key}`}]},`technology:section:${e.key}`)})),_this.events.sub(TechnologyPage.OPEN_MODAL,openModal),Device.mobile&&_this.bindState(PageUIController.instance().state,"orientation",handleOrientation)}()}(),this.animateIn=function(){_this.views[0]?.parentRef?.onVisible();let z=_this.camera.group.position.z;_this.camera.group.position.z-=1.5,tween(_this.camera.group.position,{z:z},3e3,"easeOutCubic")},this.animateOut=function(){},_this.onVisible=function(){CameraUtil.hardBlockScroll(!0)},_this.onInvisible=function(){PageUIController.instance().$container.css({zIndex:"unset"}),hideModal()}}),(()=>{TechnologyPage.OPEN_MODAL="TechnologyPage.OPEN_MODAL",TechnologyPage.CLOSE_MODAL="TechnologyPage.CLOSE_MODAL"})),Class((function TechnologyPlayBtnScriptClass(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;!function(){let btnTexture=Utils3D.getTexture(Assets.getPath("assets/images/technology/play_btn.png")),playShader=_this.initClass(Shader,"TechnologyPlayBtnScriptClass",{tMap:{value:btnTexture},uColor:{value:new Color("#FDF0E1")},uBgColor:{value:new Color("#E84733")},uIsText:{value:0},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0},depthTest:!1,transparent:!0});_mesh.shader=playShader,function initDebug(){if(!Global.PLAYGROUND)return;_mesh.shader.uniforms.uTransition0.value=1}()}()})),Class((function TechnologyPlayButtonShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uColor:{value:new Vector3},uBgColor:{value:new Vector3},uIsText:{value:0},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0}}),this.animateIn=async function(delay=0){_shader.set("uTransition0",0),await _shader.tween("uTransition0",1,900,"easeIn",delay).promise()},this.animateOut=async function(delay=0){await _shader.tween("uTransition0",0,400,"easeIn",delay).promise()}})),Class((function TechnologySectionOne(){Inherit(this,InteractiveScrollSection,"section1"),Inherit(this,Element);const _this=this;_this.element;var _scrollHint,_text,$playBtn,$playIcon,$playTextLabel,$playHitMobile,$logoExceptionHit,$burgerExceptionHit,_enabledPlayFollow=!1,_enabledModalClick=!0,_modalOpened=!1;function playBtnLoop(){$playBtn.x+=.15*(Mouse.x-$playBtn.x),$playBtn.y+=.15*(Mouse.y-$playBtn.y)}async function addExceptionsHitAreas(){_enabledPlayFollow&&!_this.flag("exceptionsEnabled")&&(_this.flag("exceptionsEnabled",!0),($logoExceptionHit=$gl(125,120,"#ff6600")).alpha=0,GLUI.Stage.add($logoExceptionHit),($burgerExceptionHit=$gl(130,110,"#ff6600")).alpha=0,$burgerExceptionHit.x=Stage.width-150,GLUI.Stage.add($burgerExceptionHit),$logoExceptionHit.interact(handleHitExceptionHover,(_=>{})),$burgerExceptionHit.interact(handleHitExceptionHover,(_=>{})))}function clearExceptionsHitAreas(){_enabledPlayFollow&&(_this.flag("exceptionsEnabled",!1),$logoExceptionHit.remove(),$burgerExceptionHit.remove())}function handleHoverModalA11y(e){"over"==e.action?$playIcon.tween({scale:1.2},500,"easeOutCubic"):$playIcon.tween({scale:1},150,"easeOutCubic")}function onRouteChange(e){let route=e.toLowerCase();_modalOpened=!1,"technologypage"==route?(_enabledPlayFollow&&(Mouse.x=Stage.width/2,Mouse.y=Stage.height/2+180),toggleModalClick(!0,700),addExceptionsHitAreas()):(toggleModalClick(!1),clearExceptionsHitAreas())}async function handleHitExceptionHover(e){_modalOpened||("over"==e.action?(_this.flag("hoveringExceptionHit",!0),toggleModalClick(!1),await defer(),Stage.cursor("auto")):(_this.flag("hoveringExceptionHit",!1),toggleModalClick(!0)))}function toggleModalClick(enable,playBtnDelay=0){enable&&function canEnableClick(){return!PageUIController.instance().state.menuOpen&&"technology"==ViewController.instance().getState()&&!_this.flag("hoveringExceptionHit")&&!_modalOpened}()?(_enabledModalClick=!0,function animateInPlayBtn(delay=0){$playIcon.shader.set("uTransition0",0),$playTextLabel.shader.set("uTransition0",0),$playIcon.shader.tween("uTransition0",1,900,"easeIn",delay),$playTextLabel.shader.tween("uTransition0",1,700,"easeIn",delay)}(playBtnDelay)):(_enabledModalClick=!1,function animateOutPlayBtn(delay=0){$playTextLabel.shader.tween("uTransition0",0,400,"easeIn",delay),$playIcon.shader.tween("uTransition0",0,400,"easeIn",delay)}(playBtnDelay))}function handleWindowClick(){_enabledModalClick&&openModal()}function handlePlayClickMobile(){"technology"==ViewController.instance().getState()&&openModal()}function resize(){if(_enabledPlayFollow)$burgerExceptionHit.x=Stage.width-150;else{let topOffset=Stage.width>Stage.height?Stage.height<450?40:120:65;$playBtn.x=Stage.width/2,$playBtn.y=Stage.height/2+topOffset}Stage.height<450?$playBtn.scale=.85:$playBtn.scale=1}function handleMenuOpen(isOpen){isOpen&&toggleModalClick(!1)}function openModal(){_modalOpened=!0,toggleModalClick(!1),clearExceptionsHitAreas(),_this.events.fire(TechnologyPage.OPEN_MODAL)}function closeModal(){_modalOpened=!1,addExceptionsHitAreas(),_enabledPlayFollow||toggleModalClick(!0)}function loop(){Math.range(_this.progress,0,.25,1,0)}!async function(){await _this.wait(_this,"isReady"),_scrollHint=_this.layers.scrollHint,_text=_this.layers.text1,GLSEO.setPageH1(_this.findParent("TechnologyPage"),_text.text.text.string),function initPlayVideoButton(){($playBtn=$gl()).x=Stage.width/2,$playBtn.y=Stage.height/2+180,GLUI.Stage.add($playBtn);let btnTexture=Utils3D.getTexture(Assets.getPath("assets/images/technology/play_btn.png"));($playIcon=$gl(64,64,Assets.getPath("assets/images/technology/play_btn.png"))).x=-32,$playIcon.y=-32;let playShader=_this.initClass(Shader,"TechnologyPlayButtonShader",{tMap:{value:btnTexture},uColor:{value:new Color("#FDF0E1")},uBgColor:{value:new Color("#E84733")},uIsText:{value:0},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0}});$playIcon.useShader(playShader),$playBtn.add($playIcon),($playTextLabel=$gl(80.15,12.49,Assets.getPath("assets/images/technology/play_btn.png"))).x=-41,$playTextLabel.y=Device.mobile?49:43;let textShader=_this.initClass(Shader,"TechnologyPlayButtonShader",{tMap:{value:btnTexture},uColor:{value:new Color("#FDF0E1")},uIsText:{value:1},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0}});$playTextLabel.useShader(textShader),$playBtn.add($playTextLabel),Device.mobile||(_enabledPlayFollow=!0,Mouse.x=$playBtn.x,Mouse.y=$playBtn.y)}(),await async function addListeners(){_enabledPlayFollow?(_this.startRender(playBtnLoop),await _text.ready(),addExceptionsHitAreas(),_this.events.sub(Mouse.input,Interaction.START,handleWindowClick),function addModalA11y(){let modalA11y=$gl(0,0,"#ff0000");modalA11y.parentSeo=_this.findParent("TechnologyPage"),GLUI.Stage.add(modalA11y),modalA11y.interact(handleHoverModalA11y,handleWindowClick,"#","Play Video button: Open Prometheus technology video")}()):function addMobilePlayBtnInteract(){($playHitMobile=$gl(92,103,"#0000ff")).x=-48,$playHitMobile.y=-36,$playHitMobile.alpha=0,$playBtn.add($playHitMobile),$playHitMobile.parentSeo=_this.findParent("TechnologyPage"),$playHitMobile.interact(handleHoverModalA11y,handlePlayClickMobile,"#","Play Video button: Open Prometheus technology video")}();_this.onResize(resize),_this.events.sub(ViewController.UPDATE,onRouteChange),_this.events.sub(TechnologyPage.CLOSE_MODAL,closeModal),_this.bindState(PageUIController.instance().state,"menuOpen",handleMenuOpen),"technology"==ViewController.instance().getState()?toggleModalClick(!0,1e3):toggleModalClick(!1)}(),_this.flag("hintReady",!0)}(),_this.animateIn=async()=>{await _this.wait(_this,"hintReady"),tween(_scrollHint,{alpha:1},600,"easeOutCubic",1500),_this.startRender(loop)},_this.animateOut=async()=>{await _this.wait(_this,"hintReady"),tween(_scrollHint,{alpha:0},300,"easeOutCubic",0),_this.stopRender(loop)}})),Class((function TechnologyVideoBGShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _videoTexture;function handleResize(){_shader.uniforms.uWindowSize.value.set(Stage.width,Stage.height)}_shader.addUniforms({tMap:{value:null},tDimensions:{value:new Vector2(1280,720)},uWindowSize:{value:new Vector2},uAlpha:{value:0},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0}}),(_videoTexture=_this.initClass(VideoTexture,Assets.getPath("assets/images/technology/0_Landing.mp4"),{autoplay:!0,muted:!0,loop:!0})).start(),_shader.set("tMap",_videoTexture.uniform.value),function addHandlers(){_this.onResize(handleResize)}()})),Class((function ColorBlockShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color(Math.random(),Math.random(),Math.random())},uRange:{value:new Vector2(-1.3,1.4)},uSubtract:{value:1},uDustTexture:{value:Utils3D.getRepeatTexture("assets/images/test/dust.jpg"),ignoreUIL:!0}})})),Class((function ColorShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color(Math.random(),Math.random(),Math.random())}})})),Class((function ScrollTest(){Inherit(this,FXScene);const _this=this;var _particles;function loop(){_this.render(),_particles.previousFrame=World.NUKE.prevFrameRT}!async function(){_this.create();let layout=_this.initClass(SceneLayout,"scrolltest");_this.scene.add(layout.group);let scrollCamera=await layout.getLayer("camera");scrollCamera.baseCamera.lock();let b=await layout.getLayer("b");scrollCamera.observe(b,(visible=>{console.log(visible)})),(_particles=await layout.getLayer("particles")).previousFrame=World.NUKE.prevFrameRT,_this.startRender(loop,World.NUKE),World.NUKE.add(new BlitPass)}()})),Class((function TestPage(){Inherit(this,InteractivePage,"test");const _this=this;!async function(){await _this.ready()}(),this.animateIn=function(){console.log("show test page")},this.animateOut=function(){console.log("hide test page")}})),Class((function TestPageUI(){Inherit(this,Element);const $this=this.element;!function initHTML(){$this.size("100%","100vh"),$this.css({})}()})),Class((function TestSection(){Inherit(this,InteractiveSection,"test-section");const _this=this;!async function(){await _this.ready();_this.initClass(TimelineLayoutLink,_this.layout)}()})),Class((function TestTextView(){Inherit(this,Object3D);const _this=this;!async function(){_this.layout=_this.initClass(SceneLayout,"text_text_view")}()})),Class((function TestView(){Inherit(this,Object3D);const _this=this;var _playback;function loop(){_playback.seek(_this.progress)}!async function(){_this.layout=_this.initClass(SceneLayout,"testlayout_osctest");_this.initClass(TimelineLayoutLink,_this.layout);await _this.layout.getLayer("camera"),_playback=await _this.initClass(TimelinePlayback,"timeline_animation"),_this.startRender(loop)}()})),Class((function TransitionTest(){Inherit(this,Object3D);this.initClass(SceneLayout,"transition_test")})),Class((function TransitionTestShader(_mesh,_shader){Inherit(this,Component);const _this=this;var _dimensions=new Vector2;function resize(){_shader&&(_dimensions.x=Stage.width,_dimensions.y=Stage.height,_shader.set("uStageDimensions",_dimensions))}!async function(){let texture=Utils3D.getRepeatTexture("assets/images/noise/grunge.jpg");_shader.addUniforms({tTo:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg"),ignoreUIL:!0},tFrom:{value:Utils3D.getTexture("assets/images/_scenelayout/uv.jpg"),ignoreUIL:!0},tNoise:{value:Utils3D.getRepeatTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},tGrunge:{value:texture,ignoreUIL:!0},uTransition0:{value:.01,ignoreUIL:!1},uTransition:{value:0,ignoreUIL:!1},uTransitionColor:{value:new Color},uUVScale:{value:.8},uVignette:{value:0},uSpeed:ViewController.SPEED_MULTI,uFlipped:{value:0},uMobile:{value:Device.mobile?1:0},uRotation:{value:-60},uRGBShift:{value:1},uNoise:{value:0},uGrunge:{value:0},uBloomAdd:{value:0,ignoreUIL:!0},uStageDimensions:{value:_dimensions},uDimensions:{value:new Vector2}}),await texture.promise,_shader.set("uDimensions",new Vector2(texture.dimensions.width,texture.dimensions.height)),_this.onResize(resize)}()})),Class((function WaveTextShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;_shader.addUniforms({tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise18.jpg"),ignoreUIL:!0},uTimeScale:{value:0},uUVScale:{value:4},uRotation:{value:20},uTransition0:{value:0}}),_this.animateIn=async function(delay=0){_this.flag("visible")||(_this.flag("visible",!0),_shader.set("uTransition0",0),await _shader.tween("uTransition0",1,2e3,"easeOutQuart",delay).promise())},_this.animateOut=async function(delay=0){_this.flag("visible")&&(_this.flag("visible",!1),await _shader.tween("uTransition0",0,300,"easeOutCubic",delay).promise())},_this.reset=function(){_this.flag("visible",!1),_shader.set("uTransition0",0)}})),Class((function AnimatedFuelForgeShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uDirection:{value:new Vector3},uOffset:{value:new Vector3},uDistance:{value:10},uPosterizeTime:{value:12},uParams:{value:new Vector4},uColor:{value:new Color("#526163")},uGrain:{value:.9},uFlip:{value:0},uSomething:{value:0},tMatcap:{value:null},tAo:{value:null},tLightmap:{value:null,getTexture:Utils3D.getRepeatTexture},tMask:{value:null},uLightmapPower:{value:1},uNoiseStrength:{value:0},uBrightness:{value:1},uColor0:{value:new Color("#ffee66")},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#ffffff")},uColor3:{value:new Color("#ffffff")},uPosterizeNoise:{value:12},uFanSpeed:{value:12},uAxis:{value:new Vector3(0,1,0)},uOrientation:{value:new Vector4(0,0,0,0)}})})),Class((function AnimatedInstanceShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uDirection:{value:new Vector3},uOffset:{value:new Vector3},uDistance:{value:10},uPosterizeTime:{value:12},uParams:{value:new Vector4},uKeyLightDir:{value:new Vector3(0,4,0)},uBounceLightDir:{value:new Vector3(-.1,-1.5,0)},uRimLightDir:{value:new Vector3(0,1,-1)},uKeyLightStep:{value:.8},uBounceStep:{value:1.1},uRimStep:{value:.8},uColor:{value:new Color("#526163")},uBounceColor:{value:new Color("0c0c0c")},uRimColor:{value:new Color("#ffffff")},uShadowColor:{value:new Color("#1f1f1f")},uGrain:{value:.9},uFlip:{value:0}})})),Class((function BonfireShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap0:{value:null},tMap1:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uGrain:{value:.5},uDiscard:{value:.5},uDirection:{value:new Vector2},uParams:{value:new Vector4},uColor0:{value:new Color("FFFFFF")},uColor1:{value:new Color("000000")}})})),Class((function CloudDistanceShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;_shader.addUniforms({tStaticTexture:{value:null,getTexture:Utils3D.getRepeatTexture},tAnimatedTexture:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,.1)},uTime:{value:0},uDirection:{value:new Vector2(0,.1)},uGrain:{value:.15},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#000000")},uColor3:{value:new Color("#e6e6e6")},uColor4:{value:new Color("#b6b6b6")},uGradient1:{value:new Vector3},uGradient2:{value:new Vector3},uGradientRotation:{value:0},uDiscard:{value:.5},uPosterizeTime:{value:12},uPosterizeTimeNoise:{value:12},uAlpha:{value:1},uOther:{value:1}}),_this.startRender((_=>{_shader.uniforms.uTime.value+=.015*(1+3*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER}))})),Class((function CutoutShader(_mesh,_shader,_group,_input){Inherit(this,Component);!async function(){if(_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0},uDirection:{value:new Vector2},uTile:{value:new Vector2(1,1)},uOffset:{value:new Vector2},uColor:{value:new Color},uColor1:{value:new Color},uMix:{value:0},uNoiseStrength:{value:0},uPosterizeTime:{value:12},uHueAdjust:{value:0},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},uBrightness:{value:1},uBillboard:{value:0}}),Renderer.type==Renderer.WEBGL1){await defer();let tile=_shader.get("uTile");if(1==tile.x&&1==tile.y){let texture=_shader.get("tMap");texture&&(texture.wrapS=texture.wrapT=Texture.CLAMP_TO_EDGE)}}}()})),Class((function FlatColorShader(_mesh,_shader){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color}})})),Class((function GreyboxShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uFresnelParams:{value:new Vector4(.1,.5,.5,0)}})})),Class((function HueShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uHueAdjust:{value:0},uAlpha:{value:1}})})),Class((function MatcapShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMatcap:{value:null},tAo:{value:null},tLightmap:{value:null,getTexture:Utils3D.getRepeatTexture},tMask:{value:null},uLightmapPower:{value:1},uNoiseStrength:{value:0},uBrightness:{value:1},uColor0:{value:new Color("#ffee66")},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#ffffff")},uColor3:{value:new Color("#ffffff")},uPosterizeTime:{value:12},uPosterizeNoise:{value:12},uFanSpeed:{value:12},uAxis:{value:new Vector3(0,1,0)},uOffset:{value:new Vector3},uLightDir:{value:new Vector4}})})),Class((function ModifiedGlassShader(_mesh,_shader){_shader||(_shader=_mesh),_shader.addUniforms({tEnv:{value:null},tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uRefractionRatio:{value:1},uReflectScale:{value:1},uEnvBlend:{value:1},uRatio:{value:.5},uAttenuation:{value:.5},uAlpha:{value:1},uShininess:{value:1},uFresnelPow:{value:1},uFresnelAlpha:{value:1},uDistortStrength:{value:1},uSpecAdd:{value:new Vector2(1,0)},uPhongColor:{value:new Color},uFresnelColor:{value:new Color},uLightDir:{value:new Vector3(0,0,1)},uTransparent:{value:1},uAlphaRange:{value:new Vector4(0,1,0,1)},uColor0:{value:new Color},uColor1:{value:new Color},uColorParams:{value:new Vector4}})})),Class((function ShadowShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uColor:{value:new Color},uColor1:{value:new Color},uStep:{value:.5},uMaskStep:{value:.5},uNoise:{value:0},uNoiseReduce:{value:0},uMaskNoise:{value:0},uPosterizeTime:{value:12},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1}})})),Class((function SkyGradientShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uDirection:{value:new Vector2},uTile:{value:new Vector2(1,1)},uOffset:{value:new Vector2},uColor:{value:new Color},uColor1:{value:new Color},uMix:{value:0},uNoiseStrength:{value:0},uPosterizeTime:{value:12},uHueAdjust:{value:0},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uBrightness:{value:1}})})),Class((function SpeedlineShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uParams:{value:new Vector4},uPosterizeTime:{value:6}})})),Class((function SpinningFanShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uKeyLightDir:{value:new Vector3(0,4,0)},uBounceLightDir:{value:new Vector3(-.1,-1.5,0)},uRimLightDir:{value:new Vector3(0,1,-1)},uKeyLightStep:{value:.8},uBounceStep:{value:1.1},uRimStep:{value:.8},uColor:{value:new Color("#526163")},uBounceColor:{value:new Color("0c0c0c")},uRimColor:{value:new Color("#ffffff")},uShadowColor:{value:new Color("#1f1f1f")},uGrain:{value:.9},uWobble:{value:new Vector2},uWobbleSpeed:{value:8},uSpeed:{value:1},uPosterizeTime:{value:12},uAxis:{value:new Vector3(0,0,1)}})})),Class((function StylizedBuildingShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},tLightMap:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.4},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#573331")},uColor2:{value:new Color("#1F1611")},uColor3:{value:new Color("#193347")},uShadowColor:{value:new Color("#69008D")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uLightMix:{value:0},uLightColor:{value:new Color("#FFFFFF")}})})),Class((function StylizedCloudShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;_shader.addUniforms({tStaticTexture:{value:null,getTexture:Utils3D.getRepeatTexture},tAnimatedTexture:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,.1)},uTime:{value:0},uDirection:{value:new Vector2(0,.1)},uGrain:{value:.15},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#000000")},uColor3:{value:new Color("#e6e6e6")},uColor4:{value:new Color("#b6b6b6")},uGradient1:{value:new Vector3},uGradient2:{value:new Vector3},uGradientRotation:{value:0},uDiscard:{value:.5},uPosterizeTime:{value:12},uPosterizeTimeNoise:{value:12},uAlpha:{value:1}}),_this.startRender((_=>{_shader.uniforms.uTime.value+=.015*(1+3*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER}))})),Class((function StylizedDiffuseShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uKeyLightDir:{value:new Vector3(0,4,0)},uBounceLightDir:{value:new Vector3(-.1,-1.5,0)},uRimLightDir:{value:new Vector3(0,1,-1)},uKeyLightStep:{value:.8},uBounceStep:{value:1.1},uRimStep:{value:.8},uHueAdjust:{value:0},uColor:{value:new Color("#526163")},uBounceColor:{value:new Color("0c0c0c")},uRimColor:{value:new Color("#ffffff")},uShadowColor:{value:new Color("#1f1f1f")},uGrain:{value:.9},uGrainReduce:{value:0},uWobble:{value:new Vector2},uWobbleSpeed:{value:8},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedFieldShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tAnimatedTexture:{value:null,getTexture:Utils3D.getRepeatTexture},tLightmap:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,.1)},uDirection:{value:new Vector2(0,.1)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#000000")},uColor3:{value:new Color("#e6e6e6")},uColor4:{value:new Color("#b6b6b6")},uPosterizeTime:{value:12},uGradient1:{value:new Vector3},uGradient2:{value:new Vector3},uGradientRotation:{value:0},uGradientApply:{value:0},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedGrassShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uWind:{value:new Vector4(.5,.1,.1,0)},uGrassColor1:{value:new Color("#578443")},uGrassColor2:{value:new Color("#80b74e")},uCutoff:{value:.1,ignoreUIL:!0},uGrassColor1:{value:new Color},uGrassColor2:{value:new Color},uFogColor:{value:new Color},uFogDepth:{value:new Vector2(4,40)},uEnv:{value:new Color}})})),Class((function StylizedPBRTextureShader(_mesh,_shader){Inherit(this,Component);_shader.addUniforms({tBaseColor:{value:null,getTexture:Utils3D.getRepeatTexture},tMRO:{value:null,getTexture:Utils3D.getRepeatTexture},tNormal:{value:null,getTexture:Utils3D.getRepeatTexture},tEnvDiffuse:{value:null,premultiplyAlpha:!1},tEnvSpecular:{value:null,premultiplyAlpha:!1},tLightmap:{value:null,premultiplyAlpha:!1},uClearCoat:{value:new Vector3(.6,.7,0)},uNoiseStrength:{value:0},uSaturation:{value:1},uStep:{value:.5},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#FFFFFF")},uColor2:{value:new Color("#39404B")},uColor3:{value:new Color("#B34E3C")},uColor4:{value:new Color("#FFFFFF")},uApplyPBR:{value:0},uShadowColor:{value:new Color("#727C8B")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedRoadShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;_shader.addUniforms({tAnimatedTexture:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,.1)},uDirection:{value:new Vector2(0,.1)},uGrain:{value:.15},uTime:{value:0},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#ffffff")},uColor2:{value:new Color("#000000")},uColor3:{value:new Color("#e6e6e6")},uColor4:{value:new Color("#b6b6b6")},uGradient1:{value:new Vector3},uGradient2:{value:new Vector3},uGradientRotation:{value:0},uPosterizeTime:{value:12},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}}),_this.startRender((_=>{_shader.uniforms.uTime.value+=.015*(1+3*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER}))})),Class((function StylizedSmokeShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;_shader.addUniforms({uTime:{value:0},tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uColor:{value:new Color("#FBF2D1")},uColor2:{value:new Color("#C9C9AB")},uStep:{value:.2},uTile:{value:new Vector2(1,.1)},uSpeed:{value:.5},uHeight:{value:3},uGrain:{value:.1},uGradientStep:{value:.817},uGradientRange:{value:new Vector2(.27,1)},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},uFade:{value:new Vector2(.7,.2)}}),_this.startRender((_=>{_shader.uniforms.uTime.value+=.015*(1+2*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER}))})),Class((function StylizedTextureShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#FFFFFF")},uColor2:{value:new Color("#39404B")},uColor3:{value:new Color("#B34E3C")},uShadowColor:{value:new Color("#727C8B")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedTextureShaderExtra(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#FFFFFF")},uColor2:{value:new Color("#39404B")},uColor3:{value:new Color("#B34E3C")},uColor4:{value:new Color("#FFFFFF")},uShadowColor:{value:new Color("#727C8B")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedWaterShader(_mesh,_shader,_group,_input){Inherit(this,Component);const _this=this;var _clearColor=new Color("#000");!async function(){_shader.addUniforms({uColor1:{value:new Color("#2e668c")},uColor2:{value:new Color("#67f1ff")},uColor3:{value:new Color("#c1ffd9")},tData:{value:Utils3D.getTexture("assets/images/shipping/water.png")},uMirrorDiffuse:{value:new Vector3(1,1,1)},uClearColor:{value:_clearColor},uWave:{value:new Vector3(1,1,1)},uDirection:{value:0},uScale:{value:1},uStep:{value:1},uGrain:{value:.35},uGrainReduce:{value:.5},uTime:{value:0},uPosterizeTime:{value:12}}),_this.startRender((_=>{_shader.uniforms.uTime.value+=.015*(1+3*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER;let camera=_this.parent.parent.nuke.camera;_this.mirror&&_this.mirror.useCamera(camera)}));let camera=_this.parent.parent.nuke.camera,nuke=_this.parent.parent.nuke;_this.mirror=_this.initClass(FX.Mirror,_mesh,{nuke:nuke,camera:camera,size:1024,enabled:!0}),_this.mirror.clearColor=_clearColor,_shader.uniforms.tMirrorReflection.ignoreUIL=!0;let layers=await _this.parent.getAllLayers(),exclude=(_input.get("wildcard")||"").split(",").map((name=>name.trim()));for(let id in layers)if(!id.trim().includes(exclude)&&!layers[id].isGroup&&!layers[id].isTweenAnchor){let layer=layers[id];layer.instanceMeshReady?layer.instanceMeshReady.then((_=>{_this.mirror.add(layer.instanceMesh)})):layer.clone&&_this.mirror.add(layer)}_this.mirror.start()}()})),Class((function TextureShader(_mesh,_shader){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uAlpha:{value:1},transparent:!0})})),Class((function TilingSkyShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uTile:{value:new Vector4}})})),Class((function WaterShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2},uColor0:{value:new Color},uColor1:{value:new Color},uParams:{value:new Vector4},uStep:{value:.5}})})),Class((function AnimatedBird(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tAnimation:{value:null}})})),Class((function Bird(_input,_group){Inherit(this,Object3D);const _this=this;!async function(){!async function initScene(){_this.layout=_this.initClass(SceneLayout,"birdlayout")}()}()})),Class((function BirdFlockLayout(){Inherit(this,Object3D);const _this=this;var _flock1,_flock2,_flock3,_flock4;!async function(){Tests.hasBirds()&&(await async function initScene(){if(!_this)return;_this.layout=_this.initClass(SceneLayout,"birdflocklayout_flocking"),await _this.layout.getAllLayers(),_flock1=_this.layout.layers.flock_1,_flock2=_this.layout.layers.flock_2,_flock3=_this.layout.layers.flock_3,_flock4=_this.layout.layers.flock_4,_flock1.shader.visible=!1,_flock2.shader.visible=!1,_flock3.shader.visible=!1,_flock4.shader.visible=!1;let proton=_this.layout.layers.particles;await proton.ready(),proton.behavior.shader.addUniforms({uFlock1:{value:new Vector3},uFlock2:{value:new Vector3},uFlock3:{value:new Vector3},uFlock4:{value:new Vector3}}),_this.proton=proton,proton.behavior.shader.uniforms.uFlock1.value=_flock1.position,proton.behavior.shader.uniforms.uFlock2.value=_flock2.position,proton.behavior.shader.uniforms.uFlock3.value=_flock3.position,proton.behavior.shader.uniforms.uFlock4.value=_flock4.position}(),_this.startRender((_=>{_flock1.position.z=20*Math.sin(-15e-5*Render.TIME+.5),_flock1.position.x=28*Math.cos(-15e-5*Render.TIME+.5),_flock2.position.z=22*Math.sin(-15e-5*Render.TIME+1),_flock2.position.x=25*Math.cos(-15e-5*Render.TIME+1),_flock3.position.z=22*Math.sin(15e-5*Render.TIME+1.5),_flock3.position.x=28*Math.cos(15e-5*Render.TIME+1.5),_flock4.position.z=25*Math.sin(15e-5*Render.TIME+.75),_flock4.position.x=25*Math.cos(15e-5*Render.TIME+.75)})))}()})),Class((function InstancedBirds(_proton,_group){Inherit(this,Object3D);const _this=this;!async function initMesh(){_proton.antimatter.storeVelocity=!0;let birdGeometry=await GeomThread.loadGeometry("assets/geometry/birds/simplebird2.json"),geom=(new Geometry).instanceFrom(birdGeometry);_proton.applyToInstancedGeometry(geom);let shader=_this.initClass(Shader,"InstancedBirdParticles",{tAnimation:{value:Utils3D.getLookupTexture("assets/images/birds/birdanimation.jpg")},uColor1:{value:new Color},uColor2:{value:new Color},uAltColor1:{value:new Color},uAltColor2:{value:new Color},uEnabled:{value:0}});_this.shader=shader,ShaderUIL.add(shader,_group).setLabel("Shader"),_proton.applyToShader(shader);let mesh=new Mesh(geom,shader);mesh.frustumCulled=!1,_this.add(mesh)}()})),Class((function InteractivePage(_name=Utils.query("name"),isFirst=!1){Inherit(this,Element),Inherit(this,FXScene),Inherit(this,GLUIToRT);const _this=this,$this=_this.element;var _transitionShader,_config=Config.PAGE[_name],_views=[],_hideCall=null;function loop(){if(_this.smooth){let delta=_this.smooth.smooth.progress-_this.previous;delta=Math.clamp(-.2,.2,10*delta),_transitionShader.uniforms.uScrollDelta.value=1+delta,_this.previous=_this.smooth.smooth.progress}}function onLogoClick(){_this.smooth&&(_this.smooth.smooth.scroll=0)}_this.hasScene=!0,_this.name=_name,_this.promise=Promise.create(),_this.previous=0,async function(){"home"==_name&&(_config=[...Config.PAGE.chapter1,...Config.PAGE.chapter2,...Config.PAGE.chapter3]),function initHTML(){$this.css({width:"100vw",overflow:"hidden"})}(),function initScene(){_this.create(RTPool.instance().getRT())}(),await function initViews(){if(!_config)return;return _config.forEach(((section,index)=>{let view;if(section.layout)view=_this.initClass(section.layout,index,section,isFirst);else{let existing=ViewCache[section.layoutName];existing?view=existing:(view=_this.initClass(InteractiveSection,section.layoutName,index,section,isFirst),ViewCache[section.layoutName]=view)}view.ui||(section.ui?(view.ui=_this.initClass(section.ui,[$this]),view.ui.parent=_this):(view.ui=_this.initClass(InteractiveUI,{height:section.height||1},[$this]),view.ui.parent=_this)),_views.push(view)})),Promise.all(_views.map((view=>view.ready)))}(),function addListeners(){_this.events.sub(NavigationHeader.LOGO_CLICK,onLogoClick)}(),_this.promise.resolve(),_this.startRender(loop)}(),_this.get("views",(_=>_views)),_this.show=async function(){return new Promise((async resolve=>{_hideCall&&(clearTimeout(_hideCall),_hideCall=null),Global.PLAYGROUND||PageUIController.instance().$container.add($this),_views.forEach((view=>{view.parent=_this,view.ui&&($this.add(view.ui),view.ui.parent=_this)})),_this.smooth||function initSmooth(){_config&&(_this.smooth=SmoothRenderManager.createLocal(),_transitionShader=_this.initClass(Shader,"ViewControllerTransition",{tMap1:{value:null},tMap2:{value:null},uRatio:{value:Stage.width/Stage.height},uScrollDelta:{value:1},uTransition:{value:0}}),_this.smooth.initialize(_this,_transitionShader,{container:PageUIController.instance().$container,smoothScroll:Tests.useSmoothScroll(),pingPong:Tests.pingPongSections()}))}(),_this.smooth?.show(_this),_this.animateIn&&await _this.animateIn(),resolve()}))},_this.hide=async function(){return new Promise((async resolve=>{_this.animateOut&&await _this.animateOut(),_views.forEach((view=>{view.hide(!0)})),_this.smooth&&_this.smooth.hide(),_hideCall=_this.delayedCall((()=>{_this.visible=!1,PageUIController.instance().$container.removeChild($this),_hideCall=null}),600),resolve()}))},_this.ready=function(){return _this.promise}})),Class((function InteractivePageWrapper(_clazz="",isFirst=!1){Inherit(this,Object3D);const _this=this;var _view;_view=_this.initClass(_clazz,isFirst),_this.show=function(){_view&&_view.show()},_this.hide=function(){_view&&_view.hide()},_this.get("view",(()=>_view)),_this.set("visible",(v=>{_this.group.visible=v,_view&&(_view.visible=v)}))})),Class((function InteractiveScrollPage(_name=Utils.query("name"),isFirst=!1){Inherit(this,Element),Inherit(this,FXScene),Inherit(this,GLUIToRT);const _this=this,$this=_this.element,EXCLUDED=["camera","bg"];var _views=[];_this.glSceneEnabled=!0,_this.hasScene=!0,_this.name=_name,_this.promise=Promise.create(),async function(){GLSEO.registerPage(_this,_this.name),function initHTML(){$this.css({width:"100%"})}(),async function initScene(){_this.create(),_this.layout=_this.initClass(SceneLayout,_name),_this.scene.add(_this.layout.group),_this.layers=await _this.layout.getAllLayers(),function setupBg(){_this.bg=_this.layers.bg,_this.bg&&(_this.bg.frustumCulled=!1)}(),function setupCamera(){_this.layers.camera&&(_this.camera=_this.layers.camera,_this.camera.lerp=Device.mobile?.5:.2,Object.keys(_this.layers).forEach((async(key,index)=>{if(!EXCLUDED.includes(key)){let hit=await _this.layers[key].hit;if(!hit)return;hit.color=_this.layers[key].color,hit.parentRef=_this.layers[key],_views.push(hit),_this.camera.observe(hit,(async visible=>{await _this.wait(100),visible?(_this.events.fire("LayerVisible",{key:key}),_this.layers[key].onVisible()):_this.layers[key].onInvisible()}));let colorHit=await _this.layers[key].colorHit;if(!colorHit)return;colorHit.parentRef=_this.layers[key],_this.camera.observe(colorHit,(async visible=>{await _this.wait(100),visible&&_this.layers[key].onColorHitVisible()}))}})),_this.isPlayground()&&_this.show());_this.flag("cameraReady",!0)}(),_this.promise.resolve(),isFirst&&(await Initializer3D.uploadAll(_this.layout),_this.events.fire(InteractiveSection.INITIAL_LOADED))}(),_this.displayGLUI(!0)}(),_this.onVisible=()=>{GLUI.Scene.camera=_this.nuke.camera},_this.onInvisible=()=>{},_this.get("views",(_=>_views)),_this.show=async function(){await _this.promise,Global.PLAYGROUND||PageUIController.instance().$container.add($this),_this.gluiToScreen(),_this.animateIn&&await _this.animateIn(),_this.camera&&_this.useCamera(_this.camera.baseCamera),_this.onVisible()},_this.hide=async function(){_this.gluiToRT(),_this.delayedCall((()=>{_views.forEach((view=>{view.parentRef&&view.parentRef.hide&&view.parentRef?.hide()})),_this.visible=!1,_this.camera.reset(),_views.forEach((view=>{view.parentRef&&view.parentRef.reset&&view.parentRef.reset()}))}),600),PageUIController.instance().$container.removeChild($this)},_this.ready=function(){return _this.promise}})),Class((function InteractiveScrollSection(_input){Inherit(this,Object3D);const _this=this,OPTION_MAP={title:{width:2,size:.28,position:new Vector3(0,.2,0)},paragraph:{width:1.3},landscapeMobile:{title:{width:2,size:.4,position:new Vector3(0,.35,0)}}};var _name,_hit,_colorHit,_video,_texts=[],_others=[];async function resize(){await _this.wait(_this,"isReady"),"portrait"==SceneLayout.breakpoint||Device.mobile.phone&&Stage.height>Stage.width?(_texts.forEach((async text=>{let props={align:"center"},settings=OPTION_MAP[text.type];settings&&(props={...props,...settings}),await text.text.loaded(),await text.text.text.ready(),text.setPropertiesCheck(props,!0)})),_this.layers.text1.group.position.copy(OPTION_MAP.title.position)):Stage.height<450&&Stage.width>=Stage.height?(_texts.forEach((async text=>{let props={align:"center"},settings=OPTION_MAP.landscapeMobile[text.type];settings&&(props={...props,...settings}),await text.text.loaded(),await text.text.text.ready(),text.setPropertiesCheck(props,!0)})),_this.layers.text1.group.position.copy(OPTION_MAP.landscapeMobile.title.position)):(_texts.forEach((text=>{let props=text.originalSettings;text.setPropertiesCheck(props,!0)})),_this.layers.text1.group.position.set(0,0,0))}!async function(){await async function init(){_name=_input&&_input instanceof InputUILConfig?_input.get("wildcard"):_input||Utils.query("name");if("section1"!=_name)return;if(_this.config=Config.TECHNOLOGY[_name],_this.layout=_this.initClass(SceneLayout,_name),_this.layers=await _this.layout.getAllLayers(),_this.color=new Color,_this.color.setHex(Colors.hex[_this.config?.bg]||Colors.hex.black),_this.colorValue=Colors.value[_this.config?.bg]||Colors.hex.black,Object.keys(_this.layers).forEach((async key=>{let curr=_this.layers[key];key.includes("text")?(_this.config.data[key]&&(_this.flag("shouldWaitForTexts",!0),await curr.ready(),curr.setText(_this.config.data[key]),curr.shader.set("uTransition0",0)),curr.originalSettings={...curr.fontObject},curr.type=curr.wildcard,_texts.push(curr)):_others.push(curr)})),_this.layout.exists("video")){let videoLayer=await _this.layout.getLayer("video");_video=videoLayer.scriptClass}(function initHits(){let shader=_this.initClass(Shader,"InteractiveScrollSectionHitShader");shader.depthWrite=!1,shader.depthTest=!1,shader.transparent=!0,shader.blending=Shader.ADDITIVE_BLENDING,(_hit=new Mesh(World.PLANE,shader)).scale.setScalar(2),_hit.shader.transparent=!0,_hit.renderOrder=-9999,_hit.position.y=0,_this.add(_hit),(_colorHit=new Mesh(World.PLANE,shader)).scale.setScalar(.001),_colorHit.shader.transparent=!0,_colorHit.renderOrder=-1e3,_colorHit.position.y=-1,_this.add(_colorHit)})(),await defer(),_this.flag("shouldWaitForTexts")&&await _this.wait((_=>_texts.length>0));_this.flag("isReady",!0),_this.isPlayground()&&(await defer(),_this.onVisible())}(),"section1"==_name&&(await defer(),function addListeners(){_this.onResize(resize)}())}(),_this.get("hit",(async()=>(await _this.wait(_this,"isReady"),_hit))),_this.get("colorHit",(()=>_colorHit)),_this.onInvisible=()=>{_this.shown&&(_this.shown=!1,_video&&_video.stop())},_this.onVisible=()=>{_this.shown||(_this.shown=!0,_video&&(_this.animatedIn||_video.show(),_video.start()),_this.animateIn&&_this.animateIn(),_this.animatedIn||(!async function animateIn(){await _this.wait(_this,"isReady"),_texts.forEach(((text,index)=>{text.shaderClass&&text.shaderClass.animateIn?text.shaderClass.animateIn(300*index):console.warn("Text missing WaveTextShader shader class")})),_others.forEach(((layer,index)=>{layer.shaderClass?.animateIn&&layer.shaderClass.animateIn(300*index)}))}(),_this.animatedIn=!0))},_this.hide=()=>{_this.animateOut&&_this.animateOut(),_this.delayedCall((()=>{!function animateOut(){_texts.forEach(((text,index)=>{text.shaderClass&&text.shaderClass.animateOut?text.shaderClass.animateOut(0):console.warn("Text missing WaveTextShader shader class")}))}()}),600),_video&&_video.hide(),_this.animatedIn=!1,_this.shown=!1},this.onColorHitVisible=function(){this.colorValue==Colors.value.beige?NavigationHeader.instance().changeColor(Colors.value.black):NavigationHeader.instance().changeColor(Colors.value.beige)},_this.reset=function(){_texts.forEach((text=>{text.shader.set("uTransition0",0)}))}})),Class((function InteractiveSection(name=Utils.query("name"),index=-1,parentConfig,isParentFirst){Inherit(this,FXScene),Inherit(this,GLUIToRT);const _this=this;var _layers,_cover,_camera,_startCamera,_endCamera,_controller,_desktopStartCamera,_desktopEndCamera,_cameraTransition,_scroll,_cameraWrap,_camGroup,_config,_original,_dashboard,_instruction,_direction=1,_progress=0,_animLerp=.07,_lerp=.07,_texts=[],_isFirstFrame=!0;Utils.query("lerpTheatre");_this.start=0,_this.height=0,_this.progress=0,_this.name=name,_this.direction=1,_this.promise=Promise.create(),_this.bloom=parentConfig?.bloom||0;var _gluiScene=new Scene;function drawGLUI(){GLUI.Stage.renderToRT(_gluiScene,_this.rt)}function getCameraSuffix(){let aspect=Stage.width<Stage.height?"portrait":"landscape";return Device.mobile.phone&&parentConfig?.mobileCameras&&"portrait"===aspect||Hydra.LOCAL&&Utils.query("isMobile")?"Mobile":""}function reset(){if(_cameraWrap&&_original&&(_cameraWrap.position.lerp(_original.position,1,!1),_cameraWrap.quaternion.slerp(_original.quaternion,1,!1)),_this.progress=0,_this.direction=1,_progress=0,_direction=1,_this.layout&&(_this.layout.timeline.elapsed=0),_cameraTransition){_controller.destroy(),(_controller=Camera.instance().createLocal()).name=name,{..._startCamera}.lock(_controller),_controller.worldCamera.fov={..._endCamera}.getFOV(),Utils.query("orbit")||_this.useCamera(_controller.worldCamera),(_cameraTransition={..._endCamera}.manualTransition(_controller)).value=0,_cameraTransition.direction="end";let near=parentConfig?.near?parentConfig.near:1;CameraUtil.addCamera(_controller.worldCamera,near)}}async function resize(){if(Utils.query("cameraMode")||_this.flag("isResizing"))return;await _this.wait(_this,"cameraSet"),_this.flag("isResizing",!0);let mode="";if(mode="portrait"==SceneLayout.breakpoint&&Device.mobile?"mobile":"desktop",mode,_cameraTransition){let aspect=Stage.width<Stage.height?"portrait":"landscape";if(aspect!==_this.flag("aspect")){let isMobile=getCameraSuffix();_desktopStartCamera.prefix=`${name}_startCamera${isMobile}`,_desktopEndCamera.prefix=`${name}_endCamera${isMobile}`,_this.flag("aspect",aspect)}CameraUIL.add(_desktopStartCamera,null),CameraUIL.add(_desktopEndCamera,null);let progress=_progress;await defer(),await defer(),_startCamera=_desktopStartCamera,_endCamera=_desktopEndCamera,reset(),_progress=progress,_this.progress=progress}_this.flag("needsCameraUpdate",!0),_this.flag("isResizing",!1)}function loop(){let last=_progress;if(Global.PLAYGROUND&&(_this.progress=_this.layout.timeline.elapsed),_progress=0==index||15==index?Math.range(_this.progress,.1,1,0,1,!0):Math.clamp(_this.progress,0,1),_this.direction=_progress<last?-1:1,_cameraTransition){if(_direction!=_this.direction||_this.flag("needsCameraUpdate")){let direction=0==_this.direction||1==_this.direction?"end":"start";_cameraTransition.direction!=direction&&(_this.direction>=0?((_cameraTransition={..._endCamera}.manualTransition(_controller)).value=0,_cameraTransition.direction="end"):((_cameraTransition={..._startCamera}.manualTransition(_controller)).value=0,_cameraTransition.direction="start"),_endCamera.camera.applyFOV(),_startCamera.camera.applyFOV()),_direction=_this.direction,_this.flag("needsCameraUpdate",!1)}_cameraTransition.value=_direction>=0?_progress:1-_progress}if(_camGroup&&_cameraWrap&&(_lerp=_isFirstFrame?1:_animLerp,_cameraWrap.position.lerp(_camGroup.position,_lerp,!1),_cameraWrap.quaternion.slerp(_camGroup.quaternion,_lerp,!1),_isFirstFrame=!1),_texts.forEach((text=>{text.update(_progress),_progress>=text.start&&_progress<=text.end?text.animateIn():text.animateOut()})),_dashboard&&(_dashboard.update(_progress),_progress>=_dashboard.start&&_progress<=_dashboard.end?_dashboard.animateIn():_dashboard.animateOut()),_scroll&&(_scroll.update(_progress),_progress>=_scroll.start&&_progress<=_scroll.end?_scroll.animateIn():_scroll.animateOut()),_instruction&&(_instruction.update(_progress),_progress>=_instruction.start&&_progress<=_instruction.end?_instruction.animateIn():_instruction.animateOut()),_layers.title&&_layers.title.text&&"carflyaround"==name&&(_layers.title.text.alpha=Math.smoothStep(.3,.2,_progress)),_layers.chapter&&_layers.chapter.text&&"carflyaround"==name&&(_layers.chapter.text.alpha=Math.smoothStep(.3,.2,_progress)),"ch3newlanding"==name){let layers=["car","cargroup","carshadow"];layers.forEach((l=>{let layer=_layers[l];if(layer){let move=layer.position||layer.group.position;layer.oPos||(layer.oPos=(new Vector3).copy(move)),move.z=Math.range(_progress,0,1,layer.oPos.z-.5,layer.oPos.z+28.5)}})),layers=["trail1","trail2","trail3"],layers.forEach((l=>{let layer=_layers[l];layer.shader.set("uHeight",Math.range(_progress,.1,.4,4,1.5,!0)),layer.oScale||(layer.oScale=layer.scale.y),layer.scale.y=Math.range(_progress,.1,.4,layer.oScale,2*layer.oScale,!0)}))}if(_layers.price&&_layers.price.text&&"gasstation3"==name){let number=Math.range(ViewController.SPEED_MULTI.value,0,1,0,16).toFixed(1);_layers.price.text.setText(number)}_this.layout.timeline.elapsed=_progress,_this.layout.timeline.update(),_this.theatre&&_this.theatre.seek(_progress)}_this.$glWrapper=$gl(),_gluiScene.add(_this.$glWrapper.group),async function(){GLSEO.registerPage(_this,name),name.match("menu")||GLSEO.registerPage(_this.$glWrapper,`${name}__glui`),_this.visible=!1,_this.glui.group.visible=!1,_this.$glWrapper.group.visible=!1,_this.create(RTPool.instance().getRT()),await async function initLayout(){_cover=new Mesh(World.QUAD,_this.initClass(Shader,"InteractiveSectionCover",{tMap:{value:LoaderCoverView.instance().rt},uAlpha:{value:1},transparent:!0,depthWrite:!1})),_this.scene.add(_cover);let immediate=0==index,resolveQueue=Global.PLAYGROUND?null:await Initializer3D.queue(immediate),perFrame=resolveQueue&&!immediate?2:void 0;_this.layout=_this.initClass(SceneLayout,name,{timeline:new TweenTimeline,perFrame:perFrame}),_this.scene.add(_this.layout.group),_layers=await _this.layout.getAllLayers(),_camera=_layers.cinemaCamera||_layers.sceneCamera,_this.layers=_layers,function initText(){_texts=[],parentConfig&&(parentConfig.text&&parentConfig.text.forEach((config=>{config.height=parentConfig.height,parentConfig.dashboard&&Device.mobile.phone&&(config.top=!0);let text=_this.initClass(ChapterCopy,config);_this.$glWrapper.add(text.element),text.start=config.start,text.end=config.end,_texts.push(text),config.isA11Y&&(text.element.alpha=.001)})),parentConfig.landingCopy&&parentConfig.landingCopy.forEach((config=>{config.height=parentConfig.height,config.dashboard=parentConfig.dashboard;let text=_this.initClass(LandingCopy,config);_this.$glWrapper.add(text.element),text.start=config.start,text.end=config.end,_texts.push(text)})),parentConfig.instruction&&(parentConfig.instruction.height=parentConfig.height,(_instruction=_this.initClass(Instruction,parentConfig.instruction)).start=parentConfig.instruction.start,_instruction.end=parentConfig.instruction.end,_this.$glWrapper.add(_instruction.element)),parentConfig.scroll&&(parentConfig.scroll.height=parentConfig.height,(_scroll=_this.initClass(ScrollPrompt,parentConfig.scroll)).start=parentConfig.scroll.start,_scroll.end=parentConfig.scroll.end,_this.$glWrapper.add(_scroll.element)),parentConfig.dashboard&&(parentConfig.dashboard.height=parentConfig.height,(_dashboard=_this.initClass(DashboardOverlay,parentConfig.dashboard)).start=parentConfig.dashboard.start,_dashboard.end=parentConfig.dashboard.end,_this.$glWrapper.add(_dashboard.element)))}(),_camera&&!Utils.query("orbit")&&function initCameraWrap(){_camGroup=_camera.group._parent,_original=_camGroup.clone(),(_cameraWrap=new Group).add(_camera.group),_this.layout.add(_cameraWrap),_this.useCamera(_camera);let near=parentConfig?.near?parentConfig.near:1;CameraUtil.addCamera(_camera.camera,near),(_config=InputUIL.create(name+"_scroll")).setLabel("Animation Lerp"),_config.add("lerp",.07),_animLerp=_config.getNumber("lerp")||.07,_this.flag("cameraSet",!0)}();Global.PLAYGROUND||await Initializer3D.detectUploadAll(_this.layout,immediate,resolveQueue);_cover.shader.tween("uAlpha",0,300,"easeOutCubic"),_this.theatre=TweenUIL.create(`${name}_theatre`,_this.layout),_this.layers.tween_anchor&&await _this.theatre.preload();isParentFirst&&0==index&&_this.events.fire(InteractiveSection.INITIAL_LOADED);_this.flag("isReady",!0)}(),_camera||async function createCameras(){await _this.wait(_this,"isReady"),Utils.query("cameraMode")||"desktop",_desktopStartCamera=_this.initClass(GazeCamera),_desktopEndCamera=_this.initClass(GazeCamera);let isMobile=getCameraSuffix();_desktopStartCamera.prefix=`${name}_startCamera${isMobile}`,_desktopEndCamera.prefix=`${name}_endCamera${isMobile}`,CameraUIL.add(_desktopStartCamera),CameraUIL.add(_desktopEndCamera),await defer(),_startCamera=_desktopStartCamera,_endCamera=_desktopEndCamera,(_controller=Camera.instance().createLocal()).name=name,{..._startCamera}.lock(_controller);let near=parentConfig?.near?parentConfig.near:1;CameraUtil.addCamera(_controller.worldCamera,near),CameraUtil.addCamera(_startCamera.camera,near),CameraUtil.addCamera(_endCamera.camera,near),Utils.query("orbit")||_this.useCamera(_controller.worldCamera);(_cameraTransition={..._endCamera}.manualTransition(_controller)).direction="end",_this.flag("cameraSet",!0)}(),Global.PLAYGROUND&&(_this.startRender(loop),_this.visible=!0),function addListeners(){_this.onResize(resize)}(),Tests.generatePreview()||_this.startRender(drawGLUI,_this),_this.promise.resolve()}(),_this.onVisible=function(){},_this.onInvisible=function(){},_this.update=function(){loop()},_this.show=async function(){_this.isVisible||(_this.isVisible=!0,Device.mobile&&function extraReset(){if(_cameraTransition){_controller.destroy(),(_controller=Camera.instance().createLocal()).name=name,_this.direction>=0?({..._startCamera}.lock(_controller),Utils.query("orbit")||_this.useCamera(_controller.worldCamera),(_cameraTransition={..._endCamera}.manualTransition(_controller)).value=0,_cameraTransition.direction="end"):({..._endCamera}.lock(_controller),Utils.query("orbit")||_this.useCamera(_controller.worldCamera),(_cameraTransition={..._startCamera}.manualTransition(_controller)).value=0,_cameraTransition.direction="start"),_endCamera.camera.applyFOV(),_startCamera.camera.applyFOV();let near=parentConfig?.near?parentConfig.near:1;CameraUtil.addCamera(_controller.worldCamera,near)}}(),_this.visible=!0,_this.glui.group.visible=!0,_this.glui.alpha=1,_this.$glWrapper.group.visible=!0,_this.$glWrapper.alpha=1,_camera&&(_camera.visible=!0),_this.gluiToRT(),await defer(),_this.delayedCall((()=>{_this.gluiToScreen()}),800),await _this.wait(_this,"isReady"),_this.ui&&_this.ui.setVisibility&&_this.ui.setVisibility(!0),_this.ui&&_this.ui.animateIn&&_this.ui.animateIn(),_this.animateIn&&_this.animateIn(),_this.startRender(loop),ViewController.BLOOM_EXTRA=_this.bloom)},_this.hide=async function(invokedByParent){_this.isVisible?(_this.isVisible=!1,_this.stopRender(loop),_camera&&(_camera.visible=!1),_this.gluiToRT(),_this.ui&&_this.ui.animateOut&&await _this.ui.animateOut(),_this.animateOut&&_this.animateOut(),invokedByParent?_this.delayedCall((()=>{reset(),_this.visible=!1,_this.glui.group.visible=!1,_this.$glWrapper.group.visible=!1}),600):(_this.visible=!1,_this.glui.group.visible=!1,_this.$glWrapper.group.visible=!1),_this.ui&&_this.ui.setVisibility&&_this.ui.setVisibility(!1)):invokedByParent&&reset()},_this.ready=function(){return _this.promise},_this.get("layers",(()=>_layers))}),(()=>{InteractiveSection.INITIAL_LOADED="InteractiveSection_initial_loaded"})),Class((function InteractiveUI({height:height=1}={}){Inherit(this,Element);const $this=this.element;!function initHTML(){$this.css({height:`${height}00vh`,width:"100%"})}()})),Class((function InteractiveScrollPageBgShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uRange:{value:new Vector2(.35,.5)},uColor1:{value:new Color},uColor2:{value:new Color},uTransition:{value:0},uNoiseScale:{value:0},uNoiseSpeed:{value:0},uVelocity:{value:0},uVelocityMultiplier:{value:3},uAliasFactor:{value:.0025},uBias:{value:0},uDirection:{value:-1}})})),Class((function InteractiveScrollSectionVideo(_mesh,_shader,_group,_input){Inherit(this,Object3D);const _this=this;var _videoTexture;function handleVideoStart(){_this.flag("isInteracted",!0),_this.events.unsub(Mouse.input,Interaction.START,handleVideoStart)}!async function(){let path=await _input.get("wildcard");_videoTexture=_this.initClass(VideoTexture,path,{autoplay:!1,muted:!0,loop:!0}),_shader.set("tMap",_videoTexture),function addListeners(){_this.events.sub(Mouse.input,Interaction.START,handleVideoStart)}()}(),_this.show=async function(delay=0){await _shader.tween("uTransition0",1,2e3,"easeIn",delay).promise()},_this.hide=async function(delay=0){await _shader.tween("uTransition0",0,300,"easeIn",delay).promise()},_this.start=async function(){Device.mobile&&await _this.wait("isInteracted"),_videoTexture.start(),_videoTexture.video.play()},_this.stop=function(){_videoTexture.video.pause()}})),Class((function InteractiveScrollSectionVideoShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},tDimensions:{value:new Vector2},uAlpha:{value:0},tNoise:{value:Utils3D.getTexture("assets/images/noise/dirnoise3.jpg"),ignoreUIL:!0},uTimeScale:{value:.39},uUVScale:{value:1.78},uRotation:{value:0},uTransition0:{value:0}}),this.animateIn=async function(delay=0){_shader.set("uTransition0",0),await _shader.tween("uTransition0",1,2e3,"easeIn",delay).promise()},this.animateOut=async function(delay=0){await _shader.tween("uTransition0",0,300,"easeIn",delay).promise()}})),Class((function TestLayout(_name=Utils.query("name")){Inherit(this,Object3D);const _this=this;!async function(){!async function initScene(){_this.layout=_this.initClass(SceneLayout,`testlayout_${_name}`),Utils.query("name")}()}()})),Class((function Campfire(){Inherit(this,InteractiveSection,"campfire");!async function(){}()})),Class((function Tents(){Inherit(this,InteractiveSection,"tents");!async function(){}()})),Class((function CampShopSmall(){Inherit(this,InteractiveSection,"campshopsmall");!async function(){}()})),Class((function Car(_input,_group){Inherit(this,Object3D);const _this=this;var _config;!async function(){let playground="Car"===Global.PLAYGROUND,type=playground?Utils.query("car"):_input.get("wildcard"),noGraph=!!type&&!playground;type=type?`car_${type}`:"car",_this.layout=_this.initClass(SceneLayout,type,{noGraph:noGraph}),(_config=InputUIL.create("car_"+_input.prefix,_group)).setLabel("Car Config"),_config.addImage("tEnvDiffuse"),_config.addImage("tEnvSpecular"),_config.addImage("tLightmap"),_config.addNumber("uWheelSpeed",100),_config.addNumber("uSaturation",1),_config.addVector("uEnv",[2,0]),_config.addVector("uLight",[1,1,2.5,1]),_config.addVector("uWiggle",[.002,0,0,0]),_config.onUpdate=key=>{let value=_config.get(key);if(value)if(Array.isArray(value))for(let layer in _this.layout.layers){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&mesh.shader.uniforms[key].value.fromArray(value)}else if(value.includes("{")){value=JSON.parse(value);let src=value.src;src.includes("?")&&!data.hotreload&&src.split("?")[0];if(src?.length){value.compressed&&(src+="-compressedKtx");let texture=Utils3D.getTexture(src);key.includes("tEnv")&&(texture.generateMipmaps=!1,texture.minFilter=Texture.LINEAR);for(let layer in _this.layout.layers){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&mesh.shader.set(key,texture)}}}else{value=JSON.parse(value);for(let layer in _this.layout.layers)if(layer.includes("wheel")){let mesh=_this.layout.layers[layer];mesh.shader?.uniforms[key]&&(mesh.shader.uniforms[key].value=value)}}},_this.startRender((_=>{PBRCarShader.TIME.value+=.015*(1+2*ViewController.SPEED_MULTI.value)*Render.HZ_MULTIPLIER})),await _this.layout.loadedAllLayers(),["tEnvDiffuse","tEnvSpecular","tLightmap","uEnv","uLight","uWiggle","uWheelSpeed","uSaturation"].forEach(_config.onUpdate)}()})),Class((function CarTransition(_input,_group){Inherit(this,Object3D);const _this=this;!async function(){let inPlayground="CarTransition"===Global.PLAYGROUND,name=`car_transition_${inPlayground&&Utils.query("name")?Utils.query("name"):_input?.get?.("wildcard")}`;_this.layout=_this.initClass(SceneLayout,name,{noGraph:!inPlayground});let layers=await _this.layout.getAllLayers();layers=Object.values(layers),_this.startRender((_=>{let progress=_this.shader.uniforms.uProgress.value,speed=_this.shader.uniforms.uWheelSpeed.value;layers.map((layer=>{isNaN(layer.progress)||(layer.progress=progress),isNaN(layer.wheelSpeed)||(layer.wheelSpeed=speed)}))}))}(),this.shader={uniforms:{uProgress:{value:0},uWheelSpeed:{value:1}}}})),Class((function PBRCarShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uTime:PBRCarShader.TIME,uNoiseStrength:{value:0},uWheelSpeed:{value:0},uClearCoat:{value:new Vector3(.6,.7,0)},uWiggle:{value:new Vector4},uSaturation:{value:1}})}),(_=>{PBRCarShader.TIME={value:1}})),Class((function CarFlyAround(index,parentConfig){Inherit(this,InteractiveSection,"carflyaround",index,parentConfig);const _this=this;function loop(){}!async function(){await _this.ready(),(await _this.layout.getLayer("title")).setText(CMS.get("chapters.chapter-1.title")),_this.startRender(loop)}()})),Class((function CloudCover(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uColor:{value:new Color},uAlpha:{value:1}})})),Class((function CarbonCaptureField(){Inherit(this,InteractiveSection,"ccfield");!async function(){}()})),Class((function Ch1Intro(index,parentConfig){Inherit(this,InteractiveSection,"ch1intro",index,parentConfig);const _this=this;!async function(){await _this.ready(),(await _this.layout.getLayer("text")).setText(CMS.get("chapters.chapter-1.title"))}()})),Class((function Ch3Landing(index,parentConfig){Inherit(this,InteractiveSection,"ch3newlanding",index,parentConfig,!0);const _this=this;var _car;function loop(){_car.position.z=Math.range(_this.layout.timeline.elapsed,0,1,_car.start,_car.end)}!async function(){await _this.ready(),(_car=await _this.layout.getLayer("cargroup")).start=_car.position.z,_car.end=_car.start+19,console.log(_car),_this.startRender(loop)}()})),Class((function Ch3OverFactory(index,parentConfig){Inherit(this,InteractiveSection,"ch3landing",index,parentConfig,!0)})),Class((function Ch3InsideFactory(index,parentConfig){Inherit(this,InteractiveSection,"ch3insidefactory",index,parentConfig)})),Class((function Ch3LoadingDock(index,parentConfig){Inherit(this,InteractiveSection,"ch3loadingdock",index,parentConfig)})),Class((function Ch3Caravan(index,parentConfig){Inherit(this,InteractiveSection,"ch3caravan",index,parentConfig)})),Class((function Ch3Shipping(index,parentConfig){Inherit(this,InteractiveSection,"ch3shipping",index,parentConfig)})),Class((function Ch3Destination(index,parentConfig){Inherit(this,InteractiveSection,"ch3destination",index,parentConfig)})),Class((function Ch3Transition(index,parentConfig){Inherit(this,InteractiveSection,"ch3ending",index,parentConfig)})),Class((function Ch3Ending(index,parentConfig){Inherit(this,InteractiveSection,"ch3endingsplit",index,parentConfig)})),Class((function ForgeShadows(_mesh,_shader){Inherit(this,Component);_shader.addUniforms({tMap:{value:null},uColor:{value:new Color("#000000")},uFeather:{value:0},uOpacity:{value:1},uProgress1:{value:1},uProgress2:{value:1},uProgress3:{value:1},uProgress4:{value:1},transparent:!0})})),Class((function StylizedEndingRoad(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uStep:{value:.5},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:.15},uGrainReduce:{value:0},uHueAdjust:{value:0},uColor1:{value:new Color("#FFFFFF")},uColor2:{value:new Color("#39404B")},uColor3:{value:new Color("#B34E3C")},uShadowColor:{value:new Color("#727C8B")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},uOrigin1:{value:new Vector2(.5,.5)},uOrigin2:{value:new Vector2(.5,.5)},uOrigin3:{value:new Vector2(.5,.5)},uOrigin4:{value:new Vector2(.5,.5)},uProgress1:{value:0},uProgress2:{value:0},uProgress3:{value:0},uProgress4:{value:0},uTransitionNoise:{value:new Vector4(1,1,1,0)},uScaleAdjust:{value:new Vector2(1,1)},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})})),Class((function StylizedForgeShader(_mesh,_shader){Inherit(this,Component);!function(){let lookup=Utils3D.getLookupTexture("assets/images/pbr/lut.png");lookup.forcePersist=!0,_shader.addUniforms({uTint:{value:new Color("#FFFFFF")},uTiling:{value:new Vector2(1,1)},uOffset:{value:new Vector2(0,0)},uMRON:{value:new Vector4(1,1,1,1)},uEnv:{value:new Vector2(1,0)},uUseLightmap:{value:0},uHDR:{value:0,ignoreUIL:!0},uUseTonemapping:{value:1,ignoreUIL:!0},uUseLinearOutput:{value:0},tLUT:{value:lookup,ignoreUIL:!0},tBaseColor:{value:null,getTexture:Utils3D.getRepeatTexture},tMRO:{value:null,getTexture:Utils3D.getRepeatTexture},tNormal:{value:null,getTexture:Utils3D.getRepeatTexture},tEnvDiffuse:{value:null,premultiplyAlpha:!1},tEnvSpecular:{value:null,premultiplyAlpha:!1},tLightmap:{value:null,premultiplyAlpha:!1},uClearCoat:{value:new Vector3(.6,.7,0)},uNoiseStrength:{value:0},uSaturation:{value:1},uStep:{value:.5},uTile:{value:new Vector2(1,1)},uDirection:{value:new Vector2(0,0)},uGrain:{value:-.4},uGrainReduce:{value:.77},uHueAdjust:{value:0},uColor1:{value:new Color("#232743")},uColor2:{value:new Color("#FFFFFF")},uColor3:{value:new Color("#000000")},uColor4:{value:new Color("#2e4e8e")},uColor5:{value:new Color("#724531")},uColor6:{value:new Color("#ac8062")},uColor7:{value:new Color("#423029")},uColor8:{value:new Color("#e1c2b7")},uApplyPBR:{value:1},uShadowColor:{value:new Color("#454545")},uPosterizeTime:{value:12},uFogParams:{value:new Vector2(-10,-200)},uFogColor:{value:new Color("#FFFFFF")},uFogMix:{value:0},uWiggle:{value:new Vector3},uWiggleSpeed:{value:.1},uOffsetHeight:{value:10},uIndexRange1:{value:new Vector2(0,0)},uIndexRange2:{value:new Vector2(1,1)},uIndexRange3:{value:new Vector2(2,2)},uIndexRange4:{value:new Vector2(3,3)},uProgress1:{value:0},uProgress2:{value:0},uProgress3:{value:0},uProgress4:{value:0},tBrush:{value:Utils3D.getRepeatTexture("assets/images/noise/brushstroke.jpg"),ignoreUIL:!0},uBrushBlend:{value:0},uBrushScale:{value:new Vector2(1,1)},uBrushRotate:{value:0}})}()})),Class((function Distill(){Inherit(this,InteractiveSection,"distill");!async function(){}()})),Class((function Fan(){Inherit(this,InteractiveSection,"fanscene");!async function(){}()})),Class((function Fan2(){Inherit(this,InteractiveSection,"fanscene2");!async function(){}()})),Class((function ForgeField(){Inherit(this,InteractiveSection,"forgefield");!async function(){}()})),Class((function ForgeField2(){Inherit(this,InteractiveSection,"forgefield2");!async function(){}()})),Class((function GasStation(){Inherit(this,Object3D);const _this=this;!async function(){_this.layout=_this.initClass(SceneLayout,"gasstation"),(await _this.layout.getLayer("camera")).lock()}()})),Class((function GasStationGreybox(){Inherit(this,InteractiveSection,"gasstationgreybox");!async function(){}()})),Class((function GasStation2(index,parentConfig,isFirst){Inherit(this,InteractiveSection,"gasstation2",index,parentConfig,isFirst);const _this=this;!async function(){await _this.ready(),(await _this.layout.getLayer("title")).setText(CMS.get("chapters.chapter-2.title"))}()})),Class((function GasStation3(){Inherit(this,InteractiveSection,"gasstation3");!async function(){console.log("gas station 3")}()})),Class((function OilFieldTransform(){Inherit(this,InteractiveSection,"oilfieldtransform");!async function(){}()})),Class((function PlaneLayout(){Inherit(this,InteractiveSection,"planeLayout");!async function(){}()})),Class((function Route66(){Inherit(this,InteractiveSection,"route66");!async function(){}()})),Class((function SolarField(){Inherit(this,InteractiveSection,"solarfield");!async function(){}()})),Class((function SolarField2(){Inherit(this,InteractiveSection,"solarfield2");!async function(){}()})),Class((function ElectricityShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tMap:{value:null,getTexture:Utils3D.getRepeatTexture},uPosterizeTime:{value:12},uGrain:{value:.5},uStep:{value:.5},uColor0:{value:new Color("#FF6600")},uColor1:{value:new Color("#FFFFFF")},uScale:{value:1},uNoise:{value:.1},uRange:{value:new Vector2}})})),Class((function MoleculeShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({uKeyLightDir:{value:new Vector3(0,4,0)},uBounceLightDir:{value:new Vector3(-.1,-1.5,0)},uRimLightDir:{value:new Vector3(0,1,-1)},uKeyLightStep:{value:.8},uBounceStep:{value:1.1},uRimStep:{value:.8},uColor:{value:new Color("#C8CECF")},uBounceColor:{value:new Color("#ADB6BF")},uRimColor:{value:new Color("#ffffff")},uShadowColor:{value:new Color("#A6ADB5")},uGrain:{value:.9},uWobble:{value:new Vector2},uWobbleSpeed:{value:8},uRotationSpeed:{value:.1},uExplode:{value:0},uBounds:{value:new Vector4},uSign:{value:1},uHover:{value:1}})})),Class((function Molecules(index,parentConfig){Inherit(this,InteractiveSection,"molecules",index,parentConfig);const _this=this;var _layers,_value=0,_target=-.1;function loop(){_target=1.1*ViewController.SPEED_MULTI.value-.1,_target=Math.max(Math.range(_this.progress,.51,.57,0,1),_target),_value=Math.lerp(_target,_value,.1),_layers.glow.shader.uniforms.uScale.value=_value,_layers.hydrocarbon.shader.uniforms.uExplode.value=-25*_value,_layers.strike.shader.uniforms.uStep.value=1-_value}!async function(){await _this.ready(),_layers=await _this.layout.getAllLayers(),_this.layout.timeline.add(_layers.h2o_and_co2.shader.uniforms.uExplode,{value:20},30,"linear",25),_this.layout.timeline.add(_layers.sky.shader.uniforms.uMix,{value:0},9,"linear",82),_this.startRender(loop)}()})),Class((function StrikeShader(_mesh,_shader,_group,_input){Inherit(this,Component);_shader.addUniforms({tAnimation:{value:null},uPosterizeTime:{value:12},uScale:{value:1},uOffset:{value:new Vector3},uColor:{value:new Color("ff6600")},uStep:{value:.5}})})),Class((function TechScene(){Inherit(this,InteractiveSection,"techscenelayout");!async function(){}()})),Class((function TestDrive(){Inherit(this,Object3D);const _this=this;!async function(){_this.layout=_this.initClass(SceneLayout,"testdrive"),(await _this.layout.getLayer("camera")).lock()}()})),Class((function TestPlane(){Inherit(this,InteractiveSection,"testplane");!async function(){}()})),Class((function Trucks(){Inherit(this,InteractiveSection,"trucks");!async function(){}()})),Class((function Main(){!function(){if(Utils.query("performance"))return Performance.displayResults();!function init(){GLUI.init(),GlobalAudio3D.setup(),Device.mobile||HydraCSS.style("body, html, #Stage",{overflowY:"scroll"});if(window.location.search.includes("p=")&&"production"!==Config.ENV)return AssetLoader.loadAssets(Assets.list().filter(["uil","shaders"])).then(Playground.instance);Container.instance()}(),Mouse.resetOnRelease=!0}()}));
window._MINIFIED_=true;
window._BUILT_=true;